function State(a,b){this.name=a,this.id=b}function FSMContext(a){this.state=a,this.previousState=null,this.stateStack=[],this.transition="",this.debugFlag=!1}var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),ionweb;!function(a){a.Version="1.1.8-p1d8-r15018",a.Copyright="Â© Copyright 2018, ION.",a.GitSha="50b0bb1ece4773cd76bcd2a243f03fa86727291f"}(ionweb||(ionweb={}));var ionweb;!function(a){var b=function(){function a(a,b,c,d){this.owner=a,this.propertyName=b,this.newValue=c,this.oldValue=d}return Object.defineProperty(a,"Empty",{get:function(){return this._empty},enumerable:!0,configurable:!0}),a._empty=new a(null,null,null,null),a}();a.PropertyChangedEventArgs=b;var c=function(){function c(){this._store={},this._propertyChanged=new a.Event}return Object.defineProperty(c.prototype,"propertyChanged",{get:function(){return this._propertyChanged},enumerable:!0,configurable:!0}),c.prototype.getPropertyValue=function(a){return this._store[a]},c.prototype.setPropertyValue=function(a,c){var d=this._store[a];c!==d&&(this._store[a]=c,this._propertyChanged.raise(this,new b(this,a,c,d)))},c.prototype.loseSubObservable=function(b){if(!b)throw new Error(a.charts.Strings.Err_ObservObject_Argument_CannotBe_NullOr_Undefined);b.propertyChanged.remove(this.handleSubObservablePropertyChanged,this)},c.prototype.trackSubObservable=function(b){if(!b)throw new Error(a.charts.Strings.Err_ObservObject_Argument_CannotBe_NullOr_Undefined);return b.propertyChanged.add(this.handleSubObservablePropertyChanged,this),b},c.prototype.handleSubObservablePropertyChanged=function(a,b){this._propertyChanged.raise(this,b)},c}();a.ObservableObject=c}(ionweb||(ionweb={}));var ionweb;!function(a){var b=function(){function a(a,b,c,d){this.cleared=a,this.startingIndex=b,this.oldItems=c,this.newItems=d}return a}();a.CollectionChangedEventArgs=b;var c=function(c){function d(b){var d=c.call(this)||this;return d._items=[],d._itemsChanged=new a.Event,b&&d.addRange(b),d}return __extends(d,c),d.prototype.add=function(a){return this.addRange([a]),a},d.prototype.addRange=function(a){for(var c=0;c<a.length;c++)this._items.push(a[c]);return a.length>0&&this.onRaiseItemsChanged(new b(!1,this._items.length-a.length,[],a.slice(0))),a},d.prototype.removeAt=function(c,d){if(void 0===d&&(d=1),c<0||c>=this._items.length){var e=a.stringFormat(a.charts.Strings.Err_ObservCollection_StartIndex_OutOfRange,{index:c});throw new Error(e)}if(d<1)throw new Error(a.charts.Strings.Err_ObervCollection_Number_OfItems_ToDelete_MustBe_AtleastOne);if(c+d>this._items.length)throw new Error(a.charts.Strings.Err_ObservCollection_Too_ManyItems_ToDelete);var f=this._items.splice(c,d);return this.onRaiseItemsChanged(new b(!1,c,f,[])),f},d.prototype.replaceAt=function(a,c){var d=[a,c.length].concat(c),e=Array.prototype.splice.apply(this._items,d);this.onRaiseItemsChanged(new b(!1,a,e,c))},d.prototype.replaceAll=function(a){for(var c=this._items.splice(0),d=0;d<a.length;d++)this._items.push(a[d]);this.onRaiseItemsChanged(new b(!0,0,c,a))},d.prototype.contains=function(a){return this.indexOf(a)>=0},d.prototype.remove=function(a){var b=this.indexOf(a);return b>=0&&this.removeAt(b),b},d.prototype.clear=function(){var a=this._items;this._items=[],a.length>0&&this.onRaiseItemsChanged(new b(!0,0,a,[]))},d.prototype.onRaiseItemsChanged=function(a){this._itemsChanged.raise(this,a)},d.prototype.items=function(){return this._items.slice(0)},d.prototype.item=function(a){return this._items[a]},Object.defineProperty(d.prototype,"itemsChanged",{get:function(){return this._itemsChanged},enumerable:!0,configurable:!0}),d.prototype.join=function(a){return this._items.join(a)},d.prototype.slice=function(a,b){return this._items.slice(a,b)},d.prototype.indexOf=function(a){return this._items.indexOf(a)},d.prototype.lastIndexOf=function(a,b){return this._items.lastIndexOf(a,b)},d.prototype.first=function(a,b){void 0!==b&&(a=a.bind(b));for(var c=0;c<this._items.length;c++)if(a(this._items[c],c,this._items))return c;return-1},d.prototype.every=function(a,b){return this._items.every(a,b)},d.prototype.some=function(a,b){return this._items.some(a,b)},d.prototype.filter=function(a,b){return this._items.filter(a,b)},d.prototype.forEach=function(a,b){this._items.forEach(a,b)},d.prototype.map=function(a,b){return this._items.map(a,b)},d.prototype.reduce=function(a,b){return this._items.reduce(a,b)},d.prototype.reduceRight=function(a,b){return this._items.reduceRight(a,b)},Object.defineProperty(d.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),d}(a.ObservableObject);a.ObservableCollection=c}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){function b(a,b){var c,d,e=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,f=/(^[ ]*|[ ]*$)/g,g=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,h=/^0x[0-9a-f]+$/i,i=/^0/,j=function(a){return(""+a).toLowerCase()},k=j(a).replace(f,"")||"",l=j(b).replace(f,"")||"",m=k.replace(e,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),n=l.replace(e,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),o=parseInt(k.match(h))||1!==m.length&&k.match(g)&&Date.parse(k),p=parseInt(l.match(h))||o&&l.match(g)&&Date.parse(l)||null;if(p){if(o<p)return-1;if(o>p)return 1}for(var q=0,r=Math.max(m.length,n.length);q<r;q++){if(c=!(m[q]||"").match(i)&&parseFloat(m[q])||m[q]||0,d=!(n[q]||"").match(i)&&parseFloat(n[q])||n[q]||0,isNaN(c)!==isNaN(d))return isNaN(c)?1:-1;if(typeof c!=typeof d&&(c+="",d+=""),c<d)return-1;if(c>d)return 1}return 0}var c=function(){function a(){}return Object.defineProperty(a,"alphabeticalAscending",{get:function(){return a._alphabeticalAscending},enumerable:!0,configurable:!0}),Object.defineProperty(a,"alphabeticalDescending",{get:function(){return a._alphabeticalDescending},enumerable:!0,configurable:!0}),Object.defineProperty(a,"valueSumAscending",{get:function(){return a._valueSumAscending},enumerable:!0,configurable:!0}),Object.defineProperty(a,"valueSumDescending",{get:function(){return a._valueSumDescending},enumerable:!0,configurable:!0}),a._alphabeticalAscending=function(a,c){var d=a.category.toLowerCase(),e=c.category.toLowerCase();return b(d,e)},a._alphabeticalDescending=function(b,c){return a._alphabeticalAscending(c,b)},a._valueSumAscending=function(a,b){var c=0;a.points.forEach(function(a){return c+=a.y});var d=0;return b.points.forEach(function(a){return d+=a.y}),c<d?-1:c>d?1:0},a._valueSumDescending=function(b,c){return a._valueSumAscending(c,b)},a}();a.SeriesPointsSortCriteria=c;var d=function(){function a(a,b,c){var d=this;this._category=a,c&&c.length>0?(this._pointsMap={},c.forEach(function(a){b[a]&&(d._pointsMap[a]=b[a])})):this._pointsMap=b}return Object.defineProperty(a.prototype,"category",{get:function(){return this._category},enumerable:!0,configurable:!0}),a.prototype.pointForSeries=function(a){return this._pointsMap[a]||null},Object.defineProperty(a.prototype,"points",{get:function(){var a=this;return this._points||(this._points=Object.keys(this._pointsMap).map(function(b){var c=a._pointsMap[b];return{x:c.x,y:c.y,z:c.z,text:c.text,id:c.id,color:c.color,seriesName:b}})),this._points},enumerable:!0,configurable:!0}),a}();a.CategoryPoints=d;var e=function(){function a(a){void 0===a&&(a=!1),this.fillMissingCategories=a,this._listeners=[],this._sortedSeriesMap={},this._sortedCategories=[],this._restrictComparisonTo=[],this._dirty=!1,this._map={},this._listeners={}}return Object.defineProperty(a.prototype,"restrictComparisonTo",{get:function(){return this._restrictComparisonTo},set:function(a){this._restrictComparisonTo=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"sortCriterion",{get:function(){return this._sortCriterion},set:function(a){this._sortCriterion=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"sortedCategories",{get:function(){return this.dirty&&this.updateSortedMapAndCategories(),this._sortedCategories},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"sortedSeriesMap",{get:function(){return this.dirty&&this.updateSortedMapAndCategories(),this._sortedSeriesMap},enumerable:!0,configurable:!0}),a.prototype.categories=function(){return Object.keys(this._map)},Object.defineProperty(a.prototype,"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0}),a.prototype.addSeries=function(a){this.updateCategoryMap(a.name,a.items()),this._listeners[a.name]=a.itemsChanged.add(this.handleItemsChanged,this)},a.prototype.removeSeries=function(a){this.removeFromCategoryMap(a.name),this._listeners[a.name]&&(this._listeners[a.name](),delete this._listeners[a.name])},a.prototype.clear=function(){var a=this;Object.keys(this._listeners).forEach(function(b){a._listeners[b]()}),this._listeners=[],this._map={},this._dirty=!1},a.prototype.updateSortedMapAndCategories=function(){var a=this,b=this.categories(),c=this.sortCriterion;c&&(Array.isArray(c)&&c.length>0&&"string"==typeof c[0]?b=c:"function"==typeof c&&b.sort(function(b,e){return c(new d(b,a._map[b],a.restrictComparisonTo),new d(e,a._map[e],a.restrictComparisonTo))}));var e={},f={},g=Object.keys(this._listeners),h=function(b){b.forEach(function(b){var c=a._map[b];c&&(f[b]=!0,g.forEach(function(c){var d=a.getSeriesPointForCategory(c,b);d&&(e[c]=e[c]||[],e[c].push(d))}))})};h(b);var i=Object.keys(this._map).filter(function(a){return!f[a]});i.length>0&&h(i),this._sortedCategories=b,this._sortedSeriesMap=e,this._dirty=!1},a.prototype.getSeriesPointForCategory=function(a,b){var c=this._map[b][a];return!c&&this.fillMissingCategories&&(c={x:b,y:null}),c||null},a.prototype.updateCategoryMap=function(a,b){var c=this;b.length&&(b.forEach(function(b,d){b.__index=d;var e=b.x;(c._map[e]||(c._map[e]={}))&&(c._map[e][a]=b)}),this._dirty=!0)},a.prototype.removeFromCategoryMap=function(a,b){var c=this,d=b&&b.length>0?b.map(function(a){return a.x}):this.categories();d.forEach(function(b){var d=c._map[b];"undefined"!=typeof d[a]&&(delete d[a],0===Object.keys(d).length&&delete c._map[b],c._dirty=!0)})},a.prototype.handleItemsChanged=function(a,b){b.cleared&&this.removeFromCategoryMap(a.name),b.newItems.length>0&&this.updateCategoryMap(a.name,b.newItems),!b.cleared&&b.oldItems.length>0&&this.removeFromCategoryMap(a.name,b.oldItems)},a}();a.CategorizedChartDataIndexer=e}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.X=0]="X",a[a.Y=1]="Y"}(c=b.ChartAxisDimension||(b.ChartAxisDimension={}));var d;!function(a){a[a.Linear=0]="Linear",a[a.Log=1]="Log",a[a.Categorized=2]="Categorized",a[a.DateTime=3]="DateTime"}(d=b.ChartAxisType||(b.ChartAxisType={}));var e;!function(a){a[a.Auto=0]="Auto",a[a.Fixed=1]="Fixed",a[a.Window=2]="Window"}(e=b.ChartAxisRangeMode||(b.ChartAxisRangeMode={}));var f;!function(a){a[a.None=0]="None",a[a.CategoryNameAscending=1]="CategoryNameAscending",a[a.CategoryNameDescending=2]="CategoryNameDescending",a[a.YValueAscending=3]="YValueAscending",a[a.YValueDescending=4]="YValueDescending",a[a.Custom=5]="Custom"}(f=b.ChartCategorySortingMode||(b.ChartCategorySortingMode={}));var g=function(){function a(a,b){this._dimension=a,this._index=b}return Object.defineProperty(a,"X1",{get:function(){return a._X1},enumerable:!0,configurable:!0}),Object.defineProperty(a,"X2",{get:function(){return a._X2},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Y1",{get:function(){return a._Y1},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Y2",{get:function(){return a._Y2},enumerable:!0,configurable:!0}),Object.defineProperty(a,"All",{get:function(){return a._All},enumerable:!0,configurable:!0}),a.Equals=function(a,b){return a&&b&&a.dimension===b.dimension&&a.index===b.index},Object.defineProperty(a.prototype,"dimension",{get:function(){return this._dimension},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),a.prototype.toString=function(){return c[this.dimension]+this.index},a.prototype.equals=function(b){return a.Equals(b,this)},a._X1=new a(c.X,1),a._X2=new a(c.X,2),a._Y1=new a(c.Y,1),a._Y2=new a(c.Y,2),a._All=[a._X1,a._X2,a._Y1,a._Y2],a}();b.ChartAxisId=g;var h=function(a){function b(b){var g=a.call(this)||this;return g._id=b,g.axisType=b.dimension===c.X?d.Categorized:d.Linear,g.rangeMode=e.Auto,g.windowSlackRatio=.15,g.zoomable=!0,g.showGridLines=g.showZeroLine=b.index<2,g.sorting=f.None,g.restrictSortingComparisonTo=[],g.sortingCriterion=[],g}return __extends(b,a),Object.defineProperty(b,"TitleProperty",{get:function(){return"title"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"AxisTypeProperty",{get:function(){return"axisType"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ZoomableProperty",{get:function(){return"zoomable"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ShowZeroLineProperty",{get:function(){return"showZeroLine"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ShowGridLinesProperty",{get:function(){return"showGridLines"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"RangeProperty",{get:function(){return"range"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"RangeModeProperty",{get:function(){return"rangeMode"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ActualRangeProperty",{get:function(){return"actualRange"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"WindowLengthProperty",{get:function(){return"windowLength"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"WindowSlackRatioProperty",{get:function(){return"windowSlackRatio"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"SortingProperty",{get:function(){return"sorting"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"RestrictSortingComparisonToProperty",{get:function(){return"restrictSortingComparisonTo"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"SortingCriterionProperty",{get:function(){return"sortingCriterion"},enumerable:!0,configurable:!0}),b.rangesAreEqual=function(a,b){return a&&b&&a.from===b.from&&a.to===b.to},Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"title",{get:function(){return this.getPropertyValue(b.TitleProperty)},set:function(a){this.setPropertyValue(b.TitleProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showZeroLine",{get:function(){return this.getPropertyValue(b.ShowZeroLineProperty)},set:function(a){this.setPropertyValue(b.ShowZeroLineProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showGridLines",{get:function(){return this.getPropertyValue(b.ShowGridLinesProperty)},set:function(a){this.setPropertyValue(b.ShowGridLinesProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"zoomable",{get:function(){return this.getPropertyValue(b.ZoomableProperty)},set:function(a){this.setPropertyValue(b.ZoomableProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rangeMode",{get:function(){return this.getPropertyValue(b.RangeModeProperty)},set:function(a){this.setPropertyValue(b.RangeModeProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"range",{get:function(){return this.getPropertyValue(b.RangeProperty)},set:function(a){this.setPropertyValue(b.RangeProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"windowLength",{get:function(){return this.getPropertyValue(b.WindowLengthProperty)},set:function(a){this.setPropertyValue(b.WindowLengthProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"windowSlackRatio",{get:function(){return this.getPropertyValue(b.WindowSlackRatioProperty)},set:function(a){this.setPropertyValue(b.WindowSlackRatioProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"actualRange",{get:function(){return this.getPropertyValue(b.ActualRangeProperty)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"axisType",{get:function(){return this.getPropertyValue(b.AxisTypeProperty)},set:function(a){this.setPropertyValue(b.AxisTypeProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"sorting",{get:function(){return this.getPropertyValue(b.SortingProperty)},set:function(a){this.setPropertyValue(b.SortingProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"restrictSortingComparisonTo",{get:function(){return this.getPropertyValue(b.RestrictSortingComparisonToProperty)},set:function(a){this.setPropertyValue(b.RestrictSortingComparisonToProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"sortingCriterion",{get:function(){return this.getPropertyValue(b.SortingCriterionProperty)},set:function(a){this.setPropertyValue(b.SortingCriterionProperty,a)},enumerable:!0,configurable:!0}),b.prototype.setActualRange=function(a){var c=this.actualRange;b.rangesAreEqual(c,a)||this.setPropertyValue(b.ActualRangeProperty,a)},b}(a.ObservableObject);b.ChartAxisLayout=h}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(a){function c(b,d){var e=a.call(this)||this;return e.setPropertyValue(c.NameProperty,b),d&&e.setDefaultOptions(d),e.displayName||e.setPropertyValue(c.DisplayNameProperty,b),e}return __extends(c,a),Object.defineProperty(c,"NameProperty",{get:function(){return"name"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"DisplayNameProperty",{get:function(){return"displayName"},enumerable:!0,configurable:!0}),c.getValueForDimension=function(a,c){if(c)switch(a){case b.ChartAxisDimension.X:return c.x;case b.ChartAxisDimension.Y:return c.y;default:throw Error(b.Strings.Err_ChartSeries_UnsupportedChart_AxisDimension)}return null},Object.defineProperty(c.prototype,"name",{get:function(){return this.getPropertyValue(c.NameProperty)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"displayName",{get:function(){return this.getPropertyValue(c.DisplayNameProperty)},set:function(a){this.setPropertyValue(c.DisplayNameProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"firstPoint",{get:function(){return this._items.length>0?this._items[0]:null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"lastPoint",{get:function(){return this._items.length>0?this._items[this._items.length-1]:null},enumerable:!0,configurable:!0}),c.prototype.setDefaultOptions=function(a){this.displayName||(this.displayName=a.displayName),a.points&&(this.clear(),this.addRange(a.points))},c}(a.ObservableCollection);b.ChartSeries=c}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(){this._series=new a.ObservableCollection}return Object.defineProperty(b.prototype,"series",{get:function(){return this._series},enumerable:!0,configurable:!0}),b.prototype.getSeriesByName=function(a){return this._series.item(this._series.first(function(b){return b.name===a}))},b}();b.ChartDataModel=c}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function b(){this._chart=new a.ChartDataModel}return Object.defineProperty(b.prototype,"chart",{get:function(){return this._chart},enumerable:!0,configurable:!0}),b}();a.ChartAdapter=b}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.OuterLeft=0]="OuterLeft",a[a.InnerLeft=1]="InnerLeft",a[a.Center=2]="Center",a[a.OuterRight=3]="OuterRight",a[a.InnerRight=4]="InnerRight"}(c=b.ChartLegendHorizontalAnchorPoint||(b.ChartLegendHorizontalAnchorPoint={}));var d;!function(a){a[a.OuterTop=0]="OuterTop",a[a.InnerTop=1]="InnerTop",a[a.Center=2]="Center",a[a.OuterBottom=3]="OuterBottom",a[a.InnerBottom=4]="InnerBottom"}(d=b.ChartLegendVerticalAnchorPoint||(b.ChartLegendVerticalAnchorPoint={}));var e;!function(a){a[a.Horizontal=0]="Horizontal",a[a.Vertical=1]="Vertical"}(e=b.ChartLegendOrientation||(b.ChartLegendOrientation={}));var f=function(a){function b(){var b=a.call(this)||this;return b.show=!0,b.horizontalAnchor=c.OuterRight,b.verticalAnchor=d.Center,b.secondaryAxisIndicator="|",b.orientation=e.Vertical,b}return __extends(b,a),Object.defineProperty(b,"OrientationProperty",{get:function(){return"orientation"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"HorizontalAnchorProperty",{get:function(){return"horizontalAnchor"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"VerticalAnchorProperty",{get:function(){return"verticalAnchor"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ShowProperty",{get:function(){return"show"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"SecondaryAxisIndicatorProperty",{get:function(){return"secondaryAxisIndicator"},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"show",{get:function(){return this.getPropertyValue(b.ShowProperty)},set:function(a){this.setPropertyValue(b.ShowProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"secondaryAxisIndicator",{get:function(){return this.getPropertyValue(b.SecondaryAxisIndicatorProperty)},set:function(a){this.setPropertyValue(b.SecondaryAxisIndicatorProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"horizontalAnchor",{get:function(){return this.getPropertyValue(b.HorizontalAnchorProperty)},set:function(a){this.setPropertyValue(b.HorizontalAnchorProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"verticalAnchor",{get:function(){return this.getPropertyValue(b.VerticalAnchorProperty)},set:function(a){this.setPropertyValue(b.VerticalAnchorProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"orientation",{get:function(){return this.getPropertyValue(b.OrientationProperty)},set:function(a){this.setPropertyValue(b.OrientationProperty,a)},enumerable:!0,configurable:!0}),b}(a.ObservableObject);b.ChartLegendLayout=f}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.Horizontal=0]="Horizontal",a[a.Vertical=1]="Vertical"}(c=b.ChartBarOrientation||(b.ChartBarOrientation={}));var d;!function(a){a[a.None=0]="None",a[a.Value=1]="Value",a[a.Text=2]="Text"}(d=b.ChartBarInfo||(b.ChartBarInfo={}));var e=function(a){function b(){var b=a.call(this)||this;return b.orientation=c.Vertical,b.barInfo=d.None,b}return __extends(b,a),Object.defineProperty(b,"OrientationProperty",{get:function(){return"orientation"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"BarInfoProperty",{get:function(){return"barInfo"},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"orientation",{get:function(){return this.getPropertyValue(b.OrientationProperty)},set:function(a){this.setPropertyValue(b.OrientationProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"barInfo",{get:function(){return this.getPropertyValue(b.BarInfoProperty)},set:function(a){this.setPropertyValue(b.BarInfoProperty,a)},enumerable:!0,configurable:!0}),b}(a.ObservableObject);b.ChartBarSeriesLayout=e}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.Linear=0]="Linear",a[a.Spline=1]="Spline",a[a.HV=2]="HV",a[a.VH=3]="VH"}(c=b.ChartScatterLineInterpolation||(b.ChartScatterLineInterpolation={}));var d;!function(a){a[a.Lines=0]="Lines",a[a.Markers=1]="Markers",a[a.LinesAndMarkers=2]="LinesAndMarkers"}(d=b.ChartScatterDrawMode||(b.ChartScatterDrawMode={}));var e;!function(a){a[a.None=0]="None",a[a.ToZeroY=1]="ToZeroY",a[a.ToZeroX=2]="ToZeroX",a[a.ToNextY=3]="ToNextY",a[a.ToNextX=4]="ToNextX"}(e=b.ChartScatterFillMode||(b.ChartScatterFillMode={}));var f;!function(a){a[a.Circle=0]="Circle",a[a.Square=1]="Square",a[a.Diamond=2]="Diamond",a[a.Cross=3]="Cross",a[a.X=4]="X",a[a.TriangleUp=5]="TriangleUp",a[a.TriangleDown=6]="TriangleDown"}(f=b.ChartScatterMarkerSymbol||(b.ChartScatterMarkerSymbol={}));var g=function(a){function b(){var b=a.call(this)||this;return b.drawMode=d.LinesAndMarkers,b.lineSize=4,b.lineInterpolation=c.Spline,b.fillMode=e.None,b.markerSymbol=f.Circle,b.markerFilled=!0,b.markerSize=6,b}return __extends(b,a),Object.defineProperty(b,"LineSizeProperty",{get:function(){return"lineSize"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"LineInterpolationProperty",{get:function(){return"lineInterpolation"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"DrawModeProperty",{get:function(){return"drawMode"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"FillModeProperty",{get:function(){return"fillMode"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"MarkerSymbolProperty",{get:function(){return"markerSymbol"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"MarkerFilledProperty",{get:function(){return"markerFilled"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"MarkerSizeProperty",{get:function(){return"markerSize"},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"drawMode",{get:function(){return this.getPropertyValue(b.DrawModeProperty)},set:function(a){this.setPropertyValue(b.DrawModeProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"lineSize",{get:function(){return this.getPropertyValue(b.LineSizeProperty)},set:function(a){this.setPropertyValue(b.LineSizeProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"lineInterpolation",{get:function(){return this.getPropertyValue(b.LineInterpolationProperty)},set:function(a){this.setPropertyValue(b.LineInterpolationProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fillMode",{get:function(){return this.getPropertyValue(b.FillModeProperty)},set:function(a){this.setPropertyValue(b.FillModeProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"markerSymbol",{get:function(){return this.getPropertyValue(b.MarkerSymbolProperty)},set:function(a){this.setPropertyValue(b.MarkerSymbolProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"markerFilled",{get:function(){return this.getPropertyValue(b.MarkerFilledProperty)},set:function(a){this.setPropertyValue(b.MarkerFilledProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"markerSize",{get:function(){return this.getPropertyValue(b.MarkerSizeProperty)},set:function(a){this.setPropertyValue(b.MarkerSizeProperty,a)},enumerable:!0,configurable:!0}),b}(a.ObservableObject);b.ChartScatterSeriesLayout=g}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.None=0]="None",a[a.Percent=1]="Percent",a[a.Value=2]="Value",a[a.Text=3]="Text"}(c=b.ChartPieSliceInfo||(b.ChartPieSliceInfo={}));var d=function(a){function b(){var b=a.call(this)||this;return b.sliceInfo=c.Percent,b.hole=.57,b}return __extends(b,a),Object.defineProperty(b,"SliceInfoProperty",{get:function(){return"sliceInfo"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"HoleProperty",{get:function(){return"hole"},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"sliceInfo",{get:function(){return this.getPropertyValue(b.SliceInfoProperty)},set:function(a){this.setPropertyValue(b.SliceInfoProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"hole",{get:function(){return this.getPropertyValue(b.HoleProperty)},set:function(a){this.setPropertyValue(b.HoleProperty,a)},enumerable:!0,configurable:!0}),b}(a.ObservableObject);b.ChartPieSeriesLayout=d}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.World=0]="World",a[a.USA=1]="USA",a[a.Europe=2]="Europe",a[a.Asia=3]="Asia",a[a.Africa=4]="Africa",a[a.NorthAmerica=5]="NorthAmerica",a[a.SouthAmerica=6]="SouthAmerica"}(c=b.GeoMap||(b.GeoMap={}));var d;!function(a){a[a.ISO=0]="ISO",a[a.State=1]="State",a[a.Name=2]="Name"}(d=b.LocationMode||(b.LocationMode={}));var e=function(a){function b(){var b=a.call(this)||this;return b.map=c.World,b.lowerColor="#d74641",b.higherColor="#00a5e6",b.landColor=null,b.oceanColor="#304050",b.useGradient=!1,b.locationMode=d.ISO,b.showOcean=!1,b}return __extends(b,a),Object.defineProperty(b,"MapProperty",{get:function(){return"map"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"LocationModeProperty",{get:function(){return"locationMode"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"LandColorProperty",{get:function(){return"landColor"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OceanColorProperty",{get:function(){return"oceanColor"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"LowerColorProperty",{get:function(){return"lowerColor"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"HigherColorProperty",{get:function(){return"higherColor"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"UseGradientProperty",{get:function(){return"useGradient"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ShowOceanProperty",{get:function(){return"showOcean"},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"map",{get:function(){return this.getPropertyValue(b.MapProperty)},set:function(a){this.setPropertyValue(b.MapProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"locationMode",{get:function(){return this.getPropertyValue(b.LocationModeProperty)},set:function(a){this.setPropertyValue(b.LocationModeProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"oceanColor",{get:function(){return this.getPropertyValue(b.OceanColorProperty)},set:function(a){this.setPropertyValue(b.OceanColorProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"landColor",{get:function(){return this.getPropertyValue(b.LandColorProperty)},set:function(a){this.setPropertyValue(b.LandColorProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"lowerColor",{get:function(){return this.getPropertyValue(b.LowerColorProperty)},set:function(a){this.setPropertyValue(b.LowerColorProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"higherColor",{get:function(){return this.getPropertyValue(b.HigherColorProperty)},set:function(a){this.setPropertyValue(b.HigherColorProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"useGradient",{get:function(){return this.getPropertyValue(b.UseGradientProperty)},set:function(a){this.setPropertyValue(b.UseGradientProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showOcean",{get:function(){return this.getPropertyValue(b.ShowOceanProperty)},set:function(a){this.setPropertyValue(b.ShowOceanProperty,a)},enumerable:!0,configurable:!0}),b}(a.ObservableObject);b.ChartGeoSeriesLayout=e}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.None=0]="None",a[a.SuspectedOutliers=1]="SuspectedOutliers",a[a.Outliers=2]="Outliers",a[a.All=3]="All"}(c=b.BoxPoints||(b.BoxPoints={}));var d=function(a){function b(){var b=a.call(this)||this;return b.showPoints=c.None,b.tooltips=[],b}return __extends(b,a),Object.defineProperty(b,"PointsProperty",{get:function(){return"showPoints"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"TooltipsProperty",{get:function(){return"tooltips"},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showPoints",{get:function(){return this.getPropertyValue(b.PointsProperty);
},set:function(a){this.setPropertyValue(b.PointsProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"tooltips",{get:function(){return this.getPropertyValue(b.TooltipsProperty)},set:function(a){this.setPropertyValue(b.TooltipsProperty,a)},enumerable:!0,configurable:!0}),b}(a.ObservableObject);b.ChartBoxSeriesLayout=d}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),Object.defineProperty(b,"IncreasingColorProperty",{get:function(){return"increasingColor"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"DecreasingColorProperty",{get:function(){return"decreasingColor"},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"increasingColor",{get:function(){return this.getPropertyValue(b.IncreasingColorProperty)},set:function(a){this.setPropertyValue(b.IncreasingColorProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"decreasingColor",{get:function(){return this.getPropertyValue(b.DecreasingColorProperty)},set:function(a){this.setPropertyValue(b.DecreasingColorProperty,a)},enumerable:!0,configurable:!0}),b}(a.ObservableObject);b.ChartCandlestickSeriesLayout=c}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.Bar=1]="Bar",a[a.Scatter=2]="Scatter",a[a.Pie=3]="Pie",a[a.Tree=4]="Tree",a[a.Bubble=5]="Bubble",a[a.ScatterGeo=6]="ScatterGeo",a[a.BoxPlot=7]="BoxPlot",a[a.CandleStick=8]="CandleStick"}(c=b.ChartPlotType||(b.ChartPlotType={}));var d=function(a){function d(b){var d=a.call(this)||this;return d._seriesName=b,d.show=!0,d.showInLegend=!0,d.showHoverInfo=!0,d.hoverInfo={showX:!0,showY:!0},d.plotType=c.Bar,d.axisXIndex=1,d.axisYIndex=1,d.opacity=.9,d.markerSize=6,d.fontSize=12,d.color=null,d}return __extends(d,a),Object.defineProperty(d,"ShowProperty",{get:function(){return"show"},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ShowInLegendProperty",{get:function(){return"showInLegend"},enumerable:!0,configurable:!0}),Object.defineProperty(d,"OpacityProperty",{get:function(){return"opacity"},enumerable:!0,configurable:!0}),Object.defineProperty(d,"PlotTypeProperty",{get:function(){return"plotType"},enumerable:!0,configurable:!0}),Object.defineProperty(d,"MarkerSizeProperty",{get:function(){return"markerSize"},enumerable:!0,configurable:!0}),Object.defineProperty(d,"AxisXIndexProperty",{get:function(){return"axisXIndex"},enumerable:!0,configurable:!0}),Object.defineProperty(d,"AxisYIndexProperty",{get:function(){return"axisYIndex"},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ColorProperty",{get:function(){return"color"},enumerable:!0,configurable:!0}),Object.defineProperty(d,"ShowHoverInfoProperty",{get:function(){return"showHoverInfo"},enumerable:!0,configurable:!0}),Object.defineProperty(d,"HoverInfoProperty",{get:function(){return"hoverInfo"},enumerable:!0,configurable:!0}),Object.defineProperty(d,"FontSizeProperty",{get:function(){return"fontSize"},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"seriesName",{get:function(){return this._seriesName},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"scatter",{get:function(){return this._scatterLayout||(this._scatterLayout=this.trackSubObservable(new b.ChartScatterSeriesLayout))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"bar",{get:function(){return this._barLayout||(this._barLayout=this.trackSubObservable(new b.ChartBarSeriesLayout))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"pie",{get:function(){return this._pieLayout||(this._pieLayout=this.trackSubObservable(new b.ChartPieSeriesLayout))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"geo",{get:function(){return this._geoLayout||(this._geoLayout=this.trackSubObservable(new b.ChartGeoSeriesLayout))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"box",{get:function(){return this._boxLayout||(this._boxLayout=this.trackSubObservable(new b.ChartBoxSeriesLayout))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"candlestick",{get:function(){return this._candlestickLayout||(this._candlestickLayout=this.trackSubObservable(new b.ChartCandlestickSeriesLayout))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"showInLegend",{get:function(){return this.getPropertyValue(d.ShowInLegendProperty)},set:function(a){this.setPropertyValue(d.ShowInLegendProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"show",{get:function(){return this.getPropertyValue(d.ShowProperty)},set:function(a){this.setPropertyValue(d.ShowProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"fontSize",{get:function(){return this.getPropertyValue(d.FontSizeProperty)},set:function(a){this.setPropertyValue(d.FontSizeProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"opacity",{get:function(){return this.getPropertyValue(d.OpacityProperty)},set:function(a){a=Math.max(.1,Math.min(a,1)),this.setPropertyValue(d.OpacityProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"color",{get:function(){return this.getPropertyValue(d.ColorProperty)},set:function(a){this.setPropertyValue(d.ColorProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"plotType",{get:function(){return this.getPropertyValue(d.PlotTypeProperty)},set:function(a){this.setPropertyValue(d.PlotTypeProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"markerSize",{get:function(){return this.getPropertyValue(d.MarkerSizeProperty)},set:function(a){this.setPropertyValue(d.MarkerSizeProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"showHoverInfo",{get:function(){return this.getPropertyValue(d.ShowHoverInfoProperty)},set:function(a){this.setPropertyValue(d.ShowHoverInfoProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"hoverInfo",{get:function(){return this.getPropertyValue(d.HoverInfoProperty)},set:function(a){this.setPropertyValue(d.HoverInfoProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"axisXIndex",{get:function(){return this.getPropertyValue(d.AxisXIndexProperty)},set:function(a){this.setPropertyValue(d.AxisXIndexProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"axisX",{get:function(){return new b.ChartAxisId(b.ChartAxisDimension.X,this.axisXIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"axisYIndex",{get:function(){return this.getPropertyValue(d.AxisYIndexProperty)},set:function(a){this.setPropertyValue(d.AxisYIndexProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"axisY",{get:function(){return new b.ChartAxisId(b.ChartAxisDimension.Y,this.axisYIndex)},enumerable:!0,configurable:!0}),d}(a.ObservableObject);b.ChartSeriesLayout=d}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.Group=0]="Group",a[a.Stack=1]="Stack"}(c=b.ChartStackablePlotArrangement||(b.ChartStackablePlotArrangement={}));var d=function(a){function b(b,c){var d=a.call(this,c.owner,c.propertyName,c.newValue,c.oldValue)||this;return d.seriesLayout=b,d}return __extends(b,a),b}(a.PropertyChangedEventArgs);b.ChartSeriesLayoutPropertyChangedEventArgs=d;var e=function(a){function b(b,c){var d=a.call(this,c.owner,c.propertyName,c.newValue,c.oldValue)||this;return d.axisLayout=b,d}return __extends(b,a),b}(a.PropertyChangedEventArgs);b.ChartAxisLayoutPropertyChangedEventArgs=e;var f;!function(a){a[a.None=0]="None",a[a.Outline=1]="Outline"}(f=b.ChartSelectionHighlightMode||(b.ChartSelectionHighlightMode={}));var g;!function(a){a[a.zoom=0]="zoom",a[a.pan=1]="pan",a[a.select=2]="select",a[a.lasso=3]="lasso"}(g=b.DragMode||(b.DragMode={}));var h=function(h){function i(){var b=h.call(this)||this;return b._seriesLayouts={},b._axisLayouts={},b._seriesLayoutPropertyChanged=new a.Event,b._axisLayoutPropertyChanged=new a.Event,b.isActive=!1,b.freezeData=!1,b.fontSize=12,b.stackablePlotArrangement=c.Group,b.flipAxes=!1,b.dragmode=g.zoom,b.isEditable=!1,b.canEditTitles={x:!0,y:!0,x2:!0,y2:!0,main:!0},b.selection=[],b.selectionHighlightMode=f.Outline,b.selectionOutlineSize=2,b.selectionOutlineColor=null,b.selectOnClick=!1,b}return __extends(i,h),Object.defineProperty(i,"SelectOnClickProperty",{get:function(){return"selectOnClick"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"SelectionProperty",{get:function(){return"selection"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"SelectionOutlineColorProperty",{get:function(){return"selectionOutlineColor"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"SelectionOutlineSizeProperty",{get:function(){return"selectionOutlineSize"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"SelectionHighlightModeProperty",{get:function(){return"selectionHighlightMode"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsEditableProperty",{get:function(){return"isEditable"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"CanEditTitlesProperty",{get:function(){return"canEditTitles"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"StackablePlotArrangementProperty",{get:function(){return"stackablePlotArrangement"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsActiveProperty",{get:function(){return"isActive"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FreezeDataProperty",{get:function(){return"freezeData"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"TitleProperty",{get:function(){return"title"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FontSizeProperty",{get:function(){return"fontSize"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FlipAxesProperty",{get:function(){return"flipAxes"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"DragmodeProperty",{get:function(){return"dragmode"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"MarginsProperty",{get:function(){return"margins"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectOnClick",{get:function(){return this.getPropertyValue(i.SelectOnClickProperty)},set:function(a){this.setPropertyValue(i.SelectOnClickProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selection",{get:function(){return this.getPropertyValue(i.SelectionProperty)||[]},set:function(a){a=a||[];var b=this.selection;(b.length>0||a.length>0)&&this.setPropertyValue(i.SelectionProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectionOutlineColor",{get:function(){return this.getPropertyValue(i.SelectionOutlineColorProperty)},set:function(a){this.setPropertyValue(i.SelectionOutlineColorProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectionOutlineSize",{get:function(){return this.getPropertyValue(i.SelectionOutlineSizeProperty)},set:function(a){this.setPropertyValue(i.SelectionOutlineSizeProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectionHighlightMode",{get:function(){return this.getPropertyValue(i.SelectionHighlightModeProperty)},set:function(a){this.setPropertyValue(i.SelectionHighlightModeProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isEditable",{get:function(){return this.getPropertyValue(i.IsEditableProperty)},set:function(a){this.setPropertyValue(i.IsEditableProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canEditTitles",{get:function(){return this.getPropertyValue(i.CanEditTitlesProperty)},set:function(a){this.setPropertyValue(i.CanEditTitlesProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"legend",{get:function(){return this._legendLayout||(this._legendLayout=this.trackSubObservable(new b.ChartLegendLayout))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stackablePlotArrangement",{get:function(){return this.getPropertyValue(i.StackablePlotArrangementProperty)},set:function(a){this.setPropertyValue(i.StackablePlotArrangementProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flipAxes",{get:function(){return this.getPropertyValue(i.FlipAxesProperty)},set:function(a){this.setPropertyValue(i.FlipAxesProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dragmode",{get:function(){return this.getPropertyValue(i.DragmodeProperty)},set:function(a){this.setPropertyValue(i.DragmodeProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isActive",{get:function(){return this.getPropertyValue(i.IsActiveProperty)},set:function(a){this.setPropertyValue(i.IsActiveProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"freezeData",{get:function(){return this.getPropertyValue(i.FreezeDataProperty)},set:function(a){this.setPropertyValue(i.FreezeDataProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"title",{get:function(){return this.getPropertyValue(i.TitleProperty)},set:function(a){this.setPropertyValue(i.TitleProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fontSize",{get:function(){return this.getPropertyValue(i.FontSizeProperty)},set:function(a){this.setPropertyValue(i.FontSizeProperty,a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"margins",{get:function(){var a=this.getPropertyValue(i.MarginsProperty)||{left:null,top:null,bottom:null,right:null};return a},set:function(a){this.setPropertyValue(i.MarginsProperty,a)},enumerable:!0,configurable:!0}),i.prototype.series=function(a){var c=this._seriesLayouts[a];return c||(c=new b.ChartSeriesLayout(a),c.propertyChanged.add(this.handleSeriesLayoutPropertyChanged,this),this._seriesLayouts[a]=c),c},i.prototype.axis=function(a){var c=a.toString(),d=this._axisLayouts[c];return d||(d=new b.ChartAxisLayout(a),d.propertyChanged.add(this.handleAxisLayoutPropertyChanged,this),this._axisLayouts[c]=d),d},Object.defineProperty(i.prototype,"seriesLayoutPropertyChanged",{get:function(){return this._seriesLayoutPropertyChanged},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"axisLayoutPropertyChanged",{get:function(){return this._axisLayoutPropertyChanged},enumerable:!0,configurable:!0}),i.prototype.handleSeriesLayoutPropertyChanged=function(a,b){this._seriesLayoutPropertyChanged.raise(this,new d(a,b))},i.prototype.handleAxisLayoutPropertyChanged=function(a,b){this._axisLayoutPropertyChanged.raise(this,new e(a,b))},i}(a.ObservableObject);b.ChartLayout=h}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d){this.axisId=a,this.newRange=b,this.oldRange=c,this.fractionalRange=d}return a}();a.ChartZoomInfo=b}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function b(a,b,c){this._pre=c,this._reset=b,this._info=a||[]}return Object.defineProperty(b.prototype,"pre",{get:function(){return this._pre},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"reset",{get:function(){return this._reset},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"info",{get:function(){return this._info},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"userHandled",{get:function(){return this._userHandled},set:function(b){if(!this.pre)throw new Error(a.Strings.Err_ChartRendFeedBack_Can_OnlyMark_As_HandledPreEvents);this._userHandled=b},enumerable:!0,configurable:!0}),b}();a.ChartZoomEventArgs=b}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.Left=0]="Left",a[a.Middle=1]="Middle",a[a.Right=2]="Right"}(b=a.MouseButton||(a.MouseButton={}));var c=function(){function a(){this.mouseButton=b.Left}return a}();a.ChartSeriesPointSelectedEventArgs=c}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(){this._zoom=new a.Event,this._seriesPointSelected=new a.Event,this._chartSizeChanged=new a.Event}return Object.defineProperty(b.prototype,"seriesPointSelected",{get:function(){return this._seriesPointSelected},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"zoom",{get:function(){return this._zoom},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"chartSizeChanged",{get:function(){return this._chartSizeChanged},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"plotAreaWidth",{get:function(){return this._feedbackImpl?this._feedbackImpl.plotAreaWidth:null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"plotAreaHeight",{get:function(){return this._feedbackImpl?this._feedbackImpl.plotAreaHeight:null},enumerable:!0,configurable:!0}),b.prototype.setFeedbackImpl=function(a){this._feedbackImpl=a},b}();b.ChartRendererFeedback=c}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(a){function b(b,c){var d=a.call(this,b,c.propertyName,c.newValue,c.oldValue)||this;return d.series=b,d}return __extends(b,a),b}(a.PropertyChangedEventArgs);b.ChartSeriesPropertyChangedEventArgs=c;var d=function(){function a(){this.dmCleared=!1,this.addedSeries=[],this.removedSeries=[],this.updatedSeries=[],this.updatedSeriesArgs=[]}return a}();b.ChartSeriesDataChangedEventArgs=d;var e=function(){function e(a,c){this._updateCounter=0,this._updateSince=0,this._isDisposed=!1,this._chart=a,this._container=c,this._cdi=new b.CategorizedChartDataIndexer,this._layout=new b.ChartLayout,this.subscribeToLayoutChanges(!0)}return e.round=function(a,b){return Number(Math.round(a+"e"+b)+"e-"+b)},Object.defineProperty(e.prototype,"stats",{get:function(){return{updatesPerSecond:e.round(1e3*this._updateCounter/(Date.now()-this._updateSince),2)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataIndexer",{get:function(){return this._cdi},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chart",{get:function(){return this._chart},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),e.prototype.clearContainer=function(){this._container.innerHTML=""},e.prototype.isDisposed=function(){return this._isDisposed},e.prototype.dispose=function(){this._isDisposed||(this.stop(),this.unsubscribeFromLayoutChanges(!0),this.layout=null,this._chart=null,this._isDisposed=!0)},Object.defineProperty(e.prototype,"feedback",{get:function(){return this._feedback},set:function(a){var b=this._feedback;a!==b&&(this._feedback=a,this.onRendererFeeedbackChanged(a,b))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layout",{get:function(){return this._layout},set:function(b){this.unsubscribeFromLayoutChanges(!0),this._layout=b,b&&(this.subscribeToLayoutChanges(!0),this.onChartLayoutPropertyChanged(a.PropertyChangedEventArgs.Empty))},enumerable:!0,configurable:!0}),e.prototype.getSeriesLayouts=function(){var a=this;return this._chart.series.map(function(b){return a._layout.series(b.name)})},e.prototype.getShownSeriesLayoutsWithPlotType=function(a,b){return void 0===b&&(b=!1),this.getSeriesLayouts().filter(function(c){return(c.show||b&&c.showInLegend)&&c.plotType===a})},e.prototype.getShownSeriesLayoutsOnAxis=function(a,b){var c=this;return void 0===b&&(b=!1),this.getSeriesLayouts().filter(function(d){return c.seriesBelongsToAxis(d,a,b)})},e.prototype.getShownSeriesOnAxis=function(a,b){var c=this;return void 0===b&&(b=!1),this._chart.series.filter(function(d){return c.seriesBelongsToAxis(c._layout.series(d.name),a,b)})},e.prototype.getActualRange=function(a){return this.onGetActualRange(a)},e.prototype.resizeRequested=function(){this.onResizeRequested()},e.prototype.onResizeRequested=function(){},e.prototype.onGetActualRange=function(a){return{from:0,to:0}},e.prototype.onChartLayoutPropertyChanged=function(c){if(c===a.PropertyChangedEventArgs.Empty&&null!=c.newValue||c.propertyName===b.ChartLayout.IsActiveProperty){var d=this.layout&&this.layout.isActive;d?this.start():this.stop()}else c===a.PropertyChangedEventArgs.Empty&&null==c.newValue&&this.updateCategorizedIndex()},e.prototype.onRendererFeeedbackChanged=function(a,b){},e.prototype.onChartSeriesPropertyChanged=function(a){},e.prototype.onChartSeriesLayoutPropertyChanged=function(a){},e.prototype.onChartAxisLayoutPropertyChanged=function(a){switch(a.propertyName){case b.ChartAxisLayout.SortingProperty:case b.ChartAxisLayout.RestrictSortingComparisonToProperty:case b.ChartAxisLayout.SortingCriterionProperty:this.updateCategorizedIndex()}},e.prototype.onChartSeriesDataChanged=function(a){this.isStarted&&(this.updateStats(),this.updateCategorizedIndex(a))},e.prototype.start=function(){this._isStarted||(this._isStarted=!0,this.onStarted()),this._layout&&!this._layout.isActive&&(this._layout.isActive=!0)},e.prototype.stop=function(){this._isStarted&&(this._isStarted=!1,this.onStopped()),this._layout&&this._layout.isActive&&(this._layout.isActive=!1)},e.prototype.onStarted=function(){var a=this._chart.series.items();this.subscribeToSeriesDataChanges(a),this._chart.series.itemsChanged.add(this.handleSeriesCollectionChanged,this),this.unsubscribeFromLayoutChanges(!1),this.subscribeToLayoutChanges(!1);var b=new d;b.dmCleared=!0,b.addedSeries=a,this.updateCategorizedIndex(b)},e.prototype.onStopped=function(){this._chart.series.itemsChanged.remove(this.handleSeriesCollectionChanged,this),this.unsubscribeFromSeriesDataChanges(this._chart.series.items()),this.unsubscribeFromLayoutChanges(!1)},e.prototype.seriesBelongsToAxis=function(a,c,d){return a.plotType!==b.ChartPlotType.Pie&&(a.show||d&&a.showInLegend)&&(!c||c.dimension===b.ChartAxisDimension.Y&&c.index===a.axisYIndex||c.dimension===b.ChartAxisDimension.X&&c.index===a.axisXIndex)},e.prototype.subscribeToLayoutChanges=function(a){this._layout&&(a&&this._layout.propertyChanged.add(this.handleChartLayoutPropertyChanged,this),this._layout.seriesLayoutPropertyChanged.add(this.handleChartSeriesLayoutPropertyChanged,this),this._layout.axisLayoutPropertyChanged.add(this.handleChartAxisLayoutPropertyChanged,this))},e.prototype.unsubscribeFromLayoutChanges=function(a){this._layout&&(a&&this._layout.propertyChanged.remove(this.handleChartLayoutPropertyChanged,this),this._layout.seriesLayoutPropertyChanged.remove(this.handleChartSeriesLayoutPropertyChanged,this),this._layout.axisLayoutPropertyChanged.remove(this.handleChartAxisLayoutPropertyChanged,this))},e.prototype.subscribeToSeriesDataChanges=function(a){var b=this;a.forEach(function(a){a.itemsChanged.add(b.handleSeriesPointsCollectionChanged,b),a.propertyChanged.add(b.handleSeriesPropertyChanged,b)})},e.prototype.unsubscribeFromSeriesDataChanges=function(a){var b=this;a.forEach(function(a){a.itemsChanged.remove(b.handleSeriesPointsCollectionChanged,b),a.propertyChanged.remove(b.handleSeriesPropertyChanged,b)})},e.prototype.handleSeriesCollectionChanged=function(a,b){this.unsubscribeFromSeriesDataChanges(b.oldItems),this.subscribeToSeriesDataChanges(b.newItems);var c=new d;c.addedSeries=b.newItems,c.removedSeries=b.oldItems,c.dmCleared=b.cleared,this.onChartSeriesDataChanged(c)},e.prototype.handleSeriesPointsCollectionChanged=function(a,c){if(!this._chart.series.contains(a))throw new Error(b.Strings.Err_ChartRender_Received_UpdateFrom_UnknownSeries);if(!this.layout||!this.layout.freezeData){var e=new d;e.updatedSeries=[a],e.updatedSeriesArgs=[c],this.onChartSeriesDataChanged(e)}},e.prototype.handleChartLayoutPropertyChanged=function(a,b){this.onChartLayoutPropertyChanged(b)},e.prototype.handleSeriesPropertyChanged=function(a,b){this.onChartSeriesPropertyChanged(new c(a,b))},e.prototype.handleChartSeriesLayoutPropertyChanged=function(a,b){this.onChartSeriesLayoutPropertyChanged(b)},e.prototype.handleChartAxisLayoutPropertyChanged=function(a,b){this.onChartAxisLayoutPropertyChanged(b)},e.prototype.updateStats=function(){!this._updateSince||this._updateCounter>20?(this._updateSince=Date.now(),this._updateCounter=0):this._updateCounter++},e.prototype.updateCategorizedIndex=function(a){var c=this;a&&(a.dmCleared&&this._cdi.clear(),a.addedSeries.forEach(function(a){c._cdi.addSeries(a)}),a.dmCleared||a.removedSeries.forEach(function(a){c._cdi.removeSeries(a)}));var d=this.layout.axis(b.ChartAxisId.X1);this._cdi.sortCriterion=this.getSortingCriterion(d),this._cdi.restrictComparisonTo=d.restrictSortingComparisonTo},e.prototype.getSortingCriterion=function(a){switch(a.sorting){case b.ChartCategorySortingMode.CategoryNameAscending:return b.SeriesPointsSortCriteria.alphabeticalAscending;case b.ChartCategorySortingMode.CategoryNameDescending:return b.SeriesPointsSortCriteria.alphabeticalDescending;case b.ChartCategorySortingMode.YValueAscending:return b.SeriesPointsSortCriteria.valueSumAscending;case b.ChartCategorySortingMode.YValueDescending:return b.SeriesPointsSortCriteria.valueSumDescending;case b.ChartCategorySortingMode.Custom:return a.sortingCriterion;default:return null}},e}();b.ChartRenderer=e}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){}return a.treemapMultidimensional=function(b,c,d,e,f){e="undefined"==typeof e?0:e,f="undefined"==typeof f?0:f;var g,h,i=[],j=[];if(a.isArray(b[0])){for(h=0;h<b.length;h++)i[h]=this.sumMultidimensionalArray(b[h]);for(g=a.treemapSingledimensional(i,c,d,e,f),h=0;h<b.length;h++)j.push(this.treemapMultidimensional(b[h],g[h][2]-g[h][0],g[h][3]-g[h][1],g[h][0],g[h][1]))}else j=this.treemapSingledimensional(b,c,d,e,f);return j},a.treemapSingledimensional=function(b,d,e,f,g){f="undefined"==typeof f?0:f,g="undefined"==typeof g?0:g;var h=a.squarify(a.normalize(b,d*e),[],new c(f,g,d,e),[]);return a.flattenTreemap(h)},a.normalize=function(b,c){var d,e=[],f=a.sumArray(b),g=c/f;for(d=0;d<b.length;d++)e[d]=b[d]*g;return e},a.flattenTreemap=function(a){var b,c,d=[];for(b=0;b<a.length;b++)for(c=0;c<a[b].length;c++)d.push(a[b][c]);return d},a.squarify=function(b,c,d,e){var f,g,h;return 0===b.length?void e.push(d.getCoordinates(c)):(f=d.shortestEdge(),g=b[0],a.improvesRatio(c,g,f)?(c.push(g),this.squarify(b.slice(1),c,d,e)):(h=d.cutArea(a.sumArray(c),e),e.push(d.getCoordinates(c)),this.squarify(b,[],h,e)),e)},a.improvesRatio=function(b,c,d){var e;if(0===b.length)return!0;e=b.slice(),e.push(c);var f=a.calculateRatio(b,d),g=a.calculateRatio(e,d);return f>=g},a.calculateRatio=function(b,c){var d=Math.min.apply(Math,b),e=Math.max.apply(Math,b),f=a.sumArray(b);return Math.max(Math.pow(c,2)*e/Math.pow(f,2),Math.pow(f,2)/(Math.pow(c,2)*d))},a.isArray=function(a){return a&&a.constructor===Array},a.sumArray=function(a){var b,c=0;for(b=0;b<a.length;b++)c+=a[b];return c},a.sumMultidimensionalArray=function(b){var c,d=0;if(a.isArray(b[0]))for(c=0;c<b.length;c++)d+=this.sumMultidimensionalArray(b[c]);else d=a.sumArray(b);return d},a}();a.Treemap=b;var c=function(){function a(a,b,c,d){this.xoffset=a,this.yoffset=b,this.height=d,this.width=c}return a.prototype.getCoordinates=function(a){var c,d=[],e=this.xoffset,f=this.yoffset,g=b.sumArray(a)/this.height,h=b.sumArray(a)/this.width;if(this.width>=this.height)for(c=0;c<a.length;c++)d.push([e,f,e+g,f+a[c]/g]),f+=a[c]/g;else for(c=0;c<a.length;c++)d.push([e,f,e+a[c]/h,f+h]),e+=a[c]/h;return d},a.prototype.cutArea=function(b){var c;if(this.width>=this.height){var d=b/this.height,e=this.width-d;c=new a(this.xoffset+d,this.yoffset,e,this.height)}else{var f=b/this.width,g=this.height-f;c=new a(this.xoffset,this.yoffset+f,this.width,g)}return c},a.prototype.shortestEdge=function(){return Math.min(this.height,this.width)},a}()}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){}return a.Err_ObservObject_Argument_CannotBe_NullOr_Undefined="Argument cannot be null or undefined",a.Err_ObservCollection_Too_ManyItems_ToDelete="Too many items to delete",a.Err_ObservCollection_StartIndex_OutOfRange="Starting index out of range ( ${index} )",a.Err_ObervCollection_Number_OfItems_ToDelete_MustBe_AtleastOne="The number of items to delete must be at least 1",a.Err_ChartDirective_AlreadyStarted="Already started",a.Err_ChartDirective_NoFactory_ForRenderer="No factory for renderer: [${rendererName}]",a.Err_ChartSeries_UnsupportedChart_AxisDimension="Unsupported Chart Axis Dimension",a.Err_ChartRendFeedBack_Can_OnlyMark_As_HandledPreEvents="Can only mark as handled pre-events",a.Err_PlotConverter_Unsupported_Scatter_DrawMode="Unsupported Scatter draw Mode",a.Err_PlotConverter_Unsupported_ScatterLine_Interpolation="Unsupported Scatter Line Interpolation",a.Err_PlotConverter_Unsupported_Marker_Symbol="Unsupported Scatter Marker Symbol",a.Err_PlotConverter_Unsupported_AxisDimension="Unsupported Axis Dimension",a.Err_PlotConverter_Unsupported_AxisType="unsupported axis type",a.Err_PlotConverter_Unsupported_PlotType="Unsupported Plot Type",a.Err_PlotConverter_Unsupported_Map="Unsupported Map",a.Err_PlotConverter_Unsupported_Location_Mode="Unsupported Location Mode",a.Err_PlotConverter_Unsupported_Stackable_PlotArrangement="Unsupported stackable plot arrangement",a.Err_PlotConverter_UnsupportedBar_PlotOrientation="Unsupported bar plot orientation",a.Err_PlotConverter_Unsupporte_Pie_SliceInfo="Unsupported pie slice info",a.Err_ChartRender_Received_UpdateFrom_UnknownSeries="Received an update from an unknown series",a.Err_ChartRenderService_Factory_CannotBe_nullOrUndefined="Factory cannot be null or undefined",a.Err_ChartRenderService_Factory_Name_CannotBe_nullOrUndefined="Factory name cannot be null or undefined",a.Err_PlotlyChartRenderer_Unsupported_ChartAxis_RangeMode="Unsupported Chart Axis Range mode",a.Err_PlotlyChartRenderer_WindowRangeMode_NotSupported_InCategorizedAxes="Window Range Mode not supported in Categorized Axes",a.Err_PlotlyChartRenderer_Plotly_CannotBe_Null="plotly cannot be null",a}();a.Strings=b}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={})),ionweb.nodeJsExport(ionweb),ionweb.services.registerCoreSubmodule("ionwebCharts",["ionwebCore"],ionweb.charts.Strings);var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.Default=0]="Default",a[a.Up=1]="Up",a[a.Down=2]="Down"}(b=a.RoundingMode||(a.RoundingMode={}))}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){a[a.Decimal=0]="Decimal",a[a.Basispoint=1]="Basispoint",a[a.Half=2]="Half",a[a.Quarter=3]="Quarter",a[a.Eight=4]="Eight",a[a.Sixteenth=5]="Sixteenth",a[a.Tens=6]="Tens",a[a.ThirtySecond=7]="ThirtySecond"}(b=a.FormatType||(a.FormatType={}))}(b=a.Internal||(a.Internal={}))}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.Undef=-1]="Undef",a[a.Fmt0=0]="Fmt0",a[a.Fmt1=1]="Fmt1",a[a.Fmt2=2]="Fmt2",a[a.Fmt3=3]="Fmt3",a[a.Fmt4=4]="Fmt4",a[a.Fmt5=5]="Fmt5",a[a.Fmt6=6]="Fmt6",a[a.Fmt7=7]="Fmt7",a[a.Fmt8=8]="Fmt8",a[a.Fmt9=9]="Fmt9",a[a.Fmt10=10]="Fmt10",a[a.Fmt11=11]="Fmt11",a[a.Fmt12=12]="Fmt12",a[a.Fmt13=13]="Fmt13",a[a.Fmt14=14]="Fmt14",a[a.Fmt15=15]="Fmt15",a[a.Fmt20=20]="Fmt20",a[a.Fmt21=21]="Fmt21",a[a.Fmt22=22]="Fmt22",a[a.Fmt23=23]="Fmt23",a[a.Fmt24=24]="Fmt24",a[a.Fmt25=25]="Fmt25",a[a.Fmt26=26]="Fmt26",
a[a.Fmt27=27]="Fmt27",a[a.Fmt28=28]="Fmt28",a[a.Fmt29=29]="Fmt29",a[a.Fmt30=30]="Fmt30",a[a.Fmt31=31]="Fmt31",a[a.Fmt32=32]="Fmt32",a[a.Fmt33=33]="Fmt33",a[a.Fmt34=34]="Fmt34",a[a.Fmt35=35]="Fmt35",a[a.Fmt36=36]="Fmt36",a[a.Fmt37=37]="Fmt37",a[a.Fmt38=38]="Fmt38",a[a.Fmt39=39]="Fmt39",a[a.Fmt40=40]="Fmt40",a[a.Fmt41=41]="Fmt41",a[a.Fmt42=42]="Fmt42",a[a.Fmt43=43]="Fmt43",a[a.Fmt44=44]="Fmt44",a[a.Fmt45=45]="Fmt45",a[a.Fmt46=46]="Fmt46",a[a.Fmt50=50]="Fmt50",a[a.Fmt51=51]="Fmt51",a[a.Fmt53=53]="Fmt53",a[a.Fmt55=55]="Fmt55",a[a.Fmt58=58]="Fmt58",a[a.Fmt59=59]="Fmt59",a[a.Fmt60=60]="Fmt60",a[a.Fmt256=256]="Fmt256",a[a.Fmt257=257]="Fmt257",a[a.Fmt270=270]="Fmt270",a[a.Fmt271=271]="Fmt271",a[a.Fmt272=272]="Fmt272",a[a.Fmt273=273]="Fmt273",a[a.Fmt274=274]="Fmt274",a[a.Fmt275=275]="Fmt275",a[a.Fmt280=280]="Fmt280",a[a.Fmt1000=1e3]="Fmt1000",a[a.Fmt1001=1001]="Fmt1001",a[a.Fmt1002=1002]="Fmt1002",a[a.Fmt1003=1003]="Fmt1003",a[a.Fmt1004=1004]="Fmt1004",a[a.Fmt1005=1005]="Fmt1005"}(b=a.Format||(a.Format={}))}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(a){this.formatType=a}return a}();a.FormatAttribute=b}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){}return a.removeTrailingZeroes=function(a,b){var c=a.toString().split(b);if(c.length<2)return a;var d=c[0],e=c[1],f=this.removeTrailingZeroesFromFractionalPart(e);return d+b+f},a.removeTrailingZeroesFromFractionalPart=function(a){var b=a.toString();if(b.length<2)return a;var c=2,d=b.substring(c);return 0===parseInt(d)?b.substring(0,c):a},a.formatStringCM=function(a,b){var c;if(a.length<=b.length)c=b;else{var d=a.length-b.length;c=a.substring(0,d),c+=b}return c},a.format=function(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];return a._toFormattedString(arguments)},a.addThousandSeparators=function(a,b){return a&&b?a.indexOf(".")>=0?a.replace(/\d(?=(\d{3})+\.)/g,"$&"+b):a.replace(/\d(?=(\d{3})+$)/g,"$&"+b):a},a.removeThousandSeparators=function(a,b){if(!a||!b)return a;var c=b.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=new RegExp(c,"g");return a.replace(d,"")},a._toFormattedString=function(b){for(var c="",d=b[0],e=0;;){var f=d.indexOf("{",e),g=d.indexOf("}",e);if(f<0&&g<0){c+=d.slice(e);break}if(g>0&&(g<f||f<0)){if("}"!==d.charAt(g+1))throw new Error("format stringFormatBraceMismatch");c+=d.slice(e,g+1),e=g+2}else if(c+=d.slice(e,f),e=f+1,"{"!==d.charAt(e)){if(g<0)throw new Error("format stringFormatBraceMismatch");var h=d.substring(e,g),i=h.indexOf(":"),j=parseInt(i<0?h:h.substring(0,i),10)+1;if(isNaN(j))throw new Error("format stringFormatInvalid");var k=i<0?"":h.substring(i+1),l=b[j];"undefined"!=typeof l&&null!==l||(l=""),c+=k.length?a.formatStringCM(k,l):l,e=g+1}else c+="{",e++}return c},a}();a.CMString=b}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){this.fractionalSeparator="-"}return a}();a.FormattersHelperSettings=b}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function b(a,b,c,d){this.formatType=b,this.tick=c,this.name=a.name,this._formatAttribute=a,this.separator=null!=this._formatAttribute.separator&&0!==this._formatAttribute.separator.toString().length?this._formatAttribute.separator:d,this.desc=this._formatAttribute.desc,this.groupSeparator=this._formatAttribute.groupSeparator}return Object.defineProperty(b.prototype,"formatAttribute",{get:function(){return this._formatAttribute},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"regex",{get:function(){return this._formatAttribute.regex&&this._formatAttribute.regex.toString().replace("X",this.separator)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"priceTypeGroup",{get:function(){return this._formatAttribute.formatType},enumerable:!0,configurable:!0}),b.prototype.parse=function(a,b){var c=this._parse(a,b);return"number"==typeof c?c:NaN},b.prototype._parse=function(a,b){return NaN},b.prototype.format=function(b,c){return c=c||{},c.roundingMode=c.roundingMode||a.RoundingMode.Default,c.removeTrailingZeros=c.removeTrailingZeros||!1,c.disableDefaultGroupSeparator=c.disableDefaultGroupSeparator||!1,b=isNaN(b)?Number(a.CMString.removeThousandSeparators(b,this.groupSeparator)):Number(b),this._format(b,c)},b.prototype._format=function(a,b){return""},b.prototype.getFirstPart=function(a,b){var c=this.separator,d=a.toString()+c;return b&&(d=b.charAt(0)+d),d},b}();a.FormatterBase=b}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(b){var c;!function(b){var c=function(b){function c(c,d,e){var f=b.call(this,c,d,Math.pow(10,-c.decimalPlaces),e)||this;return f._numberFormattingService=a.getService("ionweb.numberFormattingService"),f.decimalPlaces=c.decimalPlaces,f._minValue=.9*Math.pow(10,-f.decimalPlaces),f}return __extends(c,b),c.prototype._parse=function(a,b){var c=this._numberFormattingService.parseNumber(a,{negativeBraces:!1,thousandSeparator:this.groupSeparator,decimalSeparator:this.separator});return"number"!=typeof c||b!==!1&&!this.validatePrice(c)?NaN:c},c.prototype._format=function(a,b){var c=this.decimalPlaces;c>15&&(c=15);var d=this._numberFormattingService.getFormattedNumber(a,{negativeBraces:!1,thousandSeparator:this.groupSeparator,decimalSeparator:this.separator,decimalPlaces:c,removeTrailingZeros:b.removeTrailingZeros,roundingMode:b.roundingMode});return a<0&&a>-this._minValue?d.substring(1):d},c.prototype.validatePrice=function(b){var c=a.MathUtils.getDecimalPowerResult(this.decimalPlaces),d=b-Math.floor(b*c+.5)/c;return Math.abs(d)<=a.MathUtils.EPSILON},c}(a.cm.FormatterBase);b.DecimalFormatter=c}(c=b.Decimals||(b.Decimals={}))}(c=b.Formatters||(b.Formatters={}))}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d;!function(c){var d=function(){function a(){}return a}();c.GetFactorsWithSignResult=d;var e=function(c){function e(){return null!==c&&c.apply(this,arguments)||this}return __extends(e,c),e.prototype._parse=function(a){var b=NaN,c=new RegExp(this.regex);return c.test(a)&&(b=this.parseValue(a)),b},e.prototype.parseValue=function(a){var b=0;if(this.separator){var c="-"===a[0]?1:0,d=a.indexOf(this.separator,c);if(d>-1){var e=c?d:d-c,f=a.substring(c,e),g=Number(f);b=this.parseValueInternal(a,g,d,this._formatAttribute),b=c?-b:b}else b=parseInt(a)}else b=parseInt(a);return b},e.prototype.parseValueInternal=function(a,c,d,e){throw new Error(b.Strings.Msg_Subclass_MustOverride_ThisMethod)},e.prototype._format=function(c,d){var e=this.formatInternal(a.MathUtils.applyFractionalRounding(c,this._formatAttribute.totalTicks,d.roundingMode),this._formatAttribute);return d.removeTrailingZeros&&this._formatAttribute.manageTrailingZeroes?b.CMString.removeTrailingZeroes(e,this.separator):e},e.prototype.formatInternal=function(a,c){throw new Error(b.Strings.Msg_Subclass_MustOverride_ThisMethod)},e.getFactorsWithSign=function(a,b,c){var e=new d,f=Math.floor(Math.abs(a)*b+.5);return f=Number(f.toFixed(0)),e.handle=Math.floor(f/b),e.fractionalTicks=f%b,e.primaryPart=Math.floor(e.fractionalTicks/c),e.secondaryPart=Math.floor(e.fractionalTicks%c),a<0&&(0!==e.handle||0!==e.primaryPart||0!==e.secondaryPart)?e.sign="-":e.sign=null,e},e.findIndex=function(a,b){return a.indexOf(b)},e.prototype.getSecondaryValue=function(a,b){var c=parseInt(b);return null!=a.lastPart&&(c=e.findIndex(a.lastPart,b)),c<0?0:c},e.getSecondaryValueFromExpression=function(a,b,c){var d=a.trim().split(b);return parseInt(d[0])*c/parseInt(d[1])},e}(b.FormatterBase);c.FractionalFormatterBase=e}(d=c.Fractionals||(c.Fractionals={}))}(c=b.Formatters||(b.Formatters={}))}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.parseValueInternal=function(c,e,f,g){var h=c.substring(f+1),i=d.getPrimaryLength(this.formatType),j=h.substring(0,Math.min(i,h.length));try{var k=a.Big(g.totalTicks),l=a.Big(g.primaryFactor),m=a.Big(e);if(this.formatType===b.Format.Fmt24)return Number(m.plus(a.Big(d.findIndex(g.lastPart,j)).div(l)));var n=parseInt(j),o=h.substring(i);return Number(m.plus(a.Big(n).div(l)).plus(a.Big(this.getSecondaryValue(g,o)).div(k)))}catch(a){return NaN}},d.prototype.formatInternal=function(a,c){var e=d.getFactorsWithSign(a,c.totalTicks,c.secondaryFactor),f=this.getFirstPart(e.handle,e.sign);return this.formatType===b.Format.Fmt24?f+b.CMString.format(c.formatString,c.lastPart[e.primaryPart]):f+b.CMString.format(c.formatString,e.primaryPart.toString(),c.lastPart[e.secondaryPart])},d.getPrimaryLength=function(a){switch(a){case b.Format.Fmt37:case b.Format.Fmt24:return 1;default:return 2}},d}(c.FractionalFormatterBase);c.QuarterFormatter=d}(d=c.Fractionals||(c.Fractionals={}))}(c=b.Formatters||(b.Formatters={}))}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.parseValueInternal=function(b,c,d,e){var f=b.substring(d+1),g=parseInt(f.substring(0,Math.min(2,f.length))),h=f.length>2?f.substring(2):"";try{return Number(a.Big(c).plus(a.Big(g).div(a.Big(e.primaryFactor))).plus(a.Big(this.getSecondaryValue(e,h)).div(a.Big(e.totalTicks))))}catch(a){return NaN}},d.prototype.formatInternal=function(a,c){var e=d.getFactorsWithSign(a,c.totalTicks,c.secondaryFactor);return this.getFirstPart(e.handle,e.sign)+b.CMString.format(c.formatString,e.primaryPart.toString(),d.getSecondaryPart(c,e.secondaryPart).toString())},d.prototype.getSecondaryValue=function(a,e){return null!=a.lastPart&&d.findIndex(a.lastPart,e)<0&&this.formatType===b.Format.Fmt273?d.getSecondaryValueFromExpression(e,"/",16):c.prototype.getSecondaryValue.call(this,a,e)},d.getSecondaryPart=function(a,b){var c=b;return null!=a.lastPart&&(c=a.lastPart[b]),c},d}(c.FractionalFormatterBase);c.SixteenthFormatter=d}(d=c.Fractionals||(c.Fractionals={}))}(c=b.Formatters||(b.Formatters={}))}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.parseValueInternal=function(c,d,e,f){var g=c.substring(e+1),h=parseInt(g),i=h,j=0;try{var k=a.Big(d);switch(this.formatType){case b.Format.Fmt30:1===g.length&&(i*=10),j=Number(k.plus(a.Big(i).div(a.Big(5*f.primaryFactor))));break;case b.Format.Fmt39:g.length<4&&(h*=a.MathUtils.getDecimalPowerResult(4-g.length));var l=a.Big(32);k=k.div(l);var m=a.Big(h).div(l);j=Number(k.plus(m.div(a.Big(f.primaryFactor))));break;case b.Format.Fmt55:j=Number(k.plus(a.Big(h).div(a.Big(f.totalTicks))))}return j}catch(a){return NaN}},d.prototype.formatInternal=function(a,c){var e=a;this.formatType===b.Format.Fmt39&&(e*=32);var f=d.getFactorsWithSign(e,c.totalTicks,c.secondaryFactor);return this.formatType===b.Format.Fmt30&&(f.primaryPart*=5),this.getFirstPart(f.handle,f.sign)+b.CMString.format(c.formatString,f.primaryPart.toString())},d}(c.FractionalFormatterBase);c.TensFormatter=d}(d=c.Fractionals||(c.Fractionals={}))}(c=b.Formatters||(b.Formatters={}))}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.parseValueInternal=function(b,c,e,f){var g=b.substring(e+1),h=d.getPrimaryLength(this.formatType),i=parseInt(g.substring(0,Math.min(h,g.length)));try{return Number(a.Big(c).plus(a.Big(i).div(a.Big(f.primaryFactor))))}catch(a){return NaN}},d.getPrimaryLength=function(a){return a===b.Format.Fmt40||a===b.Format.Fmt41?1:2},d.prototype.formatInternal=function(a,c){var e=d.getFactorsWithSign(a,c.totalTicks,c.secondaryFactor);return this.getFirstPart(e.handle,e.sign)+b.CMString.format(c.formatString,e.primaryPart.toString())},d}(c.FractionalFormatterBase);c.ThirtySecondFormatter=d}(d=c.Fractionals||(c.Fractionals={}))}(c=b.Formatters||(b.Formatters={}))}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.parseValueInternal=function(c,d,e,f){var g=c.substring(e+1).replace("+","5"),h=f.primaryFactor,i=parseInt(g.substring(0,Math.min(2,g.length))),j=g.length>2?parseInt(g.substring(2)):0;j=5===j?1:0;try{var k=a.Big(d),l=a.Big(f.totalTicks);return this.formatType===b.Format.Fmt31?(i=5===i?1:0,Number(k.plus(a.Big(i).div(l)))):Number(k.plus(a.Big(i).div(a.Big(h))).plus(a.Big(j).div(l)))}catch(a){return NaN}},d.prototype.formatInternal=function(a,c){var e=d.getFactorsWithSign(a,c.totalTicks,c.secondaryFactor);e.secondaryPart*=5;var f=this.getFirstPart(e.handle,e.sign);return this.formatType===b.Format.Fmt31?f+b.CMString.format(c.formatString,e.secondaryPart.toString()):this.formatType===b.Format.Fmt44?f+b.CMString.format(c.formatString,e.primaryPart.toString(),5===e.secondaryPart?"+":"0"):f+b.CMString.format(c.formatString,e.primaryPart.toString(),e.secondaryPart.toString())},d}(c.FractionalFormatterBase);c.HalfFormatter=d}(d=c.Fractionals||(c.Fractionals={}))}(c=b.Formatters||(b.Formatters={}))}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.parseValueInternal=function(c,d,e,f){var g=c.substring(e+1),h=0,i=g.length>2?g.substring(2):"";switch(this.formatType){case b.Format.Fmt257:i=g;break;case b.Format.Fmt280:h=parseInt(g.substring(0,Math.min(2,g.length))),i+=Array(2-i.length+1).join("0");break;default:h=parseInt(g.substring(0,Math.min(2,g.length))),"00"===i&&(i="")}try{var j=a.Big(f.totalTicks),k=a.Big(f.primaryFactor),l=a.Big(d),m=a.Big(this.getSecondaryValue(f,i));return this.formatType===b.Format.Fmt257?Number(l.div(k).plus(m.div(j))):Number(l.plus(a.Big(h).div(k)).plus(m.div(j)))}catch(a){return NaN}},d.prototype.getSecondaryValue=function(a,e){if(null!=a.lastPart&&d.findIndex(a.lastPart,e)<0){if(this.formatType===b.Format.Fmt271)return d.getSecondaryValueFromExpression(e,"/",8);if(this.formatType===b.Format.Fmt256&&"4"===e)return c.prototype.getSecondaryValue.call(this,a,"+");if(this.formatType===b.Format.Fmt270&&"04"===e.trim())return c.prototype.getSecondaryValue.call(this,a,"+")}return c.prototype.getSecondaryValue.call(this,a,e)},d.prototype.formatInternal=function(a,c){var e,f=d.getFactorsWithSign(a,c.totalTicks,c.secondaryFactor),g=f.secondaryPart.toString();switch(null!=c.lastPart&&(g=c.lastPart[f.secondaryPart]),this.formatType){case b.Format.Fmt257:f.handle=f.handle*c.primaryFactor+f.primaryPart,e=this.getFirstPart(f.handle,f.sign)+g;break;default:e=this.getFirstPart(f.handle,f.sign)+b.CMString.format(c.formatString,f.primaryPart.toString(),g)}return e},d}(c.FractionalFormatterBase);c.EightFormatter=d}(d=c.Fractionals||(c.Fractionals={}))}(c=b.Formatters||(b.Formatters={}))}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(b){var c;!function(b){var c=function(c){function d(a,d,e){var f=c.call(this,a,d,Math.pow(10,-a.decimalPlaces),e||".")||this;return f._decimalFormatter=new b.DecimalFormatter(a,d,e),f}return __extends(d,c),d.prototype._parse=function(a,b){var c=this._decimalFormatter.parse(a,b);try{isNaN(c)||(c=this.adjustByCustomMultiplier(c))}catch(a){return NaN}return c},d.prototype._format=function(a,b){return this._decimalFormatter.format(a*this._formatAttribute.customMultiplier,b)},d.prototype.adjustByCustomMultiplier=function(b){var c=a.Big(this._formatAttribute.customMultiplier);if(0===this._formatAttribute.decimalPlaces)return Number(a.Big(Math.floor(b)).div(c));var d=a.MathUtils.getDecimalPowerResult(this._formatAttribute.decimalPlaces),e=a.Big(Math.floor(b*d+.5));return Number(e.div(this._formatAttribute.customMultiplier*d))},d}(a.cm.FormatterBase);b.BasisPointFormatter=c}(c=b.Decimals||(b.Decimals={}))}(c=b.Formatters||(b.Formatters={}))}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function b(){}return b.getDecimalFormatAttribute=function(b,c,d){var e=new a.FormatAttribute(a.Internal.FormatType.Decimal);return e.desc=d,e.name=c,e.decimalPlaces=b,e},b.getHalfFormatAttribute=function(b,c,d,e,f,g,h,i){var j=new a.FormatAttribute(a.Internal.FormatType.Half);return j.desc=b,j.name=c,j.primaryFactor=d,j.secondaryFactor=e,j.totalTicks=f,j.regex=g,j.formatString=h,j.manageTrailingZeroes=i,j},b.getQuarterFormatAttribute=function(b,c,d,e,f,g,h,i,j){var k=new a.FormatAttribute(a.Internal.FormatType.Quarter);return k.desc=b,k.name=c,k.primaryFactor=d,k.secondaryFactor=e,k.totalTicks=f,k.regex=g,k.formatString=h,k.lastPart=i,k.manageTrailingZeroes=j,k},b.getEightFormatAttribute=function(b,c,d,e,f,g,h,i,j,k){var l=new a.FormatAttribute(a.Internal.FormatType.Eight);return l.desc=b,l.name=c,l.primaryFactor=d,l.secondaryFactor=e,l.totalTicks=f,l.regex=g,l.formatString=h,l.separator=i,l.lastPart=j,l.manageTrailingZeroes=k,l},b.getSixteenthFormatAttribute=function(b,c,d,e,f,g,h,i,j){var k=new a.FormatAttribute(a.Internal.FormatType.Sixteenth);return k.desc=b,k.name=c,k.primaryFactor=d,k.secondaryFactor=e,k.totalTicks=f,k.regex=g,k.formatString=h,k.lastPart=i,k.manageTrailingZeroes=j,k},b.getTensFormatAttribute=function(b,c,d,e,f,g,h){var i=new a.FormatAttribute(a.Internal.FormatType.Tens);return i.desc=b,i.name=c,i.primaryFactor=d,i.secondaryFactor=e,i.totalTicks=f,i.regex=g,i.formatString=h,i},b.getThirtySecondFormatAttribute=function(b,c,d,e,f,g,h){var i=new a.FormatAttribute(a.Internal.FormatType.ThirtySecond);return i.desc=b,i.name=c,i.primaryFactor=d,i.secondaryFactor=e,i.totalTicks=f,i.regex=g,i.formatString=h,i},b.getBasisPointFormatAttribute=function(b,c,d,e){var f=new a.FormatAttribute(a.Internal.FormatType.Basispoint);return f.desc=b,f.name=c,f.customMultiplier=d,f.decimalPlaces=e,f},b.getFormatAttribute=function(c){var d;if(void 0!==b._attributesCache[c])return b._attributesCache[c];if(c<1999||c>=4e3)switch(c){case a.Format.Undef:d=b.getDecimalFormatAttribute(0,void 0,void 0),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt0:d=b.getDecimalFormatAttribute(0,"No Decimal Digit","NNNN"),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt1:d=b.getDecimalFormatAttribute(1,"One Decimal Digit","NNNN.[0-9]"),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt2:d=b.getDecimalFormatAttribute(2,"Two Decimal Digit","NNNN.[0-99]"),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt3:d=b.getDecimalFormatAttribute(3,"Three Decimal Digit","NNNN.[0-999]"),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt4:d=b.getDecimalFormatAttribute(4,"Four Decimal Digit","NNNN.[0-9999]"),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt5:d=b.getDecimalFormatAttribute(5,"Five Decimal Digit","NNNN.[0-99999]"),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt6:d=b.getDecimalFormatAttribute(6,"Six Decimal Digit",void 0),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt7:d=b.getDecimalFormatAttribute(7,"Seven Decimal Digit",void 0),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt8:d=b.getDecimalFormatAttribute(8,"Eight Decimal Digit",void 0),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt9:d=b.getDecimalFormatAttribute(9,"Nine Decimal Digit",void 0),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt10:d=b.getDecimalFormatAttribute(10,"Ten Decimal Digit",void 0),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt11:d=b.getDecimalFormatAttribute(11,"Eleven Decimal Digit",void 0),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt12:d=b.getDecimalFormatAttribute(12,"Twelve Decimal Digit",void 0),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt13:d=b.getDecimalFormatAttribute(13,"Thirteen Decimal Digit",void 0),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt14:d=b.getDecimalFormatAttribute(14,"Fourteen Decimal Digit",void 0),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt15:d=b.getDecimalFormatAttribute(15,"Fifteen Decimal Digit",void 0),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt20:d=b.getHalfFormatAttribute("NNN.[00-99][0 5]","HALF 1/100",100,2,200,"^-?[0-9]+(X[0-9]{2}[05]?)?$","{0:00}{1:0}",!0),d.formatType=a.Internal.FormatType.Half;break;case a.Format.Fmt21:d=b.getQuarterFormatAttribute("NNN.[00-99][0 2 4 6]","1/4",100,4,400,"^-?[0-9]+(X[0-9]{2}[0246]?)?$","{0:00}{1:0}",["0","2","4","6"],!0),d.formatType=a.Internal.FormatType.Quarter;break;case a.Format.Fmt22:d=b.getQuarterFormatAttribute("NNN.[00-99][0 2 5 7]","1/4",100,4,400,"^-?[0-9]+(X[0-9]{2}[0257]?)?$","{0:00}{1:0}",["0","2","5","7"],!0),d.formatType=a.Internal.FormatType.Quarter;break;case a.Format.Fmt23:d=b.getEightFormatAttribute("NNN.[00-99][0 1 2 3 4 5 6 7]","Eights",100,8,800,"^-?[0-9]+(X[0-9]{2}[0-7]?)?$","{0:00}{1:0}",void 0,void 0,!0),d.formatType=a.Internal.FormatType.Eight;break;case a.Format.Fmt24:d=b.getQuarterFormatAttribute("NNNN.[0 2 5 7]","Modified decimal forth",4,1,4,"^-?[0-9]+(X[0257])?$","{0:0}",["0","2","5","7"],void 0),d.formatType=a.Internal.FormatType.Quarter;break;case a.Format.Fmt25:case a.Format.Fmt43:d=b.getThirtySecondFormatAttribute("NNN.[0-31]","1/32",32,1,32,"^-?[0-9]+(X(([0-2][0-9])|(3[01])))?$","{0:00}"),d.formatType=a.Internal.FormatType.ThirtySecond;break;case a.Format.Fmt26:d=b.getThirtySecondFormatAttribute("NNN.[0-63]","1/64",64,1,64,"^-?[0-9]+(X(([0-5][0-9])|(6[0-3])))?$","{0:00}"),d.formatType=a.Internal.FormatType.ThirtySecond;break;case a.Format.Fmt27:d=b.getHalfFormatAttribute("NNN.[0-31][05]","HALF 1/32",32,2,64,"^-?[0-9]+(X(([0-2][0-9])|(3[01]))[05]?)?$","{0:00}{1:0}",!0),d.formatType=a.Internal.FormatType.Half;break;case a.Format.Fmt28:d=b.getQuarterFormatAttribute("NNN.[00-31][0 2 5 7]","1/4",32,4,128,"^-?[0-9]+(X(([0-2][0-9])|(3[01]))[0257]?)?$","{0:00}{1:0}",["0","2","5","7"],!0),d.formatType=a.Internal.FormatType.Quarter;break;case a.Format.Fmt29:d=b.getHalfFormatAttribute("NNN.[0-63][05]","HALF 1/64",64,2,128,"^-?[0-9]+(X(([0-5][0-9])|(6[0-3]))[05]?)?$","{0:00}{1:0}",!0),d.formatType=a.Internal.FormatType.Half;break;case a.Format.Fmt30:d=b.getTensFormatAttribute("NNN.[00,05,10,15,....,95]","FIVES",20,1,20,"^-?[0-9]+(X[0-9][05]?)?$","{0:00}"),d.formatType=a.Internal.FormatType.Tens;break;case a.Format.Fmt31:d=b.getHalfFormatAttribute("NNNN.[0,5]","HALF POINTS",0,2,2,"^-?[0-9]+(X[05])?$","{0:0}",void 0),d.formatType=a.Internal.FormatType.Half;break;case a.Format.Fmt32:d=b.getHalfFormatAttribute("NNN.[0-99][0,5]","5/1000",100,2,200,"^-?[0-9]+(X[0-9]{2}[05]?)?$","{0:00}{1:0}",!0),d.formatType=a.Internal.FormatType.Half;break;case a.Format.Fmt33:d=b.getDecimalFormatAttribute(2,"ONE HUNDREDS","NNN.[00-99]"),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt34:d=b.getDecimalFormatAttribute(1,"TENTH","NNN.[0-9]"),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt35:d=b.getDecimalFormatAttribute(3,"TEN HUNDREDS","NNN.[0-999]"),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt36:d=b.getDecimalFormatAttribute(0,"NO DECIMALS","NNNNN"),d.formatType=a.Internal.FormatType.Decimal;break;case a.Format.Fmt37:d=b.getQuarterFormatAttribute("NNN.[0-9][0257]","Modified 1/40",10,4,40,"^-?[0-9]+(X[0-9][0257]?)?$","{0:0}{1:0}",["0","2","5","7"],void 0),d.formatType=a.Internal.FormatType.Quarter;break;case a.Format.Fmt38:d=b.getQuarterFormatAttribute("NNN.[00-99][00,25,50,75]","Quater 1/100",100,4,400,"^-?[0-9]+(X[0-9]{2}(([05][0])|([27][5]))?)?$","{0:00}{1:00}",["00","25","50","75"],void 0),d.formatType=a.Internal.FormatType.Quarter;break;case a.Format.Fmt39:d=b.getTensFormatAttribute("NNN.[0-9999]","Ten thousand 1/32",1e4,1,1e4,"^-?[0-9]+(X[0-9]{1,4})?$","{0:0000}"),d.formatType=a.Internal.FormatType.Tens;break;case a.Format.Fmt40:d=b.getThirtySecondFormatAttribute("NNN.[0246]","1/4",8,1,8,"^-?[0-9]+(X[0-7])?$","{0:0}"),d.formatType=a.Internal.FormatType.ThirtySecond;break;case a.Format.Fmt41:d=b.getThirtySecondFormatAttribute("NNN.[0-7]","1/8",8,1,8,"^-?[0-9]+(X[0-7])?$","{0:0}"),d.formatType=a.Internal.FormatType.ThirtySecond;break;case a.Format.Fmt42:d=b.getThirtySecondFormatAttribute("NNN.[0-15]","1/16",16,1,16,"^-?[0-9]+(X(([0][0-9])|(1[0-5])))?$","{0:00}"),d.formatType=a.Internal.FormatType.ThirtySecond;break;case a.Format.Fmt44:d=b.getHalfFormatAttribute("NNN.[0-31]+","1/64",32,2,64,"^-?[0-9]+(X(([0-2][0-9])|(3[01]))[0+]?)?$","{0:00}{1}",!0),d.formatType=a.Internal.FormatType.Half;break;case a.Format.Fmt45:d=b.getQuarterFormatAttribute("NNN.[00 - 31][02+6]","1/128",32,4,128,"^-?[0-9]+(X(([0-2][0-9])|(3[01]))[02+6]?)?$","{0:00}{1}",["0","2","+","6"],!0),d.formatType=a.Internal.FormatType.Quarter;break;case a.Format.Fmt46:d=b.getEightFormatAttribute("NNN.[00 - 31][01234567]","1/256",32,8,256,"^-?[0-9]+(X(([0-2][0-9])|(3[01]))[0-7]?)?$","{0:00} 0{1:0}",void 0,void 0,!0),d.formatType=a.Internal.FormatType.Eight;break;case a.Format.Fmt50:d=b.getEightFormatAttribute("NNN.[00-31][0123+567]","32nd",32,8,256,"^-?[0-9]+(X(([0-2][0-9])|(3[01]))([0-3]|[+]|[5-7])?)?$","{0:00} 0{1:0}",void 0,void 0,!0),d.formatType=a.Internal.FormatType.Eight;break;case a.Format.Fmt51:d=b.getQuarterFormatAttribute("NNN.[00-99][0 2 5 6]","Yield",100,4,400,"^-?[0-9]+(X[0-9]{2}[0256]?)?$","{0:00}{1:0}",["0","2","5","6"],!0),d.formatType=a.Internal.FormatType.Quarter;break;case a.Format.Fmt53:d=b.getQuarterFormatAttribute("NNN.[00-99][0 1 5 3]","Discount",100,4,400,"^-?[0-9]+(X[0-9]{2}[0153]?)?$","{0:00}{1:0}",["0","1","5","3"],!0),d.formatType=a.Internal.FormatType.Quarter;break;case a.Format.Fmt55:d=b.getTensFormatAttribute("SNNN.[01234567]","Basis",8,1,8,"^[-+]?[0-9]+(X[0-7])?$","{0:0}"),d.formatType=a.Internal.FormatType.Tens;break;case a.Format.Fmt58:d=b.getSixteenthFormatAttribute("NNN.[00-31][0-15]","512ths",32,16,512,"^-?[0-9]+(X(([0-2][0-9])|(3[01]))(([0])|([0][0-9])|([1][0-5]))?)?$","{0:00}{1:00}",void 0,void 0),d.formatType=a.Internal.FormatType.Sixteenth;break;case a.Format.Fmt59:d=b.getSixteenthFormatAttribute("NNN.[00-31][0, 0.5, 1, 1.5, 2, 2.5, 3, 3.5, +, 4.5, 5, 5.5, 6, 6.5, 7, 7.5]","8th of 32nd",32,16,512,"^-?[0-9]+(X(([0-2][0-9])|(3[01]))([0123567](\\.5)?|\\+|4\\.5)?)?$","{0:00}{1}",["0","0.5","1","1.5","2","2.5","3","3.5","+","4.5","5","5.5","6","6.5","7","7.5"],!0),d.formatType=a.Internal.FormatType.Sixteenth;break;case a.Format.Fmt60:d=b.getSixteenthFormatAttribute("NNN.[00-31][0, 01, 02, 03, 2, 05, 06, 07, +, 09, 10, 11, 6, 13, 14, 15]","Modified 16th of 32nd",32,16,512,"^-?[0-9]+(X(([0-2][0-9])|(3[01]))(([0][0-9])|([1][0-5])|([0246])|[+])?)?$","{0:00}{1}",["0","01","02","03","2","05","06","07","+","09","10","11","6","13","14","15"],!0),d.formatType=a.Internal.FormatType.Sixteenth;break;case a.Format.Fmt256:d=b.getEightFormatAttribute("NNN.[00-31][0123+567]","1/256",32,8,256,"^-?[0-9]+(X(([0-2][0-9])|(3[01]))([0-7]|[+])?)?$","{0:00}{1}",void 0,["0","1","2","3","+","5","6","7"],!0),d.formatType=a.Internal.FormatType.Eight;break;case a.Format.Fmt257:d=b.getEightFormatAttribute("NNN.[0123+567]","1/256 no handle",32,8,256,"^-?[0-9]+((X([0-3]|[+]|[5-7]))?)?$",void 0,void 0,["0","1","2","3","+","5","6","7"],void 0),d.formatType=a.Internal.FormatType.Eight;break;case a.Format.Fmt270:d=b.getEightFormatAttribute("NNN.[00-31][01 02 03 + 05 06 07]","DASH32E8_S",32,8,256,"^-?[0-9]+(X((([0-2][0-9])|(3[01]))(\\s[0][0-7]|\\s?\\+)?))?$","{0:00}{1}",void 0,[""," 01"," 02"," 03","+"," 05"," 06"," 07"],void 0),d.formatType=a.Internal.FormatType.Eight;break;case a.Format.Fmt271:d=b.getEightFormatAttribute("NNN.[00-31] [+][123567]/8]","DASH32E8",32,8,256,"^[-]?([0-9])+(X(([0-2][0-9])|(3[01]))((\\s?[1-7]/[8])|(\\s?[1-3]/[4])|\\s?\\+|(1/2))?)?$","{0:00}{1}",void 0,[""," 1/8"," 1/4"," 3/8","+"," 5/8"," 3/4"," 7/8"],void 0),d.formatType=a.Internal.FormatType.Eight;break;case a.Format.Fmt272:d=b.getEightFormatAttribute("NNN'[00-63][01 02 03 + 05 06 07]","DASH64E8_S",64,8,512,"^-?[0-9]+(X(([0-5][0-9])|(6[0-3]))(\\s[0][0-7]|\\s?\\+)?)?$","{0:00}{1}","'",[""," 01"," 02"," 03","+"," 05"," 06"," 07"],void 0),d.formatType=a.Internal.FormatType.Eight;break;case a.Format.Fmt273:d=b.getSixteenthFormatAttribute("NNN.[00-31] [+][1-7  9-15/16]","DASH32E16",32,16,512,"^-?[0-9]+(X(([0-2][0-9])|(3[01]))(\\s)?(((1|3|4|5|7)/(8|16))|([1-3]/4)|((2|6|8|9|(1[0-5]))/16)|\\+|(1/2))?)?$","{0:00}{1}",[""," 1/16"," 1/8"," 3/16"," 1/4"," 5/16"," 3/8"," 7/16","+"," 9/16"," 5/8"," 11/16"," 3/4"," 13/16"," 7/8"," 15/16"],void 0),d.formatType=a.Internal.FormatType.Sixteenth;break;case a.Format.Fmt274:d=b.getSixteenthFormatAttribute("NNN.[00-31][;1 1 ;3 2 ;5 3 ;7 + ;9 5 ;11 6 ;13 7 ;15]","LONG16_SEMICOLON",32,16,512,"^-?[0-9]+(X(([0-2][0-9])|(3[01]))([123+567]|([;]([13579]|(11)|(13)|(15))))?)?$","{0:00}{1}",["",";1","1",";3","2",";5","3",";7","+",";9","5",";11","6",";13","7",";15"],void 0),d.formatType=a.Internal.FormatType.Sixteenth;break;case a.Format.Fmt275:d=b.getEightFormatAttribute("NNN'[00-63]Â [+][123567/8]","DASH64E8",64,8,512,"^[-]?([0-9])+(X(([0-5][0-9])|(6[0-3]))((\\s?[1-7]/[8])|(\\s?[13]/[4])|\\s?\\+)?)?$","{0:00}{1}","'",[""," 1/8"," 1/4"," 3/8","+"," 5/8"," 3/4"," 7/8"],void 0),d.formatType=a.Internal.FormatType.Eight;break;case a.Format.Fmt280:d=b.getEightFormatAttribute("NNN.[0-31][0 00 2 25 5 50 7 75]","Ext QUARTER 1/32",32,4,128,"^-?[0-9]+(X(([0-2][0-9])|(3[01]))(0|00|2|25|5|50|7|75)?)?$","{0:00}{1}",void 0,["00","25","50","75"],void 0),d.formatType=a.Internal.FormatType.Eight;break;case a.Format.Fmt1000:d=b.getBasisPointFormatAttribute("NNNN","Basis Point 0 Decimals",100,0);break;case a.Format.Fmt1001:d=b.getBasisPointFormatAttribute("NNNN.[0-9]","Basis Point 1 Decimals",100,1);break;case a.Format.Fmt1002:d=b.getBasisPointFormatAttribute("NNNN.[0-99]","Basis Point 2 Decimals",100,2);break;case a.Format.Fmt1003:d=b.getBasisPointFormatAttribute("NNNN.[0-999]","Basis Point 3 Decimals",100,3);break;case a.Format.Fmt1004:d=b.getBasisPointFormatAttribute("NNNN.[0-9999]","Basis Point 4 Decimals",100,4);break;case a.Format.Fmt1005:d=b.getBasisPointFormatAttribute("NNNN.[0-99999]","Basis Point 5 Decimals",100,5)}else{var e=c,f=2===Math.round(e/1e3)?1:-1,g=Math.round(e%1e3/100),h=Math.round(e%100);d=b.getBasisPointFormatAttribute(void 0,"ScaledFormat",Math.pow(10,f*g),h)}return b._attributesCache[c]=d,d},b._attributesCache={},b}();a.FormatAttributeProvider=b}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(a){this._formatterCache={},this._customFormatRegistry=[],this._fractionalSeparator=a.fractionalSeparator,this.Initialize()}return c.prototype.register=function(c){var d=c.formatType;if(this.isDefaultFormatter(d))throw new Error(b.Strings.Msg_Cannot_Override_Default_Format);if(this._customFormatRegistry[d]){var e=a.stringFormat(b.Strings.Msg_Format_HasAlready_Registered,{formatToString:d.toString});throw e}this._customFormatRegistry[d]=c},c.prototype.getFormatter=function(a){if(this._customFormatRegistry[a])return this._customFormatRegistry[a];var b=this._formatterCache[a.toString()];return b||(b=this.createFormatter(a)),b},c.prototype.isDefaultFormatter=function(a){var c=b.Format[a];return null!=c&&void 0!==c||a>=2e3&&a<4e3},c.prototype.isFormatRegistered=function(a){return void 0!==this._customFormatRegistry[a]||null!=this._customFormatRegistry[a]||this.isDefaultFormatter(a)},c.prototype.createFormatter=function(c){var d=this.getFormatAttribute(c),e=null;return d.formatType===b.Internal.FormatType.Decimal?e=new a.cm.Formatters.Decimals.DecimalFormatter(d,c):d.formatType===b.Internal.FormatType.Quarter?e=new a.cm.Formatters.Fractionals.QuarterFormatter(d,c,1/d.totalTicks,this._fractionalSeparator):d.formatType===b.Internal.FormatType.Sixteenth?e=new a.cm.Formatters.Fractionals.SixteenthFormatter(d,c,1/d.totalTicks,this._fractionalSeparator):d.formatType===b.Internal.FormatType.Tens?e=new a.cm.Formatters.Fractionals.TensFormatter(d,c,1/d.totalTicks,this._fractionalSeparator):d.formatType===b.Internal.FormatType.ThirtySecond?e=new a.cm.Formatters.Fractionals.ThirtySecondFormatter(d,c,1/d.totalTicks,this._fractionalSeparator):d.formatType===b.Internal.FormatType.Half?e=new a.cm.Formatters.Fractionals.HalfFormatter(d,c,1/d.totalTicks,this._fractionalSeparator):d.formatType===b.Internal.FormatType.Eight?e=new a.cm.Formatters.Fractionals.EightFormatter(d,c,1/d.totalTicks,this._fractionalSeparator):d.formatType===b.Internal.FormatType.Basispoint&&(e=new a.cm.Formatters.Decimals.BasisPointFormatter(d,c)),
this._formatterCache[c.toString()]=e,e},c.prototype.getFormatAttribute=function(a){var c=b.FormatAttributeProvider.getFormatAttribute(a);if(void 0===c||null==c)throw b.CMString.format("Invalid format {0}, please check it is defined correctly.",a);return c},c.prototype.Initialize=function(){this.getFormatter(b.Format.Fmt2),this.getFormatter(b.Format.Fmt1),this.getFormatter(b.Format.Fmt3),this.getFormatter(b.Format.Fmt0),this.getFormatter(b.Format.Fmt256),this._formatterCache[b.Format.Fmt33.toString()]=this._formatterCache[b.Format.Fmt2.toString()],this._formatterCache[b.Format.Fmt34.toString()]=this._formatterCache[b.Format.Fmt1.toString()],this._formatterCache[b.Format.Fmt35.toString()]=this._formatterCache[b.Format.Fmt3.toString()],this._formatterCache[b.Format.Fmt36.toString()]=this._formatterCache[b.Format.Fmt0.toString()],this._formatterCache[b.Format.Fmt46.toString()]=this._formatterCache[b.Format.Fmt256.toString()],this._formatterCache[b.Format.Fmt50.toString()]=this._formatterCache[b.Format.Fmt256.toString()]},c}();b.FormatterFactory=c}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(a){this._formatterFactory=new b.FormatterFactory(a||new b.FormattersHelperSettings)}return c.prototype.getFormatter=function(a){var c=this._formatterFactory.getFormatter(a);if(void 0===c||null===c)throw new Error(b.Strings.Msg_UnsupportedFormat);return c},c.prototype.registerFormatter=function(c,d){if(this._formatterFactory.isFormatRegistered(c))throw new Error(a.stringFormat(b.Strings.Msg_FormatAlready_Registered,{format:c}));if(void 0===d||null===d)throw new Error(b.Strings.Msg_InvalidFormatter);d.formatType=c,this._formatterFactory.register(d)},c}();b.FormatterService=c,a.module("ionwebCm").service("cm.formatterService",[],function(){return new c})}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){}return a.Msg_Cannot_Override_Default_Format="Cannot override default format",a.Msg_Format_HasAlready_Registered="Format ${formatToString} has already been registered.",a.Msg_UnsupportedFormat="Unsupported format.",a.Msg_InvalidFormatter="Invalid formatter.",a.Msg_FormatAlready_Registered="Format ${format} has already been registered.",a.Msg_Subclass_MustOverride_ThisMethod="Subclass must override this method.",a}();a.Strings=b}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={})),ionweb.services.registerCoreSubmodule("ionwebCm",["ionwebCore"],ionweb.cm.Strings);var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),ionweb;!function(a){function b(a){if(a<=0)throw new Error("Invalid psh date");var b=Math.floor(a/1e4),c=Math.floor(a/100%100)-1,d=Math.floor(a%100),e=new Date(b,c,d);return e}function c(a){if(a<0)throw new Error("Invalid psh time");var b=a/1e4,c=a/100%100,d=a%100,e=new Date(0,0,0,b,c,d);return e}a.pshDateToJsDate=b,a.pshTimeToJsDate=c;var d;!function(a){a[a.Record=1]="Record",a[a.Chain=2]="Chain",a[a.ChainRecord=3]="ChainRecord",a[a.RecordGroup=4]="RecordGroup",a[a.Queue=5]="Queue",a[a.Pattern=6]="Pattern"}(d=a.SubscriptionType||(a.SubscriptionType={}));var e;!function(a){a[a.ComponentError=0]="ComponentError",a[a.ServerError=1]="ServerError",a[a.ClientError=2]="ClientError"}(e=a.ErrorClass||(a.ErrorClass={}))}(ionweb||(ionweb={})),function(a){var b;!function(a){var b;!function(a){a[a.MarketComponentRegistrationError=1]="MarketComponentRegistrationError",a[a.MarketgenericError=2]="MarketgenericError",a[a.AlreadyLogged=3]="AlreadyLogged",a[a.RegistrationNotFound=4]="RegistrationNotFound",a[a.Timeout=5]="Timeout",a[a.MarketNotConfigured=6]="MarketNotConfigured",a[a.GenericException=7]="GenericException"}(b=a.MarketCallFailureType||(a.MarketCallFailureType={}));var c;!function(a){a[a.NoServices=1]="NoServices",a[a.SsonTimeout=2]="SsonTimeout",a[a.UserServicesFunctionError=3]="UserServicesFunctionError",a[a.DaemonError=4]="DaemonError",a[a.GenericException=5]="GenericException"}(c=a.SsonFailureType||(a.SsonFailureType={}))}(b=a.cm||(a.cm={}))}(ionweb||(ionweb={})),function(a){a.module("ionwebComm").service("commService",["ionweb.serverService","ionweb.loggerFactory","ionweb.excHelper","ionweb.notificationService","ionweb.configurationService","ionweb.timeout","ionweb.statService","ionweb.moduleService","ionweb.environmentService"],function(b,c,d,e,f,g,h,i,j){return new a.comm.CommService(c,e,f,d,b,g,h,i,j)})}(ionweb||(ionweb={})),FSMContext.prototype.getDebugFlag=function(){return this.debugFlag},FSMContext.prototype.setDebugFlag=function(a){this.debugFlag=a},FSMContext.prototype.getDebugStream=function(){return this.debugStream},FSMContext.prototype.setDebugStream=function(a){this.debugStream=a},FSMContext.prototype.isInTransition=function(){return null==this.state},FSMContext.prototype.clearState=function(){this.previousState=this.state,this.state=null},FSMContext.prototype.getPreviousState=function(){return this.previousState},FSMContext.prototype.getState=function(){return this.state},FSMContext.prototype.setState=function(a){if(!(a instanceof State))throw new TypeError(a+" should be of class State");this.state=a,this.debugFlag&&this.debugStream.write("EnterState",this.state.name)},FSMContext.prototype.isStateStackEmpty=function(){return 0===this.stateStack.length},FSMContext.prototype.getStateStackDepth=function(){return this.stateStack.length},FSMContext.prototype.pushState=function(a){if(!(a instanceof State))throw new TypeError(a+" should be of class State");this.state&&this.stateStack.push(this.state),this.state=a,this.debugFlag&&this.debugStream.write("PushToState",this.state.name)},FSMContext.prototype.popState=function(){if(0===this.stateStack.length)throw this.debugFlag&&this.debugStream.write("PopToState","<EmptyStackTrace>"),new Error("empty state stack.");this.state=this.stateStack.pop(),this.debugFlag&&this.debugStream.write("PopToState",this.state.name)},FSMContext.prototype.emptyStateStack=function(){this.stateStack=[]};var ionweb;!function(a){var b;!function(a){function b(){}function c(a,b){State.call(this,a,b)}function d(a,b){State.call(this,a,b)}function e(a,b){State.call(this,a,b)}function f(a,b){State.call(this,a,b)}function g(a,b){State.call(this,a,b)}function h(a,b){State.call(this,a,b)}function i(a,b){State.call(this,a,b)}function j(a){FSMContext.call(this,m.Unsubscribed),this.owner=a}b.prototype=new State;var k=function(){};b.prototype.Entry=k,b.prototype.Exit=k;var l=function(a){this.Default(a)};b.prototype.connected=l,b.prototype.connected=l,b.prototype.disconnected=l,b.prototype.subscribe=l,b.prototype.unsubscribe=l,b.prototype.Default=function(a){var b="Undefined Transition\nState: "+a.getState().name+"\nTransition: "+a.transition+"\n";throw new Error(b)},c.prototype=new b;var m={};m.DefaultState=new c("QueueSubscriptionMap::DefaultState",0),d.prototype=m.DefaultState,m.Unsubscribed=new d("QueueSubscriptionMap::Unsubscribed",1),m.Unsubscribed.Default=function(a){},m.Unsubscribed.subscribe=function(a){var b=a.owner;if(1==b.isConnected()){a.getState().Exit(a),a.clearState();try{b.sendSubscribe()}finally{a.setState(m.Active),a.getState().Entry(a)}}else 0==b.isConnected()?(a.getState().Exit(a),a.setState(m.SubscriptionParked),a.getState().Entry(a)):m.DefaultState.subscribe(a)},e.prototype=m.DefaultState,m.SubscriptionParked=new e("QueueSubscriptionMap::SubscriptionParked",2),m.SubscriptionParked.connected=function(a){var b=a.owner;a.getState().Exit(a),a.clearState();try{b.sendSubscribe()}finally{a.setState(m.Active),a.getState().Entry(a)}},m.SubscriptionParked.unsubscribe=function(a){a.getState().Exit(a),a.setState(m.End),a.getState().Entry(a)},f.prototype=m.DefaultState,m.Active=new f("QueueSubscriptionMap::Active",3),m.Active.disconnected=function(a){a.getState().Exit(a),a.setState(m.Inactive),a.getState().Entry(a)},m.Active.unsubscribe=function(a){var b=a.owner;a.getState().Exit(a),a.clearState();try{b.sendUnsubscribe()}finally{a.setState(m.End),a.getState().Entry(a)}},g.prototype=m.DefaultState,m.Inactive=new g("QueueSubscriptionMap::Inactive",4),m.Inactive.connected=function(a,b){var c=a.owner;if(0==b&&1==c.isClientReliable()&&0==c.isDirty())a.getState().Exit(a),a.setState(m.Active),a.getState().Entry(a);else if(0==b&&1==c.isClientReliable()&&1==c.isDirty()){a.getState().Exit(a),a.clearState();try{c.sendUpdate()}finally{a.setState(m.Active),a.getState().Entry(a)}}else if(1==b)a.getState().Exit(a),a.setState(m.End),a.getState().Entry(a);else if(0==b&&0==c.isClientReliable()){a.getState().Exit(a),a.clearState();try{c.sendUnsubscribe()}finally{a.setState(m.End),a.getState().Entry(a)}}else m.DefaultState.connected(a,b)},m.Inactive.disconnected=function(a){},m.Inactive.unsubscribe=function(a){a.getState().Exit(a),a.setState(m.UnsubscriptionParked),a.getState().Entry(a)},h.prototype=m.DefaultState,m.UnsubscriptionParked=new h("QueueSubscriptionMap::UnsubscriptionParked",5),m.UnsubscriptionParked.connected=function(a,b){var c=a.owner;if(1==b)a.getState().Exit(a),a.setState(m.End),a.getState().Entry(a);else if(0==b){a.getState().Exit(a),a.clearState();try{c.sendUnsubscribe()}finally{a.setState(m.End),a.getState().Entry(a)}}else m.DefaultState.connected(a,b)},m.UnsubscriptionParked.unsubscribe=function(a){},i.prototype=m.DefaultState,m.End=new i("QueueSubscriptionMap::End",6),m.End.Entry=function(a){var b=a.owner;b.raiseClosed()},m.End.Default=function(a){},a.QueueSubscriptionSM=j,j.prototype=new FSMContext,j.prototype.enterStartState=function(){this.getState().Entry(this)},j.prototype.connected=function(){this.transition="connected",this.getState().connected(this),this.transition=""},j.prototype.connected=function(a){this.transition="connected",this.getState().connected(this,a),this.transition=""},j.prototype.disconnected=function(){this.transition="disconnected",this.getState().disconnected(this),this.transition=""},j.prototype.subscribe=function(){this.transition="subscribe",this.getState().subscribe(this),this.transition=""},j.prototype.unsubscribe=function(){this.transition="unsubscribe",this.getState().unsubscribe(this),this.transition=""}}(b=a.comm||(a.comm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){function b(){}function c(a,b){State.call(this,a,b)}function d(a,b){State.call(this,a,b)}function e(a,b){State.call(this,a,b)}function f(a,b){State.call(this,a,b)}function g(a,b){State.call(this,a,b)}function h(a,b){State.call(this,a,b)}function i(a,b){State.call(this,a,b)}function j(a){FSMContext.call(this,m.Initial),this.owner=a}b.prototype=new State;var k=function(){};b.prototype.Entry=k,b.prototype.Exit=k;var l=function(a){this.Default(a)};b.prototype.connected=l,b.prototype.disconnected=l,b.prototype.subscribe=l,b.prototype.unsubscribe=l,b.prototype.Default=function(a){var b="Undefined Transition\nState: "+a.getState().name+"\nTransition: "+a.transition+"\n";throw new Error(b)},c.prototype=new b;var m={};m.DefaultState=new c("SubscriptionMap::DefaultState",0),d.prototype=m.DefaultState,m.Initial=new d("SubscriptionMap::Initial",1),m.Initial.Default=function(a){},m.Initial.subscribe=function(a){var b=a.owner;if(0==b.isConnected())a.getState().Exit(a),a.setState(m.SubscriptionParked),a.getState().Entry(a);else if(1==b.isConnected()){a.getState().Exit(a),a.clearState();try{b.sendSubscribe()}finally{a.setState(m.Active),a.getState().Entry(a)}}else m.DefaultState.subscribe(a)},e.prototype=m.DefaultState,m.Active=new e("SubscriptionMap::Active",2),m.Active.disconnected=function(a){a.getState().Exit(a),a.setState(m.Inactive),a.getState().Entry(a)},m.Active.unsubscribe=function(a){var b=a.owner;a.getState().Exit(a),a.clearState();try{b.sendUnsubscribe()}finally{a.setState(m.Unsubscribed),a.getState().Entry(a)}},f.prototype=m.DefaultState,m.SubscriptionParked=new f("SubscriptionMap::SubscriptionParked",3),m.SubscriptionParked.connected=function(a,b){var c=a.owner;a.getState().Exit(a),a.clearState();try{c.sendSubscribe()}finally{a.setState(m.Active),a.getState().Entry(a)}},m.SubscriptionParked.unsubscribe=function(a){a.getState().Exit(a),a.setState(m.Unsubscribed),a.getState().Entry(a)},g.prototype=m.DefaultState,m.UnsubscriptionParked=new g("SubscriptionMap::UnsubscriptionParked",4),m.UnsubscriptionParked.connected=function(a,b){var c=a.owner;if(1==b)a.getState().Exit(a),a.setState(m.Unsubscribed),a.getState().Entry(a);else if(0==b){a.getState().Exit(a),a.clearState();try{c.sendUnsubscribe()}finally{a.setState(m.Unsubscribed),a.getState().Entry(a)}}else m.DefaultState.connected(a,b)},m.UnsubscriptionParked.subscribe=function(a){var b=a.owner;1==b.canRestart()?(a.getState().Exit(a),a.setState(m.SubscriptionParked),a.getState().Entry(a)):m.DefaultState.subscribe(a)},m.UnsubscriptionParked.unsubscribe=function(a){},h.prototype=m.DefaultState,m.Inactive=new h("SubscriptionMap::Inactive",5),m.Inactive.connected=function(a,b){var c=a.owner;if(1==b){a.getState().Exit(a),a.clearState();try{c.raiseNotAvailable(),c.sendSubscribe()}finally{a.setState(m.Active),a.getState().Entry(a)}}else if(0==b&&1==c.isClientReliable()&&0==c.isDirty())a.getState().Exit(a),a.setState(m.Active),a.getState().Entry(a);else if(0==b&&1==c.isClientReliable()&&1==c.isDirty()){a.getState().Exit(a),a.clearState();try{c.sendUpdate()}finally{a.setState(m.Active),a.getState().Entry(a)}}else if(0==b&&0==c.isClientReliable()){a.getState().Exit(a),a.clearState();try{c.sendUnsubscribe(),c.raiseNotAvailable(),c.sendSubscribe()}finally{a.setState(m.Active),a.getState().Entry(a)}}else m.DefaultState.connected(a,b)},m.Inactive.disconnected=function(a){},m.Inactive.unsubscribe=function(a){a.getState().Exit(a),a.setState(m.UnsubscriptionParked),a.getState().Entry(a)},i.prototype=m.DefaultState,m.Unsubscribed=new i("SubscriptionMap::Unsubscribed",6),m.Unsubscribed.Entry=function(a){var b=a.owner;b.unregisterHandlers()},m.Unsubscribed.Default=function(a){},m.Unsubscribed.subscribe=function(a){var b=a.owner;if(0==b.isConnected()&&1==b.canRestart())a.getState().Exit(a),a.setState(m.SubscriptionParked),a.getState().Entry(a);else if(1==b.isConnected()&&1==b.canRestart()){a.getState().Exit(a),a.clearState();try{b.sendSubscribe()}finally{a.setState(m.Active),a.getState().Entry(a)}}else m.DefaultState.subscribe(a)},a.SubscriptionSM=j,j.prototype=new FSMContext,j.prototype.enterStartState=function(){this.getState().Entry(this)},j.prototype.connected=function(a){this.transition="connected",this.getState().connected(this,a),this.transition=""},j.prototype.disconnected=function(){this.transition="disconnected",this.getState().disconnected(this),this.transition=""},j.prototype.subscribe=function(){this.transition="subscribe",this.getState().subscribe(this),this.transition=""},j.prototype.unsubscribe=function(){this.transition="unsubscribe",this.getState().unsubscribe(this),this.transition=""}}(b=a.comm||(a.comm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c,d=[];!function(a){a[a.NotAvailable=0]="NotAvailable",a[a.BatchStart=1]="BatchStart",a[a.Add=2]="Add",a[a.Update=3]="Update",a[a.Delete=4]="Delete",a[a.Kill=6]="Kill",a[a.BatchEnd=7]="BatchEnd",a[a.MqClose=8]="MqClose",a[a.Begin=10]="Begin",a[a.End=11]="End",a[a.User=12]="User"}(c||(c={}));var e=function(){function e(c,f,g,h,i){var j=this;if(this._commServiceAdapter=c,this._logger=f,this._excHelper=h,this.statTables=i,this._pendingActions=[],this._isQueueRunning=!1,this._invalid=!1,this.isUnsubscribed=!1,!g.id)throw new Error("Missing ID to subscribe");if(!g.type)throw new Error("Missing type to subscribe");e.isInitialized||(d[a.SubscriptionType.Record]={id:"Record",fmt:[2,0],hasFields:!0},d[a.SubscriptionType.Chain]={id:"Chain",fmt:[2,1],hasFields:!1},d[a.SubscriptionType.ChainRecord]={id:"ChainRecord",fmt:[2,1],hasFields:!0},d[a.SubscriptionType.RecordGroup]={id:"RecordGroup",fmt:[2,1],hasFields:!0},d[a.SubscriptionType.Queue]={id:"Queue",fmt:[2,1],hasFields:!0},d[a.SubscriptionType.Pattern]={id:"Pattern",fmt:[2,1],hasFields:!0},e.isInitialized=!0),g.type===a.SubscriptionType.Queue?this._sm=new b.QueueSubscriptionSM(this):this._sm=new b.SubscriptionSM(this),this._sm.setDebugFlag(!0),this._sm.setDebugStream({write:function(a,b){j._logger.medium(a,{cometDAdapterId:j._commServiceAdapter.id,state:b})}}),this._commServiceAdapter.connectionChanged.add(this.connectionChangedHandler,this),this._subOpts=a.extend({notAvailable:function(){return null},begin:function(){return null},end:function(){return null},add:function(){return null},remove:function(){return null},close:function(){return null},kill:function(){return null},supply:function(){return null},user:function(){return null},metadata:function(){return null}},[g]),this._fieldList=(this._subOpts.fields||[]).slice(0),this._logger.medium("CreateSub",{cometDAdapterId:this._commServiceAdapter.id,id:this._subOpts.id,subType:a.SubscriptionType[this._subOpts.type],fields:this._fieldList}),this.statTables.comp.register(this,1,this._fieldList.length)}return e.prototype.startSubscription=function(){this._sm.subscribe()},e.prototype.connectionChangedHandler=function(a,b){b.connected?(b.isNewSession?this.clearActionQueue():this.processActionQueue(),this._sm.connected(b.isNewSession)):this._sm.disconnected()},e.prototype.isConnected=function(){return this._commServiceAdapter.isConnected()},e.prototype.isDirty=function(){return!!this._requiredFieldList||!!this._requiredRecordList},e.prototype.canRestart=function(){return!1},e.prototype.sendSubscribe=function(){var b=this;this.promoteLists(),this.enqueueAction(function(){var c=Q.defer(),e=d[b._subOpts.type];b._logger.low("SubReq",{cometDAdapterId:b._commServiceAdapter.id,id:b._subOpts.id,subType:e.id,fields:b._fieldList});var f=b._subOpts.id;b._subOpts.type===a.SubscriptionType.RecordGroup&&(b._recordList=b._subOpts.id.slice(),b.statTables.comp.updateInnerRecCount(b,b._recordList.length),f=b._recordList.join(","));var g={ItemType:e.id,DataFormatVersion:e.fmt,ItemID:f,Fields:b._subOpts.fields,Request:"SUBSCRIBE",ChType:"PRIVATE_MULTIPLEX"},h={onSuccess:function(a){"SUCCESS"===a.data.Outcome?(b._logger.low("SubResp",{cometDAdapterId:b._commServiceAdapter.id,outcome:a.data.Outcome,sid:a.data.sid}),b._streamId=a.data.sid,b._decoder=b.createDecoder(b,b._subOpts.id,a.data.DataSchema,b._subOpts,d[b._subOpts.type].hasFields),b._commServiceAdapter.registerStreamHandler(b._streamId,function(a,c){return b._decoder(a,c)})):(b._logger.low("SubResp",{cometDAdapterId:b._commServiceAdapter.id,outcome:a.data.Outcome,errorCode:a.data.ErrorCode,errorMsg:a.data.ErrorMsg}),b._excHelper.report(a),b._invalid=!0),c.resolve(null)},onFailure:function(){b._logger.low("SubReq",{cometDAdapterId:b._commServiceAdapter.id,error:"CometDPublish failure"}),c.reject(null)}};return b._commServiceAdapter.publishSubscriptionMessage(g,h),c.promise})},e.prototype.checkNullString=function(a){var b=24;return 1===a.length&&a.charCodeAt(0)===b},e.prototype.extractFields=function(c,d,e){var f={};if(d){if(!e){var g=a.stringFormat(b.Strings.Err_Missing_MetaData,{ION_Action:c._ION_Action});throw new Error(g)}for(var h=0,i=c._ION_UpdatedFieldsBMask,j=c._ION_UpdatedFieldsValues,k=0;k<e.length;k++)if(a.isBitSet(i,k)){var l=j[h++];"string"==typeof l&&this.checkNullString(l)?f[e[k].id]=null:f[e[k].id]=l}this.statTables.comp.supply(this,h)}return f},e.prototype.createDecoder=function(d,e,f,g,h){var i=this,j=e,k=e.lastIndexOf(".");k>0&&(j=e.substring(0,k));var l,m=this._logger,n=this._streamId,o=new b.RequestReplyDecoder(f);return function(b,e){try{if(d.isUnsubscribed)return;var f=o.decode(b);if(!f)return;if(f._ION_UpdatedFieldsBMask&&(f._ION_UpdatedFieldsBMask=base64.decode(f._ION_UpdatedFieldsBMask)),f.SubMD){m.high("onMsg",{cometDAdapterId:i._commServiceAdapter.id,sid:n,metadata:"true"}),l=[];for(var k=0;k<f.SubMD.length;k++)l.push({id:f.SubMD[k][0],type:f.SubMD[k][1]});g.metadata(l),i.statTables.comp.updateFieldCount(i,l.length)}var p=f._ION_ItemID;p&&"."===p.charAt(0)&&(p=j+p);var q=parseInt(f._ION_Action),r={cometDAdapterId:i._commServiceAdapter.id,sid:n,action:c[q]},s=function(a){a.bind(m)("onMsg",r)};switch(q){case c.NotAvailable:s(m.low),g.notAvailable();break;case c.Begin:case c.BatchStart:s(m.low),g.begin();break;case c.Add:r.recordId=p,s(m.high),g.type===a.SubscriptionType.Record?g.supply(p,i.extractFields(f,h,l),!0):g.add(p,i.extractFields(f,h,l));break;case c.End:case c.BatchEnd:s(m.low),g.end();break;case c.Update:r.recordId=p,s(m.high),g.supply(p,i.extractFields(f,h,l),!1);break;case c.Delete:r.recordId=p,s(m.high),g.remove(p);break;case c.MqClose:s(m.low),g.close();break;case c.Kill:s(m.low),g.kill();break;case c.User:r.userMsg=p,s(m.high),g.user(p,i.extractFields(f,h,l));break;default:r.error="Unknown action",s(m.low)}var t=f._ION_SupplyOriginator,u=f._ION_SupplyTS;t&&u&&i.statTables.e2e.storeE2EDelay(t,u,e);var v=f._ION_AdapterTS,w=i._commServiceAdapter.componentName;w&&v&&i.statTables.e2e.storeE2EDelay(w,v,e)}catch(a){i._excHelper.report(a)}}},e.prototype.clearActionQueue=function(){this._pendingActions=[]},e.prototype.processActionQueue=function(){var a=this;if(this._pendingActions.length>0&&this.isConnected()&&!this._invalid){this._isQueueRunning=!0;var b=this._pendingActions[0];b().then(function(){a._pendingActions[0]===b&&a._pendingActions.shift()}).finally(function(){a.processActionQueue()})}else this._isQueueRunning=!1},e.prototype.enqueueAction=function(a){this._pendingActions.push(a),this._isQueueRunning||this._invalid||this.processActionQueue()},e.prototype.sendUnsubscribe=function(){var a=this,b=this._streamId;this.unregisterStreamHandler(),this.enqueueAction(function(){var c=Q.defer();a._logger.low("UnsubReq",{cometDAdapterId:a._commServiceAdapter.id,sid:a._streamId});var d={Request:"UNSUBSCRIBE_STREAMS",StreamsList:[b]},e={onSuccess:function(d){a._logger.low("UnsubResp",{cometDAdapterId:a._commServiceAdapter.id,outcome:d.data.Outcome,sid:b}),c.resolve(null)},onFailure:function(){a._logger.low("UnsubReq",{cometDAdapterId:a._commServiceAdapter.id,error:"CometDPublish failure"}),c.reject(null)}};return a._commServiceAdapter.publishSubscriptionMessage(d,e),c.promise})},e.prototype.promoteLists=function(){this._requiredFieldList&&(this._fieldList=this._requiredFieldList,this._requiredFieldList=null),this._requiredRecordList&&(this._recordList=this._requiredRecordList,this._requiredRecordList=null)},e.calcDiff=function(a,b){if(b){var c=a.filter(function(a){return b.indexOf(a)<0}),d=b.filter(function(b){return a.indexOf(b)<0});if(c.length>0||d.length>0)return{added:d,removed:c}}return null},e.prototype.calcDiffs=function(){if(!this._requiredFieldList&&!this._requiredRecordList)throw new Error(b.Strings.Err_InvalidOperation_New_ListRecord_Required);var a=e.calcDiff(this._fieldList,this._requiredFieldList),c=e.calcDiff(this._recordList,this._requiredRecordList);return this.promoteLists(),{fields:a,records:c}},e.prototype.sendUpdate=function(){var a=this,b=this.calcDiffs();b.fields&&this.enqueueAction(function(){var c=Q.defer(),d=b.fields.added.concat(b.fields.removed.map(function(a){return"-"+a}));a._logger.low("FieldUpdateReq",{cometDAdapterId:a._commServiceAdapter.id,sid:a._streamId,fields:d});var e={Request:"UPDATE_SUBSCRIPTION",Fields:d,sid:a._streamId};return a._commServiceAdapter.publishSubscriptionMessage(e,{onSuccess:function(b){a._logger.low("FieldUpdateResp",{cometDAdapterId:a._commServiceAdapter.id,outcome:b.data.Outcome,sid:a._streamId}),c.resolve(null)},onFailure:function(){a._logger.low("FieldUpdateReq",{cometDAdapterId:a._commServiceAdapter.id,error:"CometDPublish failure"}),c.reject(null)}}),c.promise}),b.records&&this.enqueueAction(function(){var c=Q.defer(),d=b.records.added.concat(b.records.removed.map(function(a){return"-"+a}));a._logger.low("RecordsUpdateReq",{cometDAdapterId:a._commServiceAdapter.id,sid:a._streamId,records:d});var e={Request:"UPDATE_SUBSCRIPTION",ItemID:d.join(","),sid:a._streamId};return a._commServiceAdapter.publishSubscriptionMessage(e,{onSuccess:function(b){a._logger.low("RecordsUpdateResp",{cometDAdapterId:a._commServiceAdapter.id,outcome:b.data.Outcome,sid:a._streamId}),c.resolve(null)},onFailure:function(){a._logger.low("RecordsUpdateReq",{cometDAdapterId:a._commServiceAdapter.id,error:"CometDPublish failure"}),c.reject(null)}}),c.promise})},e.prototype.updateFields=function(a){this._requiredFieldList=a.slice(0),this.isConnected()&&this.sendUpdate()},e.prototype.updateRecords=function(c){if(this._subOpts.type!==a.SubscriptionType.RecordGroup)throw new Error(b.Strings.Err_RecordGroup_SubscriptionUpdate_RecordList);this._requiredRecordList=c.slice(0),this.isConnected()&&this.sendUpdate()},e.prototype.isClientReliable=function(){return!1},e.prototype.unsubscribe=function(){this.isUnsubscribed=!0,this._sm.unsubscribe(),this.unregisterStreamHandler(),this.statTables.comp.unregister(this)},e.prototype.raiseClosed=function(){try{this._subOpts.close(),this.unregisterHandlers()}catch(a){this._excHelper.report(a)}},e.prototype.raiseNotAvailable=function(){try{this._subOpts.notAvailable()}catch(a){this._excHelper.report(a)}},e.prototype.unregisterHandlers=function(){this._commServiceAdapter.connectionChanged.remove(this.connectionChangedHandler,this),this.unregisterStreamHandler()},e.prototype.unregisterStreamHandler=function(){this._streamId&&(this._commServiceAdapter.removeStreamHandler(this._streamId),this._streamId=null)},e.isInitialized=!1,e}();b.SubscriptionAdapter=e}(b=a.comm||(a.comm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(){}return b.createLongPollingTransport=function(b){var c=new b.LongPollingTransport,d=b.Transport.derive(c);return d.xhrSend=function(b){var c=new XMLHttpRequest,d=b.body&&b.body.length||0;c.open("POST",b.url),c.setRequestHeader("Content-Type","application/json;charset=UTF-8"),c.withCredentials=!0,c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){b.onSuccess(c.responseText);var e=c.responseText&&c.responseText.length||0;a.rest.trackCall(a.rest.DATA_CATEGORY,1,d,e)}else b.onError(c.statusText,c.response)},c.send(b.body)},d},b.createWebSocketTransport=function(b){var c=new b.WebSocketTransport,d=b.Transport.derive(c);return d.onStat=function(b){a.rest.trackCall(a.rest.DATA_CATEGORY,0,b.tx||0,b.rx||0)},d},b.create=function(){return a.qRequire("cometd").then(function(a){a.JSON={toJSON:JSON.stringify,fromJSON:JSON.parse};var c=new a.CometD;return a.WebSocket&&c.registerTransport("websocket",b.createWebSocketTransport(a)),c.registerTransport("long-polling",b.createLongPollingTransport(a)),c.registerExtension("ack",new a.AckExtension),c.registerExtension("timesync",new a.TimeSyncExtension),c},function(a){return null})},b}();b.CometDFactory=c}(b=a.comm||(a.comm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){function b(){}function c(a,b){State.call(this,a,b)}function d(a,b){State.call(this,a,b)}function e(a,b){State.call(this,a,b)}function f(a,b){State.call(this,a,b)}function g(a,b){State.call(this,a,b)}function h(a,b){State.call(this,a,b)}function i(a,b){State.call(this,a,b)}function j(a,b){State.call(this,a,b)}function k(a,b){State.call(this,a,b)}function l(a){FSMContext.call(this,o.Disconnected),this.owner=a}b.prototype=new State;var m=function(){};b.prototype.Entry=m,b.prototype.Exit=m;var n=function(a){this.Default(a)};b.prototype.backOffExpired=n,b.prototype.connect=n,b.prototype.connectError=n,b.prototype.connectSuccess=n,b.prototype.disconnect=n,b.prototype.handshakeCompleted=n,b.prototype.mpxChannelFailed=n,b.prototype.mpxChannelReady=n,b.prototype.newConnectionReady=n,b.prototype.reconnect=n,b.prototype.Default=function(a){var b="Undefined Transition\nState: "+a.getState().name+"\nTransition: "+a.transition+"\n";throw new Error(b)},c.prototype=new b;var o={};o.DefaultState=new c("CommMap::DefaultState",0),o.DefaultState.handshakeCompleted=function(a){a.getState().Exit(a),a.setState(o.CreatingMpxChannel),a.getState().Entry(a)},o.DefaultState.connectSuccess=function(a){},o.DefaultState.connectError=function(a){},o.DefaultState.backOffExpired=function(a){},o.DefaultState.disconnect=function(a){a.getState().Exit(a),a.setState(o.End),a.getState().Entry(a)},o.DefaultState.reconnect=function(a){a.getState().Exit(a),a.setState(o.Reconnecting),a.getState().Entry(a)},d.prototype=o.DefaultState,o.Handshaking=new d("CommMap::Handshaking",1),o.Handshaking.Entry=function(a){var b=a.owner;b.sendHandshake()},o.Handshaking.mpxChannelFailed=function(a,b){1==b?(a.getState().Exit(a),a.setState(o.BackOff),a.getState().Entry(a)):0==b?(a.getState().Exit(a),a.setState(o.CreatingMpxChannel),a.getState().Entry(a)):o.DefaultState.mpxChannelFailed(a,b)},e.prototype=o.DefaultState,o.CreatingMpxChannel=new e("CommMap::CreatingMpxChannel",2),o.CreatingMpxChannel.Entry=function(a){var b=a.owner;b.requestMpxChannel()},o.CreatingMpxChannel.mpxChannelFailed=function(a,b){1==b?(a.getState().Exit(a),a.setState(o.BackOff),a.getState().Entry(a)):0==b?(a.getState().Exit(a),a.setState(o.CreatingMpxChannel),a.getState().Entry(a)):o.DefaultState.mpxChannelFailed(a,b)},o.CreatingMpxChannel.mpxChannelReady=function(a){var b=a.owner;a.getState().Exit(a),a.clearState();try{b.raiseConnected(!0)}finally{a.setState(o.Ready),a.getState().Entry(a)}},f.prototype=o.DefaultState,o.Ready=new f("CommMap::Ready",3),o.Ready.Exit=function(a){var b=a.owner;b.raiseDisconnected()},o.Ready.connectError=function(a){a.getState().Exit(a),a.setState(o.TemporaryFailure),a.getState().Entry(a)},o.Ready.mpxChannelFailed=function(a,b){a.getState().Exit(a),a.setState(o.TemporaryFailure),a.getState().Entry(a)},g.prototype=o.DefaultState,o.TemporaryFailure=new g("CommMap::TemporaryFailure",4),o.TemporaryFailure.connectError=function(a){},o.TemporaryFailure.connectSuccess=function(a){var b=a.owner;a.getState().Exit(a),a.clearState();try{b.raiseConnected(!1)}finally{a.setState(o.Ready),a.getState().Entry(a)}},h.prototype=o.DefaultState,o.BackOff=new h("CommMap::BackOff",5),o.BackOff.Entry=function(a){var b=a.owner;b.sendDisconnect(),b.startBackOffTimer()},o.BackOff.Default=function(a){},o.BackOff.backOffExpired=function(a){a.getState().Exit(a),a.setState(o.Handshaking),a.getState().Entry(a)},o.BackOff.connect=function(a){var b=a.owner;a.getState().Exit(a),a.clearState();try{b.stopBackOffTimer()}finally{a.setState(o.Handshaking),a.getState().Entry(a)}},o.BackOff.disconnect=function(a){var b=a.owner;a.getState().Exit(a),a.clearState();try{b.stopBackOffTimer()}finally{a.setState(o.End),a.getState().Entry(a)}},i.prototype=o.DefaultState,o.Disconnected=new i("CommMap::Disconnected",6),o.Disconnected.connect=function(a){a.getState().Exit(a),a.setState(o.Handshaking),a.getState().Entry(a)},j.prototype=o.DefaultState,o.End=new j("CommMap::End",7),o.End.Entry=function(a){var b=a.owner;b.sendDisconnect()},o.End.Default=function(a){},k.prototype=o.DefaultState,o.Reconnecting=new k("CommMap::Reconnecting",8),o.Reconnecting.Entry=function(a){var b=a.owner;b.startNewConnection()},o.Reconnecting.Default=function(a){},o.Reconnecting.newConnectionReady=function(a){a.getState().Exit(a),a.setState(o.Handshaking),a.getState().Entry(a)},a.CommSM=l,l.prototype=new FSMContext,l.prototype.enterStartState=function(){this.getState().Entry(this)},l.prototype.backOffExpired=function(){this.transition="backOffExpired",this.getState().backOffExpired(this),this.transition=""},l.prototype.connect=function(){this.transition="connect",this.getState().connect(this),this.transition=""},l.prototype.connectError=function(){this.transition="connectError",this.getState().connectError(this),this.transition=""},l.prototype.connectSuccess=function(){this.transition="connectSuccess",this.getState().connectSuccess(this),this.transition=""},l.prototype.disconnect=function(){this.transition="disconnect",this.getState().disconnect(this),this.transition="";
},l.prototype.handshakeCompleted=function(){this.transition="handshakeCompleted",this.getState().handshakeCompleted(this),this.transition=""},l.prototype.mpxChannelFailed=function(a){this.transition="mpxChannelFailed",this.getState().mpxChannelFailed(this,a),this.transition=""},l.prototype.mpxChannelReady=function(){this.transition="mpxChannelReady",this.getState().mpxChannelReady(this),this.transition=""},l.prototype.newConnectionReady=function(){this.transition="newConnectionReady",this.getState().newConnectionReady(this),this.transition=""},l.prototype.reconnect=function(){this.transition="reconnect",this.getState().reconnect(this),this.transition=""}}(b=a.comm||(a.comm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(c){var d=c.split(".");if(2!==d.length)throw new Error(a.stringFormat(b.Strings.Err_Streaming_Protocol_Version_Not_Supported,{serverVersion:c}));if(this.major=Number(d[0]),this.minor=Number(d[1]),this.major<1||1===this.major&&this.minor<3)throw new Error(b.Strings.Err_Server_Version_Too_Low);if(this.major>1)throw new Error(b.Strings.Err_Unable_To_Negotiate_Protocol_Version)}return c.prototype.gte=function(a,b){return!(this.major<a)&&(this.major>a||this.minor>=b)},c}(),d=function(){function d(c,d,e,f,g,h,i,j,k,l){var m=this;this._cometd=c,this._connectionOptions=d,this._ionServer=f,this._timeout=g,this.excHelper=h,this.notification=i,this.statService=j,this.moduleService=k,this.statTables=l,this._connected=!1,this.requestCounter=1,this._outstandingRequests={},this._messageHandlers={},this.disconnectionHandler=null,this._logger=e.create("Comm","comm"),this._sm=new b.CommSM(this),this._sm.setDebugFlag(!0),this._sm.setDebugStream({write:function(a,b){m._logger.low(a,{cometDAdapterId:c.getClientId(),state:b})}}),this.connectionChanged=new a.Event,this.registerHandshakeListener(),this.registerConnectChannelListener(),this.registerSubscriptionListener()}return Object.defineProperty(d,"serviceModuleName",{get:function(){return d.Streaming_Module_Component_Name},enumerable:!0,configurable:!0}),Object.defineProperty(d,"serviceStatusName",{get:function(){return d.Streaming_Status_Component_Name},enumerable:!0,configurable:!0}),Object.defineProperty(d,"serviceModuleDisplayName",{get:function(){return b.Strings.Component_DisplayName_Streaming},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"id",{get:function(){return this._cometd.getClientId()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"componentName",{get:function(){return this._componentName},enumerable:!0,configurable:!0}),d.prototype.registerStreamHandler=function(a,b){this._messageHandlers[a]=b},d.prototype.removeStreamHandler=function(a){delete this._messageHandlers[a]},d.prototype.isConnected=function(){return this._connected},d.prototype.start=function(){this._sm.connect()},d.prototype.registerConnectChannelListener=function(){function a(a){if(!a)return a;try{return JSON.stringify(a,function(a,b){return"transport"!==a&&b})}catch(b){return a}}var b=this;this._connectChannelListener=this._cometd.addListener(d.CONNECT_CHANNEL,function(c){if(c.successful)b._logger.high("CometD-Connect",{cometDAdapterId:b._cometd.getClientId(),successful:!0}),b._sm.connectSuccess();else{var d={cometDAdapterId:b._cometd.getClientId(),successful:!1,error:c.error,failure:a(c.failure),advice:a(c.advice)};b._logger.low("CometD-Connect",d),b._sm.connectError()}})},d.prototype.simulateDisconnection=function(a){a?this._sm.connectError():this._sm.connectSuccess()},d.prototype.raiseReqError=function(a){this.notification.showFatal(a)},d.prototype.registerHandshakeListener=function(){var e=this;this._handshakeListener=this._cometd.addListener(d.HANDSHAKE_CHANNEL,function(f){if(f.successful){f.ext&&(d.streamingMetadata=a.extend({},[f.ext]));var g=d.streamingMetadata[d.HNDSK_SERVER_VER],h=d.streamingMetadata[d.HNDSK_SERVER_PROTOCOL];if(e._componentName=d.streamingMetadata[d.HNDSK_COMPONENT],e._logger.low("CometD-Handshake",{cometDAdapterId:e._cometd.getClientId(),successful:!0,supportedTransports:f.supportedConnectionTypes.join(","),serverVer:g,protocolVer:h}),e._logger.low("CometD-Handshake",d.streamingMetadata),e._ackEnabled=f.ext&&f.ext.ack,g)if(a.IonVersion.fromIonString(g).lt(a.IonVersion.fromIonString("101p2"))){var i=a.stringFormat(b.Strings.Err_Streaming_Server_Version_Not_Supported,{themeName:g});e.raiseReqError(i)}else if(e._streamingServerModule)e._streamingServerModule.version=g;else{var j=e.moduleService.modules.filter(function(a){return a.name===d.serviceModuleName});j.forEach(function(a){e.moduleService.removeModule(a)}),e._streamingServerModule=e.moduleService.addModule(d.serviceModuleName,d.serviceModuleDisplayName,g,e._componentName)}else e.moduleService.removeModule(e._streamingServerModule);if(h)try{e._hasReservedStreams=new c(h).gte(1,4)}catch(a){return void e.raiseReqError(a.message)}e._sm.handshakeCompleted()}else f.failure&&"websocket"===f.failure.connectionType&&1002==f.failure.websocketCode?e._logger.low("CometD-Handshake",{cometDAdapterId:e._cometd.getClientId(),successful:!1,error:"websocket unsupported"}):e._logger.low("CometD-Handshake",{cometDAdapterId:e._cometd.getClientId(),successful:!1,error:f.error})})},d.prototype.registerDataChannelListener=function(){var a=this;try{return this._dataChannelListener=this._cometd.subscribe(this._datachannel,function(c){var d=b.stats.now(),e=c.data[c.data.length-1],f=a._messageHandlers[e];f&&f(c,d)}),!0}catch(a){return this.logCometdExc(a,"registerDataChannelListener"),!1}},d.prototype.registerReservedStreamHandlers=function(a){var b=this;if(a){var c=a.RtdCallsStreamDescriptor;if(c){this._logger.low("ReservedStreams",{cometDAdapterId:this._cometd.getClientId(),rtd:c.sid});var d=new g(c.DataSchema);this.registerStreamHandler(c.sid,function(a,c){var e=d.decode(a),f=c-e.ClientTs;b._logger.high("rtd",{cometDAdapterId:b._cometd.getClientId(),sent:e.ClientTs,rtd:f}),b.statTables.conn.storeRtdValue(e.ClientTs,f,b.probePeriodSec)})}}},d.prototype.scheduleRtdMeasure=function(){var a=this;this._rtdInterval||(this.statime=this._ionServer.statime,this.probePeriodSec=Math.max(1,Math.round(this.statime/5)),this._logger.low("RtdTimer",{cometDAdapterId:this._cometd.getClientId(),probePeriodS:this.probePeriodSec}),this._rtdInterval=setInterval(function(){return a.sendRtdMessage()},1e3*this.probePeriodSec))},d.prototype.cancelRtdMeasure=function(){this._rtdInterval&&(clearInterval(this._rtdInterval),this._rtdInterval=0)},d.prototype.sendRtdMessage=function(){this._ionServer.statime!==this.statime&&(this.cancelRtdMeasure(),this.scheduleRtdMeasure());var a={RequestID:this.getAndIncrementRequestId(),Request:"RTD_REQ",ClientTs:b.stats.now()};try{this._cometd.publish(d.RTD_CHANNEL,a)}catch(a){this.logCometdExc(a,"sendRtdMessage")}},d.prototype.registerSubscriptionListener=function(){var a=this;this._subscriptionChannelListener=this._cometd.addListener(d.SUBSCRIPTION_CHANNEL,function(b){var c=b.data.RequestID;if(c===a.mpxRequestId)a._mpxTimeout&&(a._timeout.cancel(a._mpxTimeout),a._mpxTimeout=null),"SUCCESS"!==b.data.Outcome?(a._logger.low("MultiplexChannel",{cometDAdapterId:a._cometd.getClientId(),creation:"failed"}),a._sm.mpxChannelFailed(!0)):(a._logger.low("MultiplexChannel",{cometDAdapterId:a._cometd.getClientId(),creation:"success"}),a._datachannel=b.data.DataChannel,a.registerDataChannelListener()?(a._hasReservedStreams&&(b.data.ReservedStreams?a.registerReservedStreamHandlers(b.data.ReservedStreams):a._logger.low("No server streams in handshake")),a.scheduleRtdMeasure(),a.statTables.setComponentName(a._componentName),a.statService.startConnectionStatistics(),a._sm.mpxChannelReady()):a._sm.mpxChannelFailed(!0));else{var d=a._outstandingRequests[c];d?(a._logger.low("MultiplexChannel",{cometDAdapterId:a._cometd.getClientId(),messageId:c,handling:!0}),d.timeout&&a._timeout.cancel(d.timeout),d.handler.onSuccess(b),delete a._outstandingRequests[c]):a._logger.low("MultiplexChannel",{cometDAdapterId:a._cometd.getClientId(),messageId:c,handling:!1})}})},d.prototype.startBackOffTimer=function(){var a=this;this._backOffTimeout=this._timeout(function(){a._backOffTimeout=null,a._sm.backOffExpired()},3500)},d.prototype.stopBackOffTimer=function(){this._backOffTimeout&&(this._timeout.cancel(this._backOffTimeout),this._backOffTimeout=null)},d.prototype.sendHandshake=function(){var a={component:this._connectionOptions.component,token:base64.encode(this._connectionOptions.token),clientProtocolVersion:"1.4"};this._logger.low("CometD-Handshake",a),this._cometd.handshake({ext:a})},d.prototype.raiseConnected=function(a){this._connected=!0,this.connectionChanged.raise(this,{connected:!0,isNewSession:a})},d.prototype.raiseDisconnected=function(){this._connected=!1,this.connectionChanged.raise(this,{connected:!1})},d.prototype.logCometdExc=function(a,b){a instanceof Error?this._logger.logExc(a,b):this._logger.low(b,{exc:a})},d.prototype.requestMpxChannel=function(){this._logger.low("MultiplexChannel",{action:"requestMpxChannel"}),this.removeDataChannelListener(),this.mpxRequestId=this.getAndIncrementRequestId();var a={Request:d.CREATE_MULTIPLEX_CHANNEL_MSG,RequestID:this.mpxRequestId};try{this._cometd.publish(d.SUBSCRIPTION_CHANNEL,a)}catch(a){return this.logCometdExc(a,"scheduleMpxChannelFailed"),void this.scheduleMpxChannelFailed()}this.scheduleMpxChannelFailed()},d.prototype.scheduleMpxChannelFailed=function(){var a=this;this._mpxTimeout=this._timeout(function(){a._mpxTimeout&&(a._timeout.cancel(a._mpxTimeout),a._mpxTimeout=null),a._logger.low("MultiplexChannel",{action:"mpxChannelFailed",reason:"mpxTimeoutElapsed"}),a._sm.mpxChannelFailed(!1)},d.REQUEST_TIMEOUT)},d.prototype.getAndIncrementRequestId=function(){return(this.requestCounter++).toString()},d.prototype.publishSubscriptionMessage=function(a,b){var c=this;a.RequestID=this.getAndIncrementRequestId(),a.DataChannel=this._datachannel;var e,f;f=function(b){b.successful||(c._logger.low("CometD-PublishResponse",{cometDAdapterId:c._cometd.getClientId(),msgId:b.id,successful:b.successful,requestID:a.RequestID,failure:b.failure}),c._outstandingRequests[a.RequestID]&&(c._outstandingRequests[a.RequestID].timeout=c.createRequestTimeout(a.RequestID)))},this._outstandingRequests[a.RequestID]={handler:b,timeout:e},this._cometd.publish(d.SUBSCRIPTION_CHANNEL,a,f)},d.prototype.handleFailedRequest=function(a){var b=this._outstandingRequests[a];b&&(b.handler.onFailure(),delete this._outstandingRequests[a])},d.prototype.createRequestTimeout=function(a){var b=this;return this._timeout(function(){b.handleFailedRequest(a)},d.REQUEST_TIMEOUT)},d.prototype.removeDataChannelListener=function(){if(this._dataChannelListener){try{this._cometd.unsubscribe(this._dataChannelListener)}catch(a){this.logCometdExc(a,"removeDataChannelListener")}this._dataChannelListener=null}},d.prototype.sendDisconnect=function(){this._logger.low("CometD-Disconnect",{cometDAdapterId:this._cometd.getClientId()}),"disconnected"!==this._cometd.getStatus()&&this._cometd.disconnect(!1,{},this.disconnectionHandler)},d.prototype.disconnect=function(){var a=this,b=Q.defer();return this.disconnectionHandler=function(){b.resolve(null),a.disconnectionHandler=function(){return null}},b.promise.timeout(2e3,"Timeout in streaming disconnection").catch(function(){return null})},d.prototype.dispose=function(){var a=this.disconnect();return this._cometd.removeListener(this._handshakeListener),this._cometd.removeListener(this._subscriptionChannelListener),this._cometd.removeListener(this._connectChannelListener),this.cancelRtdMeasure(),this.removeDataChannelListener(),this._sm.disconnect(),a},d.prototype.reconnect=function(a){this._connectionOptions=a,this._sm.reconnect()},d.prototype.startNewConnection=function(){var a=this;this._logger.low("CommDisconnect",{cometDAdapterId:this._cometd.getClientId()}),this.disconnect().then(function(){a.doReconnect(),a._sm.newConnectionReady()}),this.sendDisconnect()},d.prototype.doReconnect=function(){this.raiseDisconnected(),this._logger.low("CommConnect",{cometDAdapterId:this._cometd.getClientId(),url:this._connectionOptions.url}),this._cometd.configure({url:this._connectionOptions.url})},d.CREATE_MULTIPLEX_CHANNEL_MSG="CREATE_PRIVATE_MULTIPLEX_CHANNEL",d.SUBSCRIPTION_CHANNEL="/service/subscriptions",d.RTD_CHANNEL="/service/rtd",d.HANDSHAKE_CHANNEL="/meta/handshake",d.CONNECT_CHANNEL="/meta/connect",d.REQUEST_TIMEOUT=1e4,d.Streaming_Module_Component_Name="ionweb.streaming.server",d.Streaming_Status_Component_Name="Streaming",d.HNDSK_SERVER_VER="_ION_WEB_STREAMING_SERVER_VERSION",d.HNDSK_SERVER_PROTOCOL="_ION_WEB_STREAMING_PROTOCOL_VERSION",d.HNDSK_COMPONENT="_ION_COMPONENT",d.streamingMetadata={},d}(),e=function(){function b(b){this.logger=b,this.connectionChanged=new a.Event}return Object.defineProperty(b.prototype,"adapter",{get:function(){return this._adapter},set:function(a){var b=this;this.unsub&&(this.unsub(),this.unsub=null),this._adapter=a,this._adapter&&(this.unsub=this._adapter.connectionChanged.add(function(a,c){b.connectionChanged.raise(b,c)}))},enumerable:!0,configurable:!0}),b.prototype.check=function(){return!!this._adapter||(this.logger.low("CommServiceAdapterWrapper",{"check adapter instance":"null/undefined"}),!1)},b.prototype.isConnected=function(){return!!this._adapter&&this._adapter.isConnected()},b.prototype.publishSubscriptionMessage=function(a,b){this.check()&&this._adapter.publishSubscriptionMessage(a,b)},b.prototype.registerStreamHandler=function(a,b){this.check()&&this._adapter.registerStreamHandler(a,b)},b.prototype.removeStreamHandler=function(a){this.check()&&this._adapter.removeStreamHandler(a)},Object.defineProperty(b.prototype,"id",{get:function(){return this._adapter?this._adapter.id:"<waiting>"},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"componentName",{get:function(){return this._adapter?this._adapter.componentName:null},enumerable:!0,configurable:!0}),b}(),f=function(){function c(a,c,d,f,g,h,i,j,k){var l=this;this.ionLoggerFactory=a,this.notification=c,this.confService=d,this.excHelper=f,this.ionServer=g,this._timeout=h,this.statService=i,this.moduleService=j,this.env=k,this.fcallId=0,this.transactionId=0,this.connOpts=null,this._subCount=0,this.logger=this.ionLoggerFactory.create("CommSrvSImpl","comm"),this.statTables=new b.stats.StatTables(i);var m=function(a){var b=g.isLoggedIn();if(b&&a&&a.streamingData)l.logger.low("ServerConnected"),l.loadCometd().then(function(b){l.connect(b,a.streamingData)}).done();else if(!b||a&&(a.isLogout||a.isKilled)){l.logger.low("ServerDisconnected");var c=l.disconnect();a&&(a.delayReload=c)}};this.ionServer.statusChanged.add(function(a,b){return m(b)}),g.isLoggedIn()&&m(this.ionServer.getLastLoginStatus()),this._commAdapterWrapper=new e(this.logger),this.notification.addServiceForOffline(this.serviceStatusName)}return Object.defineProperty(c.prototype,"serviceModuleName",{get:function(){return d.serviceModuleName},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"serviceModuleDisplayName",{get:function(){return d.serviceModuleDisplayName},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"serviceStatusName",{get:function(){return d.serviceStatusName},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"streamingMetadata",{get:function(){return d.streamingMetadata},enumerable:!0,configurable:!0}),c.prototype.loadCometd=function(){var a=this;return this.cometdLib?this.cometdLib:(this.logger.low("loadCometD"),this.cometdLib=b.CometDFactory.create().then(function(b){if(b){var c,d,e=function(){var e="undefined"==typeof a.confService.config.shell.webSocketsEnabled||a.confService.config.shell.webSocketsEnabled;if(!d||c!==e){d=!0,c=e;var f=a.env.has("safari"),g=a.env.has("ios");a.logger.low("websocketEnabled",{config:c,isSafari:f,isIos:g}),b.websocketEnabled=c&&!(f||g)}};e(),a.confService.changed.add(function(){return e()}),b.onListenerException=function(b){a.excHelper.report(b)}}return b}))},c.prototype.subscribe=function(a){var c=new b.SubscriptionAdapter(this._commAdapterWrapper,this.ionLoggerFactory.create("CommSub_"+this._subCount++,"comm"),a,this.excHelper,this.statTables);return c.startSubscription(),c},c.checkBASE64Character=function(a,b){return""===a?(a=window.btoa(a),b.setAttribute("encoding","BASE64")):b.setAttribute("encoding","PLAIN"),a},c.appendIndexArgs=function(a,b,d){for(var e=0;e<b.length;e++){var f=a.ownerDocument.createElementNS(c.IONBUS_PROTOCOL_NAMESPACE,"Field"),g=this.checkBASE64Character(b[e],f);f.setAttribute("index",e.toString());var h=f.ownerDocument.createTextNode(g);f.appendChild(h);var i;i=d&&d[e]?d[e]:"number"==typeof g?g.toString().indexOf(".")>-1?"REAL":"INT":"STRING",f.setAttribute("type",i),a.appendChild(f)}},c.appendNamedArgs=function(a,b,d){for(var e in b)if(b.hasOwnProperty(e)){var f,g=a.ownerDocument.createElementNS(c.IONBUS_PROTOCOL_NAMESPACE,"Field"),h=this.checkBASE64Character(b[e],g);f=d&&d[e]?d[e]:"number"==typeof h?"INT":"STRING",g.setAttribute("type",f),g.setAttribute("name",e);var i=g.ownerDocument.createTextNode(h);g.appendChild(i),a.appendChild(g)}},c.prototype.processRestFail=function(b,d,e){this.logger.low(e,{SessionId:this.ionServer.getServerSessionID(),id:d,err:b});var f=new Error(c.HTTP_ERR_MESSAGE);return f.message=b,f.code=c.HTTP_ERR_CODE,f.errorClass=a.ErrorClass.ClientError,f},c.prototype.decodeRestRespCode=function(b,c){if(!c)return null;var d=Number(c.responseCode);if("SUCCESS"!==b||0!==d){var e=new Error(c.responseStr);return e.code=d,e.errorClass=d<=-100&&d>=-999?a.ErrorClass.ServerError:a.ErrorClass.ComponentError,e}return null},c.prototype.invoke=function(b){function d(a){return"BASE64"===a.encoding?window.atob(a.__text):"REAL"===a.type||"INT"===a.type||"DATE"===a.type||"TIME"===a.type?Number(a.__text):a.__text}function e(a){return(Array.isArray(a)?a:[a]).reduce(function(a,b){return a[b.name]=d(b),a},{})}function f(a){return(Array.isArray(a)?a:[a]).map(function(a){return d(a)})}function g(a){var b={values:{},varValues:[],message:a.ServerResponse.responseStr,code:parseInt(a.ServerResponse.responseCode)};return a.ResponseFields&&(b.values=e(a.ResponseFields.Field),a.ResponseFieldsByIndex&&(b.varValues=f(a.ResponseFieldsByIndex.Field))),b}var h=this,i=this.fcallId++;this.logger.low("FCallOut",{SessionId:this.ionServer.getServerSessionID(),id:i,name:b.name});var j=new a.XmlDom(c.WEBSERVER_PROTOCOL_NAMESPACE,"FunctionCall");j.attr("functionName",b.name);var k=j.append("RequestIdentifier");if(k.textContent=i.toString(),b.namedArgs&&Object.keys(b.namedArgs).length>0){var l=j.append("ArgsByName");c.appendNamedArgs(l,b.namedArgs,b.namedTypes)}if(b.varArgs&&b.varArgs.length>0){var m=j.append("ArgsByIndex");c.appendIndexArgs(m,b.varArgs,b.varTypes)}var n=this.ionServer.post("r/invoke/function/post",{direct:!0,category:a.rest.DATA_CATEGORY}).data(j.toString(),"application/xml");return n.send().then(function(a){var b=a.data.FunctionResponse;if(!b)throw h.processRestFail("nodata",i,"FCallInErr");h.logger.low("FCallIn",{SessionId:h.ionServer.getServerSessionID(),id:i,outcome:b.ExecutionOutcome});var c=h.decodeRestRespCode(b.ExecutionOutcome,b.ServerResponse);if(c)throw c;return g(b)},function(a){throw h.processRestFail(a.message,i,"FCallInErr")})},c.prototype.transact=function(d){var e=this;if(!a.isObject(d.fields))throw new Error(b.Strings.Err_FieldsParam_ShouldBe_AnObject);var f=this.transactionId++;this.logger.low("TransOut",{SessionId:this.ionServer.getServerSessionID(),id:f,name:d.id});var g=new a.XmlDom(c.WEBSERVER_PROTOCOL_NAMESPACE,"TransactionRequest"),h=g.append("RequestIdentifier");h.textContent=f.toString();var i=g.append("Record");i.setAttribute("id",d.id);var j=g.appendNS(c.IONBUS_PROTOCOL_NAMESPACE,"Fields",i);c.appendNamedArgs(j,d.fields,d.types);var k=this.ionServer.post("r/invoke/transaction",{direct:!0,category:a.rest.DATA_CATEGORY}).data(g.toString(),"application/xml");return k.send().then(function(a){var b=a.data.TransactionResponse;if(!b)throw e.processRestFail("nodata",f,"TransInErr");e.logger.low("TransIn",{SessionId:e.ionServer.getServerSessionID(),id:f,outcome:b.ExecutionOutcome});var c=e.decodeRestRespCode(b.ExecutionOutcome,b.ServerResponse);if(c)throw c},function(a){throw e.processRestFail(a.message,f,"TransInErr")})},c.prototype._doConnect=function(b){var c=this;this.logger.low("CommConnect",{cometDAdapterId:b.getClientId(),url:this.connOpts.url}),this.notification.status(this.serviceStatusName,a.ServiceStatus.Connecting,null,this.serviceModuleDisplayName);var e=6e4;this.confService.config.shell&&this.confService.config.shell.maxNetworkDelay&&(e=this.confService.config.shell.maxNetworkDelay),b.configure({url:this.connOpts.url,maxNetworkDelay:e}),this._commAdapterWrapper.adapter=this._commAdapter=new d(b,this.connOpts,this.ionLoggerFactory,this.ionServer,this._timeout,this.excHelper,this.notification,this.statService,this.moduleService,this.statTables),this._commAdapter.connectionChanged.add(function(b,d){c.notification.status(c.serviceStatusName,d.connected?a.ServiceStatus.Connected:a.ServiceStatus.Connecting,null,c.serviceModuleDisplayName)}),this._commAdapter.start()},c.prototype.connect=function(b,c){null!==this.connOpts?a.equals(this.connOpts,c)?this.logger.low("CommConnectSkip",{cometDAdapterId:b.getClientId()}):(this.notification.status(this.serviceStatusName,a.ServiceStatus.Connecting,null,this.serviceModuleDisplayName),this.connOpts=c,this._commAdapter.reconnect(c)):(this.notification.status(this.serviceStatusName,a.ServiceStatus.Connecting,null,this.serviceModuleDisplayName),this.connOpts=c,this._doConnect(b))},c.prototype.disconnect=function(){var a;return this._commAdapter?(a=this._commAdapter.dispose(),this._commAdapterWrapper.adapter=this._commAdapter=null):a=Q.when(),a},c.prototype.simulateDisconnection=function(a){this._commAdapter&&this._commAdapter.simulateDisconnection(a)},c.prototype.ssonCall=function(b,d){var e=this,f=new a.XmlDom("http://www.iontrading.com/ionweb/services/ionbus/gpi","SSONCall"),g=f.append("MarketCalls");d.forEach(function(a){var b=f.append("MarketCall",g);if(b.setAttribute("source",a.source),b.setAttribute("currency",a.currency),a.namedArgs&&Object.keys(a.namedArgs).length>0){var d=f.append("ArgsByName",b);c.appendNamedArgs(d,a.namedArgs,a.namedTypes)}if(a.varArgs&&a.varArgs.length>0){var e=f.append("ArgsByIndex",b);c.appendIndexArgs(e,a.varArgs,a.varTypes)}});var h=function(b){if(b){var c;switch(b.FailureType){case"NO_SERVICES":c=a.cm.SsonFailureType.NoServices;break;case"SSON_TIMEOUT":c=a.cm.SsonFailureType.SsonTimeout;break;case"USER_SERVICES_FUNCTION_ERROR":c=a.cm.SsonFailureType.UserServicesFunctionError;break;case"DAEMON_ERROR":c=a.cm.SsonFailureType.DaemonError;break;case"GENERIC_EXCEPTION":c=a.cm.SsonFailureType.GenericException}return{message:b.message,type:c}}},i=function(b){switch(b){case"MARKET_COMPONENT_REGISTRATION_ERROR":return a.cm.MarketCallFailureType.MarketComponentRegistrationError;case"MARKET_GENERIC_ERROR":return a.cm.MarketCallFailureType.MarketgenericError;case"ALREADY_LOGGED":return a.cm.MarketCallFailureType.AlreadyLogged;case"REGISTRATION_NOT_FOUND":return a.cm.MarketCallFailureType.RegistrationNotFound;case"TIMEOUT":return a.cm.MarketCallFailureType.Timeout;case"MARKET_NOT_CONFIGURED":return a.cm.MarketCallFailureType.MarketNotConfigured;case"GENERIC_EXCEPTION":return a.cm.MarketCallFailureType.GenericException}},j=function(a){return a?Array.isArray(a)?a:[a]:[]},k=function(a){return j(a).reduce(function(a,b){return a[b.marketSource]={outcome:"SUCCESS"===b.ExecutionOutcome,failureType:i(b.FailureType),username:b.Username,response:b.Response},a},{})};this.logger.low("SsonCallOut",{SessionId:this.ionServer.getServerSessionID(),url:b});var l=this.ionServer.post(b,{direct:!0,category:a.rest.DATA_CATEGORY}).data(f.toString(),"application/xml");return l.send().then(function(a){var c=a&&a.data&&a.data.SSONServiceResponse;if(!c)throw e.processRestFail("nodata",b,"SsonCallErr");e.logger.low("SsonCallIn",{SessionId:e.ionServer.getServerSessionID(),url:b,outcome:c.ExecutionOutcome});var d=e.decodeRestRespCode(c.ExecutionOutcome,c.ServerResponse);if(d)throw d;return{outcome:"SUCCESS"===c.ExecutionOutcome,failureDetails:h(c.FailureDetails),marketResponses:k(c.MarketResponses&&c.MarketResponses.MarketResponse)}},function(a){throw e.processRestFail(a.message,b,"SsonCallErr")})},c.prototype.ssonLogin=function(a){return this.ssonCall("r/sson/login",a)},c.prototype.ssonLogout=function(a){return this.ssonCall("r/sson/logout",a)},c.WEBSERVER_PROTOCOL_NAMESPACE="http://www.iontrading.com/ionweb/services/ionbus/gpi",c.IONBUS_PROTOCOL_NAMESPACE="http://www.iontrading.com/ionweb/services/ionbus",c.HTTP_ERR_CODE=1,c.EMPTYRESP_ERR_CODE=2,c.HTTP_ERR_MESSAGE="Cannot connect to the server",c.EMPTYRESP_ERR_MESSAGE="Empty/invalid response from the server",c}();b.CommService=f;var g=function(){function b(a){this.schema=a.slice(1)}return b.prototype.decode=function(b){var c=this;if(Array.isArray(b.data)){var d=base64.decode(b.data[0]),e={},f=0;return b.data.shift(),this.schema.forEach(function(g,h){a.isBitSet(d,h)&&(e[c.schema[h]]=b.data[f++])}),e}},b}();b.RequestReplyDecoder=g}(b=a.comm||(a.comm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){a[a.Ok=0]="Ok",a[a.EmptyResult=1]="EmptyResult",a[a.NotAvailable=2]="NotAvailable",a[a.PermissionError=3]="PermissionError",a[a.GenericException=4]="GenericException"}(b=a.QueryOutcome||(a.QueryOutcome={}))}(b=a.entitlement||(a.entitlement={}))}(b=a.comm||(a.comm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(b){var c="http://www.iontrading.com/ionweb/services/entitlements",d="http://www.w3.org/2001/XMLSchema-instance",e=function(){function a(a,b){this.features=b,this.resources=a}return a.prototype.toXml=function(a){var b=a.createElementNS(c,"rf");return this.resources.forEach(function(d){var e=a.createElementNS(c,"res");e.textContent=d,b.appendChild(e)}),this.features.forEach(function(d){var e=a.createElementNS(c,"feature");e.textContent=d,b.appendChild(e)}),b},a}(),f=function(){function a(a){this._namespace=a,this.featuresByResources=[]}return Object.defineProperty(a.prototype,"namespace",{get:function(){return this._namespace},enumerable:!0,configurable:!0}),a.prototype.addRequest=function(a,b){this.featuresByResources.push(new e(a,b))},a.prototype.toXml=function(a){var b=a.createElementNS(c,"service");return b.setAttribute("namespace",this._namespace),this.featuresByResources.forEach(function(c){b.appendChild(c.toXml(a))}),b},a}(),g=function(){function d(a,b){this.serverService=a,this.logger=b,this.genericByFeatureEntitlements=[]}return d.prototype.addRequest=function(a,b,c){this.logger.low("ByFeatureAddRequest",{namespace:a,resource:b,features:c});for(var d=void 0,e=0;e<this.genericByFeatureEntitlements.length;e++){var g=this.genericByFeatureEntitlements[e];if(g.namespace===a){d=g;break}}d||(d=new f(a)),d.addRequest(b,c),this.genericByFeatureEntitlements.push(d)},d.prototype.send=function(){var c=this,d=(new a.XmlDomFactory.XMLSerializer).serializeToString(this.toXml());return d='<?xml version="1.0" encoding="utf-8"?>'+d,this.logger.low("SendGenericByFeatureQuery",{xmlString:d}),this.serverService.post("r/entitlements/genericquery",{direct:!0,category:a.rest.DATA_CATEGORY}).data(d,"application/xml").send().then(function(a){var d=a.data.GenFeatureEntResponse;if("SUCCESS"!==d.Outcome){var e=d,f={outcome:b.QueryOutcome.NotAvailable,error:e.FailureDetails.FailureType,wasAllowed:!1};throw c.logger.medium("GenericQueryResponse",{outcome:b.QueryOutcome.NotAvailable,wasAllowed:f.wasAllowed}),f}var g=d;if("DENY"===g.AllowDeny){var h={outcome:b.QueryOutcome.Ok,wasAllowed:!1};throw c.logger.medium("GenericQueryResponse",{outcome:b.QueryOutcome.Ok,wasAllowd:h.wasAllowed}),h}var i=d,j={outcome:b.QueryOutcome.Ok,wasAllowed:!0,responseItems:c.byFeatureEntitlementItems(i)};return c.logger.medium("GenericQueryResponse",{outcome:b.QueryOutcome.Ok,allowd:j.wasAllowed,allowedItems:j.responseItems}),j})},d.prototype.byFeatureEntitlementItems=function(a){a.service instanceof Array||(a.service=[a.service]);for(var b=[],c=0;c<a.service.length;c++){var d=a.service[c];d.rf instanceof Array||(d.rf=[d.rf]);for(var e=0;e<d.rf.length;e++){var f=d.rf[e];f.res instanceof Array||(f.res=[f.res]),f.feature instanceof Array||(f.feature=[f.feature]);for(var g=0;g<f.res.length;g++)for(var h=f.res[g],i=0;i<f.feature.length;i++){var j=f.feature[i],k={namespace:f.namespace,resource:h,feature:j};b.push(k)}}}return b},d.prototype.toXml=function(){var b=a.XmlDomFactory.DOMImplementation.createDocument(null,"",null),d=b.createElementNS(c,"GenFeatureEntRequest");return this.genericByFeatureEntitlements.forEach(function(a){d.appendChild(a.toXml(b))}),d},d}(),h=function(){function d(a,b,c){this.serverService=a,this.username=b,this.logger=c,this.services=[],this.serverService=a,this.username=b,this.logger=c}return d.prototype.send=function(){var c=this,d=(new a.XmlDomFactory.XMLSerializer).serializeToString(this.toXml());return d='<?xml version="1.0" encoding="utf-8"?>'+d,this.logger.low("ByDataQuery",{xml:d}),this.serverService.post("r/entitlements/query",{direct:!0,category:a.rest.DATA_CATEGORY}).data(d,"application/xml").send().then(function(a){var d=a.data.EntitlementsResponse;if("SUCCESS"!==d.Outcome){var e=d,f={outcome:b.QueryOutcome.NotAvailable,error:e.FailureDetails.FailureType,wasAllowed:!1};throw c.logger.medium("ByDataQuery",{outcome:f.outcome,failureError:f.error}),f}var g=d;if("DENY"===g.AllowDeny){var h={outcome:b.QueryOutcome.Ok,wasAllowed:!1,responseItems:void 0};throw c.logger.medium("ByDataQuery",{outcome:h.outcome,allowed:h.wasAllowed}),h}var i={outcome:b.QueryOutcome.Ok,wasAllowed:!0,responseItems:c.flatEntItems(g)};return c.logger.low("ByDataQuery",{outcome:i.outcome,allowed:i.wasAllowed,allowedItems:i.responseItems}),i})},d.prototype.flatEntItems=function(a){for(var b=a.SFIL.Service instanceof Array?a.SFIL.Service:[a.SFIL.Service],c=[],d=0;d<b.length;d++)for(var e=b[d],f=e.Features.Feature instanceof Array?e.Features.Feature:[e.Features.Feature],g=0;g<f.length;g++)for(var h=f[g],i=e.Resources instanceof Array?e.Resources:[e.Resources],j=0;j<i.length;j++)for(var k=i[j],l=k.Container instanceof Array?k.Container:[k.Container],m=0;m<l.length;m++)for(var n=l[m],o=n.Object instanceof Array?n.Object:[n.Object],p=0;p<o.length;p++){var q=o[p],r={serviceType:e.Type.Id,source:e.Source.Id,container:n.Id,object:q.Id,feature:h.Id};c.push(r)}return c},d.prototype.toXml=function(){var b=a.XmlDomFactory.DOMImplementation.createDocument("","",null),d=b.createElementNS(c,"SFILWithMap");d.setAttribute("username",this.username);for(var e=0;e<this.services.length;e++){var f=this.services[e];d.appendChild(f.toXml(b))}return d},d}(),i=function(){function a(){this.attributes={}}return a.prototype.toXml=function(a){for(var b=a.createElementNS(c,"AttributesMap"),d=Object.keys(this.attributes),e=0;e<d.length;e++){var f=a.createElementNS(c,"Entry");f.setAttribute("key",d[e]),f.setAttribute("value",this.attributes[d[e]]),b.appendChild(f)}return b},a}();b.EntitlementAttributes=i;var j=function(a){function b(b,c){var d=a.call(this)||this;return d.serviceType=b,d.source=c,d.containers=[],d.features=[],d}return __extends(b,a),b.prototype.toXml=function(b){var e=b.createElementNS(c,"Service"),f=b.createElementNS(c,"Type");f.setAttributeNS(d,"type","HierarchicalNamespacePartWithMap"),f.setAttribute("Id",this.serviceType),e.appendChild(f);var g=b.createElementNS(c,"Source");g.setAttributeNS(d,"type","HierarchicalNamespacePartWithMap"),g.setAttribute("Id",this.source),e.appendChild(g);for(var h=b.createElementNS(c,"Features"),i=0;i<this.features.length;i++){var j=this.features[i],k=b.createElementNS(c,"Feature");k.setAttribute("Id",j),h.appendChild(k)}e.appendChild(h);var l=b.createElementNS(c,"Resources");for(i=0;i<this.containers.length;i++)l.appendChild(this.containers[i].toXml(b));
return e.appendChild(l),e.appendChild(a.prototype.toXml.call(this,b)),e},b}(i);b.Service=j;var k=function(a){function b(b){var c=a.call(this)||this;return c.name=b,c.objects=[],c}return __extends(b,a),b.prototype.toXml=function(b){var d=b.createElementNS(c,"Container");d.setAttribute("Id",this.name),d.appendChild(a.prototype.toXml.call(this,b));for(var e=0;e<this.objects.length;e++)d.appendChild(this.objects[e].toXml(b));return d},b}(i);b.Container=k;var l=function(a){function b(b){var c=a.call(this)||this;return c.name=b,c}return __extends(b,a),b.prototype.toXml=function(b){var d=b.createElementNS(c,"Object");return d.setAttribute("Id",this.name),d.appendChild(a.prototype.toXml.call(this,b)),d},b}(i);b.RecordObject=l;var m=function(){function a(a,b){this.serverService=a,this.logger=b.create("EntitlementService")}return a.prototype.dataQuery=function(a){return new h(this.serverService,a,this.logger)},a.prototype.genericByFeatureQuery=function(){return new g(this.serverService,this.logger)},a}();a.module("ionwebComm").service("entitlementService",["ionweb.serverService","ionweb.loggerFactory"],function(a,b){return new m(a,b)})}(c=b.entitlement||(b.entitlement={}))}(b=a.comm||(a.comm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){}return a.Component_DisplayName_Streaming="Streaming",a.Err_Missing_MetaData="Missing meta data to process message ${ION_Action}",a.Err_InvalidOperation_New_ListRecord_Required="Invalid operation: new field list/record list required",a.Err_RecordGroup_SubscriptionUpdate_RecordList="Only RecordGroup subscription can update the record list",a.Err_Server_Version_Too_Low="Server version too low",a.Err_Unable_To_Negotiate_Protocol_Version="Unable to negotiate protocol version",a.Err_Streaming_Server_Version_Not_Supported="Streaming server ${serverVer} not supported",a.Err_Streaming_Protocol_Version_Not_Supported="Streaming protocol ${serverVersion} not supported",a.Err_FieldsParam_ShouldBe_AnObject="The fields param should be an object",a}();a.Strings=b}(b=a.comm||(a.comm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){function b(){return(c++).toString()}var c=0,d=function(){function c(a){this.getComponent=a,this.subscriptions={},this.subRecs=0,this.subFields=0,this.updRec=0,this.updField=0,this.pUpdRec=0,this.pUpdField=0,this.sendToServer=!0,this.name="ComponentStatistics"}return c.prototype.register=function(a,c,d){a._uid=b(),this.subscriptions[a._uid]={fields:d,innerRecs:c},this.subRecs+=1+c,this.subFields+=d},c.prototype.unregister=function(a){var b=this.subscriptions[a._uid];b&&(this.subRecs-=b.innerRecs+1,this.subFields-=b.fields,delete this.subscriptions[a._uid]),a._uid=void 0},c.prototype.updateInnerRecCount=function(a,b){var c=this.subscriptions[a._uid];if(c){var d=c.innerRecs;c.innerRecs=b,this.subRecs=this.subRecs-d+b}},c.prototype.updateFieldCount=function(a,b){var c=this.subscriptions[a._uid];if(c){var d=c.fields;c.fields=b,this.subFields=this.subFields-d+b}},c.prototype.supply=function(a,b){this.updRec++,this.updField+=b,this.pUpdRec++,this.pUpdField+=b},c.prototype.getCounters=function(b){var c={Component:this.getComponent(),Freq:b.statPeriod,ReportTime:a.timeToString(a.now()),SubRec:this.subRecs,SubField:this.subFields,SupRec:0,SupField:0,UpdRec:this.updRec,UpdField:this.updField,pUpdRec:this.pUpdRec,pUpdField:this.pUpdField};return this.pUpdRec=this.pUpdField=0,c},c}();a.CompStats=d}(b=a.stats||(a.stats={}))}(b=a.comm||(a.comm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){var b=function(){function b(a){this.getComponent=a,this.rtdPeakIndex=-1,this.rtdValues=[],this.rtdPeriod=0,this.sendToServer=!0,this.name="ConnectionStatistics"}return b.prototype.storeRtdValue=function(a,b,c){this.rtdPeakIndex>=0?b>this.rtdValues[this.rtdPeakIndex].rtd&&(this.rtdPeakIndex=this.rtdValues.length):this.rtdPeakIndex=0,this.rtdPeriod=c,this.rtdValues.push({ts:a,rtd:b})},b.prototype.getCounters=function(b){var c=this.rtdValues.length,d=c?this.rtdValues.reduce(function(a,b){return a+b.rtd},0)/c:0,e={Owner:b.busCompName,ComponentName:this.getComponent(),Freq:this.rtdPeriod,ReportTime:a.timeToString(a.now()),RTDAvg:Number(d.toFixed(0)),RTDMsg:c,RTDPeak:Number((this.rtdPeakIndex>=0?this.rtdValues[this.rtdPeakIndex].rtd:0).toFixed(0)),RTDPeakTime:a.timeToString(this.rtdPeakIndex>=0?this.rtdValues[this.rtdPeakIndex].ts:0)};return this.rtdValues=[],this.rtdPeakIndex=-1,e},b}();a.ConnStats=b}(b=a.stats||(a.stats={}))}(b=a.comm||(a.comm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){var b=10,c=9e5,d=function(){function d(){this.totUpdates=0,this.delayBaseline=0,this.first=!0,this.minOffset=0,this.thresholdExceededTime=0,this.minExceedingDelay=0,this.reset()}return d.prototype.reset=function(){this.numUpdates=0,this.delayMinAdjusted=0,this.delayMaxAdjusted=0,this.delayMaxTime=-1,this.delayAdjustedSum=0},d.prototype.sampleSupplyTimestamps=function(a,d){this.totUpdates++;var e=d-a;this.first?(this.delayBaseline=e,this.first=!1):e<this.delayBaseline?this.delayBaseline=e:e>b+this.delayBaseline?0===this.thresholdExceededTime?(this.thresholdExceededTime=d,this.minExceedingDelay=e):(e<this.minExceedingDelay&&(this.minExceedingDelay=e),d-this.thresholdExceededTime>=c&&(this.delayBaseline=this.minExceedingDelay)):(this.thresholdExceededTime=0,this.minExceedingDelay=0);var f=e-this.delayBaseline;(f<this.delayMinAdjusted||0===this.numUpdates)&&(this.delayMinAdjusted=f),(f>this.delayMaxAdjusted||0===this.numUpdates)&&(this.delayMaxAdjusted=f,this.delayMaxTime=d),this.numUpdates++,this.delayAdjustedSum+=f},d.prototype.toStat=function(){var b=0;this.numUpdates>0&&(b=this.delayAdjustedSum/this.numUpdates);var c={TotUpdates:this.totUpdates,NumUpdates:this.numUpdates,DelayAvg:Number(b.toFixed(0)),DelayMin:Number(this.delayMinAdjusted.toFixed(0)),DelayMax:Number(this.delayMaxAdjusted.toFixed(0)),DelayMaxTime:a.timeToString(this.delayMaxTime)};return this.reset(),c},d}(),e=function(){function b(){this.e2eTable={},this.sendToServer=!0,this.name="E2EStatistics"}return b.prototype.storeE2EDelay=function(a,b,c){var e=this.e2eTable[a];e||(e=this.e2eTable[a]=new d),e.sampleSupplyTimestamps(b,c)},b.prototype.getCounters=function(b){var c=this,d=a.timeToString(a.now()),e=Object.getOwnPropertyNames(this.e2eTable).map(function(a){var e=c.e2eTable[a].toStat();return e.ReportTime=d,e.Publisher=a,e.Subscriber=b.busCompName,e});return e},b}();a.E2EStats=e}(b=a.stats||(a.stats={}))}(b=a.comm||(a.comm={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){function b(){return(new Date).getTime()}function c(a){if(a<0)return"";if(!a)return"00:00:00:000";var b=function(a,b){for(var c=a.toString();c.length<b;)c="0"+c;return c},c=new Date(a);return b(c.getHours(),2)+":"+b(c.getMinutes(),2)+":"+b(c.getSeconds(),2)+":"+b(c.getMilliseconds(),3)}a.now=b,a.timeToString=c;var d=function(){function b(b){var c=this;this.conn=new a.ConnStats(function(){return c.componentName}),this.e2e=new a.E2EStats,this.comp=new a.CompStats(function(){return c.componentName}),b.registerStatProvider(this.conn),b.registerStatProvider(this.e2e),b.registerStatProvider(this.comp)}return b.prototype.setComponentName=function(a){this.componentName=a},b}();a.StatTables=d}(b=a.stats||(a.stats={}))}(b=a.comm||(a.comm={}))}(ionweb||(ionweb={})),ionweb.services.registerCoreSubmodule("ionwebComm",["ionwebCore"],ionweb.comm.Strings);var ionweb;!function(a){var b;!function(b){function c(a,b,c,d){for(var e=[],f=new Array(a.length),g=0;g<a.length;g++){var h=c(a[g]);if(f[g]=h,d[g]=h.pinned,e.length<b.length)for(;e.length<b.length&&h.age<=b[e.length];)e.push(g)}for(;e.length<b.length;)e.push(a.length);return{groups:e,items:f}}function d(b,c,d,e,f){if(void 0===f&&(f=[]),!(d-c<1)){do{for(var g=c;g<d;){var h=b[g].age-b[g+1].age;if(e.altDistanceIfEquals&&b[g].content&&b[g+1].content&&a.equals(b[g].content,b[g+1].content)){if(h>e.altDistanceIfEquals)break}else if(h>e.distance)break;g++}g>c?(f.push({start:c,end:g-1}),c=g+1):c++}while(c<d);return f}}function e(a,b,c){b.section?a.section?(b.section.start=a.section.start,c.splice(c.indexOf(a.section),1)):b.section.start--:a.section?(b.section=a.section,b.section.end++):(b.section={start:a.itemIndex,end:a.itemIndex},c.unshift(b.section))}function f(a,b){for(var c=a.map(function(a,b){return{itemIndex:b}}),d=b.length-1;d>=0;d--){var e=b[d];c.splice(e.start,e.end-e.start+2,{section:e})}return c}function g(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(b[d.start])d.end===d.start?(a.splice(c,1),c--):(d.start++,c--);else if(b[d.end])d.end--,c--;else if(d.end-d.start>1)for(var e=d.start+1;e<d.end;e++)if(b[e]){var f={start:e+1,end:d.end};d.end=e-1,a.splice(c+1,0,f);break}}return a}function h(a,b,h,i){var j=[];if(!a||!b||0===b.length&&!(i>0))return j;var k=b.slice();k.sort(function(a,b){return b.age-a.age});var l=[],m=c(a,k.map(function(a){return a.age}),h,l),n=m.groups;n.unshift(0);for(var o=0;o<n.length-1;o++){var p=n[o],q=n[o+1]-1;d(m.items,p,q,k[o],j)}if(g(j,l),i>0)for(var r=f(a,j);r.length>i;)e(r[0],r[1],j),r.shift();return j}b.getGroups=c,b.coalesceGroup=d,b.uncoalesce=g,b.coalesce=h}(b=a.storages||(a.storages={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){a[a.MATCHING_USER_NOT_FOUND=0]="MATCHING_USER_NOT_FOUND",a[a.STORAGE_AREA_NOT_FOUND=1]="STORAGE_AREA_NOT_FOUND",a[a.USER_NOT_AUTHORIZED=2]="USER_NOT_AUTHORIZED",a[a.DATA_STORAGE_ERROR=3]="DATA_STORAGE_ERROR",a[a.STORAGE_AREA_ALREADY_EXISTS=4]="STORAGE_AREA_ALREADY_EXISTS",a[a.VERSION_MISMATCH_LOCKING_EXCEPTION=5]="VERSION_MISMATCH_LOCKING_EXCEPTION",a[a.DB_ERROR=6]="DB_ERROR",a[a.STORE_EXCEPTION=7]="STORE_EXCEPTION",a[a.MISSING_VERSION_NUMBER_ON_UPDATE=8]="MISSING_VERSION_NUMBER_ON_UPDATE",a[a.CREATING_CIRCULAR_RELATIONSHIP=9]="CREATING_CIRCULAR_RELATIONSHIP",a[a.UNSUPPORTED_OPERATION_ON_SYSTEM_FOLDER=10]="UNSUPPORTED_OPERATION_ON_SYSTEM_FOLDER",a[a.DELETING_NON_EMPTY_TREE_NODE=11]="DELETING_NON_EMPTY_TREE_NODE",a[a.MOVING_MULTI_OWNER_TREE_NODE=12]="MOVING_MULTI_OWNER_TREE_NODE",a[a.MULTI_OWNER_INCONSISTENCE=13]="MULTI_OWNER_INCONSISTENCE",a[a.NETWORK_ERROR=14]="NETWORK_ERROR",a[a.BAD_RESPONSE=15]="BAD_RESPONSE",a[a.MANDATORY_FIELD=16]="MANDATORY_FIELD"}(b=a.StorageErrorTypes||(a.StorageErrorTypes={}));var c;!function(a){a[a.NodeOnly=0]="NodeOnly",a[a.NodeAndChildren=1]="NodeAndChildren",a[a.Recursive=2]="Recursive"}(c=a.NodeRetrieveMode||(a.NodeRetrieveMode={}));var d;!function(a){a[a.Null=0]="Null",a[a.String=1]="String",a[a.Xml=2]="Xml",a[a.Json=3]="Json"}(d=a.ContentType||(a.ContentType={}));var e;!function(c){function f(a){return a?Array.isArray(a)?a:[a]:[]}function g(a,b){return"string"==typeof a?b[a]:a}function h(a){return"string"==typeof a?"true"===a:a}function i(a){return"string"==typeof a?parseInt(a):a}function j(a,d,e){var f=new Error(a);return f.storageErrorType=d,f.storageErrorTypeStr=b[d],f.affectedStoreMetadata=e,f.storageErrorTypeMessage=c.Strings["Err_Server_Code_"+f.storageErrorTypeStr],f}function k(a){var b=a.indexOf(":");return b>0&&(a=a.slice(b+1)),a}function l(a){if("string"==typeof a)return a;if("string"==typeof a.__text)return a.__text;throw new Error("Expected string content")}var m;!function(a){a[a.SUCCESS=0]="SUCCESS",a[a.FAILURE=1]="FAILURE"}(m||(m={}));var n;!function(b){b[b.ROOT_ONLY=a.NodeRetrieveMode.NodeOnly]="ROOT_ONLY",b[b.ROOT_AND_CHILDREN=a.NodeRetrieveMode.NodeAndChildren]="ROOT_AND_CHILDREN",b[b.RECURSIVE=a.NodeRetrieveMode.Recursive]="RECURSIVE"}(n||(n={}));var o="NullContent",p="StringContent",q="XmlContent",r="JsonContent",s="r/storage/action",t="application/xml",u="http://www.iontrading.com/ionweb/services/storage",v="http://www.w3.org/2001/XMLSchema-instance",w="id",x="retrieveMode",y="storageTypeFilter",z="newDisplayName",A="newParentID",B="version",C="recursive",D="ContentProperties",E="Content",F="path",G="SYSTEM_USER_HOME",H="SYSTEM_SHARED_ROOT",I="displayName",J="description",K="userData",L="storeType",M="parentID",N="ownerUsername",O="isTreeNode",P="uuid",R=function(){function R(b,c,d){var e=this;this.reqService=b,this.commService=c,this.serializer=new a.XmlDomFactory.XMLSerializer,this.storageSubscribers={},this.seqNo=0,this.sendRestComments=!1,this.metadataProcessed=new a.Event,this.logger=d.create("StorageService","storage"),this.logger.ifHigh(function(){return e.sendRestComments=!0,{key:"EnabledRestComments "}})}return R.prototype.raiseMetadataProcessed=function(a){this.metadataProcessed.raise(this,a)},Object.defineProperty(R.prototype,"systemUserHomeType",{get:function(){return G},enumerable:!0,configurable:!0}),Object.defineProperty(R.prototype,"systemSharedHomeType",{get:function(){return H},enumerable:!0,configurable:!0}),R.prototype.createRequest=function(b,c){var d=a.XmlDomFactory.DOMImplementation.createDocument("","",null),e=d.createElementNS(u,b);if(c&&this.sendRestComments){var f=d.createComment(c);e.appendChild(f)}return e},R.prototype.processStorageMetadata=function(a){var b=function(a){return a?{canRead:h(a.canRead),canReadWrite:h(a.canReadWrite),contentVersion:i(a.contentVersion),isTreeNode:h(a.isTreeNode),parentId:a.parentID,ownerUsername:a.ownerUsername,displayName:a.displayName,description:a.description,userData:a.userData,storeType:a.storeType,shared:h(a.shared),uuid:a.uuid}:null};return a&&{id:a.id,version:i(a.version),contentProperties:b(a.ContentProperties)}},R.prototype.processReadStorageResponse=function(a){var b=k(a.Content["xsi:type"]);switch(b){case p:a.contentType=d.String,a.content=a.Content.Content&&l(a.Content.Content);break;case q:a.contentType=d.Xml,delete a.Content["xsi:type"],a.content=a.Content;break;case r:a.contentType=d.Json,a.content=a.Content.Content&&JSON.parse(l(a.Content.Content));break;case o:a.contentType=d.Null,a.content=null}return a},R.prototype.processStorageResponse=function(a,c,d){var e=a.StorageResponse;if(!e)throw j("Cannot parse response",b.BAD_RESPONSE);if(e.Outcome=g(e.Outcome,m),e.Outcome===m.SUCCESS)return e.AffectedStoreMetadata&&(e.affectedStoreMetadata=this.processStorageMetadata(e.AffectedStoreMetadata),this.raiseMetadataProcessed(e.affectedStoreMetadata)),c.high("StorageResponse_"+d,{outcome:e.Outcome,affectedStoreMetadata:e.affectedStoreMetadata,storageAreasList:e.StorageAreasList}),e;if(e.FailureDetails){e.FailureDetails.FailureType=g(e.FailureDetails.FailureType,b);var f=e.FailureDetails;throw c.high("StorageResponseExc_"+d,f),j(f.message,f.FailureType,this.processStorageMetadata(e.AffectedStoreMetadata))}throw c.medium("StorageResponseFail_"+d),j("unknown failure",b.BAD_RESPONSE)},R.prototype.processStorageListResponse=function(a){var b=this;return a.StorageAreasList=f(a.StorageAreasList),a.storages=[],a.StorageAreasList.forEach(function(c){f(c.Storage).forEach(function(c){var d=b.processStorageMetadata(c);a.storages.push(d),b.raiseMetadataProcessed(d)})}),a},R.prototype.processStorageListsResponse=function(a){var b=this,c=[];return f(a.StorageAreasList).forEach(function(a){var d=f(a.Storage).map(function(a){var c=b.processStorageMetadata(a);return b.raiseMetadataProcessed(c),c});c.push({storages:d,affectedStoreMetadata:null})}),c},R.prototype.sendRequest=function(c,d,e){var f=this,g=this.reqService.post(s,{category:a.rest.DATA_CATEGORY,details:d}).data(this.serializer.serializeToString(c),t),h=this.seqNo++;return e._opName=d,this.logger.high("Request_"+h,e),g.send().then(function(a){return f.processStorageResponse(a.data,f.logger,h)},function(a){throw j(a.message||a.toString(),b.NETWORK_ERROR)})},R.prototype.listRoots=function(a){var b=this,c=this.createRequest("TreeNodeClientRootListRequest",a);return this.sendRequest(c,"listRoots",{}).then(function(a){return b.processStorageListResponse(a)})},R.prototype.loadAncestors=function(a,c){var d=this;if(!a)return Q.reject(j("ID is mandatory",b.MANDATORY_FIELD));var e=this.createRequest("AncestorsListRequest",c);return e.setAttribute(w,a),this.sendRequest(e,"loadAncestors",{storageId:a}).then(function(a){return d.processStorageListResponse(a)})},R.prototype.loadTree=function(c,d,e,f){var g=this;if(!c)return Q.reject(j("ID is mandatory",b.MANDATORY_FIELD));"undefined"==typeof d&&(d=a.NodeRetrieveMode.Recursive);var h=this.createRequest("TreeNodeLoadRequest",f);if(h.setAttribute(w,c),h.setAttribute(x,n[d]),e){var i=h.ownerDocument.createElementNS(u,y);i.textContent=e.join("|"),h.appendChild(i)}return this.sendRequest(h,"loadTree",{parentId:c,retrieveMode:d,filter:e}).then(function(a){return g.processStorageListResponse(a)})},R.prototype.loadContent=function(a,c){var d=this;if(!a)return Q.reject(j("ID is mandatory",b.MANDATORY_FIELD));var e=this.createRequest("LoadRequest",c);return e.setAttribute(w,a),this.sendRequest(e,"loadContent",{id:a}).then(function(a){return d.processReadStorageResponse(a)})},R.prototype._loadTreesByPath=function(b,c,d,e){var f=this;"undefined"==typeof c&&(c=a.NodeRetrieveMode.Recursive);var g=this.createRequest("TreeNodeByPathLoadRequest",e);if(g.setAttribute(F,b),g.setAttribute(x,n[c]),d){var h=g.ownerDocument.createElementNS(u,y);h.textContent=d.join("|"),g.appendChild(h)}return this.sendRequest(g,"loadTreesByPath",{path:b,retrieveMode:c,filter:d}).then(function(a){return f.processStorageListsResponse(a)})},R.prototype.loadTreesByPath=function(a,c,d,e){var f=this;return this.checkVersion().then(function(g){return g.fetchTree?f._loadTreesByPath(a,c,d,e):(f.logger.low("loadTreesByPath",{warn:"migrate to server 122 for better performance"}),f.listRoots(e).then(function(g){return g.storages.map(function(g){return f.loadByPath(g.id,a,e).then(function(a){return f.loadTree(a.storages[0].id,c,d,e)}).then(function(a){return a.storages},function(a){if(a&&a.storageErrorType===b.STORAGE_AREA_NOT_FOUND)return[];throw a})})}).then(function(a){return Q.all(a)}).then(function(a){return a.map(function(a){return{storages:a,affectedStoreMetadata:null}})}))})},R.prototype.loadByPath=function(a,c,d){var e=this;if(!a)return Q.reject(j("parentId is mandatory",b.MANDATORY_FIELD));var f=this.createRequest("LoadByPathRequest",d);return f.setAttribute(F,c),f.setAttribute(w,a),this.sendRequest(f,"loadByPath",{parentId:a,path:c}).then(function(a){return e.processStorageListResponse(a)})},R.prototype.loadByUuid=function(a,c){var d=this;return a?this.supports.then(function(e){if(!e.uuid)throw j("Cannot read storage links make with ION.WEB Server 120 or greater",b.STORAGE_AREA_NOT_FOUND);var f=d.createRequest("LoadMetadataByUuidRequest",c);return f.setAttribute(P,a),d.sendRequest(f,"loadByUuid",{uuid:a})}):Q.reject(j("UUID is mandatory",b.MANDATORY_FIELD))},R.prototype.copy=function(a,b,c,d){var e=this.createRequest("CopyRequest",d);return e.setAttribute(w,a),e.setAttribute(A,b),e.setAttribute(z,c),this.sendRequest(e,"copy",{sourceId:a,parentDest:b,newName:c})},R.prototype.delete=function(a,b,c){var d=this.createRequest("DeleteRequest",c);return d.setAttribute(w,a),d.setAttribute(B,b.toString()),this.sendRequest(d,"delete",{id:a,version:b})},R.prototype.deleteNode=function(a,b,c,d){var e=this.createRequest("TreeNodeDeleteRequest",d);return e.setAttribute(w,a),e.setAttribute(B,b.toString()),e.setAttribute(C,c.toString()),this.sendRequest(e,"deleteNode",{id:a,version:b,recursive:c})},R.prototype.fillPropertyAttrs=function(a,b){var c=a.ownerDocument.createElementNS(u,D);a.appendChild(c),b.displayName&&c.setAttribute(I,b.displayName),b.parentId&&c.setAttribute(M,b.parentId),b.ownerUsername&&c.setAttribute(N,b.ownerUsername),b.description&&c.setAttribute(J,b.description),b.userData&&c.setAttribute(K,b.userData),b.storeType&&c.setAttribute(L,b.storeType),b.isTreeNode&&c.setAttribute(O,b.isTreeNode.toString())},R.prototype.setContent=function(b,e){var f=b.ownerDocument.createElementNS(u,E);switch(b.appendChild(f),e.contentType){case d.Null:f.setAttributeNS(v,"type",o);break;case d.String:f.setAttributeNS(v,"type",p);var g=b.ownerDocument.createElementNS(u,E);f.appendChild(g),f.setAttribute("encoding","UTF-8"),g.textContent=e.content;break;case d.Xml:f.setAttributeNS(v,"type",q),f.appendChild(e.content.cloneNode(!0));break;case d.Json:return this.supports.then(function(d){if(!d.json)throw new Error(c.Strings.Err_Json_Supported_From_Server_Ver+"116p1");f.setAttributeNS(v,"type",r);var g=b.ownerDocument.createElementNS(u,E);f.appendChild(g),f.setAttribute("encoding","UTF-8");var h=b.ownerDocument.createCDATASection(JSON.stringify(e.content,a.LazySerializable.jsonReplacer));g.appendChild(h)})}return Q.when(null)},R.prototype.create=function(a,b,c){var d=this,e=this.createRequest("CreateRequest",c);return this.fillPropertyAttrs(e,a),this.setContent(e,b).then(function(){return d.sendRequest(e,"create",{props:a})})},R.prototype.createNode=function(a,b){var c=this.createRequest("TreeNodeCreateRequest",b);return a.isTreeNode=!0,this.fillPropertyAttrs(c,a),this.sendRequest(c,"createNode",{props:a})},R.prototype.update=function(a,c,d,e,f){var g=this;if(!a)return Q.reject(j("ID is mandatory",b.MANDATORY_FIELD));var h=this.createRequest("UpdateRequest",f);h.setAttribute(w,a),h.setAttribute(B,c.toString()),d&&this.fillPropertyAttrs(h,d);var i=e?this.setContent(h,e):Q.when(null);return i.then(function(){return g.sendRequest(h,"update",{id:a,version:c,props:d})})},R.prototype.updateNode=function(a,c,d,e){if(!a)return Q.reject(j("ID is mandatory",b.MANDATORY_FIELD));var f=this.createRequest("TreeNodeUpdateRequest",e);return f.setAttribute(w,a),f.setAttribute(B,c.toString()),this.fillPropertyAttrs(f,d),this.sendRequest(f,"updateNode",{id:a,version:c,props:d})},R.prototype.validateName=function(b){if(b=b.trim(),!b)return c.Strings.Err_NullStorageName;if(b.length>R.MAX_STORAGE_NAME_LENGTH)return c.Strings.Err_LongStorageName;var d=b.match(R.INVALID_STORAGE_NAME_CHARS);return d?a.stringFormat(c.Strings.Err_InvalidChars,{chars:a.distinct(d).join(" ")}):null},R.prototype.cleanupNameNotUnique=function(a){return a=a.trim(),a.length>R.MAX_STORAGE_NAME_LENGTH&&(a=a.substr(0,R.MAX_STORAGE_NAME_LENGTH)),a.replace(R.INVALID_STORAGE_NAME_CHARS,"_")},R.prototype.validateDescriptor=function(a){return a&&(a=a.trim(),a.length>R.MAX_STORAGE_DESCRIPTION_LENGTH)?c.Strings.Err_LongStorageDescription:null},R.prototype.validateUserData=function(a){return a&&(a=a.trim(),a.length>R.MAX_STORAGE_USERDATA_LENGTH)?c.Strings.Err_LongStorageUserData:null},R.prototype.subscribeChanges=function(a,b,c){var d,f=this;return d="function"!=typeof b||c?c:b,this.storageSubscribers[a]?this.storageSubscribers[a].push(d):this.storageSubscribers[a]=new e.StorageSubscription(this.logger,this.reqService,this.commService,this,a,d),function(){f.storageSubscribers[a]&&!f.storageSubscribers[a].remove(d)&&(f.storageSubscribers[a].dispose(),delete f.storageSubscribers[a])}},R.prototype.checkVersion=function(){var b=this,c=function(b,c){return!b||b.gte(a.IonVersion.fromIonString(c))};return this.reqService.getServerVersion().then(function(a){return{uuid:c(a,"120"),json:c(a,"116p1"),fetchTree:c(a,"122")}},function(a){return b.logger.low("checkUuid_getVersion",{err:a.message||a}),{}})},Object.defineProperty(R.prototype,"supports",{get:function(){return this._supports||(this._supports=this.checkVersion())},enumerable:!0,configurable:!0}),Object.defineProperty(R.prototype,"supportsUuid",{get:function(){return this.supports.then(function(a){return a.uuid})},enumerable:!0,configurable:!0}),R.MAX_STORAGE_NAME_LENGTH=99,R.MAX_STORAGE_DESCRIPTION_LENGTH=255,R.MAX_STORAGE_USERDATA_LENGTH=255,R.INVALID_STORAGE_NAME_CHARS=/[\/\\?%\*\^:\|"<>\.,#&;\$@`'=\[\]\{\}]/g,R}();c.StorageService=R,a.module("ionwebStorages").service("storageService",["ionweb.serverService","ionweb.commService","ionweb.loggerFactory"],function(a,b,c){return new R(a,b,c)})}(e=a.storages||(a.storages={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(b,c,d){var e=this;this.subscription=b.subscribe({id:c,type:a.SubscriptionType.Record,supply:function(a,b){e.notAvailable=!1,d.handleSupply(b)},notAvailable:function(){e.notAvailable=!0,d.handleNotAvail()}})}return b.prototype.unsubscribe=function(){this.subscription.unsubscribe()},b}(),d=function(){function b(a,b,d,e,f,g){var h=this;this.logger=a,this.reqService=b,this.storageService=e,this.id=f,this.handlers=[],this.lastMetadata={id:"",version:0,contentProperties:{}},this.commSubs=[],this.logger.low("SubRecord",{id:f}),this.push(g),setTimeout(function(){h.commSubs=[h.toPrivateRecordName(f),h.toSharedRecordName(f)].map(function(a){return new c(d,a,h)})},500)}return b.normalizeUserName=function(a){function b(a){if(/[0-9a-zA-Z]/.test(a))return a;var b="000"+a.charCodeAt(0).toString(16).toUpperCase();return"@"+b.substr(b.length-4)}for(var c="",d=0;d<a.length;d++)c+=b(a[d]);return c},b.prototype.toSharedRecordName=function(b){return a.stringFormat("ANY.SHARED_STORAGES.${source}.${id}",{source:this.reqService.getServerSource(),id:b})},b.prototype.toPrivateRecordName=function(c){return a.stringFormat("ANY.PRIVATE_${user}_STORAGES.${source}.${id}",{source:this.reqService.getServerSource(),user:b.normalizeUserName(this.reqService.getUserName()),id:c})},b.prototype.updateMetadata=function(a){var b=a.Id;b&&(this.lastMetadata.id=b.toString()),this.lastMetadata.version=a.Version||this.lastMetadata.version,this.lastMetadata.contentProperties.contentVersion=a.ContentVersion||this.lastMetadata.contentProperties.contentVersion,this.isDeleted=!1},b.prototype.handleSupply=function(a){this.updateMetadata(a),this.logger.low("StorageChanged",{metadata:this.lastMetadata}),this.raise()},b.prototype.handleNotAvail=function(){var b=this;!this.isDeleted&&a.all(this.commSubs,function(a){return a.notAvailable})&&(this.logger.low("StorageChangedNA",{id:this.id}),this.storageService.loadTree(this.id,a.NodeRetrieveMode.NodeOnly,null,"sub").then(function(){},function(c){if(!c||c.storageErrorType!==a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND)throw c;b.isDeleted||(b.isDeleted=!0,b.raise()),b.dispose()}).done())},b.prototype.raise=function(){var a=this;this.handlers.forEach(function(b){return b(!a.isDeleted&&a.lastMetadata)})},b.prototype.push=function(a){this.handlers.push(a)},b.prototype.remove=function(b){return a.removeFirst(this.handlers,function(a){return a===b}),this.handlers.length>0},b.prototype.dispose=function(){this.commSubs.forEach(function(a){return a.unsubscribe()}),this.commSubs=[],this.handlers=[]},b}();b.StorageSubscription=d}(b=a.storages||(a.storages={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){function c(a){return a.indexOf("-")>0}b.isUuid=c,b.IONWEB_CONTENT_META_LINKEDREFS_PROPERTY="__linkedRefs",b.IONWEB_CONTENT_META_TAG_PROPERTY="__linkedRefsTag",b.CREATE_NEW_STORAGE="$CREATE";var d=function(){function d(a,b,c){this.idCache=c,this.logger=a.create("LinkedStorageService","storage"),this._storageSrv=b}return d.prototype.prepareStorageContent=function(b){return{content:b,contentType:a.ContentType.Json}},d.prototype.create=function(a,c,d,f){var g=this;this.logger.low("create",{props:a,linkedStorages:d}),d=d||[];var h=d.map(function(a){return g._storageSrv.create(a.props,a.content,"ls.create.ln")});return Q.all(h).then(function(h){var i=h.map(function(a,b){return{uid:a.affectedStoreMetadata.contentProperties.uuid||a.affectedStoreMetadata.id,version:a.affectedStoreMetadata.version,tag:d[b].tag}});return c=c||{},c[b.IONWEB_CONTENT_META_LINKEDREFS_PROPERTY]=i,c[b.IONWEB_CONTENT_META_TAG_PROPERTY]=f,g._storageSrv.create(a,g.prepareStorageContent(c),"ls.create").then(function(a){return new e(g.logger,a.affectedStoreMetadata,c)})})},d.prototype.addLinkedStorage=function(b,c,d,e){if(this.logger.low("addLinked",{uid:b.storageId.id,linkedStorageRefs:c}),0===c.length)return Q.when(null);c.forEach(function(c){var d=a.firstOrDefault(b.linkedStorages,function(a){return a.uid===c.uid});if(d)throw new Error("One or more links are already present: "+d.uid)}),b.addLinkedStorages(c,d);var f=c.reduce(function(a,b){return a[b.uid]=[{replaceContent:!0}],b.tag&&a[b.uid].push({tag:b.tag}),a},{});return this.update(b,f,null,null,e)},d.prototype.open=function(b){var c=this;return this.logger.medium("open",{id:b}),"object"==typeof b?Q.when({storage:new e(this.logger,b.md,b.content),md:b.md}):this._storageSrv.loadContent(b,"ls.open").then(function(d){var f=d.contentType;return f!==a.ContentType.Json&&(d.content={},c.logger.low("open:WARN:ConvertToJson",{id:b,contentType:a.ContentType[f]})),{storage:new e(c.logger,d.affectedStoreMetadata,d.content),md:d.affectedStoreMetadata}})},d.prototype.update=function(a,b,c,d,e){return this.updateContent(a,b,c,d,e).then(function(){return null})},d.prototype.updateContent=function(a,b,c,d,e){if(!b&&!c&&!d)return Q.reject("At least one of the arguments must be specified");if(c&&("object"!=typeof c||Array.isArray(c)))return Q.reject("The content should be an Object");b=b||{},this.logger.low("update",{uid:a.storageId.id,linkedOperationsIds:Object.getOwnPropertyNames(b),newParentId:d});var f={description:a.description,userData:a.userData};return d&&(f.parentId=d),this._update(a,b,c,f,e)},d.prototype._update=function(a,c,e,f,g){var h=this,i=[],j=function(){var b=function(a,b){var c={appendToArray:b.appendToArray,removeFromArray:b.removeFromArray,setArrayItem:b.setArrayItem,setObjectProperty:b.setObjectProperty,deleteObjectProperties:b.deleteObjectProperties,moveStorage:b.moveStorage,rename:b.rename};return b.replaceContent&&(c.replaceContent=!d.isCreateId(a)||b.replaceContent),c};return a.linkedStorages.map(function(d){var e=c[d.uid],f=!1,g=!1;return e&&(i.push(d),g=!0,e.forEach(function(a){a.tag?d.tag=a.tag:a.delete===!0&&(f=!0)})),f?(a.removeLinks([d.uid]),null):(g&&d.version++,d.lastOps=e&&e.map(function(a){return b(d.uid,a)}),{uid:d.uid,version:d.version,lastOps:d.lastOps,tag:d.tag})}).filter(function(a){return!!a})};return e=e||a.getContent(),e[b.IONWEB_CONTENT_META_LINKEDREFS_PROPERTY]=j(),g&&(e[b.IONWEB_CONTENT_META_TAG_PROPERTY]=g),this._storageSrv.update(a.storageId.id,a.storageId.version,f,this.prepareStorageContent(e),"ls.upd").then(function(b){a.updateMetadata(b.affectedStoreMetadata),a.setContent(e);var d=[],f={};return i.forEach(function(b){var e=c[b.uid];e&&(f[b.uid]=d.length,d.push(h.applyLinkedOps(a,b,e)))}),Q.all(d).then(function(a){return Object.getOwnPropertyNames(f).forEach(function(b){var c=a[f[b]];f[b]=!!c.delete||c.metadata}),{refs:f,md:b.affectedStoreMetadata}})})},d.prototype.updateMeta=function(a,b){return this.logger.low("updateMeta",{id:a.storageId.id,meta:b}),b.description||""===b.description||(b.description=a.description),b.userData||""===b.userData||(b.userData=a.userData),this._storageSrv.update(a.storageId.id,a.storageId.version,{displayName:b.displayName,description:b.description,userData:b.userData},null,"ls.updMeta").then(function(b){return a.updateMetadata(b.affectedStoreMetadata),b.affectedStoreMetadata})},d.isCreateId=function(a){return 0===a.indexOf(b.CREATE_NEW_STORAGE)},d.prototype.doUuidOp=function(a,b){return c(a)?this.idCache.getIdFromUuid(a).then(function(a){return b(a)}):Q.when(b(a))},d.prototype.applyLinkedOps=function(b,c,e,f){var g,h,i=this,j=!1;return d.isCreateId(c.uid)&&(h=JSON.parse(c.tag)),h?(g=Q.when({}),c.version=-1):g=f?Q.when(f):this.doUuidOp(c.uid,function(a){return i._storageSrv.loadContent(a,"ls.applyLinkedOps")}).then(function(a){return a.content}),g.then(function(b){var d={description:c.uid.toString()+"-"+c.version.toString()};h&&(d.displayName=h.displayName,d.storeType=h.storeType,d.parentId=h.parentId);var f=Q.when(null);return(e||[]).forEach(function(a){if(a.replaceContent)f=f.then(function(){var c="function"==typeof a.replaceContent?a.replaceContent():a.replaceContent;return Q.when(c).then(function(a){a!==!0&&(b=a)})});else if(a.setObjectProperty)("object"!=typeof b||Array.isArray(b))&&(b={}),b[a.setObjectProperty.propertyName]=a.setObjectProperty.content;else if(a.deleteObjectProperties)("object"!=typeof b||Array.isArray(b))&&(b={}),a.deleteObjectProperties.propertyNames.forEach(function(a){delete b[a]});else if(a.appendToArray)Array.isArray(b)||(b=[]),
b.push(a.appendToArray.content);else if(a.setArrayItem)Array.isArray(b)||(b=[]),b[a.setArrayItem.index]=a.setArrayItem.content;else if(a.removeFromArray)Array.isArray(b)||(b=[]),a.removeFromArray.indexes.sort(function(a,b){return b-a}),a.removeFromArray.indexes.forEach(function(a){b.splice(a,1)});else if(a.moveStorage)d.parentId=a.moveStorage;else if(a.rename)d.displayName=a.rename;else if("undefined"!=typeof a.tag)c.tag=a.tag;else if(a.delete===!0)j=!0;else{var e=Object.getOwnPropertyNames(a);if(e.length>0)throw new Error("Unsupported operations: "+e.join(", "))}}),f.then(function(){return h&&j?(i.logger.medium("applyLinkedOps.skip create+delete",{uid:c.uid}),i.doUuidOp(c.uid,function(a){return i._storageSrv.delete(a,c.version,"ls.applyLinkedOps")})):h?(i.logger.medium("applyLinkedOps.creating",{uid:c.uid}),i._storageSrv.create(d,i.prepareStorageContent(b),"ls.applyLinkedOps").then(function(a){return c.version=a.affectedStoreMetadata.version,c.uid=a.affectedStoreMetadata.contentProperties.uuid||a.affectedStoreMetadata.id,c.tag=h.tag||null,a},function(e){if(e&&e.storageErrorType)switch(e.storageErrorType){case a.StorageErrorTypes.STORAGE_AREA_ALREADY_EXISTS:return i.logger.low("applyLinkedOps_exists",c),i._storageSrv.loadByPath(h.parentId,h.displayName,"ls.applyLinkedOps.f").then(function(a){var c=a.storages[0];return i._storageSrv.update(c.id,c.version,d,i.prepareStorageContent(b),"ls.applyLinkedOps.rw")}).then(function(a){return c.version=a.affectedStoreMetadata.version,c.uid=a.affectedStoreMetadata.contentProperties.uuid||a.affectedStoreMetadata.id,c.tag=h.tag||null,a});case a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND:return i.logger.low("applyLinkedOps_noparent",c),j=!0,null}throw e})):j?(i.logger.medium("applyLinkedOps.deleting",{uid:c.uid}),i.doUuidOp(c.uid,function(a){return i._storageSrv.delete(a,c.version,"ls.applyLinkedOps")})):i.doUuidOp(c.uid,function(a){return i._storageSrv.update(a,c.version-1,d,i.prepareStorageContent(b),"ls.applyLinkedOps")})})}).then(function(a){if(!j&&a.affectedStoreMetadata.version!==c.version)throw new Error("Unexpected: linked storage ref didn't changed version");return b.clearDuplicates(),{delete:j,metadata:a&&a.affectedStoreMetadata}})},d.prototype.loadMetadataById=function(b,d){return c(b)?this._storageSrv.loadByUuid(b,"ls.loadMd."+d).then(function(a){return a.affectedStoreMetadata}):this._storageSrv.loadTree(b,a.NodeRetrieveMode.NodeOnly,null,"ls.loadMd."+d).then(function(a){return a.storages&&a.storages[0]})},d.prototype.checkConsistency=function(b){var c=this;if(this.logger.medium("checkConsistency",{id:b.storageId.id}),b.linkedStorages.length>0){var e=[],f={};return b.linkedStorages.forEach(function(b){f[b.uid]=b.version,d.isCreateId(b.uid)?e.push(Q.when(null)):e.push(c.loadMetadataById(b.uid,"check").catch(function(b){if(b&&b.storageErrorType&&b.storageErrorType===a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND)return null;throw b}))}),Q.all(e).then(function(a){for(var b=0;b<a.length;b++){var d=a[b];if(!d)return!1;var e=f[d.contentProperties.uuid];if("undefined"==typeof e&&(e=f[d.id]),e!==d.version)return c.logger.medium("checkConsistencyFail",{linkedVersion:e,storageVer:d.version}),!1}return!0})}return Q.when(!0)},d.prototype.fixLinkedStorages=function(b,c,e){var f=this;this.logger.low("fixLinkedStorages",{id:b.storageId.id,removeMissingLinks:c});var g=[],h=function(a,b,c){return c?(g.push(a.uid),!0):(a.uid=b.contentProperties.uuid||b.id,a.version=b.version,a.tag=void 0,f.logger.low("fixLinkedStorages_FixCreate",a),!0)},i=function(e){if(d.isCreateId(e.uid)){var i=JSON.parse(e.tag);return f._storageSrv.loadByPath(i.parentId,i.displayName,"ls.fix").then(function(a){return h(e,a.storages[0])},function(c){if(!c||!c.storageErrorType||c.storageErrorType!==a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND)throw c;return f.logger.low("fixLinkedStorages_create",e),f.applyLinkedOps(b,e,e.lastOps).then(function(a){return h(e,a.metadata,a.delete)})})}return f.doUuidOp(e.uid,function(a){return f.open(a)}).then(function(a){if(a.storage.storageId.version===e.version)return Q.when(!1);if(a.storage.storageId.version===e.version-1)return f.applyLinkedOps(b,e,e.lastOps,a.storage.getContent()).then(function(){return!1});var c={uid:e.uid,expVer:e.version,currVer:a.storage.storageId.version};return a.storage.storageId.version>e.version?(f.logger.low("fixLinkedStorages_GreaterFixed",c),e.version=a.storage.storageId.version,Q.when(!0)):(f.logger.low("fixLinkedStorages_LesserFixed",c),e.version=a.storage.storageId.version,Q.when(!0))},function(b){if(!b||!b.storageErrorType||b.storageErrorType!==a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND||!c)throw b;return g.push(e.uid),!0})};return Q.all(b.linkedStorages.map(function(a){return i(a)})).then(function(c){return a.any(c,function(a){return a})?(b.removeLinks(g),f._update(b,{},null,null,e).then(function(a){return a.md},function(b){if(b.storageErrorType!==a.StorageErrorTypes.USER_NOT_AUTHORIZED)throw b;return null})):null})},d.prototype.delete=function(b){var c=this,d=function(b){return c.loadMetadataById(b,"delete").then(function(a){return c._storageSrv.delete(a.id,a.version,"ls.forceDelete")},function(b){return b&&b.storageErrorType===a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND?null:Q.reject(b)})},e=function(a){c.logger.low("delete",{id:a.storageId.id});var b=[c._storageSrv.delete(a.storageId.id,a.storageId.version,"ls.fix")];return a.linkedStorages.forEach(function(a){b.push(d(a.uid))}),Q.all(b)};return"string"==typeof b?this.doUuidOp(b,function(a){return c.open(a)}).then(function(a){return e(a.storage)}):e(b).then(function(){return null})},d.prototype.createLinkedStorages=function(c,d,e,f){var g=this;this.logger.low("createLinked",{id:c.storageId.id,data:d});var h=d.map(function(c,d){return{uid:b.CREATE_NEW_STORAGE+d,version:0,tag:JSON.stringify(c,a.LazySerializable.jsonReplacer)}});c.addLinkedStorages(h,e);var i=h.reduce(function(a,b,c){return d[c].content&&(a[b.uid]=[{replaceContent:d[c].content}]),a},{}),j=[];return this.updateContent(c,i).then(function(a){return Object.getOwnPropertyNames(a.refs).forEach(function(b){var d=a.refs[b];d===!0?c.removeLinks([b]):j.push(c.updateLink(b,a.refs[b]))}),g._update(c,{},null,null,f)}).then(function(a){return{refs:j,md:a.md}})},d.prototype.upgradeUuids=function(b){var e=this;return this._storageSrv.supportsUuid.then(function(f){return f?Q.all(b.linkedStorages.map(function(b){return c(b.uid)||d.isCreateId(b.uid)?null:e._storageSrv.loadTree(b.uid,a.NodeRetrieveMode.NodeOnly,null,"ls.upgrade").then(function(a){return{id:b.uid,uuid:a.storages[0].contentProperties.uuid,ls:b}},function(a){return null})})):[]}).then(function(a){var b={};return a.filter(function(a){return!!a}).forEach(function(a){b[a.id]=a.uuid,a.ls.uid=a.uuid}),b})},d}();b.LinkedStorageService=d;var e=function(){function c(c,d,e){if(this.logger=c,!e)throw new Error("Empty content");this.lastMd=a.extendChildren({},[d]),this._linkedStorages=e[b.IONWEB_CONTENT_META_LINKEDREFS_PROPERTY]||[],this.clearDuplicates(),this.updateMetadata(d),this.setContent(e)}return Object.defineProperty(c.prototype,"version",{get:function(){return this.lastMd.version},enumerable:!0,configurable:!0}),c.prototype.updateVersionExt=function(a){a>this.lastMd.version&&(this.lastMd.version=a)},c.prototype.clearDuplicates=function(){var a=this;this._linkedStorages.forEach(function(b,c){b&&a._linkedStorages.forEach(function(d,e){d&&e!==c&&d.uid===b.uid&&d.version<=b.version&&(a.logger.low("clearDuplicates_remove",{root:a.lastMd.id,idx:e,lsuid:b.uid,otherIdx:c}),a._linkedStorages[e]=null)})}),this._linkedStorages=this._linkedStorages.filter(function(a){return!!a})},c.prototype.updateMetadata=function(b){this.lastMd=a.extendChildren({},[b])},c.prototype.updateLink=function(b,c){var d=c.contentProperties.uuid||c.id,e=a.firstOrDefault(this._linkedStorages,function(a){return a.uid===b})||a.firstOrDefault(this._linkedStorages,function(a){return a.uid===d});return e&&(e.uid=d,e.version=c.version),e},c.prototype.removeLinks=function(a){this._linkedStorages=this._linkedStorages.filter(function(b){return a.indexOf(b.uid)<0})},Object.defineProperty(c.prototype,"storageId",{get:function(){return{id:this.lastMd.id,version:this.lastMd.version}},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"uuid",{get:function(){return this.lastMd.contentProperties.uuid},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"displayName",{get:function(){return this.lastMd.contentProperties.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"description",{get:function(){return this.lastMd.contentProperties.description},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userData",{get:function(){return this.lastMd.contentProperties.userData},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"tag",{get:function(){return this._tag},enumerable:!0,configurable:!0}),c.prototype.getContent=function(){return JSON.parse(this.lastContentStr)},Object.defineProperty(c.prototype,"linkedStorages",{get:function(){return this._linkedStorages},enumerable:!0,configurable:!0}),c.prototype.addLinkedStorages=function(a,b){"undefined"==typeof b?this._linkedStorages=this._linkedStorages.concat(a):this._linkedStorages.splice.apply(this._linkedStorages,[b,0].concat(a)),this.clearDuplicates()},c.prototype.setContent=function(c){this._tag=c[b.IONWEB_CONTENT_META_TAG_PROPERTY],delete c[b.IONWEB_CONTENT_META_LINKEDREFS_PROPERTY],delete c[b.IONWEB_CONTENT_META_TAG_PROPERTY],this.lastContentStr=JSON.stringify(c,a.LazySerializable.jsonReplacer)},c}();b.LinkRootStorage=e,a.module("ionwebStorages").service("linkedStorageService",["ionweb.loggerFactory","ionweb.storageService","ionweb.storageIdCache"],function(a,b,c){return new d(a,b,c)})}(b=a.storages||(a.storages={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b=function(){function a(){this.opQueue=[]}return a.prototype.alloc=function(){var a=Q.defer(),b=Q.defer();return this.opQueue.push(b),this.opQueue.length>1?this.opQueue[this.opQueue.length-2].promise.then(function(){a.resolve(null)}):a.resolve(null),a.promise},a.prototype.dealloc=function(){this.opQueue[0].resolve(null),this.opQueue.splice(0,1)},a.prototype.enqueue=function(a){var b=this;return this.alloc().then(function(){var c=a();return c.finally(function(){b.dealloc()}),c})},Object.defineProperty(a.prototype,"inProgress",{get:function(){return this.opQueue.length>0},enumerable:!0,configurable:!0}),a}();a.TaskQueue=b}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){b.CONSISTENCY_TIMEOUT=5e3,b.MAX_CHUNK_ITEM_COUNT=16;var c=function(){function c(b,c,d){var e=this;this.linkRootStorage=b,this.owner=c,this.unsub=[],this.taskQueue=new a.TaskQueue,this.changed=new a.Event,this.logger=c.loggerFactory.create("VersionedStorage:"+b.storageId.id,"storage"),d||(this.unsub.push(this.storageService.subscribeChanges(b.storageId.id,function(a){return e.handleStorageChanges(!0,a)})),b.linkedStorages.forEach(function(a){return e.registerLink(a.uid)}))}return c.prototype.updateVersionRootExt=function(a){this.linkRootStorage.updateVersionExt(a)},Object.defineProperty(c.prototype,"historyStorageUid",{get:function(){return this.linkRootStorage.linkedStorages.length>0&&this.linkRootStorage.linkedStorages[0].uid},enumerable:!0,configurable:!0}),c.prototype.doUuidOp=function(a,c){return b.isUuid(a)?this.owner.idCache.getIdFromUuid(a).then(function(a){return c(a)}):Q.when(c(a))},c.prototype.registerLink=function(a){var c=this;b.LinkedStorageService.isCreateId(a)||this.doUuidOp(a,function(a){return c.unsub.push(c.storageService.subscribeChanges(a,function(a){return c.handleStorageChanges(!1,a)})),null})},Object.defineProperty(c.prototype,"storageService",{get:function(){return this.owner.storageService},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"linkedService",{get:function(){return this.owner.linkedService},enumerable:!0,configurable:!0}),c.prototype.createHistoryFolder=function(a){return this.logger.low("createHistoryFolder",{parentId:a}),this.storageService.createNode({displayName:c.HISTORY_FOLDER_NAME,parentId:a},"vs.createHistFold").then(function(a){return a.affectedStoreMetadata.id})},c.prototype.getHistoryFolderFromParent=function(a){var b=this;return this.storageService.loadByPath(a,c.HISTORY_FOLDER_NAME+"/","vs.getHist").then(function(a){return a.storages[0].id},function(){return b.createHistoryFolder(a)})},c.prototype.getAllExistingDependencies=function(b){var d=this;return b.contentProperties.storeType!==c.HISTORY_FILE_TYPE?(this.logger.low("FoundInvalidHistoryFile"),Q.when(!1)):this.storageService.loadTree(b.contentProperties.parentId,a.NodeRetrieveMode.NodeAndChildren,[c.HISTORY_CHUNK_FILE_TYPE],"vs.getDeps").then(function(a){var c=a.storages.map(function(a){return{uid:a.id,version:a.version,chunkParts:a.contentProperties.displayName.split("_")}});c=c.filter(function(a){return 2===a.chunkParts.length&&a.chunkParts[0]===b.contentProperties.displayName}),c=c.sort(function(a,b){return Number(a.chunkParts[1])-Number(b.chunkParts[1])});var e=c;return e.unshift({uid:b.id,version:b.version,chunkParts:void 0}),d.registerLink(b.contentProperties.uuid||b.id),d.linkedService.addLinkedStorage(d.linkRootStorage,e,void 0,d.createMainStorageTag()).then(function(){return!0})})},c.prototype.toChunkItemId=function(a){return"v"+a},c.prototype.createMainHistoryStorage=function(a,b,d){var e=this,f=function(b){var f;return e.createNewChunk(a,1,e.linkRootStorage.getContent(),b).then(function(a){f=a;var g=e.createVersionData(e.linkRootStorage.storageId.version,f.chunk,d);return e.linkedService.createLinkedStorages(e.linkRootStorage,[{displayName:e.uid,parentId:b,storeType:c.HISTORY_FILE_TYPE,content:[g]}],0)}).then(function(a){return e.registerLink(a.refs[0].uid),a.md})};this.logger.low("CreateHistoryStorage",{id:this.linkRootStorage.storageId.id});var g;return this.getHistoryFolderFromParent(a).then(function(a){return g=a,e.storageService.supportsUuid}).then(function(a){return a&&b?f(g):e.storageService.loadByPath(g,e.uid,"vs.createHist").then(function(a){return e.getAllExistingDependencies(a.storages[0]).then(function(a){if(!a)return f(g)})},function(a){return f(g)})})},c.prototype.dispose=function(){this.unsub.forEach(function(a){return a()}),this.unsub=[]},c.prototype.delete=function(){return this.dispose(),this.owner.delete(this.id)},c.prototype.handleStorageChanges=function(b,c){var d=this;if(this.onAnyStorageChanged&&this.onAnyStorageChanged(b,c),b)if(c){var e=this.taskQueue.inProgress?1:0;if(c.version>this.linkRootStorage.storageId.version+e){var f;this.owner.open(this.id,!0).then(function(b){f=b.storage;var e,g=b.md,h=d.linkRootStorage.lastMd,i=g.contentProperties.contentVersion!==h.contentProperties.contentVersion,j=g.contentProperties.parentId!==h.contentProperties.parentId,k=g.contentProperties.displayName!==h.contentProperties.displayName?g.contentProperties.displayName:null;return e=i?b.storage.getHistory().then(function(b){var d=a.lastOrDefault(b.metadata,function(a){return a.version===c.version});return d&&d.username||b.lastUsername}):Q.when(null),e.then(function(a){d.changed.raise(d,{version:c.version,username:a,contentChanged:i,renamed:k,moved:j})})}).catch(function(a){d.changed.raise(d,{})}).finally(function(){f&&f.dispose()}).done()}}else this.changed.raise(this,{deleted:!0})},Object.defineProperty(c.prototype,"id",{get:function(){return this.linkRootStorage.storageId.id},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"uid",{get:function(){return this.linkRootStorage.uuid||this.id},enumerable:!0,configurable:!0}),c.prototype.waitForConsistency=function(a,b,d,e){var f=this;return this.taskQueue.enqueue(function(){var g;return g=b?Q.when(null):f.linkedService.checkConsistency(f.linkRootStorage).then(function(a){if(a)return Q.when(null);f.logger.low("Inconsistent:wait");var b=Q.defer();return f.onAnyStorageChanged=function(a,c){f.linkedService.checkConsistency(f.linkRootStorage).then(function(a){a&&b.resolve(null)})},f.owner.consistencyTimeout(b.promise).then(function(){return f.onAnyStorageChanged=null,null},function(a){if(f.onAnyStorageChanged=null,a.message===c.TIMEOUT_ERR)return f.logger.low("InconsistentTimeout",{action:"fixing"}),f._update().then(function(){return f.linkedService.fixLinkedStorages(f.linkRootStorage,!0,f.createMainStorageTag())});throw a})}),g.then(function(c){return 0!==f.linkRootStorage.linkedStorages.length||b?Q.when(c):f.createMainHistoryStorage(a,d,e)})})},c.prototype.read=function(){var a=this;return this.taskQueue.enqueue(function(){return Q.when(a.linkRootStorage.getContent())})},c.prototype._update=function(){var a=this;return this.linkedService.open(this.id).then(function(b){return a.linkRootStorage=b.storage,b.md})},c.prototype.update=function(){var a=this;return this.taskQueue.enqueue(function(){return a._update().then(function(b){a.waitForConsistency(b.contentProperties.parentId,!1,!1).done()})})},c.prototype.createVersionData=function(b,c,d,e){return{timeStamp:(d||a.localization.moment()).format(),username:this.owner.serverService.getUserName(),version:b,contentRef:c,appData:e}},c.prototype.createMainStorageTag=function(){var b={lastUsername:this.owner.serverService.getUserName()};return JSON.stringify(b,a.LazySerializable.jsonReplacer)},c.prototype.coalesceMetadata=function(a,b,c,d){if(c+1>=a.length)return!1;for(var e=this.coalesceProperty(a,b,c,"username"),f=this.coalesceProperty(a,b,c,"comment"),g=this.coalesceAppData(a,b,c,d),h=b;h<=c;h++)a[h]=null;return e||f||g},c.prototype.coalesceAppData=function(a,b,c,d){if(d&&d.coalesce){for(var e=[],f=b;f<=c+1;f++)e.push(a[f].appData);return a[c+1].appData=d.coalesce(e),!0}return!1},c.prototype.coalesceProperty=function(b,c,d,e){for(var f={},g=c;g<=d;g++){var h=b[g]&&b[g][e];"string"==typeof h?f[h]=!0:Array.isArray(h)&&h.forEach(function(a){return f[a]=!0})}if(0===Object.keys(f).length)return!1;var i=b[d+1];if(!i)return!1;var j=i[e];return"string"==typeof j?(1!==Object.keys(f).length||!f[j])&&(f[j]=!0,i[e]=Object.keys(f),!0):Array.isArray(j)?!(a.all(j,function(a){return f[a]})&&a.indexOf(j,function(a){return!a})<0)&&(j.forEach(function(a){return f[a]=!0}),i[e]=Object.keys(f).filter(function(a){return!!a}),0===i[e].length?i[e]=null:1===i[e].length&&(i[e]=i[e][0]),!0):void 0},c.prototype.toChunkTag=function(a){return JSON.stringify(a)},c.prototype.createNewChunk=function(a,b,d,e){var f=this,g={};d&&(g[this.toChunkItemId(0)]=d);var h=this.toChunkTag({itemCount:1,no:b}),i=e?Q.when(e):this.getHistoryFolderFromParent(a);return i.then(function(a){return f.linkedService.createLinkedStorages(f.linkRootStorage,[{displayName:f.uid+"_"+b,storeType:c.HISTORY_CHUNK_FILE_TYPE,parentId:a,content:g,tag:h}])}).then(function(a){return f.registerLink(a.refs[0].uid),{chunk:{storageId:a.refs[0].uid,itemId:f.toChunkItemId(0)},newTag:h}})},c.prototype.retrieveLastChunkId=function(){var a=this.linkRootStorage.linkedStorages.length;if(a<=1)return Q.when(0);var b=this.linkRootStorage.linkedStorages[a-1];return b&&b.uid?this.linkedService.loadMetadataById(b.uid,"lastCh").then(function(a){var b=a.contentProperties.displayName,c=b.split("_");return 2===c.length?parseInt(c[1]):-1},function(){return-1}):Q.when(-1)},c.prototype.getActiveChunk=function(a){var c=this,d=this.linkRootStorage.linkedStorages.length<=1,e={itemCount:0,no:0};if(!d){var f=this.linkRootStorage.linkedStorages[this.linkRootStorage.linkedStorages.length-1];e=f.tag&&JSON.parse(f.tag)||e,e.itemCount>b.MAX_CHUNK_ITEM_COUNT?d=!0:e.itemCount++}return d?"number"!=typeof e.no?this.retrieveLastChunkId().then(function(b){return b<0&&(b=c.linkRootStorage.linkedStorages.length-1),c.createNewChunk(a,b+1,{})}):this.createNewChunk(a,e.no+1,{}):Q.when({chunk:{storageId:f.uid,itemId:this.toChunkItemId(e.itemCount)},newTag:this.toChunkTag(e)})},c.prototype.shouldWrite=function(b){var c=this,d=JSON.stringify(b,a.LazySerializable.jsonReplacer);return this.taskQueue.enqueue(function(){return Q.when(c.linkRootStorage.lastContentStr!==d)})},c.prototype.upgradeUuids=function(){var a=this;return this.linkedService.upgradeUuids(this.linkRootStorage).then(function(b){if(b&&Object.getOwnPropertyNames(b).length>0&&a.historyStorageUid)return a.loadContentFromUid(a.historyStorageUid).then(function(c){var d=c.content,e=!1;if(d.forEach(function(a){var c=a.contentRef.storageId,d=b[c];d&&(a.contentRef.storageId=d,e=!0)}),e){var f={};return f[a.historyStorageUid]=[{replaceContent:d},{rename:a.linkRootStorage.uuid}],a.linkedService.update(a.linkRootStorage,f)}return null})})},c.prototype.write=function(b,c,d){var e=this,f=JSON.stringify(b,a.LazySerializable.jsonReplacer);return this.taskQueue.enqueue(function(){if(e.linkRootStorage.lastContentStr===f)return Q.when(!1);var b,g=JSON.parse(f);return c&&c.processChange&&(b=c.processChange(g,e.linkRootStorage.getContent())),e.upgradeUuids().then(function(){return e.storageService.loadTree(e.linkRootStorage.storageId.id,a.NodeRetrieveMode.NodeOnly,null,"vs.write")}).then(function(a){return e.getActiveChunk(a.storages[0].contentProperties.parentId)}).then(function(a){var c={};return c[e.historyStorageUid]=[{appendToArray:{content:e.createVersionData(e.linkRootStorage.storageId.version+1,a.chunk,d,b)}}],c[a.chunk.storageId]=[{setObjectProperty:{propertyName:a.chunk.itemId,content:JSON.parse(f)}},{tag:a.newTag}],e.linkedService.update(e.linkRootStorage,c,g,null,e.createMainStorageTag()).then(function(){return!0})})})},c.prototype.updateMeta=function(a){var b=this;return this.taskQueue.enqueue(function(){return b.linkedService.updateMeta(b.linkRootStorage,a)})},c.prototype.move=function(b){var c=this;return this.taskQueue.enqueue(function(){return c.logger.low("Move",{newParent:b}),c.upgradeUuids().then(function(){return c.getHistoryFolderFromParent(b)}).then(function(a){var d=c.linkRootStorage.linkedStorages.reduce(function(b,c){return b[c.uid]=[{moveStorage:a}],b},{});return c.linkedService.update(c.linkRootStorage,d,null,b,c.createMainStorageTag())}).then(function(){return c.storageService.loadTree(c.linkRootStorage.storageId.id,a.NodeRetrieveMode.NodeOnly,null,"vs.move")}).then(function(a){return a.storages[0]})})},c.prototype.changeIdName=function(a,b){var c=a.split("_");return 1===c.length?b:b+"_"+c[1]},c.prototype.cloneChunkFile=function(a,b,c){var d=this;return this.linkedService.loadMetadataById(a.uid,"clone").then(function(a){var e=a.contentProperties.displayName,f=d.changeIdName(e,c);return d.storageService.copy(a.id,b,f,"vs.cloneChunk")})},c.prototype.cloneHistoryFile=function(b,c,d,e){var f=this;return this.doUuidOp(b.uid,function(a){return f.storageService.loadContent(a,"vs.cloneHist")}).then(function(b){var g=b.affectedStoreMetadata.contentProperties,h={displayName:f.changeIdName(g.displayName,d),parentId:c,storeType:g.storeType},i=b.content;return Array.isArray(i)&&i.forEach(function(a){a.contentRef&&(a.contentRef.storageId=e[a.contentRef.storageId])}),f.storageService.create(h,{contentType:a.ContentType.Json,content:i},"vs.cloneHist")})},c.prototype.clone=function(b,c,d,e){var f=this;return this.taskQueue.enqueue(function(){var g=[];f.logger.low("Clone",{newDisplayName:b,newParent:c,newContent:d});var h,i,j;return f.storageService.loadTree(f.linkRootStorage.storageId.id,a.NodeRetrieveMode.NodeOnly,null,"vs.clone").then(function(a){return h=a.storages[0].contentProperties,f.getHistoryFolderFromParent(c||h.parentId)}).then(function(a){return j=a,f.linkedService.create({displayName:b||h.displayName,parentId:c||h.parentId,storeType:h.storeType,description:h.description,userData:h.userData},d||f.linkRootStorage.getContent(),[],f.createMainStorageTag())}).then(function(a){i=a;var b=i.uuid||i.storageId.id;if(0===f.linkRootStorage.linkedStorages.length||e)return Q.when(null);var c=[],d={};return f.linkRootStorage.linkedStorages.forEach(function(a,e){0!==e&&c.push(f.cloneChunkFile(a,j,b).then(function(b){var c=b.affectedStoreMetadata.contentProperties.uuid||b.affectedStoreMetadata.id;d[a.uid]=c,g[e]={uid:c,version:b.affectedStoreMetadata.version,tag:a.tag}}))}),Q.all(c).then(function(){return f.cloneHistoryFile(f.linkRootStorage.linkedStorages[0],j,b,d).then(function(a){var b=a.affectedStoreMetadata.contentProperties.uuid||a.affectedStoreMetadata.id;g[0]={uid:b,version:a.affectedStoreMetadata.version,tag:f.linkRootStorage.linkedStorages[0].tag}})})}).then(function(){return f.linkedService.addLinkedStorage(i,g,void 0,f.createMainStorageTag())}).then(function(){return f.owner.open(i.storageId.id)})})},c.prototype.loadContentFromUid=function(a){var c=this;return b.isUuid(a)?this.storageService.supportsUuid.then(function(b){if(!b)throw new Error("Server 120 is required to open the selected storage");return c.owner.idCache.getIdFromUuid(a).then(function(a){return c.storageService.loadContent(a,"vs.load")})}):this.storageService.loadContent(a,"vs.load")},c.prototype.getHistoryContent=function(a){return a.storageId?this.loadContentFromUid(a.storageId).then(function(b){var c=b.content;return c[a.itemId]}):Q.when(null)},c.prototype.getHistory=function(){var a=this;return this.taskQueue.enqueue(function(){return a.historyStorageUid?a.loadContentFromUid(a.historyStorageUid).then(function(b){var c=b.content;if(!Array.isArray(c))return{metadata:[]};c.forEach(function(b){b.getContent=function(){return"undefined"!=typeof b.content?Q.when(b.content):"undefined"!=typeof b.contentRef?a.getHistoryContent(b.contentRef):Q.reject(new Error("Content not found"))}});var d=a.linkRootStorage.tag&&JSON.parse(a.linkRootStorage.tag);return{metadata:c,lastUsername:d&&d.lastUsername}}):Q.when({metadata:[]})})},c.prototype.checkForHistoryCoalescing=function(c,d,e){var f=this;return e=e||a.localization.moment(),this.getHistory().then(function(g){var h=b.coalesce(g.metadata,c,function(b){return{age:e.diff(a.localization.moment(b.timeStamp),"seconds"),pinned:!!b.comment}},d);return{sections:h,versions:g.metadata,version:f.linkRootStorage.storageId.version,removeCount:h.length}})},c.prototype.coalesceHistory=function(a,b){var c=this;return this.taskQueue.enqueue(function(){return a.version!==c.linkRootStorage.storageId.version?Q.reject(new Error("Content modified from the previous checkForHistoryCoalescing call")):c.upgradeUuids().then(function(){var d=a.versions,e={},f=[],g={removeFromArray:{indexes:[]}};f.push(g),e[c.historyStorageUid]=f;var h=[];a.sections.forEach(function(a){for(var i=a.start;i<=a.end;i++){g.removeFromArray.indexes.push(i);var j=d[i].contentRef;if(j&&j.storageId){var k=e[j.storageId];k||(k=e[j.storageId]=[{deleteObjectProperties:{propertyNames:[]}}]),k[0].deleteObjectProperties.propertyNames.push(j.itemId)}}h.push({start:d[a.start]&&d[a.start].version,end:d[a.end]&&d[a.end].version}),c.coalesceMetadata(d,a.start,a.end,b)&&f.unshift({setArrayItem:{index:a.end+1,content:d[a.end+1]}})}),h.length>0&&c.logger.low("coalesce_removedVers",{removedVersionLog:h});var i={};d.filter(function(a){return!(!a||!a.contentRef)}).forEach(function(a){i[a.contentRef.storageId]=!0});var j=[];return c.linkRootStorage.linkedStorages.forEach(function(a,b){a.uid===c.historyStorageUid||0===b||i[a.uid]||(e[a.uid]=[{delete:!0}],j.push(a.uid))}),j.length>0&&c.logger.low("coalesce_removeLinked",{uids:j}),c.linkedService.update(c.linkRootStorage,e,null,null,c.createMainStorageTag())})})},c.prototype.updateHistoryComments=function(b,c){var d=this,e=Object.getOwnPropertyNames(c).map(function(d){var e=a.indexOf(b.metadata,function(a){return a.version.toString()===d.toString()});return e>=0?(c[d]?b.metadata[e].comment=c[d]:delete b.metadata[e].comment,{setArrayItem:{index:e,content:b.metadata[e]}}):null}).filter(function(a){return!!a});return e.length>0?this.taskQueue.enqueue(function(){var a={};return a[d.historyStorageUid]=e,d.upgradeUuids().then(function(){return d.linkedService.update(d.linkRootStorage,a,null,null,d.createMainStorageTag())})}):Q.when(null)},Object.defineProperty(c.prototype,"metadata",{get:function(){var a=this.linkRootStorage.lastMd.contentProperties;return{displayName:a.displayName,description:a.description,userData:a.userData}},enumerable:!0,configurable:!0}),c.HISTORY_FOLDER_NAME="_HISTORY",c.HISTORY_FILE_TYPE="History",c.HISTORY_CHUNK_FILE_TYPE="HistoryChunk",c.TIMEOUT_ERR="<timeout>",c}();b.VersionedStorage=c;var d=function(){function d(a,d,e,f,g){this.loggerFactory=a,this.linkedService=d,this.storageService=e,this.serverService=f,this.idCache=g,this.consistencyTimeout=function(a){return Q.timeout(a,b.CONSISTENCY_TIMEOUT,c.TIMEOUT_ERR)}}return d.prototype.open=function(a,b,d){var e=this;return this.linkedService.open(a).then(function(a){var f=new c(a.storage,e,b);return f.waitForConsistency(a.md.contentProperties.parentId,b,!1,d).then(function(b){return{storage:f,md:b||a.md}})})},d.prototype.create=function(b,d,e,f,g,h){var i=this;return this.storageService.create({displayName:d,parentId:b,storeType:e,description:g,userData:h},{content:f||{},contentType:a.ContentType.Json},"vss.create").then(function(a){return i.linkedService.open({content:f||{},md:a.affectedStoreMetadata})}).then(function(a){var d=new c(a.storage,i,!1);return d.waitForConsistency(b,!1,!0).then(function(b){return{storage:d,md:b||a.md}})})},d.prototype.delete=function(a){return this.linkedService.delete(a)},d.prototype.move=function(a,b){return this.open(a).then(function(a){var c=a.storage.move(b);return a.storage.dispose(),c})},d.prototype.clone=function(a,b,c,d,e){return this.open(a).then(function(a){return a.storage.clone(b,c,d,e)})},d.prototype.isHistoryFolder=function(a){return a&&a.contentProperties.isTreeNode&&a.contentProperties.displayName===c.HISTORY_FOLDER_NAME},d}();b.VersionedStorageService=d,a.module("ionwebStorages").service("versionedStorageService",["ionweb.loggerFactory","ionweb.linkedStorageService","ionweb.storageService","ionweb.serverService","ionweb.storageIdCache"],function(a,b,c,e,f){return new d(a,b,c,e,f)})}(b=a.storages||(a.storages={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(b,c){this.storageService=c,this.extChangedEvent=new a.Event,this.logger=b.create("RemoteScenarioStorage")}return b.prototype.updateMetadata=function(a){var b=this;this.storageId=a.id,this.storageVersion=a.version,this.storageContentVersion=a.contentProperties&&a.contentProperties.contentVersion,this.subscribedStorageId!==this.storageId&&(this.subscribedStorageId=this.storageId,this.unsub&&this.unsub(),this.unsub=this.storageService.subscribeChanges(this.subscribedStorageId,function(a){b.inUpdate||(a?a.id===b.subscribedStorageId&&a.contentProperties&&("undefined"==typeof a.contentProperties.contentVersion?b.logger.low("ExtChanged",{warn:"missing contentVersion"}):a.contentProperties.contentVersion!==b.storageContentVersion&&(b.logger.low("ExtChanged",{newVer:a.contentProperties.contentVersion,myVer:b.storageContentVersion}),b.extChangedEvent.raise(b,null))):b.logger.low("ExtDeleted",{id:b.subscribedStorageId}))}))},b.prototype.findStorage=function(){var c=this;return this.logger.high("findStorage"),this.storageService.listRoots().then(function(b){var d=b.storages.filter(function(a){return a.contentProperties.storeType===c.storageService.systemUserHomeType});if(1!==d.length)throw new Error(a.storages.Strings.Err_Preference_Not_Single_Private_Root_Found);var e=d[0].id;return c.logger.high("Found user home",{userHome:e}),e}).then(function(a){return c.storageService.loadByPath(a,b.WorkspaceRootFolderName)}).then(function(d){if(1!==d.storages.length)throw new Error(a.stringFormat(a.storages.Strings.Err_Preference_NoSingle_Private,{name:b.WorkspaceRootFolderName}));var e=d.storages[0].id;return c.logger.high("Found WS home",{wsHome:e}),e}).then(function(d){return c.storageService.loadByPath(d,b.DefaultWsStorageName).then(function(a){var e=a.storages.filter(function(a){return a.contentProperties.storeType===b.DefaultWsStorageType});return 1===e.length?(c.updateMetadata(e[0]),c.logger.high("Ws storage found",{wsId:e[0].id}),{found:!0,rootId:d}):(c.logger.high("Ws storage not found",{}),
{found:!1,rootId:d})},function(b){if(b.storageErrorType===a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND)return{found:!1,rootId:d};throw b})})},b.prototype.findOrCreateStorage=function(c){var d=this;return this.logger.high("Find preference storage or create it",{}),this.findStorage().then(function(e){return e.found?d.tryUpdateStorage(c):(d.logger.low("Creating preference storage",{}),d.inUpdate=!0,d.storageService.create({parentId:e.rootId,displayName:b.DefaultWsStorageName,storeType:b.DefaultWsStorageType},{contentType:a.ContentType.Json,content:c}).then(function(a){d.logger.low("Preference storage created",{}),d.updateMetadata(a.affectedStoreMetadata)}).catch(function(a){d.resolveUpdateErrors(a,c)}).finally(function(){d.inUpdate=!1}))})},b.prototype.resolveUpdateErrors=function(b,c){var d=this;if(this.logger.low("resolveUpdateErrors",{errorType:b.storageErrorType}),b.storageErrorType===a.StorageErrorTypes.VERSION_MISMATCH_LOCKING_EXCEPTION)return this.logger.low("Overwrite"),this.findStorage().then(function(){return d.tryUpdateStorage(c)});if(b.storageErrorType===a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND)return this.logger.low("Update error: storage not found",{}),this.findOrCreateStorage(c);throw b},b.prototype.tryUpdateStorage=function(b){var c=this;this.logger.high("Updating preference storage",{});var d=JSON.stringify(b,a.LazySerializable.jsonReplacer);return d===this.lastData?Q.when(null):(this.inUpdate=!0,this.storageService.update(this.storageId,this.storageVersion,null,{content:JSON.parse(d),contentType:a.ContentType.Json}).then(function(a){c.lastData=d,c.logger.high("Preferences saved on storage"),c.updateMetadata(a.affectedStoreMetadata)}).catch(function(a){return c.resolveUpdateErrors(a,b)}).finally(function(){c.inUpdate=!1}))},b.prototype.save=function(a){return this.logger.low("Saving on storage",{id:this.storageId}),this.storageId?this.tryUpdateStorage(a):this.findOrCreateStorage(a)},b.prototype.load=function(){var a=this;return this.logger.low("Loading"),this.findStorage().then(function(b){return b.found?a.storageService.loadContent(a.storageId).then(function(a){var b=a.content;return b&&b.version?b:null},function(){return null}):null})},Object.defineProperty(b.prototype,"extChanged",{get:function(){return this.extChangedEvent},enumerable:!0,configurable:!0}),b.DefaultWsStorageName="default",b.DefaultWsStorageType="DefaultWorkspace",b.WorkspaceRootFolderName="IONWEB_WORKSPACES/",b}();b.RemoteScenarioStorage=c}(b=a.preferences||(a.preferences={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function a(a,b){var c=this;this.storageService=b,this.reset(),a.statusChanged&&a.statusChanged.add(function(a,b){b&&b.isAuthenticated||c.reset()}),b.metadataProcessed&&b.metadataProcessed.add(function(a,b){c.enabled&&b&&b.id&&b.contentProperties.uuid&&(c.uuidToId[b.contentProperties.uuid.toLowerCase()]=b.id)})}return a.prototype.reset=function(){this.uuidToId={}},a.prototype.getIdFromUuid=function(a){var b=this;a=a.toLowerCase();var c=this.enabled&&this.uuidToId[a];return c?Q.when(c):this.storageService.loadByUuid(a,"cacheMiss").then(function(c){return b.uuidToId[a]=c.affectedStoreMetadata.id})},a}();b.IdCacheService=c,a.module("ionwebStorages").service("storageIdCache",["ionweb.serverService","ionweb.storageService"],function(a,b){return new c(a,b)})}(b=a.storages||(a.storages={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){}return a.Err_Json_Supported_From_Server_Ver="Invalid operation: JSON storage only supported by ION.WEB Server starting from version ",a.Err_Preference_Not_Single_Private_Root_Found="No unique private root found",a.Err_Preference_NoSingle_Private="No single private ${name} folder found",a.Err_NullStorageName="Name cannot be empty or whitespace",a.Err_LongStorageName="Name is too long",a.Err_InvalidChars="Name cannot contain any of these characters: ${chars}",a.Err_LongStorageDescription="Description is too long",a.Err_LongStorageUserData="The custom field is too long",a.Err_Server_Code_MATCHING_USER_NOT_FOUND="Matching user not found.",a.Err_Server_Code_STORAGE_AREA_NOT_FOUND="The specified file or folder is not found.",a.Err_Server_Code_USER_NOT_AUTHORIZED="The user is not authorized to perform the requested operation.",a.Err_Server_Code_DATA_STORAGE_ERROR="The client sent a request without mandatory attribute or element or with inconsistent metadata.",a.Err_Server_Code_STORAGE_AREA_ALREADY_EXISTS="A file or folder with the same name already exists.",a.Err_Server_Code_VERSION_MISMATCH_LOCKING_EXCEPTION="The version of the file or folder specified in the request is not updated. A concurrent modification occurred.",a.Err_Server_Code_DB_ERROR="An error occurred contacting the database.",a.Err_Server_Code_STORE_EXCEPTION="An exception occurred handling the request.",a.Err_Server_Code_MISSING_VERSION_NUMBER_ON_UPDATE="The update request did not include a version number.",a.Err_Server_Code_CREATING_CIRCULAR_RELATIONSHIP="The update folder request would result in a circular path.",a.Err_Server_Code_UNSUPPORTED_OPERATION_ON_SYSTEM_FOLDER="The operation is not allowed on the specified system folder.",a.Err_Server_Code_DELETING_NON_EMPTY_TREE_NODE="The delete folder request is applied to a non empty folder without setting the recursive flag.",a.Err_Server_Code_MOVING_MULTI_OWNER_TREE_NODE="The update folder request tries to move a tree with sub-folders or files belonged to owners into a user's home.",a.Err_Server_Code_MULTI_OWNER_INCONSISTENCE="Cannot create or move a file or folder belonging to a certain owner into a private folder of a different user.",a.Err_Server_Code_NETWORK_ERROR="Unable to reach the server.",a.Err_Server_Code_BAD_RESPONSE="Unable to parse the server response. Possible server version mismatch?",a.Err_Server_Code_MANDATORY_FIELD="The request lacks a required field.",a}();a.Strings=b}(b=a.storages||(a.storages={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c="IONWEB_TEMPLATES",d=function(){function a(a){this.updateMd(a)}return Object.defineProperty(a.prototype,"name",{get:function(){return this._storage.contentProperties.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ownerId",{get:function(){return this._storage.contentProperties.ownerUsername},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"shared",{get:function(){return this._storage.contentProperties.shared},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"storage",{get:function(){return this._storage},enumerable:!0,configurable:!0}),a.prototype.updateMd=function(a){this._storage=a},a}(),e=function(){function b(a,b,c){this.storageService=b,this.serverService=c,this.logger=a.create("TemplateStoSrv")}return b.prototype.createRoot=function(a){return this.storageService.createNode({displayName:c,parentId:a}).then(function(a){return a.affectedStoreMetadata})},b.prototype.createSharedHome=function(a,b){return this.storageService.createNode({displayName:a,parentId:b}).then(function(a){return a.affectedStoreMetadata})},b.prototype.getOrCreatePrivateRoot=function(){var b=this;return this.storageService.listRoots().then(function(d){var e=a.firstOrDefault(d.storages,function(a){return a.contentProperties.storeType===b.storageService.systemUserHomeType});if(!e)throw new Error("Private home not accessible");return b.storageService.loadByPath(e.id,c+"/").then(function(a){return a.storages[0]},function(c){if(c.storageErrorType===a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND)return b.createRoot();throw c})})},b.prototype.fetch=function(b){return this.logger.low("fetch",{type:b}),this.storageService.loadTreesByPath(c+"/",a.NodeRetrieveMode.Recursive,[b]).then(function(b){var e=a.firstOrDefault(b,function(a){return a.storages.every(function(a){return!a.contentProperties.shared})}),f=a.firstOrDefault(b,function(a){return a.storages.every(function(a){return a.contentProperties.shared})}),g=function(b){return a.firstOrDefault(b.storages,function(a){return a.contentProperties.displayName===c})},h=e&&g(e),i=f&&g(f),j=[];if(h&&(j=j.concat(e.storages.filter(function(a){return a.contentProperties.parentId===h.id}).map(function(a){return new d(a)}))),i){var k=f.storages.filter(function(a){return a.contentProperties.isTreeNode&&a.contentProperties.parentId===i.id});k.forEach(function(a){j=j.concat(f.storages.filter(function(b){return b.contentProperties.parentId===a.id}).map(function(a){return new d(a)}))})}return j})},b.prototype.create=function(b,c,e){var f=this;this.logger.low("create",{name:b,type:c});var g=function(b,g){return f.storageService.create({displayName:g,storeType:c,parentId:b},{content:e,contentType:a.ContentType.Json}).then(function(a){return new d(a.affectedStoreMetadata)})},h=this.serverService.getUserName(),i=function(c){var d=c.filter(function(a){return a.ownerId===h});return a.getUniqueName(b,d.map(function(a){return a.name}))};return this.fetch(c).then(function(a){return b=i(a),f.getOrCreatePrivateRoot().then(function(a){return g(a.id,b)})})},b.prototype.read=function(a){return this.logger.low("read",{name:a.name}),this.storageService.loadContent(a.storage.id).then(function(a){return a.content})},b.prototype.checkErrUpdateMd=function(b,c,d){if(b.storageErrorType===a.StorageErrorTypes.VERSION_MISMATCH_LOCKING_EXCEPTION)return this.storageService.loadTree(c.storage.id,a.NodeRetrieveMode.NodeOnly).then(function(a){return c.updateMd(a.affectedStoreMetadata),d()});throw b},b.prototype.write=function(b,c){var d=this;this.logger.low("write",{name:b.name});var e=function(){return d.storageService.update(b.storage.id,b.storage.version,null,{content:c,contentType:a.ContentType.Json}).then(function(a){return b.updateMd(a.affectedStoreMetadata)},function(a){return d.checkErrUpdateMd(a,b,function(){return e()})})};return e()},b.prototype.share=function(b){var d=this;return this.logger.low("share",{name:b.name}),this.storageService.listRoots().then(function(e){var f=a.firstOrDefault(e.storages,function(a){return a.contentProperties.storeType===d.storageService.systemSharedHomeType});if(!f)throw new Error("Cannot access shared space");var g,h,i=function(){return d.storageService.update(b.storage.id,b.storage.version,{parentId:g,displayName:b.name}).then(function(a){return b.updateMd(a.affectedStoreMetadata)},function(a){return d.checkErrUpdateMd(a,b,function(){return i()})})},j=d.serverService.getUserName(),k=d.storageService.cleanupNameNotUnique(j),l=function(){return d.storageService.loadByPath(h,k+"/").then(function(a){return g=a.storages[0].id,i()},function(a){return d.createSharedHome(k,h).then(function(a){return g=a.id,i()})})};return d.storageService.loadByPath(f.id,c+"/").then(function(a){return h=a.storages[0].id,l()},function(a){return d.createRoot(f.id).then(function(a){return h=a.id,l()})})})},b.prototype.unshare=function(a){var b=this;this.logger.low("unshare",{name:a.name});var c,d=function(){return b.storageService.update(a.storage.id,a.storage.version,{parentId:c,displayName:a.name}).then(function(b){a.updateMd(b.affectedStoreMetadata)},function(c){return b.checkErrUpdateMd(c,a,function(){return d()})})};return this.getOrCreatePrivateRoot().then(function(a){return c=a.id,d()})},b.prototype.delete=function(a){var b=this;this.logger.low("delete",{name:a.name});var c=function(){return b.storageService.delete(a.storage.id,a.storage.version).catch(function(d){return b.checkErrUpdateMd(d,a,function(){return c()})})};return c()},b}();b.TemplateStorageService=e,a.module("ionwebStorages").service("templateStorageService",["ionweb.loggerFactory","ionweb.storageService","ionweb.serverService"],function(a,b,c){return new e(a,b,c)})}(b=a.storages||(a.storages={}))}(ionweb||(ionweb={})),ionweb.services.registerCoreSubmodule("ionwebStorages",["ionwebCore"],ionweb.storages.Strings);var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),ionweb;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(){}return a}();a.CommonTokens=b;var c=function(){function a(){}return a.Key="Freezing",a.Freeze="Freeze",a.Unfreeze="Unfreeze",a}();a.Freeezing=c;var d=function(){function a(){}return a.Key="Sorting",a.ActionBeginTraceConfiguration="TracingConf_begin",a.ActionEndTraceConfiguration="TracingConf_end",a.ActionTracingConfiguration="TracingConf",a.ActionTogglingStart="TogglingStart",a.AddingColumn="AddingColumn",a.SkippingColumn="SkippingColumn",a.AxisTypeRow="Row",a.AxisTypeColumn="Column",a.AddingHeaderLevel="AddingHeaderLevel",a.SkippingHeaderLevel="SkippingHeaderLevel",a.ResetAllSorting="ResetAllSorting",a.RemoveColumn="RemoveColumn",a.RemoveHeaderLevel="RemoveHeaderLevel",a}();a.Sorting=d;var e=function(){function a(){}return a.Key="Selection",a.FullTableSelection="Full Table Selection",a.NoSelection="No Selection",a.OnSelectionChanged="OnSelectionChanged",a}();a.Selection=e;var f=function(){function a(){}return a.Key="Mouse",a.HitTest="HitTest",a.Click="Click",a.DoubleClick="DoubleClick",a.TouchStart="TouchStart",a.TouchEnd="TouchEnd",a}();a.Mouse=f;var g=function(){function a(){}return a.Key="Exporting",a.ExportingToFile="ExportingToFile",a.CSV="CSV",a.Export="Export",a}();a.Exporting=g;var h=function(){function a(){}return a.Key="Editing",a.StartEdit="StartEdit",a.DeferStartEdit="DeferStartEdit",a.ExecuteDeferStartEdit="ExecuteDeferStartEdit",a.TimeoutDeferStartEdit="TimeoutDeferStartEdit",a.CancelDeferStartEdit="CancelDeferStartEdit",a.EndEdit="EndEdit",a.Paste="Paste",a.PasteFailed="PasteFailed",a.ReasonAutoStart="AutoStart",a.ReasonF2="F2",a.ReasonClick="Click",a.ReasonApi="API",a.ReasonEsc="Esc",a.ReasonBlur="Blur",a.ReasonTab="Tab",a.EditStarting="EditStarting",a.ControllerNotInitialized="ControllerNotInitialized",a.RowRender="RowRender",a.RowUnrender="RowUnrender",a.ReasonNone="None",a.ReasonOther="Other",a.ReasonEnter="Enter",a}();a.Editing=h;var i=function(){function a(){}return a.Key="DMEvent",a}();a.DataModelEvents=i;var j=function(){function a(){}return a.DumpIds="DumpIds",a.IdBinding="IdBinding",a.Disposed="Disposed",a.Cell="Cell",a.DelayInit="DelayInit",a.ReInit="ReInit",a.CurrentCell="CurrentCell",a.FullRows="FullRows",a.FullCols="Ranges",a.PartCols="PartCols",a.PartRows="PartRows",a.Ranges="Ranges",a.onKeyDown="onkeydown",a.onCellClick="onCellClick",a.onRowHeaderCellClick="onRowHeaderCellClick",a.onHeaderCellClick="onHeaderCellClick",a.ColumnHeader="ColumnHeader",a.RowHeader="RowHeader",a.onCellDblClick="onCellDblClick",a.onRowHeaderCellDblClick="onRowHeaderCellDblClick",a.onHeaderCellDblClick="onHeaderCellDblClick",a.IRow="IRow",a.Expanding="Expanding",a.Collapsing="Collapsing",a.RowEventBurst="RowEventBurst",a.ColumnEventBurst="ColumnEventBurst",a}();a.GridEvents=j;var k=function(){function a(){}return a.Key="OptionsDialog",a.VisColMove="OptDlgVisColMove",a.VisColHide="OptDlgVisColHide",a.VisColShow="OptDlgVisColShow",a}();a.OptionsDialog=k;var l=function(){function a(){}return a.ColumnMove="ColumnMove",a.ColumnMoved="ColumnMoved",a}();a.ColumnDef=l;var m=function(){function a(){}return a.Key="Clipboard",a.Paste="Paste",a.Text="Text",a.Copy="Copy",a.CopyToClipboard="CopyToClipboard",a}();a.Clipboard=m;var n=function(){function a(){}return a.RecordDataModel="RecordDataModel",a.ChainDataModel="ChainDataModel",a.QueueDataModel="QueueDataModel",a.ScrollerDataModel="ScrollerDataModel",a.Supply="Supply",a.Kill="Kill",a.NotAvailable="Not Available",a}();a.DataModel=n;var o=function(){function a(){}return a.Grid="Grid",a}();a.Tags=o;var p=function(){function a(){}return a._Row_="_Row_",a._Column_="_Column_",a.PivotAxis="PivotAxis",a.Create="Create",a.Insert="Insert",a.Remove="Remove",a.Move="Move",a.Suspend="Suspend",a.Resume="Resume",a.Raise="Raise",a}();a.PivotAxisDef=p;var q=function(){function a(){}return a.FlatAxis="FlatAxis",a}();a.FlatAxisDef=q;var r=function(){function a(){}return a.VirtualFlatAxis="VirtualFlatAxis",a._Row_="_Row_",a}();a.VirtualFlatAxisDef=r;var s=function(){function a(){}return a.SingleLevelExpansionPivotAxisView="SingleLevelExpansionPivotAxisView",a}();a.SingleLevelExpansionPivotAxisViewDef=s}(b=a.LogKeys||(a.LogKeys={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(){}return b.load=function(a,b,c){return void 0==c||c.tag===a&&c.version===b?c:null},b.serialize=function(b,c,d){return a.extend({tag:b,version:c},[d])},b}();b.PersistableStateHelper=c;var d=function(){function a(a,b){this.columnState=a,this.rowState=b}return a.load=function(b){var d=c.load(a.tag,a.version,b);if(!d)return null;var e=d.columnState,f=d.rowState;return e||f?new a(e,f):null},a.prototype.serialize=function(){return c.serialize(a.tag,a.version,{columnState:this.columnState,rowState:this.rowState})},a.tag="__ManualDataModelState",a.version=1,a}();b.DataModelState=d}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){function c(){return(++j).toString()}function d(a,c){for(var d=[];a;){var e=a.getAs(c);e&&d.push(e),a=e instanceof b.DataModelAdapter?e.source:null}return d}function e(a){var b=a.getSliceRange(0,a.length()),c=b.map(function(a){return{nodeKey:a.key(),displayName:a.displayName,description:a.description,alias:a.alias,category:a.category}}),d=a.options.getAvailableSlices().filter(function(a){return!c.some(function(b){return b.nodeKey===a.nodeKey})});return d.forEach(function(a){c.push(a)}),c}function f(a){return Object.keys(a).filter(function(b){return a[b]})}function g(a,b){var c={};return f(a).forEach(function(a){var d=b?b(a):a;c[d]=!0}),c}function h(a){for(var b="",c=0;c<a.length;c++){var d=w.indexOf(a[c]);b+=d>-1?"@"+x[d]:a[c]}return b}function i(a){for(var b="",c=!1,d=0;d<a.length;d++){var e=a[d];if(c){var f=x.indexOf(e);f>-1&&(b+=w[f]),c=!1}else"@"===e?c=!0:b+=e}return b}var j=0;b.getInstanceId=c;var k;!function(a){a[a.SliceAdded=0]="SliceAdded",a[a.SliceRemoved=1]="SliceRemoved",a[a.SliceMoved=2]="SliceMoved",a[a.Reset=3]="Reset"}(k=b.SliceEventType||(b.SliceEventType={}));var l;!function(a){a[a.Row=0]="Row",a[a.Column=1]="Column"}(l=b.AxisType||(b.AxisType={})),b.getAll=d;var m,n=function(){function a(a,b,c,d,e,f,g,h){this.key=a,this.displayName=b,this.nodeKey=c,this.alias=d,this.description=e,this.category=f,this.hidden=g,this.tooltip=h}return a}();!function(a){a[a.PreOrder=0]="PreOrder",a[a.PostOrder=1]="PostOrder"}(m=b.TreeVisitMode||(b.TreeVisitMode={}));var o=function(){function b(a,b,c,d,e,f){this.alias=c,this.description=d,this.category=e,this.tooltip=f,this._children=[],this.leavesCount=0,this._key=a,this._level=0,this.leavesCount=0,this.setDisplayName(b)}return b.prototype.key=function(){return this._key},b.prototype.level=function(){return this._level},b.prototype.setLevel=function(a){this._level=a,this._children&&this._children.forEach(function(b){return b.setLevel(a+1)})},b.prototype.length=function(){return this._children?this._children.length:0},b.prototype.child=function(a){return this._children[a]},b.prototype.children=function(){return this._children?this._children:[]},b.prototype.parent=function(){return this._parent},b.prototype.displayName=function(){return this._displayName},b.prototype.value=function(){return this._value},b.prototype.setDisplayName=function(a){a||""==a||(a=this._key);var b=this._displayName!==a;return this._displayName=a,b},b.prototype.setValue=function(a){this._value=a},b.prototype.indexOf=function(a){return this._children.indexOf(a)},b.prototype.removeBlock=function(a,b){return this._children.splice(a,b)},b.prototype.moveBlock=function(b,c,d){a.moveBlock(this._children,b,c,d)},b.prototype.append=function(a,c){var d=new b(a,c);return this.insertBlock([d],this._children.length),d},b.prototype.appendBlock=function(a){this.insertBlock(a,this._children.length)},b.prototype.insertBlock=function(a,b){for(var c=0;c<a.length;c++)a[c]._parent=this,a[c].setLevel(this.level()+1);var d=this._children.slice(0,b);d=d.concat(a),d=d.concat(this._children.slice(b)),this._children=d},b.prototype.visitTree=function(a,b,c){if(b===m.PreOrder&&a(this),this._children&&c(this))for(var d=this._children.length,e=0;e<d;e++)this._children[e].visitTree(a,b,c);b===m.PostOrder&&a(this)},b.prototype.setHeaderClass=function(a){this._class=a},b.prototype.headerClass=function(){return this._class},b}();b.TreeNode=o,b.collectAvailableItems=e,b.keySetToArray=f,b.cloneKeySet=g;var p=function(){function b(){this._collectingRequiredSlicesEvent=new a.Event,this._collectedRequiredSlicesEvent=new a.Event}return b.compareKeySets=function(a,b){var c=Object.keys(a).filter(function(b){return a[b]}).some(function(a){return!b[a]});if(c)return!1;var d=Object.keys(b).filter(function(a){return b[a]}).some(function(b){return!a[b]});return!d},b.prototype.raiseCollectingRequiredSlicesEvent=function(a){this._collectingRequiredSlicesEvent.raise(this,a)},Object.defineProperty(b.prototype,"collectingRequiredSlices",{get:function(){return this._collectingRequiredSlicesEvent},enumerable:!0,configurable:!0}),b.prototype.raiseCollectedRequiredSlicesEvent=function(a){this._collectedRequiredSlicesEvent.raise(this,a)},Object.defineProperty(b.prototype,"collectedRequiredSlices",{get:function(){return this._collectedRequiredSlicesEvent},enumerable:!0,configurable:!0}),b.prototype.refreshRequiredSlices=function(){var a={};return this.recurseOnRefreshRequiredSlices(a),this.processCollectedRequiredSlices(a),a},b.prototype.recurseOnRefreshRequiredSlices=function(a){var c=g(a),d={slices:a};this.raiseCollectingRequiredSlicesEvent(d);var e=b.compareKeySets(c,a);e||this.recurseOnRefreshRequiredSlices(a)},b.prototype.processCollectedRequiredSlices=function(a){var b={slices:a};this.raiseCollectedRequiredSlicesEvent(b)},b}();b.RequiredSlicesProcessor=p;var q=function(){function d(d,e){var f=this;this.config=d,this._collectingRequiredSlicesEvent=new a.Event,this.expandStates={},this.emptyExpandedNodes={},this.sliceMeasureKeys=[],this.disabledLevelSummaries=[],this.evtQueue=[],this.suspended=0,this.nodeStateUpdated=new a.Event,this.enableLeavesCounter=!1;var g=this.getLogTag()||b.LogKeys.PivotAxisDef.PivotAxis,h=c();this._logId=e?e+"_"+h:h,this._logger=a.getService("ionweb.loggerFactory").create(g),this.measures=this.convertStringTypeMeasures(d.measures),this._logger.ifHigh(function(){return{key:b.LogKeys.PivotAxisDef.Create,params:{Id:f._logId}}}),this._options={},this._options.forceHideOfChildlessSummaries=d.neverShowSummaries,this._options.slicesEvent=new a.Event,this._options.measuresChanged=new a.Event,this._options.getAvailableSlices=function(){var a=f.getSliceRange(0,f.length()).map(function(a){var b=a.key(),c={nodeKey:b,displayName:a.displayName,category:a.category,alias:a.alias,description:a.description};return c});return a},this.requiredSlicesProcessor=new p,this._options.collectingRequiredSlices=this._collectingRequiredSlicesEvent,this.requiredSlicesProcessor.collectingRequiredSlices.add(function(a,b){f.getAxisRequiredSlices(b.slices),f.raiseCollectingRequiredSlicesEvent(b)}),this.requiredSlicesProcessor.collectedRequiredSlices.add(function(a,b){f.processCollectedRequiredSlices(b.slices)}),this._options.refreshRequiredSlices=function(){var a=f.requiredSlicesProcessor.refreshRequiredSlices();return a},this.nodeKeyMap={},this.measureKeyMap={},this.updateVisibleLevelSummaries(this.config.visibleLevelSummaries),this._options.getExpandState=function(a){var b=f.expandStates[a];return b?b:s.None},this._options.append=function(a,b){f.options.appendBlock(a,[b])},this._options.appendBlock=function(a,b){f.options.insertBlock(a,b,a.length())},this._options.insert=function(a,b,c){f.options.insertBlock(a,[b],c)};var i=function(c,d,e,g){var h=function(){var a={Id:f._logId,Action:b.LogKeys.PivotAxisDef.Insert,ItemPos:e,Parent:c.key(),Count:d.length};return{key:b.LogKeys.DataModelEvents.Key,params:a}};if(f.suspended>0?f._logger.ifMedium(h):f._logger.ifLow(h),d&&0!==d.length){if(!f.nodeKeyMap[c.key()]){var i=!1;if(f.config.root.visitTree(function(a){a.key()===c.key()&&(i=!0)},m.PreOrder,function(){return!0}),!i){var j=a.stringFormat(b.Strings.Err_Invalid_NodeException,{key:c.key()});throw new Error(j)}}d.forEach(function(a){if(f.nodeKeyMap[a.key()])throw new Error(b.Strings.Err_DM_DuplicatedKey+a.key())});var k=c.length();if(k<e||e<0){var l=a.stringFormat(b.Strings.Err_DM_Invalid_IndexExceptionPassed_ExpectedLength,{index:e,length:c.length()});throw new Error(l)}c.insertBlock(d,e),f.initExpandState(c,!0),!g&&f.enableLeavesCounter&&f.computeRecordCount(f.config.root),f.processNewVisibleNodes(d,c,e,g)}};this._options.insertBlock=function(a,b,c){i(a,b,c,!1)},this._options.clear=function(a){f.options.removeBlock(a,0,a.length())},this._options.remove=function(a,c){var d=f.nodeKeyMap[c];if(!d)throw new Error(b.Strings.Err_DM_NodeKey_NotFound);if(!d.parent()&&d.parent()!==a)throw new Error(b.Strings.Err_DM_Invalid_Parent);var e=a.indexOf(d);if(e<0)throw new Error(b.Strings.Err_DM_Invalid_Parent);f.options.removeBlock(a,e,1)};var j=function(c,d,e,g){var h=c.key(),i=function(){var a={id:f._logId,Action:b.LogKeys.PivotAxisDef.Remove,Parent:h,Start:d,Count:e};return{key:b.LogKeys.DataModelEvents.Key,params:a}};if(f.suspended>0?f._logger.ifMedium(i):f._logger.ifLow(i),c&&c.length()){var j=c.length();if(j<d||d<0){var k=a.stringFormat(b.Strings.Err_DM_Invalid_StartIndex_ExceptionPassed,{start:d,length:c.length()});throw new Error(k)}for(var l=f.options.getNodeSliceRange(h,d,e),m=c;m&&f.isLevelSummaryVisible(m.level());)m=m.parent();var n=c.removeBlock(d,e);f.initExpandState(c,!1);var o=f.processRemoveSlices(l.start,l.count,!0,m?m.key():null,!0);!g&&f.enableLeavesCounter&&f.computeRecordCount(f.config.root);var p=null;if(f._options.forceHideOfChildlessSummaries||f.isLevelSummaryVisible(c.level())||0!==c.length()||(p=f.addSummarySlices(c,!0)),f.detachNodes(n),!g){var q=o;p&&(q=q.concat(p)),q.length&&f.raiseEvent(q)}}};this._options.removeBlock=function(a,b,c){j(a,b,c,!1)},this._options.resetNode=function(a,b){j(a,0,a.length(),!0),i(a,b,0,!0),f.raiseEvent([{type:k.Reset}])},this._options.move=function(c,d,e,g){var h=function(){var a={Id:f._logId,Action:b.LogKeys.PivotAxisDef.Move,Start:d,Count:e,Target:g};return{key:b.LogKeys.DataModelEvents.Key,params:a}};if(f.suspended>0?f._logger.ifMedium(h):f._logger.ifLow(h),c&&0!==c.length()&&0!=e){if(d<0||e<0||g<0){var i=a.stringFormat(b.Strings.Err_DM_InvalidParameters_MoveOperationPassed_StartCountTarget,{start:d,count:e,target:g});throw new Error(i)}if(d+e>c.length()){var j=a.stringFormat(b.Strings.Err_DM_InvalidParameter_PassedFor_StartCount_GreaterThen_Parent,{start:d,count:e,key:c.key(),length:c.length()});throw new Error(j)}if(g>c.length()-e){var k=a.stringFormat(b.Strings.Err_DM_InvalidParameter_Target_GreaterThen_ParentMinusCount,{target:g,count:c.length()-e});throw new Error(k)}var l,m=f.getFirstSlice(c.child(d).key()),n=f.lastSliceIndex(c.child(d+e-1).key()),o=n-m+1;if(l=g==c.length()-e?f.sliceMeasureKeys.length-o:f.getFirstSlice(c.child(g).key())+(g>d?-o+1:0),c.moveBlock(d,e,g),a.moveBlock(f.sliceMeasureKeys,m,o,l),f.updateAllNodeIndexes(Math.min(m,g)),f.hasVisibleSubtree(c)){var p=f.sliceMeasureKeys.slice(l,l+o);f.raiseSlicesMoved(m,p.map(function(a){return a.key}),p.map(function(a){return a.nodeKey}),l)}}},this._options.getVisibleRoot=function(){return f.config.root},this._options.suspend=function(){var a=function(){var a={Id:f._logId,Action:b.LogKeys.PivotAxisDef.Suspend};return{key:b.LogKeys.DataModelEvents.Key,params:a}};f._logger.ifHigh(a),f.suspended++},this._options.resume=function(){var a=function(){var a={Id:f._logId,Action:b.LogKeys.PivotAxisDef.Resume};return{key:b.LogKeys.DataModelEvents.Key,params:a}};if(f._logger.ifHigh(a),--f.suspended){if(f.suspended<0)throw new Error(b.Strings.Err_DM_Invalid_ResumeOperation_Model_NotSuspended)}else f.evtQueue.length>0&&(f.options.slicesEvent.raise(f,f.evtQueue),f.evtQueue=[])},this._options.reset=function(){f.suspended=0,f.evtQueue=[]},this._options.getMeasures=function(){return f.measures},this._options.setMeasures=function(a){var b=f.convertStringTypeMeasures(a),c=f.compareMeasures(b,f.measures);f.measures=b,f.refreshMeasures(),c||f.options.measuresChanged.raise(f,f.measures)},this._options.getVisibleLevelSummaries=function(){return f.config.visibleLevelSummaries},this._options.setVisibleLevelSummaries=function(a){f.updateVisibleLevelSummaries(a),f.init(),f.raiseEvent([{type:k.Reset}])},this._options.isLevelSummaryVisible=function(a){return f.isLevelSummaryVisible(a)},this._options.isNodeSummaryVisible=function(a){return f.isLevelSummaryVisible(f.nodeKeyMap[a].level())},this._options.requestExpandState=function(a,c){var d=function(){var d={Id:f._logId,Action:c?b.LogKeys.GridEvents.Expanding:b.LogKeys.GridEvents.Collapsing,CollectionType:b.LogKeys.GridEvents.IRow,ItemKey:a};return{key:b.LogKeys.DataModelEvents.Key,params:d}};f.suspended>0?f._logger.ifMedium(d):f._logger.ifLow(d);var e=f.nodeKeyMap[a];return!(!e||!f.canChangeNodeState(e,c))&&(f.performNodeStateChange(e,c),!0)},this._options.getTreeNode=function(a){return f.nodeKeyMap[a]},this._options.getNodeKey=function(a){return f.measureKeyMap[a].nodeKey},this._options.getSliceKeys=function(a){return f.hasVisibleSlices(f.nodeKeyMap[a])?f.nodeMeasures[a].map(function(a){return a.key}):[]},this._options.getNodeSliceRange=function(a,b,c){var d=f.nodeKeyMap[a];return f.getNodeSliceRange(d,b,c)},this._options.setDisplayName=function(a,b){return f.setDisplayItem(a.map(function(a){return{nodeKey:a.nodeKey,displayName:a.displayName}}),b!==!1)},this._options.setAlias=function(a,b){return f.setDisplayItem(a.map(function(a){return{nodeKey:a.nodeKey,alias:a.alias}}),b!==!1)},this._options.setDescription=function(a,b){return f.setDisplayItem(a.map(function(a){return{nodeKey:a.nodeKey,description:a.description}}),b!==!1)},this._options.setCategory=function(a,b){return f.setDisplayItem(a.map(function(a){return{nodeKey:a.nodeKey,category:a.category}}),b!==!1)},this._options.setDisplayItemOptions=function(a,b){return f.setDisplayItem(a,b!==!1)},this._options.setValues=function(a){var b=[];a.forEach(function(a){var c=f.options.getTreeNode(a.nodeKey);c&&c.setValue&&(c.setValue(a.value),b.push({nodeKey:a.nodeKey,value:a.value}))}),f.raiseNodeStateUpdated(b)},this.config.root.visitTree(this.initExpandState.bind(this),m.PreOrder,function(){return!0}),this.setNodeState(d.root,s.Expanded),this.init()}return Object.defineProperty(d.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),d.prototype.getNodeMeasures=function(a){return this.nodeMeasures[a]},d.prototype.getNode=function(a){return this.nodeKeyMap[a]},d.prototype.getNodeKeyMap=function(){return this.nodeKeyMap},d.prototype.getState=function(){},d.prototype.setState=function(a){},d.prototype.getSerializableNodeState=function(a){var b=this,c=[],d=[];return Object.keys(this.expandStates).forEach(function(e){var f=!0;if(a>=0){var g=b.getNode(e);f=g&&g.level()<=a}if(f){var h=b.expandStates[e];b.config.defaultNodeStatus===u.Expanded?0!==(h&s.Collapsed)&&d.push(e):0!==(h&s.Expanded)&&c.push(e)}}),{openNodes:c,closeNodes:d}},d.prototype.collapseAll=function(){var a=this,b=this.config.root;this.config.visibleLevelSummaries&&1!=this.config.visibleLevelSummaries[0]?b.children().forEach(function(b){a.options.requestExpandState(b.key(),!1)}):this.options.requestExpandState(b.key(),!1)},d.prototype.expandToLevel=function(a){var b=this,c=function(a){for(var c=0,d=a.length;c<d;c++){var e=a.splice(0,1)[0];b.options.requestExpandState(e.key(),!0),e.children()&&(a=a.concat(e.children()))}return a},d=this.config.root;this.options.requestExpandState(d.key(),!1);var e=[];e=e.concat(d);for(var f=0;(void 0===a||f<a)&&e.length;f++)e=c(e);for(var g=0;g<e.length;g++)this.options.requestExpandState(e[g].key(),!1);
},d.prototype.expandToDetails=function(){var a=this.config.root;this.options.requestExpandState(a.key(),!0);var b=[];for(b=b.concat(a.children());b.length;){var c=b.splice(0,1)[0];this.options.requestExpandState(c.key(),!0),c.children()&&(b=b.concat(c.children()))}},d.prototype.setSerializableNodeState=function(a){var b=this;if(a&&(a.closeNodes.length>0||a.openNodes.length>0)){var c,d;this.config.defaultNodeStatus===u.Expanded?(d=a.closeNodes,c=Object.keys(this.expandStates).filter(function(a){return b.expandStates[a]&s.Collapsed&&d.indexOf(a)<0})):(c=a.openNodes,d=Object.keys(this.expandStates).filter(function(a){return b.expandStates[a]&s.Expanded&&c.indexOf(a)<0})),d.forEach(function(a){b.options.requestExpandState(a,!1)||(b.expandStates[a]=s.Collapsed)}),c.forEach(function(a){b.options.requestExpandState(a,!0)||(b.expandStates[a]=s.Expanded)})}},d.prototype.isLevelSummaryVisible=function(a){return!this.disabledLevelSummaries[a]},d.prototype.validateKeyName=function(c){if(/[\\\'\"]|&#?[a-zA-Z0-9]*;/.test(c)){var d=a.stringFormat(b.Strings.Err_DM_Invalid_CharacterKey,{key:c});throw new Error(d)}},d.prototype.initNodeMapping=function(a){var b=this,c=[];this.validateKeyName(a.key()),this.nodeKeyMap[a.key()]=a;var d=this.isAllMeasuresHidden();this.measures.length>0&&!d?this.measures.forEach(function(d){var e=d.key||d;b.validateKeyName(e);var f=a.key()+"|"+e;if(!d.hidden){b.measureKeyMap[f]={nodeKey:a.key()},b.measureKeyMap[f].measureKey=e;var g=d.displayName||e;c.push(new n(f,g,a.key(),d.alias,d.description,d.category,d.hidden,d.tooltip))}a.isPlaceholder=!1}):(this.measureKeyMap[a.key()]={nodeKey:a.key()},c=[new n(a.key(),a.displayName(),a.key(),a.alias,a.description,a.category,void 0,a.tooltip)],a.isPlaceholder=!0),this.nodeMeasures[a.key()]=c},d.prototype.updateMeasureInfo=function(a,b){var c=!1;return"undefined"!=typeof b.displayName&&a.displayName!==b.displayName&&(a.displayName=b.displayName,c=!0),"undefined"!=typeof b.alias&&a.alias!==b.alias&&(a.alias=b.alias,c=!0),"undefined"!=typeof b.description&&a.description!==b.description&&(a.description=b.description,c=!0),"undefined"!=typeof b.category&&a.category!==b.category&&(a.category=b.category,c=!0),"undefined"!=typeof b.tooltip&&a.tooltip!==b.tooltip&&(a.tooltip=b.tooltip,c=!0),c},d.prototype.updateAllMeasures=function(b,c){var d=this,e=!1;Object.getOwnPropertyNames(this.nodeMeasures).forEach(function(a){for(var f=d.nodeMeasures[a],g=0;g<f.length;g++){var h=f[g],i=d.measureKeyMap[h.key];i&&i.measureKey===c&&(e=d.updateMeasureInfo(h,b)||e)}});var f=a.firstOrDefault(this.measures,function(a){return a&&a.key===c});return f&&(e=this.updateMeasureInfo(f,b)||e),e},d.prototype.updateSingleChildMeasure=function(a,b){var c=this.nodeMeasures[b];return 1===c.length&&c[0].key===b&&this.updateMeasureInfo(c[0],a)},d.prototype.setDisplayItem=function(b,c){var d=this,e=[],f=!1,g=[],h=b.map(function(b){var c;d.contains(b.nodeKey)&&(c=d.getNodeAndMeasureKey(b.nodeKey));var h=b.nodeKey;c&&c.measureKey&&(h=c.nodeKey);var i=d.options.getTreeNode(h),j=!1;if(i&&c)if(c.measureKey){if(j=d.updateAllMeasures(b,c.measureKey)){var k=d.nodeMeasures[c.measureKey];g.push(a.extend({},[k]))}}else{var l={nodeKey:b.nodeKey},m=!1;if("undefined"!=typeof b.displayName){var n=b.displayName&&("string"==typeof b.displayName?b.displayName:b.displayName());i.setDisplayName&&i.setDisplayName(n)&&(l.displayName=n,m=!0)}"undefined"!=typeof b.alias&&i.alias!==b.alias&&(l.alias=i.alias=b.alias,m=!0),"undefined"!=typeof b.description&&i.description!==b.description&&(l.description=i.description=b.description,m=!0),"undefined"!=typeof b.tooltip&&i.tooltip!==b.tooltip&&(l.tooltip=i.tooltip=b.tooltip,m=!0),"undefined"!=typeof b.category&&i.category!==b.category&&(l.category=i.category=b.category,m=!0),m&&e.push(l),j=d.updateSingleChildMeasure(b,c.nodeKey)}return f=f||j,j});return f&&this.refreshMeasures(),c&&e.length>0&&this.raiseNodeStateUpdated(e),c&&g.length>0&&this.options.measuresChanged.raise(this,this.measures),h},d.prototype.updateAllNodeIndexes=function(a){for(var b=a;b<this.sliceMeasureKeys.length;b++)this.sliceKeyIndexes[this.sliceMeasureKeys[b].key]=b},d.prototype.getVisibleMeasures=function(a,b){this.hasVisibleSlices(a)&&b.push.apply(b,this.nodeMeasures[a.key()])},d.prototype.insertVisibleSlices=function(a,b){if(this.hasVisibleSlices(a)){var c=this.nodeMeasures[a.key()];return this.addMeasures(c,b),c.length}return 0},d.prototype.hasVisibleSubtree=function(a){var b=this.options.getExpandState(a.key());return 0!==(b&s.Expanded)&&this.isVisible(a)},d.prototype.setNodeState=function(a,b){var c=this.expandStates[a.key()];this.expandStates[a.key()]=b,c!==b&&this.isVisible(a)&&this.raiseNodeStateUpdated([{nodeKey:a.key(),expandState:b}])},d.prototype.initExpandState=function(a,b){var c=this.expandStates[a.key()];if(b&&this.emptyExpandedNodes[a.key()])this.setNodeState(a,s.Expanded),delete this.emptyExpandedNodes[a.key()];else if(b||0!==a.length()||c!==s.Expanded||(this.emptyExpandedNodes[a.key()]=!0),c)a.length()||this.setNodeState(a,s.None);else{var d=this.config.defaultNodeStatus===u.Expanded?s.Expanded:s.Collapsed;this.setNodeState(a,a.length()?d:s.None)}},d.prototype.isVisible=function(a){if(a===this.getVisibleRoot())return!0;var b=a.parent();return!!b&&this.hasVisibleSubtree(a.parent())},d.prototype.getLogTag=function(){return b.LogKeys.PivotAxisDef.PivotAxis},d.prototype.updateVisibleLevelSummaries=function(a){this.config.visibleLevelSummaries=a,this.config.visibleLevelSummaries?this.disabledLevelSummaries=this.config.visibleLevelSummaries.map(function(a){return!a}):this.disabledLevelSummaries=[]},d.prototype.convertStringTypeMeasures=function(a){return a?a.map(function(a){return"string"==typeof a?{key:a}:a}):[]},d.prototype.compareMeasures=function(a,b){var c=!1;if(a&&b){if(a.length!==b.length)c=!1;else for(var d=0;d<a.length;d++)if(a[d].key!==b[d].key){c=!1;break}}else a||b||(c=!0);return c},d.prototype.refreshMeasures=function(){this.init(),this.raiseEvent([{type:k.Reset}])},d.prototype.isAllMeasuresHidden=function(){return!this.measures.some(function(a){return!a.hidden})},d.prototype.computeRecordCount=function(a){var b=this;if(0===a.children().length)return void(a.leavesCount=0);var c=0;a.children().forEach(function(a){b.computeRecordCount(a);var d=0===a.leavesCount?1:a.leavesCount;c+=d}),a.leavesCount=c},d.prototype.getLogTypeName=function(){return"PivotAxis"},d.prototype.getAxisRequiredSlices=function(a){},d.prototype.processCollectedRequiredSlices=function(a){},d.prototype.raiseCollectingRequiredSlicesEvent=function(a){this._collectingRequiredSlicesEvent.raise(this,a)},d.prototype.getLogId=function(){return this._logId},d.prototype.lastSliceIndex=function(a){var b=this.nodeKeyMap[a];if(!b)return-1;for(var c=this.expandStates[b.key()];b.children().length>0&&(c==s.Expanded||c==s.Expanding);)b=b.child(b.length()-1),c=this.expandStates[b.key()];var d=this.nodeMeasures[b.key()],e=d[d.length-1].key;return this.sliceKeyIndexes[e]},d.prototype.computeFirstSliceIndex=function(a,b){var c;if(0==b){if(!this.hasVisibleSlices(a)){if(!a.parent())return 0;var d=a.parent();return this.computeFirstSliceIndex(d,d.indexOf(a))}c=a.key()}else{for(var e=a.child(b-1);e.children().length>0&&0!=(this.expandStates[e.key()]&s.Expanded);)e=e.children()[e.children().length-1];c=e.key()}var f=this.nodeMeasures[c],g=f[f.length-1].key,h=this.sliceKeyIndexes[g]+1;return h},d.prototype.getConfig=function(){return this.config},d.prototype.getFirstSlice=function(a){var b=this.nodeKeyMap[a];return this.hasVisibleSlices(b)?this.sliceKeyIndexes[this.nodeMeasures[a][0].key]:this.getFirstSlice(b.children()[0].key())},d.prototype.getNodeSliceRange=function(a,b,c){var d=this.getFirstSlice(a.child(b).key()),e=0;if(c>0){var f=this.lastSliceIndex(a.child(b+c-1).key());e=f<0?0:f-d+1}return{start:d||0,count:e||0}},d.prototype.detachNodes=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.key();delete this.expandStates[d],delete this.nodeKeyMap[d],delete this.nodeMeasures[d],delete this.emptyExpandedNodes[d],this.detachNodes(c.children())}},d.prototype.processRemoveSlices=function(a,b,c,d,e){var f=this;if(b>0){var g=this.sliceMeasureKeys.splice(a,b),h=g.map(function(a){return a.key}),i=g.map(function(a){return a.nodeKey});this.updateAllNodeIndexes(a),c&&h.forEach(function(a){delete f.sliceKeyIndexes[a],delete f.measureKeyMap[a]});var j=this.buildSliceRemovedArgs(a,h,i,d);return e||this.raiseEvent(j),j}return[]},d.prototype.processNewVisibleNodes=function(a,b,c,d){var e=this;if(0===a.length)return[];if(a.forEach(function(a){return a.visitTree(function(a){return e.initNodeMapping(a)},m.PreOrder,function(){return!0})}),!this.hasVisibleSubtree(b))return[];var f;if(!this._options.forceHideOfChildlessSummaries&&!this.isLevelSummaryVisible(b.level())&&b.length()===a.length){var g=0,h=b.parent();h&&(g=this.computeFirstSliceIndex(h,h.indexOf(b)));var i=this.nodeMeasures[b.key()];this.sliceMeasureKeys.splice(g,i.length),this.updateAllNodeIndexes(g),d||(f={type:k.SliceRemoved,args:{start:g,keys:i.map(function(a){return a.key}),nodeKeys:i.map(function(a){return a.nodeKey}),nonVisibleSummaryRoot:b.key()}})}"undefined"==typeof c&&(c=b.indexOf(a[0]));for(var j=b?this.computeFirstSliceIndex(b,c):0,l=[],n=0;n<a.length;n++){var o=b.child(c+n);this.getVisibleSubtreeMeasures(o,l)}this.addMeasures(l,j);var p=[];f&&p.push(f);var q={type:k.SliceAdded,args:{start:j,keys:l.map(function(a){return a.key}),nodeKeys:l.map(function(a){return a.nodeKey})}};return p.push(q),d||this.raiseEvent(p),p},d.prototype.getSliceRangeKeys=function(a,b){return this.sliceMeasureKeys.slice(a,a+b).map(function(a){return a.key})},d.prototype.getSliceRange=function(a,b){var c=this;return this.getSliceRangeKeys(a,b).map(function(b,d){return c.getSliceWIdx(b,d+a)})},d.prototype.getCategories=function(){var a=[],b=this.getSliceRange(0,this.length());return b.forEach(function(b){void 0!=b.category&&a.indexOf(b.category)<0&&a.push(b.category)}),a},d.prototype.raiseEvent=function(a){var c=this;this.suspended>0?this.evtQueue.push.apply(this.evtQueue,a):(a.forEach(function(a){var d=function(){var d;return d=a.args?{Id:c._logId,Action:b.LogKeys.PivotAxisDef.Raise,Type:a.type,Start:a.args.start,Keys:a.args.keys.join()}:{Id:c._logId,Action:b.LogKeys.PivotAxisDef.Raise,Type:a.type},{key:b.LogKeys.DataModelEvents.Key,params:d}};c._logger.ifHigh(d)}),this.options.slicesEvent.raise(this,a))},d.prototype.buildSliceAddedArgs=function(a,b,c){return[{type:k.SliceAdded,args:{start:a,keys:b,nodeKeys:c}}]},d.prototype.raiseSlicesAdded=function(a,b,c){this.raiseEvent(this.buildSliceAddedArgs(a,b,c))},d.prototype.buildSliceRemovedArgs=function(a,b,c,d){return[{type:k.SliceRemoved,args:{start:a,keys:b,nodeKeys:c,nonVisibleSummaryRoot:d}}]},d.prototype.raiseSlicesRemoved=function(a,b,c,d){this.raiseEvent(this.buildSliceRemovedArgs(a,b,c,d))},d.prototype.raiseSlicesMoved=function(a,b,c,d){this.raiseEvent([{type:k.SliceMoved,args:{start:a,keys:b,nodeKeys:c,target:d}}])},d.prototype.raiseNodeStateUpdated=function(a){var c=this;a.forEach(function(a){var d=function(){var d={Id:c._logId,Action:b.LogKeys.PivotAxisDef.Raise,Type:"nodeUpdate",Key:a.nodeKey,State:a.expandState};return{key:b.LogKeys.DataModelEvents.Key,params:d}};c._logger.ifHigh(d)}),this.nodeStateUpdated.raise(this,a)},d.prototype.getVisibleRoot=function(){return this.config.root},d.prototype.hasVisibleSlices=function(a){var b=this.options.getExpandState(a.key()),c=b===s.None||b===s.Collapsed||b===s.Expanding;return this.isLevelSummaryVisible(a.level())||c&&!this._options.forceHideOfChildlessSummaries},d.prototype.getNodeAndMeasureKey=function(a){var c=this.measureKeyMap[a];if(!c)throw new Error(b.Strings.Err_DM_NodeKey_NotFound);return c},d.prototype.hideMeasure=function(a,b){var c=this;return this.measures.some(function(d){if(d.key===a&&d.hidden!==b)return d.hidden=b,c.refreshMeasures(),c.options.measuresChanged.raise(c,c.measures),!0})},d.prototype.getSlicesOfMeasure=function(a){var b=this,c=[];return Object.keys(this.measureKeyMap).forEach(function(d){var e=b.measureKeyMap[d];e.measureKey===a&&c.push(d)}),c},d.prototype.getVisibleSubtreeMeasures=function(a,b){var c=this;a.visitTree(function(a){c.getVisibleMeasures(a,b)},m.PreOrder,function(a){return 0!==(c.options.getExpandState(a.key())&s.Expanded)})},d.prototype.insertVisibleSubtreeSlices=function(a,b){var c=this,d=0;return a.visitTree(function(a){d+=c.insertVisibleSlices(a,b+d)},m.PreOrder,function(a){return 0!==(c.options.getExpandState(a.key())&s.Expanded)}),d},d.prototype.addMeasures=function(a,b){function c(a,b,c){var d=a.splice(b);return a.concat(c,d)}this.sliceMeasureKeys=c(this.sliceMeasureKeys,b,a),this.updateAllNodeIndexes(b)},d.prototype.init=function(){this.sliceKeyIndexes={},this.sliceMeasureKeys=[],this.nodeMeasures={},this.config.root.visitTree(this.initNodeMapping.bind(this),m.PreOrder,function(){return!0});var a=[];this.getVisibleSubtreeMeasures(this.getVisibleRoot(),a),this.addMeasures(a,0)},d.prototype.length=function(){return this.sliceMeasureKeys.length},d.prototype.addSummarySlices=function(a,b){var c=0,d=a.parent();d&&(c=this.computeFirstSliceIndex(d,d.indexOf(a)));var e=this.insertVisibleSlices(a,c);if(e>0){var f=this.sliceMeasureKeys.slice(c,c+e),g=this.buildSliceAddedArgs(c,f.map(function(a){return a.key}),f.map(function(a){return a.nodeKey}));return b||this.raiseEvent(g),g}return[]},d.prototype.canChangeNodeState=function(a,b){var c=this.options.getExpandState(a.key());return!(c===s.None||b&&(c===s.Expanded||c===s.Expanding)||!b&&(c===s.Collapsed||c===s.Collapsing))},d.prototype.performNodeStateChange=function(a,b){if(b)this.setNodeState(a,s.Expanded),this.processNewVisibleNodes(a.children(),a);else{this.setNodeState(a,s.Collapsed);var c=null;if(a.children().length>0){var d=this.getNodeSliceRange(a,0,a.length());c=this.processRemoveSlices(d.start,d.count,!0,a.key(),!0)}var e=null;this._options.forceHideOfChildlessSummaries||this.isLevelSummaryVisible(a.level())||(e=this.addSummarySlices(a,!0));var f=[];c&&(f=f.concat(c)),e&&(f=f.concat(e)),f.length&&this.raiseEvent(f)}},d.prototype.getSliceWIdx=function(a,b){var c=this.sliceMeasureKeys[b];return{index:function(){return b},key:function(){return a},alias:c&&c.alias,description:c&&c.description,category:c&&c.category,tooltip:c&&c.tooltip,displayName:function(){return c.displayName}}},d.prototype.getSlice=function(a){var c=this.sliceKeyIndexes[a];if("undefined"!=typeof c)return this.getSliceWIdx(a,c);throw new Error(b.Strings.Err_DM_InvalidKey+a)},d.prototype.contains=function(a){var b=this.sliceKeyIndexes[a];return"undefined"!=typeof b},d.prototype.getKey=function(a){return this.sliceMeasureKeys.length&&this.sliceMeasureKeys[a].key},d.prototype.getAs=function(a){return this instanceof a?this:null},d}();b.PivotAxis=q;var r;!function(a){a[a.Normal=0]="Normal",a[a.SingleLevelExpansion=1]="SingleLevelExpansion"}(r=b.AxisViewMode||(b.AxisViewMode={}));var s;!function(a){a[a.None=0]="None",a[a.Expanded=1]="Expanded",a[a.Collapsed=2]="Collapsed",a[a.SwitchInProgress=4]="SwitchInProgress",a[a.Collapsing=5]="Collapsing",a[a.Expanding=6]="Expanding"}(s=b.ExpandState||(b.ExpandState={}));var t=function(a){function c(b,c){var d=a.call(this,b,c)||this;return d.currentZoomLevel=b.root,d.options.getVisibleRoot=function(){return d.currentZoomLevel},d}return __extends(c,a),c.prototype.getLogTag=function(){return b.LogKeys.SingleLevelExpansionPivotAxisViewDef.SingleLevelExpansionPivotAxisView},c.prototype.canChangeNodeState=function(b,c){var d=b===this.currentZoomLevel||b.parent()===this.currentZoomLevel;return d&&a.prototype.canChangeNodeState.call(this,b,c)},c.prototype.performNodeStateChange=function(a,b){var c=this,d=this.currentZoomLevel;if(this.options.getExpandState(a.key())!==s.None){a===this.currentZoomLevel&&this.currentZoomLevel.parent()&&!b&&(this.currentZoomLevel=this.currentZoomLevel.parent()),b&&(this.currentZoomLevel=a);var e=this.getFirstSlice(b?this.currentZoomLevel.key():d.key()),f=this.getConfig().measures,g=e+(f?f.length-1:0),h=g+1,i=this.length()-h,j=[];if(j=j.concat(this.processRemoveSlices(h,i,!1,void 0,!0)),this.setNodeState(a,b?s.Expanded:s.Collapsed),e>0&&(j=j.concat(this.processRemoveSlices(0,e,!1,void 0,!0))),b)j=j.concat(this.processNewVisibleNodes(this.currentZoomLevel.children(),this.currentZoomLevel,void 0,!0));else if(d.parent()){var k=this.length(),l=this.insertVisibleSlices(this.currentZoomLevel,0),m=this.getSliceRangeKeys(0,l);j=j.concat(this.buildSliceAddedArgs(0,m,m.map(function(a){return c.currentZoomLevel.key()})));for(var n=0,o=0,p=!1,q=0;q<this.currentZoomLevel.length();q++){var a=this.currentZoomLevel.child(q);a.key()===d.key()?(n>0&&(m=this.getSliceRangeKeys(l,n),j=j.concat(this.buildSliceAddedArgs(l+1,m,m.map(function(a){return c.options.getNodeKey(a)})))),p=!0,this.isLevelSummaryVisible(d.level())||(k=this.insertVisibleSlices(d,l+n),m=this.getSliceRangeKeys(n+1,l+n+1+k),j=j.concat(this.buildSliceAddedArgs(l+n+1,m,m.map(function(a){return c.options.getNodeKey(a)}))))):p?o+=this.insertVisibleSubtreeSlices(a,l+n+k+o):n+=this.insertVisibleSubtreeSlices(a,l+n)}if(o>0){var r=l+n+k;m=this.getSliceRangeKeys(r,o),j=j.concat(this.buildSliceAddedArgs(r,m,m.map(function(a){return c.options.getNodeKey(a)})))}}this.raiseEvent(j)}},c.prototype.getState=function(){var d=a.prototype.getState.call(this),e={level:this.currentZoomLevel.key(),pivotState:d};return b.PersistableStateHelper.serialize(c.serializationTag,c.serializationVersion,e)},c.prototype.setState=function(d){var e=b.PersistableStateHelper.load(c.serializationTag,c.serializationVersion,d);if(e){a.prototype.setState.call(this,e.pivotState);var f=this.options.getTreeNode(e.level);f&&(this.currentZoomLevel=f)}},c.serializationTag="__SingleLevelExpansionPivotAxisView",c.serializationVersion=1,c}(q);b.SingleLevelExpansionPivotAxisView=t;var u;!function(a){a[a.Collapsed=0]="Collapsed",a[a.Expanded=1]="Expanded"}(u=b.PivotAxisDefaultNodeStatus||(b.PivotAxisDefaultNodeStatus={}));var v=function(){function a(a,d,e,f){this.data=a;var g=c();this._logId=f?f+"_"+g:g,d.mode===r.SingleLevelExpansion?this.rows=new t(d,this._logId+b.LogKeys.PivotAxisDef._Row_):this.rows=new q(d,this._logId+b.LogKeys.PivotAxisDef._Row_),e.mode===r.SingleLevelExpansion?this.columns=new t(e,this._logId+b.LogKeys.PivotAxisDef._Column_):this.columns=new q(e,this._logId+b.LogKeys.PivotAxisDef._Column_)}return a.prototype.getDataSet=function(){return this.data},a.prototype.getRowAxis=function(){return this.rows},a.prototype.getColumnAxis=function(){return this.columns},a.prototype.getAs=function(a){return this instanceof a?this:null},a.prototype.dispose=function(){},a.prototype.getLogId=function(){return this._logId},a}();b.PivotDataModelView=v;var w=["@","&","\\",'"',"'","."],x=["@","a","b","d","s","p"];b.escapeKey=h,b.unescapeKey=i}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(){this.data={}}return b.prototype.getValue=function(a,b){var c=this.data[a];if("undefined"!=typeof c)return c[b]},b.prototype.getRow=function(b){return a.clone(this.data[b])},b.prototype.getRowKeys=function(){return Object.keys(this.data)},b.prototype.setValue=function(a,b,c){var d=this.data[a];d||(d={},this.data[a]=d),d[b]=c},b.prototype.setRowValues=function(a,b){var c=this.data[a];if(c||(c={},this.data[a]=c),Array.isArray(b))for(var d=0;d<b.length;d++){var e=b[d].columnKey;c[e]=b[d].value}else{var f=Object.getOwnPropertyNames(b);f.forEach(function(a){c[a]=b[a]})}},b.prototype.setColumnValues=function(a,b,c){var d=this;if(Array.isArray(b))for(var e=0;e<b.length;e++){var f=b[e].rowKey,g=this.data[f];g||(g={},this.data[f]=g),g[a]=b[e].value}else{var h=Object.getOwnPropertyNames(b);h.forEach(function(c){var e=d.data[c];e||(e={},d.data[c]=e),e[a]=b[c]})}},b.prototype.clear=function(){this.data={}},b.prototype.deleteCell=function(a,b){var c=this.data[a];c&&(delete c[b],0===Object.keys(c).length&&delete this.data[a])},b.prototype.deleteRow=function(a){delete this.data[a]},b}();b.CellDictionary=c;var d=function(){function d(){this.data=new c,this._updated=new a.Event,this._rangeUpdated=new a.Event,this._logId=b.getInstanceId()}return d.prototype.getLogTypeName=function(){return"ManualDataSet"},d.prototype.getLogId=function(){return this._logId},d.prototype.dispose=function(){this.data.clear()},Object.defineProperty(d.prototype,"updated",{get:function(){return this._updated},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"rangeUpdated",{get:function(){return this._rangeUpdated},enumerable:!0,configurable:!0}),d.prototype.getValue=function(a,b){return this.data.getValue(a,b)},d.prototype.setValue=function(a,b,c,d){this.data.setValue(a,b,c),this._updated.raise(this,{rowKey:a,columnKey:b,value:c}),this._rangeUpdated.raise(this,{columnKeys:[b],rowKeys:[a],noFlash:d})},d.prototype.deleteValue=function(a,b){this.data.deleteCell(a,b),this._updated.raise(this,{rowKey:a,columnKey:b,value:void 0})},d.prototype.setRowValues=function(a,b,c){var d=this;this.data.setRowValues(a,b);var e,f;if(Array.isArray(b)){f=[];for(var g=0;g<b.length;g++){var h=b[g].columnKey;f.push(h),e=b[g].value,this._updated.raise(this,{rowKey:a,columnKey:h,value:e})}}else f=Object.getOwnPropertyNames(b),f.forEach(function(c){e=b[c],d._updated.raise(d,{rowKey:a,columnKey:c,value:e})});this._rangeUpdated.raise(this,{columnKeys:f,rowKeys:[a],noFlash:c})},d.prototype.setColumnValues=function(a,b,c){var d=this;this.data.setColumnValues(a,b);var e,f;if(Array.isArray(b)){e=[];for(var g=0;g<b.length;g++){var h=b[g].rowKey;e.push(h),f=b[g].value,this._updated.raise(this,{rowKey:h,columnKey:a,value:f})}}else e=Object.getOwnPropertyNames(b),e.forEach(function(c){f=b[c],d._updated.raise(d,{rowKey:c,columnKey:a,value:f})});this._rangeUpdated.raise(this,{columnKeys:[a],rowKeys:e,noFlash:c})},d.prototype._deleteRows=function(a,b){var c=this;a.forEach(function(a){return c.data.deleteRow(a)}),b&&this._rangeUpdated.raise(this,{columnKeys:[],rowKeys:a})},d.prototype.deleteRow=function(a){this._deleteRows([a],!0)},d.prototype.deleteRows=function(a){this._deleteRows(a,!0)},d.prototype.getScatteredRowKeys=function(){return this.data.getRowKeys()},d.prototype.clear=function(){this.data.clear(),this._rangeUpdated.raise(this,{isReset:!0})},d.prototype.__getRow=function(a,b){return this.data.getRow(a)},d.prototype.getAs=function(a){return this instanceof a?this:null},d}();b.ManualDataSet=d;var e=function(){function a(a,c,e,f){this.dataSet=e||new d,this.dsToDispose=!e,this.rows=a,this.columns=c;var g=b.getInstanceId();this._logId=f?f+"_"+g:g}return a.prototype.getLogTypeName=function(){return"ManualDataModel"},a.createDataModelItemLogIdDump=function(a){var b="function"==typeof a.getLogTypeName?a.getLogTypeName():a.constructor.name,c="function"==typeof a.getLogId?a.getLogId():"unknown",d="["+b+":"+c+"]";return d},a.createDatamodelLogIdDump=function(b){var c=a.createDataModelItemLogIdDump(b),d=a.createDataModelItemLogIdDump(b.getRowAxis()),e=a.createDataModelItemLogIdDump(b.getColumnAxis()),f=a.createDataModelItemLogIdDump(b.getDataSet()),g="["+[c,d,e,f].join(",")+"]";return g},a.prototype.dumpLogId=function(){var b=a.createDatamodelLogIdDump(this);return b},a.prototype.getDataSet=function(){return this.dataSet},a.prototype.getRowAxis=function(){return this.rows},a.prototype.getColumnAxis=function(){return this.columns},a.prototype.getAs=function(a){return this instanceof a?this:null},a.prototype.dispose=function(){this.dsToDispose&&this.dataSet.dispose()},a.prototype.getState=function(){var a=new b.DataModelState(this.columns.getState(),this.rows.getState());return a.serialize()},a.prototype.setState=function(a){var c=b.DataModelState.load(a);c&&(c.columnState&&this.columns.setState(c.columnState),c.rowState&&this.rows.setState(c.rowState))},a.prototype.getLogId=function(){return this._logId},a}();b.ManualDataModel=e}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(c){function d(d,e){var f=this,g=new b.TreeNode("<ROOT>");return f=c.call(this,{root:g,visibleLevelSummaries:[!1],mode:b.AxisViewMode.Normal,enableRequiredSlicesSupport:!!e,neverShowSummaries:!0},d)||this,f.stopWatchService=a.getService("ionweb.stopWatchService"),f}return __extends(d,c),d.prototype.getLogTag=function(){return b.LogKeys.FlatAxisDef.FlatAxis},d.prototype.append=function(a,c,d,e,f,g){this.options.append(this.options.getVisibleRoot(),new b.TreeNode(a,c,d,e,f,g))},d.prototype.appendBlock=function(a,c){var d=this.stopWatchService.start("[FlatAxis] - appendBlock"),e=a.map(function(a,d){return"string"==typeof a?new b.TreeNode(a,c?c[d]:void 0):a});this.options.appendBlock(this.options.getVisibleRoot(),e),d.stop()},d.prototype.insert=function(a,c,d,e,f,g,h){this.options.insert(this.options.getVisibleRoot(),new b.TreeNode(a,d,e,f,g,h),c)},d.prototype.cvtToNode=function(a){return a.map(function(a){return"string"==typeof a?new b.TreeNode(a):a})},d.prototype.insertBlock=function(a,b){this.options.insertBlock(this.options.getVisibleRoot(),this.cvtToNode(a),b)},d.prototype.remove=function(a){this.options.remove(this.options.getVisibleRoot(),a)},d.prototype.removeBlock=function(a,b){this.options.removeBlock(this.options.getVisibleRoot(),a,b)},d.prototype.resetAxis=function(a){this.options.resetNode(this.options.getVisibleRoot(),this.cvtToNode(a))},d.prototype.clear=function(){this.options.clear(this.options.getVisibleRoot())},d.prototype.suspend=function(){this.options.suspend()},d.prototype.resume=function(){this.options.resume()},d.prototype.setNodeState=function(a,d){a===this.options.getVisibleRoot()&&d===b.ExpandState.Expanded&&c.prototype.setNodeState.call(this,a,d)},d.TREE_NODE_ROOT_KEY="<ROOT>",d}(b.PivotAxis);b.FlatAxis=c}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(a,b,c){this._logger=a,this._logId=b,this._updateCounter=0,this._sourceName=c,this.resetStatsCounters()}return b.prototype.resetStatsCounters=function(){this._addedCount=0,this._removedCount=0,this._movedCount=0},b.prototype.begin=function(){this._updateCounter++,1===this._updateCounter&&this.resetStatsCounters()},b.prototype.add=function(b,c){var d=this,e=function(){var e={Action:"ItemAdd"};if(d.isUpdating()&&(e.BeginEnd="True"),c){var f=c();e=a.extend({},[e,f])}return{key:b,params:e}};this.isUpdating()?(this._addedCount++,this._logger.ifMedium(e)):this._logger.ifLow(e)},b.prototype.remove=function(b,c){var d=this,e=function(){var e={Action:"ItemRemove"};if(d.isUpdating()&&(e.BeginEnd="True"),c){var f=c();e=a.extend({},[e,f])}return{key:b,params:e}};this.isUpdating()?(this._removedCount++,this._logger.ifMedium(e)):this._logger.ifLow(e)},b.prototype.move=function(b,c){var d=this,e=function(){var e={id:d._logId,Action:"ItemMove"};if(c){var f=c();e=a.extend({},[e,f])}return{key:b,params:e}};this.isUpdating()?this._logger.ifMedium(e):this._logger.ifLow(e),this.isUpdating()&&this._movedCount++},b.prototype.end=function(){this._updateCounter>0&&this._updateCounter--,0===this._updateCounter&&this.traceStats()},b.prototype.isUpdating=function(){return this._updateCounter>0},b.prototype.traceStats=function(){var a=this;if(this._addedCount||this._removedCount||this._movedCount){var b=function(){return{key:a._sourceName,params:{Id:a._logId,Added:a._addedCount,Removed:a._removedCount,Moved:a._movedCount}}};this.isUpdating()?this._logger.ifMedium(b):this._logger.ifLow(b)}},b}();b.CollectionEventsLogger=c}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){function c(b,c){return b instanceof Date&&c instanceof Date?b.getTime()===c.getTime():b instanceof a.IsoTimeStamp&&c instanceof a.IsoTimeStamp?b.getIsoString()===c.getIsoString():b===c}b.areFieldEqual=c;var d=function(){function a(a,b,c,d){this.convertDataCallback=d,this._busId=a,this._key=c,this.initPayload(b)}return a.prototype.initPayload=function(a){var b=this;this._payload={},Object.keys(a).forEach(function(c){var d=a[c],e=b.convertData(c,d);b._payload[c]=e})},a.prototype.convertData=function(a,b){var c=b;if(this.convertDataCallback){var d=this.convertDataCallback(this._key,a,b);d&&(c=d.value)}return c},a.prototype.key=function(){return this._key},a.prototype.getValue=function(a){return this._payload[a]},a.prototype.processSupply=function(a,b){var d=0,e=[];for(var f in a)if(a.hasOwnProperty(f)&&b.contains(f)){var g=this.convertData(f,a[f]);c(this._payload[f],g)?d++:(this._payload[f]=g,e.push({fieldKey:f,value:g}))}return{discardCount:d,fields:e}},a.prototype.getSupply=function(){return this._payload},a}(),e=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.IsoTimeStamp);b.IsoTimeStamp=e;var f=function(){function c(c,d,e,f,g,h,i){this.logger=c,this.stats=d,this.convertDataCallback=i,this._recordsByKey={},this._recordsByBusId={},this._updated=new a.Event,this._rangeUpdated=new a.Event,this._supportDuplicateAdd=!1,this._logId=b.getInstanceId(),this._rows=e,this._fields=f,this._rowKeyId=g,this._recordFilter=h}return c.prototype.getLogTypeName=function(){return"RecordDataSet"},c.prototype.dispose=function(){this._recordsByKey={},this._recordsByBusId={}},c.prototype.enableDuplicateAdd=function(){this._supportDuplicateAdd=!0},c.prototype.getValue=function(a,b){var c=this._recordsByKey[a];return c?c.getValue(b):null},Object.defineProperty(c.prototype,"updated",{get:function(){return this._updated},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rangeUpdated",{get:function(){return this._rangeUpdated},enumerable:!0,configurable:!0}),c.prototype.onAdd=function(a,c){var e=this,f=a,g={itemId:a,Id:this._logId};if(this._rowKeyId){if(f=c[this._rowKeyId],"string"!=typeof f)throw new Error(b.Strings.Err_commDm_Using_rowKeyIdAndField_Should_String);if(f.length<1)throw new Error(b.Strings.Err_commDm_Using_rowKeyIdAndField_Should_CompletelyPublished);g.foundKey=f}if(this._supportDuplicateAdd&&this._rows.contains(f))return this.onSupply(a,c),this.logger.high("onAdd_duplicate",g),null;if(this._recordFilter&&this._recordFilter.indexOf(f)<0)return this.logger.high("onAdd_filtered",g),null;this.stats.reportAddRows(1);var h=new d(a,c,f,this.convertDataCallback);this._recordsByBusId[a]=h,this._recordsByKey[f]=h;var i=Object.getOwnPropertyNames(c);return g.fieldN=i.length,i.forEach(function(a){e._updated.raise(e,{rowKey:f,columnKey:a,value:c[a]})}),this._rangeUpdated.raise(this,{rowKeys:[f],columnKeys:i}),this.logger.high("onAdd",g),f},c.prototype.onRemove=function(a){var b={itemId:a,Id:this._logId},c=this._recordsByBusId[a];if(!c)return this.logger.high("onRemove_filtered",b),null;this.stats.reportRemoveRows(1);var d=c.key();return b.key=d,delete this._recordsByBusId[a],delete this._recordsByKey[d],this.logger.high("onRemove",b),d},c.prototype.onSupply=function(a,b){var c=this,d={itemId:a,Id:this._logId},e=this._recordsByBusId[a];if(!e)return void this.logger.high("onSupply_filtered",d);var f=e.processSupply(b,this._fields),g=f.fields;this.stats.reportCellUpdate(g.length),this.stats.reportCellDiscarded(f.discardCount),d.fieldsN=g.length,g&&g.length>0&&(g.forEach(function(a){c._updated.raise(c,{rowKey:e.key(),columnKey:a.fieldKey,value:a.value})}),this._rangeUpdated.raise(this,{rowKeys:[e.key()],columnKeys:g.map(function(a){return a.fieldKey})})),this.logger.high("onSupply",d)},c.prototype.clear=function(){var a={Id:this._logId};this.logger.low("clear",a),this._rows.clear(),this._recordsByKey={},this._recordsByBusId={}},c.prototype.__getRow=function(a,b){var c=this._recordsByKey[a];return c?c.getSupply():{}},c.prototype.getAs=function(a){return this instanceof a?this:null},c.prototype.getLogId=function(){return this._logId},c}(),g=function(c){function d(b,d,e){var f=c.call(this,b,d)||this;return f.availableColumnsCallback=e,f.applicationRequiredFields=[],f.currentRequiredFields=[],f._requiredSlicesChanged=new a.Event,f.options.getAvailableSlices=f.availableColumnsCallback||function(){
return[]},f}return __extends(d,c),d.prototype.getRequiredSlices=function(){return this.currentRequiredFields},Object.defineProperty(d.prototype,"requiredSlicesChanged",{get:function(){return this._requiredSlicesChanged},enumerable:!0,configurable:!0}),d.prototype.setApplicationRequiredFields=function(a){this.applicationRequiredFields=a},d.prototype.getAxisRequiredSlices=function(a){this.applicationRequiredFields.forEach(function(b){a[b]=!0})},d.prototype.processCollectedRequiredSlices=function(a){this.currentRequiredFields=b.keySetToArray(a);var c={slices:a};this.raiseCollectedRequiredSlicesEvent(c)},d.prototype.raiseCollectedRequiredSlicesEvent=function(a){this._requiredSlicesChanged.raise(this,a)},d}(b.FlatAxis);b.CommLayerColumnAxis=g;var h=function(){function c(c,d,e,f){this.loggerFactory=d,this.requiredSlicesChangedEventUnsubscriber=null,this._isDisposed=!1,this._availableFieldDescs={},this._isAvailable=Q.defer(),this.pshFieldTypes={},this._comm=c;var g=b.getInstanceId();this._logId=f?f+"_"+g:g,this._logger=d.create(e||b.LogKeys.DataModel.RecordDataModel,"comm"),this._updatingSubscriptionEvent=new a.Event,this._statsProvider=new a.CommLayerDataModelStatsProvider(this._logId)}return c.prototype.getLogTypeName=function(){return"CommLayerDataModel"},Object.defineProperty(c.prototype,"statsProvider",{get:function(){return this._statsProvider},enumerable:!0,configurable:!0}),c.prototype.dumpLogId=function(){var a=b.ManualDataModel.createDatamodelLogIdDump(this);return a},Object.defineProperty(c.prototype,"isAvailable",{get:function(){return this._isAvailable.promise},enumerable:!0,configurable:!0}),c.prototype.getConvertDataCallback=function(){return this.convertDataCallback},c.prototype._initDm=function(a,c){var d=this;this._availableFieldDescs={},a.availableFields&&a.availableFields.forEach(function(a){d._availableFieldDescs[a.id]=a});var e=function(){var a=Object.keys(d._availableFieldDescs).map(function(a){var b=d._availableFieldDescs[a]||{},c={nodeKey:a,displayName:function(){return d._availableFieldDescs[a].name||a},description:b.description,tooltip:b.tooltip,category:b.category};return c});return a};this._columns=new g(null,a.enableIncrementalSubscription,e);var f=[];if(a.fields&&a.fields.length>0&&a.fields.forEach(function(a){"string"==typeof a&&(a={id:a,name:null}),d._availableFieldDescs[a.id]=a,f.push(a)}),!a.enableIncrementalSubscription&&a.rowKeyId&&f.length>0&&f.map(function(a){return a.id}).indexOf(a.rowKeyId)<0)throw new Error(b.Strings.Err_If_RowKeyId_IsSpecified_ShouldBe_Included_ListFields_Subscribe);if(this.subscriptionOptions={id:null,type:c},a.enableIncrementalSubscription){var h=[];a.rowKeyId&&h.push(a.rowKeyId),f.filter(function(a){return h.indexOf(a.id)<0}).forEach(function(a){h.push(a.id)}),this._columns.setApplicationRequiredFields(h)}else{var i=f.length>0?f.map(function(a){return a.id}):[];this.settingFieldsToSubscribe(i)}this.convertDataCallback=function(b,c,e){if(a.convertDataCallback){var f=a.convertDataCallback(b,c,e);if(f)return f}var g=d.predefinedConvertData(c,e);return{value:g}};var j=0===f.length||a.enableIncrementalSubscription;j||f.filter(function(b){return b.id!==a.rowKeyId}).forEach(function(a){d._columns.contains(a.id)||d._columns.append(a.id,a.name)}),this.subscriptionOptions.metadata=function(a){var b=[],c=[];a.forEach(function(a){if(d.pshFieldTypes[a.id]=a.type,j&&!d._columns.contains(a.id)){var e=d._availableFieldDescs[a.id],f=e?e.name:void 0;b.push(f),c.push(a.id)}d._isAvailable.promise.isFulfilled()||d._isAvailable.resolve(null)}),c.length>0&&d._columns.appendBlock(c,b)}},c.prototype.getColumnAxis=function(){return this._columns},c.prototype.getRowAxis=function(){return null},c.prototype.getDataSet=function(){return null},c.prototype.getAs=function(a){return this instanceof a?this:null},c.prototype.dispose=function(){this.requiredSlicesChangedEventUnsubscriber&&(this.requiredSlicesChangedEventUnsubscriber(),this.requiredSlicesChangedEventUnsubscriber=null),this._subscription&&(this._subscription.unsubscribe(),this._subscription=null),this._isDisposed=!0},c.prototype.getLogId=function(){return this._logId},Object.defineProperty(c.prototype,"logId",{get:function(){return this._logId},enumerable:!0,configurable:!0}),c.prototype.predefinedConvertData=function(b,c){var d=this.pshFieldTypes[b];if(("DATE"===d||"TIME"===d||"INT"===d)&&"number"==typeof c){var e=-2147483648;if(c===e)return null}if("REAL"===d){var f=c;if("string"==typeof c){try{f=parseFloat(c)}catch(a){return null}if(f!==f)return null}return f}if("DATE"===d&&"number"==typeof c){var g=c;if(g>0){var h=a.pshDateToJsDate(g);return h}return c}if("TIME"===d&&"number"==typeof c){var i=c;if(i>=0){var j=a.pshTimeToJsDate(i);return j}return c}return c},Object.defineProperty(c.prototype,"updatingSubscription",{get:function(){return this._updatingSubscriptionEvent},enumerable:!0,configurable:!0}),c.prototype.processRequiredSlicesChanged=function(a){if(this._subscription){var b=this._columns.getRequiredSlices(),c={keys:b.slice(0),cancel:!1};this._updatingSubscriptionEvent.raise(this,c),c.cancel||this._subscription.updateFields(b)}else this.performStartSubscription()},c.prototype.settingFieldsToSubscribe=function(a){this.subscriptionOptions.fields=a},c.prototype.performStartSubscription=function(){if(this._columns.getConfig().enableRequiredSlicesSupport){var a=this._columns.getRequiredSlices();this.settingFieldsToSubscribe(a)}this._logger.low("Subscribe",{id:this.getLogId(),publicationId:this.subscriptionOptions.id}),this._subscription=this._comm.subscribe(this.subscriptionOptions)},c.prototype._unsubscribe=function(){this.requiredSlicesChangedEventUnsubscriber&&(this.requiredSlicesChangedEventUnsubscriber(),this.requiredSlicesChangedEventUnsubscriber=null),this._subscription&&(this._logger.low("Unsubscribe",{id:this.getLogId()}),this._subscription.unsubscribe(),this._subscription=null,this.clearDm()),this._isAvailable=Q.defer()},c.prototype._subscribe=function(a){var b=this;if(this._unsubscribe(),this.subscriptionOptions.id=a,this._columns.getConfig().enableRequiredSlicesSupport){this.requiredSlicesChangedEventUnsubscriber=this._columns.requiredSlicesChanged.add(function(a,c){b.processRequiredSlicesChanged(c)});var c=this._columns.getRequiredSlices(),d=c.length>0;d&&this.performStartSubscription()}else this.performStartSubscription()},c.prototype.clearDm=function(){},c.prototype.setFieldDesc=function(a,b){this.setFieldDescs([a],[b])},c.prototype.setFieldDescs=function(a,b){var c=this,d=[];a.forEach(function(a,e){c._availableFieldDescs[a]=b[e],d.push({nodeKey:a,displayName:b[e]?b[e].name:void 0,description:b[e]?b[e].description:void 0,tooltip:b[e]?b[e].tooltip:void 0,category:b[e]?b[e].category:void 0})}),this._columns.options.setDisplayName(d)},c.prototype.setFieldName=function(a,b){this.setFieldNames([a],[b])},c.prototype.setFieldNames=function(a,b){var c=this,d=[];a.forEach(function(a,e){c._availableFieldDescs[a]=c._availableFieldDescs[a]||{id:a},c._availableFieldDescs[a].name=b[e],d.push({nodeKey:a,displayName:b[e]})}),this._columns.options.setDisplayName(d)},c}();b.CommLayerDataModel=h;var i=function(a){function c(c,d,e,f){var g=a.call(this,c,d,e,f)||this;return g.isSuspended=!1,g.addQueue=[],g.removeQueue=[],g._collectionEventLogger=new b.CollectionEventsLogger(g._logger,g.logId,"comm"),g}return __extends(c,a),c.prototype.getLogTypeName=function(){return"RecordDataModel"},c.prototype.enableDuplicateAdd=function(){this._dataSet.enableDuplicateAdd()},c.prototype._initDm=function(c,d){var e=this;a.prototype._initDm.call(this,c,d),this._rows=new b.FlatAxis(this.getLogId()+b.LogKeys.PivotAxisDef._Row_),this._dataSet=new f(this.loggerFactory.create(this._logger.tag+"_DS","comm"),this.statsProvider,this.getRowAxis(),this.getColumnAxis(),c.rowKeyId,c._recordFilter,this.getConvertDataCallback()),this._preventDmClearOnNotAvailable=c.preventClearOnNotAvailable,this.subscriptionOptions.add=function(a,b){e._collectionEventLogger.add(a);var c=e._dataSet.onAdd(a,b);c&&(e.isSuspended?e.addQueue.push(c):e._rows.append(c))},this.subscriptionOptions.remove=function(a){e._collectionEventLogger.remove(a);var b=e._dataSet.onRemove(a);b&&(e.isSuspended?e.removeQueue.push(b):e._rows.remove(b))},this.subscriptionOptions.supply=function(a,c){var d=function(){return{key:b.LogKeys.DataModel.Supply,params:{Id:e.logId}}};e._logger.ifHigh(d),e._dataSet.onSupply(a,c)},this.subscriptionOptions.begin=function(){e._collectionEventLogger.begin(),e.isSuspended=!0},this.subscriptionOptions.end=function(){e._collectionEventLogger.end(),e.flushSuspension(),e.isSuspended=!1},this.subscriptionOptions.kill=function(){var a=function(){return{key:b.LogKeys.DataModel.Kill,params:{Id:e.logId}}};e._logger.ifHigh(a),e._rows.clear()},this.subscriptionOptions.notAvailable=function(){var a=function(){return{key:b.LogKeys.DataModel.NotAvailable,params:{Id:e.logId}}};e._logger.ifHigh(a),e._preventDmClearOnNotAvailable||e.clearDm()}},c.prototype.flushSuspension=function(){var a=this.getRowAxis();this.removeQueue.forEach(function(b){return a.remove(b)}),this.removeQueue=[],a.appendBlock(this.addQueue),this.addQueue=[]},c.prototype.clearDm=function(){if(this.isSuspended&&(this._collectionEventLogger.end(),this.isSuspended=!1,this.removeQueue=[],this.addQueue=[]),this._dataSet.clear(),this._rows.clear(),0===this.subscriptionOptions.fields.length){var b=this.getColumnAxis();b.clear()}a.prototype.clearDm.call(this)},c.prototype.getDataSet=function(){return this._dataSet},c.prototype.getRowAxis=function(){return this._rows},c}(h);b.RecordDataModel=i;var j=function(c){function d(d,e,f,g,h){var i=c.call(this,f,g,b.LogKeys.DataModel.ChainDataModel,h)||this;return i._initDm(e,a.SubscriptionType.ChainRecord),d&&i._subscribe(d),i}return __extends(d,c),d.prototype.getLogTypeName=function(){return"ChainDataModel"},d.prototype.subscribe=function(a){this._isDisposed||this._subscribe(a)},d.prototype.unsubscribe=function(){this._isDisposed||this._unsubscribe()},d}(i);b.ChainDataModel=j;var k=function(c){function d(d,e,f,g){var h=c.call(this,e,f,b.LogKeys.DataModel.QueueDataModel,g)||this;return h._initDm(d,a.SubscriptionType.Queue),h.onClose=new a.Event,h.onUserMsg=new a.Event,h.subscriptionOptions.close=function(){var a=function(){return{key:"Close",params:{Id:h.logId}}};h._logger.ifHigh(a),h.onClose.raise(h,null)},h.subscriptionOptions.user=function(a,b){h.onUserMsg.raise(h,{id:a,fields:b})},h.enableDuplicateAdd(),h}return __extends(d,c),d.prototype.getLogTypeName=function(){return"QueueDataModel"},d.prototype.subscribe=function(a){this._isDisposed||this._subscribe(a)},d.prototype.unsubscribe=function(){this._isDisposed||this._unsubscribe()},d}(i);b.QueueDataModel=k;var l=function(){function a(a,b){this.loggerFactory=a,this.comm=b}return a.prototype.createChainDataModel=function(a,b,c){return new j(a,b,this.comm,this.loggerFactory,c)},a.prototype.createChainDataModelNotSubscribed=function(a,b){return new j(null,a,this.comm,this.loggerFactory,b)},a.prototype.createQueueDataModel=function(c){for(var d=this,e=[],f=1;f<arguments.length;f++)e[f-1]=arguments[f];var g,h,i;return"string"==typeof c?(i={name:c,namedArgs:e[0]},g=e[1],h=e[2]):(i=c,g=e[0],h=e[1]),this.comm.invoke(i).then(function(b){var c=a.parseQueueName(b),e=new k(g,d.comm,d.loggerFactory,h);return e.subscribe(c),e},function(a){throw new Error(b.Strings.Err_Function_CallFailed_WithCode+a.code+" ("+a.message+")")})},a.prototype.createQueueDataModelById=function(a,b,c){var d=new k(b,this.comm,this.loggerFactory,c);return d.subscribe(a),d},a.prototype.createQueueDataModelNotSubscribed=function(a,b){return new k(a,this.comm,this.loggerFactory,b)},a.parseQueueName=function(c){if("0:OK"!==c.values.functionResult)throw new Error(c.values.functionResult);if(c.values.queueName===a.queueFieldName)return c.varValues[0];if(c.varValues[0]===a.queueFieldName)return c.varValues[1];var d=c.varValues.indexOf(a.queueFieldName);if(-1!==d&&c.varValues.length>d)return c.varValues[d+1];throw new Error(b.Strings.Err_Function_Does_Not_Provide_QueueName)},a.queueFieldName="QueueName",a}();b.CommDmFactory=l}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(c){var d=this;this.unsub=[],this.nodeStateUpdated=new a.Event,this.enableLeavesCounter=!1,this._logId=b.getInstanceId(),this.options={},this.sourcePivotAxis=c,this._collectingRequiredSlicesEvent=new a.Event;for(var e in c.options)this.options[e]=c.options[e];this.options.collectingRequiredSlices=this._collectingRequiredSlicesEvent,this.unsub.push(this.sourcePivotAxis.options.collectingRequiredSlices.add(function(a,b){d.getAxisRequiredSlices(b.slices),d.raiseCollectingRequiredSlicesEvent(b),d.getAxisRequiredSlices(b.slices)})),this.unsub.push(this.sourcePivotAxis.nodeStateUpdated.add(function(a,b){return d.onNodeStateUpdated(b)}))}return c.prototype.getLogTypeName=function(){return"PivotAxisAdapter"},c.prototype.getAxisRequiredSlices=function(a){},c.prototype.raiseCollectingRequiredSlicesEvent=function(a){this._collectingRequiredSlicesEvent.raise(this,a)},c.prototype.onNodeStateUpdated=function(a){this.nodeStateUpdated.raise(this,a)},c.prototype.dispose=function(){this.unsub.forEach(function(a){return a()})},c.prototype.length=function(){return this.sourcePivotAxis.length()},c.prototype.getSlice=function(a){return this.sourcePivotAxis.getSlice(a)},c.prototype.contains=function(a){return this.sourcePivotAxis.contains(a)},c.prototype.getKey=function(a){return this.sourcePivotAxis.getKey(a)},c.prototype.getSliceRange=function(a,b){return this.sourcePivotAxis.getSliceRange(a,b)},c.prototype.getCategories=function(){return this.sourcePivotAxis.getCategories()},c.prototype.getState=function(){return this.sourcePivotAxis.getState()},c.prototype.setState=function(a){this.sourcePivotAxis.setState(a)},c.prototype.getAs=function(a){return this instanceof a?this:this.sourcePivotAxis.getAs(a)},c.prototype.hasVisibleSlices=function(a){return this.sourcePivotAxis.hasVisibleSlices(a)},c.prototype.lastSliceIndex=function(a){return this.sourcePivotAxis.lastSliceIndex(a)},c.prototype.getFirstSlice=function(a){return this.sourcePivotAxis.getFirstSlice(a)},c.prototype.getNodeAndMeasureKey=function(a){return this.sourcePivotAxis.getNodeAndMeasureKey(a)},c.prototype.hideMeasure=function(a,b){return this.sourcePivotAxis.hideMeasure(a,b)},c.prototype.getSlicesOfMeasure=function(a){return this.sourcePivotAxis.getSlicesOfMeasure(a)},c.prototype.getLogId=function(){return this._logId},c}();b.PivotAxisAdapter=c;var d=function(a){function b(b,c){var d=a.call(this,b)||this;return d.retrieveRequiredSlicesCallback=c,d}return __extends(b,a),b.prototype.getAxisRequiredSlices=function(a){return this.retrieveRequiredSlicesCallback(a)},b}(c);b.PivotAxisRequiredSlicesAdapter=d;var e=function(){function c(c,d){var e=this;this.sourceSet=c,this.stopEvents=d,this._updated=new a.Event,this._rangeUpdated=new a.Event,this.unsub=[],this._logId=b.getInstanceId(),d||(this.unsub=[c.updated.add(function(a,b){return e.raiseUpdated(b)}),c.rangeUpdated.add(function(a,b){e.raiseRangeUpdated(b)})])}return c.prototype.getLogTypeName=function(){return"DataSetAdapter"},c.prototype.dispose=function(){this.unsub.forEach(function(a){return a()})},Object.defineProperty(c.prototype,"updated",{get:function(){return this._updated},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rangeUpdated",{get:function(){return this._rangeUpdated},enumerable:!0,configurable:!0}),c.prototype.raiseUpdated=function(a){this._updated.raise(this,a)},c.prototype.raiseRangeUpdated=function(a){this._rangeUpdated.raise(this,a)},c.prototype.getValue=function(a,b){return this.sourceSet.getValue(a,b)},c.prototype.__getRow=function(a,b){return this.sourceSet.__getRow(a,b)},c.prototype.getAs=function(a){return this instanceof a?this:this.sourceSet.getAs(a)},c.prototype.getLogId=function(){return this._logId},c}();b.DataSetAdapter=e;var f=function(){function a(a){this._sourceDm=a,this._logId=b.getInstanceId()}return a.prototype.getLogTypeName=function(){return"DataModelAdapter"},a.prototype.dumpLogId=function(){var a="[unknown]",c=this._sourceDm;"function"==typeof c.dumpLogId&&(a=c.dumpLogId());var d=b.ManualDataModel.createDatamodelLogIdDump(this);return d+";"+a},a.prototype.setDataSet=function(a){this._dataSet=a},a.prototype.getRowAxis=function(){return this._sourceDm.getRowAxis()},a.prototype.getColumnAxis=function(){return this._sourceDm.getColumnAxis()},a.prototype.getDataSet=function(){return this._dataSet||this._sourceDm.getDataSet()},a.prototype.getAs=function(a){return this instanceof a?this:this._sourceDm.getAs(a)},a.prototype.dispose=function(a){this.isDisposed=!0,a!==!1&&this._sourceDm.dispose(a)},a.prototype.getLogId=function(){return this._logId},Object.defineProperty(a.prototype,"source",{get:function(){return this._sourceDm},enumerable:!0,configurable:!0}),a.prototype.getState=function(){var c=void 0;return this._sourceDm.getState&&(c=this._sourceDm.getState()),b.PersistableStateHelper.serialize(a._stateTag,a._stateVersion,{sourceDataModelState:c})},a.prototype.setState=function(c){var d=b.PersistableStateHelper.load(a._stateTag,a._stateVersion,c);d&&d.sourceDataModelState&&this._sourceDm.setState&&this._sourceDm.setState(d.sourceDataModelState)},a._stateTag="__DataModelAdapterState",a._stateVersion=1,a.stateTag="__DataModelAdapterState",a.stateVersion=1,a}();b.DataModelAdapter=f}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){b.GRID_QUICK_SORTING_CHANGE_PREFERENCE_KEY="toggleSorting";var c;!function(a){a[a.Ascending=0]="Ascending",a[a.Descending=1]="Descending"}(c=b.SortDirection||(b.SortDirection={}));var d=function(){function a(a,b){this.comparer=a,this.direction=b}return a.prototype.getDirection=function(){return this.direction},a.prototype.getComparer=function(){return this.comparer},a.prototype.serialize=function(){},a.prototype.getValueForAxis=function(a){},a.serializationTag="__BaseSortCriterion",a.genericHeaderSpecifier="H",a.numericSliceSpecifier="N",a.numericHeaderSpecifier="n",a.absoluteSliceSpecifier="B",a.absoluteHeaderSpecifier="b",a.asciiSliceSpecifier="T",a.asciiHeaderSpecifier="W",a.asciiSliceSpecifierI="t",a.asciiHeaderSpecifierI="w",a.genericSliceSpecifier="G",a.customSliceSpecifier="C",a.customHeaderSpecifier="c",a.ascendingSpecifier="A",a.descendingSpecifier="D",a.serializationVersion=2,a}();b.BaseSortCriterion=d;var e=function(a){function e(b,c,d,e,f,g,h){var i=a.call(this,b,c)||this;return i.serializationSpecifier=d,i.axisType=e,i.dataSet=f,i.sortingKey=g,i.sortType=h,i}return __extends(e,a),e.prototype.serialize=function(){if(this.serializationSpecifier[0]===d.customHeaderSpecifier||this.serializationSpecifier[0]===d.customSliceSpecifier)return null;var a={spec:this.serializationSpecifier+(this.direction===c.Ascending?d.ascendingSpecifier:d.descendingSpecifier),key:this.sortingKey};return b.PersistableStateHelper.serialize(d.serializationTag,d.serializationVersion,a)},e.prototype.getValueForAxis=function(a){return this.axisType===b.AxisType.Row?this.dataSet.getValue(a.key(),this.sortingKey):this.dataSet.getValue(this.sortingKey,a.key())},e.prototype.getKey=function(){return this.sortingKey},e.prototype.getSortType=function(){return this.sortType},e.prototype.getKeyOrLevel=function(){return this.getKey()},e}(d);b.DataSetSortCriterion=e;var f=function(a){function e(b,c,d,e,f){var g=a.call(this,b,c)||this;return g.axis=d,g.level=e,g.specifier=f,g}return __extends(e,a),e.prototype.serialize=function(){var a={spec:this.specifier+(this.direction===c.Ascending?d.ascendingSpecifier:d.descendingSpecifier),level:this.level};return b.PersistableStateHelper.serialize(d.serializationTag,d.serializationVersion,a)},e.prototype.getValueForAxis=function(a){var b=a.value();return"undefined"==typeof b&&(b=a.displayName()),b},e.prototype.getKeyOrLevel=function(){return this.level},e}(d);b.LevelSortCriterion=f;var g=function(){function g(a,b,c){this.axis=a,this.axisType=b,this.dataSet=c}return g.prototype.header=function(b,e){return e===c.Ascending?new f(function(b,c){return a.ValueComparer.anyCompare(b,c)},e,this.axis,b,d.genericHeaderSpecifier):new f(function(b,c){return-a.ValueComparer.anyCompare(b,c)},e,this.axis,b,d.genericHeaderSpecifier)},g.prototype.headerAsciiTextual=function(b,e,g){var h=g?d.asciiHeaderSpecifier:d.asciiHeaderSpecifierI;return e===c.Ascending?new f(function(b,c){return a.ValueComparer.anyCompareAscii(b,c,g)},e,this.axis,b,h):new f(function(b,c){return-a.ValueComparer.anyCompareAscii(b,c,g)},e,this.axis,b,h)},g.prototype.numeric=function(b,f){return f===c.Ascending?new e(function(b,c){return a.ValueComparer.numberCompare(b,c)},f,d.numericSliceSpecifier,this.axisType,this.dataSet,b):new e(function(b,c){return-a.ValueComparer.numberCompare(b,c)},f,d.numericSliceSpecifier,this.axisType,this.dataSet,b)},g.prototype.absolute=function(b,f,g){return f===c.Ascending?new e(function(b,c){return a.ValueComparer.numberCompareAbsolute(b,c)},f,d.absoluteSliceSpecifier,this.axisType,this.dataSet,b,g):new e(function(b,c){return-a.ValueComparer.numberCompareAbsolute(b,c)},f,d.absoluteSliceSpecifier,this.axisType,this.dataSet,b,g)},g.prototype.asciiTextual=function(b,f,g){var h=g?d.asciiSliceSpecifier:d.asciiSliceSpecifierI;return f===c.Ascending?new e(function(b,c){return a.ValueComparer.anyCompareAscii(b,c,g)},f,h,this.axisType,this.dataSet,b):new e(function(b,c){return-a.ValueComparer.anyCompareAscii(b,c,g)},f,h,this.axisType,this.dataSet,b)},g.prototype.generic=function(b,f){return f===c.Ascending?new e(function(b,c){return a.ValueComparer.anyCompare(b,c)},f,d.genericSliceSpecifier,this.axisType,this.dataSet,b):new e(function(b,c){return-a.ValueComparer.anyCompare(b,c)},f,d.genericSliceSpecifier,this.axisType,this.dataSet,b)},g.prototype.custom=function(a,b,c){return new e(c,b,d.customSliceSpecifier,this.axisType,this.dataSet,a)},g.prototype.deserialize=function(a){var e=b.PersistableStateHelper.load(d.serializationTag,d.serializationVersion,a);if(e){var f=e.spec[1]===d.ascendingSpecifier?c.Ascending:e.spec[1]===d.descendingSpecifier?c.Descending:null;if(null==f)return null;switch(e.spec[0]){case d.numericSliceSpecifier:return this.numeric(e.key,f);case d.numericHeaderSpecifier:return this.headerNumeric(e.level,f);case d.absoluteSliceSpecifier:return this.absolute(e.key,f,b.SortType.NumericAbsolute);case d.absoluteHeaderSpecifier:return this.headerAbsolute(e.level,f);case d.asciiSliceSpecifier:return this.asciiTextual(e.key,f,!0);case d.asciiHeaderSpecifier:return this.headerAsciiTextual(e.level,f,!0);case d.asciiSliceSpecifierI:return this.asciiTextual(e.key,f,!1);case d.asciiHeaderSpecifierI:return this.headerAsciiTextual(e.level,f,!1);case d.genericSliceSpecifier:return this.generic(e.key,f);case d.genericHeaderSpecifier:return this.header(e.level,f)}}return null},g.prototype.headerNumeric=function(b,e){return e===c.Ascending?new f(function(b,c){return a.ValueComparer.numberCompare(b,c)},e,this.axis,b,d.numericHeaderSpecifier):new f(function(b,c){return-a.ValueComparer.numberCompare(b,c)},e,this.axis,b,d.numericHeaderSpecifier)},g.prototype.headerAbsolute=function(b,e){return e===c.Ascending?new f(function(b,c){return a.ValueComparer.numberCompareAbsolute(b,c)},e,this.axis,b,d.absoluteHeaderSpecifier):new f(function(b,c){return-a.ValueComparer.numberCompareAbsolute(b,c)},e,this.axis,b,d.absoluteHeaderSpecifier)},g.prototype.headerCustom=function(a,b,c){return new f(c,b,this.axis,a,d.customHeaderSpecifier)},g}();b.SortCriterionFactory=g;var h=function(){function a(a,b,c,d,e){this.node=a,this.id=a.key(),this.offset=b,this.count=c,d&&(this.parentId=d.key()),this.children=e}return a}(),i=function(c){function d(b,d,e,f,h){void 0===f&&(f=!1);var i=c.call(this,b)||this;return i.isOneShotMode=!1,i.hasUserSorting=!0,i.disabledKeys={},i.oneShotSortKeys={},i.options.sortingChangedEvent=new a.Event,i.options.actualSortingChangedEvent=new a.Event,i.axisType=d,i.dataSet=e,i.sortCriteria=[],i.oneShot=f,i._siblingAxis=h,i.init(),i._factory=new g(i,d,e),i}return __extends(d,c),d.prototype.getLogTypeName=function(){return"SortingPivotAxisAdapter"},d.prototype.getAxisRequiredSlices=function(a){},d.prototype.getSortingRequiredKeys=function(){var a=[];return this.sortCriteria.forEach(function(b){if(b instanceof e){var c=b,d=c.getKey();d&&a.indexOf(d)<0&&a.push(d)}}),a},Object.defineProperty(d.prototype,"factory",{get:function(){return this._factory},enumerable:!0,configurable:!0}),d.prototype.onNodeStateUpdated=function(b){var d=this;if(!this.oneShot&&this.hasHeaderSorting()){var e=a.distinct(b.filter(function(a){return a.value||a.displayName}).map(function(a){return a.nodeKey}));e.forEach(function(a){d.handleSingleValueUpdated(a)})}c.prototype.onNodeStateUpdated.call(this,b)},d.prototype.hasHeaderSorting=function(){return!!a.firstOrDefault(this.actualSortCriteria(),function(a){return a instanceof f})},d.prototype.init=function(){var b=this;this.oneShot||this.unsub.push(this.dataSet.rangeUpdated.add(function(a,c){return b.dataSetRangeUpdated(c)})),this.unsub.push(this.sourcePivotAxis.options.slicesEvent.add(function(a,c){return b.handlePivotAxisSliceEvents(c)})),this.options.slicesEvent=new a.Event,this.reset()},d.prototype.reset=function(){this.sliceBlocks={},this.hasSortCriteria()&&this.initSliceBlock(this.sourcePivotAxis.options.getVisibleRoot())},d.prototype.initSliceBlock=function(a){var c=this,d=this.sourcePivotAxis,e={};return d.getSliceRange(0,d.length()).map(function(a){e[a.key()]=!0}),a.visitTree(function(a){var f=a.parent();if(0!==(d.options.getExpandState(a.key())&b.ExpandState.Collapsed))if(f){var g=d.options.getNodeSliceRange(f.key(),f.indexOf(a),1);c.sliceBlocks[a.key()]=new h(a,g.start,g.count,f,[])}else c.sliceBlocks[a.key()]=new h(a,0,1,null,[]);else{var i=c.mergeSort(a.children?a.children():[]),j=0,k=0;d.hasVisibleSlices(a)&&(j=e[a.key()]&&f?d.getSlice(d.options.getSliceKeys(a.key())[0]).index():0,k=d.options.getSliceKeys(a.key()).length),i.forEach(function(a){var b=c.sliceBlocks[a.key()];b.offset=k,k+=b.count}),c.sliceBlocks[a.key()]=new h(a,j,k,f,i)}},b.TreeVisitMode.PostOrder,function(a){return 0!==(c.sourcePivotAxis.options.getExpandState(a.key())&b.ExpandState.Expanded)}),this.sliceBlocks[a.key()]},d.prototype.lastSliceIndex=function(a){if(!this.hasSortCriteria())return this.sourcePivotAxis.lastSliceIndex(a);var b=this.sliceBlocks[a];return b&&this.getFirstSlice(a)+b.count-1},d.prototype.getFirstSlice=function(a){if(!this.hasSortCriteria())return this.sourcePivotAxis.getFirstSlice(a);var b=this.sliceBlocks[a];if(b){for(var c=b.offset;b=this.sliceBlocks[b.parentId];)c+=b.offset;return c}return null},d.prototype.getSortCriteria=function(){return this.sortCriteria},d.prototype.getFallbackSortCriteria=function(){return this.fallbackSortCriteria},d.prototype.setFallbackSortCriteria=function(a){this.fallbackSortCriteria=a,this.onSortCriteriaChanged(),this.raiseActualSortingChangedEvent()},d.prototype.hasSortCriteria=function(){return this.isOneShotMode||this.actualSortCriteria().length>0},d.prototype.raiseSlicesEvent=function(a){this.options.slicesEvent.raise(this,a)},d.prototype.raiseActualSortingChangedEvent=function(){this.options.actualSortingChangedEvent.raise(this,this.actualSortCriteria())},d.prototype.onSortCriteriaChanged=function(){this._siblingAxis&&this._siblingAxis.options.refreshRequiredSlices(),this.reset(),this.raiseSlicesEvent([{type:b.SliceEventType.Reset}])},d.prototype._setSortCriteria=function(a,b){var c=this.options.getMeasures();c&&c.length&&a.forEach(function(a){if(!(a instanceof f))throw"Pivot axis with measures does not support non level sorting type"}),this.sortCriteria=a,this.onSortCriteriaChanged(),b&&(this.sortCriteria=[]),this.isOneShotMode=!!b,this.options.sortingChangedEvent.raise(this,this.getAppliedSortCriteria()),this.raiseActualSortingChangedEvent()},d.prototype.setSortCriteria=function(a){this._setSortCriteria(a,!1)},d.prototype.executeOneShotSorting=function(a){this._setSortCriteria(a,!0)},d.prototype.mergeSort=function(a){var b=this,c=function(a,c){for(var d=[],e=0,f=0;e<a.length&&f<c.length;)b.compareAxisKeys(a[e],c[f])<=0?d.push(a[e++]):d.push(c[f++]);return d.concat(a.slice(e)).concat(c.slice(f))};if(a.length<2)return a.slice();var d=Math.floor(a.length/2),e=a.slice(0,d),f=a.slice(d);return c(this.mergeSort(e),this.mergeSort(f))},d.prototype.getSlice=function(a){if(!this.hasSortCriteria())return this.sourcePivotAxis.getSlice(a);var b=a,c=0,d=this.getNodeAndMeasureKey(a);d&&d.measureKey&&(b=d.nodeKey,c=this.options.getMeasures().map(function(a){return a.key||a}).indexOf(d.measureKey));for(var e=this.sourcePivotAxis,f=this.sliceBlocks[b],g=0;f.parentId;)g+=f.offset,f=this.sliceBlocks[f.parentId];var h=e.getSlice(a);return{key:function(){return a},index:function(){return g+c},displayName:function(){return h.displayName()},alias:h.alias,description:h.description,category:h.category}},d.prototype.getKey=function(a){return this.hasSortCriteria()?this.getKeyRange(a,1)[0]:this.sourcePivotAxis.getKey(a)},d.prototype.getKeyRange=function(a,b){var c=this,d=this.sourcePivotAxis,e=d.options.getVisibleRoot(),f=function(a,b,e){var g=d.options.getSliceKeys(a.id),h=[];d.hasVisibleSlices(a.node)&&(h=g.slice(b,Math.min(g.length,b+e)));for(var i=0;i<a.children.length;i++){var j=c.sliceBlocks[a.children[i].key()],k=e-h.length;j.offset+j.count>=b&&j.offset<=b+e&&(h=h.concat(f(j,Math.max(b-j.offset,0),k)))}return h},g=this.sliceBlocks[e.key()];return f(g,a,b)},d.prototype.getSliceRange=function(a,b){var c=this.sourcePivotAxis;return this.hasSortCriteria()?this.getKeyRange(a,b).map(function(b,d){var e=c.getSlice(b);return{key:function(){return b},index:function(){return a+d},displayName:function(){return e.displayName()},alias:e.alias,description:e.description,category:e.category}}):c.getSliceRange(a,b)},d.prototype.getCategories=function(){return this.sourcePivotAxis.getCategories()},d.prototype.getGroupRange=function(a){for(var b=this.sliceBlocks[a].offset,c=a;c=this.sliceBlocks[c].parentId;)b+=this.sliceBlocks[c].offset;return{start:b,count:this.sliceBlocks[a].count}},d.prototype.filterAppliedCriteria=function(a){var b=this;return(a||[]).filter(function(a){var c=a.getKey,d=c&&c();return!(b._siblingAxis&&d&&!b._siblingAxis.contains(d))})},d.prototype.getAppliedSortCriteria=function(){return this.filterAppliedCriteria(this.sortCriteria)},d.prototype.actualSortCriteria=function(){var a=this.filterAppliedCriteria(this.sortCriteria),b=this.filterAppliedCriteria(this.fallbackSortCriteria);return a.concat(b)},d.prototype.compareAxisKeys=function(a,b){for(var c=null,d=this.actualSortCriteria(),e=0;e<d.length;e++){var g=d[e];if(!(g instanceof f&&g.level>=0&&a.level()!==g.level)){var h=g.getValueForAxis(a),i=g.getValueForAxis(b);if(c=g.getComparer()(h,i),0!==c)return c}}return c},d.prototype.binarySearch=function(a,b,c,d){if(0===d)return{found:!1,index:c};var e=Math.floor(c+(d-1)/2),f=this.compareAxisKeys(a,b[e]);return null===f?null:0===f?{found:!0,index:e}:f<0?this.binarySearch(a,b,c,e-c):this.binarySearch(a,b,e+1,d-(e+1-c))},d.prototype.moveSliceBlock=function(a,c,d){var e,f=this,g=this.sliceBlocks[a],h=this.sliceBlocks[g.children[c].key()],i=this.getGroupRange(a),j=i.start+h.offset,k=this.getKeyRange(j,h.count);if(d>c)if(d===g.children.length-1){var l=this.sliceBlocks[g.children[g.children.length-1].key()];e=i.start+l.offset+l.count-h.count}else e=i.start+this.sliceBlocks[g.children[d-1].key()].offset;else e=i.start+this.sliceBlocks[g.children[d].key()].offset;var m=Math.min(c,d),n=this.sliceBlocks[a].children,o=this.sliceBlocks[n[m].key()].offset;n.splice.apply(n,[d,0].concat(n.splice(c,1)));for(var p=m;p<n.length;p++){var q=this.sliceBlocks[n[p].key()];q.offset=o,o+=q.count}return this.raiseSlicesEvent([{type:b.SliceEventType.SliceMoved,args:{start:j,target:e,keys:k,nodeKeys:k.map(function(a){return f.sourcePivotAxis.options.getNodeKey(a)})}}]),h.count},d.prototype.dataSetRangeUpdated=function(a){
var c=this;if(a.isReset)this.reset();else{var d=this.axisType===b.AxisType.Row?a.rowKeys:a.columnKeys;d.forEach(function(a){return c.handleSingleValueUpdated(a)})}},d.prototype.handleSingleValueUpdated=function(b){var c=this.sliceBlocks[b];if(c&&c.parentId){var d=this.options.getTreeNode(b),e=this.sliceBlocks[c.parentId],f=null,g=a.indexOf(e.children,function(a){return a.key()===b});if(g>0){var h=e.children[g-1];this.compareAxisKeys(h,d)>0&&(f=this.binarySearch(d,e.children,0,g))}if(!f&&g<e.children.length-1){var i=e.children[g+1];this.compareAxisKeys(d,i)>0&&(f=this.binarySearch(d,e.children,g+1,e.children.length-g-1),f.index--)}f&&this.moveSliceBlock(c.parentId,g,f.index)}},d.prototype.eventsNeedReset=function(a){var c=this;if(this.isOneShotMode){for(var d=0;d<a.length;d++)if(a[d].type===b.SliceEventType.Reset)return!0;return!1}if(1===a.length&&a[0].type===b.SliceEventType.SliceRemoved&&0===this.sourcePivotAxis.length())return!0;var e=0;if(a.forEach(function(a){a.args&&a.args.nodeKeys&&(e+=a.args.nodeKeys.length)}),e>10)return!0;for(var f=function(a){c.sortCriteria.some(function(b){var c=b.getKey,d=c&&c();return a.indexOf(d)>=0})},d=0;d<a.length;d++){var g=a[d];if(g.type===b.SliceEventType.Reset||(g.type===b.SliceEventType.SliceAdded||g.type===b.SliceEventType.SliceRemoved)&&f(g.args.keys))return!0}return!1},d.prototype.handlePivotAxisSliceEvents=function(a){var c=this;if(!this.hasSortCriteria())return void this.raiseSlicesEvent(a);var d=[];this.eventsNeedReset(a)?(this.isOneShotMode=!1,this.reset(),d.push({type:b.SliceEventType.Reset})):a.forEach(function(a){switch(a.type){case b.SliceEventType.SliceAdded:c.processAddEvent(a.args).forEach(function(a){return d.push(a)});break;case b.SliceEventType.SliceRemoved:c.processRemoveEvent(a.args).forEach(function(a){return d.push(a)});break;case b.SliceEventType.SliceMoved:}}),this.raiseSlicesEvent(d)},d.prototype.insertOrdered=function(a,b){var c={index:a.children.length};if(this.actualSortCriteria().length>0){var d=this.binarySearch(b,a.children,0,a.children.length);d&&(c=d)}return a.children.splice(c.index,0,b),c.index},d.prototype.createSliceBlock=function(a){var b=this.sourcePivotAxis,c=b.options.getTreeNode(a),d=c.parent().key(),e=new h(c,0,0,c.parent(),[]),f=this.sliceBlocks[d];f||(f=this.createSliceBlock(d));var g=this.insertOrdered(f,e.node);if(g>0){var i=this.sliceBlocks[f.children[g-1].key()];e.offset=i.offset+i.count}else e.offset=b.options.getSliceKeys(c.parent().key()).length;return this.sliceBlocks[a]=e,e},d.prototype.updateSliceCount=function(a,b,c){var d=this,e=0;for(a.count+=b,c&&a.children.map(function(a){return d.sliceBlocks[a.key()]}).forEach(function(a){return a.offset+=b});a.parentId;){e+=a.offset;var f=this.sliceBlocks[a.parentId];f.count+=b;var g=f.children.indexOf(a.node);f.children.slice(g+1).forEach(function(a){return d.sliceBlocks[a.key()].offset+=b}),a=f}return e},d.prototype.groupEvents=function(a){var b={};return a.keys.forEach(function(c,d){var e=a.nodeKeys[d];b[e]||(b[e]=[]),b[e].push(c)}),b},d.prototype.processAddEvent=function(a){var c=this,d=[],e=this.groupEvents(a),f=null;return Object.keys(e).forEach(function(a){var g=c.sliceBlocks[a];g||(g=c.createSliceBlock(a));var h=e[a].length,i=c.updateSliceCount(g,h,!0);f&&f.args.start+f.args.keys.length===i?e[a].forEach(function(b){f.args.keys.push(b),f.args.nodeKeys.push(a)}):(f={type:b.SliceEventType.SliceAdded,args:{start:i,keys:e[a],nodeKeys:e[a].map(function(b){return a})}},d.push(f))}),d},d.prototype.processRemoveEvent=function(a){var c=this,d=[],e=this.groupEvents(a),f=null;return Object.keys(e).forEach(function(g){var h=c.sliceBlocks[g],i=-e[g].length,j=c.updateSliceCount(h,i,!0);for(f&&f.args.start===j?e[g].forEach(function(a){f.args.keys.push(a),f.args.nodeKeys.push(g)}):(f={type:b.SliceEventType.SliceRemoved,args:{start:j,keys:e[g],nodeKeys:e[g].map(function(a){return g})}},d.push(f));h&&0===h.count&&h.id!==a.nonVisibleSummaryRoot;){var k=c.sliceBlocks[h.parentId];k&&k.children.splice(k.children.indexOf(h.node),1),delete c.sliceBlocks[h.id],h=k}}),d},d.updateLevelCritetria=function(a,b,c,d,e){if(b&&a){var g=d.filter(function(a){return a instanceof f});Object.keys(a).forEach(function(c){var f=g.filter(function(b){return b.level===a[c]}),h=b.filter(function(a){return(a.referenceKey||a.caption)===c});h.length?f[0].level=b.indexOf(h[0])+e:d.splice(d.indexOf(f[0]),1)})}},d.prototype.getState=function(){var a=this,c=[];this.sortCriteria.map(function(a){return a.serialize()}).filter(function(a){return!!a}).forEach(function(a){return c.push(a)});var e={};this.options.groupingLevelDescriptor&&this.options.groupingLevelDescriptor.length&&this.sortCriteria.filter(function(a){return a instanceof f}).forEach(function(c){if(c.level!==-1){var d=a.axisType===b.AxisType.Row?0:1,f=a.options.groupingLevelDescriptor[c.level-d];f&&(e[f.referenceKey||f.caption]=c.level)}});var g={pivotState:this.sourcePivotAxis.getState(),criteria:c,levelKeyMap:e};return b.PersistableStateHelper.serialize(d.serializationTag,d.serializationVersion,g)},d.prototype.setState=function(a){var c=this,e=b.PersistableStateHelper.load(d.serializationTag,d.serializationVersion,a);if(e){this.sourcePivotAxis.setState(e.pivotState);var f=e.criteria.map(function(a){return c._factory.deserialize(a)}).filter(function(a){return!!a}).filter(function(a){return!c.disabledKeys[a.getKeyOrLevel()]}).filter(function(a){return!c.oneShotSortKeys[a.getKeyOrLevel()]}),g=this.options.groupingLevelDescriptor,h=e.levelKeyMap;d.updateLevelCritetria(h,g,this._factory,f,this.axisType),this.setSortCriteria(f)}},d.prototype.getAs=function(a){return this instanceof a?this:this.sourcePivotAxis.getAs(a)},d.serializationTag="__SortingPivotAdapter",d.serializationVersion=1,d}(b.PivotAxisAdapter);b.SortingPivotAxisAdapter=i;var j=function(a){function c(c,d,e,f){void 0===e&&(e=!1),void 0===f&&(f=!1);var g=a.call(this,c)||this;if(g.disablePersistency=f,g._targetAxis=d,d===b.AxisType.Row){var h=function(a){var b=g._sortingAxis.getSortingRequiredKeys();b.forEach(function(b){a[b]=!0})};g._columnAxis=new b.PivotAxisRequiredSlicesAdapter(c.getColumnAxis(),h),g._rowAxis=g._sortingAxis=new i(c.getRowAxis(),d,c.getDataSet(),e,g._columnAxis)}else g._rowAxis=c.getRowAxis(),g._columnAxis=g._sortingAxis=new i(c.getColumnAxis(),d,c.getDataSet(),e,g._rowAxis);return g}return __extends(c,a),c.prototype.getLogTypeName=function(){return"SortingDataModel"},Object.defineProperty(c.prototype,"factory",{get:function(){return this._sortingAxis.factory},enumerable:!0,configurable:!0}),c.prototype.setSortCriteria=function(a){this._sortingAxis.setSortCriteria(a)},c.prototype.getSortCriteria=function(){return this._sortingAxis.getSortCriteria()},c.prototype.setFallbackSortCriteria=function(a){this._sortingAxis.setFallbackSortCriteria(a)},c.prototype.getFallbackSortCriteria=function(){return this._sortingAxis.getFallbackSortCriteria()},c.prototype.actualSortCriteria=function(){return this._sortingAxis.actualSortCriteria()},c.prototype.executeOneShotSorting=function(a){this._sortingAxis.executeOneShotSorting(a)},c.prototype.getRowAxis=function(){return this._rowAxis},c.prototype.getColumnAxis=function(){return this._columnAxis},c.prototype.getTargetAxis=function(){return this._targetAxis},c.prototype.dispose=function(b){a.prototype.dispose.call(this,b),this._sortingAxis.dispose()},c.prototype.getState=function(){var a=this.disablePersistency?null:this._columnAxis.getState(),d=this.disablePersistency?null:this._rowAxis.getState(),e=void 0;return this._sourceDm.getState&&(e=this._sourceDm.getState()),b.PersistableStateHelper.serialize(c._stateTag,c._stateVersion,{columnAxis:a,rowAxis:d,sourceDataModelState:e})},c.prototype.setState=function(a){var d=b.PersistableStateHelper.load(c._stateTag,c._stateVersion,a);d&&(!this.disablePersistency&&d.columnAxis&&this._columnAxis.setState(d.columnAxis),!this.disablePersistency&&d.rowAxis&&this._rowAxis.setState(d.rowAxis),d.sourceDataModelState&&this._sourceDm.setState&&this._sourceDm.setState(d.sourceDataModelState))},c._stateTag="__SortingDataModelState",c._stateVersion=1,c.stateTag="__SortingDataModelState",c.stateVersion=1,c}(b.DataModelAdapter);b.SortingDataModel=j}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(c){function d(d,e,f){var g=c.call(this,d)||this;return g.sourcePA=d,g.targetAxisType=e,g.options=d.options,g.options.sortingChangedEvent=new a.Event,g.options.actualSortingChangedEvent=new a.Event,g._factory=new b.SortCriterionFactory(g,e,f),g}return __extends(d,c),d.prototype.getLogTypeName=function(){return"VirtualSortingPivotAxisAdapter"},d.prototype.getAppliedSortCriteria=function(){return this.getSortCriteria()},d.prototype.processCriteria=function(a){var c=a||[];return c.forEach(function(a){a.getKeyOrLevel=function(){var c=b.DataTable.convertSortCriterion(a);return c&&c.keyOrLevel}}),c},d.prototype.getSortCriteria=function(){return this.processCriteria(this.sortCriteria)},d.prototype.setSortCriteria=function(a){this.sortCriteria=a,this.options.sortingChangedEvent.raise(this,this.sortCriteria),this.options.actualSortingChangedEvent.raise(this,this.sortCriteria)},d.prototype.setFallbackSortCriteria=function(a){this.fallbackSortCriteria=a,this.options.actualSortingChangedEvent.raise(this,this.sortCriteria)},d.prototype.getFallbackSortCriteria=function(){return this.processCriteria(this.fallbackSortCriteria)},d.prototype.actualSortCriteria=function(){return this.processCriteria(this.sortCriteria).concat(this.processCriteria(this.fallbackSortCriteria))},d.prototype.getAs=function(a){return this instanceof a?this:this.sourcePA.getAs(a)},Object.defineProperty(d.prototype,"factory",{get:function(){return this._factory},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"hasUserSorting",{get:function(){return!0},enumerable:!0,configurable:!0}),d.prototype.getState=function(){var a=this,c=[];this.getSortCriteria().map(function(a){return a.serialize()}).filter(function(a){return!!a}).forEach(function(a){return c.push(a)});var e={};this.options.groupingLevelDescriptor&&this.options.groupingLevelDescriptor.length&&this.getSortCriteria().filter(function(a){return a instanceof b.LevelSortCriterion}).forEach(function(c){if(c.level!==-1){var d=a.targetAxisType===b.AxisType.Row?0:1,f=a.options.groupingLevelDescriptor[c.level-d];f&&(e[f.referenceKey||f.caption]=c.level)}});var f={pivotState:this.sourcePivotAxis.getState(),criteria:c,levelKeyMap:e};return b.PersistableStateHelper.serialize(d.serializationTag,d.serializationVersion,f)},d.prototype.setState=function(a){var c=this,e=b.PersistableStateHelper.load(d.serializationTag,d.serializationVersion,a);if(e){this.sourcePivotAxis.setState(e.pivotState);var f=e.criteria.map(function(a){return c._factory.deserialize(a)}).filter(function(a){return!!a}),g=this.options.groupingLevelDescriptor,h=e.levelKeyMap;b.SortingPivotAxisAdapter.updateLevelCritetria(h,g,this._factory,f,this.targetAxisType),this.setSortCriteria(f)}},d.serializationTag="__VirtualSortingPivotAxisAdapterState",d.serializationVersion=1,d}(b.PivotAxisAdapter);b.VirtualSortingPivotAxisAdapter=c;var d=function(){function a(a,d){this.sourceDm=a,this._targetAxis=d,d===b.AxisType.Row?(this._rowAxis=this._sortingAxis=new c(a.getRowAxis(),b.AxisType.Row,a.getDataSet()),this._columnAxis=a.getColumnAxis()):(this._columnAxis=this._sortingAxis=new c(a.getColumnAxis(),b.AxisType.Column,a.getDataSet()),this._rowAxis=a.getRowAxis())}return a.prototype.getLogTypeName=function(){return"VirtualSortingDataModel"},a.prototype.getSortedAxis=function(){return this._sortingAxis},a.prototype.getSortCriteria=function(){return this._sortingAxis.getSortCriteria()},a.prototype.setSortCriteria=function(a){this._sortingAxis.setSortCriteria(a)},a.prototype.getFallbackSortCriteria=function(){return this._sortingAxis.getFallbackSortCriteria()},a.prototype.setFallbackSortCriteria=function(a){this._sortingAxis.setFallbackSortCriteria(a)},a.prototype.actualSortCriteria=function(){return this._sortingAxis.actualSortCriteria()},a.prototype.executeOneShotSorting=function(a){},a.prototype.getRowAxis=function(){return this._rowAxis},a.prototype.getColumnAxis=function(){return this._columnAxis},Object.defineProperty(a.prototype,"factory",{get:function(){return this._sortingAxis.factory},enumerable:!0,configurable:!0}),a.prototype.getDataSet=function(){return this.sourceDm.getDataSet()},a.prototype.getAs=function(a){return this instanceof a?this:this.sourceDm.getAs(a)},a.prototype.dispose=function(a){},a.prototype.getLogId=function(){return this.sourceDm.getLogId&&this.sourceDm.getLogId()},a.prototype.getState=function(){var c=void 0,d=this._rowAxis.getState(),e=this._columnAxis.getState();return this.sourceDm.getState&&(c=this.sourceDm.getState()),b.PersistableStateHelper.serialize(a._stateTag,a._stateVersion,{sourceDataModelState:c,rowAxis:d,columnAxis:e})},a.prototype.setState=function(c){var d=b.PersistableStateHelper.load(a._stateTag,a._stateVersion,c);d&&(d.rowAxis&&this._rowAxis.setState(d.rowAxis),d.columnAxis&&this._columnAxis.setState(d.columnAxis),d.sourceDataModelState&&this.sourceDm&&this.sourceDm.setState&&this.sourceDm.setState(d.sourceDataModelState))},a._stateTag="__VirtualSortingDataModelState",a._stateVersion=1,a.stateTag="__VirtualSortingDataModelState",a.stateVersion=1,a}();b.VirtualSortingDataModel=d;var e=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.getLogTypeName=function(){return"VirtualDataSet"},c.prototype.isLoadingRowKey=function(b){var c=a.prototype.__getRow.call(this,b),d=c&&Object.keys(c);return!d||0===d.length},c.prototype.setValue=function(a,b,c,d){this.setRowValues(a,[{columnKey:b,value:c}],d)},c.prototype.setRowValues=function(b,c,d){var e="string"==typeof b?b:h.idxToKey(b);a.prototype.setRowValues.call(this,e,c,d)},c.prototype.getRowData=function(a){return this.__getRow(a)},c.prototype.__getRow=function(d,e){try{if(this.isLoadingRowKey(d)){var f={},g={};return g[c.isLoadingRowProperty]=!0,f[b.RowMetadataProperty]=g,f}return a.prototype.__getRow.call(this,d,e)}catch(a){return{}}},c.isLoadingRowProperty="__ionweb_is_loading_row",c}(b.ManualDataSet);b.VirtualDataSet=e;var f=function(){function c(c,d){this.data=new e,this._logId=c||b.getInstanceId(),this.onRowWindowChanged=new a.Event,this.rows=new h(this._logId+b.LogKeys.VirtualFlatAxisDef._Row_),this.columns=d||new b.FlatAxis(this._logId+b.LogKeys.PivotAxisDef._Column_)}return c.prototype.getLogTypeName=function(){return"VirtualDataModel"},c.prototype.setColumns=function(a,b){this.columns.removeBlock(0,this.columns.length()),a&&this.columns.appendBlock(a,b)},c.prototype.resetData=function(){this.data.clear(),this.rows.options.slicesEvent.raise(this,[{type:b.SliceEventType.Reset}])},c.prototype.getRowWindow=function(){return this._currentWindow},c.prototype.setRowWindow=function(a,b){var c=Math.floor(b/2),d={start:Math.max(0,a-c),count:b+c},e=!this._currentWindow||!d||this._currentWindow.start!==d.start||this._currentWindow.count!==d.count;e&&(this._currentWindow=d,this.onRowWindowChanged.raise(this,this._currentWindow))},c.prototype.getDataSet=function(){return this.data},c.prototype.getRowAxis=function(){return this.rows},c.prototype.getColumnAxis=function(){return this.columns},c.prototype.getAs=function(a){return this instanceof a?this:null},c.prototype.dispose=function(){},c.prototype.getState=function(){var a=new b.DataModelState(this.columns.getState(),this.rows.getState());return a.serialize()},c.prototype.setState=function(a){var c=b.DataModelState.load(a);c&&(c.columnState&&this.columns.setState(c.columnState),c.rowState&&this.rows.setState(c.rowState))},c.prototype.getLogId=function(){return this._logId},c}();b.VirtualDataModel=f;var g=function(){function c(b){this.slicesEvent=new a.Event,this.measuresChanged=new a.Event,this.collectingRequiredSlices=new a.Event,this._axis=b}return Object.defineProperty(c.prototype,"groupingLevelDescriptor",{get:function(){return this._groupingLevelDescriptor},set:function(a){this._groupingLevelDescriptor=a},enumerable:!0,configurable:!0}),c.prototype.getLogTag=function(){return b.LogKeys.VirtualFlatAxisDef.VirtualFlatAxis},c.prototype.hasVisibleSlices=function(a){return a==this.getVisibleRoot()},c.prototype.lastSliceIndex=function(a){return this._axis.length()-1},c.prototype.getFirstSlice=function(a){return 0},c.prototype.getNodeAndMeasureKey=function(a){return{nodeKey:this.getVisibleRoot().key(),measureKey:a}},c.prototype.getSlicesOfMeasure=function(a){return this._axis.getSlice(a)},c.prototype.isLevelSummaryVisible=function(a){return!0},c.prototype.isNodeSummaryVisible=function(a){return!0},c.prototype.requestExpandState=function(a,b){return!1},c.prototype.getExpandState=function(a){return b.ExpandState.None},c.prototype.getVisibleRoot=function(){return this._axis._root},c.prototype.getTreeNode=function(a){var b=this,c=this.getVisibleRoot().key(),d={key:function(){return c},level:function(){return 0},parent:function(){return null},headerClass:function(){return""},length:function(){return b._axis.length()},displayName:function(){return c},value:function(){return null},alias:c,description:c,category:"",isPlaceholder:!1};return a==d.key()?d:{key:function(){return a},level:function(){return 1},parent:function(){return d},headerClass:function(){return""},length:function(){return 1},displayName:function(){return a},value:function(){return null},alias:a,description:a,category:"",isPlaceholder:!1}},c.prototype.getNodeKey=function(a){return this.getVisibleRoot().key()},c.prototype.getSliceKeys=function(a){return this._axis.getSliceRange(0,this._axis.length()).map(function(a){return a.key()})},c.prototype.getNodeSliceRange=function(a,b,c){return{start:b,count:c}},c.prototype.setDisplayName=function(a,b){return null},c.prototype.setAlias=function(a,b){return null},c.prototype.setDescription=function(a,b){return null},c.prototype.setCategory=function(a,b){return null},c.prototype.setDisplayItemOptions=function(a,b){return null},c.prototype.setValues=function(a){},c.prototype.getVisibleLevelSummaries=function(){return[!1]},c.prototype.setVisibleLevelSummaries=function(a){},c.prototype.getMeasures=function(){return[]},c.prototype.setMeasures=function(a){},c.prototype.getAvailableSlices=function(){return[]},c.prototype.refreshRequiredSlices=function(){var a={};return a},c}();b.VirtualFlatAxisOptions=g;var h=function(){function c(c){this.enableLeavesCounter=!1,this._logId=c,this._root=new b.TreeNode("<ROOT>"),this.measuresChanged=new a.Event,this.nodeStateUpdated=new a.Event,this.options=new g(this)}return c.prototype.getLogTypeName=function(){return"VirtualFlatAxis"},c.keyToIdx=function(a){return parseInt(a)},c.idxToKey=function(a){return""+a},c.prototype.resize=function(a){a!=this._size&&(this._size=a,this.options.slicesEvent.raise(this,[{type:b.SliceEventType.Reset}]))},c.prototype.raiseStructuralChanged=function(){this.options.slicesEvent.raise(this,[{type:b.SliceEventType.Reset}])},c.prototype.length=function(){return this._size},c.prototype.getLogId=function(){return this._logId},c.prototype.getAs=function(a){return this instanceof a?this:null},c.prototype.getSlice=function(a){var d=c.keyToIdx(a);if(d>=this._size)throw new Error(b.Strings.Err_DM_InvalidKey+a);return{index:function(){return d},key:function(){return a},displayName:function(){return a}}},c.prototype.contains=function(a){return c.keyToIdx(a)<this.length()},c.prototype.getKey=function(a){return c.idxToKey(a)},c.prototype.getSliceRange=function(a,b){var d=[];if(a>this._size)return[];for(var e=this._size-a,f=Math.min(b,e),g=0;g<f;g++)d.push(this.getSlice(c.idxToKey(a+g)));return d},c.prototype.getCategories=function(){var a=[],b=this.getSliceRange(0,this.length());return b.forEach(function(b){void 0!=b.category&&a.indexOf(b.category)<0&&a.push(b.category)}),a},c.prototype.getState=function(){return{}},c.prototype.setState=function(a){},c}();b.VirtualFlatAxis=h}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(c){function d(e,f,g,h){var i=c.call(this,e,f,b.LogKeys.DataModel.ScrollerDataModel,g)||this;i.inBeginEnd=!1,i.recordDataModelOptions=h||{},c.prototype._initDm.call(i,i.recordDataModelOptions,a.SubscriptionType.Queue),i._currentWindow={start:0,count:d.startViewportSize},i._vDataModel=new b.VirtualDataModel(null,i.getColumnAxis()),i.unsub=i._vDataModel.onRowWindowChanged.add(function(a,b){return i.setWindow(b)}),i._virtualSortingDataModel=new b.VirtualSortingDataModel(i._vDataModel,b.AxisType.Row);var j=function(){i.fetchData()};i._virtualSortingDataModel.getSortedAxis().options.actualSortingChangedEvent.add(function(a,b){return j()});var k=i._virtualSortingDataModel.getSortedAxis().actualSortCriteria();return k&&k.length&&j(),i._commService=e,i._loggerService=f.create("Scroller DataModel"),i.onFetchOperationUpdated=new a.Event,i.downloadEndRecordReceived=new a.Event,i.subscriptionOptions.begin=function(){i.inBeginEnd=!0},i.subscriptionOptions.end=function(){i.inBeginEnd=!1},i.subscriptionOptions.add=function(a,b){i.processData(b)},i.subscriptionOptions.supply=function(a,b){i.processData(b)},i.subscriptionOptions.user=function(a,b){var c=a.indexOf(":"),e=a.substr(0,c);if(e===d.RequestCompletedCode&&i._fetchAllDeferred)i._fetchAllDeferred.resolve(null),i._fetchAllDeferred=null,i._fetchOperationProgress=100,i.onFetchOperationUpdated.raise(i,100);else if(e===d.TotalChangedCode){var f=JSON.parse(a.substr(c+1)),g=parseInt(f.Total);i._vDataModel.getRowAxis().resize(g),i.reducedWindow&&i._vDataModel.getRowAxis().length()&&i.fetchData()}else e===d.DownloadEndCode&&i.downloadEndRecordReceived.raise(i,i._vDataModel.getRowAxis().length())},i}return __extends(d,c),d.prototype.getLogTypeName=function(){return"ScrollerDataModel"},Object.defineProperty(d.prototype,"batchEndRecordRecieved",{get:function(){return this.downloadEndRecordReceived},enumerable:!0,configurable:!0}),d.prototype.settingFieldsToSubscribe=function(a){if(0===a.length)this.subscriptionOptions.fields=[];else{var b=a.splice(0);b.indexOf(d.PagerOrdinalFieldName)<0&&b.push(d.PagerOrdinalFieldName),b.indexOf(d.PagerTotalFieldName)<0&&b.push(d.PagerTotalFieldName),this.subscriptionOptions.fields=b}},d.prototype.startViewport=function(a,b){if(this._componentSource)throw new Error("the datamodel is already initialzed");return this._componentSource=a,this.createViewport(b)},d.prototype.init=function(a,b,c){if(this._componentSource)throw new Error("the datamodel is already initialzed");return this._vDataModel.setColumns(c),this.startViewport(a,b)},d.prototype.changeViewport=function(a){if(!this._componentSource)throw new Error("the datamodel is not initialzed yet");return this.createViewport(a)},d.prototype.getActualRowWindowData=function(){return this._currentWindow},d.prototype.startFetchAllOperation=function(){var a=this;return this._loggerService.ifMedium(function(){return{key:a.getLogId(),params:{request:"ScrollerDM_startFetchAllOperation"}}}),this._fetchAllDeferred?void this._loggerService.ifMedium(function(){return{key:a.getLogId(),params:{warning:"ScrollerDM_startFetchAllOperation already requested"}}}):(this._fetchAllDeferred=Q.defer(),this._fetchOperationProgress=0,this.fetchData({start:0,count:this._vDataModel.getRowAxis().length()}),this._fetchAllDeferred.promise)},d.prototype.closeFetchAllOperation=function(){var a=this;this._loggerService.ifMedium(function(){return{key:a.getLogId(),params:{request:"closeFetchAllOperation"}}}),this._fetchAllDeferred&&(this._fetchAllDeferred.resolve(null),this._fetchAllDeferred=null),this.fetchData(this._virtualDMWindow)},d.prototype.getViewportId=function(){return this._viewportId},d.prototype.getRowAxis=function(){return this._virtualSortingDataModel.getRowAxis()},d.prototype.getDataSet=function(){return this._virtualSortingDataModel.getDataSet()},d.prototype.getAs=function(a){return this instanceof a?this:this._virtualSortingDataModel.getAs(a)},d.prototype.getDataModel=function(){return this._virtualSortingDataModel},d.prototype.clearSubscription=function(){this._viewportId=null,this._unsubscribe()},d.prototype.dispose=function(){this.unsub(),this.clearSubscription()},d.prototype.setWindow=function(a){this._virtualDMWindow=a;var b={start:a.start,count:Math.round(1.5*a.count)};this.fetchData(b)},d.prototype.processRowValues=function(a,c,d){var e=this.getConvertDataCallback(),f=this._vDataModel.getDataSet(),g=c.reduce(function(c,d){var g=d.columnKey,h=d.value,i=e(a,g,h);return i&&(h=i.value),b.areFieldEqual(f.getValue(a,g),h)||(c[g]=h),c},{});Object.getOwnPropertyNames(g).length>0&&f.setRowValues(a,g,d)},d.prototype.processData=function(a){this._vDataModel.getRowAxis().resize(a[d.PagerTotalFieldName]);var c=a[d.PagerOrdinalFieldName]-1,e=b.VirtualFlatAxis.idxToKey(c),f=this.inBeginEnd,g=this.getColumnAxis().getSliceRange(0,this.getColumnAxis().length()).map(function(b){var c=b.key(),d=a[c];return{columnKey:c,value:d}});this.processRowValues(e,g,f),this._fetchAllDeferred&&(this._fetchOperationProgress+=100/this.getRowAxis().length(),this.onFetchOperationUpdated.raise(this,this._fetchOperationProgress))},d.prototype.destroyViewport=function(){this.clearSubscription(),this._vDataModel.getRowAxis().resize(0),this._vDataModel.resetData()},d.prototype.createViewport=function(a){var b=this;this.destroyViewport();var c={name:this._componentSource+d.CreateViewportFunctionName,namedArgs:{From:1,To:this._currentWindow.count},varArgs:this.getSortingArgs().concat(a||[])};return this._commService.invoke(c).then(function(a){var c=a.varValues[a.varValues.indexOf(d.QueueNameFieldName)+1],e=a.varValues[a.varValues.indexOf(d.ViewportIdFieldName)+1];b.subscribeQueue(c,e)})},d.prototype.subscribeQueue=function(a,b){this.inBeginEnd=!1,this._viewportId=b,this._subscribe(a)},d.prototype.cleanDataSetAndRestoreIntersection=function(a,b){var c=this,d=a>=0?this._vDataModel.getRowAxis().getSliceRange(a,b):[],e={};d.forEach(function(a){e[a.key()]=c._vDataModel.getDataSet().getRowData(a.key())}),this._vDataModel.resetData(),d.forEach(function(a){var b=a.key(),d=c.getColumnAxis().getSliceRange(0,c.getColumnAxis().length()).map(function(a){var c=a.key(),d=e[b][c];return{columnKey:c,value:d}});c.processRowValues(b,d,!0)})},d.prototype.getSortingArgs=function(){var a=[],c=this._virtualSortingDataModel.getSortedAxis().actualSortCriteria();return c&&c.length&&(a.push(d.SortByPrefix+c.length+d.SortBySuffix),c.forEach(function(c){var d=c.getKey(),e=c.getDirection()===b.SortDirection.Descending?"DESC":"ASC";a.push(d+":"+e)})),a},d.prototype.fetchData=function(a){var b=this;if(this._viewportId){if(a&&(a.start!==a.start||a.count!==a.count))return void this._loggerService.ifMedium(function(){return{key:b.getLogId(),params:{request:"ScrollerDM_fetchData",newWindow:a,viewportId:b._viewportId,info:"newWindow does not contain valid range"}}});if(this._loggerService.ifMedium(function(){return{key:b.getLogId(),params:{request:"ScrollerDM_fetchData",newWindow:a,viewportId:b._viewportId}}}),!this._componentSource)return void this._loggerService.ifMedium(function(){return{key:b.getLogId(),params:{warning:"ScrollerDM_fetchData componentSource not yet initialized"}}});a||(a=this._currentWindow);var c=a.start+1,e=this.getSortingArgs();this._fetchAllDeferred&&(e.push(d.RequestIdParameter),e.push(d.ServiceRequestIdParameter));var f=c+a.count-1,g=Math.min(f,this.getRowAxis().length());g=Math.max(g,c),this.reducedWindow=f!==g;var h={name:this._componentSource+d.SetViewportFunctionName,namedArgs:{ViewportId:this._viewportId,From:c,To:g},varArgs:e};if(!this._fetchAllDeferred){var i=-1,j=-1;if(a.start>this._currentWindow.start+this._currentWindow.count);else if(this._currentWindow.start>a.start+a.count);else{i=Math.max(a.start,this._currentWindow.start);var k=Math.min(a.start+a.count-1,this._currentWindow.start+this._currentWindow.count-1);j=Math.max(k-i+1,1)}this.cleanDataSetAndRestoreIntersection(i,j)}this._currentWindow=a,this._commService.invoke(h).then(function(){}).catch(function(a){throw new Error("ScrollerDM - function call failed: "+a.message)})}},d.prototype.getState=function(){var a=this._virtualSortingDataModel.getState();return b.PersistableStateHelper.serialize(d.stateTag,d.stateVersion,{virtualDmState:a})},d.prototype.setState=function(a){var c=b.PersistableStateHelper.load(d.stateTag,d.stateVersion,a);c&&c.virtualDmState&&this._virtualSortingDataModel.setState(c.virtualDmState)},d.startViewportSize=1,d.PagerTotalFieldName="_viewTotal",d.PagerOrdinalFieldName="_viewOrdinal",d.QueueNameFieldName="QueueName",d.ViewportIdFieldName="ViewportId",d.CreateViewportFunctionName="_ScrollerCreateViewport",d.SetViewportFunctionName="_ScrollerSetViewport",d.RequestIdParameter="-Scroller_RequestId",d.ServiceRequestIdParameter="fetchAll",d.RequestCompletedCode="103",d.DownloadEndCode="15",d.TotalChangedCode="101",d.SortByPrefix="ARRAY.-Scroller_SortBy.",d.SortBySuffix=".STR",d.stateTag="__ScrollerDataModelState",d.stateVersion=1,d}(b.CommLayerDataModel);b.ScrollerDataModel=c}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){}return a.Text_Cond_Eq="is equal to",a.Text_Cond_Neq="is not equal to",a.Text_Cond_Gt="is greater than",a.Text_Cond_Gte="is greater than or equal to",a.Text_Cond_Lt="is less than",a.Text_Cond_Lte="is less than or equal to",a.Text_Cond_DateEq="is equal to",a.Text_Cond_DateNeq="is not equal to",a.Text_Cond_DateGt="is after",a.Text_Cond_DateGte="is after or equal to",a.Text_Cond_DateLt="is before",a.Text_Cond_DateLte="is before or equal to",a.Text_Cond_Default_Text="Text",a.Text_Cond_None="None",a.Text_Cond_StrCompare_Fmt='Text ${op} "${value}"',a.Text_Cond_StrCompare_Type_Fmt="Text ${op}",a.Text_Cond_DateCompare_Fmt="Date ${op} ${value}",a.Text_Cond_DateCompare_Type_Fmt="Date ${op}",a.Text_Cond_DateTimeCompare_Fmt="Date/time ${op} ${value}",a.Text_Cond_DateTimeCompare_Type_Fmt="Date/time ${op}",a.Text_Cond_NumCompare_Fmt="Value ${op} ${value}",a.Text_Cond_NumCompare_Type_Fmt="Value ${op}",a.Text_Cond_AbsnumCompare_Fmt="Absolute value ${op} ${value}",a.Text_Cond_AbsnumCompare_Type_Fmt="Absolute value ${op}",a.Text_Cond_Range_Exclusive=" (excluded)",a.Text_Cond_Range_Inclusive="",a.Text_Cond_DateRange_Fmt="Date is between ${v1}${v1i} and ${v2}${v2i}",a.Text_Cond_DateRange_Type_Fmt="Date is between",a.Text_Cond_DateTimeRange_Fmt="Date/time is between ${v1}${v1i} and ${v2}${v2i}",a.Text_Cond_DateTimeRange_Type_Fmt="Date/time is between",a.Text_Cond_NumRange_Fmt="Value is between ${v1} and ${v2}",a.Text_Cond_NumRange_Type_Fmt="Value is between",a.Text_Cond_AbsnumRange_Fmt="Absolute value is between ${v1} and ${v2}",a.Text_Cond_AbsnumRange_Type_Fmt="Absolute value is between",a.Text_Cond_In_Type_Fmt="Value is either",a.Text_Cond_StrContains_Fmt="Text contains",a.Text_Cond_StrContains_Type_Fmt="Text contains ${value}",a.Exc_Cond_UnknownOp="Unsupported operation: ${op}",a.Err_Cond_EmptyValue="Empty value not allowed",a.Err_Cond_LegCount="Invalid number of leg conditions",a.Err_Cond_InvalidMinVal="Invalid minimum range value",a.Err_Cond_InvalidMaxVal="Invalid maximum range value",a.Err_Cond_InvertedRange="Invalid range (inverted)",a.Text_Cond_And=" AND ",a.Text_Cond_Or=" OR ",a.Text_Cond_Not="NOT ",a.Array_Value_Separator=",",a.Rule_Menu_Delete_Rule="Delete",a.Rule_Menu_Move_Rule_UP="Move up",a.Rule_Menu_Move_Rule_Down="Move down",a}();a.Strings=b}(b=a.rules||(a.rules={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.Equal=0]="Equal",a[a.NotEqual=1]="NotEqual",a[a.GreaterThan=2]="GreaterThan",a[a.GreaterThanOrEqual=3]="GreaterThanOrEqual",a[a.LessThan=4]="LessThan",a[a.LessThanOrEqual=5]="LessThanOrEqual",a[a.Range=6]="Range",a[a.Contains=7]="Contains"}(b=a.OperatorType||(a.OperatorType={}));var c;!function(a){a[a.Date=0]="Date",a[a.Number=1]="Number",a[a.String=2]="String"}(c=a.DataType||(a.DataType={}))}(b=a.rules||(a.rules={}));
}(ionweb||(ionweb={})),function(a){var b;!function(b){function c(a,b){return a.toShortDate(b)+" "+a.toShortTime(b)}function d(){return a.module("ionwebGrids").getService("ionweb.dateFormattingService")}function e(a,b){var c;return"string"==typeof a?(b&&b.parseDate&&(c=b.parseDate(a)),c||(c=d().parseDate(a))):c=a,c||z}function f(a){if(a){var b=g(JSON.parse(JSON.stringify(a)));return b.context=a.context,b}return a}function g(b){function c(a){return a.map(function(a){return g(a)})}function d(b){return b&&a.localization.moment(b,a.localization.moment.ISO_8601,!0).isValid()?new Date(b):b}function e(a){return Array.isArray(a)?a.map(function(a){return d(a)}):a}if(!b)return null;if(b instanceof u)return b;if("object"!=typeof b||Array.isArray(b))throw new Error("Object expected");if(!b._type)throw new Error("Missing type specifier");var f;switch(b._type){case i:f=new y;break;case j:f=new C;break;case k:f=new A;break;case l:f=new B;break;case m:f=new F;break;case n:f=new D;break;case o:f=new E;break;case t:f=new J;break;case r:f=new H;break;case s:f=new I;break;case p:f=new L;break;case q:f=new M;break;default:throw new Error("Unknown condition type: "+b._type)}switch(f=a.extend(f,[b]),b._type){case m:f.condition=g(f.condition);break;case n:f.conditions=c(f.conditions);break;case o:f.conditions=c(f.conditions);break;case k:f.value=d(f.value);break;case q:f.min=d(f.min),f.max=d(f.max);break;case t:case r:f.condition=g(f.condition);break;case s:f.condition=g(f.condition),f.values=e(f.values)}return f}var h=1e-6,i="strCmp",j="strContains",k="dateCmp",l="numCmp",m="not",n="and",o="or",p="numRange",q="dateRange",r="numIn",s="dateIn",t="stringIn",u=function(){function a(){}return a.prototype.isValid=function(){return!this.validate()},Object.defineProperty(a.prototype,"context",{get:function(){return this._context},set:function(a){this._context=a,this.onContextChanged()},enumerable:!0,configurable:!0}),a.prototype.onContextChanged=function(){},a.prototype.toJSON=function(){return{}},a}();b.Condition=u;var v;!function(a){a[a.Equality=1]="Equality",a[a.Inequality=2]="Inequality",a[a.Greater=3]="Greater",a[a.GreaterOrEqual=4]="GreaterOrEqual",a[a.Less=5]="Less",a[a.LessOrEqual=6]="LessOrEqual"}(v=b.CompareOperator||(b.CompareOperator={}));var w=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),Object.defineProperty(d.prototype,"value",{get:function(){return this._value},set:function(a){this._value=a,this.onValueChanged()},enumerable:!0,configurable:!0}),d.prototype.onValueChanged=function(){},d.prototype.matchOp=function(c){switch(this.op){case v.Equality:return 0===c;case v.Inequality:return 0!==c;case v.Greater:return c>0;case v.GreaterOrEqual:return c>=0;case v.Less:return c<0;case v.LessOrEqual:return c<=0}throw new Error(a.stringFormat(b.Strings.Exc_Cond_UnknownOp,{op:this.op}))},d.prototype.getOpStr=function(){switch(this.op){case v.Equality:return b.Strings.Text_Cond_Eq;case v.Inequality:return b.Strings.Text_Cond_Neq;case v.Greater:return b.Strings.Text_Cond_Gt;case v.GreaterOrEqual:return b.Strings.Text_Cond_Gte;case v.Less:return b.Strings.Text_Cond_Lt;case v.LessOrEqual:return b.Strings.Text_Cond_Lte}return null},d.prototype.validate=function(){return this.op>=v.Equality&&this.op<=v.LessOrEqual?null===this.value||"undefined"==typeof this.value?b.Strings.Err_Cond_EmptyValue:void 0:a.stringFormat(b.Strings.Exc_Cond_UnknownOp,{op:this.op})},d.prototype.toJSON=function(){var a=c.prototype.toJSON.call(this);return a.value=this.value,a.op=this.op,a},d}(u);b.CompareCondition=w;var x;!function(a){a[a.Natural=0]="Natural",a[a.Ascii=1]="Ascii"}(x=b.StringCompareMode||(b.StringCompareMode={}));var y=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.mode=x.Natural,a}return __extends(d,c),d.prototype.evaluate=function(b){return this.mode===x.Natural?c.prototype.matchOp.call(this,a.ValueComparer.naturalStringCompare(b.getFormatted(),this.value,this.caseSens)):c.prototype.matchOp.call(this,a.ValueComparer.asciiStringCompare(b.getFormatted(),this.value,this.caseSens))},d.prototype.toString=function(c){return a.stringFormat(c?b.Strings.Text_Cond_StrCompare_Type_Fmt:b.Strings.Text_Cond_StrCompare_Fmt,{op:this.getOpStr(),value:this.value})},d.prototype.conditionDataType=function(){return b.DataType.String},d.create=function(b){return a.extend(new d,[b])},d.prototype.toJSON=function(){var a=c.prototype.toJSON.call(this);return a._type=i,a.caseSens=this.caseSens||void 0,a.mode=this.mode||void 0,a},d}(w);b.StringCompareCondition=y;var z=new Date(1970),A=function(f){function g(){return null!==f&&f.apply(this,arguments)||this}return __extends(g,f),g.prototype.onValueChanged=function(){this.parsedDate=null},g.prototype.onContextChanged=function(){this.parsedDate=null},g.prototype.evaluate=function(b){return this.parsedDate=this.parsedDate||e(this.value,this.context),f.prototype.matchOp.call(this,a.ValueComparer.dateCompare(b.rawValue,this.parsedDate,this.dateOnly))},g.prototype.getOpStr=function(){switch(this.op){case v.Equality:return b.Strings.Text_Cond_DateEq;case v.Inequality:return b.Strings.Text_Cond_DateNeq;case v.Greater:return b.Strings.Text_Cond_DateGt;case v.GreaterOrEqual:return b.Strings.Text_Cond_DateGte;case v.Less:return b.Strings.Text_Cond_DateLt;case v.LessOrEqual:return b.Strings.Text_Cond_DateLte}return null},g.prototype.toString=function(e){var f=d();return this.dateOnly?a.stringFormat(e?b.Strings.Text_Cond_DateCompare_Type_Fmt:b.Strings.Text_Cond_DateCompare_Fmt,{op:this.getOpStr(),value:"string"==typeof this.value?this.value:f.toShortDate(this.value)}):a.stringFormat(e?b.Strings.Text_Cond_DateTimeCompare_Type_Fmt:b.Strings.Text_Cond_DateTimeCompare_Fmt,{op:this.getOpStr(),value:"string"==typeof this.value?this.value:c(f,this.value)})},g.prototype.conditionDataType=function(){return b.DataType.Date},g.create=function(a){var b=new g;return b.value=a.value,b.op=a.op,b.dateOnly=a.dateOnly,b.context=a.context,b},g.prototype.toJSON=function(){var a=f.prototype.toJSON.call(this);return a._type=k,a.dateOnly=this.dateOnly||void 0,a},g}(w);b.DateCompareCondition=A;var B=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.epsilon=h,a}return __extends(d,c),d.prototype.evaluate=function(b){var d;return d=this.absolute?a.ValueComparer.numberCompareAbsolute(b.rawValue,this.value):a.ValueComparer.numberCompare(b.rawValue,this.value),Math.abs(d)<this.epsilon&&(d=0),c.prototype.matchOp.call(this,d)},d.prototype.toString=function(c){return a.stringFormat(this.absolute?c?b.Strings.Text_Cond_AbsnumCompare_Type_Fmt:b.Strings.Text_Cond_AbsnumCompare_Fmt:c?b.Strings.Text_Cond_NumCompare_Type_Fmt:b.Strings.Text_Cond_NumCompare_Fmt,{op:this.getOpStr(),value:this.value})},d.prototype.conditionDataType=function(){return b.DataType.Number},d.create=function(b){return a.extend(new d,[b])},d.prototype.toJSON=function(){var a=c.prototype.toJSON.call(this);return a._type=l,a.absolute=this.absolute||void 0,a.epsilon=this.epsilon!==h?this.epsilon:void 0,a},d}(w);b.NumericCompareCondition=B;var C=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.conditionDataType=function(){return b.DataType.String},d.prototype.toString=function(c){return c?b.Strings.Text_Cond_StrContains_Fmt:a.stringFormat(b.Strings.Text_Cond_StrContains_Type_Fmt,{value:this.value})},d.prototype.evaluate=function(a){var b=a.getFormatted(),c=this.value;return this.caseSens!==!0&&(b=b.toLowerCase(),c=c.toLowerCase()),b.indexOf(c)>=0},d.create=function(a){var b=new d;return b.value=a.value,b.caseSens=a.caseSens,b},d.prototype.validate=function(){if(!this.value)return b.Strings.Err_Cond_EmptyValue},d.prototype.toJSON=function(){var a=c.prototype.toJSON.call(this);return a._type=j,a.value=this.value,a.caseSens=this.caseSens||void 0,a},d}(u);b.StringContainsCondition=C;var D=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;return b.conditions=[],b}return __extends(c,a),c.prototype.evaluate=function(a){if(!this.conditions||0===this.conditions.length)return!1;for(var b=0;b<this.conditions.length;b++)if(!this.conditions[b].evaluate(a))return!1;return!0},c.prototype.toString=function(a){return this.conditions&&0!==this.conditions.length?this.conditions.map(function(b){return b.toString(a)}).join(b.Strings.Text_Cond_And):""},c.prototype.conditionDataType=function(){},c.create=function(a){var b=new c;return b.conditions=a,b},c.prototype.validate=function(){if(!this.conditions||this.conditions.length<1)return b.Strings.Err_Cond_LegCount},c.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);return b._type=n,b.conditions=this.conditions,b},c}(u);b.AndCondition=D;var E=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;return b.conditions=[],b}return __extends(c,a),c.prototype.evaluate=function(a){if(!this.conditions)return!1;for(var b=0;b<this.conditions.length;b++)if(this.conditions[b].evaluate(a))return!0;return!1},c.prototype.toString=function(a){return this.conditions&&0!==this.conditions.length?this.conditions.map(function(b){return b.toString(a)}).join(b.Strings.Text_Cond_Or):""},c.prototype.conditionDataType=function(){},c.create=function(a){var b=new c;return b.conditions=a,b},c.prototype.validate=function(){if(!this.conditions||this.conditions.length<1)return b.Strings.Err_Cond_LegCount},c.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);return b._type=o,b.conditions=this.conditions,b},c}(u);b.OrCondition=E;var F=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.evaluate=function(a){return!!this.condition&&!this.condition.evaluate(a)},c.prototype.toString=function(a){return this.condition?b.Strings.Text_Cond_Not+this.condition.toString(a):""},c.prototype.conditionDataType=function(){return this.condition.conditionDataType()},c.create=function(a){var b=new c;return b.condition=a,b},c.prototype.validate=function(){if(!this.condition)return b.Strings.Err_Cond_LegCount},c.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);return b._type=m,b.condition=this.condition,b},c}(u);b.NotCondition=F;var G=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.evaluate=function(a){return this.condition.evaluate(a)},c.prototype.validate=function(){return this.condition.validate()},c.prototype.conditionDataType=function(){return this.condition.conditionDataType()},c.prototype.toString=function(){return b.Strings.Text_Cond_In_Type_Fmt+" "+this.values.join(b.Strings.Array_Value_Separator)},c.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);return b.condition=this.condition,b.values=this.values,b},c}(u);b.InCondition=G;var H=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.create=function(a){var c=[];a.forEach(function(a){c.push(B.create({op:v.Equality,value:a,absolute:!1}))});var d=E.create(c),e=new b;return e.values=a,e.condition=d,e},b.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);return b._type=r,b},b}(G);b.NumericInCondition=H;var I=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.create=function(a,c){var d=[];a.forEach(function(a){d.push(A.create({op:v.Equality,value:a,context:c&&c.context}))});var e=E.create(d),f=new b;return f.values=a,f.condition=e,f},b.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);return b._type=s,b},b}(G);b.DateInCondition=I;var J=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.create=function(a){var c=[];a.forEach(function(a){c.push(y.create({op:v.Equality,value:a,caseSens:!0}))});var d=E.create(c),e=new b;return e.values=a,e.condition=d,e},b.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);return b._type=t,b},b}(G);b.StringInCondition=J;var K=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),Object.defineProperty(c.prototype,"min",{get:function(){return this._min},set:function(a){this._min=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"max",{get:function(){return this._max},set:function(a){this._max=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"minInclusive",{get:function(){return this._minI},set:function(a){this._minI=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"maxInclusive",{get:function(){return this._maxI},set:function(a){this._maxI=a,this._dirty=!0},enumerable:!0,configurable:!0}),c.prototype.evaluate=function(a){return!this._dirty&&this._underlying||(this._underlying=this.build(),this._dirty=!1),this._underlying.evaluate(a)},c.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);return b.min=this.min,b.max=this.max,b.minInclusive=this.minInclusive||void 0,b.maxInclusive=this.maxInclusive||void 0,b},c.prototype.validValue=function(a){return null!==a&&"undefined"!=typeof a},c.prototype.validate=function(){return this.validValue(this.min)?this.validValue(this.max)?void 0:b.Strings.Err_Cond_InvalidMaxVal:b.Strings.Err_Cond_InvalidMinVal},c}(u);b.RangeCondition=K;var L=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),Object.defineProperty(d.prototype,"absolute",{get:function(){return this._abs},set:function(a){this._abs=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"epsilon",{get:function(){return this._eps},set:function(a){this._eps=a,this._dirty=!0},enumerable:!0,configurable:!0}),d.prototype.build=function(){var a=this.validate();if(a)throw new Error(a);this.min=this.absolute?Math.abs(this.min):this.min,this.max=this.absolute?Math.abs(this.max):this.max;var b=new B;b.absolute=this.absolute,b.epsilon=this.epsilon||h,b.value=this.min,b.op=this.minInclusive?v.GreaterOrEqual:v.Greater;var c=new B;c.absolute=this.absolute,c.epsilon=this.epsilon||h,c.value=this.max,c.op=this.maxInclusive?v.LessOrEqual:v.Less;var d=new D;return d.conditions=[b,c],d},d.prototype.toString=function(c){return a.stringFormat(this.absolute?c?b.Strings.Text_Cond_AbsnumRange_Type_Fmt:b.Strings.Text_Cond_AbsnumRange_Fmt:c?b.Strings.Text_Cond_NumRange_Type_Fmt:b.Strings.Text_Cond_NumRange_Fmt,{v1:this.min,v2:this.max})},d.prototype.toJSON=function(){var a=c.prototype.toJSON.call(this);return a._type=p,a.absolute=this.absolute||void 0,a.epsilon=this.epsilon!==h?this.epsilon:void 0,a},d.prototype.conditionDataType=function(){return b.DataType.Number},d.prototype.validValue=function(a){return c.prototype.validValue.call(this,a)&&!isNaN(a)},d.prototype.validate=function(){var a=c.prototype.validate.call(this);if(!a){var d=this.absolute?Math.abs(this.min):this.min,e=this.absolute?Math.abs(this.max):this.max;e-d<=(this.epsilon||h)&&(a=b.Strings.Err_Cond_InvertedRange)}return a},d.create=function(b){return a.extend(new d,[b])},d}(K);b.NumericRangeCondition=L;var M=function(d){function f(){return null!==d&&d.apply(this,arguments)||this}return __extends(f,d),f.prototype.onContextChanged=function(){this._dirty=!0},Object.defineProperty(f.prototype,"dateOnly",{get:function(){return this._dateOnly},set:function(a){this._dateOnly=a,this._dirty=!0},enumerable:!0,configurable:!0}),f.prototype.validValue=function(a){return d.prototype.validValue.call(this,a)&&!!e(a,this.context)},f.prototype.validate=function(){var a=d.prototype.validate.call(this);return a||e(this.min,this.context)>e(this.max,this.context)&&(a=b.Strings.Err_Cond_InvertedRange),a},f.prototype.build=function(){var a=this.validate();if(a)throw new Error(a);var b=new A;b.value=this.min,b.op=this.minInclusive?v.GreaterOrEqual:v.Greater,b.dateOnly=this.dateOnly,b.context=this.context;var c=new A;c.value=this.max,c.op=this.maxInclusive?v.LessOrEqual:v.Less,c.dateOnly=this.dateOnly,c.context=this.context;var d=new D;return d.conditions=[b,c],d},f.prototype.toString=function(d){function e(a){return a?b.Strings.Text_Cond_Range_Inclusive:b.Strings.Text_Cond_Range_Exclusive}var f=a.module("ionwebGrids").getService("ionweb.dateFormattingService");return this.dateOnly?a.stringFormat(d?b.Strings.Text_Cond_DateRange_Type_Fmt:b.Strings.Text_Cond_DateRange_Fmt,{v1:"string"==typeof this.min?this.min:f.toShortDate(this.min),v2:"string"==typeof this.max?this.max:f.toShortDate(this.max),v1i:e(this.minInclusive),v2i:e(this.maxInclusive)}):a.stringFormat(d?b.Strings.Text_Cond_DateTimeRange_Type_Fmt:b.Strings.Text_Cond_DateTimeRange_Fmt,{v1:"string"==typeof this.min?this.min:c(f,this.min),v2:"string"==typeof this.max?this.max:c(f,this.max),v1i:e(this.minInclusive),v2i:e(this.maxInclusive)})},f.prototype.toJSON=function(){var a=d.prototype.toJSON.call(this);return a._type=q,a.dateOnly=this.dateOnly||void 0,a},f.prototype.conditionDataType=function(){return b.DataType.Date},f.create=function(b){return a.extend(new f,[b])},f}(K);b.DateRangeCondition=M,b.cloneCondition=f,b.deserializeCondition=g,b.conditionTypes=[null,b.StringCompareCondition.create({value:void 0,op:b.CompareOperator.Equality,caseSens:!1,mode:b.StringCompareMode.Ascii}),b.StringCompareCondition.create({value:void 0,op:b.CompareOperator.Inequality,caseSens:!1,mode:b.StringCompareMode.Ascii}),b.StringContainsCondition.create({value:void 0}),b.DateCompareCondition.create({value:void 0,op:b.CompareOperator.Equality,dateOnly:!0}),b.DateCompareCondition.create({value:void 0,op:b.CompareOperator.LessOrEqual,dateOnly:!0}),b.DateCompareCondition.create({value:void 0,op:b.CompareOperator.GreaterOrEqual,dateOnly:!0}),b.DateRangeCondition.create({min:void 0,max:void 0,dateOnly:!0}),b.NumericCompareCondition.create({value:void 0,op:b.CompareOperator.Greater}),b.NumericCompareCondition.create({value:void 0,op:b.CompareOperator.GreaterOrEqual}),b.NumericCompareCondition.create({value:void 0,op:b.CompareOperator.Less}),b.NumericCompareCondition.create({value:void 0,op:b.CompareOperator.LessOrEqual}),b.NumericCompareCondition.create({value:void 0,op:b.CompareOperator.Equality}),b.NumericCompareCondition.create({value:void 0,op:b.CompareOperator.Inequality}),b.NumericRangeCondition.create({min:void 0,max:void 0}),null,b.NumericCompareCondition.create({value:void 0,op:b.CompareOperator.Greater,absolute:!0}),b.NumericCompareCondition.create({value:void 0,op:b.CompareOperator.GreaterOrEqual,absolute:!0}),b.NumericCompareCondition.create({value:void 0,op:b.CompareOperator.Less,absolute:!0}),b.NumericCompareCondition.create({value:void 0,op:b.CompareOperator.LessOrEqual,absolute:!0}),b.NumericCompareCondition.create({value:void 0,op:b.CompareOperator.Equality,absolute:!0}),b.NumericCompareCondition.create({value:void 0,op:b.CompareOperator.Inequality,absolute:!0}),b.NumericRangeCondition.create({min:void 0,max:void 0,absolute:!0})]}(b=a.rules||(a.rules={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function a(a,b){this.style=b,this.condition=a}return Object.defineProperty(a.prototype,"condition",{get:function(){return this._condition},set:function(a){this._condition=a,this.onConditionSet()},enumerable:!0,configurable:!0}),a.prototype.onConditionSet=function(){},a}();b.Rule=c;var d=function(){function b(){this.color=null,this.backgroundColor=null}return b.deserialize=function(c){if(!c||"object"!=typeof c||Array.isArray(c))throw new Error("Object expected");var d=new b;return a.extend(d,[c])},b.clone=function(b){var c=a.clone(b);return c},b.prototype.toJSON=function(){var a=this,b={};return Object.getOwnPropertyNames(this).forEach(function(c){a[c]&&(!Array.isArray(a[c])||a[c].length>0)&&(b[c]=a[c])}),b},b}();b.PresentationStyle=d}(b=a.rules||(a.rules={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.None=0]="None",a[a.Row=1]="Row",a[a.Column=2]="Column",a[a.Cell=4]="Cell",a[a.Table=8]="Table",a[a.All=15]="All"}(b=a.GridSelectionType||(a.GridSelectionType={}));var c;!function(a){a[a.None=0]="None",a[a.Cell=1]="Cell",a[a.Row=2]="Row",a[a.Column=3]="Column",a[a.Table=4]="Table"}(c=a.GridRangeType||(a.GridRangeType={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){function c(a){return a&&"object"==typeof a&&a.getFormatted}function d(a){return c(a)?a:(z||(z=y.getPresentersWithFormatting().numericPresenter),a=z(a),c(a)?a:{getFormatted:function(){return"undefined"!=typeof a&&null!==a?a.toString():a},getStyle:function(a){return a||new i},rawValue:a})}b.RowMetadataProperty="__ionweb_row_metadata_property",b.PositiveNumericFormattingClass="ion-fmt-num",b.NegativeNumericFormattingClass="ion-fmt-num-neg";var e;!function(a){a[a.Normal=1]="Normal",a[a.Light=2]="Light",a[a.Bold=3]="Bold"}(e=b.FontWeight||(b.FontWeight={}));var f;!function(a){a[a.Left=1]="Left",a[a.Center=2]="Center",a[a.Right=3]="Right"}(f=b.TextAlign||(b.TextAlign={}));var g;!function(a){a[a.None=1]="None",a[a.Overline=2]="Overline",a[a.Underline=3]="Underline",a[a.LineThrough=4]="LineThrough"}(g=b.TextDecoration||(b.TextDecoration={}));var h;!function(a){a[a.Normal=1]="Normal",a[a.Italic=2]="Italic"}(h=b.TextStyle||(b.TextStyle={}));var i=function(b){function c(a){var c=b.call(this)||this;return c.fontWeight=null,c.textAlign=null,c.textDecoration=null,c.textStyle=null,c.classes=a&&a.slice()||[],c}return __extends(c,b),c.deserialize=function(b){if(!b||"object"!=typeof b||Array.isArray(b))throw new Error("Object expected");return a.extend(new c,[b])},c.mixin=function(a,b){return a?a.mixin(b):c.clone(b)},c.prototype.mixin=function(a){var b=this;if(a){var d=new c;return Object.keys(this).forEach(function(c){Array.isArray(b[c])?d[c]=b[c].concat(a[c].filter(function(a){return b[c].indexOf(a)<0})):d[c]=a[c]||b[c]}),d}return c.clone(this)},c.prototype.getClasses=function(){return this.classes},c.prototype.addClass=function(a){"string"==typeof a?this.classes.push(a):this.classes=this.classes.concat(a)},c.prototype.addClasses=function(a){var b=this;a.forEach(function(a){return b.classes.push(a)})},c.prototype.removeClass=function(a){"string"==typeof a?this.classes=this.classes.filter(function(b){return b!==a}):this.classes=this.classes.filter(function(b){return a.indexOf(b)<0})},c.prototype.removeClasses=function(a){this.classes=this.classes.filter(function(b){return!a.some(function(a){return b===a})})},c.prototype.toClassAttr=function(a){return void 0===a&&(a=!1),this.classes&&this.classes.length?a?this.classes.join(" "):'class="'+this.classes.join(" ")+'"':""},c.prototype.toStyleAttr=function(){var a=this.getStyle(),b=Object.keys(a).map(function(b){return b+": "+a[b]});return b.length?'style = "'+b.join("; ")+'"':""},c.prototype.getStyle=function(){var a,b={};if(this.color&&(b.color=this.color+" !important"),this.backgroundColor&&(b["background-color"]=this.backgroundColor+" !important"),this.fontWeight){switch(this.fontWeight){case e.Normal:a="normal";break;case e.Bold:a="bold";break;case e.Light:a="lighter"}b["font-weight"]=a}if(this.textAlign){switch(this.textAlign){case f.Center:a="center";break;case f.Left:a="left";break;case f.Right:a="right"}b["text-align"]=a}if(this.textDecoration){switch(this.textDecoration){case g.None:a="none";break;case g.Overline:a="overline";break;case g.Underline:a="underline";break;case g.LineThrough:a="line-through"}b["text-decoration"]=a}if(this.textStyle){switch(this.textStyle){case h.Normal:a="normal";break;case h.Italic:a="italic"}b["text-style"]=a}return b},c.clone=function(b){if(b){var d=a.clone(b);return d.classes=b.classes&&b.classes.slice()||[],d}return new c},c.prototype.toJSON=function(){var a=this,b={};return Object.getOwnPropertyNames(this).forEach(function(c){a[c]&&(!Array.isArray(a[c])||a[c].length>0)&&(b[c]=a[c])}),b},c}(a.rules.PresentationStyle);b.PresentationStyle=i;var j,k=new i([b.PositiveNumericFormattingClass]),l=new i([b.PositiveNumericFormattingClass,b.NegativeNumericFormattingClass]),m=new i(["ion-fmt-date"]);!function(a){a[a.Rendering=0]="Rendering",a[a.Export=1]="Export"}(j=b.PresentationContext||(b.PresentationContext={}));var n;!function(a){a[a.None=0]="None",a[a.Red=1]="Red",a[a.Braces=2]="Braces",a[a.RedAndBraces=3]="RedAndBraces"}(n=b.NegativeNumberFormat||(b.NegativeNumberFormat={}));var o;!function(a){a[a.Short=1]="Short",a[a.Long=2]="Long"}(o=b.DefaultDateFormat||(b.DefaultDateFormat={}));var p;!function(a){a[a.Short=1]="Short",a[a.Long=2]="Long"}(p=b.DefaultTimeFormat||(b.DefaultTimeFormat={}));var q;!function(a){a[a.Units=0]="Units",a[a.Thousands=3]="Thousands",a[a.Millions=6]="Millions",a[a.Billions=9]="Billions"}(q=b.NumberScaleFactor||(b.NumberScaleFactor={}));var r=function(){function b(){}return b.create=function(b,c,d,e){var f=a.getService("ionweb.numberFormattingService");"undefined"==typeof d&&(d=!0),"undefined"==typeof e&&(e=q.Units);var g=Math.pow(10,e),h={negativeBraces:d,thousandSeparator:c,decimalPlaces:b,scale:g},j=function(a){var b=f.parseNumber(a,h);if(void 0===b||b!==b)throw new Error("Invalid value");return b},m=function(a,b){return{getFormatted:function(){return b},getStyle:function(a){return a||new i},rawValue:a,parse:null,isNegative:!1,isNumeric:!1}},n=function(a){return{getFormatted:function(){return""},getStyle:function(a){return a||new i},rawValue:a,parse:function(a){return""===a?a:j(a)},isNegative:!1,isNumeric:!1}};return function(a){if("number"!=typeof a&&!(a instanceof Number))return"string"==typeof a?m(a,a):null==a?m(a,""):m(a,a.toString());if(a!==a)return n(a);var b=a<0;return{parse:function(a){return j(a)},getFormatted:function(){return f.getFormattedNumber(a,h)},getStyle:function(a){return i.mixin(a,b?l:k)},isNegative:b,isNumeric:!0,rawValue:a}}},b}();b.DefaultNumericPresenter=r;var s=function(){function b(){}return b.create=function(c){var d=b.formattingService||(b.formattingService=a.getService("ionweb.dateFormattingService"));c=c||y.DEFAULT_TIME_FORMAT;var e=function(a){var b=null;if("string"!=typeof c?c===p.Short?b=d.parseShortTime(a):c===p.Long&&(b=d.parseLongTime(a)):"string"==typeof c&&(b=d.parseDate(a,c)),!b)throw new Error("Invalid value");return b},f=function(a,b){return{getFormatted:function(){return b},getStyle:function(a){return a||new i},rawValue:a,parse:null}};return function(b){return b instanceof Date||b instanceof a.IsoTimeStamp?{parse:function(a){return e(a)},getFormatted:function(){var e="Invalid format",f=b instanceof a.IsoTimeStamp?b.getNormalizeDate():b;return"string"!=typeof c?c===p.Short?e=d.toShortTime(f):c===p.Long&&(e=d.toLongTime(f)):"string"==typeof c&&(e=d.toCustom(f,c)),e},getStyle:function(a){return i.mixin(a,m)},rawValue:b}:"string"==typeof b?f(b,b):b}},b}();b.DefaultTimePresenter=s;var t=function(){function b(){}return b.isTimeOnly=function(a){return a.getFullYear()<1900},b.create=function(c){var d=b.formattingService||(b.formattingService=a.getService("ionweb.dateFormattingService"));c=c||y.DEFAULT_DATE_FORMAT;var e=function(a){var b=null;if("string"!=typeof c?c===o.Short?b=d.parseShortDate(a):c===o.Long&&(b=d.parseLongDate(a)):"string"==typeof c&&(b=d.parseDate(a,c)),!b)throw new Error("Invalid value");return b},f=function(a,b){return{getFormatted:function(){return b},getStyle:function(a){return a||new i},rawValue:a,parse:null}};return function(b){return b instanceof Date||b instanceof a.IsoTimeStamp?{parse:function(a){return e(a)},getFormatted:function(){var e="Invalid format",f=b instanceof a.IsoTimeStamp?b.getNormalizeDate():b;return"string"!=typeof c?c===o.Short?e=d.toShortDate(f):c===o.Long&&(e=d.toLongDate(f)):"string"==typeof c&&(e=d.toCustom(f,c)),e},getStyle:function(a){return i.mixin(a,m)},rawValue:b}:"string"==typeof b?f(b,b):b}},b}();b.DefaultDatePresenter=t;var u=function(){function a(){}return a.create=function(a,b){var c=s.create(b),d=t.create(a),e=function(a){var b=d(a),e=c(a);return{parse:function(a){try{var c=b.parse(a),d=e.parse(a);return new Date(c.getFullYear(),c.getMonth(),c.getDate(),d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds())}catch(a){throw new Error("Invalid value")}},getFormatted:function(){var a=b.getFormatted(),c=e.getFormatted();return a+" "+c},getStyle:function(a){var c=b.getStyle(a),d=e.getStyle(a);return i.mixin(a,c).mixin(d)},rawValue:a}};return e},a}();b.DefaultDateTimePresenter=u;var v=function(a){function c(b){var c=a.call(this,b.getDataSet())||this;return c.sourceDataModel=b,c}return __extends(c,a),c.prototype.registerCellPresenter=function(a){this.presenter=a},c.prototype.raiseRangeUpdated=function(b){a.prototype.raiseRangeUpdated.call(this,b)},c.prototype.getValue=function(a,b){var c=this.sourceSet.getValue(a,b);return this.getPresentedValue(a,b,c)},c.prototype.getPresentedValue=function(a,b,c){return this.presenter?this.presenter(c,a,b):c},c.prototype.__getRow=function(a,c){var d=this,e=this.sourceSet.__getRow(a,c);if(this.presenter){var f={};if(e[b.RowMetadataProperty]&&(f[b.RowMetadataProperty]=e[b.RowMetadataProperty]),c)c.forEach(function(b){f[b]=d.presenter(e[b],a,b)});else{var g=this.sourceDataModel.getColumnAxis(),h=g.length();g.getSliceRange(0,h).forEach(function(b){var c=b.key();f[c]=d.presenter(e[c],a,c)})}return f}return e},c}(b.DataSetAdapter);b.PresentationDataSetAdapter=v;var w=function(){function a(){}return a.serialize=function(c,d){return b.PersistableStateHelper.serialize(a.tag,a.version,{formattingOptions:c,dataModelState:d})},a.load=function(c){var d=b.PersistableStateHelper.load(a.tag,a.version,c);if(!d)return null;var e=d.formattingOptions,f=d.dataModelState;return e||f?{state:e,dataModelState:f}:null},a.tag="__PresentationDataModelState",a.version=1,a}(),x=function(){function c(){this.rules=[],this.indexedColumnRules={}}return Object.defineProperty(c.prototype,"context",{get:function(){return this._context},set:function(a){var b=this;this._context=a,this.rules.forEach(function(a){return a.condition.context=b._context})},enumerable:!0,configurable:!0}),c.prototype.setRules=function(a){var b=this;this.rules=[],this.indexedColumnRules={},a&&(this.rules=a.filter(function(a){return b.registerRule(a)}))},c.prototype.getRules=function(){return this.rules},c.prototype.getStyleForCell=function(a,b,c){var d=this.indexedColumnRules&&this.indexedColumnRules[b];if(d&&c)for(var e=0;e<d.length;e++){var f=d[e];if(f.condition.evaluate(c))return f.style}return null},c.prototype.registerRule=function(a){var c=this;return!(!a.selection||a.selection.type!==b.GridRangeType.Column)&&(a.condition.context=this.context,a.selection.args.forEach(function(b){c.indexedColumnRules[b]||(c.indexedColumnRules[b]=[]),c.indexedColumnRules[b].push(a)}),!0)},c.prototype.getState=function(){return this.rules.map(function(a){return{selection:a.selection,condition:a.condition,style:a.style}})},c.prototype.setState=function(b){Array.isArray(b)&&this.setRules(b.map(function(b){return{selection:b.selection,condition:a.rules.deserializeCondition(b.condition),style:i.deserialize(b.style)}}))},c}();b.RuleMatcher=x;var y=function(d){function e(b){var c=d.call(this,b)||this;c.ruleMatcher=new x,c.onConditionalFormattingRulesChanged=new a.Event,c.onFormattingOptionsChanged=new a.Event,c.dataSet=new v(b),c.dataSet.registerCellPresenter(function(a,b,d){return c.cellPresenter(a,b,d)}),c._sourceDm.getColumnAxis().options.slicesEvent.add(c.handleSliceEvent,c);var e=a.getService("ionweb.dateFormattingService");c.preferenceChangedEventUnsubscriber=[],c.preferenceChangedEventUnsubscriber.push(e.preferenceChanged.add(function(){c.reloadGrid()}));var f=a.getService("ionweb.numberFormattingService");return c.preferenceChangedEventUnsubscriber.push(f.preferenceChanged.add(function(){c.reloadGrid()})),c.userColumnFormattingOptions={},c._useMeasures=c._sourceDm.getColumnAxis().options.getMeasures().length>0,c.formattingOptionsMap={table:null,rows:{},cols:{},rowMeasures:{},colMeasures:{}},c}return __extends(e,d),e.prototype.getLogTypeName=function(){return"PresentationDataModelAdapter"},e.prototype.dispose=function(a){this.preferenceChangedEventUnsubscriber.forEach(function(a){a()}),d.prototype.dispose.call(this,a);
},e.prototype.getPresentedValue=function(a,b,c){return this.dataSet.getPresentedValue(a,b,c)},e.prototype.getDataSet=function(){return this.dataSet},e.prototype.registerCellPresenter=function(a){this.userDefinePresenter=a},e.prototype.setDefaultFormattingOptions=function(a){if(!e.setDefaultFormatDeprecatedWarning){var b='PresentationDataModelAdapter: setDefaultFormattingOptions is deprecated, please use "setTableFormat" instead.';console.warn(b),e.setDefaultFormatDeprecatedWarning=!0}this.setTableFormat(a)},e.prototype.getDefaultFormattingOptions=function(){if(!e.getDefaultFormatDeprecatedWarning){var a='PresentationDataModelAdapter: getDefaultFormattingOptions is deprecated, please use "getTableFormat" instead.';console.warn(a),e.getDefaultFormatDeprecatedWarning=!0}return this.getTableFormat()},e.prototype.getColumnFormattingOptions=function(a){if(!e.getColumnFormatDeprecatedWarning){var b='PresentationDataModelAdapter: getColumnFormattinOptions is deprecated, please use "getColumnsFormat" instead.';console.warn(b),e.setColumnFormatDeprecatedWarning=!0}return this.__getColumnFormattingOptions(a)},e.prototype.__getColumnFormattingOptions=function(c){var d,e=this;switch(c.type){case b.GridRangeType.Cell:c.args.forEach(function(a){var b=e.columnAppliedFormattingOptions(a.columnKey);d=e.getMergedFormattingOptions(d,b)});break;case b.GridRangeType.Column:c.args.forEach(function(a){var b=e.columnAppliedFormattingOptions(a);d=e.getMergedFormattingOptions(d,b)});break;case b.GridRangeType.Row:d=this.getColumnFormattingOptionsForAllSlices(this._sourceDm.getColumnAxis().options.getVisibleRoot());break;case b.GridRangeType.Table:d=this.getColumnFormattingOptionsForAllSlices(this._sourceDm.getColumnAxis().options.getVisibleRoot())}return a.extendChildren({},[d])},e.prototype.getColumnFormattingOptionsBasedOnActiveCell=function(b){var c=this.columnAppliedFormattingOptions(b);return a.extendChildren({},[c])},e.prototype.setColumnFormattingOptions=function(a,b){if(!e.setColumnFormatDeprecatedWarning){var c='PresentationDataModelAdapter: setColumnFormattinOptions is deprecated, please use "setColumnsFormat" instead.';console.warn(c),e.setColumnFormatDeprecatedWarning=!0}this.__setColumnFormattingOptions(a,b)},e.prototype.__setColumnFormattingOptions=function(a,c){var d=this,e=[];switch(a.type){case b.GridRangeType.Cell:a.args.forEach(function(a){d.setOptionsForKey(c,d.__getFormattingOptionKey(a.columnKey)),a.columnKey&&e.indexOf(a.columnKey)===-1&&e.push(a.columnKey)});break;case b.GridRangeType.Column:a.args.forEach(function(a){d.setOptionsForKey(c,d.__getFormattingOptionKey(a))});break;case b.GridRangeType.Row:this.setFormattingOptionsForAllSlices(this.getColumnAxis().options.getVisibleRoot(),c);break;case b.GridRangeType.Table:this.setFormattingOptionsForAllSlices(this.getColumnAxis().options.getVisibleRoot(),c)}e.length>0?this.reloadGrid(e):this.reloadGrid(),this.onFormattingOptionsChanged.raise(this,{formattingOptions:this.userTableFormattingOptions,columnFormattingOptions:this.userColumnFormattingOptions})},e.prototype.setColumnFormattingOptionsBasedOnActiveCell=function(a,b){this.setOptionsForKey(b,this.__getFormattingOptionKey(a)),this.reloadGrid([a]),this.onFormattingOptionsChanged.raise(this,{formattingOptions:this.userTableFormattingOptions,columnFormattingOptions:this.userColumnFormattingOptions})},e.prototype.setUserTableFormattingOptions=function(a){this.userTableFormattingOptions=a,this._onFormattingChanged(),this.onFormattingOptionsChanged.raise(this,{formattingOptions:this.userTableFormattingOptions,columnFormattingOptions:this.userColumnFormattingOptions})},e.prototype.setTableFormat=function(a){this.formattingOptionsMap.table=a,this._onFormattingChanged()},e.prototype.setRowOnColumnPriority=function(a){this._isRowOnColumnPriority=a,this._onFormattingChanged()},e.prototype.isRowOnColumnPriority=function(){return this._isRowOnColumnPriority},e.prototype.setRowsFormat=function(a,b){var c=this;if(Object.keys(this.formattingOptionsMap.rowMeasures).length)throw new Error("Operation not supported: formatting options on row measures are already set");a.forEach(function(a){return c.formattingOptionsMap.rows[a]=b});var d=this.getColumnAxis().getSliceRange(0,this.getColumnAxis().length()).map(function(a){return a.key()}),e={rowKeys:a,columnKeys:d,noFlash:!0};this.dataSet.raiseRangeUpdated(e)},e.prototype.setColumnsFormat=function(a,b){var c=this;if(Object.keys(this.formattingOptionsMap.colMeasures).length)throw new Error("Operation not supported: formatting options on column measures are already set");var d;d=b.hasOwnProperty("formattingOptions")||b.hasOwnProperty("cellFormattingOptions")?b:{formattingOptions:b},a.forEach(function(a){return c.formattingOptionsMap.cols[a]=d}),this._onFormattingChanged()},e.prototype.setRowMeasuresFormat=function(a,b){var c=this;if(Object.keys(this.formattingOptionsMap.rows).length)throw new Error("Operation not supported: formatting options on rows are already set");a.forEach(function(a){return c.formattingOptionsMap.rowMeasures[a]=b}),this._onFormattingChanged()},e.prototype.setColumnMeasuresFormat=function(a,b){var c=this;if(Object.keys(this.formattingOptionsMap.colMeasures).length)throw new Error("Operation not supported: formatting options on columns are already set");var d;d=b.hasOwnProperty("formattingOptions")||b.hasOwnProperty("cellFormattingOptions")?b:{formattingOptions:b},a.forEach(function(a){return c.formattingOptionsMap.colMeasures[a]=d}),this._onFormattingChanged()},e.prototype.getTableFormat=function(){return a.extend({},[this.formattingOptionsMap.table])},e.prototype.getRowFormat=function(b){return a.extend({},[this.formattingOptionsMap.rows[b]])},e.prototype.getColumnFormat=function(b){var c=this.formattingOptionsMap.cols[b],d=c&&c.formattingOptions;return a.extend({},[d])},e.prototype.getRowMeasureFormat=function(b){return a.extend({},[this.formattingOptionsMap.rowMeasures[b]])},e.prototype.getColumnMeasureFormat=function(b){var c=this.formattingOptionsMap.colMeasures[b],d=c&&c.formattingOptions;return a.extend({},[d])},e.prototype.getColumnFormatting=function(b){return a.extend({},[this.formattingOptionsMap.cols[b]])},e.prototype.getState=function(){var a,b=this;this._sourceDm.getState&&(a=this._sourceDm.getState());var c={};return Object.keys(this.userColumnFormattingOptions).forEach(function(a){c[a]=b.userColumnFormattingOptions[a]}),w.serialize({formattingOptions:this.userTableFormattingOptions||void 0,columnFormattingOptions:c,formattingRules:this.ruleMatcher.getState()},a)},e.prototype.setState=function(a){var b=this,c=w.load(a);c&&(c.state&&(this.userTableFormattingOptions=c.state.formattingOptions),this.userColumnFormattingOptions={},c.state&&c.state.columnFormattingOptions&&Object.keys(c.state.columnFormattingOptions).forEach(function(a){b.userColumnFormattingOptions[a]=c.state.columnFormattingOptions[a]}),c.dataModelState&&this._sourceDm.setState&&this._sourceDm.setState(c.dataModelState),this.cleanColumnFormattingOptions(this._sourceDm.getColumnAxis()),c.state&&c.state.formattingRules&&this.ruleMatcher.setState(c.state.formattingRules))},e.prototype.getRowMeasureKey=function(a){var c=this.getRowAxis().getAs(b.PivotAxis),d=c&&c.contains(a)&&c.getNodeAndMeasureKey(a);return d&&d.measureKey},e.prototype.getColumnMeasureKey=function(a){var c=this.getColumnAxis().getAs(b.PivotAxis),d=c&&c.contains(a)&&c.getNodeAndMeasureKey(a);return d&&d.measureKey},e.prototype.getOptionsForKey=function(b,c){var d,f,g=Object.keys(this.formattingOptionsMap.rowMeasures).length;d=g?this.getRowMeasureFormat(this.getRowMeasureKey(b)):this.getRowFormat(b);var h=Object.keys(this.formattingOptionsMap.colMeasures).length;f=h?this.getColumnMeasureFormat(this.getColumnMeasureKey(c)):this.getColumnFormat(c);var i=this.userColumnFormattingOptions[this.__getFormattingOptionKey(c)];i&&e.mergeFormattingOptions(f,i);var j=a.extend({},[this.tableAppliedFormattingOptions()||{}]);return this.isRowOnColumnPriority()?(e.mergeFormattingOptions(j,f),e.mergeFormattingOptions(j,d)):(e.mergeFormattingOptions(j,d),e.mergeFormattingOptions(j,f)),j},e.prototype.tableAppliedFormattingOptions=function(){var a=e.getPresentersWithFormatting().formattingOptions;return e.mergeFormattingOptions(a,this.getTableFormat()),e.mergeFormattingOptions(a,this.userTableFormattingOptions),a},e.prototype.columnAppliedFormattingOptions=function(a){var b={};e.mergeFormattingOptions(b,this.tableAppliedFormattingOptions());var c=this.getColumnFormat(a);e.mergeFormattingOptions(b,c);var d=this.userColumnFormattingOptions[this.__getFormattingOptionKey(a)];return e.mergeFormattingOptions(b,d),b},e.prototype.setRules=function(a){this.ruleMatcher.setRules(a),this.onConditionalFormattingRulesChanged.raise(this,a),this._onFormattingChanged()},e.prototype.getRules=function(){return this.ruleMatcher.getRules()},Object.defineProperty(e.prototype,"ruleContext",{get:function(){return this.ruleMatcher.context},set:function(a){this.ruleMatcher.context=a,this._onFormattingChanged()},enumerable:!0,configurable:!0}),e.mergeFormattingOptions=function(a,b){b&&Object.keys(b).forEach(function(c){return a[c]=b[c]})},e.prototype.updateCellStyles=function(a){var b=[],c=[];a.forEach(function(a){b.push(a.columnKey),c.push(a.rowKey)}),this.dataSet.raiseRangeUpdated({columnKeys:b,rowKeys:c,noFlash:!0})},e.prototype.getPresentation=function(b,c){var d,f=e.getPresentersWithFormatting(c);if(b instanceof a.IsoTimeStamp)d=f.dateTimePresenter(b);else if(b instanceof Date){var g=b;d=t.isTimeOnly(g)?f.timePresenter(b):f.datePresenter(b)}else d=f.numericPresenter(b);return d},e.prototype.cellPresenter=function(a,b,d){var f,g=this.userDefinePresenter&&this.userDefinePresenter(a,b,d);if(c(g))f=g;else{var h,j,k=this.getOptionsForKey(b,d),l=this.userColumnFormattingOptions[this.__getFormattingOptionKey(d)],m=this.getColumnFormatting(d);if(!l&&m&&m.cellFormattingOptions){var n=m.cellFormattingOptions(b);0!==Object.keys(n).length&&n.constructor===Object&&e.mergeFormattingOptions(k,n)}h=this.getPresentation(a,k),h&&k.customPresenter&&(j=k.customPresenter(h,b,d)),j&&(j.getStyle||(j.getStyle=h.getStyle),j.parse||(j.parse=h.parse),null==j.rawValue&&(j.rawValue=h.rawValue),h=j),f=h}var o=d;this.useMeasures&&(o=this.getColumnMeasureKey(d));var p=this.ruleMatcher.getStyleForCell(b,o,f);if(p){var q=f.getStyle;f.getStyle=function(a){return i.mixin(q?q(a):a,p)}}return f},e.prototype.__getFormattingOptionKey=function(a){var b=this._sourceDm.getColumnAxis(),c=b.contains(a)&&b.getNodeAndMeasureKey(a);return c.measureKey?c.measureKey:a},e.getPresentersWithFormatting=function(b){b||(b={});var c=a.getService("ionweb.numberFormattingService"),d=c.getNumericFormats();return b={negativeFormat:"undefined"!=typeof b.negativeFormat?b.negativeFormat:n.Red|(d.negativeBraces?n.Braces:n.None),scaleFactor:"undefined"!=typeof b.scaleFactor?b.scaleFactor:e.DEFAULT_SCALE_FACTOR,decimalPlaces:"undefined"!=typeof b.decimalPlaces?b.decimalPlaces:d.decimalPlaces,dateFormat:"undefined"!=typeof b.dateFormat?b.dateFormat:e.DEFAULT_DATE_FORMAT},{formattingOptions:b,numericPresenter:r.create(b.decimalPlaces,void 0,b.negativeFormat===n.Braces||b.negativeFormat===n.RedAndBraces,b.scaleFactor),datePresenter:t.create(b.dateFormat),timePresenter:s.create(b.timeFormat),dateTimePresenter:u.create(b.dateFormat,b.timeFormat)}},e.prototype._onFormattingChanged=function(){this.dataSet.raiseRangeUpdated({isReset:!0})},e.prototype.reloadGrid=function(a){if(a&&0!==a.length&&this._sourceDm.getColumnAxis().contains(a[0]))if(this._useMeasures){for(var b=[],c=0;c<b.length;c++){var d=this._sourceDm.getColumnAxis().getNodeAndMeasureKey(a[c]);b=b.concat(this._sourceDm.getColumnAxis().getSlicesOfMeasure(d.measureKey))}this.reloadColumns(b)}else this.reloadColumns(a);else this.reloadColumns()},e.prototype.reloadColumns=function(a){var b=this,c=[];a?a.forEach(function(a){b.getColumnAxis().contains(a)&&c.push(b.getColumnAxis().getSlice(a))}):c=this.getColumnAxis().getSliceRange(0,this.getColumnAxis().length());var d=this.getRowAxis().getSliceRange(0,this.getRowAxis().length());this.dataSet.raiseRangeUpdated({noFlash:!0,columnKeys:c.map(function(a){return a.key()}),rowKeys:d.map(function(a){return a.key()})})},e.prototype.setFormattingOptionsForAllSlices=function(a,b){for(var c=this._sourceDm.getColumnAxis().options.getSliceKeys(a.key()),d=0;d<c.length;d++)this.setOptionsForKey(b,this.__getFormattingOptionKey(c[d]));if(c.length>0&&"undefined"==typeof this._sourceDm.getColumnAxis().getNodeAndMeasureKey(c[0]).measureKey){var e=a.children();if(e)for(var f=0;f<e.length;f++)this.setFormattingOptionsForAllSlices(e[f],b)}},e.prototype.getColumnFormattingOptionsForAllSlices=function(a){for(var b,c=this._sourceDm.getColumnAxis().options.getSliceKeys(a.key()),d=0;d<c.length;d++){var e=this.columnAppliedFormattingOptions(c[d]);b=this.getMergedFormattingOptions(b,e)}if(c.length>0&&"undefined"==typeof this._sourceDm.getColumnAxis().getNodeAndMeasureKey(c[0]).measureKey){var f=a.children();if(f)for(var g=0;g<f.length;g++)this.getMergedFormattingOptions(b,this.getColumnFormattingOptionsForAllSlices(f[g]))}return b},e.prototype.getMergedFormattingOptions=function(b,c){if(!b)return a.extendChildren({},[c]);var d=a.extendChildren({},[b]);return d.negativeFormat!==c.negativeFormat&&(d.isNegativeFormatMixed=!0),d.dateFormat!==c.dateFormat&&(d.isDateFormatMixed=!0),d.scaleFactor!==c.scaleFactor&&(d.isScaleFactorMixed=!0),d.decimalPlaces!==c.decimalPlaces&&(d.isDecimalPlacesMixed=!0),d},e.prototype.setOptionsForKey=function(a,b){var c=this.columnAppliedFormattingOptions(b);a?(a.isNegativeFormatMixed||"undefined"==typeof a.negativeFormat||null===a.negativeFormat||(c.negativeFormat=a.negativeFormat),a.isDecimalPlacesMixed||"undefined"==typeof a.decimalPlaces||null===a.decimalPlaces||(c.decimalPlaces=a.decimalPlaces),a.isScaleFactorMixed||"undefined"==typeof a.scaleFactor||null===a.scaleFactor||(c.scaleFactor=a.scaleFactor),a.isDateFormatMixed||"undefined"==typeof a.dateFormat||null===a.dateFormat||(c.dateFormat=a.dateFormat),c.customPresenter=a.customPresenter||c.customPresenter,this.userColumnFormattingOptions[b]=c):delete this.userColumnFormattingOptions[b]},e.prototype.handleSliceEvent=function(a,c){switch(c[0].type){case b.SliceEventType.SliceRemoved:case b.SliceEventType.Reset:case b.SliceEventType.SliceAdded:this.cleanColumnFormattingOptions(a)}},e.prototype.cleanColumnFormattingOptions=function(a){var b=this;a.length()&&this.userColumnFormattingOptions&&Object.keys(this.userColumnFormattingOptions).forEach(function(c){var d=a.getSlicesOfMeasure(c);if(!d||!d.length)try{var e=a.getSlice(c);e||delete b.userColumnFormattingOptions[c]}catch(a){}})},Object.defineProperty(e.prototype,"useMeasures",{get:function(){return this._useMeasures},enumerable:!0,configurable:!0}),e.DEFAULT_TIME_FORMAT=p.Short,e.DEFAULT_DATE_FORMAT=o.Short,e.DEFAULT_NEGATIVE_NUMBER=n.RedAndBraces,e.DEFAULT_SCALE_FACTOR=q.Units,e}(b.DataModelAdapter);b.PresentationDataModelAdapter=y;var z;b.getCellPresentation=d}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.None=0]="None",a[a.Sum=1]="Sum",a[a.Count=2]="Count",a[a.Average=3]="Average",a[a.Max=4]="Max",a[a.Min=5]="Min"}(c=b.GroupingSummaryType||(b.GroupingSummaryType={}));var d=function(){function a(){}return a.prototype.handleSummary=function(a){},a}();b.GroupingSummaryGroupCalculatorBase=d;var e=function(){function a(a){this.columnKey=a,this.isReset=!0,this.reset()}return a.prototype.reset=function(){this.addendum={},this.currentValue=0,this.isReset=!0},a.prototype.add=function(a,b){var c=a.getValue(b,this.columnKey);"number"!=typeof c&&(c=0),this.currentValue+=c;var d={newValue:this.currentValue,isChanged:0!==c||this.isReset};return this.addendum[b]=c,this.isReset=!1,d},a.prototype.remove=function(a){var b=this.addendum[a]||0;delete this.addendum[a],this.currentValue-=b;var c={newValue:this.currentValue,isChanged:0!==b||this.isReset};return this.isReset=!1,c},a.prototype.update=function(a,b){this.remove(b);var c=this.add(a,b),d={newValue:c.newValue,isChanged:!0};return d},a}(),f=function(b){function c(a){var c=b.call(this)||this;return c.sumCalc=new e(a),c.sumCalc.reset(),c}return __extends(c,b),c.prototype.handleSummary=function(b){switch(b.eventType){case a.tables.LeafItemEventType.Add:var c=this.sumCalc.add(b.dataSet,b.leafItemKey);b.newSummaryValue=c.newValue,b.isSummaryValueChanged=c.isChanged;break;case a.tables.LeafItemEventType.Remove:var d=this.sumCalc.remove(b.leafItemKey);b.newSummaryValue=d.newValue,b.isSummaryValueChanged=d.isChanged;break;case a.tables.LeafItemEventType.Update:var e=this.sumCalc.update(b.dataSet,b.leafItemKey);b.newSummaryValue=e.newValue,b.isSummaryValueChanged=e.isChanged}},c}(d);b.SummarySumInstanceCalculator=f;var g=function(b){function c(a){var c=b.call(this)||this;return c.count=0,c.sumCalc=new e(a),c.sumCalc.reset(),c}return __extends(c,b),c.prototype.computeAvg=function(a){return this.count<1?0:a/this.count},c.prototype.handleSummary=function(b){switch(b.isSummaryValueChanged=!0,b.eventType){case a.tables.LeafItemEventType.Add:this.count++;var c=this.sumCalc.add(b.dataSet,b.leafItemKey);b.newSummaryValue=this.computeAvg(c.newValue);break;case a.tables.LeafItemEventType.Remove:this.count--;var d=this.sumCalc.remove(b.leafItemKey);b.newSummaryValue=this.computeAvg(d.newValue);break;case a.tables.LeafItemEventType.Update:var e=this.sumCalc.update(b.dataSet,b.leafItemKey);b.newSummaryValue=this.computeAvg(e.newValue)}},c}(d);b.SummaryAverageInstanceCalculator=g;var h=function(b){function c(){var a=b.call(this)||this;return a.resetSummaries(),a}return __extends(c,b),c.prototype.resetSummaries=function(){this.currentValue=0},c.prototype.handleSummary=function(b){switch(b.eventType){case a.tables.LeafItemEventType.Add:this.currentValue++,b.newSummaryValue=this.currentValue,b.isSummaryValueChanged=!0;break;case a.tables.LeafItemEventType.Remove:this.currentValue--,b.newSummaryValue=this.currentValue,b.isSummaryValueChanged=!0;break;case a.tables.LeafItemEventType.Update:b.isSummaryValueChanged=!1}},c}(d);b.SummaryCountInstanceCalculator=h;var i=function(a){function c(b,c){var d=a.call(this)||this;return d.colKey=b,d.computeMax=c,d.values={},d}return __extends(c,a),c.prototype.handle=function(a){if(a.eventType===b.SummaryEventType.Reset)this.values={};else if(a.eventType===b.SummaryEventType.Remove)delete this.values[a.groupKey];else{var c=this.values[a.groupKey],d=!1;c||(c=0,this.values[a.groupKey]=c,a.updateArgs.newSummaryValue=0,d=!0);var e=a.updateArgs.dataSet.getValue(a.updateArgs.leafItemKey,this.colKey),f="number"==typeof e?e:0;this.computeMax&&f>c?(this.values[a.groupKey]=f,a.updateArgs.newSummaryValue=f,d=!0):!this.computeMax&&f<c&&(this.values[a.groupKey]=f,a.updateArgs.newSummaryValue=f,d=!0),a.updateArgs.isSummaryValueChanged=d}},c}(d),j=function(){function b(a){this.summaryGroupFactory=a,this.instances={}}return b.prototype.handleSummary=function(b){switch(b.eventType){case a.tables.SummaryEventType.Reset:this.instances={};break;case a.tables.SummaryEventType.Remove:delete this.instances[b.groupKey];break;case a.tables.SummaryEventType.Update:var c=this.instances[b.groupKey];c||(c=this.summaryGroupFactory(),this.instances[b.groupKey]=c),c.handleSummary(b.updateArgs)}},b}();b.GroupingSummaryCalculator=j;var k=function(){function a(){}return a.createSum=function(a){return new j(function(){return new f(a)})},a.createAverage=function(a){return new j(function(){return new g(a)})},a.createCount=function(){return new j(function(){return new h})},a.createMax=function(a){return new j(function(){return new i(a,!0)})},a.createMin=function(a){return new j(function(){return new i(a,!1)})},a}();b.GroupingSummaryCalculatorFactory=k}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(a){this.nullGroupFormattedValue=b.GroupingDataModel.NULL_GROUP_VALUE_DISPLAY_NAME,this.colKey=a.colKey,this.groupValueFormatter=a.groupValueFormatter,null!=a.nullGroupFormattedValue?this.nullGroupFormattedValue=a.nullGroupFormattedValue:this.nullGroupFormattedValue=b.GroupingDataModel.NULL_GROUP_VALUE_DISPLAY_NAME,null!=a.groupValueFormatter?this.groupValueFormatter=a.groupValueFormatter:this.groupValueFormatter=function(a,b,c,d){return b}}return c.prototype.getColumnKey=function(){return this.colKey},c.prototype.getRequiredColumns=function(){return[this.colKey]},c.prototype.shouldEvaluateUpdateEvent=function(a){return a.indexOf(this.colKey)>=0},c.prototype.formatAndLeadZero=function(a,b){var c=a+"";return c.length>=b?c:new Array(b-c.length+1).join("0")+a},c.prototype.createDateGroupId=function(a,b){var c=this.formatAndLeadZero(a.getHours(),2),d=this.formatAndLeadZero(a.getMinutes(),2),e=this.formatAndLeadZero(a.getSeconds(),2),f=this.formatAndLeadZero(a.getMilliseconds(),3),g=c+d+e+":"+f;if(b)return g;var h=this.formatAndLeadZero(a.getFullYear(),4),i=this.formatAndLeadZero(a.getMonth()+1,2),j=this.formatAndLeadZero(a.getDate(),1),k=h+i+j+"-"+g;return k},c.prototype.evaluate=function(c,d){var e,f=c.getValue(d,this.colKey),g=null;if(void 0===f||null===f)e={id:b.GroupingDataModel.NULL_GROUP_VALUE_KEY,displayValue:this.nullGroupFormattedValue,value:null};else if(""===f)g="",e={id:g,displayValue:this.groupValueFormatter(f,g,d,this.colKey),value:""};else if(f!==f)g=f.toString(),e={id:g,displayValue:this.groupValueFormatter(f,g,d,this.colKey),value:f};else if(0===f||"number"==typeof f){var h=f;g=h.toFixed(6);var i=this.groupValueFormatter(f,g,d,this.colKey);e={id:g,displayValue:i,value:f}}else if("boolean"==typeof f||"string"==typeof f)e={id:f.toString(),displayValue:this.groupValueFormatter(f,g,d,this.colKey),value:f};else if(f instanceof a.IsoTimeStamp){var j=f,k=j.getNormalizeDate();g=this.createDateGroupId(k,!1),e={id:g,displayValue:this.groupValueFormatter(f,g,d,this.colKey),value:f}}else if(f instanceof Date){var l=f,m=b.DefaultDatePresenter.isTimeOnly(l);g=this.createDateGroupId(l,m);var n=this.groupValueFormatter(f,g,d,this.colKey);e={id:g,displayValue:n,value:f}}else g=f.toString(),e={id:g,displayValue:this.groupValueFormatter(f,g,d,this.colKey),value:f};return e},c}();b.ColumnGroupValueProvider=c;var d=function(){function a(a,b){this.levels=a,this.grandTotalSummaryMap=b,a||(this.levels=[])}return a.prototype.getGrandTotalSummaryHandlers=function(){return this.grandTotalSummaryMap},a.prototype.getLevels=function(){return this.levels},a.prototype.evaluate=function(a,b){return this.levels.map(function(c){return c.valueProvider.evaluate(a,b)})},a.prototype.shouldEvaluateUpdateEvent=function(a){return this.levels.some(function(b){return b.valueProvider.shouldEvaluateUpdateEvent(a)})},a.prototype.getRequiredColumns=function(){var a={};return this.levels.forEach(function(b){var c=b.valueProvider.getRequiredColumns();c.forEach(function(b){return a[b]=!0})}),Object.keys(a)},a.EmptyDefinition=new a([],null),a}();b.GroupingDefinition=d;var e=function(){function a(a,c){var d=this;this.sourceDm=a,this.currentGroupingDefinition=null,this.unsubList=[],this.sourceRowCount=0;var e=c||{},h=this.sourceDm.getRowAxis();if(!(h instanceof b.FlatAxis))throw new Error("Grouping datamodel supports only FlatAxis on rows");this.sourceDataSet=this.sourceDm.getDataSet(),this.sourceAxis=this.sourceDm.getRowAxis(),this.unsubList.push(this.sourceDataSet.rangeUpdated.add(function(a,b){return d.handleCellUpdateEvent(b)})),this.unsubList.push(this.sourceAxis.options.slicesEvent.add(function(a,b){return d.handleAxisUpdateEvent(b)})),this.rowAxis=new g(this.sourceAxis,e.defaultNodeStatus,e.hideGrandTotal),this.dataSet=new f(this.sourceDataSet,this.sourceAxis);var i=function(a){var b=d.getActualGroupingDef().getRequiredColumns();b.forEach(function(b){a[b]=!0})};this.columnAxis=new b.PivotAxisRequiredSlicesAdapter(this.sourceDm.getColumnAxis(),i),this.setGroupingDef(e.groupingDefinition)}return a.prototype.getDataSet=function(){return this.dataSet},a.prototype.getRowAxis=function(){return this.rowAxis},a.prototype.getColumnAxis=function(){return this.columnAxis},a.prototype.restart=function(a){this.reset(),a&&(this.currentGroupingDefinition=a,this.sourceDm.getColumnAxis().options.refreshRequiredSlices()),this.addAllRows()},a.prototype.setGroupingDef=function(a){this.restart(a)},a.prototype.addAllRows=function(){var a=this,b=this.sourceDm.getRowAxis().getSliceRange(0,this.sourceAxis.length()).map(function(b){return a.sourceAxis.getNodeAndMeasureKey(b.key()).nodeKey});b.forEach(function(b){var c=a.computeGroupIds(b);a.processSourceRowAdd(b,c)})},a.prototype.getGroupingDef=function(){return this.currentGroupingDefinition},a.prototype.getActualGroupingDef=function(){return this.currentGroupingDefinition||d.EmptyDefinition},a.recursiveBinarySearch=function(b,c,d,e,f){if(0===f)return~e;var g=Math.floor(e+(f-1)/2),h=b[g],i=d(c,h);return 0===i?g:i<0?a.recursiveBinarySearch(b,c,d,e,g-e):a.recursiveBinarySearch(b,c,d,g+1,f-(g+1-e))},a.binarySearch=function(b,c,d){return 0===b.length?-1:a.recursiveBinarySearch(b,c,d,0,b.length)},a.prototype.getFirstLeaf=function(a){var b=a.children();return 0===b.length?a.key():this.getFirstLeaf(b[0])},a.prototype.addRow=function(c,d,e,f,g){var h=this,i=f?this.rowAxis.getNode(f):this.rowAxis.options.getVisibleRoot(),j=new b.TreeNode(c,e);j.setValue(d);var k=i.children().map(function(a){return h.getFirstLeaf(a)}),l=function(a,b){var c=h.sourceAxis.getSlice(a),d=h.sourceAxis.getSlice(b),e=c.index(),f=d.index();return e-f},m=a.binarySearch(k,g,l);if(m>=0)throw new Error("Failed in computing node position");return m=~m,this.rowAxis.options.insert(i,j,m),j},a.prototype.loadHierarchy=function(a,b){var c=this,d=null,e=null,f="|",g=null;return a.forEach(function(a){e=e?e+f+a.id:a.id,g=c.rowAxis.options.getTreeNode(e),g||(c.dataSet.addSummaryRow(e),g=c.addRow(e,a.value,a.displayValue,d,b)),d=e}),g},a.prototype.updateSummaryHierarchy=function(a,b,c,d){for(var e=[],f=b;f;)e.push(f),f=f.parent();for(var g=e.length-1,h=this.getActualGroupingDef().getLevels(),i=0;i<g;i++){var j=g-1-i,k=j<h.length?h[j]:null;k&&k.summaryHandlers&&this.updateSummaryRow(k.summaryHandlers,a,e[i],c,d)}var l=this.getActualGroupingDef().getGrandTotalSummaryHandlers();if(l){var m=e[g];this.updateSummaryRow(l,a,m,c,d)}},a.prototype.processSourceRowAdd=function(a,c){this.sourceRowCount++;var d=this.loadHierarchy(c,a);this.addRow(a,null,"",d.key(),a),this.updateSummaryHierarchy(a,d,b.LeafItemEventType.Add,null)},a.prototype.collectRemovedSummaries=function(a){for(var b=[],c=a.parent();1===c.length()&&c.parent();)b.push(c),c=c.parent();return b},a.prototype.processSourceRowRemove=function(a){var c=this;this.sourceRowCount--;var d=this.rowAxis.options.getTreeNode(a),e=this.collectRemovedSummaries(d),f=e.length>0?e[e.length-1].parent():d.parent();this.updateSummaryHierarchy(a,f,b.LeafItemEventType.Remove,null);for(var g=this.getActualGroupingDef().getLevels(),h=0;h<e.length;h++){var i=g.length-1-h>=0?g[g.length-1-h]:null;if(i&&i.summaryHandlers){var j=e[h];this.raiseRemoveSummaryEvent(i.summaryHandlers,j.key(),j.value())}}this.rowAxis.options.remove(d.parent(),d.key()),e.forEach(function(a){c.dataSet.removeSummaryRow(a.key()),c.rowAxis.options.remove(a.parent(),a.key())})},a.prototype.updateSummaryRow=function(a,c,d,e,f){var g=this,h={};Object.keys(a).forEach(function(i){var j=a[i];if(j){var k={eventType:b.SummaryEventType.Update,groupKey:d.key(),groupValue:d.value(),updateArgs:{dataSet:g.dataSet,leafItemKey:c,changedKeys:f,eventType:e}};j(k),k.updateArgs&&k.updateArgs.isSummaryValueChanged&&(h[i]=k.updateArgs.newSummaryValue)}}),this.dataSet.setSummaryValues(d.key(),h)},a.prototype.raiseResetSummaryEvent=function(a){a&&Object.keys(a).forEach(function(c){var d=a[c];if(d){var e={groupKey:null,groupValue:null,eventType:b.SummaryEventType.Reset};d(e)}})},a.prototype.raiseRemoveSummaryEvent=function(a,c,d){a&&Object.keys(a).forEach(function(e){var f=a[e];if(f){var g={eventType:b.SummaryEventType.Remove,groupKey:c,groupValue:d};f(g)}})},a.prototype.reset=function(){var a=this;this.sourceRowCount=0,this.getActualGroupingDef().getLevels().forEach(function(b){a.raiseResetSummaryEvent(b.summaryHandlers)});var b=this.getActualGroupingDef().getGrandTotalSummaryHandlers();this.raiseResetSummaryEvent(b);var c=this.rowAxis.options.getVisibleRoot(),d=c.children();this.rowAxis.options.removeBlock(c,0,d.length),this.dataSet.processReset()},a.prototype.collectAncestors=function(a){for(var b=[],c=a.parent();c;){var d=c.key();b.push(d),c=c.parent()}return b},a.prototype.verifyArray=function(a,b){if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0},a.prototype.processUpdate=function(a,c){var d=this.rowAxis.options.getTreeNode(a);if(d){var e=this.getActualGroupingDef(),f=e.shouldEvaluateUpdateEvent(c),g=!0;if(f){var h=this.computeGroupIds(a),i=this.collectAncestors(d),j=h.map(function(a){return a.id});g=this.verifyArray(i,j),g||(this.processSourceRowRemove(a),this.processSourceRowAdd(a,h))}g&&(this.dataSet.raiseLeafUpdate(a,c),this.updateSummaryHierarchy(a,d.parent(),b.LeafItemEventType.Update,c))}},a.prototype.handleCellUpdateEvent=function(a){var b=this;a.isReset?this.restart(null):a.rowKeys.forEach(function(c){return b.processUpdate(c,a.columnKeys)})},a.prototype.computeGroupIds=function(a){var c={id:b.GroupingDataModel.GRAND_TOTAL_KEY},d=[c],e=this.getActualGroupingDef().evaluate(this.dataSet,a);return e.forEach(function(a){return d.push(a)}),d},a.prototype.handleAxisUpdateEvent=function(a){var c=this;a.forEach(function(a){switch(a.type){case b.SliceEventType.Reset:c.reset();break;case b.SliceEventType.SliceMoved:c.restart(null);break;case b.SliceEventType.SliceAdded:a.args.keys.forEach(function(a){var b=c.computeGroupIds(a);c.processSourceRowAdd(a,b)});break;case b.SliceEventType.SliceRemoved:c.sourceRowCount===a.args.keys.length?c.reset():a.args.keys.forEach(function(a){return c.processSourceRowRemove(a)})}})},a.prototype.dispose=function(){this.unsubList.forEach(function(a){return a()}),this.unsubList=[],this.dataSet.dispose()},a}();b.GroupingProcessor=e;var f=function(b){function c(c,d){var e=b.call(this,c,!0)||this;return e.sourceDataSet=c,e.sourceAxis=d,e.summaryDataSet=new a.tables.ManualDataSet,e.summaryRows={},e}return __extends(c,b),c.prototype.getLogTypeName=function(){return"GroupingDataSetAdapter"},c.prototype.processReset=function(){this.summaryDataSet.clear(),this.summaryRows={};var a={isReset:!0};b.prototype.raiseRangeUpdated.call(this,a)},c.prototype.getValue=function(a,c){if(this.summaryRows[a])return this.summaryDataSet.getValue(a,c);var d=b.prototype.getValue.call(this,a,c);return d},c.prototype.__getRow=function(a,c){return this.summaryRows[a]?this.summaryDataSet.__getRow(a,c):b.prototype.__getRow.call(this,a,c)},c.prototype.addSummaryRow=function(a){this.summaryRows[a]=!0},c.prototype.removeSummaryRow=function(a){delete this.summaryRows[a]},c.prototype.setSummaryValues=function(a,c){var d=this;this.summaryRows[a]=!0;var e=Object.keys(c);if(e.length>0){e.forEach(function(b){var e=c[b];d.summaryDataSet.setValue(a,b,e)});var f={columnKeys:e,rowKeys:[a]};b.prototype.raiseRangeUpdated.call(this,f)}},c.prototype.raiseLeafUpdate=function(a,c){var d={columnKeys:c,rowKeys:[a]};b.prototype.raiseRangeUpdated.call(this,d)},c}(b.DataSetAdapter),g=function(a){function c(b,d,e){var f=a.call(this,c.createPivotAxisConfig(d,e))||this;return f.sourceAxis=b,f.enableLeavesCounter=!0,f}return __extends(c,a),c.createPivotAxisConfig=function(a,c){var d=new b.TreeNode(b.GroupingDataModel.GRAND_TOTAL_KEY,b.GroupingDataModel.GRAND_TOTAL_DISPLAY_NAME),e={mode:b.AxisViewMode.Normal,visibleLevelSummaries:[!c],root:d,defaultNodeStatus:a,neverShowSummaries:c};return e},c.prototype.getLogTypeName=function(){return"GroupingAxisAdapter"},c}(b.PivotAxis);b.GroupingAxisAdapter=g}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.Add=0]="Add",a[a.Remove=1]="Remove",
a[a.Update=2]="Update"}(c=b.LeafItemEventType||(b.LeafItemEventType={}));var d;!function(a){a[a.Remove=0]="Remove",a[a.Reset=1]="Reset",a[a.Update=2]="Update"}(d=b.SummaryEventType||(b.SummaryEventType={}));var e=function(c){function d(d,e){var f=c.call(this,d)||this;f.sourceDm=d,f.options=e,f._groupingChanged=new a.Event;var g={defaultNodeStatus:e&&e.defaultNodeStatus,groupingDefinition:null,hideGrandTotal:e&&e.hideGrandTotal};return f.groupingProcessor=new b.GroupingProcessor(d,g),e&&e.defaultGrouping&&f.setGroupedColumns(e.defaultGrouping),f}return __extends(d,c),d.prototype.getLogTypeName=function(){return"GroupingDataModel"},d.prototype.setGroupValueFormatter=function(a){this.groupValueFormatter=a,this.refreshGrouping()},d.prototype.raiseGroupingChanged=function(a){this._groupingChanged.raise(this,a)},Object.defineProperty(d.prototype,"groupingChanged",{get:function(){return this._groupingChanged},enumerable:!0,configurable:!0}),d.prototype.convertGroupingDefinition=function(a){var c=[];return a&&a.getLevels().forEach(function(a){if(a.valueProvider instanceof b.ColumnGroupValueProvider){var d=a.valueProvider,e={key:d.getColumnKey()};c.push(e)}}),c},d.prototype.createSummaryHandlers=function(a,b){var c=this,d={};return this.options&&this.options.summaries&&this.options.summaries.summaryColumnOptions&&Object.keys(this.options.summaries.summaryColumnOptions).forEach(function(e){var f=c.options.summaries.summaryColumnOptions[e],g={grouping:a,groupLevel:b,summaryType:f.summaryType};f&&f.summaryFactory&&f.summaryFactory(g),c.addSummaryHandler(d,e,g)}),d},d.prototype.addSummaryHandler=function(a,c,d){if(d.customCallback)a[c]=d.customCallback;else switch(d.summaryType){case b.GroupingSummaryType.Average:var e=b.GroupingSummaryCalculatorFactory.createAverage(c);a[c]=function(a){e.handleSummary(a)};break;case b.GroupingSummaryType.Sum:var f=b.GroupingSummaryCalculatorFactory.createSum(c);a[c]=function(a){f.handleSummary(a)};break;case b.GroupingSummaryType.Max:var g=b.GroupingSummaryCalculatorFactory.createMax(c);a[c]=function(a){g.handleSummary(a)};break;case b.GroupingSummaryType.Min:var h=b.GroupingSummaryCalculatorFactory.createMin(c);a[c]=function(a){h.handleSummary(a)};break;case b.GroupingSummaryType.Count:var i=b.GroupingSummaryCalculatorFactory.createCount();a[c]=function(a){i.handleSummary(a)};break;case b.GroupingSummaryType.None:}},d.prototype.createGroupingLevelDefinition=function(a,c){var d=this,e=function(a,b,c,e){return d.groupValueFormatter?d.groupValueFormatter(a,b,c,e):b},f={colKey:c.key,groupValueFormatter:e,nullGroupFormattedValue:this.options&&this.options.nullGroupFormattedValue},g=new b.ColumnGroupValueProvider(f),h={valueProvider:g,summaryHandlers:this.createSummaryHandlers(a,c)};return h},d.prototype.convertGroupedColumns=function(a){var c=this,d=this.createSummaryHandlers(a,null),e=a.map(function(b){return c.createGroupingLevelDefinition(a,b)}),f=new b.GroupingDefinition(e,d);return f},d.prototype.checkGroupingCompatibility=function(a){for(var b=this.getGroupedColumns(),c=0;a.length>c&&b.length>c&&a[c].key===b[c].key;)c++;return c-1},d.prototype.getGroupedColumns=function(){var a=this.groupingProcessor.getGroupingDef();return this.convertGroupingDefinition(a)},d.prototype.setGroupedColumns=function(a){var b=this.convertGroupedColumns(a),c=this.checkGroupingCompatibility(a),d=null;if(c>=0){var e=this.getRowAxis();d=e.getSerializableNodeState(c+1)}if(this.groupingProcessor.setGroupingDef(b),d){var e=this.getRowAxis();e.setSerializableNodeState(d)}this.raiseGroupingChanged(null)},d.prototype.refreshGrouping=function(){var a=this.getGroupedColumns();this.setGroupedColumns(a)},d.prototype.getState=function(){var a=this.getGroupedColumns().map(function(a){return a.key}),c=void 0;return this.sourceDm.getState&&(c=this.sourceDm.getState()),b.PersistableStateHelper.serialize(d._stateTag,d._stateVersion,{groupedColumns:a,sourceDataModelState:c})},d.prototype.setState=function(a){var c=this,e=b.PersistableStateHelper.load(d._stateTag,d._stateVersion,a);if(e){if(e.groupedColumns){var f=e.groupedColumns.filter(function(a){return!c.isGroupableCallback||c.isGroupableCallback(a)}).map(function(a){var b={key:a};return b});this.setGroupedColumns(f)}e.sourceDataModelState&&this._sourceDm.setState&&this.sourceDm.setState(e.sourceDataModelState)}else this.sourceDm.setState&&this.sourceDm.setState(a)},d.prototype.getDataSet=function(){return this.groupingProcessor.getDataSet()},d.prototype.getRowAxis=function(){return this.groupingProcessor.getRowAxis()},d.prototype.getColumnAxis=function(){return this.groupingProcessor.getColumnAxis()},d.prototype.getAs=function(a){return this instanceof a?this:this.sourceDm.getAs(a)},d.prototype.dispose=function(a){this.groupingProcessor&&(this.groupingProcessor.dispose(),this.groupingProcessor=null),c.prototype.dispose.call(this,a)},d.GRAND_TOTAL_KEY="<ROOT>",d.GRAND_TOTAL_DISPLAY_NAME="Grand total",d.NULL_GROUP_VALUE_KEY="__NULL_VALUE_GROUP__",d.NULL_GROUP_VALUE_DISPLAY_NAME="[Null]",d._stateTag="GroupingDataModelState",d._stateVersion=1,d.stateTag="GroupingDataModelState",d.stateVersion=1,d}(b.DataModelAdapter);b.GroupingDataModel=e}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;return c.validationStates={},c._stateUpdated=new a.Event,c._messageUpdated=new a.Event,c}return __extends(c,b),c.prototype.getLogTypeName=function(){return"ValidationDataSetAdapter"},Object.defineProperty(c.prototype,"stateUpdated",{get:function(){return this._stateUpdated},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"messageUpdated",{get:function(){return this._messageUpdated},enumerable:!0,configurable:!0}),c.prototype.setValidationState=function(b,c,d){var e=this.validationStates[b];e||(this.validationStates[b]=e={});var f=e[c]||{state:a.validation.ValidationState.Valid};d.state===a.validation.ValidationState.Valid||"undefined"==typeof d.state?(delete e[c],Object.keys(e).length||delete this.validationStates[b]):e[c]=d,d.state!==f.state?this._stateUpdated.raise(this,{rowKey:b,columnKey:c,state:d}):d.message===f.message||d.state!==a.validation.ValidationState.Error&&d.state!==a.validation.ValidationState.Success&&d.state!==a.validation.ValidationState.Warning||this._messageUpdated.raise(this,{rowKey:b,columnKey:c,message:d.message})},c.prototype.getValidationState=function(b,c){var d=this.validationStates[b],e={state:a.validation.ValidationState.Valid};return d&&d[c]&&(e=d[c]),e},c}(b.DataSetAdapter);b.ValidationDataSetAdapterBase=c;var d=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(c);b.ValidationDataSetAdapter=d;var e=function(b){function c(c,d){var e=b.call(this,c)||this;e.stateUpdated=new a.Event,e.messageUpdated=new a.Event;var f=new d(c.getDataSet());return b.prototype.setDataSet.call(e,f),f.stateUpdated.add(function(a,b){return e.stateUpdated.raise(e,b)}),f.messageUpdated.add(function(a,b){return e.messageUpdated.raise(e,b)}),e}return __extends(c,b),c.prototype.getLogTypeName=function(){return"ValidationDataModelAdapter"},c.prototype.getDataSet=function(){return b.prototype.getDataSet.call(this)},c.prototype.setValidationState=function(a,b,c){this.getDataSet().setValidationState(a,b,c)},c.prototype.getValidationState=function(a,b){return this.getDataSet().getValidationState(a,b)},c}(b.DataModelAdapter);b.ValidationDataModelAdapterBase=e;var f=function(a){function b(b){return a.call(this,b,d)||this}return __extends(b,a),b}(e);b.ValidationDataModelAdapter=f;var g=function(){function c(a,c,d){var f=this;this.dm=a,this.unsub=[],this.dms=b.getAll(a,e),this.dms.forEach(function(a){f.unsub.push(a.stateUpdated.add(function(a,b){c(b.rowKey,b.columnKey)})),f.unsub.push(a.messageUpdated.add(function(a,b){d(b.rowKey,b.columnKey)}))})}return c.hasValidation=function(a){return b.getAll(a,e).length>0},c.prototype.dispose=function(){this.unsub.forEach(function(a){return a()})},c.prototype.getValidationStates=function(b,c){return this.dms.map(function(a){return a.getValidationState(b,c)}).filter(function(b){return b.state!==a.validation.ValidationState.Valid}).sort(function(a,b){return a.state-b.state})},c}();b.ValidationDmWrapper=g}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){b.AUTO_EDIT_PREFERENCE_KEY="autoEdit",b.AUTO_EDIT_PREFERENCE_DEFAULT_VALUE=!1;var c;!function(a){a[a.None=0]="None",a[a.EditInProgress=1]="EditInProgress",a[a.EditOnSelection=2]="EditOnSelection",a[a.ReadyToCommit=3]="ReadyToCommit",a[a.OnTheWire=4]="OnTheWire",a[a.Error=5]="Error"}(c=b.EditCellStatus||(b.EditCellStatus={}));var d=function(){function a(a,b,d){this.rowKey=a,this.columnKey=b,this.sourceDataSet=d,this.error=null,this.status=c.None,this.userValue=null,this.userEnteredValue=null}return Object.defineProperty(a.prototype,"sourceValue",{get:function(){return this.sourceDataSet.getValue(this.rowKey,this.columnKey)},enumerable:!0,configurable:!0}),a}();b.EditCell=d;var e=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(b.ValidationDataSetAdapterBase);b.EditingValidationDataSetAdapter=e;var f=function(a){function b(b){return a.call(this,b,e)||this}return __extends(b,a),b.prototype.getDataSet=function(){return a.prototype.getDataSet.call(this)},b}(b.ValidationDataModelAdapterBase);b.EditingValidationDataModelAdapter=f;var g,h=function(e){function f(a,b,c,d,f,g,h){var i=e.call(this,a,!0)||this;if(i.sourceDataSet=a,i.validationDataModel=b,i.sourceColumnAxis=c,i.options=d,i.valueformatterCallback=f,i.logger=g,i.logId=h,i.editedCells={},i.editInProgressCells={},!d)throw new Error("options argument is null");return i.unsubUpdateEvent=a.rangeUpdated.add(function(a,b){return i.handleSourceEvent(b)}),i}return __extends(f,e),f.prototype.handleSourceEvent=function(a){e.prototype.raiseRangeUpdated.call(this,a)},f.prototype.traceSetStatus=function(a,b,d){var e=function(a){var b;return"number"==typeof b&&(b=c[b]),b||"Unknown"},f={id:this.logId,rowKey:a.rowKey,columnKey:a.columnKey,currentStatus:e(a.status),newStatus:e(b),message:d};this.logger.low("setEditingStatus",f)},f.prototype.resetCellStatus=function(a,b){this.traceSetStatus(a,c.None,b),a.status=c.None,a.error=null,this.updateValidationState(a.rowKey,a.columnKey)},f.prototype.createTooltipMessage=function(b){var c=this.computeVisibleValueForEditedCell(b),d=b.error,e=c.tooltipValue;if(e){var f=c.tooltipTextFormatString,g=a.stringFormat(f,{value:e});d+=" "+g}return d},f.prototype.updateValidationState=function(b,c,d){d&&d.state!==a.validation.ValidationState.Valid?this.validationDataModel.setValidationState(b,c,d):this.validationDataModel.setValidationState(b,c,{state:a.validation.ValidationState.Valid})},f.prototype.refreshValidationState=function(b){var d=a.validation.ValidationState.Valid;switch(b.status){case c.ReadyToCommit:d=a.validation.ValidationState.Success;break;case c.OnTheWire:d=a.validation.ValidationState.Warning;break;case c.Error:d=a.validation.ValidationState.Error}var e=this.createTooltipMessage(b);this.updateValidationState(b.rowKey,b.columnKey,{state:d,message:e})},f.prototype.setCellStatus=function(a,b,d){b!==c.None?(this.traceSetStatus(a,b,d),a.status=b,a.error=d,this.refreshValidationState(a)):this.resetCellStatus(a,d)},f.prototype.getVisibleCellStatus=function(a,b){var d=c.None;if(this.containsCell(a,b,this.editInProgressCells)){var e=this.loadEditCell(a,b,this.editInProgressCells);d=e.status}else if(this.containsCell(a,b,this.editedCells)){var f=this.loadEditCell(a,b,this.editedCells);d=f.status}return d},f.prototype.getEditedCellStatus=function(a,b){var d=c.None;if(this.containsCell(a,b,this.editedCells)){var e=this.loadEditCell(a,b,this.editedCells);d=e.status}return d},f.prototype.getAs=function(a){return this instanceof a?this:this.sourceDataSet.getAs(a)},f.prototype.computeVisibleValueForEditedCell=function(a){switch(a.status){case c.ReadyToCommit:return{cellValue:a.userValue,tooltipValue:this.valueformatterCallback(a.rowKey,a.columnKey,a.sourceValue),tooltipTextFormatString:b.Strings.Text_Grid_Editing_CurrentValue};case c.OnTheWire:case c.Error:case c.None:default:return{cellValue:a.sourceValue,tooltipValue:this.valueformatterCallback(a.rowKey,a.columnKey,a.userEnteredValue),tooltipTextFormatString:b.Strings.Text_Grid_Editing_EnteredValue}}},f.prototype.computeVisibleValue=function(a,d){if(this.containsCell(a,d,this.editInProgressCells)){var e=this.loadEditCell(a,d,this.editInProgressCells);return e.status===c.EditInProgress?{cellValue:e.userValue,tooltipValue:this.valueformatterCallback(a,d,e.sourceValue),tooltipTextFormatString:b.Strings.Text_Grid_Editing_CurrentValue}:{cellValue:e.userEnteredValue,tooltipValue:null,tooltipTextFormatString:""}}if(this.containsCell(a,d,this.editedCells)){var f=this.loadEditCell(a,d,this.editedCells);return this.computeVisibleValueForEditedCell(f)}return{cellValue:this.sourceDataSet.getValue(a,d),tooltipValue:null,tooltipTextFormatString:""}},f.prototype.getVisibleCellValue=function(a,b){var c=this.computeVisibleValue(a,b);return c.cellValue},f.prototype.getValue=function(a,b){return this.getVisibleCellValue(a,b)},f.prototype.__getRow=function(b,c){var d=this,f=e.prototype.__getRow.call(this,b,c),g=this.editInProgressCells[b],h=this.editedCells[b];if(h||g){var i=a.clone(f),j={};return g&&Object.keys(g).forEach(function(a){j[a]=!0}),h&&Object.keys(h).forEach(function(a){j[a]=!0}),Object.keys(j).forEach(function(a){d.sourceColumnAxis.contains(a)&&(i[a]=d.getVisibleCellValue(b,a))}),i}return f},f.prototype.containsRow=function(a,b){return!!b[a]},f.prototype.containsCell=function(a,b,c){return!(!c[a]||!c[a][b])},f.prototype.getCells=function(a){var b=[];return Object.keys(a).forEach(function(c){var d=a[c];Object.keys(d).forEach(function(a){var c=d[a];b.push(c)})}),b},f.prototype.loadEditRow=function(a,b){var c=b[a];return c||(c={},b[a]=c),c},f.prototype.createEditCell=function(a,b){var f=e.prototype.getValue.call(this,a,b),g=new d(a,b,this.sourceDataSet);return g.userEnteredValue=null,g.userValue=f,g.status=c.None,g},f.prototype.loadEditCell=function(a,b,c){var d=this.loadEditRow(a,c),e=d[b];return e||(e=this.createEditCell(a,b),d[b]=e),e},f.prototype.sendCellUpdate=function(a,b){var c={rowKeys:[a],columnKeys:[b],noFlash:!0};e.prototype.raiseRangeUpdated.call(this,c)},f.prototype.sendCellRangeUpdate=function(a,b){var c={rowKeys:a,columnKeys:[b],noFlash:!0};e.prototype.raiseRangeUpdated.call(this,c)},f.prototype.updateEnteredValue=function(a){var b=null,d=[],e=this.getCells(this.editInProgressCells);e.forEach(function(e){e.status===c.EditOnSelection&&(e.userEnteredValue=a,b=e.columnKey,d.push(e.rowKey))}),b&&this.sendCellRangeUpdate(d,b)},f.prototype.startEdit=function(a,b,d,e){var f=this,g=[a],h=this.loadEditCell(a,b,this.editInProgressCells);h.status=c.EditInProgress,h.userEnteredValue=d,e&&e.forEach(function(a){var e=f.loadEditCell(a,b,f.editInProgressCells);e.status=c.EditOnSelection,e.userEnteredValue=d,g.push(a)}),this.updateValidationState(a,b),this.sendCellRangeUpdate(g,b)},f.prototype.cancelEdit=function(){var a=this,b=this.getCells(this.editInProgressCells);this.editInProgressCells={},b.forEach(function(b){if(a.containsCell(b.rowKey,b.columnKey,a.editedCells)){var c=a.loadEditCell(b.rowKey,b.columnKey,a.editedCells);a.refreshValidationState(c)}a.sendCellUpdate(b.rowKey,b.columnKey)})},f.prototype.clearCell=function(a,b,c,d,e){var f=c[a];if(f){var g=f[b];g&&(this.resetCellStatus(g,e),delete f[b],0===Object.keys(g).length&&delete c[a],d&&this.sendCellUpdate(a,b))}},f.prototype.clear=function(){this.editInProgressCells={},this.editedCells={};var a={isReset:!0};this.raiseRangeUpdated(a)},f.prototype.processEndEditOperation=function(a,b,c,d){var e=this,f=this.getCells(this.editInProgressCells);this.editInProgressCells={},f.forEach(function(a){var b=e.loadEditCell(a.rowKey,a.columnKey,e.editedCells);b.userEnteredValue=c}),this.processValue(a,b,c,d,f)},f.prototype.processEnteredValue=function(a,b,c,d,e){var f=this,g=this.loadEditCell(a,b,this.editedCells);g.userEnteredValue=c;var h=[g];e&&e.length>0&&e.forEach(function(a){var c=f.createEditCell(a,b);h.push(c)}),this.processValue(a,b,c,d,h)},f.prototype.processValue=function(a,b,c,d,e){var f=this,g=d;if(this.options.validator){var h={rowKey:a,columnKey:b,enteredValue:c,result:d};this.options.validator(h),g=h.result}if(g&&g.error)return void e.forEach(function(a){f.setError(a.rowKey,a.columnKey,g.error)});var i=g?g.value:c;this.processValidatedValue(a,b,e,i,c)},f.prototype.processValidatedValue=function(a,d,e,f,g){var h=this,i=this.options.postValidator?this.options.postValidator(a,d):null,j=i&&i.deferCommit,k=i&&i.message||b.Strings.Text_Grid_Editing_ReadyToCommit;e.forEach(function(b){var e=h.loadEditCell(b.rowKey,b.columnKey,h.editedCells),i=!1;if(e.status===c.OnTheWire)i=!0;else{var l=e.sourceValue;l===f?(i=!1,h.clearCell(b.rowKey,b.columnKey,h.editedCells,!0,"The entered value is equal to the source value")):i=!0}i&&(e.userValue=f,e.userEnteredValue=g,j?(h.setCellStatus(e,c.ReadyToCommit,k),h.sendCellUpdate(a,d)):h.commitCell(e.rowKey,e.columnKey))})},f.prototype.processCommit=function(a){var d=this;if(this.options.committer){var e=a.map(function(a){var b={rowKey:a.rowKey,columnKey:a.columnKey,value:a.userValue};return b});this.options.committer(e);var f=e.map(function(a){var e=a.rowKey,f=a.columnKey;if(a.transaction){var g=a.message||b.Strings.Text_Grid_Editing_TransactionInProgress,h=d.loadEditCell(e,f,d.editedCells);return d.setCellStatus(h,c.OnTheWire,g),d.sendCellUpdate(e,f),a.transaction.then(function(){d.clearCell(e,f,d.editedCells,!0,"Async transaction completed")},function(a){a&&"string"==typeof a.message?d.setError(e,f,a.message):"string"==typeof a?d.setError(e,f,a):d.setError(e,f,"Error")})}return d.clearCell(e,f,d.editedCells,!0,"Commit completed"),null}).filter(function(a){return!!a});return Q.all(f).then(function(){return null})}return a.forEach(function(a){d.clearCell(a.rowKey,a.columnKey,d.editedCells,!0,"No committer")}),Q.when(null)},f.prototype.commitCells=function(a){var b,d=this;return b=a?a.filter(function(a){return d.getEditedCellStatus(a.rowKey,a.columnKey)===c.ReadyToCommit}).map(function(a){return d.loadEditCell(a.rowKey,a.columnKey,d.editedCells)}):this.getEditedCellsByStatus(c.ReadyToCommit),this.processCommit(b)},f.prototype.commitCell=function(a,b){if(this.containsCell(a,b,this.editedCells)){var c=this.loadEditCell(a,b,this.editedCells);return this.processCommit([c])}return Q.when(null)},f.prototype.setError=function(a,b,d){var e=this.loadEditCell(a,b,this.editedCells);this.setCellStatus(e,c.Error,d),this.sendCellUpdate(a,b)},f.prototype.setEnteredValueError=function(a,b,d,e){var f=this.loadEditCell(a,b,this.editedCells);f.userEnteredValue=e,this.setCellStatus(f,c.Error,d),this.sendCellUpdate(a,b)},f.prototype.getEditedCellsByStatus=function(a){var b=this,c=[];return Object.keys(this.editedCells).forEach(function(d){var e=b.editedCells[d];Object.keys(e).forEach(function(b){var d=e[b];d.status===a&&c.push(d)})}),c},f.prototype.clearErrors=function(){var a=this,b=this.getEditedCellsByStatus(c.Error);b.forEach(function(b){a.clearCell(b.rowKey,b.columnKey,a.editedCells,!0,"Clear errors")})},f.prototype.dispose=function(){this.unsubUpdateEvent&&this.unsubUpdateEvent(),e.prototype.dispose.call(this)},f}(a.tables.DataSetAdapter);!function(a){a[a.None=0]="None",a[a.Enter=1]="Enter",a[a.Tab=2]="Tab",a[a.Blur=3]="Blur",a[a.Esc=4]="Esc",a[a.Api=5]="Api",a[a.EditStarting=6]="EditStarting",a[a.ControllerNotInitialized=7]="ControllerNotInitialized",a[a.RowRender=8]="RowRender",a[a.RowUnrender=9]="RowUnrender"}(g=b.EditCompleteReason||(b.EditCompleteReason={}));var i;!function(a){a[a.None=0]="None",a[a.F2=1]="F2",a[a.Click=2]="Click",a[a.Api=3]="Api",a[a.AutoStart=4]="AutoStart"}(i=b.EditStartReason||(b.EditStartReason={}));var j=function(a){function d(b,c,d){var e=this,g=new f(b);if(e=a.call(this,g)||this,!c)throw new Error("options argument is null");e.sourceDm=g,e.options=c;var i=function(a,b,c){return e.valueformatterCallback?e.valueformatterCallback(a,b,c):c};return e.dataSet=new h(g.getDataSet(),g,e.sourceDm.getColumnAxis(),c,i,d,e.getLogId()),e}return __extends(d,a),d.escapeKeyForJQuery=function(a){var b=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,c=function(a,b){return b?"\0"===a?"ï¿½":a.slice(0,-1)+"\\"+a.charCodeAt(a.length-1).toString(16)+" ":"\\"+a};return(a+"").replace(b,c)},d.prototype.getLogTypeName=function(){return"EditingDataModel"},d.prototype.getState=function(){var a=void 0;return this.sourceDm.getState&&(a=this.sourceDm.getState()),b.PersistableStateHelper.serialize(d.stateTag,d.stateVersion,{sourceDataModelState:a})},d.prototype.setState=function(a){var c=b.PersistableStateHelper.load(d.stateTag,d.stateVersion,a);c?c.sourceDataModelState&&this.sourceDm.setState&&this.sourceDm.setState(c.sourceDataModelState):this.sourceDm.setState&&this.sourceDm.setState(a)},d.prototype.getDataSet=function(){return this.dataSet},d.prototype.getRowAxis=function(){return this.sourceDm.getRowAxis()},d.prototype.getColumnAxis=function(){return this.sourceDm.getColumnAxis()},d.prototype.shouldStartEdit=function(a,b){var c=this.getCellEditor(a,b);return this.options.startEdit&&(c=this.options.startEdit(a,b)),c},d.prototype.getCellEditor=function(a,b){if(this.options.columnOptions){var c=this.options.columnOptions[b],d=c&&c.editor;return d}return null},d.prototype.getColumnEditors=function(){var a=this;if(this.options.columnOptions){var b={};return Object.keys(this.options.columnOptions).forEach(function(c){var d=a.options.columnOptions[c];d&&d.editor&&(b[c]=d.editor)}),b}return null},d.prototype.startEdit=function(a,b,c,d){this.dataSet.startEdit(a,b,c,d)},d.prototype.processEnteredValue=function(a,b,c,d,e){this.dataSet.processEnteredValue(a,b,c,e,d)},d.prototype.updateEnteredValue=function(a){this.dataSet.updateEnteredValue(a)},d.prototype.cancelEdit=function(){this.dataSet.cancelEdit()},d.prototype.processEndEditOperation=function(a,b,c,d){this.dataSet.processEndEditOperation(a,b,c,d)},d.prototype.commitCell=function(a,b){return this.dataSet.commitCell(a,b)},d.prototype.commitCells=function(a){return this.dataSet.commitCells(a)},d.prototype.getEditedCellsByStatus=function(a){var b=this.dataSet.getEditedCellsByStatus(a);return b.map(function(a){return{rowKey:a.rowKey,columnKey:a.columnKey}})},d.prototype.getVisibleCellStatus=function(a,b){return this.dataSet?this.dataSet.getVisibleCellStatus(a,b):c.None},d.prototype.getEditedCellStatus=function(a,b){return this.dataSet.getEditedCellStatus(a,b)},d.prototype.setError=function(a,b,c){this.dataSet.setError(a,b,c)},d.prototype.setEnteredValueError=function(a,b,c,d){this.dataSet.setEnteredValueError(a,b,c,d)},d.prototype.clearErrors=function(){this.dataSet.clearErrors()},d.prototype.dispose=function(b){this.dataSet&&(this.dataSet.dispose(),this.dataSet=null),b?a.prototype.dispose.call(this,b):this.sourceDm.dispose(!1)},d.stateTag="EditingDataModelState",d.stateVersion=1,d}(a.tables.DataModelAdapter);b.EditingDataModel=j}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function a(a){var b=this;this.mapping=null,a&&(this.mapping={},a.visibleKeys.forEach(function(c){var d=null;a.groups&&(d=a.groups[c]),d?d.groupDef.groupedKeys.forEach(function(a){return b.mapping[a]=c}):b.mapping[c]=c}))}return a.prototype.getTargetKey=function(a){return this.mapping?this.mapping[a]:a},a}();b.ColumnMapping=c;var d=function(a){function d(b){var c=a.call(this,b,!0)||this;return c.sourceDataSet=b,c.unsubUpdateEvent=c.sourceDataSet.rangeUpdated.add(function(a,b){return c.handleSourceEvent(b)}),c}return __extends(d,a),d.prototype.getLogTypeName=function(){return"ResponsiveDataSetAdapter"},d.prototype.setConfiguration=function(a){this.columnMapping=a?new c(a):null,this.conf=a},d.prototype.getGridColumnKey=function(a){var b=this.columnMapping?this.columnMapping.getTargetKey(a):a;return b},d.prototype.handleSourceEvent=function(b){var c=this;if(b.isReset)a.prototype.raiseRangeUpdated.call(this,b);else{var d=b.columnKeys.reduce(function(a,b){var d=c.columnMapping?c.columnMapping.getTargetKey(b):b;return d&&(a[d]=!0),a},{}),e=Object.keys(d);b.columnKeys.length&&!e.length||a.prototype.raiseRangeUpdated.call(this,{columnKeys:e,rowKeys:b.rowKeys,noFlash:b.noFlash})}},d.prototype.prepareValue=function(a,c,d){var e=this.conf&&this.conf.groups[c];if(!e)return d[c];var f=[];e.groupDef.groupedKeys.forEach(function(a){var b=d[a];f.push(b)});var g=this.predefinedFormatFunctorProvider&&this.predefinedFormatFunctorProvider(f,a,e),h={getFormatted:g,getStyle:function(a){var c=b.PresentationStyle.clone(a);return c},rawValue:f,group:e},i=this.applicationPresentationFunctorProvider&&this.applicationPresentationFunctorProvider(h,a,e);return i||h},d.prototype.collectSourceColumns=function(a){var b=this;if(!this.conf)return a;var c={};return a.forEach(function(a){var d=b.conf.groups[a];d?d.groupDef.groupedKeys.forEach(function(a){c[a]=!0}):c[a]=!0}),Object.keys(c)},d.prototype.__getRow=function(b,c){var d=this,e=c?this.collectSourceColumns(c):null,f=a.prototype.__getRow.call(this,b,e);if(this.conf){var g={},h=c||this.conf.visibleKeys;return h.forEach(function(a){g[a]=d.prepareValue(b,a,f)}),g}return f},d.prototype.getValue=function(b,c){var d=a.prototype.__getRow.call(this,b);if(this.conf){var e=this.prepareValue(b,c,d);return e}return a.prototype.getValue.call(this,b,c)},d.prototype.dispose=function(){this.unsubUpdateEvent&&this.unsubUpdateEvent(),a.prototype.dispose.call(this)},d}(a.tables.DataSetAdapter);b.ResponsiveDataSetAdapter=d;var e=function(a){function c(c,d){var e=a.call(this,null)||this;e.sourceAxis=c,e.responsiveDataSet=d,e.groupAliases={},e.innerSliceManagerAxis=c.getAs(b.SliceManagerAxisAdapter);var f=e.options.setAlias;e.options.setAlias=function(a,b){var c=[];a.forEach(function(a){e.sourceAxis.contains(a.nodeKey)?c.push(a):e.groupAliases[a.nodeKey]=a.alias});var d=f(a,b);return e.sourceAxis.options.setAlias(c,b),d};var g=e,h=function(){if(g.conf){var a=g.userOrder||g.conf.visibleKeys,c=g.getSliceRange(0,g.length()),d=c.map(function(a){return{nodeKey:a.key(),alias:a.alias,displayName:a.displayName,category:a.category,description:a.description}});return b.SliceManagerAxisAdapter.collectFilterVisibleSlices(d,a,null)}return e.innerSliceManagerAxis.options.getFilterVisibleSlices()},i=function(a){g.conf?(g.userOrder=a.filter(function(a){return a.checked}).map(function(a){return a.key}),g.reset(),g.syncronizeSourceVisibleSlices(a)):g.innerSliceManagerAxis.options.setFilterVisibleSlices(a)};return e.options.getFilterVisibleSlices=h,e.options.setFilterVisibleSlices=i,e.reset(),e.unsubEvent=c.options.slicesEvent.add(function(a,b){return e.handleSourceEvent(b)}),e}return __extends(c,a),c.prototype.getLogTypeName=function(){return"ResponsiveAxisAdapter"},c.prototype.handleSourceEvent=function(a){this.conf||this.reset()},c.forceAdiacentSlices=function(a,b,c){var d=[],e=function(a){for(var c=0;c<b.length;c++)if(b[c].key===a){d.push(b[c]),b.splice(c,1);break}};a.forEach(function(a){var b=c&&c[a];b?b.groupDef.groupedKeys.forEach(function(a){e(a)}):e(a)});var f=d.concat(b);return f},c.prototype.setConfiguration=function(a){this.conf=a;var b=!1;if(a){var c=a.visibleKeys,d=this.getSliceRange(0,this.length()).map(function(a){return a.key()}),e=f.compareUnorderedStringArrays(d,c);e||(b=!0,this.userOrder=null)}else b=!0,this.userOrder=null;b&&this.reset()},c.checkSameOrder=function(a,b,c){for(var d=-1,e=0;e<a.length;e++){var f=a[e],g=c&&c[f];f=g?g.groupDef.groupedKeys[0]:f;var h=b.indexOf(f);if(h>=0&&d>h)return!1;d=h}return!0},c.reconcileVisibleSlices=function(a,b,c){var d=[],e={};a.forEach(function(a){a.checked&&b.some(function(b){return b.key===a.key&&!b.checked})&&(e[a.key]=!0)});var f=function(a,c){for(var d=0;d<b.length;d++)if(b[d].key===a){b[d].checked=c;break}};a.forEach(function(a){var b=a.checked;if(c&&c[a.key]){var d=c[a.key].groupDef;d.groupedKeys.forEach(function(a){f(a,b)})}else f(a.key,b)});for(var g=function(b){return!!b.checked&&!a.some(function(a){return a.key===b.key})},h=function(a,c){if(c){var e=d.map(function(a){return a.key}).indexOf(c);if(e<0)throw new Error("Error in looking for reference slice with key"+c);d.splice(e+1,0,b[a])}else d.push(b[a]);b.splice(a,1)},i=function(a,c,d){for(var e=0;e<b.length;){var f=b[e];if(f.key===a)return void h(e,d);var i=!d,j=!f.checked||g(f);c||i&&j?h(e,d):e++}},j=function(b){var f=a[b];if(c&&c[f.key]){var g=c[f.key].groupDef;g.groupedKeys.forEach(function(a,b){d.some(function(b){return b.key===a})||i(a,b>0,null)})}else{if(d.some(function(a){return a.key===f.key}))return"continue";if(e[f.key]){var h=b>0?a[b-1]:null;if(h&&c&&c[h.key]){var j=c[h.key].groupDef.groupedKeys[0],k=d.map(function(a){return a.key}).indexOf(j);if(k<0)throw new Error("Grouped column is not found in result. Key: "+j);for(var l=1;l<c[h.key].groupDef.groupedKeys.length;){var m=c[h.key].groupDef.groupedKeys[l],n=d.map(function(a){return a.key}).indexOf(m);if(n<0)throw new Error("Grouped column is not found in result. Key: "+m);if(n!==k+1)break;j=m,k=n,l++}i(f.key,!1,j)}else{var j=h&&h.key;i(f.key,!1,j)}}else i(f.key,!1,null)}},k=0;k<a.length;k++)j(k);for(var l=0;l<b.length;l++)h(l,null);return d},c.prepareSourceCollection=function(a,b,d){var e=a.filter(function(a){return a.checked}).map(function(a){return a.key}),f=b.filter(function(a){return a.checked}).map(function(a){return a.key}),g=a.filter(function(a){return!a.checked}).map(function(a){return a.key}),h={};g.forEach(function(a){d&&d[a]?d[a].groupDef.groupedKeys.forEach(function(a){h[a]=!0}):h[a]=!0}),b.forEach(function(a){h[a.key]&&(a.checked=!1)});var i=c.checkSameOrder(e,f,d);if(i){var j=c.reconcileVisibleSlices(a,b,d);return j}var k=c.forceAdiacentSlices(e,b,d);return k},c.prototype.syncronizeSourceVisibleSlices=function(a){var b=this.conf.groups,d=this.innerSliceManagerAxis.options.getFilterVisibleSlices(),e=c.prepareSourceCollection(a,d,b);this.innerSliceManagerAxis.options.setFilterVisibleSlices(e)},c.prototype.reset=function(){var a=this,c=[];if(this.userOrder&&this.conf){var d=this.userOrder.filter(function(b){return a.conf.visibleKeys.indexOf(b)>=0});this.userOrder=d}var e;if(this.userOrder||this.conf){var f=this.userOrder||this.conf.visibleKeys;f.forEach(function(d){var f=a.conf&&a.conf.groups[d];if(f){var g=a.groupAliases[d];e=new b.TreeNode(d,f.groupDef.displayName,g,f.groupDef.description,f.groupDef.category),c.push(e)}else if(a.sourceAxis.contains(d)){var h=a.sourceAxis.getSlice(d),i=h&&h.displayName&&h.displayName(),j=h&&h.alias,k=h&&h.description,l=h&&h.category;e=new b.TreeNode(d,i,j,k,l),c.push(e)}})}else this.sourceAxis.getSliceRange(0,this.sourceAxis.length()).forEach(function(a){var d=a&&a.displayName&&a.displayName(),f=a&&a.alias,g=a&&a.description,h=a&&a.category;e=new b.TreeNode(a.key(),d,f,g,h),c.push(e)});this.resetAxis(c)},c.prototype.getAs=function(a){return this instanceof a?this:this.sourceAxis.getAs(a)},c.prototype.getState=function(){return this.userOrder},c.prototype.setState=function(a){var b=a;this.userOrder=b,this.reset()},c.prototype.dispose=function(){this.unsubEvent&&(this.unsubEvent(),this.unsubEvent=null)},c}(b.FlatAxis);b.ResponsiveAxisAdapter=e;var f=function(a){function c(b){var c=a.call(this,b)||this;return c.sourceDm=b,c.dataSet=new d(c.sourceDm.getDataSet()),c.columnAxis=new e(c.sourceDm.getColumnAxis(),c.dataSet),c}return __extends(c,a),c.prototype.getLogTypeName=function(){return"ResponsiveDataModel"},c.prototype.getState=function(){var a=this.columnAxis.getState(),d=void 0;return this.sourceDm.getState&&(d=this.sourceDm.getState()),b.PersistableStateHelper.serialize(c.stateTag,c.stateVersion,{columnAxis:a,sourceDataModelState:d})},c.prototype.setState=function(a){var d=b.PersistableStateHelper.load(c.stateTag,c.stateVersion,a);d?(d.columnAxis&&this.columnAxis.setState(d.columnAxis),
d.sourceDataModelState&&this._sourceDm.setState&&this.sourceDm.setState(d.sourceDataModelState)):this.sourceDm.setState&&this.sourceDm.setState(a)},c.prototype.registerApplicationPresentationFunctorProvider=function(a){this.dataSet.applicationPresentationFunctorProvider=a},c.prototype.registerPredefinedPresentationFunctorProvider=function(a){this.dataSet.predefinedFormatFunctorProvider=a},c.compareStringArrays=function(a,b){if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0},c.compareUnorderedStringArrays=function(a,b){if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(b.indexOf(a[c])<0)return!1;return!0},c.prototype.compareConfigurations=function(a,b){if(!a&&!b)return!0;if(!a||!b)return!1;if(!c.compareStringArrays(a.visibleKeys,b.visibleKeys))return!1;var d=Object.keys(a.groups),e=Object.keys(b.groups);if(c.compareUnorderedStringArrays(d,e))return!1;for(var f=0;f<d.length;f++){var g=d[f],h=a.groups[g],i=b.groups[g],j=h.groupDef,k=i.groupDef;if(j.displayName!==k.displayName)return!1;if(!c.compareStringArrays(j.groupedKeys,k.groupedKeys))return!1}return!0},c.prototype.setConfiguration=function(a){var b=!this.compareConfigurations(a,this.configuration);this.configuration=a,b&&this.dataSet&&(this.dataSet.setConfiguration(a),this.columnAxis.setConfiguration(a))},c.prototype.getConfiguration=function(){return this.configuration},c.prototype.getDataSet=function(){return this.dataSet},c.prototype.getRowAxis=function(){return this.sourceDm.getRowAxis()},c.prototype.getColumnAxis=function(){return this.columnAxis},c.prototype.getSourceDataModel=function(){return this.sourceDm},c.explodeSelection=function(a,d){var e=d;if(this.responsiveConfiguration(a)){var f=void 0;if(d.type===b.GridRangeType.Column){var g=d.args,h=[];g.forEach(function(b){c.isResponsiveGroup(a,b)?c.groupedKeys(a,b).forEach(function(a){h.push(a)}):h.push(b)}),f=h}else if(d.type===b.GridRangeType.Cell){var i=[],j=d.args;j.forEach(function(b){c.isResponsiveGroup(a,b.columnKey)?c.groupedKeys(a,b.columnKey).forEach(function(a){i.push({colKey:a,columnKey:a,rowKey:b.rowKey})}):i.push(b)}),f=i}f&&(e={type:d.type,args:f,activeCell:d.activeCell,selectedCellsIterator:function(c){b.SelectionHelper.cellsIterator(e,a,c)}})}return{gridSelection:d,explodedSelection:e}},c.prototype.getGridColumnKey=function(a){return this.dataSet.getGridColumnKey(a)},c.prototype.getEditableColumnKey=function(a){var b=this.configuration&&this.configuration.groups&&this.configuration.groups[a],c=b&&b.groupDef&&b.groupDef.editableKey||(b&&b.groupDef&&b.groupDef.groupedKeys.length>0?b.groupDef.groupedKeys[0]:null);return c||a},c.groupConfiguration=function(a,b){var c=this.responsiveConfiguration(a);if(c){var d=c&&c.groups;return d&&d[b]||null}return null},c.responsiveConfiguration=function(a){var b=a.getAs(c);return b&&b.getConfiguration()||null},c.isResponsiveGroup=function(a,b){var d=a&&a.getAs(c);return d&&d.isGroup(b)},c.groupedKeys=function(a,b){var d=a&&a.getAs(c);return d&&d.getSourceColumnKeys(b)},c.prototype.getSourceColumnKeys=function(a){return this.configuration&&this.configuration.groups&&this.configuration.groups[a]&&this.configuration.groups[a].groupDef?this.configuration.groups[a].groupDef.groupedKeys:[a]},c.prototype.isGroup=function(a){return!!(this.configuration&&this.configuration.groups&&this.configuration.groups[a])},c.prototype.dispose=function(b){this.dataSet&&(this.dataSet.dispose(),this.dataSet=null),this.columnAxis&&(this.columnAxis.dispose(),this.columnAxis=null),a.prototype.dispose.call(this,b)},c.stateTag="ResponsiveDataModelState",c.stateVersion=1,c}(a.tables.DataModelAdapter);b.ResponsiveDataModel=f}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(a){function b(b,c){var d=a.call(this,b,c)||this;return d.slices=[],d}return __extends(b,a),b}(b.TreeNode),d=function(d){function e(c){var f=d.call(this,c)||this;f._sliceOrder=null,f._groups={},f._hiddenSlices=null,Object.defineProperty(f.options,"sliceOrder",{get:function(){return f._sliceOrder&&f._sliceOrder.slice()},set:function(b){f._sliceOrderFromApi&&a.sequenceEquals(f._sliceOrder,b)||f.updateSliceOrder(b)},enumerable:!0,configurable:!0}),Object.defineProperty(f.options,"groups",{get:function(){return a.clone(f._groups)},set:function(a){f._groups=a||{},f.update()},enumerable:!0,configurable:!0}),Object.defineProperty(f.options,"hiddenSlices",{get:function(){return f._hiddenSlices&&f._hiddenSlices.slice()},set:function(a){f._hiddenSlices=a,f.update(),f.options.refreshRequiredSlices()},enumerable:!0,configurable:!0});var g=function(){var a=b.collectAvailableItems(f.sourcePivotAxis),c=f._sliceOrder;f._sliceOrder||(c=f.sourcePivotAxis.getSliceRange(0,f.sourcePivotAxis.length()).map(function(a){return a.key()}));var d=e.collectFilterVisibleSlices(a,c,f._hiddenSlices);return d},h=function(a){var b=a.filter(function(a){return a.checked}).map(function(a){return a.key});f.updateSliceOrder(b)};return f.options.getExpandState=function(a){return f._sliceOrder?b.ExpandState.None:f.sourcePivotAxis.options.getExpandState(a)},f.options.requestExpandState=function(a,c){if(f._sliceOrder)throw new Error(b.Strings.Err_SliceManager_NotSupported);return f.sourcePivotAxis.options.requestExpandState(a,c)},f.options.isNodeSummaryVisible=function(a){return!f._sliceOrder&&f.sourcePivotAxis.options.isNodeSummaryVisible(a)},f.options.getNodeKey=function(a){return f._sliceOrder?f._measureMap[a]:f.sourcePivotAxis.options.getNodeKey(a)},f.options.getNodeSliceRange=function(a,b,c){return f._sliceOrder?{start:f._slicesByKey[a].index(),count:1}:f.sourcePivotAxis.options.getNodeSliceRange(a,b,c)},f.options.getSliceKeys=function(a){return f._sliceOrder?f._groupNodesByKey[a].slices:f.sourcePivotAxis.options.getSliceKeys(a)},f.options.getTreeNode=function(a){return f._sliceOrder?f._nodeByKey[a]:f.sourcePivotAxis.options.getTreeNode(a)},f.options.getVisibleRoot=function(){return f._sliceOrder?f._rootNode:f.sourcePivotAxis.options.getVisibleRoot()},f.options.getFilterVisibleSlices=g,f.options.setFilterVisibleSlices=h,f.options.slicesEvent=new a.Event,c.options.slicesEvent.add(f.update.bind(f)),f}return __extends(e,d),e.collectFilterVisibleSlices=function(c,d,e){function f(c,d){return d?a.stringFormat(b.Strings.Grid_ColumnSelector_ItemWithAliasFmt,{alias:d,displayName:c}):c}var g=[],h={};d.forEach(function(a,b){h[a]=b,g.push({key:a,displayName:"",checked:!0})});var i={};return c.forEach(function(a){i[a.nodeKey]=a;var b=h[a.nodeKey];isNaN(b)?g.push({key:a.nodeKey,checked:!1,displayName:f(a.displayName(),a.alias),category:a.category,description:a.description}):(g[b].displayName=f(a.displayName(),a.alias),g[b].category=a.category,g[b].description=a.description)}),g.filter(function(a){return!(e&&e.indexOf(a.key)>=0)&&!!i[a.key]})},e.prototype.getLogTypeName=function(){return"SliceManagerAxisAdapter"},e.prototype.updateSliceOrder=function(a){this._sliceOrderFromApi=!0,this._sliceOrder=a,this.update(),this.options.refreshRequiredSlices()},e.prototype.getAxisRequiredSlices=function(a){this._sliceOrder&&this._sliceOrder.forEach(function(b){a[b]=!0})},e.prototype.onNodeStateUpdated=function(a){this.update(),d.prototype.onNodeStateUpdated.call(this,a)},e.prototype.update=function(){var d,f=this,g=this._hiddenSlices&&this._hiddenSlices.length>0,h=this._groups&&Object.getOwnPropertyNames(this._groups).length>0;if(this._sliceOrderFromApi||!h&&!g?this._sliceOrder&&(d=this._sliceOrder.filter(function(a){return f.sourcePivotAxis.contains(a)})):(this._sliceOrder=this.sourcePivotAxis.getSliceRange(0,this.sourcePivotAxis.length()).map(function(a){return a.key()}),g&&(this._sliceOrder=this._sliceOrder.filter(function(a){return f._hiddenSlices.indexOf(a)<0})),d=this._sliceOrder),this._sliceOrder){this._slicesByKey={},this._slicesByIndex=[],this._nodeByKey={},this._groupNodesByKey={},this._measureMap={};var i={};a.forEach(this._groups,function(a,b){a.forEach(function(a){i[a]=b})});var j=!1,k=[];this._rootNode=new c(e.ROOT_NAME,""),this._nodeByKey[e.ROOT_NAME]=this._rootNode,this._groupNodesByKey[e.ROOT_NAME]=this._rootNode,d.forEach(function(a,c){if(a===e.ROOT_NAME)throw new Error(b.Strings.Err_SliceManager_Reserved_NodeKey);var d=f.sourcePivotAxis.getSlice(a),g=d.displayName(),h={index:function(){return c},key:function(){return a},displayName:function(){return g},alias:d.alias,description:d.description,category:d.category};f._slicesByIndex.push(h),f._slicesByKey[a]=h,f._measureMap[a]=e.ROOT_NAME;var l=i[a];k.push({group:l||"",key:a}),l&&(j=!0)});var l=0,m=function(){return"__T"+l++};if(j){var n=null;k.forEach(function(a){if(!n||n.displayName()!==a.group){var b=m();n=new c(b,a.group),f._nodeByKey[b]=n,n.setHeaderClass("text-center"),f._rootNode.appendBlock([n]),f._groupNodesByKey[n.key()]=n}n.slices.push(a.key),f._measureMap[a.key]=n.key()})}else this._rootNode.slices=k.map(function(a){return a.key})}this.raiseSlicesEvent([{type:b.SliceEventType.Reset}])},e.prototype.getAs=function(a){return this instanceof a?this:this.sourcePivotAxis.getAs(a)},e.prototype.length=function(){return this._sliceOrder?this._slicesByIndex.length:this.sourcePivotAxis.length()},e.prototype.getSlice=function(a){return this._sliceOrder?this._slicesByKey[a]:this.sourcePivotAxis.getSlice(a)},e.prototype.contains=function(a){return this._sliceOrder?this._slicesByKey.hasOwnProperty(a):this.sourcePivotAxis.contains(a)},e.prototype.getKey=function(a){return this._sliceOrder?this._slicesByIndex[a].key():this.sourcePivotAxis.getKey(a)},e.prototype.getSliceRange=function(a,b){return this._sliceOrder?this._slicesByIndex.slice(a,a+b):this.sourcePivotAxis.getSliceRange(a,b)},e.prototype.getState=function(){return b.PersistableStateHelper.serialize(e.serializationTag,e.serializationVersion,{order:this._sliceOrder})},e.prototype.setState=function(a){var c=b.PersistableStateHelper.load(e.serializationTag,e.serializationVersion,a);c&&(this.options.sliceOrder=c.order)},e.prototype.raiseSlicesEvent=function(a){this.options.slicesEvent.raise(this,a)},e.prototype.getNodeAndMeasureKey=function(a){if(this._sliceOrder){if(!this._measureMap[a])throw new Error(b.Strings.Err_DM_NodeKey_NotFound);return{nodeKey:this._measureMap[a],measureKey:a}}return this.sourcePivotAxis.getNodeAndMeasureKey(a)},e.prototype.hideMeasure=function(a,b){return this.sourcePivotAxis.hideMeasure(a,b)},e.serializationTag="__SliceOrder",e.serializationVersion=1,e.ROOT_NAME="<ROOT>",e}(b.PivotAxisAdapter);b.SliceManagerAxisAdapter=d;var e=function(a){function c(c,e){var f=a.call(this,c)||this;return f._targetAxis=e,e===b.AxisType.Row?(f._rowAxis=f.managedAxis=new d(c.getRowAxis()),f._columnAxis=c.getColumnAxis()):(f._columnAxis=f.managedAxis=new d(c.getColumnAxis()),f._rowAxis=c.getRowAxis()),f}return __extends(c,a),c.prototype.getLogTypeName=function(){return"SliceManagerDataModel"},Object.defineProperty(c.prototype,"targetAxis",{get:function(){return this.managedAxis},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"sliceOrder",{get:function(){return this.managedAxis.options.sliceOrder},set:function(a){this.managedAxis.options.sliceOrder=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"groups",{get:function(){return this.managedAxis.options.groups},set:function(a){this.managedAxis.options.groups=a},enumerable:!0,configurable:!0}),c.prototype.getFilterVisibleSlices=function(){return this.managedAxis.options.getFilterVisibleSlices()},c.prototype.setFilterVisibleSlices=function(a){return this.managedAxis.options.setFilterVisibleSlices(a)},c.prototype.getRowAxis=function(){return this._rowAxis},c.prototype.getColumnAxis=function(){return this._columnAxis},c.prototype.getState=function(){var a=this.managedAxis===this._columnAxis?this._columnAxis.getState():null,d=this.managedAxis===this._rowAxis?this._rowAxis.getState():null,e=void 0;return this._sourceDm.getState&&(e=this._sourceDm.getState()),b.PersistableStateHelper.serialize(c._stateTag,c._stateVersion,{columnAxis:a,rowAxis:d,sourceDataModelState:e})},c.prototype.setState=function(a){var d=b.PersistableStateHelper.load(c._stateTag,c._stateVersion,a);d&&(d.columnAxis&&this._columnAxis.setState(d.columnAxis),d.rowAxis&&this._rowAxis.setState(d.rowAxis),d.sourceDataModelState&&this._sourceDm.setState&&this._sourceDm.setState(d.sourceDataModelState))},c._stateTag="SliceManagerDataModelState",c._stateVersion=1,c.stateTag="SliceManagerDataModelState",c.stateVersion=1,c}(b.DataModelAdapter);b.SliceManagerDataModel=e}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(c,d,e){var f=this;this._updated=new a.Event,this._rangeUpdated=new a.Event,this.unsub=[],this._logId=b.getInstanceId(),this._dss=c,this._concatAxis=d,this._axis=e,this._dss.forEach(function(a){f.unsub.push(a.updated.add(function(a,b){return f.handleUpdated(a,b)})),f.unsub.push(a.rangeUpdated.add(function(a,b){return f.handleRangeUpdated(a,b)}))})}return c.prototype.getLogTypeName=function(){return"ConcatDataSet"},c.prototype.getLogId=function(){return this._logId},c.prototype.dispose=function(){this.unsub.forEach(function(a){return a()})},c.prototype.handleUpdated=function(a,c){var d={value:c.value,rowKey:c.rowKey,columnKey:c.columnKey},f=this._dss.indexOf(a);this._axis===b.AxisType.Row?d.columnKey=e.addPrefix(d.columnKey,f):d.rowKey=e.addPrefix(d.rowKey,f),this._updated.raise(this,d)},c.prototype.handleRangeUpdated=function(a,c){var d={rowKeys:c.rowKeys,columnKeys:c.columnKeys},f=this._dss.indexOf(a);this._axis===b.AxisType.Row?d.columnKeys=c.columnKeys.map(function(a){return e.addPrefix(a,f)}):d.rowKeys=c.rowKeys.map(function(a){return e.addPrefix(a,f)}),this._rangeUpdated.raise(this,d)},c.prototype.raiseBlankFromSlave=function(a,c,d){var f,g={value:void 0};if(this._axis===b.AxisType.Row){g.rowKey=d;var h=a.getColumnAxis(),i=h.getSliceRange(0,h.length());for(f=0;f<i.length;f++)g.columnKey=e.addPrefix(i[f].key(),c),this._updated.raise(this,g)}else{g.columnKey=d;var j=a.getRowAxis(),k=j.getSliceRange(0,j.length());for(f=0;f<k.length;f++)g.rowKey=e.addPrefix(k[f].key(),c),this._updated.raise(this,g)}},c.prototype.getSourceDataSet=function(a,b){var c=this._concatAxis.parsePrefix(a),d={key:c.key,dataSet:this._dss[c.idx]};return b&&(d.dataSet=d.dataSet.getAs(b)),d},c.prototype.getValue=function(a,c){var d;return this._axis===b.AxisType.Column?(d=this.getSourceDataSet(a),d.dataSet.getValue(d.key,c)):(d=this.getSourceDataSet(c),d.dataSet.getValue(a,d.key))},Object.defineProperty(c.prototype,"updated",{get:function(){return this._updated},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rangeUpdated",{get:function(){return this._rangeUpdated},enumerable:!0,configurable:!0}),c.prototype.__getRow=function(a,c){if(this._axis===b.AxisType.Column){var d=this._concatAxis.parsePrefix(a);return this._dss[d.idx].__getRow(d.key,c)}for(var f={},g=0;g<this._dss.length;g++){var h=this._dss[g].__getRow(a,c);for(var i in h)f[e.addPrefix(i,g)]=h[i]}return f},c.prototype.getAs=function(a){return this instanceof a?this:null},c}(),d=function(){function a(){}return a.fromNode=function(b,c,d){var f=new a;return f._key=e.addPrefix(b.key(),c),f._displayName=b.displayName(),f._level=d?d.level()+b.level()+1:b.level(),f._length=b.length(),f._value=b.value(),f.alias=b.alias,f.description=b.description,f.category=b.category,f.isPlaceholder=b.isPlaceholder,b.parent()?f._parent=a.fromNode(b.parent(),c,d):f._parent=d,f},a.root=function(b){var c=new a;return c._key=b,c._level=0,c},a.prototype.key=function(){return this._key},a.prototype.displayName=function(){return this._displayName},a.prototype.level=function(){return this._level},a.prototype.length=function(){return this._length},a.prototype.parent=function(){return this._parent},a.prototype.value=function(){return this._value},a.prototype.headerClass=function(){return""},a}(),e=function(){function c(e,f){var g=this;this.nodeStateUpdated=new a.Event,this.enableLeavesCounter=!1;var h=b.getInstanceId();if(this._logId=f?f+"_"+h:h,e.length<=1||e.length>=c.PREFIX_COUNT){var i=a.stringFormat(b.Strings.Err_Concat_InvalidCount_AxisConcatenated,{prefixCount:c.PREFIX_COUNT});throw new Error(i)}this._axes=e,this.collectingRequiredSlicesEvent=new a.Event;var j=this;this.options={measuresChanged:new a.Event,slicesEvent:new a.Event,isLevelSummaryVisible:function(a){return 0!==a&&j._axes[0].options.isLevelSummaryVisible(a-1)},isNodeSummaryVisible:function(a){var b=j.parsePrefix(a);return!(b.idx<0)&&j._axes[b.idx].options.isNodeSummaryVisible(b.key)},requestExpandState:function(a,b){var c=j.parsePrefix(a);return c.idx>=0&&j._axes[c.idx].options.requestExpandState(c.key,b)},getExpandState:function(a){var c=j.parsePrefix(a);return c.idx<0?b.ExpandState.Expanded:j._axes[c.idx].options.getExpandState(c.key)},getTreeNode:function(a){var b=j.parsePrefix(a);if(b.idx<0)return d.root(c.ROOT_NAME);var e=j._axes[b.idx].options.getTreeNode(b.key);return d.fromNode(e,b.idx,d.root(c.ROOT_NAME))},getNodeKey:function(a){var b=j.parsePrefix(a);return c.addPrefix(j._axes[b.idx].options.getNodeKey(b.key),b.idx)},getVisibleRoot:function(){for(var a=new b.TreeNode(c.ROOT_NAME),d=0;d<j._axes.length;d++)a.insertBlock([c.addPrefixRoot(j._axes[d].options.getVisibleRoot(),d)],d);return a},getSliceKeys:function(a){var b=j.parsePrefix(a);return b.idx<0?[]:j._axes[b.idx].options.getSliceKeys(b.key).map(function(a){return c.addPrefix(a,b.idx)})},getNodeSliceRange:function(a,b,c){var d=j.parsePrefix(a);if(d.idx<0){var e=j.lengthn(b),f=j.lengthn(b+c);return{start:e,count:f-e}}var g=j._axes[d.idx].options.getNodeSliceRange(d.key,b,c);return g.start+=j.lengthn(d.idx),g},setDisplayName:function(a,b){return g.setDisplayItem(function(a,c){return a.setDisplayName(c,b)},a)},setAlias:function(a,b){return g.setDisplayItem(function(a,c){return a.setAlias(c,b)},a)},setDescription:function(a,b){return g.setDisplayItem(function(a,c){return a.setDescription(c,b)},a)},setCategory:function(a,b){return g.setDisplayItem(function(a,c){return a.setCategory(c,b)},a)},setDisplayItemOptions:function(a,b){return g.setDisplayItem(function(a,c){return a.setDisplayItemOptions(c,b)},a)},setValues:function(a){var b={};a.forEach(function(a){var c=j.parsePrefix(a.nodeKey);c.idx>=0&&(b[c.idx]||(b[c.idx]=[]),b[c.idx].push({nodeKey:c.key,value:a.value}))}),Object.keys(b).forEach(function(a){j._axes[a].options.setValues(b[a])})},getMeasures:function(){var a=g._axes.length>0&&g._axes[0];return a&&a.options.getMeasures()},setMeasures:function(a){e.forEach(function(b){b.options.setMeasures(a)})},getVisibleLevelSummaries:function(){var a=g._axes.length>0&&g._axes[0];return a&&a.options.getVisibleLevelSummaries()},setVisibleLevelSummaries:function(a){e.forEach(function(b){b.options.setVisibleLevelSummaries(a)})},get groupingLevelDescriptor(){return this._groupingLevelDescriptor},set groupingLevelDescriptor(a){this._groupingLevelDescriptor=a},getAvailableSlices:function(){for(var a=[],b=0;b<g._axes.length;b++)g._axes[b].options.getAvailableSlices().forEach(function(d){var e=c.addPrefix(d.nodeKey,b),f={nodeKey:e,alias:d.alias,description:d.description,category:d.category,displayName:d.displayName};a.push(f)});return a},refreshRequiredSlices:function(){for(var a={},d=0;d<g._axes.length;d++){var e=g._axes[d].options.refreshRequiredSlices();b.keySetToArray(e).map(function(a){return c.addPrefix(a,d)}).forEach(function(b){a[b]=!0})}return a},collectingRequiredSlices:this.collectingRequiredSlicesEvent},this._axes.forEach(function(a){a.options.slicesEvent.add(g.handleSliceEvent,g),a.nodeStateUpdated.add(g.handleNodeStateEvent,g),a.options.measuresChanged.add(g.handleMeasuresChangedEvent,g)});for(var k=function(a){var d=g._axes[a];d.options.collectingRequiredSlices.add(function(d,e){var f=function(b){return c.addPrefix(b,a)},h=b.cloneKeySet(e.slices,f),i={slices:h};g.raiseCollectingRequiredSlicesEvent(i),Object.keys(i.slices).forEach(function(b){if(i.slices[b]){var c=g.parsePrefix(b);c.idx===a&&(e.slices[c.key]=!0)}})})},l=0;l<this._axes.length;l++)k(l)}return Object.defineProperty(c.prototype,"axes",{get:function(){return this._axes},enumerable:!0,configurable:!0}),c.prototype.getLogTypeName=function(){return"ConcatAxis"},c.prototype.raiseCollectingRequiredSlicesEvent=function(a){this.collectingRequiredSlicesEvent.raise(this,a)},c.prototype.getCategories=function(){var a=this._axes&&this._axes.length>0&&this._axes[0];return a&&a.getCategories()},c.prototype.setDisplayItem=function(b,c){var d=this,e={};c.forEach(function(b,c){var f=d.parsePrefixNoE(b.nodeKey);if(f&&f.idx>=0){e[f.idx]||(e[f.idx]=[]);var g=a.extend({},[b,{_idx:c}]);g.nodeKey=f.key,e[f.idx].push(g)}});for(var f=[],g=0;g<c.length;g++)f.push(!1);return Object.keys(e).forEach(function(a){b(d._axes[a].options,e[a]).forEach(function(b,c){f[e[a][c]._idx]=b})}),f},c.prototype.setCategory=function(b,c){var d=this,e={};c.forEach(function(b,c){var f=d.parsePrefix(b.nodeKey);if(f.idx>=0){e[f.idx]||(e[f.idx]=[]);var g=a.extend({},[b,{_idx:c}]);g.nodeKey=f.key,e[f.idx].push(g)}});for(var f=[],g=0;g<c.length;g++)f.push(!1);return Object.keys(e).forEach(function(a){b(d._axes[a].options,e[a]).forEach(function(b,c){f[e[a][c]._idx]=b})}),f},c.prototype.dispose=function(){var a=this;this._axes.forEach(function(b){return b.options.slicesEvent.remove(a.handleSliceEvent,a)})},c.prototype.handleMeasuresChangedEvent=function(a,b){this.options.measuresChanged.raise(a,b)},c.prototype.handleNodeStateEvent=function(a,b){var d=this._axes.indexOf(a);this.nodeStateUpdated.raise(this,b.map(function(a){return{nodeKey:c.addPrefix(a.nodeKey,d),expandState:a.expandState}}))},c.prototype.handleSliceEvent=function(b,d){for(var e=this._axes.indexOf(b),f=0,g=0;g<e;g++)f+=this._axes[g].length();this.options.slicesEvent.raise(this,d.map(function(b){var d=b.args&&a.clone(b.args);return d&&(d.start+=f,void 0!==d.target&&(d.target+=f),d.keys=d.keys.map(function(a){return c.addPrefix(a,e)}),d.nodeKeys=d.nodeKeys.map(function(a){return c.addPrefix(a,e)})),{type:b.type,args:d}}))},c.prototype.parsePrefixNoE=function(a){if(!a)return null;if(a===c.ROOT_NAME)return{idx:-1,key:null};var b=a.charCodeAt(0)-c.PREFIX_BASE;return b>=this._axes.length?null:{idx:b,key:a.substring(1)}},c.prototype.parsePrefix=function(a){var c=this.parsePrefixNoE(a);if(!c)throw new Error(b.Strings.Err_Concat_InvalidKey);return c},c.addPrefixRoot=function(a,d){var e=new b.TreeNode(c.addPrefix(a.key(),d),a.displayName());return e.insertBlock(a.children().map(function(a){return c.addPrefixRoot(a,d)}),0),e},c.addPrefix=function(a,b){return String.fromCharCode(c.PREFIX_BASE+b)+a},c.prepend=function(a,b,d){return{key:function(){return c.addPrefix(a.key(),b)},index:function(){return a.index()+d},displayName:function(){return a.displayName()}}},c.prototype.length=function(){return this.lengthn(this._axes.length)},c.prototype.lengthn=function(a){for(var b=0,c=0;c<a;c++)b+=this._axes[c].length();return b},c.prototype.getSlice=function(a){var b=this.parsePrefix(a),d=this._axes[b.idx].getSlice(b.key);return d?c.prepend(d,b.idx,this.lengthn(b.idx)):void 0},c.prototype.contains=function(a){var b=this.parsePrefixNoE(a);return!!b&&this._axes[b.idx].contains(b.key)},c.prototype.getKey=function(a){for(var b=0,d=0;d<this._axes.length;d++){var e=this._axes[d].length();if(a<b+e)break;b+=e}return c.addPrefix(this._axes[d].getKey(a-b),d)},c.prototype.getSliceRange=function(a,b){for(var d=[],e=0,f=a+b,g=0;g<this._axes.length;g++){var h=this._axes[g].length();if(a<=e+h&&f>=e){var i=Math.max(a-e,0),j=Math.min(f-e,h);d=d.concat(this._axes[g].getSliceRange(i,j-i).map(function(a){return c.prepend(a,g,e)}))}e+=h}return d},c.prototype.hasVisibleSlices=function(a){if(a.key()===c.ROOT_NAME)return this.length()>0;var b=this.parsePrefixNoE(a.key());if(!b)return!1;var d=this._axes[b.idx];return d.hasVisibleSlices(d.options.getTreeNode(b.key))},c.prototype.lastSliceIndex=function(a){if(a===c.ROOT_NAME)return this.lengthn(this._axes.length-1);var b=this.parsePrefixNoE(a);if(!b)return-1;var d=0;return b.idx>0&&(d+=this.lengthn(b.idx-1)),d+=this._axes[b.idx].lastSliceIndex(b.key)},c.prototype.getFirstSlice=function(a){if(a===c.ROOT_NAME)return 0;var b=this.parsePrefixNoE(a);if(!b)return-1;var d=0;return b.idx>0&&(d+=this.lengthn(b.idx-1)),d+=this._axes[b.idx].getFirstSlice(b.key)},c.prototype.getState=function(){return null},c.prototype.setState=function(a){},c.prototype.getAs=function(a){return this instanceof a?this:null},c.prototype.getNodeAndMeasureKey=function(a){if(a===c.ROOT_NAME)return{nodeKey:a};var b=this.parsePrefix(a),d=this._axes[b.idx].getNodeAndMeasureKey(b.key);return{nodeKey:c.addPrefix(d.nodeKey,b.idx),measureKey:d.measureKey}},c.prototype.getSlicesOfMeasure=function(b){return a.selectMany(this._axes.map(function(a){return a.getSlicesOfMeasure(b)}),function(a){return a})},c.prototype.hideMeasure=function(b,c){return a.any(this._axes.map(function(a){return a.hideMeasure(b,c)}),function(a){return a})},c.prototype.getLogId=function(){return this._logId},c.ROOT_NAME="<>",c.PREFIX_BASE="A".charCodeAt(0),c.PREFIX_COUNT=26,c}();b.ConcatAxis=e;var f=function(){function a(a,d,f){var g=this;if(!a||a.length<2)throw new Error(b.Strings.Err_Concat_Invalid_Number_Datamodels);this._dms=a,this._primaryAxis=d;var h=b.getInstanceId();this._logId=f?f+"_"+h:h,d===b.AxisType.Row?(this._rowAxis=a[0].getRowAxis(),this._columnAxis=this._concatAxis=new e(a.map(function(a){return a.getColumnAxis()}),this._logId+b.LogKeys.PivotAxisDef._Column_),this._dataSet=new c(a.map(function(a){return a.getDataSet()}),this._columnAxis,d)):(this._columnAxis=a[0].getColumnAxis(),this._rowAxis=this._concatAxis=new e(a.map(function(a){return a.getRowAxis()}),this._logId+b.LogKeys.PivotAxisDef._Row_),this._dataSet=new c(a.map(function(a){return a.getDataSet()}),this._rowAxis,d)),this.getSlaveAxis().forEach(function(a){a.options.slicesEvent.add(g.handleSlaveAxisUpdate,g)})}return a.prototype.getLogTypeName=function(){return"ConcatDataModel"},a.prototype.dumpLogId=function(a){var c=this._dms.map(function(a){var b="[unknown]";return"function"==typeof a.dumpLogId&&(b=a.dumpLogId()),b}),d=c.join(";"),e="[concatChildren:["+d+"]]",f=b.ManualDataModel.createDatamodelLogIdDump(this),g=f+";"+e;return g},a.prototype.getSlaveAxis=function(){for(var a=[],c=1;c<this._dms.length;c++)this._primaryAxis===b.AxisType.Row?a.push(this._dms[c].getRowAxis()):a.push(this._dms[c].getColumnAxis());return a},a.prototype.getMasterAxis=function(){return this._primaryAxis===b.AxisType.Row?this._dms[0].getRowAxis():this._dms[0].getColumnAxis()},a.prototype.handleSlaveAxisUpdate=function(a,c){var d=this,e=this.getSlaveAxis().indexOf(a)+1,f=this.getMasterAxis();c.forEach(function(c){c.type==b.SliceEventType.SliceRemoved?c.args.keys.forEach(function(a){f.contains(a)&&d._dataSet.raiseBlankFromSlave(d._dms[e],e,a)}):c.type===b.SliceEventType.Reset&&f.getSliceRange(0,f.length()).forEach(function(b){var c=b.key();a.contains(c)||d._dataSet.raiseBlankFromSlave(d._dms[e],e,c)})})},a.prototype.getLogId=function(){return this._logId},a.prototype.getRowAxis=function(){return this._rowAxis},a.prototype.getColumnAxis=function(){return this._columnAxis},a.prototype.getAs=function(a){return this instanceof a?this:null},a.prototype.dispose=function(){var a=this;this.getSlaveAxis().forEach(function(b){b.options.slicesEvent.remove(a.handleSlaveAxisUpdate,a)}),this._dms.forEach(function(a){return a.dispose()}),this._dataSet.dispose()},a.prototype.getDataSet=function(){return this._dataSet},a.prototype.getState=function(){var c=this._dms.map(function(a){var b=a;return b.getState?b.getState():null});return b.PersistableStateHelper.serialize(a._stateTag,a._stateVersion,{dmStates:c})},a.prototype.setState=function(c){var d=this,e=b.PersistableStateHelper.load(a._stateTag,a._stateVersion,c);e&&e.dmStates&&e.dmStates.length==this._dms.length&&e.dmStates.forEach(function(a,b){var c=d._dms[b];a&&c.setState&&c.setState(a)})},a.prototype.getSourceDataModel=function(a,b){var c=this._concatAxis.parsePrefix(a),d={key:c.key,dataModel:this._dms[c.idx]};return b&&(d.dataModel=d.dataModel.getAs(b)),d},a._stateTag="__ConcatDataModelState",a._stateVersion=1,a.stateTag="__ConcatDataModelState",a.stateVersion=1,a}();b.ConcatDataModel=f}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.Generic=0]="Generic",a[a.AsciiIgnoreCase=1]="AsciiIgnoreCase",a[a.AsciiCaseSensitive=2]="AsciiCaseSensitive",a[a.StringNatural=3]="StringNatural",a[a.NumericAbsolute=4]="NumericAbsolute"}(c=b.SortType||(b.SortType={}));var d=function(d){function e(a,c,e,f){var g=d.call(this,null)||this;g.dmSource=a,g.loggerFactory=c,g.options=f;var h=g.dmSource.getColumnAxis().options;g.hasMeasures=h.getMeasures().length>0;var i=a;if(f&&f.hasVerticalGrouping){var j={hideGrandTotal:f.verticalGroupingOptions&&f.verticalGroupingOptions.hideGrandTotal,defaultNodeStatus:f.verticalGroupingOptions&&f.verticalGroupingOptions.defaultNodeStatus,summaries:f.verticalGroupingOptions&&f.verticalGroupingOptions.summaries,defaultGrouping:f.verticalGroupingOptions&&f.verticalGroupingOptions.defaultGrouping,nullGroupFormattedValue:f.verticalGroupingOptions&&f.verticalGroupingOptions.nullGroupFormattedValue};g.groupinDataModel=new b.GroupingDataModel(a,j),i=g.groupinDataModel}g.sliceManagerAdapter=new b.SliceManagerDataModel(i,b.AxisType.Column);var k=a.getAs(b.VirtualSortingDataModel);g.rowSortingAdapter=k||new b.SortingDataModel(g.sliceManagerAdapter,b.AxisType.Row,f&&f.oneShotSorting,f&&f.disableSortingPersistency);var l=k?g.sliceManagerAdapter:g.rowSortingAdapter;if(g.columnSortingAdapter=k||new b.SortingDataModel(l,b.AxisType.Column,f&&f.oneShotSorting,f&&f.disableSortingPersistency),l=k?l:g.columnSortingAdapter,f&&f.hasValidation&&(g.validationDataModel=e.createValidationDataModel(l),l=g.validationDataModel),f&&f.hasCellEditing){var m=g.loggerFactory.create("EditingDataModel");g.editingDataModel=new b.EditingDataModel(l,f.cellEditingOptions||{},m),l=g.editingDataModel}if(g.presentationAdapter=new b.PresentationDataModelAdapter(l),f&&f.hasResponsiveness&&(g.responsiveDataModel=new b.ResponsiveDataModel(g.presentationAdapter),f.responsiveness&&g.responsiveDataModel.registerApplicationPresentationFunctorProvider(f.responsiveness.responsiveGroupCellPresenter)),g._sourceDm=g.responsiveDataModel||g.presentationAdapter,f&&(g.initVerticalGrouping(),g.initColumnAxis(),g.initSliceManager(),g.initRowSorting(),g.initColumnSorting(),g.initPresentation()),g.groupinDataModel){var n=function(a,c,d,e){var f=g.presentationAdapter.getPresentedValue(d,e,a);return f&&f.getFormatted?f.getFormatted(b.PresentationContext.Export):c};g.groupinDataModel.setGroupValueFormatter(n)}return g}return __extends(e,d),e.prototype.getLogTypeName=function(){return"DataTable"},e.prototype.dispose=function(a){this.responsiveDataModel&&this.responsiveDataModel.dispose(!1),this.presentationAdapter.dispose(!1),this.editingDataModel&&this.editingDataModel.dispose(!1),this.rowSortingAdapter.dispose(!1),this.columnSortingAdapter.dispose(!1),this.sliceManagerAdapter.dispose(!1),this.groupinDataModel&&this.groupinDataModel.dispose(!1),a!==!1&&this.dmSource.dispose()},e.prototype.initColumnAxis=function(){var c=this;if(this.options.columnOptions){var d=this.dmSource.getColumnAxis().options,e=Object.getOwnPropertyNames(this.options.columnOptions);if(this.hasMeasures){var f=!1,g=d.getMeasures();e.forEach(function(d){var e=c.options.columnOptions[d],h=a.indexOf(g,function(a){return a===d||a.key&&a.key===d});if(h>=0){var i=g[h];"string"==typeof i&&(i={key:d}),b.DataTableHelper.setDisplayItem(i,e),g[h]=i,f=!0}}),f&&d.setMeasures(g)}else{var h=e.map(function(a){var d=c.options.columnOptions[a],e={nodeKey:a};return b.DataTableHelper.setDisplayItem(e,d),e}),i=null,j=!1,k=function(a){j=!0;try{var b=a()}finally{j=!1}b||i?b&&i&&i():i=d.slicesEvent.add(function(){j||k(a)})};k(function(){return a.firstOrDefault(d.setDisplayItemOptions(h),function(a){return!a;
})!==!1})}}},e.prototype.initSliceManager=function(){var a=this;if(this.options.columnOptions){var c=[],d=Object.getOwnPropertyNames(this.options.columnOptions);d.forEach(function(b){var d=a.options.columnOptions[b];d.hidden&&c.push(b)}),c.length>0&&(this.sliceManagerAdapter.targetAxis.options.hiddenSlices=c)}if(this.options.columnOrder||this.options.columnGroups){if(!(this.dmSource.getColumnAxis().getAs(b.PivotAxis)instanceof b.FlatAxis||this.dmSource.getColumnAxis().getAs(b.ConcatAxis)))throw new Error(b.Strings.Err_DT_FlatAxis_ColumnSupported_EnableReorder_VisibilityOrGrouping);this.options.columnOrder&&(this.sliceManagerAdapter.targetAxis.options.hiddenSlices?this.sliceManagerAdapter.sliceOrder=this.options.columnOrder.filter(function(b){return a.sliceManagerAdapter.targetAxis.options.hiddenSlices.indexOf(b)===-1}):this.sliceManagerAdapter.sliceOrder=this.options.columnOrder),this.options.columnGroups&&(this.sliceManagerAdapter.groups=this.options.columnGroups)}},e.prototype.initVerticalGrouping=function(){},e.prototype.initRowSorting=function(){var a=this,b=this.rowSortingAdapter.getRowAxis();b.preferredTypes=b.preferredTypes||{},b.disabledKeys=b.disabledKeys||{},b.oneShotSortKeys=b.oneShotSortKeys||{},this.options.hasUserSorting===!1&&(b.hasUserSorting=!1),this.options.columnOptions&&Object.getOwnPropertyNames(this.options.columnOptions).forEach(function(c){var d=a.options.columnOptions[c];d.sortType&&(b.preferredTypes[c]=d.sortType),d.disableSorting&&(b.disabledKeys[c]=!0),d.isOneShotSorting&&(b.oneShotSortKeys[c]=!0)}),this.options.fallbackSorting&&this.options.fallbackSorting.length>0&&b.setFallbackSortCriteria(e.convertSortedColumn(this.options.fallbackSorting,b));var c=function(a){a.filter(function(a){return"string"==typeof a.keyOrLevel}).forEach(function(a){"undefined"==typeof a.sortType&&(a.sortType=b.preferredTypes[a.keyOrLevel])})};this.options.defaultSorting&&this.options.defaultSorting.length>0&&(c(this.options.defaultSorting),b.setSortCriteria(e.convertSortedColumn(this.options.defaultSorting,b))),this.options.fallbackSorting&&this.options.fallbackSorting.length>0&&(c(this.options.fallbackSorting),b.setFallbackSortCriteria(e.convertSortedColumn(this.options.fallbackSorting,b)))},e.prototype.initColumnSorting=function(){var a=this.columnSortingAdapter.getRowAxis();this.options.fallbackColumnSorting&&this.options.fallbackColumnSorting.length&&a.setFallbackSortCriteria(e.convertSortedColumn(this.options.fallbackColumnSorting,a)),this.options.defaultColumnSorting&&this.options.defaultColumnSorting.length&&a.setSortCriteria(e.convertSortedColumn(this.options.defaultColumnSorting,a)),this.options.hasUserColumnSorting===!1&&(a.hasUserSorting=!1)},e.prototype.initPresentation=function(){var a=this;this.presentationAdapter.setTableFormat(this.options.defaultFormattingOptions),this.presentationAdapter.ruleContext=this.options.ruleContext,this.options.columnOptions&&Object.getOwnPropertyNames(this.options.columnOptions).forEach(function(b){var c=a.options.columnOptions[b];if(c.formattingOptions||c.cellFormattingOptions){var d={cellFormattingOptions:c.cellFormattingOptions,formattingOptions:c.formattingOptions};a.hasMeasures?a.presentationAdapter.setColumnMeasuresFormat([b],d):a.presentationAdapter.setColumnsFormat([b],d)}})},Object.defineProperty(e.prototype,"source",{get:function(){return this.dmSource},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"datatableCreateOptions",{get:function(){return this.options},enumerable:!0,configurable:!0}),e.convertSortCriterion=function(a){var c;if(a instanceof b.DataSetSortCriterion){var d=a;c={keyOrLevel:d.getKey(),direction:a.getDirection(),sortType:a.getSortType()}}else if(a instanceof b.LevelSortCriterion){var e=a;c={keyOrLevel:e.level,direction:a.getDirection()}}return c},e.convertSortCriteria=function(a){var b=this,c=[];return a.forEach(function(a){var d=b.convertSortCriterion(a);d&&c.push(d)}),c},e.convertSortedColumn=function(a,b){var d=[];return a.forEach(function(a){var e;if("number"==typeof a.keyOrLevel){var f=a.keyOrLevel;switch(a.sortType){case c.AsciiCaseSensitive:e=b.factory.headerAsciiTextual(f,a.direction,!0);break;case c.AsciiIgnoreCase:e=b.factory.headerAsciiTextual(f,a.direction,!1);break;case c.NumericAbsolute:e=b.factory.headerAbsolute(f,a.direction);break;default:e=b.factory.header(f,a.direction)}}else{var g=a.keyOrLevel;switch(a.sortType){case c.AsciiCaseSensitive:e=b.factory.asciiTextual(g,a.direction,!0);break;case c.AsciiIgnoreCase:e=b.factory.asciiTextual(g,a.direction,!1);break;case c.NumericAbsolute:e=b.factory.absolute(g,a.direction,a.sortType);break;default:e=b.factory.generic(g,a.direction)}}d.push(e)}),d},e}(b.DataModelAdapter);b.DataTable=d}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(){}return c.cellsIterator=function(a,c,d){var e,f,g=c.getRowAxis(),h=c.getColumnAxis();switch(a.type){case b.GridRangeType.Table:e=g.getSliceRange(0,g.length()),f=h.getSliceRange(0,h.length()),e.forEach(function(a){return f.forEach(function(b){return d(a.key(),b.key())})});break;case b.GridRangeType.Column:e=g.getSliceRange(0,g.length());var i=a.args;e.forEach(function(a){return i.forEach(function(b){return d(a.key(),b)})});break;case b.GridRangeType.Row:f=h.getSliceRange(0,h.length());var j=a.args;j.forEach(function(a){return f.forEach(function(b){return d(a,b.key())})});break;case b.GridRangeType.Cell:var k=a.args;k.forEach(function(a){return d(a.rowKey,a.columnKey)})}},c.fromArgs=function(a,b,d,e){return{type:a,args:b,selectedCellsIterator:function(a){c.cellsIterator(this,d,a)},activeCell:e}},c.noSelection=function(a){return{type:b.GridRangeType.None,selectedCellsIterator:function(b){c.cellsIterator(this,a,b)}}},c.tableSelection=function(a){return{type:b.GridRangeType.Table,selectedCellsIterator:function(b){c.cellsIterator(this,a,b)}}},c.cellsSelection=function(a,d,e){return{type:b.GridRangeType.Cell,args:d,selectedCellsIterator:function(b){c.cellsIterator(this,a,b)},activeCell:e}},c.rowsSelection=function(a,d){return{type:b.GridRangeType.Row,args:d,selectedCellsIterator:function(b){c.cellsIterator(this,a,b)}}},c.columnsSelection=function(a,d){return{type:b.GridRangeType.Column,args:d,selectedCellsIterator:function(b){c.cellsIterator(this,a,b)}}},c.containsCell=function(a,c,d){if(a)switch(a.type){case b.GridRangeType.Cell:return a.args.filter(function(a){return a.rowKey===c&&a.columnKey===d}).length>0;case b.GridRangeType.Row:return a.args.indexOf(c)>-1;case b.GridRangeType.Column:return a.args.indexOf(d)>-1;case b.GridRangeType.Table:return!0}return!1},c.isColumnInSelection=function(a,c){switch(a.type){case b.GridRangeType.Table:case b.GridRangeType.Row:return!0;case b.GridRangeType.Column:return a.args.indexOf(c)>-1;case b.GridRangeType.Cell:return a.args.filter(function(a){return a.columnKey===c}).length>0}return!1},c.isContiguous=function(a,b){var c=b.getRowAxis(),d=b.getColumnAxis(),e=c.length()+1,f=d.length()+1,g=-1,h=-1,i={},j={};a.selectedCellsIterator(function(a,b){var k=c.getSlice(a).index(),l=d.getSlice(b).index(),m=i[k]||0;i[k]=m+1;var n=j[l]||0;j[l]=n+1,k<e&&(e=k),k>g&&(g=k),l<f&&(f=l),l>h&&(h=l)});for(var k=Object.keys(i).length,l=Object.keys(j).length,m=f;m<=h;m++)if(j[m]!==k)return!1;for(var n=e;n<=g;n++)if(i[n]!==l)return!1;return!0},c.extendColumns=function(a,d){switch(d.type){case b.GridRangeType.None:case b.GridRangeType.Column:return d;case b.GridRangeType.Table:case b.GridRangeType.Row:var e=a.getColumnAxis().getSliceRange(0,a.getColumnAxis().length());return c.columnsSelection(a,e.map(function(a){return a.key()}));case b.GridRangeType.Cell:var f=d.args.reduce(function(a,b){return a[b.columnKey]=!0,a},{});return c.columnsSelection(a,Object.keys(f))}},c.extendRows=function(a,d){switch(d.type){case b.GridRangeType.None:case b.GridRangeType.Row:return d;case b.GridRangeType.Table:case b.GridRangeType.Column:var e=a.getRowAxis().getSliceRange(0,a.getRowAxis().length());return c.rowsSelection(a,e.map(function(a){return a.key()}));case b.GridRangeType.Cell:var f={};return d.args.forEach(function(a){f[a.rowKey]=!0}),c.rowsSelection(a,Object.keys(f))}},c.toString=function(c,d,e){function f(c){return c.map(function(c){return a.stringFormat(b.Strings.Text_GridSel_CellFmt,c)})}function g(c,d,e,f){if(!e||0===e.length)return b.Strings.Text_GridSel_None;if(1===e.length)return a.stringFormat(c,{name:f(e[0])});var g=!1;return e.length>j&&(e=e.slice(0,j),g=!0),e=e.map(function(a){return f(a)}),g&&e.push("..."),a.stringFormat(d,{names:e.join(", ")})}function h(a,b){if(!a.contains(b))return b;var c=a.getSlice(b);return c.alias||c.displayName()||b}function i(a,b){for(var c=a.options.getMeasures(),d=0;d<c.length;d++){var e=c[d];if(e===b)return b;if(e.key===b)return e.alias||e.displayName||e.key}return b}var j=e&&e.maxCount||16,k=e&&e.columnsAreMeasures;if(!d)return"<null>";var l=c.getColumnAxis(),m=c.getRowAxis();switch(d.type){case b.GridRangeType.None:return b.Strings.Text_GridSel_None;case b.GridRangeType.Table:return b.Strings.Text_GridSel_Table;case b.GridRangeType.Column:return k?g(b.Strings.Text_GridSel_Measure,b.Strings.Text_GridSel_Measures,d.args,function(a){return i(l,a)}):g(b.Strings.Text_GridSel_Column,b.Strings.Text_GridSel_Columns,d.args,function(a){return h(l,a)});case b.GridRangeType.Row:return g(b.Strings.Text_GridSel_Row,b.Strings.Text_GridSel_Rows,d.args,function(a){return h(m,a)});case b.GridRangeType.Cell:return g(b.Strings.Text_GridSel_Cell,b.Strings.Text_GridSel_Cells,f(d.args),function(a){return a})}},c}();b.SelectionHelper=c}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function b(a,b,c){this.colKey=a,this.condition=b,this.pdma=c}return b.prototype.evaluate=function(b,c){var d,e=b.getValue(c,this.colKey);return d=this.pdma?this.pdma.getPresentedValue(c,this.colKey,e):a.getCellPresentation(e),this.condition.evaluate(d)},b.prototype.shouldEvaluateUpdateEvent=function(a){return a.indexOf(this.colKey)>=0},b.prototype.getRequiredColumns=function(){return[this.colKey]},b}();a.ColumnFilter=b;var c=function(){function a(a){this.filters=a.splice(0)}return a.prototype.evaluate=function(a,b){var c=this.filters.some(function(c){return!c.evaluate(a,b)});return!c},a.prototype.shouldEvaluateUpdateEvent=function(a){var b=this.filters.some(function(b){return b.shouldEvaluateUpdateEvent&&b.shouldEvaluateUpdateEvent(a)});return b},a.prototype.getRequiredColumns=function(){var a={};return this.filters.forEach(function(b){var c=b.getRequiredColumns?b.getRequiredColumns():null;c&&c.forEach(function(b){a[b]=!0})}),Object.keys(a)},a}();a.AndFilter=c;var d=function(b){function c(a,c,d){var e=b.call(this)||this;return e.sourceAxis=a,e.currentFilter=c,e.columnAxis=d,e.forceReset(),e.sourceAxis.options.slicesEvent.add(function(a,b){return e.handleSourceEvent(b)}),e}return __extends(c,b),c.prototype.getLogTypeName=function(){return"FlatFilterAxis"},Object.defineProperty(c.prototype,"filter",{get:function(){return this.currentFilter},set:function(a){this.currentFilter=a,this.forceReset()},enumerable:!0,configurable:!0}),c.binaryIndexOf=function(a,b){for(var c,d,e=0,f=a.length-1;e<=f;)if(c=(e+f)/2|0,d=a[c],d<b)e=c+1;else{if(!(d>b))return c;f=c-1}return~e},c.prototype.findInsertIndex=function(a,b){var d=c.binaryIndexOf(a,b);return d<0&&(d=~d),d},c.prototype.calculateInsertIndexBySourceIndex=function(a){var b=this,c=a;if(this.filter){var d=this.getSliceRange(0,this.length()).map(function(a){return b.sourceAxis.getSlice(a.key()).index()});c=this.findInsertIndex(d,a)}return c},c.prototype.calculateInsertIndexByRowKey=function(a){var b=this.sourceAxis.getSlice(a).index(),c=this.calculateInsertIndexBySourceIndex(b);return c},c.prototype.forceReset=function(){var a=this;this.clear();var b=this.sourceAxis.getSliceRange(0,this.sourceAxis.length()).map(function(b){return a.sourceAxis.getNodeAndMeasureKey(b.key()).nodeKey}),c=b.filter(function(b){return a.evaluateRowVisibility(b)});this.insertBlock(c,0)},c.prototype.evaluateRowVisibility=function(a){return!this.filter||this.filter.isVisibleCallback(a)},c.prototype.forceAdd=function(a){if(!this.contains(a)){var b=this.calculateInsertIndexByRowKey(a);this.insert(a,b)}},c.prototype.forceRemove=function(a){this.contains(a)&&this.remove(a)},c.prototype.processSliceRemoved=function(a){this.forceRemove(a)},c.prototype.processSliceAdded=function(a,b){var c=this;if(this.filter){var d=a.filter(function(a){return c.evaluateRowVisibility(a)});if(d.length>0){var e=this.calculateInsertIndexBySourceIndex(b);this.insertBlock(d,e)}}else this.insertBlock(a,b)},c.prototype.handleSourceEvent=function(b){var c=this;b.forEach(function(b){switch(b.type){case a.SliceEventType.Reset:c.forceReset();break;case a.SliceEventType.SliceAdded:c.processSliceAdded(b.args.nodeKeys,b.args.start);break;case a.SliceEventType.SliceRemoved:b.args.nodeKeys.forEach(function(a){return c.processSliceRemoved(a)})}})},c}(a.FlatAxis);a.FlatFilterAxis=d;var e=function(a){function b(b,c,d,e){var f=a.call(this,b,!0)||this;return f.sourceDataSet=b,f.sourceRowAxis=c,f.rowAxis=d,f.shouldProcessUpdateCallback=e,f.sourceDataSet.rangeUpdated.add(function(a,b){return f.handleSourceEvent(b)}),f}return __extends(b,a),b.prototype.getLogTypeName=function(){return"FilterDataSet"},b.prototype.handleSourceEvent=function(a){var b=this;a.isReset?this.rowAxis.forceReset():a.rowKeys.forEach(function(c){return b.processUpdate(c,a.columnKeys)})},b.prototype.processUpdate=function(a,b){if(this.sourceRowAxis.contains(a))if(this.shouldProcessUpdateCallback(b)){var c=this.rowAxis.evaluateRowVisibility(a);c?this.rowAxis.contains(a)?this.sendUpdate(a,b):this.rowAxis.forceAdd(a):this.rowAxis.contains(a)&&this.rowAxis.forceRemove(a)}else this.rowAxis.contains(a)&&this.sendUpdate(a,b)},b.prototype.sendUpdate=function(a,b){var c={columnKeys:b,rowKeys:[a]};this.raiseRangeUpdated(c)},b.prototype.getSourceRow=function(b,c){return a.prototype.__getRow.call(this,b,c)},b.prototype.getValue=function(b,c){return this.rowAxis.contains(b)?a.prototype.getValue.call(this,b,c):null},b.prototype.getSourceValue=function(b,c){return this.sourceRowAxis.contains(b)?a.prototype.getValue.call(this,b,c):null},b.prototype.__getRow=function(b,c){return this.rowAxis.contains(b)?a.prototype.__getRow.call(this,b,c):{}},b}(a.DataSetAdapter);a.FilterDataSet=e;var f=function(b){function f(c,f){var g=b.call(this,c)||this;g.sourceDm=c,g.currentApplicationFilter=f,g.currentGridFilter=null,g.currentFilter=null,g.refreshCurrentFilter();var h=function(a){return g.currentFilter&&g.currentFilter.shouldEvaluateUpdateEvent&&g.currentFilter.shouldEvaluateUpdateEvent(a)},i=c.getRowAxis(),j=function(a){var b=g.currentFilter&&g.currentFilter.getRequiredColumns&&g.currentFilter.getRequiredColumns()||[];b.forEach(function(b){a[b]=!0})};g.columnAxis=new a.PivotAxisRequiredSlicesAdapter(c.getColumnAxis(),j);var k=g.createAxisFilter();return g.rowAxis=new d(i,k,g.columnAxis),g.dataset=new e(c.getDataSet(),i,g.rowAxis,h),g}return __extends(f,b),f.prototype.getLogTypeName=function(){return"FilterDataModelAdapter"},f.prototype.createAxisFilter=function(){var a=this,b=null;return this.currentFilter&&(b={isVisibleCallback:function(b){return a.currentFilter.evaluate(a.sourceDm.getDataSet(),b)}}),b},Object.defineProperty(f.prototype,"gridFilter",{get:function(){return this.currentGridFilter},set:function(a){this.currentGridFilter=a,this.refreshCurrentFilter(),this.applyCurrentFilter()},enumerable:!0,configurable:!0}),f.prototype.refreshCurrentFilter=function(){if(this.currentFilter=null,this.currentGridFilter||this.currentApplicationFilter){var a=[];this.currentGridFilter&&a.push(this.currentGridFilter),this.currentApplicationFilter&&a.push(this.currentApplicationFilter),this.currentFilter=new c(a)}},f.prototype.applyCurrentFilter=function(){this.columnAxis.options.refreshRequiredSlices();var a=this.createAxisFilter();this.rowAxis.filter=a},Object.defineProperty(f.prototype,"filter",{get:function(){return this.currentApplicationFilter},set:function(a){this.currentApplicationFilter=a,this.refreshCurrentFilter(),this.applyCurrentFilter()},enumerable:!0,configurable:!0}),f.prototype.getDataSet=function(){return this.dataset},f.prototype.getRowAxis=function(){return this.rowAxis},f.prototype.getColumnAxis=function(){return this.sourceDm.getColumnAxis()},f.prototype.getSourceRowAxis=function(){return this.sourceDm.getRowAxis()},f}(a.DataModelAdapter);a.FilterDataModelAdapter=f}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.Add=0]="Add",a[a.Remove=1]="Remove",a[a.Update=2]="Update",a[a.Reset=3]="Reset"}(b=a.SummaryInputEventType||(a.SummaryInputEventType={}));var c=function(a){function c(b,c){var d=a.call(this,b)||this;return d.sourceDataSet=b,d.summaryHandler=c,d.data={},d.sourceDataSet.rangeUpdated.add(function(a,b){return d.handleSourceEvent(b)}),d}return __extends(c,a),c.prototype.processRowAdd=function(a){if(this.summaryHandler){var c={eventType:b.Add,itemKey:a,dataSet:this,isGrandTotal:!0},d=this.summaryHandler(c);d&&this.setSummaryValues(d)}},c.prototype.processRowRemove=function(a){if(this.summaryHandler){var c={eventType:b.Remove,itemKey:a,dataSet:this,isGrandTotal:!0},d=this.summaryHandler(c);d&&this.setSummaryValues(d)}},c.prototype.processReset=function(){if(this.data={},this.summaryHandler){var a={eventType:b.Reset,dataSet:this,isGrandTotal:!0},c=this.summaryHandler(a);c&&this.setSummaryValues(c)}},c.prototype.getValue=function(b,c){if(b===e.GRAND_TOTAL_KEY)return this.data[c];var d=a.prototype.getValue.call(this,b,c);return d},c.prototype.__getRow=function(b,c){return b===e.GRAND_TOTAL_KEY?this.data:a.prototype.__getRow.call(this,b,c)},c.prototype.setSummaryValues=function(b){var c=this;Object.getOwnPropertyNames(b.values).forEach(function(a){var d=b.values[a];c.data[a]=d});var d={columnKeys:Object.getOwnPropertyNames(b.values),rowKeys:[e.GRAND_TOTAL_KEY]};a.prototype.raiseRangeUpdated.call(this,d)},c.prototype.processUpdate=function(a,c){var d={eventType:b.Update,itemKey:a,dataSet:this,changedKeys:c,isGrandTotal:!0};if(this.summaryHandler){var e=this.summaryHandler(d);this.setSummaryValues(e)}},c.prototype.handleSourceEvent=function(a){var b=this;a.rowKeys.forEach(function(c){return b.processUpdate(c,a.columnKeys)})},c}(a.DataSetAdapter),d=function(b){function c(a,d){var e=b.call(this,c.createPivotAxisConfig())||this;return e.sourceAxis=a,e.aggregationDataSet=d,e.reset(),a.options.slicesEvent.add(function(a,b){return e.handleSourceEvent(b)}),e}return __extends(c,b),c.createPivotAxisConfig=function(){var b=new a.TreeNode(e.GRAND_TOTAL_KEY);return{mode:a.AxisViewMode.Normal,visibleLevelSummaries:[!0],root:b}},c.prototype.reset=function(){var a=this,b=this.options.getVisibleRoot();this.options.requestExpandState(b.key(),!0);var c=b.children();this.options.removeBlock(b,0,c.length),this.aggregationDataSet.processReset();var d=this.sourceAxis.getSliceRange(0,this.sourceAxis.length()).map(function(b){return a.sourceAxis.getNodeAndMeasureKey(b.key()).nodeKey});d.forEach(function(b){return a.processAdd(b)})},c.prototype.processAdd=function(b){var c=this.options.getVisibleRoot();this.options.append(c,new a.TreeNode(b)),this.aggregationDataSet.processRowAdd(b)},c.prototype.processRemove=function(a){var b=this.options.getVisibleRoot();this.options.remove(b,a),this.aggregationDataSet.processRowRemove(a)},c.prototype.handleSourceEvent=function(b){var c=this;b.forEach(function(b){switch(b.type){case a.SliceEventType.Reset:c.reset();break;case a.SliceEventType.SliceAdded:b.args.keys.forEach(function(a){return c.processAdd(a)});break;case a.SliceEventType.SliceRemoved:b.args.keys.forEach(function(a){return c.processRemove(a)})}})},c}(a.PivotAxis),e=function(a){function b(b,e){var f=a.call(this,b)||this;return f.sourceDm=b,f.dataSet=new c(f.sourceDm.getDataSet(),e),f.rowAxis=new d(f.sourceDm.getRowAxis(),f.dataSet),f}return __extends(b,a),b.prototype.getDataSet=function(){return this.dataSet},b.prototype.getRowAxis=function(){return this.rowAxis},b.prototype.getColumnAxis=function(){return this.sourceDm.getColumnAxis()},b.GRAND_TOTAL_KEY=".",b}(a.DataModelAdapter);a.AggregationDataModelAdapter=e}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(a){function c(b,c){var d=a.call(this,b,c)||this;return d._loggerFactory=b,d._commService=c,d}return __extends(c,a),c.prototype.createDataTable=function(a,c){return new b.DataTable(a,this._loggerFactory,this,c)},c.prototype.createScrollerDataModel=function(a,c){return new b.ScrollerDataModel(this._commService,this._loggerFactory,null,c)},c.prototype.createValidationDataModel=function(a){return new b.ValidationDataModelAdapter(a)},c}(b.CommDmFactory);b.DataModelFactory=c,a.module("ionwebGrids").service("dataModelFactory",["ionweb.loggerFactory","ionweb.commService"],function(a,b){return new c(a,b)})}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){a[a.RowAdded=0]="RowAdded",a[a.RowRemoved=1]="RowRemoved",a[a.CellUpdated=2]="CellUpdated",a[a.ResetGrid=3]="ResetGrid"}(b=a.GridStatEventType||(a.GridStatEventType={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b=function(){function a(a,b,c){this.counterName=a,this.contextEntries=c,this.entries=b.reduce(function(a,b){return a[b]=0,a},{})}return a.prototype.getCounters=function(){var a=this,b={};return b=Object.getOwnPropertyNames(this.entries).reduce(function(b,c){return b[c]=a.entries[c],a.entries[c]=0,b},b),b=Object.getOwnPropertyNames(this.contextEntries).reduce(function(b,c){return b[c]=a.contextEntries[c],b},b)},a}();a.GenericGridStatisticsProvider=b;var c=function(){function a(c,d){this._gridId=c,this._dataModelId=d;var e=[a._totalRows,a._totalCols,a._rowAddedCount,a._rowRemovedCount,a._updatedCellCount,a._resetEventCount,a._rowEventCount,a._cellEventCount],f={Instance:c,DataModel:d};this.statsProvider=new b("GridStatistic",e,f)}return a.prototype.incrementCounter=function(a,b){this.statsProvider.entries[a]+=b},a.prototype.reportReset=function(){this.incrementCounter(a._resetEventCount,1)},a.prototype.reportAddRows=function(b){this.incrementCounter(a._rowEventCount,1),this.incrementCounter(a._rowAddedCount,b)},a.prototype.reportRemoveRows=function(b){this.incrementCounter(a._rowEventCount,1),this.incrementCounter(a._rowRemovedCount,b)},a.prototype.reportCellUpdate=function(b){this.incrementCounter(a._cellEventCount,1),this.incrementCounter(a._updatedCellCount,b)},a.prototype.reportTotalRows=function(b){this.statsProvider.entries[a._totalRows]=b},a.prototype.reportTotalCols=function(b){this.statsProvider.entries[a._totalCols]=b},Object.defineProperty(a.prototype,"gridId",{get:function(){return this._gridId},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"dataModelId",{get:function(){return this._dataModelId},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"gridStatsData",{get:function(){return{gridId:this._gridId,dataModelId:this._dataModelId,totalRows:this.statsProvider.entries[a._totalRows],totalCols:this.statsProvider.entries[a._totalCols],rowsAddedCount:this.statsProvider.entries[a._rowAddedCount],rowsRemovedCount:this.statsProvider.entries[a._rowRemovedCount],cellsUpdatedCount:this.statsProvider.entries[a._updatedCellCount],resetEventCount:this.statsProvider.entries[a._resetEventCount],rowEventCount:this.statsProvider.entries[a._rowEventCount],cellUpdatedEventCount:this.statsProvider.entries[a._cellEventCount]}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"name",{get:function(){return this.statsProvider.counterName},enumerable:!0,configurable:!0}),a.prototype.getCounters=function(){return this.statsProvider.getCounters()},a._rowEventCount="RowEvents",a._cellEventCount="CellUpdateEvents",a._resetEventCount="ResetEvents",a._rowAddedCount="RowsAdded",a._rowRemovedCount="RowsRemoved",a._updatedCellCount="CellsUpdated",a._totalRows="Rows",a._totalCols="Cols",a}();a.GridStatsProvider=c;var d=function(){function a(c){this._dataModelId=c;var d=[a._rowAddedCount,a._rowRemovedCount,a._updatedCellCount,a._discaredCellCount],e={Instance:c};this.statsProvider=new b("DataModelStatistic",d,e)}return a.prototype.incrementCounter=function(a,b){this.statsProvider.entries[a]+=b},a.prototype.reportAddRows=function(b){this.incrementCounter(a._rowAddedCount,b)},a.prototype.reportRemoveRows=function(b){this.incrementCounter(a._rowRemovedCount,b)},a.prototype.reportCellUpdate=function(b){this.incrementCounter(a._updatedCellCount,b)},a.prototype.reportCellDiscarded=function(b){this.incrementCounter(a._discaredCellCount,b)},Object.defineProperty(a.prototype,"dataModelId",{get:function(){return this._dataModelId},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"name",{get:function(){return this.statsProvider.counterName},enumerable:!0,configurable:!0}),a.prototype.getCounters=function(){return this.statsProvider.getCounters()},a._rowAddedCount="RowsAdded",a._rowRemovedCount="RowsRemoved",a._updatedCellCount="CellsUpdated",a._discaredCellCount="CellsDiscarded",a}();a.CommLayerDataModelStatsProvider=d}(ionweb||(ionweb={}));var ionweb;!function(a){var b=function(){function b(b,c){this._dataModel=c,this.gridStatsProvider=new a.GridStatsProvider(b,this._dataModel.getLogId())}return b.prototype.updateRowAndColsCount=function(){var a=this._dataModel.getRowAxis().length(),b=this._dataModel.getColumnAxis().options.getVisibleRoot().length();this.gridStatsProvider.reportTotalRows(a>0&&a||0),this.gridStatsProvider.reportTotalCols(b>0&&b||0)},b.prototype.logGridStat=function(b,c){switch(c.gridStatEventType){case a.GridStatEventType.RowAdded:this.gridStatsProvider.reportAddRows(c.count),this.updateRowAndColsCount();break;case a.GridStatEventType.RowRemoved:this.gridStatsProvider.reportRemoveRows(c.count),this.updateRowAndColsCount();break;case a.GridStatEventType.CellUpdated:this.gridStatsProvider.reportCellUpdate(c.count),this.updateRowAndColsCount();break;case a.GridStatEventType.ResetGrid:this.gridStatsProvider.reportReset()}},Object.defineProperty(b.prototype,"statsProvider",{get:function(){return this.gridStatsProvider},enumerable:!0,configurable:!0}),b}();a.GridStatsAdapter=b}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(b){var c;!function(a){a[a.None=0]="None",a[a.ForceAscending=1]="ForceAscending",a[a.ForceDescending=2]="ForceDescending",a[a.Toggle=3]="Toggle",a[a.ResetAll=4]="ResetAll"}(c=b.SortAction||(b.SortAction={}));var d=function(){function a(){}return a}(),e=function(){function b(a,b){this.dataModel=a,this.logger=b,this.currentSorting=[],this.currentColumnSorting=[]}return b.prototype.getSortRowAxis=function(){if(this.dataModel){var b=this.dataModel.getRowAxis().getAs(a.VirtualSortingPivotAxisAdapter)||this.dataModel.getRowAxis().getAs(a.SortingPivotAxisAdapter);return b&&b.hasUserSorting&&b}return null},b.prototype.getSortColumnAxis=function(){if(this.dataModel){var b=this.dataModel.getColumnAxis().getAs(a.VirtualSortingPivotAxisAdapter)||this.dataModel.getColumnAxis().getAs(a.SortingPivotAxisAdapter);return b&&b.hasUserSorting&&b}return null},Object.defineProperty(b.prototype,"isAvailable",{get:function(){return!!this.getSortRowAxis()},enumerable:!0,configurable:!0}),b.prototype.sortingCriteriaValidator=function(b,c){var d=b instanceof a.LevelSortCriterion,e=b.sortingKey;return!(!d&&c===a.AxisType.Row&&e&&!this.dataModel.getColumnAxis().contains(e))},b.prototype.setCurrentSorting=function(a){return this.currentSorting=a},b.prototype.getCurrentSorting=function(){return this.currentSorting},b.prototype.setCurrentColumnSorting=function(a){return this.currentColumnSorting=a},b.prototype.getNextDirection=function(b,d){switch(b){case a.SortDirection.Ascending:return c.ForceDescending;case a.SortDirection.Descending:return d?c.None:c.ForceAscending;default:return c.ForceAscending}},b.prototype.setSortingOperation=function(b,d){var e=this;return d.action===c.ResetAll?this.currentSorting=[]:d.action===c.None?b.forEach(function(a){return e.resetSorting(a)}):b.forEach(function(b){return e.setSorting(b,d.action===c.ForceAscending?a.SortDirection.Ascending:a.SortDirection.Descending,!0,d.sortType)}),this.currentSorting},b.prototype.applySortAction=function(b,d,e,f,g){var h=this,i=[],j=!1,k=f||b.filter(function(a){return a.keyOrLevel===d}).length>0,l=1===b.length;if(b.forEach(function(b){if(b.keyOrLevel===d){if(j=!0,e===c.Toggle&&(e=h.getNextDirection(b.direction,l)),e!==c.None){var f=0;0!==g&&(f=g||b.sortType||h.getPreferredSortType(d)),i.push({direction:e===c.ForceAscending?a.SortDirection.Ascending:a.SortDirection.Descending,keyOrLevel:d,sortType:f})}}else k&&i.push(b)}),!j&&e!==c.None){var m=e===c.ForceDescending?a.SortDirection.Descending:a.SortDirection.Ascending,n=this.createSortedColumn(d,m);i.push(n)}return i},b.prototype.createSortedColumn=function(a,b,c){return{keyOrLevel:a,direction:b,sortType:c||this.getPreferredSortType(a)}},b.prototype.toggleSorting=function(a,b){var d=this,e=this.applySortAction(this.currentSorting,a,c.Toggle,b);return this.currentSorting.length>e.length&&this.currentSorting.length>1?(this.logger.logAskToggleSorting(a,b),this.showChangeConfirmation().then(function(c){return c?(d.logger.logToggleSorting(a,b),d.setCurrentSorting(e)):(d.logger.logToggleCanceled(a,b),Q.reject())})):(this.logger.logToggleSorting(a,b),this.setCurrentSorting(e),Q.when(e))},b.prototype.resetSorting=function(a){return this.setCurrentSorting(this.currentSorting.filter(function(b){return b.keyOrLevel!==a}))},b.prototype.getSortingOperations=function(b,e){var f,g=this;return 1===b.length?f=this.getSortingOperationsSingle(b[0],e):(f=new d,f.noneAvailable=b.some(function(a){return g.getSortingOperationsSingle(a,e).noneAvailable})),e.getAs(a.VirtualSortingPivotAxisAdapter)&&(f.absoluteVisible=!1),[{direction:a.SortDirection.Ascending,text:a.Strings.Grid_Menu_Sorting_Asc,action:c.ForceAscending,available:f.ascendingAvailable,sortType:a.SortType.Generic},f.absoluteVisible?{direction:a.SortDirection.Ascending,text:a.Strings.Grid_Menu_Sorting_Asc_Abs,action:c.ForceAscending,available:f.ascendingAbsoluteAvailable,sortType:a.SortType.NumericAbsolute}:void 0,{direction:a.SortDirection.Descending,text:a.Strings.Grid_Menu_Sorting_Desc,action:c.ForceDescending,available:f.descendingAvailable,sortType:a.SortType.Generic},f.absoluteVisible?{direction:a.SortDirection.Descending,text:a.Strings.Grid_Menu_Sorting_Desc_Abs,action:c.ForceDescending,available:f.descendingAbsoluteAvailable,sortType:a.SortType.NumericAbsolute}:void 0,{direction:null,text:a.Strings.Grid_Menu_Sorting_None,action:c.None,available:f.noneAvailable},null,{direction:null,text:a.Strings.Grid_Menu_Sorting_Reset,action:c.ResetAll,available:this.currentSorting.length>0}].filter(function(a){return void 0!==a})},b.prototype.getCurrentSortResponsiveConfig=function(){var b={groupToColumns:{},columnToGroup:{},groupToSortingKey:{}},c=this.dataModel.getAs(a.ResponsiveDataModel),d=c&&c.getConfiguration(),e=d&&d.groups;return e?(Object.getOwnPropertyNames(e).forEach(function(a){b.groupToColumns[a]=e[a].groupDef.groupableKeys,b.groupToSortingKey[a]=e[a].groupDef.sortingKey,e[a].groupDef.groupableKeys.forEach(function(c){b.columnToGroup[c]=a})}),b):null},b.prototype.getColumnSortingKeyForKeyOrLevel=function(a){var b=this.getCurrentSortResponsiveConfig();return b&&b.groupToColumns[a]?b.groupToSortingKey[a]:a},b.prototype.getSortingOperationsSingle=function(b,c){var e=this.getColumnSortingKeyForKeyOrLevel(b);if(!e||c.disabledKeys[e]){var f=new d;return f}var g=this.currentSorting.filter(function(a){return a.keyOrLevel===e}),h=g.length>0?g[0]:null,i=this.getPreferredSortType(e),j=i===a.SortType.AsciiCaseSensitive||i===a.SortType.AsciiIgnoreCase||i===a.SortType.StringNatural,k=new d;return k.ascendingAvailable=!0,k.descendingAvailable=!0,k.ascendingAbsoluteAvailable=!j,k.descendingAbsoluteAvailable=!j,
k.absoluteVisible=!j,h&&(h.direction===a.SortDirection.Ascending?(k.ascendingAvailable=k.ascendingAvailable&&h.sortType===a.SortType.NumericAbsolute,k.ascendingAbsoluteAvailable=k.ascendingAbsoluteAvailable&&h.sortType===a.SortType.Generic||!h.sortType):(k.descendingAvailable=k.descendingAvailable&&h.sortType===a.SortType.NumericAbsolute,k.descendingAbsoluteAvailable=k.descendingAbsoluteAvailable&&h.sortType===a.SortType.Generic||!h.sortType),k.noneAvailable=!0),k},b.prototype.setSorting=function(b,d,e,f){return f=f||a.SortType.Generic,this.currentSorting=this.applySortAction(this.currentSorting,b,d===a.SortDirection.Ascending?c.ForceAscending:c.ForceDescending,e,f)},b.prototype.convertSortedColumn=function(b){return a.DataTable.convertSortedColumn(b,this.getSortRowAxis())},b.prototype.updateColumnSortCriteria=function(b){var c=this;this.logger.logSortBeginConfiguration(a.AxisType.Column),a.DataTable.convertSortCriteria(b).forEach(function(b){c.logger.logSortConfigurationItem(a.AxisType.Column,b.keyOrLevel,b.direction===a.SortDirection.Ascending,a.SortType[b.sortType])}),this.logger.logSortEndConfiguration(a.AxisType.Column)},b.prototype.getPreferredSortType=function(b){if(!this.dataModel)return a.SortType.Generic;if("string"==typeof b){var c=this.dataModel.getColumnAxis();if(!c.contains(b))return this.getSortType(b);var d=c.getNodeAndMeasureKey(b);return d.measureKey?this.getSortType(d.measureKey):this.getSortType(d.nodeKey)}return this.getSortHeaderType(b)},b.prototype.getSortType=function(b){var c=this.getSortRowAxis();return c&&c.preferredTypes[b]||a.SortType.Generic},b.prototype.getSortHeaderType=function(b){var c=this.getSortRowAxis();return c&&c.preferredTypesLevel[b]||a.SortType.Generic},b.prototype.setSortType=function(a,b){this.getSortRowAxis().preferredTypes[a]=b},b.prototype.setSortHeaderType=function(a,b){this.getSortRowAxis().preferredTypesLevel[a]=b},b.prototype.setColumnSortingOperation=function(b,d){var e=this;return b.action===c.ResetAll?this.currentColumnSorting=[]:b.action===c.None?d.forEach(function(a){return e.resetColumnSorting(a)}):d.forEach(function(d){return e.setColumnSorting(d,b.action===c.ForceAscending?a.SortDirection.Ascending:a.SortDirection.Descending,!0,b.sortType)}),this.currentColumnSorting},b.prototype.resetColumnSorting=function(a){return this.setCurrentColumnSorting(this.currentColumnSorting.filter(function(b){return b.keyOrLevel!==a}))},b.prototype.setColumnSorting=function(b,d,e,f){return f=f||a.SortType.Generic,this.currentColumnSorting=this.applySortAction(this.currentColumnSorting,b,d===a.SortDirection.Ascending?c.ForceAscending:c.ForceDescending,e,f)},b.prototype.convertSortedColumnForColumnAxis=function(b){return a.DataTable.convertSortedColumn(b,this.getSortColumnAxis())},b.prototype.getColumnSortingOperations=function(b,d){if("undefined"!=typeof d){var e=this.getColumnSortingOperationsSingle(d);return[{direction:a.SortDirection.Ascending,text:a.Strings.Grid_Menu_Sorting_Asc,action:c.ForceAscending,available:e.ascendingAvailable,sortType:a.SortType.Generic},{direction:a.SortDirection.Descending,text:a.Strings.Grid_Menu_Sorting_Desc,action:c.ForceDescending,available:e.descendingAvailable,sortType:a.SortType.Generic},{direction:null,text:a.Strings.Grid_Menu_Sorting_None,action:c.None,available:e.noneAvailable}].filter(function(a){return void 0!==a})}return[{direction:null,text:a.Strings.Grid_Menu_Sorting_Reset,action:c.ResetAll,available:this.currentColumnSorting.length>0}].filter(function(a){return void 0!==a})},b.prototype.getColumnSortingOperationsSingle=function(b){var c=this.getCurrentColumnSorting(b),e=new d;return e.ascendingAvailable=!0,e.descendingAvailable=!0,c&&(c.direction===a.SortDirection.Ascending?e.ascendingAvailable=!1:e.descendingAvailable=!1,e.noneAvailable=!0),e},b.prototype.getCurrentColumnSorting=function(a){var b=this.currentColumnSorting.filter(function(b){return b.keyOrLevel===a});return b.length>0?b[0]:null},b}();b.ManagerBase=e}(b=a.sorting||(a.sorting={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function b(a,b){this.columnAxis=a,this.gridOptions=b}return b.prototype.toGridxState=function(b){var c=0;return 0!==(b&a.ExpandState.SwitchInProgress)?c=2:0!==(b&a.ExpandState.Expanded)?c=3:0!==(b&a.ExpandState.Collapsed)&&(c=1),c},b.prototype.addNode=function(a,b){var c=this.tree[a.key()];if(!c){c={name:a.displayName(),key:a.key(),measureCount:0,parent:null,children:[],additionalClass:a.headerClass(),state:this.toGridxState(this.columnAxis.options.getExpandState(a.key()))},this.tree[a.key()]=c;var d=a.parent();d&&d.displayName()&&!d.isPlaceholder?(c.parent=this.addNode(d,b+1),c.parent.children.push(c)):(this.roots.push({node:c,depth:b}),b>this.maxDepth&&(this.maxDepth=b))}return c},b.prototype.getVerticalGroup=function(a,b,c){var d=this;if(c>b)return[{name:"",children:this.getVerticalGroup(a,b,c-1)}];if(0===a.measureCount){var e=[];return a.children.forEach(function(a){return e=e.concat(d.getVerticalGroup(a,b-1,c-1))}),this.gridOptions.compactColumnMode&&!a.parent?e:[{name:a.name,id:a.key,children:e,additionalClass:a.additionalClass,state:a.state}]}var f=[{name:a.name,id:a.key,children:a.measureCount,additionalClass:a.additionalClass,state:a.state}];return a.children.forEach(function(e){var g=d.gridOptions.compactColumnMode&&!a.parent?c-1:c;f=f.concat(d.getVerticalGroup(e,b-1,g))}),f},b.prototype.prepareRootGroup=function(){var a=this,b=this.columnAxis.getSliceRange(0,this.columnAxis.length()),c=b.map(function(b){return a.columnAxis.options.getTreeNode(a.columnAxis.getNodeAndMeasureKey(b.key()).nodeKey)});this.lastNode=null,this.tree={},this.roots=[],this.maxDepth=0,c.forEach(function(b){if(a.lastNode&&a.lastNode.key===b.key())a.lastNode.measureCount++;else if(!b.isPlaceholder){var c=a.addNode(b,0);c.measureCount=1,a.lastNode=c}});var d=[];return this.roots.forEach(function(b){1===a.roots.length&&a.gridOptions.compactColumnMode&&0===a.columnAxis.options.getTreeNode(b.node.key).length()||(d=d.concat(a.getVerticalGroup(b.node,b.depth,a.maxDepth)))}),1!==d.length||d[0].name?d:[]},b}();a.ColumnBuilder=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.Comma=1]="Comma",a[a.Tab=2]="Tab"}(b=a.ColumnSeparatorChar||(a.ColumnSeparatorChar={}));var c="\r\n",d=function(){function d(a,c,d){this.dataModel=a,this.options=c,this.outlineConfiguration=d,this.columnSeparator=c.columnSeparator===b.Comma?",":"\t"}return d.prototype.exportToText=function(b){var c=this.getRowKeys(b),d=this.dataModel.getAs(a.ResponsiveDataModel),e=d?d.getSourceDataModel():this.dataModel,f=this.getColumnKeys(b,d);return this.performExportToText(c,f,e)},d.prototype.performExportToText=function(a,b,d){var e=this,f="",g=0,h=!0;if(this.outlineConfiguration){var i=this.getLevelTitles(this.outlineConfiguration,a,b);this.options.excludeRowHeader||this.options.excludeColumnHeader||i.forEach(function(a){h||(f+=e.columnSeparator),h=!1,f+=e.escape(a)}),g=i.length}else this.options.excludeRowHeader||this.options.excludeColumnHeader||(f+=this.columnSeparator);return this.options.excludeColumnHeader||(b.forEach(function(a){h||(f+=e.columnSeparator),h=!1;for(var b=e.getColumnCaption(a,d),c=d.getColumnAxis().options,g=c.getNodeKey(a),i=c.getTreeNode(g);i;)i.key()!==a&&!i.isPlaceholder&&i.displayName()&&(b+=" ("+i.displayName()+")"),i=i.parent();f+=e.escape(b)}),f+=c),h=!0,a.forEach(function(a){if(h||(f+=c),h=!1,!e.options.excludeRowHeader)if(g>0){var i=e.getOutlineGroupValues(a,g,e.outlineConfiguration,d);i.forEach(function(a){f+=e.escape(a),f+=e.columnSeparator})}else e.outlineConfiguration||(f+=e.escape(d.getRowAxis().getSlice(a).displayName()),f+=e.columnSeparator);f+=e.serializeRow(a,b,d)}),f},d.prototype.serializeRow=function(a,b,c){var d=this,e="";return b.forEach(function(b,f){f>0&&(e+=d.columnSeparator);var g=d.getFormattedCellValue(a,b,c);e+=d.escape(g||"")}),e},d.prototype.getRowKeys=function(b){var c,d,e=this,f=this.dataModel.getAs(a.ScrollerDataModel);f&&(d=f.getActualRowWindowData());var g=this.dataModel.getRowAxis();switch(b.type){case a.GridRangeType.None:return[];case a.GridRangeType.Column:case a.GridRangeType.Table:var h=d?d.start:0,i=d?d.count:g.length();return g.getSliceRange(h,i).map(function(a){return a.key()});case a.GridRangeType.Row:c=b.args;break;case a.GridRangeType.Cell:var j={},k=b.args;k.forEach(function(a){return j[a.rowKey]=!0}),c=Object.keys(j);break;default:throw new Error(a.Strings.Err_Exporter_Illegal_Argument+b.type)}if(d){var l={};g.getSliceRange(d.start,d.count).forEach(function(a){return l[a.key()]=!0}),c=c.filter(function(a){return!!l[a]})}if(!f){var m=function(a,b){var c=e.dataModel.getRowAxis().getSlice(a).index(),d=e.dataModel.getRowAxis().getSlice(b).index();return c-d},n=c.sort(m);return n}return c},d.prototype.expandColumns=function(a,b){var c=[];return a.forEach(function(a){var d=b.getSourceColumnKeys(a);d.forEach(function(a){c.push(a)})}),c},d.prototype.getColumnKeys=function(b,c){var d,e=this.dataModel.getColumnAxis();switch(b.type){case a.GridRangeType.None:d=[];break;case a.GridRangeType.Row:case a.GridRangeType.Table:d=e.getSliceRange(0,e.length()).map(function(a){return a.key()});break;case a.GridRangeType.Column:d=b.args;break;case a.GridRangeType.Cell:var f={},g=b.args;g.forEach(function(a){return f[a.columnKey]=!0}),d=Object.keys(f);break;default:throw new Error(a.Strings.Err_Exporter_Illegal_Argument+b.type)}return c?this.expandColumns(d,c):d},d.prototype.getLevelTitles=function(a,b,c){var d=a.rowLevelDescriptors.filter(function(b,c){return!a.compact||c>0}).map(function(a){return a.alias||a.caption||""});return d},d.prototype.getColumnCaption=function(a,b){var c=b.getColumnAxis(),d=c.getSlice(a).alias||c.getSlice(a).displayName();return d},d.prototype.getOutlineGroupValues=function(a,b,c,d){for(var e=[],f=d.getRowAxis().options.getNodeKey(a),g=d.getRowAxis().options.getTreeNode(f),h=d.getRowAxis().options.getVisibleRoot();g&&(!c.compact||h!==g||a===h.key());)e.splice(0,0,g.displayName()),g=g.parent();var i=b-e.length;if(i<0)for(var j=i;j<0;j++){var k=e.length-1;e.splice(k,1)}else for(var l=0;l<i;l++)e.push("");return e},d.prototype.getFormattedCellValue=function(b,c,d){return a.getCellPresentation(d.getDataSet().getValue(b,c)).getFormatted(a.PresentationContext.Export)},d.prototype.escape=function(a){return a?("string"!=typeof a&&(a="function"==typeof a.toString?a.toString():"[INVALID]"),(a.indexOf('"')>=0||a.indexOf(this.columnSeparator)>=0)&&(a='"'+a.replace(/"/g,'""')+'"'),a):a},d}();a.DataExporter=d}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function b(){}return b.prototype.checkAdjacency=function(a,b){if(a.length<=1)return a;var c=a.map(function(a){return{key:a,index:b(a)}}).sort(function(a,b){return a.index-b.index});if(c[0].index<0)return null;for(var d=1;d<c.length;d++)if(c[d].index-c[d-1].index!==1)return null;return c.map(function(a){return a.key})},b.prototype.createKeyMatrix=function(a){var b={},c=function(a){var c=b[a];return c||(c=[],b[a]=c),c};return a.forEach(function(a){var b=c(a.rowKey);return b.indexOf(a.columnKey)>=0?null:void b.push(a.columnKey)}),b},b.prototype.parseSelection=function(a,b){if(0===a.length)return null;var c=this.createKeyMatrix(a),d=Object.keys(c),e=this.checkAdjacency(d,b.rows.getIndex);if(!e)return null;var f=c[d[0]],g=this.checkAdjacency(f,b.columns.getIndex);if(!g)return null;for(var h=1;h<d.length;h++){var i=d[h],j=c[i];if(j.length!==f.length)return null;for(var k=0;k<j.length;k++)if(f.indexOf(j[k])<0)return null}var l={rowKeys:e,columnKeys:g};return l},b.prototype.parseClipboardContent=function(a){var b=a.lastIndexOf("\r\n"),c=b>=0&&b===a.length-2,d=a.split("\r\n"),e=d;c&&d.length>1&&(e=d.slice(0,d.length-1));for(var f=0,g=e.map(function(a){var b=a.split("\t");return f=Math.max(f,b.length),b}),h=0;h<g.length;h++)for(var i=g[h];i.length<f;)i.push("");return g},b.prototype.appendRow=function(a,b,c,d,e){for(var f=d.getIndex(b),g=d.getCount(),h=0;h+f<g&&h<c.length;){var i=c[h],j={rowKey:a,columnKey:d.getKey(h+f),value:i};e.push(j),h++}},b.prototype.appendBlock=function(a,b,c,d,e){for(var f=d.rows,g=f.getIndex(a),h=f.getCount(),i=0;i+g<h&&i<c.length;){var j=f.getKey(i+g),k=c[i];this.appendRow(j,b,k,d.columns,e),i++}},b.prototype.computePastedCells=function(a,b,c){var d=[],e=a.length,f=b.rowKeys.length,g=f%e,h=1;0===g&&(h=f/e);for(var i=b.columnKeys[0],j=0;j<h;j++){var k=b.rowKeys[j*e];this.appendBlock(k,i,a,c,d)}return d},b.prototype.processClipboard=function(b,c,d){var e={},f=this.parseSelection(c,d);if(f){var g=this.parseClipboardContent(b),h=this.computePastedCells(g,f,d);h?e.cells=h:e.error=a.Strings.Grid_Paste_Error_UnsupportedSelection}else e.error=a.Strings.Grid_Paste_Error_UnsupportedSelection;return e},b.prototype.preparePaste=function(a,b,c){var d=function(a,b){var c=b.getSlice(a);return c?c.index():-1},e=function(a,b){var c=b.getSliceRange(a,1);return c&&c.length>0?c[0].key():null},f={getIndex:function(a){return d(a,c.getRowAxis())},getCount:function(){return c.getRowAxis().length()},getKey:function(a){return e(a,c.getRowAxis())}},g={getIndex:function(a){return d(a,c.getColumnAxis())},getCount:function(){return c.getColumnAxis().length()},getKey:function(a){return e(a,c.getColumnAxis())}},h={rows:f,columns:g},i=this.processClipboard(a,b,h);return i},b}();a.GridClipboardServiceBase=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(b){var c=function(){function b(){}return b.getSourceColumns=function(a,b){return b?b.getSourceColumnKeys(a):[a]},b.getSummaryPanelInfo=function(c,d,e){if(d){var f=c.getAs(a.ResponsiveDataModel),g=f?f.getSourceDataModel():c,h=0,i=0,j=0,k=0,l=0,m=null,n=null;if(d.selectedCellsIterator(function(a,c){var d=b.getSourceColumns(c,f);d.forEach(function(b){var c=g.getDataSet().getValue(a,b),d=null;"number"==typeof c?d=c:c&&"number"==typeof c.rawValue&&(d=c.rawValue),j++,"number"==typeof d&&k++,null!==d&&(h+=d,l++,(null===m||d>=m)&&(m=d),(null===n||d<=n)&&(n=d))})}),l&&(i=h/l),!e||h!==e.sum.rawValue||m!==e.max.rawValue||n!==e.min.rawValue||j!==e.count||k!==e.countNum){var o=c.getAs(a.PresentationDataModelAdapter),p=null;if(o){var q=o.tableAppliedFormattingOptions(),r=a.PresentationDataModelAdapter.getPresentersWithFormatting(q);p=r.numericPresenter}else p=function(a){var b="number"==typeof a;return{isNegative:a<0,isNumeric:b,getFormatted:function(){return b?a.toFixed(3):"0.000"}}};m=m||0,n=n||0;var s={sum:p(h),avg:p(i),count:j,countNum:k,max:p(m),min:p(n)};return s.sum.rawValue=h,s.avg.rawValue=i,s.max.rawValue=m,s.min.rawValue=n,s}}return null},b}();b.Model=c}(b=a.summaryPanel||(a.summaryPanel={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){}return a.setDisplayItem=function(a,b){return a.displayName=b.displayName,a.alias=b.alias,a.description=b.description,a.tooltip=b.tooltip,a.category=b.category,a},a}();a.DataTableHelper=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){}return a.Text_GridSel_None="None",a.Text_GridSel_Table="All",a.Text_GridSel_Column="Column ${name}",a.Text_GridSel_Columns="Columns ${names}",a.Text_GridSel_Measure="Measure ${name}",a.Text_GridSel_Measures="Measures ${names}",a.Text_GridSel_Row="Row ${name}",a.Text_GridSel_Rows="Rows ${names}",a.Text_GridSel_Cell="Cell ${name}",a.Text_GridSel_Cells="Cells ${names}",a.Text_GridSel_CellFmt="${rowKey}:${columnKey}",a.Text_Grid_Editing_TransactionInProgress="Transaction in progress.",a.Text_Grid_Editing_ReadyToCommit="Ready to commit.",a.Text_Grid_Editing_EnteredValue="Entered value: ${value}.",a.Text_Grid_Editing_CurrentValue="Current value: ${value}.",a.Err_commDm_Using_rowKeyIdAndField_Should_String="When using rowKeyId, the field must be a string.",a.Err_commDm_Using_rowKeyIdAndField_Should_CompletelyPublished="When using rowKeyId, the field should be completely supplied during an add event.",a.Err_If_RowKeyId_IsSpecified_ShouldBe_Included_ListFields_Subscribe="If rowKeyId is specified, it should be included in the list of fields to subscribe",a.Err_Function_CallFailed_WithCode="Function call failed with code ",a.Err_Function_Does_Not_Provide_QueueName="Function call did not return a QueueName field",a.Err_Concat_Invalid_Number_Datamodels="Invalid number of datamodels (at least 2)",a.Err_Concat_InvalidCount_AxisConcatenated="Invalid count of axis to be concatenated (from 2 to ${prefixCount} ).",a.Err_Concat_InvalidKey="Invalid key",a.Err_DM_Invalid_ResumeOperation_Model_NotSuspended="Invalid resume operation, the model was not suspended",a.Err_DM_NodeKey_NotFound="Node key not found",a.Err_DM_InvalidKey="Invalid key: ",a.Err_DM_Invalid_StartIndex_ExceptionPassed="Invalid start index exception, passed: ${start}  excepted:[0, ${length} ]",a.Err_DM_Invalid_Parent="Invalid parent",a.Err_Invalid_NodeException="Invalid node exception: node ${key} not found.",a.Err_DM_InvalidParameters_MoveOperationPassed_StartCountTarget="Invalid parameters in move operation. Passed start: ${start}, count: ${count} target: ${target}",a.Err_DM_InvalidParameter_PassedFor_StartCount_GreaterThen_Parent="Invalid parameters in move operation. Passed start: ${start}, count: ${count} but ${key} has only ${length} children",a.Err_DM_InvalidParameter_Target_GreaterThen_ParentMinusCount="Invalid parameters in move operation. Passed target: ${target}, expected [0, ${count}]",a.Err_DM_Invalid_CharacterKey="Invalid character in key [ ${key} ]",a.Err_DM_DuplicatedKey="Duplicated key: ",a.Err_DM_Invalid_IndexExceptionPassed_ExpectedLength="Invalid index exception, passed: ${index} excepted:[0, ${length} ]",a.Err_SliceManager_NotSupported="Not supported",a.Err_SliceManager_Reserved_NodeKey="Reserved node key",a.Err_DT_FlatAxis_ColumnSupported_EnableReorder_VisibilityOrGrouping="Only FlatAxis column is supported to enable column reorder, visibility or grouping",a.Err_GridObject_NoSelection_Available="No Selection Available",a.Err_Exporter_Illegal_Argument="Illegal argument: ",a.Grid_Menu_Headers="Headers",a.Grid_Menu_Fit_Content_All="Fit content (all)",a.Grid_Menu_Fit_Content_And_Header_All="Fit content and header (all)",a.Grid_Menu_Freeze="Freeze",a.Grid_Menu_Unfreeze="Unfreeze",a.Grid_Menu_Fit_Content_Selected="Fit content (selected)",a.Grid_Menu_Fit_Content_And_Header_Selected="Fit content and header (selected)",a.Grid_Menu_Sorting="Sorting",a.Grid_Menu_Sorting_Asc="Ascending",a.Grid_Menu_Sorting_Desc="Descending",a.Grid_Menu_Sorting_Asc_Abs="Ascending (absolute)",a.Grid_Menu_Sorting_Desc_Abs="Descending (absolute)",a.Grid_Menu_Sorting_None="None",a.Grid_Menu_Sorting_Reset="Reset all",a.Grid_Menu_Copy="Copy",a.Grid_Menu_Paste="Paste",a.Grid_Menu_Export="Export",a.Grid_Menu_CopyExport_All="All",a.Grid_Menu_Copy_Column_Style="Column format",a.Grid_Menu_Paste_Column_Style="Paste column format",a.Grid_Menu_CopyExport_Selection="Selection",a.Grid_Menu_CopyExport_SelectionWHeaders="Selection and headers",a.Grid_Menu_Grid_Select_All_Selection="Select all",a.Grid_Menu_Options="Options",a.Grid_Menu_ShowSidePanel="Show side panel",a.Grid_Menu_HideSidePanel="Hide side panel",a.Grid_Menu_ColumnOptions="Column Options...",a.Grid_Menu_RowLevelOptions="Level Options...",a.Grid_Menu_Print="Print",a.Grid_Menu_ClearErrors="Clear errors",a.Grid_Menu_Collapse_All="Collapse all",a.Grid_Menu_Expand_Last_Level="Expand to last level",a.Grid_Menu_Expand_Details="Expand details",a.Grid_Menu_Columns="Columns",a.Grid_Menu_Templates="Templates",a.Enum_DefaultDateFormat_Long="Long",a.Enum_DefaultDateFormat_Short="Short",a.Grid_Menu_ConditionalFormatting="Conditional formatting...",a.Grid_Filtering="Grid Filtering",a.Grid_Header_Panel_Filtering="Filtering...",a.Grid_Filter_By_Condition="Filter By Condition",a.Grid_Filter_By_Value="Filter By Value",a.Grid_AppearanceOption_Title_Appearance="Appearance",a.Grid_AppearanceOption_Title_Basic="Basic",a.Grid_AppearanceOption_Show_Toolbar="Show toolbar",a.Grid_AppearanceOption_Show_RowHeaders="Show row headers",a.Grid_AppearanceOption_Show_ColumnHeaders="Show column headers",a.Grid_AppearanceOption_Show_Column_Separators="Show column separators",a.Grid_AppearanceOption_Show_Wrap_ColumnHeaders_Text="Wrap column headers text",a.Grid_AppearanceOption_Enable_Zebra_Coloring="Enable zebra coloring",a.Grid_AppearanceOption_Title_HorizontalScrolling="Horizontal scrolling",a.Grid_AppearanceOption_HorizontalScrolling_Auto="Auto",a.Grid_AppearanceOption_HorizontalScrolling_Always="Always",a.Grid_AppearanceOption_HorizontalScrolling_Never="Never",a.Grid_AppearanceOption_Enable_Flashing="Enable flashing",a.Grid_AppearanceOption_Title_RowGrouping="Rows grouping",a.Grid_AppearanceOption_Title_DisplayAs="Display as:",a.Grid_AppearanceOption_DisplayAs_Outline="Outline",a.Grid_AppearanceOption_DisplayAs_Hierarchical="Hierarchical",a.Grid_FormattingOption_Title_Formatting="Formatting",a.Grid_FormattingOption_Decimal_Numbers="Decimal numbers:",a.Grid_FormattingOption_Negative_Numbers="(Negative numbers)",a.Grid_FormattingOption_Title_Show_NumbersIn="Show numbers in:",a.Grid_FormattingOption_Title_Custom_DateFormat="Custom date format:",a.Grid_FormattingOption_Btn_Reset_To_Defaults="Reset to defaults",a.Grid_Formatting_Text_Column_alias="Column alias",a.Grid_OptionsDialog_VisibleColumns_Title="Columns",a.Grid_OptionsDialog_Sorting_Title="Sorting",a.Grid_OptionsDialog_Sorting_Direction="Dir",a.Grid_OptionsDialog_Sorting_Absolute="Abs",a.Grid_OptionsDialog_Grouping_Title="Grouping",a.Grid_SidePanel_Grouping_Title="Grouping",a.Grid_ColumnSelector_Column="Columns",a.Grid_ColumnSelector_Category="Category",a.Grid_ColumnSelector_Empty_Category="No category",a.Grid_ColumnSelector_Select_Column="Select Columns",a.Grid_ColumnSelector_Select_Measure="Select Measures",a.Grid_ColumnSelector_ItemWithAliasFmt="${alias} (${displayName})",a.Grid_ColumnSelector_SearchByColumnPlaceholder="Search",a.Grid_ColumnSelector_SelectCategoriesPlaceholder="Select categories",a.Grid_ColumnSelector_NoResultFound="No matching result found",a.Grid_ColumnSelector_Description="Column Description",a.Grid_Row_Header_Groups="Groups",a.Grid_Row_Header_Sorting_Title="Row header",a.Grid_Exporting_Progress="Exporting...",a.Grid_Printing_Progress="Downloading...",a.Grid_Loading_Progress="Loading...",a.Grid_No_Items_To_Display="No items to display",a.Grid_ConditionalFormattingRules="Conditional format rules",a.Grid_AddNewRule="Add new rule",a.Grid_ApplyToColumn="Apply to column",a.Grid_FormatCellIf="Format cell if...",a.Grid_FormattingStyle="Formatting style",a.Grid_FormattingStyleForeground="Foreground",a.Grid_FormattingStyleBackground="Background",a.Grid_NoRules="No rules",a.Grid_Paste_Error_Title="Error in paste",a.Grid_Paste_Error_ReadonlyCells="Cannot paste on readonly cells.",a.Grid_Paste_Error_UnsupportedSelection="Unsupported selection, cannot paste on the selected range.",a.Searching="Searching...",a.Err_TrackingColumnResize_InvalidParameter_ColId_Width="Invalid params setting column width - colId: ${colId}, width: ${width}",a.Text_Filter_Panel_Error_Node_Add_Child="Only one parent is allowed for each node",a.Text_Filter_Panel_Error_Node_Remove_Child="Only one parent is allowed for each node",a.Text_Filter_Panel_Error_Node_Insert_Child="Only one parent is allowed for each node",a.Text_Filter_Panel_Error_Node_Internal_Condition="An internal node cannot be a Condition node",a.Text_Filter_Panel_Error_Favorite_Filter_Operation_Failed="Operation failed",a.Text_Filter_Panel_Error_Invalid_Filter_Name="Invalid filter name",a.Text_Filter_Panel_Error_Invalid_Filter="Invalid filter",a.Text_Filter_Panel_Error_Filter_Exists="Filter with name ${name} already exists.",a.Text_Filter_Panel_Error_Filter_Overwrite="Overwrite",a.Text_Filter_Panel_Error_Filter_Cancel="Cancel",a.Text_Filter_Panel_Error_Filter_Not_Found="Filter with given name was not found: ${name}",a.Text_Filter_Panel_Error_Filter_OK="OK",a.Text_Filter_Panel_Error_Invalid_Old_Filter_Name="Invalid old Filter Name",a.Text_Filter_Panel_Error_Invalid_New_Filter_Name="Invalid new Filter Name",a.Text_Filter_Panel_Error_Invalid_Original_Filter_Name="Invalid original Filter Name",a.Text_Filter_Panel_Error_Invalid_Target_Filter_Name="Invalid target Filter Name",a.Text_Filter_Panel_Error_Invalid_Date_Range="Not a valid date range",a.Text_Filter_Panel_Missing_Required_Value="Missing required field value",a.Err_Filter_Panel_Invalid_Filter_Value="Some filters values are missing or invalid.",a.Text_Filter_Panel_Exception_Create_Filter_Tree="`TypeError: expected either a 'Condition' or an 'And' node, but found ${nodeType}`",a.Text_Filter_Panel_Exception_Root_Node_Build_Filter_Tree="`TypeError: unsupported node type ${nodeType}`",a.Text_Filter_Panel_Exception_Extract_Filter_Node="`No tag specified for node '${nodeDesc}'`",a.Text_Filter_Panel_Error_Util_In_Operator="Display values length mismatch",a.Value_Filter_Panel_Util_Unspecified_Value="Unspecified",a.Text_Filter_Panel_Favorite_Filter_Update_Operation_Success="Favorite filter '${filterName}' is updated successfully.",a.Title_Save_Filter="Save filter",a.Text_Filter_Name="Filter Name",a.Text_Rename_Filter="Rename filter",a.Text_Default_Filter="Default filter",a.Text_Delete_Filter="Delete filter",a.Text_Reset_Filter="Reset filter",a.Text_Clear_Filter="Clear filter",a.Text_Configure_Filter="Filter options",a.Text_Add_Filter_To_ToolBar="Add this filter to toolbar",a.Text_Remove_Filter_From_ToolBar="Remove this filter from toolbar",a.Text_Filter_Chooser_Title="Filters",a.Text_Filter_Panel_Title="Filter: ${name}",a.Text_Favorite_Filter_Panel_Title="Favorite filters",a.Menu_Options_Show_Favorite_Filters="Show favorite filters",a.Menu_Options_Show_Current_Filter_Values="Show current filter values",a.Menu_Options_Show_default_Filters="Show default filters",a.Text_Empty="Empty",a.Summary_Panel_Info_Sum="Sum",a.Summary_Panel_Info_Avg="Avg",a.Summary_Panel_Info_Max="Max",a.Summary_Panel_Info_Min="Min",a.Summary_Panel_Info_Count="Count",a.Summary_Panel_Info_Count_Num="Count nums",a.Title_Options="Options",a.Msg_Sorting_Change_Confirmation="Do you really want to change the sorting?",a.Msg_Sorting_Reset="The operation you are going to execute will reset the multi-sorting already set",a.Tooltip_Cell_Value="Cell Value:",a.Grids_Text_After_Date="After",a.Grids_Text_Before_Date="Before",a.Enum_NumberScaleFactor_Units="Units",a.Enum_NumberScaleFactor_Thousands="Thousands",a.Enum_NumberScaleFactor_Millions="Millions",a.Enum_NumberScaleFactor_Billions="Billions",a.One_Time_Grid_Sorting_Title="The ${name} column supports one-time sorting only.",a.One_Time_Grid_Sorting_Description="If the data is updated, the sorting will not be updated automatically. You must sort the column again manually.",a.One_Time_Grid_Sorting_Continue="Do you want to continue?",a.One_Time_Grid_Sorting_Ascending="Sort ascending",a.One_Time_Grid_Sorting_Descending="Sort descending",a.One_Time_Grid_Sorting_Cancel="Cancel",a.Grid_Template_Error_Template_Exists="Template with name ${name} already exists.",a.Grid_Template_Error_Invalid_Template_Name="Invalid Template Name: ",a.Grid_Template_Error_Template_OK="OK",a.Grid_Template_Error_Invalid_Template_Meta_Data="Invalid template meta data",a.Grid_Template_Error_Unuathorized_Update="Unable to update, template belongs to other user",a.Grid_Template_Error_Unuathorized_Delete="Unable to delete, template belongs to other user",a.Grid_Template_Info_Template_Deleted="Selected template is deleted, please click save to create your own copy",a.Grid_Template_Error_Template_Deleted="Template got deleted by another user",a.Text_Template_Storage_Error_Template_Deleted="Template Deleted",a.Text_Template_Storage_Unknown_Error="Unknown Error",a.Grid_Template_Create_Save_Template="Create new or save template",a.Grid_Template_Restore_Template="Restore grid to saved template by undoing intermediate changes.",a.Grid_Template_Delete_Template="Delete selected template",a.Grid_Template_Share_Unshare_Template="Share/Unshare selected template",a.Grid_Template_Owner="Owner",a.Grid_Template_Shared="Shared",a.Grid_Template_Error_No_Template="No template available",a}();a.Strings=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(b){this.type=b,this.templateStorageService=a.getService("ionweb.templateStorageService"),this.serverService=a.getService("ionweb.serverService"),this.storageService=a.getService("ionweb.storageService"),this.currrentUser=this.serverService.getUserName()}return c.prototype.getTemplateMetaData=function(a){return this.templateStorageService.fetch(this.type).then(function(b){var c=b.filter(function(b){return b.name===a});return c[0]})},c.prototype.getTemplatesMetaData=function(){return this.templateStorageService.fetch(this.type)},c.prototype.getTemplate=function(c){return this.templateStorageService.read(c).catch(function(c){if(c.storageErrorType===a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND)throw b.Strings.Text_Template_Storage_Error_Template_Deleted;throw b.Strings.Text_Template_Storage_Unknown_Error})},c.prototype.addTemplate=function(c,d){var e=this;void 0===d&&(d=!0);var f=null;return(f=this.storageService.validateName(c.name))?Q.reject(b.Strings.Grid_Template_Error_Invalid_Template_Name+f):this.getTemplateMetaData(c.name).then(function(d){if(d)throw a.stringFormat(b.Strings.Grid_Template_Error_Template_Exists,{name:c.name});return e.templateStorageService.create(c.name,c.class,c)}).then(function(a){return{succeeded:!0,message:b.Strings.Grid_Template_Error_Template_OK,templateStorageMd:a}})},c.prototype.updateTemplate=function(c,d){var e=null;return c?c.ownerId!==this.currrentUser&&(e=b.Strings.Grid_Template_Error_Unuathorized_Update):e=b.Strings.Grid_Template_Error_Invalid_Template_Meta_Data,e?Q.reject(e):this.templateStorageService.write(c,d).then(function(){return{succeeded:!0,message:b.Strings.Grid_Template_Error_Template_OK,templateStorageMd:c}}).catch(function(c){if(c.storageErrorType===a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND)throw b.Strings.Text_Template_Storage_Error_Template_Deleted;throw b.Strings.Text_Template_Storage_Unknown_Error})},c.prototype.shareTemplate=function(c){var d=null;return c?c.ownerId!==this.currrentUser&&(d=b.Strings.Grid_Template_Error_Unuathorized_Update):d=b.Strings.Grid_Template_Error_Invalid_Template_Meta_Data,d?Q.reject(d):this.templateStorageService.share(c).then(function(){return{succeeded:!0,message:b.Strings.Grid_Template_Error_Template_OK}}).catch(function(c){if(c.storageErrorType===a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND)throw b.Strings.Text_Template_Storage_Error_Template_Deleted;throw b.Strings.Text_Template_Storage_Unknown_Error})},c.prototype.unshareTemplate=function(c){var d=null;return c?c.ownerId!==this.currrentUser&&(d=b.Strings.Grid_Template_Error_Unuathorized_Update):d=b.Strings.Grid_Template_Error_Invalid_Template_Meta_Data,d?Q.reject(d):this.templateStorageService.unshare(c).then(function(){return{succeeded:!0,message:b.Strings.Grid_Template_Error_Template_OK}}).catch(function(c){if(c.storageErrorType===a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND)throw b.Strings.Text_Template_Storage_Error_Template_Deleted;throw b.Strings.Text_Template_Storage_Unknown_Error})},c.prototype.removeTemplate=function(c,d){void 0===d&&(d=!0);var e=null;return c?c.ownerId!==this.currrentUser&&(e=b.Strings.Grid_Template_Error_Unuathorized_Delete):e=b.Strings.Grid_Template_Error_Invalid_Template_Meta_Data,e?Q.reject(e):this.templateStorageService.delete(c).then(function(){return{succeeded:!0,message:b.Strings.Grid_Template_Error_Template_OK}}).catch(function(c){if(c.storageErrorType===a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND)throw b.Strings.Text_Template_Storage_Error_Template_Deleted;throw b.Strings.Text_Template_Storage_Unknown_Error})},c}();c.GridTemplateStorageManager=d;
}(c=b.templates||(b.templates={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(d,e,f,g){this.impl={name:void 0,values:void 0,changed:void 0,contexts:void 0,entitlement:void 0,eventFilter:void 0,filter:void 0,query:void 0,realtime:void 0,recovery:void 0,service:void 0,snapshot:void 0,structure:void 0,dictionary:void 0},this.impl.name=g,this.impl.values={},this.impl.entitlement=new b.XrsContextModule(c.Modules.entitlement,this.impl.values),this.impl.eventFilter=new b.XrsContextModule(c.Modules.eventFilter,this.impl.values),this.impl.filter=new b.XrsContextModule(c.Modules.filter,this.impl.values),this.impl.query=new b.XrsContextModule(c.Modules.query,this.impl.values),this.impl.realtime=new b.XrsContextModule(c.Modules.realtime,this.impl.values),this.impl.recovery=new b.XrsContextModule(c.Modules.recovery,this.impl.values),this.impl.service=new b.XrsContextModule(c.Modules.service,this.impl.values),this.impl.snapshot=new b.XrsContextModule(c.Modules.snapshot,this.impl.values),this.impl.structure=new b.XrsContextModule(c.Modules.structure,this.impl.values),this.impl.contexts=[this.impl.entitlement,this.impl.eventFilter,this.impl.query,this.impl.realtime,this.impl.recovery,this.impl.service,this.impl.snapshot,this.impl.structure],this.impl.dictionary=new b.XrsDictionary(d,e,f,this),this.impl.changed=new a.Event}return Object.defineProperty(c.prototype,"name",{get:function(){var a=this.impl.name;return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"status",{get:function(){var a=this.getString(c.FieldNames.statusStr);return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"statusCode",{get:function(){var a=this.getNumber(c.FieldNames.status);return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"statusMessage",{get:function(){var a=this.getString(c.FieldNames.statusMsg);return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isSlave",{get:function(){var a=this.getBoolean(c.FieldNames.isSlave);return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"maxResultSize",{get:function(){var a=this.getNumber(c.FieldNames.maxResultSize);return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"objectName",{get:function(){var a=this.getString(c.FieldNames.objectName);return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"numberOfFields",{get:function(){var a=this.getNumber(c.FieldNames.numberOfFields);return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"supportsEarlyNotification",{get:function(){var a=this.getBoolean(c.FieldNames.supportsEarlyNotification);return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"supportsFindLight",{get:function(){var a=this.getBoolean(c.FieldNames.supportsFindLight);return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"supportsRevisions",{get:function(){var a=this.getBoolean(c.FieldNames.supportsRevisions);return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"supportsSortedSnapshots",{get:function(){var a=this.getBoolean(c.FieldNames.supportsSortedSnapshot);return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"modules",{get:function(){var a=this.impl.contexts.slice();return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"entitlement",{get:function(){var a=this.impl.entitlement;return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"eventFilter",{get:function(){var a=this.impl.eventFilter;return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"query",{get:function(){var a=this.impl.query;return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"realtime",{get:function(){var a=this.impl.realtime;return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"recovery",{get:function(){var a=this.impl.recovery;return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"service",{get:function(){var a=this.impl.service;return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"snapshot",{get:function(){var a=this.impl.snapshot;return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"structure",{get:function(){var a=this.impl.structure;return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"dictionary",{get:function(){var a=this.impl.dictionary;return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"changed",{get:function(){return this.impl.changed},enumerable:!0,configurable:!0}),c.prototype.update=function(a){for(var b={},d=0,e=Object.keys(c.FieldNames);d<e.length;d++){var f=e[d],g=c.FieldNames[f];if(g in a){var h=a[g];this.impl.values[g]=b[g]=h}}if(Object.keys(b).length>0){var i={values:b};this.impl.changed.raise(this,i)}for(var j=0,k=this.impl.contexts;j<k.length;j++){var l=k[j];l.update(a)}},c.prototype.getString=function(a){var b=void 0;return a in this.impl.values&&(b=this.impl.values[a]),b},c.prototype.getNumber=function(a){var b=void 0;return a in this.impl.values&&(b=this.impl.values[a]),b},c.prototype.getBoolean=function(a){var b=void 0;return a in this.impl.values&&(b=1===this.impl.values[a]),b},c.Modules={entitlement:"EntitlementModule",eventFilter:"EventFilterModule",filter:"FilterModule",query:"QueryModule",realtime:"RealtimeModule",recovery:"RecoveryModule",service:"ServiceModule",snapshot:"SnapshotModule",structure:"StructureModule"},c.FieldNames={id:"Id",isSlave:"IsSlave",maxResultSize:"MaxResultSize",numberOfFields:"NumberOfFields",objectName:"ObjectName",status:"Status",statusMsg:"StatusMsg",statusStr:"StatusStr",supportsEarlyNotification:"SupportsEarlyNotification",supportsFindLight:"SupportsFindLight",supportsRevisions:"SupportsRevisions",supportsSortedSnapshot:"SupportsSortedSnapshot"},c}();b.XrsContext=c}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(c,d){this._changed=new a.Event,this.fieldNames={},this.prefix=c,this.values=d,this.fieldNames.name=c.concat(b.Suffixes.name),this.fieldNames.details=c.concat(b.Suffixes.details),this.fieldNames.status=c.concat(b.Suffixes.status),this.fieldNames.statusCode=c.concat(b.Suffixes.statusCode),this.fieldNames.statusMessage=c.concat(b.Suffixes.statusMessage)}return Object.defineProperty(b.prototype,"name",{get:function(){return this.getString(this.fieldNames.name)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"details",{get:function(){return this.getString(this.fieldNames.details)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"status",{get:function(){return this.getString(this.fieldNames.status)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"statusCode",{get:function(){return this.getNumber(this.fieldNames.statusCode)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"statusMessage",{get:function(){return this.getString(this.fieldNames.statusMessage)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"changed",{get:function(){return this._changed},enumerable:!0,configurable:!0}),b.prototype.update=function(a){for(var b={},c=[this.fieldNames.name,this.fieldNames.details,this.fieldNames.status,this.fieldNames.statusCode,this.fieldNames.statusMessage],d=0,e=c;d<e.length;d++){var f=e[d],g=a[f];g&&(this.values[f]=b[f]=g)}if(Object.keys(b).length>0){var h={values:b};this._changed.raise(this,h)}},b.prototype.getString=function(a){var b=void 0;return a in this.values&&(b=this.values[a]),b},b.prototype.getNumber=function(a){var b=void 0;return a in this.values&&(b=this.values[a]),b},b.Suffixes={name:"Name",details:"Details",status:"StatusStr",statusCode:"Status",statusMessage:"StatusMsg"},b}();b.XrsContextModule=c}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.Undef=0]="Undef",a[a.Disconnected=10]="Disconnected",a[a.Starting=30]="Starting",a[a.Warning=115]="Warning",a[a.Running=120]="Running"}(b=a.XrsStatus||(a.XrsStatus={}))}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(a){this.keys=[],this.values=[],this.factory=void 0,this.comparer=function(a,b){return a.localeCompare(b)},this.factory=a}return Object.defineProperty(a.prototype,"count",{get:function(){var a=this.keys.length;return a},enumerable:!0,configurable:!0}),a.prototype.getItem=function(a){var b=this.binarySearch(this.keys,a,this.comparer),c=b>=0?this.values[b]:void 0;return c},a.prototype.getAll=function(){var a=this.values.slice();return a},a.prototype.set=function(a,b){var c=void 0,d=this.binarySearch(this.keys,a,this.comparer),e=d<0;return e&&(d=~d,this.keys.splice(d,0,a),this.values.splice(d,0,this.factory.create(a))),c=this.values[d],c.set(b),{isNew:e,item:c}},a.prototype.binarySearch=function(a,b,c,d,e){var f;return f=d||e?this.binarySearchImpl(a,b,c,d,e):this.binarySearchImpl(a,0,a.length,b,c)},a.prototype.binarySearchImpl=function(a,b,c,d,e){var f=a,g=b,h=c,i=d,j=e;if(!f)throw new ReferenceError("NullReference: 'array'");if(g<0||h<0){var k=["OutOfRange: '",g<0?"index":"length","'"].join("");throw new RangeError(k)}if(f.length-g<h)throw new RangeError("InvalidOffsetLength");for(var l=g,m=g+h-1;l<=m;){var n=l+(m-l>>1),o=j(f[n],i);if(0===o)return n;o<0?l=n+1:m=n-1}return~l},a}();a.XrsItemsCollection=b}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){this.values={}}return Object.defineProperty(a.prototype,"id",{get:function(){var b=this.getString(a.FieldNames.id);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pshName",{get:function(){var b=this.getString(a.FieldNames.pshName);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"contextName",{get:function(){var b=this.getString(a.FieldNames.contextName);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"sourceFieldName",{get:function(){var b=this.getString(a.FieldNames.sourceFieldName);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"tableName",{get:function(){var b=this.getString(a.FieldNames.tableName);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fieldType",{get:function(){var b=this.getNumber(a.FieldNames.type);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"extendedFieldType",{get:function(){var b=this.getNumber(a.FieldNames.extendedType);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fieldTypeName",{get:function(){var b=this.getString(a.FieldNames.typeStr);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"blankoutField",{get:function(){var b=this.getString(a.FieldNames.blankoutField);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"blankoutValue",{get:function(){var b=this.getString(a.FieldNames.blankoutValue);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"description",{get:function(){var b=this.getString(a.FieldNames.desc);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"defaultFormat",{get:function(){var b=this.getNumber(a.FieldNames.fmtDefault);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"formatField",{get:function(){var b=this.getString(a.FieldNames.fmtField);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"formatTable",{get:function(){var b=this.getString(a.FieldNames.fmtTable);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"helpTextShort",{get:function(){var b=this.getString(a.FieldNames.helpTextShort);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isHidden",{get:function(){var b=this.getBoolean(a.FieldNames.hidden);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isEditable",{get:function(){var b=this.getBoolean(a.FieldNames.editable);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isFastMoving",{get:function(){var b=this.getBoolean(a.FieldNames.fastMoving);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isTickable",{get:function(){var b=this.getBoolean(a.FieldNames.tickable);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isValidationListRequired",{get:function(){var b=this.getBoolean(a.FieldNames.validationListRequired);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"tickDefault",{get:function(){var b=this.getNumber(a.FieldNames.tickDefault);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"tickField",{get:function(){var b=this.getString(a.FieldNames.tickField);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"tickTable",{get:function(){var b=this.getString(a.FieldNames.tickTable);return b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"validationList",{get:function(){var b=this.getString(a.FieldNames.validationList);return b},enumerable:!0,configurable:!0}),a.prototype.set=function(a){for(var b in a){var c=a[b];this.values[b]=c}},a.prototype.getString=function(a){var b=this.values[a];return b},a.prototype.getNumber=function(a){var b=this.values[a];return b},a.prototype.getBoolean=function(a){var b=this.getNumber(a),c=b?1===b:void 0;return c},a.FieldNames={blankoutField:"BlankoutField",blankoutValue:"BlankoutValue",contextName:"ContextName",desc:"Desc",editable:"Editable",editableStr:"EditableStr",extendedType:"ExtendedType",extendedTypeStr:"ExtendedTypeStr",fastMoving:"FastMoving",fastMovingStr:"FastMovingStr",fmtDefault:"FmtDefault",fmtField:"FmtField",fmtTable:"FmtTable",formula:"Formula",helpTextShort:"HelpTextShort",hidden:"Hidden",id:"Id",pshName:"PshName",sourceFieldName:"SourceFieldName",tableName:"TableName",tickable:"Tickable",tickableStr:"TickableStr",tickDefault:"TickDefault",tickField:"TickField",tickTable:"TickTable",type:"Type",typeStr:"TypeStr",validationList:"ValidationList",validationListRequired:"ValidationListRequired",validationListRequiredStr:"ValidationListRequiredStr"},a}();a.XrsFieldDescriptor=b}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){}return a.prototype.getFieldCount=function(b){var c=void 0;if(a.statusMsgRegEx.test(b)){var d=a.statusMsgRegEx.exec(b),e=d[1];c=parseInt(e)}return c},a.statusMsgRegEx=/Fields count: (\d+)/,a}();a.XrsContextModuleStatusMessageInterpreter=b}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){this.beginEndCounter=0,this.completedBeginEndCounter=0}return a.prototype.begin=function(){var a=1===++this.beginEndCounter;return a},a.prototype.end=function(){var a=this.beginEndCounter>0&&0===--this.beginEndCounter;return this.completedBeginEndCounter+=a?1:0,a},Object.defineProperty(a.prototype,"isBulkOperationPending",{get:function(){return this.beginEndCounter>0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"numberOfCompletedBulkOperations",{get:function(){return this.completedBeginEndCounter},enumerable:!0,configurable:!0}),a}(),c=function(){function c(c,d){this.context=c,this.callback=d,this.matcher=new b,this.interpreter=new a.XrsContextModuleStatusMessageInterpreter}return Object.defineProperty(c.prototype,"isSnapshotCompleted",{get:function(){return this._isSnapshotCompleted===!0},enumerable:!0,configurable:!0}),c.prototype.begin=function(){this.matcher.begin()},c.prototype.end=function(){this.matcher.end()&&this.disclose()},c.prototype.disclose=function(){!this._isSnapshotCompleted&&this.doDisclose()&&(this._isSnapshotCompleted=!0,this.callback())},c.prototype.doDisclose=function(){var a=void 0,b=this.context.numberOfFields;if(void 0!==b){var c=this.context.dictionary.count;a=b===c}var d=this.context.structure.statusMessage;if(void 0===a&&void 0!=d&&""!==d){var e=this.interpreter.getFieldCount(d);void 0!==e&&e>0&&(a=e===this.context.dictionary.count)}return void 0===a&&(a=!this.matcher.isBulkOperationPending&&1===this.matcher.numberOfCompletedBulkOperations),a},c}();a.XrsDictionarySnapshotCompleteDiscloser=c}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(d,e,f,g){var h=this;this.context=g,this.settings=f,this.content=new b.XrsItemsCollection({create:function(){return new b.XrsFieldDescriptor}}),this.discloser=new b.XrsDictionarySnapshotCompleteDiscloser(g,function(){h.raiseSnapshotCompleted()}),this.completed=new a.Event,this.logger=e.create("xrs::service","xrs"),this.context.structure.changed.add(this.handleStructureModuleChanged,this);var i={type:a.SubscriptionType.ChainRecord,id:[f.currency,c.keys.CmDictionary,f.source,g.name].join("."),fields:Object.getOwnPropertyNames(b.XrsFieldDescriptor.FieldNames).map(function(a,c,d){return b.XrsFieldDescriptor.FieldNames[a]}),begin:function(){h.handleBegin()},end:function(){h.handleEnd()},add:function(a,b){h.handleSupply(a,b)},remove:function(a){},supply:function(a,b,c){h.handleSupply(a,b)}};this.subscription=d.subscribe(i),this._dataModelConverter=function(c,d,e){var f=h.getField(d);return f&&f.extendedFieldType===b.FieldType.IsoTimeStamp&&"string"==typeof e&&""!==e?{value:new a.IsoTimeStamp(e)}:null}}return Object.defineProperty(c.prototype,"dataModelConverter",{get:function(){return this._dataModelConverter},enumerable:!0,configurable:!0}),c.prototype.forEach=function(a){},Object.defineProperty(c.prototype,"count",{get:function(){var a=this.content.count;return a},enumerable:!0,configurable:!0}),c.prototype.getField=function(a){var b=this.content.getItem(a);return b},Object.defineProperty(c.prototype,"fields",{get:function(){var a=this.content.getAll();return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isSnapshotCompleted",{get:function(){var a=this.discloser.isSnapshotCompleted;return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"snapshotCompleted",{get:function(){return this.completed},enumerable:!0,configurable:!0}),c.prototype.handleBegin=function(){this.discloser.begin()},c.prototype.handleEnd=function(){this.discloser.end()},c.prototype.handleSupply=function(a,b){var c=this,d=a.split(".")[3].substr(this.context.name.length+1),e=this.content.set(d,b);this.logger.ifMedium(function(){return{key:c.settings.source+"."+c.context,params:{Count:c.count,fieldName:d,Content:b}}}),e.isNew&&this.discloser.disclose()},c.prototype.handleStructureModuleChanged=function(a,b){this.discloser.disclose()},c.prototype.raiseSnapshotCompleted=function(){this.completed.raise(this,void 0)},c.keys={CmDictionary:"CM_DICTIONARY"},c}();b.XrsDictionary=c}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.String=0]="String",a[a.Real=1]="Real",a[a.Integer=2]="Integer",a[a.Date=3]="Date",a[a.Time=4]="Time",a[a.BigDecimal=5]="BigDecimal",a[a.IsoTimeStamp=6]="IsoTimeStamp"}(b=a.FieldType||(a.FieldType={})),function(a){function b(b){var c=void 0;switch(b){case a.Strings.string:c=a.String;break;case a.Strings.integer:c=a.Integer;break;case a.Strings.real:c=a.Real;break;case a.Strings.date:c=a.Date;break;case a.Strings.time:c=a.Time;break;default:var d="OutOfRange: unexpected type '"+b+"' for ionweb.xrs.FieldType.";throw new RangeError(d)}return c}function c(b){var c=void 0;switch(b){case a.String:c=a.Strings.string;break;case a.Integer:c=a.Strings.integer;break;case a.Real:c=a.Strings.real;break;case a.Date:c=a.Strings.date;break;case a.Time:c=a.Strings.time;break;default:var d="OutOfRange: unexpected value '"+b+"' for ionweb.xrs.FieldType.";throw new RangeError(d)}return c}var d=function(){function a(){}return Object.defineProperty(a,"string",{get:function(){return"STR"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"integer",{get:function(){return"INT"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"real",{get:function(){return"REAL"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"date",{get:function(){return"DATE"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"time",{get:function(){return"TIME"},enumerable:!0,configurable:!0}),a}();a.Strings=d,a.fromString=b,a.toString=c}(b=a.FieldType||(a.FieldType={}))}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(a,b,c){this.impl={contexts:void 0,commService:void 0,loggerFactory:void 0,logger:void 0,settings:void 0,pending:{context:void 0,contexts:void 0}},this.impl.contexts={},this.impl.commService=a,this.impl.settings=c,this.impl.loggerFactory=b,this.impl.logger=b.create("xrs::service","xrs"),this.impl.pending={context:{},contexts:[]},this.start()}return c.prototype.getContext=function(a){var b=a.toUpperCase(),c=Q.defer();if(this.isActive()){var d=this.impl.contexts[b];c.resolve(d)}else{var e=this.impl.pending.context[b];e||(e=this.impl.pending.context[b]=[]),e.push(c)}return c.promise},c.prototype.getContexts=function(){var a=Q.defer();if(this.isActive()){var b=[];for(var c in this.impl.contexts){var d=this.impl.contexts[c];b.push(d)}a.resolve(b)}else this.impl.pending.contexts.push(a);return a.promise},Object.defineProperty(c.prototype,"settings",{get:function(){return this.impl.settings},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"source",{get:function(){var a=this.impl.settings.source;return a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"currency",{get:function(){var a=this.impl.settings.currency;return a},enumerable:!0,configurable:!0}),c.prototype.start=function(){var b=this,d={type:a.SubscriptionType.ChainRecord,id:[this.settings.currency,c.keys.context,this.settings.source,c.keys.context].join("."),fields:c.allContextFields(),add:function(a,c){b.handleSupply(a,c)},supply:function(a,c,d){b.handleSupply(a,c)},notAvailable:function(){b.handleNotAvailable()}};this.impl.commService.subscribe(d)},c.prototype.isActive=function(){var a=Object.keys(this.impl.contexts).length,b=a>0;if(b)for(var c in this.impl.contexts){var d=this.impl.contexts[c];if(b=d.dictionary.isSnapshotCompleted,!b)break}return b},c.allContextFields=function(){var a=function(a){var c=Object.getOwnPropertyNames(b.XrsContextModule.Suffixes).map(function(c,d,e){return a.concat(b.XrsContextModule.Suffixes[c])});return c},c=Object.getOwnPropertyNames(b.XrsContext.FieldNames).map(function(a,c,d){return b.XrsContext.FieldNames[a]});for(var d in b.XrsContext.Modules){var e=b.XrsContext.Modules[d],f=a(e);c=c.concat(f)}return c},c.prototype.handleNotAvailable=function(){var a=this;Object.keys(this.impl.contexts).forEach(function(c){var d=a.impl.contexts[c];if(d){var e={};e[b.XrsContext.FieldNames.statusMsg]=null,e[b.XrsContext.FieldNames.statusStr]=null,e[b.XrsContext.FieldNames.status]=b.XrsStatus.Disconnected,d.update(e)}})},c.prototype.handleSupply=function(a,c){var d=a.split(".")[3],e=d.toUpperCase(),f=this.impl.contexts[e];f||(this.impl.logger.low(this.source,{NewContext:d}),f=this.impl.contexts[e]=new b.XrsContext(this.impl.commService,this.impl.loggerFactory,this.impl.settings,d),f.dictionary.snapshotCompleted.add(this.handleSnapshotCompleted,this)),f.update(c)},c.prototype.handleSnapshotCompleted=function(a,b){var c=this,d=Object.keys(this.impl.contexts).filter(function(b,d,e){return c.impl.contexts[b].dictionary===a})[0];a.snapshotCompleted.remove(this.handleSnapshotCompleted,this);var e=this.isActive();this.impl.logger.low(this.source,{ContextReady:d,Count:a.count,Fields:a.fields.map(function(a,b,c){return a.pshName}).join(","),ServiceActive:e}),e&&this.notifyPending()},c.prototype.notifyPending=function(){for(var a in this.impl.pending.context)for(var b=this.impl.contexts[a],c=this.impl.pending.context[a],d=0,e=c;d<e.length;d++){var f=e[d];f.resolve(b)}var g=[];for(var h in this.impl.contexts){var b=this.impl.contexts[h];g.push(b)}for(var i=0,j=this.impl.pending.contexts;i<j.length;i++){var f=j[i];f.resolve(g)}this.impl.pending.context={},this.impl.pending.contexts=[]},c.keys={context:"CONTEXT"},c}();b.XrsService=c}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.Single=0]="Single",a[a.Range=1]="Range",a[a.Multi=2]="Multi"}(b=a.OperatorCardinality||(a.OperatorCardinality={}))}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function b(){this.operators={},this.initOperators()}return Object.defineProperty(b.prototype,"equals",{get:function(){return this.internalequals},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"equalsCaseInsensitive",{get:function(){return this.internalequalsCaseInsensitive},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"greaterThan",{get:function(){return this.internalgreaterThan},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"greaterThanOrEqualsTo",{get:function(){return this.internalgreaterThanOrEqualsTo},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"in",{get:function(){return this.internalin},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"lessThan",{get:function(){return this.internallessThan},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"lessThanOrEqualsTo",{get:function(){return this.internallessThanOrEqualsTo},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"like",{get:function(){return this.internallike},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"notEquals",{get:function(){return this.internalnotEquals},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"notEqualsCaseInsensitive",{get:function(){return this.internalnotEqualsCaseInsensitive},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"notIn",{get:function(){return this.internalnotIn},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"notLike",{get:function(){return this.internalnotLike},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rangeClosedInterval",{get:function(){return this.internalrangeClosedInterval},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rangeLeftOpenInterval",{get:function(){return this.internalrangeLeftOpenInterval},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rangeOpenInterval",{get:function(){return this.internalrangeOpenInterval},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rangeRightOpenInterval",{get:function(){return this.internalrangeRightOpenInterval},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"regex",{get:function(){return this.internalregex},enumerable:!0,configurable:!0}),b.prototype.getAllOperators=function(){var a=[],b=this.operators;for(var c in b)b.hasOwnProperty(c)&&a.push(b[c]);return a},b.prototype.getById=function(a){return this.operators[a]},b.prototype.register=function(a){if(a.id in this.operators)throw new ReferenceError("IllegalArgumentException: operator "+a.id+" already registerd");this.operators[a.id]=a},b.prototype.initOperators=function(){this.internalequals={id:"=",displayName:"Equals",symbol:"=",cardinality:a.OperatorCardinality.Single,supportedFieldTypes:[a.FieldType.String,a.FieldType.Integer,a.FieldType.Real,a.FieldType.BigDecimal,a.FieldType.Date,a.FieldType.IsoTimeStamp,a.FieldType.Time]},this.internalnotEquals={id:"!=",displayName:"Not Equals",symbol:"â ",cardinality:a.OperatorCardinality.Single,supportedFieldTypes:[a.FieldType.String,a.FieldType.Integer,a.FieldType.Real,a.FieldType.BigDecimal,a.FieldType.Date,a.FieldType.IsoTimeStamp,a.FieldType.Time]},this.internalgreaterThanOrEqualsTo={id:"[",displayName:"Greater than or equals to",symbol:"â¥",cardinality:a.OperatorCardinality.Single,supportedFieldTypes:[a.FieldType.String,a.FieldType.Integer,a.FieldType.Real,a.FieldType.BigDecimal,a.FieldType.Date,a.FieldType.IsoTimeStamp,a.FieldType.Time]},this.internalgreaterThan={id:"(",displayName:"Greater than",symbol:">",cardinality:a.OperatorCardinality.Single,supportedFieldTypes:[a.FieldType.String,a.FieldType.Integer,a.FieldType.Real,a.FieldType.BigDecimal,a.FieldType.Date,a.FieldType.IsoTimeStamp,a.FieldType.Time]},this.internallessThan={id:")",displayName:"Less than",symbol:"<",cardinality:a.OperatorCardinality.Single,supportedFieldTypes:[a.FieldType.String,a.FieldType.Integer,a.FieldType.Real,a.FieldType.BigDecimal,a.FieldType.Date,a.FieldType.IsoTimeStamp,a.FieldType.Time]},this.internallessThanOrEqualsTo={id:"]",displayName:"Less than or equals to",symbol:"â¤",cardinality:a.OperatorCardinality.Single,supportedFieldTypes:[a.FieldType.String,a.FieldType.Integer,a.FieldType.Real,a.FieldType.BigDecimal,a.FieldType.Date,a.FieldType.IsoTimeStamp,a.FieldType.Time]},this.internalequalsCaseInsensitive={id:"==",displayName:"Equals (case insensitive)",symbol:"â",cardinality:a.OperatorCardinality.Single,supportedFieldTypes:[a.FieldType.String]},this.internalnotEqualsCaseInsensitive={id:"!==",displayName:"Not equals (case insensitive)",symbol:"â",cardinality:a.OperatorCardinality.Single,supportedFieldTypes:[a.FieldType.String]},this.internallike={id:"~",displayName:"Like",symbol:"~",cardinality:a.OperatorCardinality.Single,supportedFieldTypes:[a.FieldType.String]},this.internalnotLike={id:"!~",displayName:"Not Like",symbol:"â",cardinality:a.OperatorCardinality.Single,supportedFieldTypes:[a.FieldType.String]},this.internalregex={id:"*",displayName:"Regex",symbol:"*",cardinality:a.OperatorCardinality.Single,supportedFieldTypes:[a.FieldType.String]},this.internalrangeClosedInterval={id:"[]",displayName:"Range: closed interval",symbol:"[]",cardinality:a.OperatorCardinality.Range,supportedFieldTypes:[a.FieldType.String,a.FieldType.Integer,a.FieldType.Real,a.FieldType.BigDecimal,a.FieldType.Date,a.FieldType.IsoTimeStamp,a.FieldType.Time]},this.internalrangeRightOpenInterval={id:"[)",displayName:"Range: right-open interval",symbol:"[)",cardinality:a.OperatorCardinality.Range,supportedFieldTypes:[a.FieldType.String,a.FieldType.Integer,a.FieldType.Real,a.FieldType.BigDecimal,a.FieldType.Date,a.FieldType.IsoTimeStamp,a.FieldType.Time]},this.internalrangeLeftOpenInterval={id:"(]",displayName:"Range: left-open interval",symbol:"(]",cardinality:a.OperatorCardinality.Range,supportedFieldTypes:[a.FieldType.String,a.FieldType.Integer,a.FieldType.Real,a.FieldType.BigDecimal,a.FieldType.Date,a.FieldType.IsoTimeStamp,a.FieldType.Time]},this.internalrangeOpenInterval={id:"()",displayName:"Range: open interval",symbol:"()",cardinality:a.OperatorCardinality.Range,supportedFieldTypes:[a.FieldType.String,a.FieldType.Integer,a.FieldType.Real,a.FieldType.BigDecimal,a.FieldType.Date,a.FieldType.IsoTimeStamp,a.FieldType.Time]},this.internalin={id:"IN",displayName:"In",symbol:"â",cardinality:a.OperatorCardinality.Multi,supportedFieldTypes:[a.FieldType.String,a.FieldType.Integer,a.FieldType.Real,a.FieldType.BigDecimal,a.FieldType.Date,a.FieldType.IsoTimeStamp,a.FieldType.Time]},this.internalnotIn={id:"!IN",displayName:"Not In",symbol:"â",cardinality:a.OperatorCardinality.Multi,supportedFieldTypes:[a.FieldType.String,a.FieldType.Integer,a.FieldType.Real,a.FieldType.BigDecimal,a.FieldType.Date,a.FieldType.IsoTimeStamp,a.FieldType.Time]},this.initOperatorsCollection()},b.prototype.initOperatorsCollection=function(){this.operators[this.equals.id]=this.equals,this.operators[this.equalsCaseInsensitive.id]=this.equalsCaseInsensitive,this.operators[this.greaterThan.id]=this.greaterThan,this.operators[this.greaterThanOrEqualsTo.id]=this.greaterThanOrEqualsTo,this.operators[this.in.id]=this.in,this.operators[this.lessThan.id]=this.lessThan,this.operators[this.lessThanOrEqualsTo.id]=this.lessThanOrEqualsTo,
this.operators[this.like.id]=this.like,this.operators[this.notEquals.id]=this.notEquals,this.operators[this.notEqualsCaseInsensitive.id]=this.notEqualsCaseInsensitive,this.operators[this.notIn.id]=this.notIn,this.operators[this.notLike.id]=this.notLike,this.operators[this.rangeClosedInterval.id]=this.rangeClosedInterval,this.operators[this.rangeLeftOpenInterval.id]=this.rangeLeftOpenInterval,this.operators[this.rangeOpenInterval.id]=this.rangeOpenInterval,this.operators[this.rangeRightOpenInterval.id]=this.rangeRightOpenInterval,this.operators[this.regex.id]=this.regex},b}();a.XrsOperatorsRegistry=b}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.Integer=0]="Integer",a[a.String=1]="String",a[a.Real=2]="Real",a[a.Date=3]="Date",a[a.Time=4]="Time",a[a.BigDecimal=5]="BigDecimal",a[a.IsoTimeStamp=6]="IsoTimeStamp"}(b=a.QosValueType||(a.QosValueType={}))}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function b(){this.qosParametersCollection=[],this.initQosParameters()}return b.prototype.getAllParameters=function(){return this.qosParametersCollection},Object.defineProperty(b.prototype,"context",{get:function(){return this.internalContext},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"queryIsOr",{get:function(){return this.internalqueryIsOr},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"queryOriginator",{get:function(){return this.internalqueryOriginator},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"queueMaxResultSize",{get:function(){return this.internalqueueMaxResultSize},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"queueName",{get:function(){return this.internalqueueName},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"queueSubFields",{get:function(){return this.internalqueueSubFields},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"queueTag",{get:function(){return this.internalqueueTag},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xrsAllRevisions",{get:function(){return this.internalxrsAllRevisions},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xrsEarlyNotification",{get:function(){return this.internalxrsEarlyNotification},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xrsIncludeDeleted",{get:function(){return this.internalxrsIncludeDeleted},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xrsRealTimeActive",{get:function(){return this.internalxrsRealTimeActive},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xrsRealtimeOnHold",{get:function(){return this.internalxrsRealtimeOnHold},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xrsRealtimeOnly",{get:function(){return this.internalxrsRealtimeOnly},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xrsResyncCheckpoint",{get:function(){return this.internalxrsResyncCheckpoint},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xrsSortBy",{get:function(){return this.internalxrsSortBy},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xrsWhere",{get:function(){return this.internalxrsWhere},enumerable:!0,configurable:!0}),b.prototype.initQosParameters=function(){this.internalContext={id:"-context",displayName:"Context",cardinality:a.OperatorCardinality.Single,valueType:a.QosValueType.String},this.internalqueryIsOr={id:"-QueryIsOR",displayName:"Query is OR",cardinality:a.OperatorCardinality.Single,valueType:a.QosValueType.Integer},this.internalqueueName={id:"QueueName",displayName:"Queue Name",cardinality:a.OperatorCardinality.Single,valueType:a.QosValueType.String},this.internalqueryOriginator={id:"-QueryOriginator",displayName:"Query Originator",cardinality:a.OperatorCardinality.Single,valueType:a.QosValueType.String},this.internalqueueMaxResultSize={id:"-Q_MaxResultSize",displayName:"Max Result Size",cardinality:a.OperatorCardinality.Single,valueType:a.QosValueType.Integer},this.internalqueueSubFields={id:"-Q_SubFields",displayName:"Subscription Fields",cardinality:a.OperatorCardinality.Multi,valueType:a.QosValueType.String},this.internalqueueTag={id:"-Q_Tag",displayName:"Queue Tag",cardinality:a.OperatorCardinality.Single,valueType:a.QosValueType.String},this.internalxrsAllRevisions={id:"-XRS_AllRevisions",displayName:"All Revisions",cardinality:a.OperatorCardinality.Single,valueType:a.QosValueType.Integer},this.internalxrsEarlyNotification={id:"-XRS_EarlyNotification",displayName:"Early Notification",cardinality:a.OperatorCardinality.Single,valueType:a.QosValueType.Integer},this.internalxrsIncludeDeleted={id:"-XRS_IncludeDeleted",displayName:"Include Deleted",cardinality:a.OperatorCardinality.Single,valueType:a.QosValueType.Integer},this.internalxrsRealTimeActive={id:"-XRS_RealTimeActive",displayName:"Realtime Active",cardinality:a.OperatorCardinality.Single,valueType:a.QosValueType.Integer},this.internalxrsRealtimeOnHold={id:"-XRS_RealtimeOnHold",displayName:"Realtime On Hold",cardinality:a.OperatorCardinality.Single,valueType:a.QosValueType.Integer},this.internalxrsRealtimeOnly={id:"-XRS_RealtimeOnly",displayName:"Realtime Only",cardinality:a.OperatorCardinality.Single,valueType:a.QosValueType.Integer},this.internalxrsResyncCheckpoint={id:"-XRS_ResyncCheckpoint",displayName:"Resync Checkpoint",cardinality:a.OperatorCardinality.Single,valueType:a.QosValueType.String},this.internalxrsSortBy={id:"-XRS_SortBy",displayName:"Sort By",cardinality:a.OperatorCardinality.Multi,valueType:a.QosValueType.String},this.internalxrsWhere={id:"-XRS_Where",displayName:"Where",cardinality:a.OperatorCardinality.Single,valueType:a.QosValueType.String},this.qosParametersCollection=[this.context,this.queryIsOr,this.queryOriginator,this.queueMaxResultSize,this.queueName,this.queueSubFields,this.queueTag,this.xrsAllRevisions,this.xrsEarlyNotification,this.xrsIncludeDeleted,this.xrsRealTimeActive,this.xrsRealtimeOnHold,this.xrsRealtimeOnly,this.xrsResyncCheckpoint,this.xrsSortBy,this.xrsWhere]},b}();a.XrsQosParametersCollection=b}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(a,b){this.settings=a,this.queryContext=b}return a.prototype.setConditions=function(a){this.conds=a},a.prototype.getConditions=function(){return this.conds},a.prototype.setQos=function(a){this.qos=a},a.prototype.getQos=function(){return this.qos},Object.defineProperty(a.prototype,"xrsServiceSettings",{get:function(){return this.settings},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"context",{get:function(){return this.queryContext},enumerable:!0,configurable:!0}),a}();a.XrsQuery=b}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(a,b,c,d){this.conditions=[],this.sorting=[],this.qosCollection=[],this.xrs=a,this.operators=c,this.qos=d,this.context=b}return c.prototype.findFieldType=function(a){return"string"==typeof a?this.findFieldDescr(a).fieldType:a.fieldType},c.prototype.findFieldDescr=function(a){var b=this.context.dictionary.getField(a);if(!b)throw new Error("Field not found: "+a);return b},c.prototype.appendEqualsCondition=function(a,b){if(!a)throw new Error("IllegalArgumentException: field must be defined");if("string"==typeof b&&!b)throw new Error("IllegalArgumentException: value must be defined");var c="string"==typeof a?a:a.pshName,d=this.findFieldType(a);return this.conditions.push({field:c,oper:this.operators.equals.id,value:b,type:d}),this},c.prototype.appendCondition=function(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];if(!a)throw new Error("IllegalArgumentException: field must be defined");if(!b)throw new Error("IllegalArgumentException: operator must be defined");if(void 0===c)throw new Error("IllegalArgumentException: values must be defined");var e="string"==typeof a?a:a.pshName,f="string"==typeof b?b:b.id,g=this.findFieldType(a),h={field:e,oper:f,type:g};return 1===c.length?h.value=c[0]:h.values=c,this.conditions.push(h),this},c.prototype.onContext=function(a){return this.appendXrsQosParameter(this.qos.context,a)},c.prototype.withQueryOriginator=function(a){return this.appendXrsQosParameter(this.qos.queryOriginator,a)},c.prototype.withQueueTag=function(a){return this.appendXrsQosParameter(this.qos.queueTag,a)},c.prototype.withSubscribedFields=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return this.appendXrsQosParameter.apply(this,[this.qos.queueSubFields].concat(a))},c.prototype.withMaxResultSize=function(a){return this.appendXrsQosParameter(this.qos.queueMaxResultSize,a)},c.prototype.withExpressionParserFormula=function(a){return this.appendXrsQosParameter(this.qos.xrsWhere,a)},c.prototype.snapshotOnly=function(){return this.appendXrsQosParameter(this.qos.xrsRealTimeActive,0)},c.prototype.includeAllRevisions=function(){return this.appendXrsQosParameter(this.qos.xrsAllRevisions,1)},c.prototype.includeDeleted=function(){return this.appendXrsQosParameter(this.qos.xrsIncludeDeleted,1)},c.prototype.addSortingCriterion=function(a,b){return this.sorting.push({field:a,direction:b}),this},c.prototype.processSortingCriteria=function(){if(this.sorting.length>0){var b=[];this.sorting.forEach(function(c){b.push(c.field+":"+(c.direction===a.tables.SortDirection.Ascending?"ASC":"DESC"))}),this.appendXrsQosParameter.apply(this,[this.qos.xrsSortBy].concat(b))}},c.prototype.conditionsInOr=function(){return this.appendXrsQosParameter(this.qos.queryIsOr,1)},c.prototype.appendQosParameter=function(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];if(!a)throw new Error("IllegalArgumentException: qosName must be defined");if(!c)throw new Error("IllegalArgumentException: values must be defined");var e={field:a,type:b};return 1===c.length?e.value=c[0]:e.values=c,this.qosCollection.push(e),this},c.prototype.appendXrsQosParameter=function(a){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];if(!a)throw new Error("IllegalArgumentException: qosParameter must be defined");if(!c)throw new Error("IllegalArgumentException: values must be defined");var e={field:a.id,type:a.valueType};return a.cardinality===b.OperatorCardinality.Single?e.value=c[0]:e.values=c,this.qosCollection.push(e),this},c.prototype.build=function(){this.processSortingCriteria();var a=new b.XrsQuery(this.xrs.settings,this.context);return a.setConditions(this.conditions),a.setQos(this.qosCollection),a},c}();b.XrsConditionDefBuilder=c}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function b(){this.internalOperators=new a.XrsOperatorsRegistry,this.internalQosParameters=new a.XrsQosParametersCollection}return b.prototype.queryOn=function(b,c){return new a.XrsConditionDefBuilder(b,c,this.operators,this.internalQosParameters)},Object.defineProperty(b.prototype,"operators",{get:function(){return this.internalOperators},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"qosParameters",{get:function(){return this.internalQosParameters},enumerable:!0,configurable:!0}),b}();a.XrsQueryBuilder=b}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(a,b){this.logger=b.create("xrs::qexec","xrs"),this.commService=a}return b.prototype.getFunctionName=function(a,b){var c=a.xrsServiceSettings.source+"_Search"+a.context.objectName;return b&&(c+="Light"),c},b.prototype.getOperator=function(a){if(!a)throw new Error("condition is undefined");if(!a.oper)throw new Error("condition operator is undefined");return a.oper},b.prototype.getValueCount=function(a){if(!a)throw new Error("condition is undefined");if(void 0===a.value&&void 0===a.values)throw new Error("No value(s) defined for condition on field '"+a.field+"'.");return void 0!==a.value?1:a.values.length},b.prototype.createValuesArguments=function(a){var b=[];if(!a)throw new Error("clause is undefined");if(void 0===a.value&&void 0===a.values)throw new Error("clause value is undefined");var c=function(a){"number"==typeof a||"string"==typeof a?b.push(a):b.push(a.toString())};return void 0!==a.value?c(a.value):a.values.forEach(function(a){return c(a)}),b},b.prototype.createQosArgument=function(a){if(void 0===a.value&&void 0===a.values)throw new Error("QOS value is undefined");var b;if(void 0!==a.value)b=a.field;else{var c=a.field,d=a.values.length,e=this.getQosFieldType(a.type);b="ARRAY."+c+"."+d+"."+e}return b},b.prototype.createConditionArgument=function(a){var b=this.getOperator(a),c=this.getValueCount(a),d=this.getXrsFieldType(a.type),e="ARRAY."+b+":"+a.field+"."+c+"."+d;return e},b.prototype.getQosFieldType=function(b){var c;switch(b){case a.xrs.QosValueType.Time:case a.xrs.QosValueType.Date:case a.xrs.QosValueType.Integer:c="INT";break;case a.xrs.QosValueType.Real:c="REAL";break;case a.xrs.QosValueType.IsoTimeStamp:case a.xrs.QosValueType.BigDecimal:case a.xrs.QosValueType.String:default:c="STR"}return c},b.prototype.getXrsFieldType=function(b){var c;switch(b){case a.xrs.FieldType.Time:case a.xrs.FieldType.Date:case a.xrs.FieldType.Integer:c="INT";break;case a.xrs.FieldType.Real:c="REAL";break;case a.xrs.FieldType.IsoTimeStamp:case a.xrs.FieldType.BigDecimal:case a.xrs.FieldType.String:default:c="STR"}return c},b.prototype.getFCallQosValueType=function(b){var c;switch(b){case a.xrs.QosValueType.Integer:c="INT";break;case a.xrs.QosValueType.Date:c="DATE";break;case a.xrs.QosValueType.Time:c="TIME";break;case a.xrs.QosValueType.Real:c="REAL";break;case a.xrs.QosValueType.IsoTimeStamp:case a.xrs.QosValueType.BigDecimal:case a.xrs.QosValueType.String:default:c="STRING"}return c},b.prototype.getFCallValueType=function(b){var c;switch(b){case a.xrs.FieldType.Integer:c="INT";break;case a.xrs.FieldType.Date:c="DATE";break;case a.xrs.FieldType.Time:c="TIME";break;case a.xrs.FieldType.Real:c="REAL";break;case a.xrs.FieldType.IsoTimeStamp:case a.xrs.FieldType.BigDecimal:case a.xrs.FieldType.String:default:c="STRING"}return c},b.prototype.processQos=function(a,b){var c=this;a.forEach(function(a){var d={value:c.createQosArgument(a),valueType:"STRING"};b.push(d);var e=c.createValuesArguments(a),f=c.getFCallQosValueType(a.type);e.forEach(function(a){var c={value:a,valueType:f};b.push(c)})})},b.prototype.processConditions=function(a,b){var c=this;a.forEach(function(a){var d={value:c.createConditionArgument(a),valueType:"STRING"};b.push(d);var e=c.createValuesArguments(a),f=c.getFCallValueType(a.type);e.forEach(function(a){var c={value:a,valueType:f};b.push(c)})})},b.prototype.prepareFunctionArgs=function(a){var b=a.getConditions(),c=[];b&&this.processConditions(b,c);var d=a.getQos();return d&&this.processQos(d,c),c},b.prototype.createFunctionDescriptor=function(a){var b=this.prepareFunctionArgs(a),c={args:b};return c},b.prototype.prepareFunctionCall=function(a,b){var c=this.prepareFunctionArgs(a),d=this.getFunctionName(a,b),e={name:d,varArgs:c.map(function(a){return a.value}),varTypes:c.map(function(a){return a.valueType})};return e},b.prototype.parseFunctionResult=function(a){var b=null,c=a.values.functionResult;if(c&&"string"==typeof c){var d=c.indexOf(":");if(d>0){var e=parseInt(c.substring(0,d)),f=c.substring(d+1);b=0===e&&"OK"===f?{code:e,message:f,error:null}:{code:e,message:f,error:c}}else b={code:null,message:null,error:c}}else b={code:null,message:null,error:"Unexpected function result"};return b},b.prototype.parseSearchResult=function(a,b){var c=void 0,d=void 0,e=this.parseFunctionResult(a);if(e.error)d=e.error;else if(a.varValues&&4===a.varValues.length){for(var f=void 0,g=void 0,h=0;h<4&&!d;h+=2){var i=a.varValues[h],j=a.varValues[h+1];if("string"!=typeof i){d="Unexpected result type for '"+i+"'.";break}if("string"!=typeof j){d="Unexpected result type for the value of the '"+i+"' named result.";break}switch(i){case"QueryRecord":f=j;break;case"QueueName":g=j;break;default:d="Unexpected result '"+i+"'."}}d||(c={code:e.code,message:e.message,queryRecord:f,queueName:g})}else d="Unexpected function var values";c?(this.logger.low("search",{Succeeded:!0,Result:JSON.stringify(c),Payload:JSON.stringify(a)}),b.resolve(c)):(this.logger.low("search",{Succeeded:!1,Reason:JSON.stringify(d),Payload:JSON.stringify(a)}),b.reject(d))},b.prototype.parseLightSearchResult=function(a,b){var c=void 0,d=void 0,e=this.parseFunctionResult(a);if(e.error)d=e.error;else if(!a.varValues||a.varValues.length<4)d="Unexpected function var values";else{var f=void 0,g=void 0,h=void 0;if(f=this.extractNumber(a.varValues[0]))if(g=this.extractNumber(a.varValues[1]))if(a.varValues.length<(h=4+g+f*g))d="Unexpected function result";else{for(var i=[],j=0;j<g;j++){var k=2+j,l=a.varValues[k];if("string"!=typeof l){d="Unexpected field name in position "+k+" in function result";break}i.push(l)}if(!d){for(var m=[],n=2+g,o=0;o<f;o++){for(var p={},q=0;q<g;q++){var r=a.varValues[n+o*g+q];p[i[q]]=r}m.push(p)}var s=0!==this.extractNumber(a.varValues[h-1]);c={code:e.code,message:e.message,additionalResultsAvailable:s,resultSet:m,fields:i,count:f}}}else d="Unexpected function field count";else d="Unexpected function resultSet cardinality"}c?(this.logger.low("lightSearch",{Succeeded:!0,Result:JSON.stringify(c),Payload:JSON.stringify(a)}),b.resolve(c)):(this.logger.low("lightSearch",{Succeeded:!1,Reason:JSON.stringify(d),Payload:JSON.stringify(a)}),b.reject(d))},b.prototype.extractNumber=function(a){var b=void 0;return"string"==typeof a?b=parseInt(a):"number"==typeof a&&(b=a),b},b.prototype.search=function(a){var b=this,c=Q.defer(),d=this.prepareFunctionCall(a,!1);this.logger.low("search",{Invoked:!0,Params:JSON.stringify(d)});var e=this.commService.invoke(d);return e.then(function(a){b.parseSearchResult(a,c)}).fail(function(a){c.reject(a)}),c.promise},b.prototype.lightSearch=function(a){var b=this,c=Q.defer(),d=this.prepareFunctionCall(a,!0);this.logger.low("lightSearch",{Invoked:!0,Params:JSON.stringify(d)});var e=this.commService.invoke(d);return e.then(function(a){b.parseLightSearchResult(a,c)}).fail(function(a){c.reject(a)}),c.promise},b}();b.XrsQueryExecutor=c,a.module("ionwebGrids").service("xrsQueryExecutor",["ionweb.commService","ionweb.loggerFactory"],function(b,c){return new a.xrs.XrsQueryExecutor(b,c)})}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function a(a,b){this.commService=a,this.loggerFactory=b}return a.prototype.create=function(a){var c=new b.XrsService(this.commService,this.loggerFactory,a);return c},a}();b.XrsServiceFactory=c,a.module("ionwebGrids").service("xrsServiceFactory",["ionweb.commService","ionweb.loggerFactory"],function(a,b){return new c(a,b)})}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function a(a,b){this.services={},this.logger=a.create("xrs::registry","xrs"),this.factory=b}return a.prototype.get=function(a){var b,c=a.source in this.services;b=c?this.services[a.source]:this.services[a.source]=this.factory.create(a);var d=b.settings.currency===a.currency,e=d?void 0:"Impossible to instantiate a service with source '"+a.source+"' and currency '"+a.currency+"',\r\nbecause a different service already exists with same source but with different currency";if(this.logger.low("get",{Settings:JSON.stringify(a),Created:!c,Succeeded:d,Message:e}),!d)throw new Error(e);return b},a}();b.XrsServiceRegistry=c,a.module("ionwebGrids").service("xrsServiceRegistry",["ionweb.loggerFactory","ionweb.xrsServiceFactory"],function(a,b){return new c(a,b)})}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={})),ionweb.services.registerCoreSubmodule("ionwebGrids",["ionwebTk","ionwebCore"],[ionweb.tables.Strings,ionweb.rules.Strings]);var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),ionweb;!function(a){a.Version="1.1.8-p1d8-r15018",a.Copyright="Â© Copyright 2018, ION.",a.GitSha="50b0bb1ece4773cd76bcd2a243f03fa86727291f"}(ionweb||(ionweb={}));var plotly;!function(a){var b=function(){function a(){}return a.concat=function(a){return a.join("+")},Object.defineProperty(a,"None",{get:function(){return"none"},enumerable:!0,configurable:!0}),a}();a.PlotlyBaseFlagList=b;var c=function(){function a(){}return Object.defineProperty(a,"Bar",{get:function(){return"bar"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Pie",{get:function(){return"pie"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Scatter",{get:function(){return"scatter"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ScatterGeo",{get:function(){return"scattergeo"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"BoxPlot",{get:function(){return"box"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"CandleStick",{get:function(){return"candlestick"},enumerable:!0,configurable:!0}),a}();a.PlotlyTraceTypes=c;var d=function(){function a(){}return Object.defineProperty(a,"Linear",{get:function(){return"linear"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Spline",{get:function(){return"spline"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"StepHV",{get:function(){return"hv"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"StepVH",{get:function(){return"vh"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"StepHVH",{get:function(){return"hvh"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"StepVHV",{get:function(){return"vhv"},enumerable:!0,configurable:!0}),a}();a.PlotlyLineShapes=d;var e=function(){function a(){}return Object.defineProperty(a,"Reset",{get:function(){return"reset"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"XY",{get:function(){return"xy"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"X",{get:function(){return"x"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Y",{get:function(){return"y"},enumerable:!0,configurable:!0}),a}();a.PlotlyZoomMode=e;var f=function(){function a(){}return Object.defineProperty(a,"Horizontal",{get:function(){return"h"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Vertical",{get:function(){return"v"},enumerable:!0,configurable:!0}),a}();a.PlotlyBarPlotOrientation=f;var g=function(){function a(){}return Object.defineProperty(a,"Stack",{get:function(){return"relative"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Group",{get:function(){return"group"},enumerable:!0,configurable:!0}),a}();a.PlotlyBarPlotMode=g;var h=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),Object.defineProperty(b,"Lines",{get:function(){return"lines"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"Markers",{get:function(){return"markers"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"Text",{get:function(){return"text"},enumerable:!0,configurable:!0}),b}(b);a.PlotlyScatterPlotMode=h;var i=function(){function a(){}return Object.defineProperty(a,"None",{get:function(){return"none"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ToZeroY",{get:function(){return"tozeroy"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ToZeroX",{get:function(){return"tozerox"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ToNextY",{get:function(){return"tonexty"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ToNextX",{get:function(){return"tonextx"},enumerable:!0,configurable:!0}),a}();a.PlotlyScatterFillMode=i;var j=function(){function a(){}return Object.defineProperty(a,"Circle",{get:function(){return"circle"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Square",{get:function(){return"square"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Diamond",{get:function(){return"diamond"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Cross",{get:function(){return"cross"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"X",{get:function(){return"x"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"TriangleUp",{get:function(){return"triangle-up"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"TriangleDown",{get:function(){return"triangle-down"},enumerable:!0,configurable:!0}),a}();a.PlotlyScatterMarkerSymbol=j;var k=function(){function a(){}return Object.defineProperty(a,"Open",{get:function(){return"-open"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Dot",{get:function(){return"-dot"},enumerable:!0,configurable:!0}),a}();a.PlotlyScatterMarkerMode=k;var l=function(){function a(){}return Object.defineProperty(a,"H",{get:function(){return"h"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"V",{get:function(){return"v"},enumerable:!0,configurable:!0}),a}();a.PlotlyLegendOrientation=l;var m=function(){function a(){}return Object.defineProperty(a,"Normal",{get:function(){return"normal"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Reversed",{get:function(){return"reversed"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Grouped",{get:function(){return"grouped"},enumerable:!0,configurable:!0}),a}();a.PlotlyLegendTraceOrder=m;var n=function(){function a(){}return Object.defineProperty(a,"Left",{get:function(){return"left"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Right",{get:function(){return"right"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Center",{get:function(){return"center"},enumerable:!0,configurable:!0}),a}();a.PlotlyLegendXAnchor=n;var o=function(){function a(){}return Object.defineProperty(a,"Top",{get:function(){return"top"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Bottom",{get:function(){return"bottom"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Center",{get:function(){return"center"},enumerable:!0,configurable:!0}),a}();a.PlotlyLegendYAnchor=o;var p=function(){function a(){}return Object.defineProperty(a,"Closest",{get:function(){return"closest"},enumerable:!0,configurable:!0}),a}();a.PlotlyHoverMode=p;var q=function(){function a(){}return Object.defineProperty(a,"Linear",{get:function(){return"linear"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Category",{get:function(){return"category"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Date",{get:function(){return"date"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Log",{get:function(){return"log"},enumerable:!0,configurable:!0}),a}();a.PlotlyAxisType=q;var r=function(){function a(){}return Object.defineProperty(a,"Left",{get:function(){return"left"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Right",{get:function(){return"right"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Top",{get:function(){return"top"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Bottom",{get:function(){return"bottom"},enumerable:!0,configurable:!0}),a}();a.PlotlyAxisSide=r;var s=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),Object.defineProperty(b,"All",{get:function(){return"all"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"Name",{get:function(){return"name"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"Text",{get:function(){return"text"},enumerable:!0,configurable:!0}),b}(b);a.PlotlyBaseHoverInfo=s;var t=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),Object.defineProperty(b,"X",{get:function(){return"x"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"Y",{get:function(){return"y"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"Z",{get:function(){return"z"},enumerable:!0,configurable:!0}),b}(s);a.PlotlyCartesianHoverInfo=t;var u=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),Object.defineProperty(b,"Label",{get:function(){return"label"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"Value",{get:function(){return"value"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"Percent",{get:function(){return"percent"},enumerable:!0,configurable:!0}),b}(s);a.PlotlyPieHoverInfo=u;var v=function(){function a(){}return Object.defineProperty(a,"None",{get:function(){return"none"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Auto",{get:function(){return"auto"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Inside",{get:function(){return"inside"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Outside",{get:function(){return"outside"},enumerable:!0,configurable:!0}),a}();a.PlotlyPieTextPosition=v;var w=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),Object.defineProperty(b,"Label",{get:function(){return"label"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"Text",{get:function(){return"text"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"Value",{get:function(){return"value"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"Percent",{get:function(){return"percent"},enumerable:!0,configurable:!0}),b}(b);a.PlotlyPieTextInfo=w;var x=function(){function a(){}return Object.defineProperty(a,"None",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Reset",{get:function(){return"reset"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"AutoSize",{get:function(){return"autosize"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ResetAndAutoSize",{get:function(){return"reset+autosize"},enumerable:!0,configurable:!0}),a}();a.PlotlyDoubleClickInteraction=x;var y=function(){function a(){}return Object.defineProperty(a,"LegendOnly",{get:function(){return"legendonly"},enumerable:!0,configurable:!0}),a}();a.PlotlyTraceVisibility=y;var z=function(){function a(){}return Object.defineProperty(a,"World",{get:function(){return"world"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Europe",{get:function(){return"europe"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"USA",{get:function(){return"usa"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Asia",{get:function(){return"asia"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Africa",{get:function(){return"africa"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"NorthAmerica",{get:function(){return"north america"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"SouthAmerica",{get:function(){return"south america"},enumerable:!0,configurable:!0}),a}();a.PlotlyMaps=z;var A=function(){function a(){}return Object.defineProperty(a,"ISO",{get:function(){return"ISO-3"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"State",{get:function(){return"USA-states"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Name",{get:function(){return"country names"},enumerable:!0,configurable:!0}),a}();a.PlotlyLocationModes=A;var B=function(){function a(){}return Object.defineProperty(a,"All",{get:function(){return"all"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"None",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Outliers",{get:function(){return"outliers"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"SuspectedOutliers",{get:function(){return"suspectedoutliers"},enumerable:!0,configurable:!0}),a}();a.PlotlyBoxPlotModes=B;var C=function(){function a(){}return Object.defineProperty(a,"zoom",{get:function(){return"zoom"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"pan",{get:function(){return"pan"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"select",{get:function(){return"select"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"lasso",{get:function(){return"lasso"},enumerable:!0,configurable:!0}),a}();a.PlotlyDragMode=C;var D=function(){function a(){}return a}();
a.PlotlyCandlePlotMode=D}(plotly||(plotly={}));var ionweb;!function(a){var b;!function(b){var c=plotly.PlotlyTraceTypes,d=plotly.PlotlyMaps,e=plotly.PlotlyLocationModes,f=plotly.PlotlyBarPlotMode,g=plotly.PlotlyAxisSide,h=plotly.PlotlyLineShapes,i=plotly.PlotlyScatterFillMode,j=plotly.PlotlyScatterPlotMode,k=plotly.PlotlyScatterMarkerSymbol,l=plotly.PlotlyScatterMarkerMode,m=plotly.PlotlyBarPlotOrientation,n=plotly.PlotlyAxisType,o=plotly.PlotlyZoomMode,p=plotly.PlotlyPieTextInfo,q=plotly.PlotlyLegendOrientation,r=plotly.PlotlyBoxPlotModes,s=function(){function s(){}return s.pointIsValid=function(a,b,c){return void 0===b&&(b=!1),void 0===c&&(c=!1),(b||null!=a.x)&&(c||null!=a.y)},s.initializeDataConverters=function(){s._dataConverter={},s._dataConverter[b.ChartPlotType.Pie]=s.convertSeriesDataForPieTrace,s._dataConverter[b.ChartPlotType.Tree]=s.convertSeriesDataForPieTrace,s._dataConverter[b.ChartPlotType.Bar]=s.convertSeriesDataForCartesianTrace,s._dataConverter[b.ChartPlotType.Scatter]=s.convertSeriesDataForCartesianTrace,s._dataConverter[b.ChartPlotType.Bubble]=s.convertSeriesDataForBubbleTrace,s._dataConverter[b.ChartPlotType.ScatterGeo]=s.convertSeriesDataForGeoTrace,s._dataConverter[b.ChartPlotType.BoxPlot]=s.convertSeriesDataForBoxTrace,s._dataConverter[b.ChartPlotType.CandleStick]=s.convertSeriesDataForCandleTrace},s.convertSeriesData=function(a,b,c){return s._dataConverter||s.initializeDataConverters(),s._dataConverter[b.plotType](a,b,c)},s.rebuildPlotlyAxisLayout=function(c,d,e,f){return d.title=c.title,d.autorange=c.rangeMode===b.ChartAxisRangeMode.Auto||c.rangeMode===b.ChartAxisRangeMode.Window,d.type=s.convertAxisType(c.axisType),d.zeroline=c.showZeroLine,d.showgrid=c.showGridLines,d.fixedrange=!c.zoomable&&f.dragmode===b.DragMode.pan&&c.id!==a.charts.ChartAxisId.X1,c.rangeMode===b.ChartAxisRangeMode.Fixed&&(d.range=s.convertRangeToNumberArray(c.range,c.axisType===b.ChartAxisType.DateTime)),c.id.index>1&&(e?(d.overlaying="x",d.side=g.Top):(d.overlaying="y",d.side=g.Right)),d},s.setPlotlyPieDomains=function(a){var b=a.length;if(b>1)for(var c=.1,d=Math.ceil(Math.sqrt(b)),e=b>2?Math.ceil(b/d):1,f=1/(e+c*(e-1)),g=f*c,h=1/(d+c*(d-1)),i=h*c,j=0;j<b;j++){var k=Math.floor(j/d),l=j%d,m=(h+i)*l,n=1-(f+g)*k;a[j].domain={x:[m,m+h],y:[n-f,n]}}},s.convertScatterDrawMode=function(a){switch(a){case b.ChartScatterDrawMode.Lines:return j.Lines;case b.ChartScatterDrawMode.Markers:return j.Markers;case b.ChartScatterDrawMode.LinesAndMarkers:return j.concat([j.Lines,j.Markers]);default:throw new Error(b.Strings.Err_PlotConverter_Unsupported_Scatter_DrawMode)}},s.convertScatterLineInterpolation=function(a){switch(a){case b.ChartScatterLineInterpolation.Linear:return h.Linear;case b.ChartScatterLineInterpolation.Spline:return h.Spline;case b.ChartScatterLineInterpolation.HV:return h.StepHV;case b.ChartScatterLineInterpolation.VH:return h.StepVH;default:throw new Error(b.Strings.Err_PlotConverter_Unsupported_ScatterLine_Interpolation)}},s.convertScatterFillMode=function(a,c){if(a===b.ChartScatterFillMode.None)return i.None;if(c)switch(a){case b.ChartScatterFillMode.ToZeroY:return i.ToZeroX;case b.ChartScatterFillMode.ToZeroX:return i.ToZeroY;case b.ChartScatterFillMode.ToNextY:return i.ToNextX;case b.ChartScatterFillMode.ToNextX:return i.ToNextY;default:return i.None}else switch(a){case b.ChartScatterFillMode.ToZeroY:return i.ToZeroY;case b.ChartScatterFillMode.ToZeroX:return i.ToZeroX;case b.ChartScatterFillMode.ToNextY:return i.ToNextY;case b.ChartScatterFillMode.ToNextX:return i.ToNextX;default:return i.None}},s.convertScatterMarkerSymbol=function(a,c){var d="";switch(a){case b.ChartScatterMarkerSymbol.Circle:d+=k.Circle;break;case b.ChartScatterMarkerSymbol.Square:d+=k.Square;break;case b.ChartScatterMarkerSymbol.Diamond:d+=k.Diamond;break;case b.ChartScatterMarkerSymbol.Cross:d+=k.Cross;break;case b.ChartScatterMarkerSymbol.X:d+=k.X;break;case b.ChartScatterMarkerSymbol.TriangleUp:d+=k.TriangleUp;break;case b.ChartScatterMarkerSymbol.TriangleDown:d+=k.TriangleDown;break;default:throw new Error(b.Strings.Err_PlotConverter_Unsupported_Marker_Symbol)}return c||(d+=l.Open),d},s.convertAxisIdToTraceAxisField=function(a,c){var d="";switch(a.dimension){case b.ChartAxisDimension.X:d+=c?"y":"x";break;case b.ChartAxisDimension.Y:d+=c?"x":"y";break;default:throw new Error(b.Strings.Err_PlotConverter_Unsupported_AxisDimension)}return a.index>1&&(d+=a.index),d},s.convertAxisIdToPlotlyAxisName=function(a,c){var d;switch(a.dimension){case b.ChartAxisDimension.X:d=c?"yaxis":"xaxis";break;case b.ChartAxisDimension.Y:d=c?"xaxis":"yaxis";break;default:throw new Error(b.Strings.Err_PlotConverter_Unsupported_AxisDimension)}return a.index>1&&(d+=a.index),d},s.convertAxisType=function(a){switch(a){case b.ChartAxisType.Categorized:return n.Category;case b.ChartAxisType.Linear:return n.Linear;case b.ChartAxisType.DateTime:return n.Date;case b.ChartAxisType.Log:return n.Log;default:throw new Error(b.Strings.Err_PlotConverter_Unsupported_AxisType)}},s.convertStackablePlotArrangement=function(a){switch(a){case b.ChartStackablePlotArrangement.Group:return f.Group;case b.ChartStackablePlotArrangement.Stack:return f.Stack;default:throw new Error(b.Strings.Err_PlotConverter_Unsupported_Stackable_PlotArrangement)}},s.convertBarPlotOrientation=function(a,c){switch(a){case b.ChartBarOrientation.Horizontal:return c?m.Vertical:m.Horizontal;case b.ChartBarOrientation.Vertical:return c?m.Horizontal:m.Vertical;default:throw new Error(b.Strings.Err_PlotConverter_UnsupportedBar_PlotOrientation)}},s.convertPiePlotSliceInfo=function(a){switch(a){case b.ChartPieSliceInfo.None:return p.None;case b.ChartPieSliceInfo.Percent:return p.Percent;case b.ChartPieSliceInfo.Value:return p.Value;case b.ChartPieSliceInfo.Text:return p.Text;default:throw new Error(b.Strings.Err_PlotConverter_Unsupporte_Pie_SliceInfo)}},s.convertPlotType=function(a){switch(a){case b.ChartPlotType.Bar:return c.Bar;case b.ChartPlotType.Scatter:case b.ChartPlotType.Bubble:return c.Scatter;case b.ChartPlotType.Pie:return c.Pie;case b.ChartPlotType.Tree:return c.Scatter;case b.ChartPlotType.ScatterGeo:return c.ScatterGeo;case b.ChartPlotType.BoxPlot:return c.BoxPlot;case b.ChartPlotType.CandleStick:return c.CandleStick;default:throw Error(b.Strings.Err_PlotConverter_Unsupported_PlotType)}},s.convertMap=function(a){switch(a){case b.GeoMap.World:return d.World;case b.GeoMap.USA:return d.USA;case b.GeoMap.Europe:return d.Europe;case b.GeoMap.Asia:return d.Asia;case b.GeoMap.Africa:return d.Africa;case b.GeoMap.NorthAmerica:return d.NorthAmerica;case b.GeoMap.SouthAmerica:return d.SouthAmerica;default:throw Error(b.Strings.Err_PlotConverter_Unsupported_Map)}},s.convertLocationMode=function(a){switch(a){case b.LocationMode.ISO:return e.ISO;case b.LocationMode.State:return e.State;case b.LocationMode.Name:return e.Name;default:throw Error(b.Strings.Err_PlotConverter_Unsupported_Location_Mode)}},s.convertFromPlotlyZoomInfo=function(a,c){var d=[];return a.axes&&(d=a.axes.map(function(a){var d=s.convertPlotlyAxisNameToChartAxisId(a.name),e=c.axis(d).axisType===b.ChartAxisType.DateTime,f={axisId:d,newRange:s.convertNumberArrayToRange(a.newRange,e),oldRange:s.convertNumberArrayToRange(a.oldRange,e),fractionalRange:s.convertNumberArrayToRange(a.fractionalRange,!1)};return f})),new b.ChartZoomEventArgs(d,a.zoomMode===o.Reset,a.pre)},s.convertPlotlyAxisNameToChartAxisId=function(a){switch(a){case"xaxis":return b.ChartAxisId.X1;case"xaxis2":return b.ChartAxisId.X1;case"yaxis":return b.ChartAxisId.Y1;case"yaxis2":return b.ChartAxisId.Y2;default:return null}},s.convertNumberArrayToRange=function(a,b){var c;return 2===a.length?(c={from:a[0],to:a[1]},b&&(c.from=new Date(c.from),c.to=new Date(c.to))):c={from:null,to:null},c},s.convertRangeToNumberArray=function(a,b){return a?b?[a.from.getTime(),a.to.getTime()]:[a.from,a.to]:[0,0]},s.ConvertLegendOrientation=function(a){return a===b.ChartLegendOrientation.Horizontal?q.H:q.V},s.convertSeriesDataForPieTrace=function(a,b,c){var d,e={values:[],text:[],labels:[],marker:{colors:[]}},f=[];return a.forEach(function(a,b){if(s.pointIsValid(a)&&0!==a.y){var c=void 0;c=isNaN(a.y)?null:Math.abs(a.y),e.labels.push(a.x.toString()),e.values.push(c),e.text.push(a.text||(a.y>0?c+"":"("+c+")")),e.marker.colors.push(a.color),f.push({index:b,id:a.id,x:a.x})}}),d=e,d.references=f,d},s.convertSeriesDataForCartesianTrace=function(a,b,c,d,e){void 0===d&&(d=!1),void 0===e&&(e=!1);var f,g,h={x:[],y:[],text:[],textbox:[],references:[],marker:{color:[]}};c.flipAxes?(f="y",g="x"):(f="x",g="y");var i=!1,j=!0;return a.forEach(function(a,b){s.pointIsValid(a,d,e)&&(null!=a[f]&&h.x.push(a[f]),null!=a[g]&&h.y.push(a[g]),j&&a.color&&h.marker.color?h.marker.color.push(a.color):(j=!1,delete h.marker.color),"undefined"!=typeof a.text?(i=!0,h.text.push(a.text)):h.text.push(""),"undefined"!=typeof a.__index&&(b=a.__index),h.references.push({id:a.id,x:a.x,index:b}))}),0===h.x.length&&delete h.x,0===h.y.length&&delete h.y,i||delete h.text,h},s.convertSeriesDataForBoxTrace=function(a,c,d){var e=s.convertSeriesDataForCartesianTrace(a,c,d,!0,!0);return d.flipAxes?delete e.y:delete e.x,c.box.showPoints===b.BoxPoints.All?e.boxpoints=r.All:c.box.showPoints===b.BoxPoints.Outliers?e.boxpoints=r.Outliers:c.box.showPoints===b.BoxPoints.SuspectedOutliers?e.boxpoints=r.SuspectedOutliers:c.box.showPoints===b.BoxPoints.None&&(e.boxpoints=r.None),c.box.tooltips&&(e.textbox[0]=c.box.tooltips),e},s.convertSeriesDataForCandleTrace=function(a,b,c,d){void 0===d&&(d=!1);var e={x:[],open:[],high:[],low:[],close:[],text:[],textbox:[]};return a.forEach(function(a,b){if(!d&&null==a.x||null==a.ohlc.o||null==a.ohlc.h||null==a.ohlc.l||null==a.ohlc.c||(e.x.push(a.x),e.open.push(a.ohlc.o),e.high.push(a.ohlc.h),e.low.push(a.ohlc.l),e.close.push(a.ohlc.c)),!d&&null==a.x||null==a.text||e.text.push(a.text),(d||null!=a.x&&a.ohlcText)&&null!=a.ohlcText.o&&null!=a.ohlcText.h&&null!=a.ohlcText.l&&null!=a.ohlcText.c){var c=e.textbox[b]||[];c=a.ohlc.c>=a.ohlc.o?[a.ohlcText.c,a.ohlcText.l,a.ohlcText.o,"",a.ohlcText.h]:[a.ohlcText.c,a.ohlcText.l,"",a.ohlcText.o,a.ohlcText.h],e.textbox[b]=c}}),b.candlestick.increasingColor&&(e.increasing={line:{color:b.candlestick.increasingColor}}),b.candlestick.decreasingColor&&(e.decreasing={line:{color:b.candlestick.decreasingColor}}),0===e.x.length&&delete e.x,0===e.open.length&&delete e.open,0===e.high.length&&delete e.high,0===e.low.length&&delete e.low,0===e.close.length&&delete e.close,0===e.text.length&&delete e.text,0===e.textbox.length&&delete e.textbox,e},s.convertSeriesDataForBubbleTrace=function(a,b,c){var d=s.convertSeriesDataForCartesianTrace(a,b,c);return d.marker.sizeDataPoint=[],a.forEach(function(a){d.marker.sizeDataPoint.push(a.z)}),d},s.convertSeriesDataForGeoTrace=function(a,b,c){var d=s.convertSeriesDataForCartesianTrace(a,b,c);return d.marker.sizeDataPoint=[],d.marker.color=[],d.locations=[],d.z=[],d.locationmode=s.convertLocationMode(b.geo.locationMode),a.forEach(function(a){d.z.push(a.z),b.geo.useGradient?d.marker.sizeDataPoint.push(a.z):d.marker.sizeDataPoint.push(Math.abs(a.z));var c=a.y;if(b.geo.useGradient)d.marker.color.push(c);else{var e=c<0?b.geo.lowerColor:b.geo.higherColor;d.marker.color.push(e)}d.marker.cmin=Math.min(d.marker.cmin,c),d.marker.cmax=Math.max(d.marker.cmax,c),d.marker.opacity=1,d.locations.push(a.x)}),b.geo.useGradient&&(d.marker.colorscale=[[0,b.geo.lowerColor],[1,b.geo.higherColor]],d.marker.colorbar={}),d},s}();b.PlotlyConverter=s}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=plotly.PlotlyHoverMode,d=plotly.PlotlyBaseHoverInfo,e=plotly.PlotlyCartesianHoverInfo,f=plotly.PlotlyPieHoverInfo,g=plotly.PlotlyPieTextPosition,h=plotly.PlotlyLegendXAnchor,i=plotly.PlotlyLegendYAnchor,j=plotly.PlotlyTraceVisibility,k=plotly.PlotlyDragMode,l=plotly.PlotlyDoubleClickInteraction,m=function(m){function n(c,d,e,f){var g=m.call(this,c,d)||this;if(g._themeManager=f,g._lastContainerWidth=0,g._lastContainerHeight=0,g._disabledAutoScrollAxisMap={},g._rootClickHandler=g.handleRootClick.bind(g),g._rootMousedownHandler=g.handleRootMousedown.bind(g),g._plotlyClickHandler=g.handlePlotlyClick.bind(g),g._plotlyZoomHandler=g.handlePlotlyZoom.bind(g),g._plotlyRelayoutHandler=g.handlePlotlyRelayout.bind(g),g._plotlyLegendActionHandler=g.handlePlotlyLegendAction.bind(g),g._plotlyDragstartHandler=g.handlePlotlyDragstartAction.bind(g),g._plotlyDragendHandler=g.handlePlotlyDragendAction.bind(g),g._throttledCommitSeriesDataChanges=a.throttle(function(){return g.commitSeriesDataChanges()},500),g._updatedSeries={},!e)throw new Error(b.Strings.Err_PlotlyChartRenderer_Plotly_CannotBe_Null);g._plotly=e;var h=a.SDK_COLOR_PALETTE.map(function(a){return g._themeManager.rawThemeVariables[a]});return g._plotly.colorDefaults(h),g._themeChangedEvtSub=g._themeManager.currentThemeChanged.add(function(){g.rebuildChart()}),g}return __extends(n,m),n.prototype.dispose=function(){m.prototype.dispose.call(this),this._themeChangedEvtSub&&this._themeChangedEvtSub()},n.prototype.onGetActualRange=function(a){var c=b.PlotlyConverter.convertAxisIdToPlotlyAxisName(a,this.layout.flipAxes),d=this.container,e=d&&d._fullLayout&&d._fullLayout[c],f=e?d._fullLayout[c].range||[]:[],g={from:this.normalizeToTimestamp(f[0],new Date),to:this.normalizeToTimestamp(f[1],new Date)};return g},n.prototype.onStarted=function(){m.prototype.onStarted.call(this),this.rebuildChart(),this.bindToPlotlyEvents()},n.prototype.onStopped=function(){m.prototype.onStopped.call(this),this.unbindFromPlotlyEvents()},n.prototype.onChartSeriesDataChanged=function(a){m.prototype.onChartSeriesDataChanged.call(this,a),a.removedSeries.length>0||a.addedSeries.length>0?this.rebuildChart():a.updatedSeries.length>0&&(a.updatedSeries.every(function(a){return 0===a.length})?this.rebuildChart():this.collectSeriesPointsCollectionChanged(a.updatedSeries))},n.prototype.onChartSeriesPropertyChanged=function(a){m.prototype.onChartSeriesPropertyChanged.call(this,a);var c={};switch(a.propertyName){case b.ChartSeries.DisplayNameProperty:c.name=this.processSeriesDisplayNameForLegend(a.series.name)}this.restyleTracesIfNeeded(c,this._series2TraceIndex[a.series.name])},n.prototype.onChartSeriesLayoutPropertyChanged=function(a){if(m.prototype.onChartSeriesLayoutPropertyChanged.call(this,a),!this.seriesLayoutChangeCanBeIgnored(a)){var c=a.seriesLayout,d={},e=this.seriesLayoutChangeTriggersRebuild(c,a);if(e)this.rebuildChart();else{var f=!1,g=!1;if(a.owner===c)switch(a.propertyName){case b.ChartSeriesLayout.PlotTypeProperty:d.type=b.PlotlyConverter.convertPlotType(c.plotType),this.processSeriesPlotTypeSpecificUpdate(c,d),this.processSeriesHoverInfoUpdate(c,d),f=c.plotType!==b.ChartPlotType.Pie,g=a.oldValue!==b.ChartPlotType.Pie&&a.newValue===b.ChartPlotType.Bar;break;case b.ChartSeriesLayout.AxisXIndexProperty:case b.ChartSeriesLayout.AxisYIndexProperty:this.processSeriesAxesUpdate(c,d);break;case b.ChartSeriesLayout.MarkerSizeProperty:d["marker.size"]=c.markerSize;break;case b.ChartSeriesLayout.ColorProperty:d["marker.color"]=c.color,d["marker.line.color"]=c.color;break;case b.ChartSeriesLayout.FontSizeProperty:this.processSeriesPlotTypeSpecificUpdate(c,d);break;case b.ChartSeriesLayout.ShowProperty:this.processSeriesVisibilityUpdate(c,d),g=c.show;break;case b.ChartSeriesLayout.ShowInLegendProperty:this.processSeriesVisibilityUpdate(c,d);break;case b.ChartSeriesLayout.ShowHoverInfoProperty:case b.ChartSeriesLayout.HoverInfoProperty:this.processSeriesHoverInfoUpdate(c,d)}else a.owner!==c.scatter&&a.owner!==c.bar&&a.owner!==c.pie||this.processSeriesPlotTypeSpecificUpdate(c,d);if(this.restyleTracesIfNeeded(d,this._series2TraceIndex[c.seriesName]),f&&this.fixAxesRanges(c),g){var h={};h[c.seriesName]=this.chart.getSeriesByName(c.seriesName).items(),this.updateTracesData(h)}}}},n.prototype.onChartLayoutPropertyChanged=function(c){m.prototype.onChartLayoutPropertyChanged.call(this,c);var d=!1,e={};if(this.layout&&this.layout.isActive){if(c===a.PropertyChangedEventArgs.Empty)d=!0;else switch(c.propertyName){case b.ChartLayout.FlipAxesProperty:d=!(this._isInPieMode||this._isInTreeMode);break;case b.ChartLayout.IsEditableProperty:case b.ChartLayout.CanEditTitlesProperty:d=!0;break;case b.ChartLayout.TitleProperty:e.title=c.newValue,this.setPlotlyLayoutMargins(e);break;case b.ChartLayout.StackablePlotArrangementProperty:e.barmode=b.PlotlyConverter.convertStackablePlotArrangement(c.newValue);break;case b.ChartLegendLayout.ShowProperty:e.showlegend=c.newValue;break;case b.ChartLayout.MarginsProperty:this.setPlotlyLayoutMargins(e);break;case b.ChartLayout.SelectionProperty:d=this.layout.selectionHighlightMode!==b.ChartSelectionHighlightMode.None;break;case b.ChartLayout.SelectionHighlightModeProperty:d=this.layout.selection.length>0;break;case b.ChartLayout.SelectionOutlineColorProperty:case b.ChartLayout.SelectionOutlineSizeProperty:d=this.shouldHighlightSelection()}d?this.rebuildChart():this.relayoutIfNeeded(e)}},n.prototype.onChartAxisLayoutPropertyChanged=function(a){m.prototype.onChartAxisLayoutPropertyChanged.call(this,a);var c=!1,d=!this._isInPieMode&&!this._isInTreeMode&&this.getShownSeriesLayoutsOnAxis(a.axisLayout.id).length>0;if(d){var e={},f=b.PlotlyConverter.convertAxisIdToPlotlyAxisName(a.axisLayout.id,this.layout.flipAxes);switch(a.propertyName){case b.ChartAxisLayout.TitleProperty:e[f+".title"]=a.axisLayout.title;break;case b.ChartAxisLayout.ShowGridLinesProperty:e[f+".showgrid"]=a.axisLayout.showGridLines;break;case b.ChartAxisLayout.ShowZeroLineProperty:e[f+".zeroline"]=a.axisLayout.showZeroLine;break;case b.ChartAxisLayout.RangeModeProperty:this.updatePlotlyAxisRange(e,f,a.axisLayout);break;case b.ChartAxisLayout.RangeProperty:a.axisLayout.rangeMode===b.ChartAxisRangeMode.Fixed&&this.updatePlotlyAxisRange(e,f,a.axisLayout);break;case b.ChartAxisLayout.ZoomableProperty:e[f+".fixedrange"]=!a.axisLayout.zoomable;break;case b.ChartAxisLayout.AxisTypeProperty:e[f+".type"]=b.PlotlyConverter.convertAxisType(a.axisLayout.axisType);break;case b.ChartAxisLayout.SortingProperty:case b.ChartAxisLayout.RestrictSortingComparisonToProperty:case b.ChartAxisLayout.SortingCriterionProperty:this._isInPieMode||this._isInTreeMode||a.axisLayout.axisType!==b.ChartAxisType.Categorized||(c=!0)}c?this.rebuildChart():this.relayoutIfNeeded(e)}},n.prototype.onResizeRequested=function(){m.prototype.onResizeRequested.call(this),this.resizeChartIfNeeded()},n.prototype.onRendererFeeedbackChanged=function(a,b){if(m.prototype.onRendererFeeedbackChanged.call(this,a,b),b&&b.setFeedbackImpl(null),a){var c=this;a.setFeedbackImpl({get plotAreaWidth(){return c.getPlotAreaMeasurement("width")},get plotAreaHeight(){return c.getPlotAreaMeasurement("height")}})}},n.prototype.seriesLayoutChangeCanBeIgnored=function(a){var c=a.seriesLayout;if(!this.chart.getSeriesByName(c.seriesName))return!0;if(a.owner===c.scatter&&c.plotType!==b.ChartPlotType.Scatter)return!0;if(this._isInPieMode)if(c.plotType!==b.ChartPlotType.Pie){if(!c.show||a.propertyName!==b.ChartSeriesLayout.PlotTypeProperty||a.newValue!==b.ChartPlotType.Pie&&a.oldValue!==b.ChartPlotType.Pie)return!0}else if(!c.show)return a.propertyName!==b.ChartSeriesLayout.ShowProperty;if(this._isInTreeMode)if(c.plotType!==b.ChartPlotType.Tree){if(!c.show||a.propertyName!==b.ChartSeriesLayout.PlotTypeProperty||a.newValue!==b.ChartPlotType.Tree&&a.oldValue!==b.ChartPlotType.Tree)return!0}else if(!c.show)return a.propertyName!==b.ChartSeriesLayout.ShowProperty;return!1},n.prototype.seriesLayoutChangeTriggersRebuild=function(a,c){var d=c.propertyName,e=c.oldValue,f=c.newValue;if(c.owner===a.geo)return!0;if(d===b.ChartSeriesLayout.PlotTypeProperty){if(e===b.ChartPlotType.Pie||f===b.ChartPlotType.Pie)return!0;if(e===b.ChartPlotType.Tree||f===b.ChartPlotType.Tree)return!0}return d===b.ChartSeriesLayout.FontSizeProperty&&a.plotType===b.ChartPlotType.Tree||(d===b.ChartSeriesLayout.ShowProperty&&a.plotType===b.ChartPlotType.Pie||(d===b.ChartBarSeriesLayout.BarInfoProperty&&a.plotType===b.ChartPlotType.Bar||!this.isSecondaryYAxisModeInSync()))},n.prototype.isSorted=function(){var a=!this._isInPieMode&&!this._isInTreeMode&&this.layout.axis(b.ChartAxisId.X1).axisType===b.ChartAxisType.Categorized&&this.layout.axis(b.ChartAxisId.X1).sorting!==b.ChartCategorySortingMode.None;return a},n.prototype.updateTracesData=function(a,c){var d,e=this;d=this._isInPieMode?["labels","values","text","references"]:this._isInCandleMode?["x","y","open","high","low","close","text","textbox","references"]:["x","y","text","references"];var f={};d.forEach(function(a){return f[a]=[]});var g=[];if(Object.keys(a).forEach(function(c){var h=e.layout.series(c);if(h.show&&e.isValidSeriesLayout(h)){var i=e._series2TraceIndex[c];g.push(i);var j=b.PlotlyConverter.convertSeriesData(a[c],h,e.layout);d.forEach(function(a){return f[a].push(j[a])})}}),g.length>0){this.restyleTracesIfNeeded(f,g);var h={};this.iterateWindowAxis(function(a){var c=b.PlotlyConverter.convertAxisIdToPlotlyAxisName(a.id,e.layout.flipAxes);e.updatePlotlyAxisRange(h,c,a)}),this.tryUpdatePlotlyLayoutWithCategoryOrder(h,c);var i=this.generateAnnotations();i.length>0?h.annotations=i:delete h.annotations,this.relayoutIfNeeded(h),this.updateActualRanges()}},n.prototype.tryUpdatePlotlyLayoutWithCategoryOrder=function(c,d){var e=b.PlotlyConverter.convertAxisIdToPlotlyAxisName(b.ChartAxisId.X1,this.layout.flipAxes),f=this.plotlyLayout[e];f&&(this.isSorted()&&d&&d.length>0?("array"!==f.categoryorder&&(c[e+".categoryorder"]="array"),a.equals(f.categoryarray,d)||(c[e+".categoryarray"]=d)):("trace"!==f.categoryorder&&(c[e+".categoryorder"]="trace"),f.categoryarray&&(c[e+".categoryarray"]=null)))},n.prototype.generateAnnotations=function(){var a=this,c=[];Object.keys(this._series2TraceIndex).forEach(function(d){var e=a.layout.series(d);e.bar.barInfo!==b.ChartBarInfo.None&&c.push(e)});for(var d=.15,e=this.plotlyTraces,f=[],g=(1-d)/e.length,h=Math.floor(e.length/2),i=this.getPlotlyActualCategories("xaxis"),j=0,k=c;j<k.length;j++){var l=k[j],m=this._series2TraceIndex[l.seriesName],n=m-h;e.length%2===0&&(n+=.5);for(var o=0;o<i.length;o++){var p=i[o],q=e[m].x.indexOf(p);if(q>=0){var r=o+n*g,s=e[m].y[q],t="";l.bar.barInfo!==b.ChartBarInfo.None&&(t=null!=s?s.toString():"",l.bar.barInfo===b.ChartBarInfo.Text&&"undefined"!=typeof e[m].text&&(t=e[m].text[q]));var u={x:r,y:s,text:t,xanchor:"center",yanchor:s>=0?"bottom":"top",showarrow:!1};f.push(u)}}}return f},n.prototype.rebuildChart=function(){var a=this;this.clearContainer(),this._series2TraceIndex={},this._isInPieMode=this.getShownSeriesLayoutsWithPlotType(b.ChartPlotType.Pie).length>0,this._isInTreeMode=this.getShownSeriesLayoutsWithPlotType(b.ChartPlotType.Tree).length>0,this._isInBubbleMode=this.getShownSeriesLayoutsWithPlotType(b.ChartPlotType.Bubble).length>0,this._isInGeoMode=this.getShownSeriesLayoutsWithPlotType(b.ChartPlotType.ScatterGeo).length>0,this._isInBoxMode=this.getShownSeriesLayoutsWithPlotType(b.ChartPlotType.BoxPlot).length>0,this._isInCandleMode=this.getShownSeriesLayoutsWithPlotType(b.ChartPlotType.CandleStick).length>0;var c=[];this.chart.series.forEach(function(b){var d=a.createTraceFromSeries(b);null!=d&&(a._series2TraceIndex[b.name]=c.push(d)-1)}),this._isInBubbleMode&&this.resizeBubbleMarkers(c,.05,.2);var d={};this.rebuildCommonChartLayout(d),this._isInTreeMode?this.rebuildTreePlotlyLayout(c,d):this._isInPieMode?this.setPlotlyPieDomains(c):this._isInGeoMode?(this.resizeBubbleMarkers(c,.0175,.05),this.rebuildGeoPlotlyLayout(d)):this._isInBoxMode?(this.rebuildCartesianPlotlyLayout(d),this.rebuildBoxPlotlyLayout(d)):this._isInCandleMode?(this.rebuildCartesianPlotlyLayout(d),this.rebuildCandlePlotlyLayout(d)):this.rebuildCartesianPlotlyLayout(d),this.setPlotlyLayoutMargins(d);var e=$.extend({x:!0,x2:!0,y:!0,y2:!0,main:!0},this.layout.canEditTitles);this.layout.axis(b.ChartAxisId.X1).rangeMode===b.ChartAxisRangeMode.Window?this._plotly.newPlot(this.container,c,d,{showLink:!1,displaylogo:!1,displayModeBar:!1,doubleClick:l.None,editable:this.layout.isEditable,editableAxisXTitle:e.x,editableAxisYTitle:e.y,editableAxisX2Title:e.x2,editableAxisY2Title:e.y2,editableMainTitle:e.main}):this._plotly.newPlot(this.container,c,d,{showLink:!1,displaylogo:!1,displayModeBar:!1,doubleClick:l.ResetAndAutoSize,editable:this.layout.isEditable,editableAxisXTitle:e.x,editableAxisYTitle:e.y,editableAxisX2Title:e.x2,editableAxisY2Title:e.y2,editableMainTitle:e.main}),this.commitSeriesDataChanges(),this.highlightSelection();var f=this.generateAnnotations();if(f.length>0&&this.relayoutIfNeeded({annotations:f}),this.layout.axis(b.ChartAxisId.X1).rangeMode===b.ChartAxisRangeMode.Window){var g=this.layout.axis(b.ChartAxisId.X1),h=b.PlotlyConverter.convertAxisIdToPlotlyAxisName(b.ChartAxisId.X1,this.layout.flipAxes),i={};this.updatePlotlyAxisRange(i,h,g),this.relayoutIfNeeded(i)}this.updateActualRanges(),this.resizeChartIfNeeded()},n.prototype.rebuildCommonChartLayout=function(a){a.title=this.layout.title;var d=this.layout.legend;a.showlegend=d.show,this.layout.dragmode===b.DragMode.zoom?a.dragmode=k.zoom:this.layout.dragmode===b.DragMode.pan?a.dragmode=k.pan:this.layout.dragmode===b.DragMode.lasso?a.dragmode=k.lasso:a.dragmode=k.select,d.show&&(a.legend={},this.processLegendUpdate(d,a.legend)),a.font={family:'"Source Sans Pro", Arial, Helvetica, sans-serif',size:this.layout.fontSize},a.hovermode=c.Closest},n.prototype.getHorizontalAxisLayout=function(){var a=this.layout,c=this.layout.flipAxes;return c?b.PlotlyConverter.rebuildPlotlyAxisLayout(a.axis(b.ChartAxisId.Y1),{},c,a):b.PlotlyConverter.rebuildPlotlyAxisLayout(a.axis(b.ChartAxisId.X1),{},c,a)},n.prototype.getVerticalAxisLayout=function(){var a=this.layout,c=this.layout.flipAxes;return c?b.PlotlyConverter.rebuildPlotlyAxisLayout(a.axis(b.ChartAxisId.X1),{},c,a):b.PlotlyConverter.rebuildPlotlyAxisLayout(a.axis(b.ChartAxisId.Y1),{},c,a)},n.prototype.getSecondaryVerticalAxisLayout=function(){var a=this.layout,c=this.layout.flipAxes;return c?b.PlotlyConverter.rebuildPlotlyAxisLayout(a.axis(b.ChartAxisId.X2),{},c,a):b.PlotlyConverter.rebuildPlotlyAxisLayout(a.axis(b.ChartAxisId.Y2),{},c,a)},n.prototype.rebuildCartesianPlotlyLayout=function(a){var c=this.layout;a.barmode=b.PlotlyConverter.convertStackablePlotArrangement(c.stackablePlotArrangement),a.bargroupgap=.05,a.xaxis=this.getHorizontalAxisLayout(),a.yaxis=this.getVerticalAxisLayout(),this._isInSecondaryYAxisMode=this.getShownSeriesLayoutsOnAxis(b.ChartAxisId.Y2,!0).length>0,this._isInSecondaryYAxisMode&&(a.yaxis2=this.getSecondaryVerticalAxisLayout())},n.prototype.rebuildBoxPlotlyLayout=function(a){},n.prototype.rebuildCandlePlotlyLayout=function(a){a.xaxis={rangeslider:{visible:!1}}},n.prototype.getGeoLandColor=function(a){return a.landColor||this.getThemeDefault("@secondary","gray")},n.prototype.rebuildGeoPlotlyLayout=function(a){var c=this.chart.series.item(0),d=this.layout.series(c.name),e=d.geo,f=b.PlotlyConverter.convertMap(e.map),g=this.getGeoLandColor(e);a.geo={scope:f,resolution:50,showland:!0,showcoastlines:!1,countrycolor:this.getBackgroundColor(),showcountries:!0,showocean:e.showOcean,landcolor:g,oceancolor:e.oceanColor,framecolor:g,framewidth:.5},a.showlegend=!1},n.prototype.calculateTreemapColors=function(a){var c=this._plotly.colorDefaults(),d=[],e=this.getShownSeriesLayoutsWithPlotType(b.ChartPlotType.Tree);if(e.length!==a.length)throw new Error("Trace length mismatch");var f=[];if(1===e.length){for(var g=this.chart.series.item(0),h=0;h<g.length;h++){var i=g.item(h);d.push(i.color||c[h%c.length])}f.push(d)}else{for(var h=0;h<e.length;h++)d.push(e[h].color||c[h%c.length]);for(var j=function(b){var c=a[b].values.map(function(a){return d[b]});f.push(c)},k=0;k<a.length;k++)j(k)}return f},n.prototype.computeAggregateTextValue=function(a,b,c,d,e){var f="";return e.showSeriesName&&(f+=a+"<br>"),e.showX&&(f+=b+"<br>"),e.showY&&(f+=c+"<br>"),e.showText&&(f+=d),f},n.prototype.rebuildTreePlotlyLayout=function(a,c){for(var d=[],e=0,f=a;e<f.length;e++){var g=f[e];g.values&&g.values.length&&d.push(g.values)}if(0!==d.length&&0!==d[0].length){var h=b.Treemap.treemapMultidimensional(d,100,100,0,0),i=h.length>1;if(!i||0!==this._lastContainerHeight){var j=this.calculateTreemapColors(a),k=[],l=[],m=[],n=[],o=[],p=[],q=[],r=this.chart.series.item(0),s=this.layout.series(r.name),t=s.fontSize||this.layout.fontSize,u=0,v=[],w=[];if(i)for(var x=0,y=h;x<y.length;x++){for(var z=y[x],A=100,B=0,C=100,D=0,E=0,F=z;E<F.length;E++){var G=F[E];A=Math.min(A,G[1]),B=Math.max(B,G[3]),C=Math.min(C,G[0]),D=Math.max(D,G[2])}for(var H=B-A,I=H/100*this._lastContainerHeight,J=22,K=J/I,L=1-K,M=0,N=z;M<N.length;M++){var G=N[M],O=(G[1]-A)*L+A,P=(G[3]-A)*L+A;G[1]=O,G[3]=P}var Q=(B-A)*L+A,R={type:"rect",x0:C,y0:Q,x1:D,y1:B,line:{width:2,color:this.getBackgroundColor()},fillcolor:"#666666",classes:"treemap-header"},S=D-C,T=B-Q,U=S/100*this._lastContainerWidth,V=T/100*this._lastContainerHeight,W=t/1.2,X=Math.ceil(U/W)-1,Y=t/.75,Z=t/.4,$=Math.ceil(V/Z),_=a[u].name;if(Y>V||W>U||X<3)_="";else if(_.length>X)for(var aa=0,ba=0;aa+X<_.length;){var ca=aa+X;if(_=_.substr(0,ca)+"<br>"+_.substr(ca),aa+=X+4,ba+=1,ba>=$){_=_.substr(0,ca);break}}var da={x:C,y:(Q+B)/2,text:_,borderpad:5,showarrow:!1,xanchor:"left",font:{size:t,color:"#FFFFFF"},classes:"treemap-header-text"};v.push(R),w.push(da),u++}var ea=[];u=0;for(var fa=0,ga=h;fa<ga.length;fa++){for(var z=ga[fa],ha=0,ia=0,ja=z;ia<ja.length;ia++){var G=ja[ia],ka=i?j[u%j.length]:j[0],la={type:"rect",x0:G[0],y0:G[1],x1:G[2],y1:G[3],seriesName:this.getSeriesLayoutFromTraceIndex(u).seriesName,reference:a[u].references[ha],line:{width:2,color:this.getBackgroundColor()},fillcolor:ka[ha%ka.length],classes:"treemap-value"};k.push(la);var ma=a[u].labels[ha],na=ma;na||(na="");var T=G[3]-G[1],V=T/100*this._lastContainerHeight,Y=t/.75,S=G[2]-G[0],U=S/100*this._lastContainerWidth,W=t/1.2,X=Math.ceil(U/W)-1,Z=t/.4,$=Math.ceil(V/Z);if(Y>V||W>U||X<3)na="";else if(na.length>X)for(var aa=0,ba=0;aa+X<na.length;){var ca=aa+X;if(na=na.substr(0,ca)+"<br>"+na.substr(ca),aa+=X+4,ba+=1,ba>=$){na=na.substr(0,ca);break}}var oa={x:(G[0]+G[2])/2,y:(G[1]+G[3])/2,text:na,showarrow:!1,font:{size:t,color:"#FFFFFF"},classes:"treemap-value-text"};l.push(oa),m.push((G[0]+G[2])/2),n.push((G[1]+G[3])/2);var pa=a[u].values?a[u].values[ha]:"",qa=void 0;"number"==typeof pa&&(qa=pa,pa=qa.toFixed(2));var ra={seriesName:this.getSeriesLayoutFromTraceIndex(u).seriesName,x:a[u].labels[ha],y:a[u].values[ha],id:void 0,text:a[u].text[ha]};ea.push(ra);var _=this.computeAggregateTextValue(a[u].name,a[u].labels[ha],a[u].values[ha],a[u].text[ha],this.getSeriesLayoutFromTraceIndex(u).hoverInfo);o.push(_),p.push(ma),q.push({x0:G[0],y0:G[1],x1:G[2],y1:G[3]}),ha++}u++}k=k.concat(v),l=l.concat(w),a[0].x=m,a[0].y=n,a[0].text=o,a[0].mode="none",a[0].type="scatter",a[0].hoverinfo="text",a[0].originalPoints=ea;for(var sa=0,ta=a;sa<ta.length;sa++){var ua=ta[sa];ua.rect=q}c.showlegend=!1,c.hovermode="closest",c.hoverFollowsMouse=!0,c.xaxis={showgrid:!1,zeroline:!1,showticklabels:!1,fixedrange:!0},c.yaxis={showgrid:!1,zeroline:!1,showticklabels:!1,fixedrange:!0},c.shapes=k,c.annotations=l}}},n.prototype.createTraceFromSeries=function(a){var c=null,d=this.layout.series(a.name);if(this.isValidSeriesLayout(d)){if(c=b.PlotlyConverter.convertSeriesData(a.items(),d,this.layout),c.type=b.PlotlyConverter.convertPlotType(d.plotType),c.opacity=d.opacity,this.processSeriesVisibilityUpdate(d,c),this.processSeriesHoverInfoUpdate(d,c),this._isInPieMode||this._isInTreeMode){c.name=a.displayName;for(var e=0;e<c.labels.length;e++)c.labels[e]=this.trimLabel(c.labels[e])}else this.processSeriesAxesUpdate(d,c),c.marker=c.marker||{},Array.isArray(c.marker.size)||(c.marker.size=d.markerSize),c.marker.color||(c.marker.color=d.color),c.marker.line?(c.marker.line.color=d.color,c.marker.line.width=0):c.marker.line={color:d.color,width:0};this.processSeriesPlotTypeSpecificUpdate(d,c)}return c},n.prototype.restyleTracesIfNeeded=function(a,b){
Object.keys(a).length>0&&this._plotly.restyle(this.container,a,b),this.resizeChartIfNeeded()},n.prototype.relayoutIfNeeded=function(a){Object.keys(a).length>0&&this._plotly.relayout(this.container,a),this.resizeChartIfNeeded()},Object.defineProperty(n.prototype,"plotlyTraces",{get:function(){return this.container?this.container.data:[]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"plotlyLayout",{get:function(){return this.container?this.container.layout:{}},enumerable:!0,configurable:!0}),n.prototype.getPlotlyActualCategories=function(a){return this.container&&this.container._fullLayout&&this.container._fullLayout[a]?this.container._fullLayout[a]._categories||[]:[]},n.prototype.resizeChartIfNeeded=function(){var a=this,b=this.container.offsetWidth,c=this.container.offsetHeight;if(b>n.MIN_CHART_WIDTH&&c>n.MIN_CHART_HEIGHT&&(b!==this._lastContainerWidth||c!==this._lastContainerHeight)){this._lastContainerWidth=b,this._lastContainerHeight=c,(this._isInTreeMode||this._isInBubbleMode||this._isInGeoMode)&&this.plotlyTraces.length>=1&&this.rebuildChart();var d=this._plotly.Plots.resize(this.container);d.then(function(){a.feedback&&a.feedback.chartSizeChanged.raise(a.feedback,null)})}},n.prototype.isSecondaryYAxisModeInSync=function(){var a=this.getShownSeriesLayoutsOnAxis(b.ChartAxisId.Y2,!0).length>0;return a===this._isInSecondaryYAxisMode},n.prototype.isValidSeriesLayout=function(a){return this._isInPieMode?a.plotType===b.ChartPlotType.Pie&&a.show:a.plotType!==b.ChartPlotType.Pie},n.prototype.setPlotlyLayoutMargins=function(a){var b=this.layout.margins||{left:null,top:null,right:null,bottom:null},c={l:10,t:10,r:10,b:10};b.top&&(c.t=b.top),b.left&&(c.l=b.left),b.right&&(c.r=b.right),b.bottom&&(c.b=b.bottom),a.margin=c},n.prototype.calcExtraMarginForLegend=function(c,d){if(this._isInPieMode)return 0;this.layout.flipAxes&&(c=c===b.ChartAxisDimension.X?b.ChartAxisDimension.Y:b.ChartAxisDimension.X);var e=new b.ChartAxisId(c,d),f=0,g=this.layout.axis(e);if(this.getShownSeriesLayoutsOnAxis(e).length>0){var h=g.title;a.isNullOrWhiteSpace(h)&&!this.layout.isEditable||(f+=25)}return f},n.prototype.setPlotlyPieDomains=function(a){var b=a.length;if(b>1)for(var c=.1,d=Math.ceil(Math.sqrt(b)),e=b>2?Math.ceil(b/d):1,f=1/(e+c*(e-1)),g=f*c,h=1/(d+c*(d-1)),i=h*c,j=0;j<b;j++){var k=Math.floor(j/d),l=j%d,m=(h+i)*l,n=1-(f+g)*k;a[j].domain={x:[m,m+h],y:[n-f,n]}}},n.prototype.getPlotlyAxis=function(a){var c=b.PlotlyConverter.convertAxisIdToPlotlyAxisName(a,this.layout.flipAxes);return c&&this.plotlyLayout?this.plotlyLayout[c]:null},n.prototype.convertHorizontalAxisIdToTraceAxisField=function(a){var c=this.layout.flipAxes;return c?b.PlotlyConverter.convertAxisIdToTraceAxisField(a.axisY,c):b.PlotlyConverter.convertAxisIdToTraceAxisField(a.axisX,c)},n.prototype.convertVerticalAxisIdToTraceAxisField=function(a){var c=this.layout.flipAxes;return c?b.PlotlyConverter.convertAxisIdToTraceAxisField(a.axisX,c):b.PlotlyConverter.convertAxisIdToTraceAxisField(a.axisY,c)},n.prototype.processSeriesAxesUpdate=function(a,b){b.xaxis=this.convertHorizontalAxisIdToTraceAxisField(a),b.yaxis=this.convertVerticalAxisIdToTraceAxisField(a),b.name=this.processSeriesDisplayNameForLegend(a.seriesName)},n.prototype.processSeriesDisplayNameForLegend=function(a){var b=this.layout.series(a),c=this.chart.getSeriesByName(a),d=c.displayName,e=this.layout.legend.secondaryAxisIndicator;return 2===b.axisYIndex&&null!=e&&e.length>0&&(d=e+" "+d),this.trimLabel(d)},n.prototype.trimLabel=function(a){var b=a,c=4,d=17,e=0,f=0;if(this._isInTreeMode)return a;for(;e+d<b.length;){if(f++,2===f){b=b.substr(0,2*d+c-3)+"...";break}var g=e+d;b=b.substr(0,g)+"<br>"+b.substr(g),e+=d+c}return b},n.prototype.processSeriesHoverInfoUpdate=function(a,c){var g;if(a.showHoverInfo){var h=a.hoverInfo,i=[];h.showSeriesName&&i.push(d.Name),h.showText&&i.push(d.Text),a.plotType===b.ChartPlotType.Pie?(h.showX&&i.push(f.Label),h.showY&&i.push(f.Value)):(h.showX&&i.push(e.X),h.showY&&i.push(e.Y)),g=d.concat(i)}else g=d.None;c.hoverinfo=g},n.prototype.processSeriesVisibilityUpdate=function(a,b){b.visible=!!a.show||!!a.showInLegend&&j.LegendOnly},n.prototype.processSeriesScatterUpdate=function(a,c){var d=a.scatter;c.line={width:d.lineSize,shape:b.PlotlyConverter.convertScatterLineInterpolation(d.lineInterpolation),color:a.color},c.mode=b.PlotlyConverter.convertScatterDrawMode(d.drawMode),c.fill=b.PlotlyConverter.convertScatterFillMode(d.fillMode,this.layout.flipAxes),c.marker={symbol:b.PlotlyConverter.convertScatterMarkerSymbol(d.markerSymbol,d.markerFilled),size:d.markerSize}},n.prototype.resizeBubbleMarkers=function(a,b,c){var d=this.container.offsetWidth,e=this.container.offsetHeight,f=Math.min(d,e);f=Math.max(f,125);var g=f*b,h=f*c,i=h-g,j=0,k=Number.MAX_VALUE;a.forEach(function(a){a.marker.sizeDataPoint&&a.marker.sizeDataPoint.forEach(function(a){j=Math.max(j,a),k=Math.min(k,a)})});var l=j-k;a.forEach(function(a){a.marker.size=[],a.marker.sizeDataPoint&&a.marker.sizeDataPoint.forEach(function(b){var c=l?(b-k)/l:1,d=g+i*c;a.marker.size.push(d)})})},n.prototype.shouldHighlightSelection=function(){return this.layout.selection.length>0&&this.layout.selectionHighlightMode!==b.ChartSelectionHighlightMode.None},n.prototype.highlightSelection=function(){if(this.shouldHighlightSelection()){if(this.layout.selection.length>1)throw new Error("Multiple selection is not supported");var a=this.layout.selection[0],b=a&&a.reference||{},c=this.plotlyTraces[this._series2TraceIndex[a.seriesName]];c&&(this._isInTreeMode?this.highlightTree(a):c.type===plotly.PlotlyTraceTypes.Bar||c.type===plotly.PlotlyTraceTypes.Pie?this.highlightBarOrPie(c,b):this._isInGeoMode?this.highlightGeo(c,b):this._isInBubbleMode&&this.highlightScatter(c,b),this._plotly.redraw(this.container))}},n.prototype.getSelectionColor=function(){return this.layout.selectionOutlineColor||this.getThemeDefault("@accent","rgb(0, 165, 230)")},n.prototype.getBackgroundColor=function(){return this.getThemeDefault("@background","white")},n.prototype.highlightScatter=function(a,b){a.marker.line.width=[],a.marker.line.color=[];for(var c=0;c<a.x.length;c++)a.marker.line.width[c]=0,a.marker.line.color[c]=null;a.marker.line.color[b.index]=this.getSelectionColor(),a.marker.line.width[b.index]=this.layout.selectionOutlineSize},n.prototype.highlightGeo=function(a,b){a.marker.line.width=[],a.marker.line.color=[];for(var c=0;c<a.locations.length;c++)a.marker.line.width[c]=0,a.marker.line.color[c]=null,a.locations[c]===b.id&&(a.marker.line.color[c]=this.getSelectionColor(),a.marker.line.width[c]=this.layout.selectionOutlineSize)},n.prototype.highlightTree=function(a){var b=a&&a.reference||{},c=b.id&&"id"||b.x&&"x"||b.index&&"index";if(c&&this.plotlyLayout.shapes)for(var d=0;d<this.plotlyLayout.shapes.length;d++){var e=this.plotlyLayout.shapes[d];if(e.seriesName===a.seriesName&&b[c]&&e.reference[c]===b[c]){e.line.color=this.getSelectionColor(),e.line.width=this.layout.selectionOutlineSize;var f=e;this.plotlyLayout.shapes[d]=this.plotlyLayout.shapes[this.plotlyLayout.shapes.length-1],this.plotlyLayout.shapes[this.plotlyLayout.shapes.length-1]=f;break}}},n.prototype.highlightBarOrPie=function(a,b){var c,d=null,e=0,f=!1;switch(a.type){case plotly.PlotlyTraceTypes.Bar:c="x";break;case plotly.PlotlyTraceTypes.Pie:c="labels",d=this.getBackgroundColor(),e=3,f=!0;break;default:return}var g,h=[],i=[],j=[];g=null!=b.id?"id":null!=b.x?"x":"index";for(var k=0,l=a.references;k<l.length;k++){var m=l[k];m[g]===b[g]?(h.push(this.getSelectionColor()),i.push(this.layout.selectionOutlineSize),j.push(.05)):(h.push(d),i.push(e),j.push(0))}a.marker=a.marker||{},a.marker.line={color:h,width:i},f&&(a.pull=j)},n.prototype.processSeriesBarUpdate=function(a,c){var d=a.bar.orientation;c.orientation=b.PlotlyConverter.convertBarPlotOrientation(d,this.layout.flipAxes)},n.prototype.processSeriesPieUpdate=function(a,c){c.textinfo=b.PlotlyConverter.convertPiePlotSliceInfo(a.pie.sliceInfo),c.sort=!1,c.textposition=g.Inside,c.hole=a.pie.hole;var d=a.fontSize||this.layout.fontSize;c.insidetextfont={size:d},c.outsidetextfont={size:d},c.marker||(c.marker={}),c.marker.line={width:3,color:this.getBackgroundColor()}},n.prototype.processSeriesBubbleUpdate=function(a,b){b.mode=plotly.PlotlyScatterPlotMode.Markers},n.prototype.processSeriesTreeUpdate=function(a,b){},n.prototype.fixAxesRanges=function(a){var c=this,d={};[a.axisX,a.axisY].forEach(function(a){var e=c.layout.axis(a);if(e.rangeMode===b.ChartAxisRangeMode.Fixed){var f=b.PlotlyConverter.convertAxisIdToPlotlyAxisName(a,c.layout.flipAxes);c.updatePlotlyAxisRange(d,f,e)}}),this.relayoutIfNeeded(d)},n.prototype.processSeriesPlotTypeSpecificUpdate=function(a,c){a.plotType===b.ChartPlotType.Scatter?this.processSeriesScatterUpdate(a,c):a.plotType===b.ChartPlotType.Bubble?this.processSeriesBubbleUpdate(a,c):a.plotType===b.ChartPlotType.Bar?this.processSeriesBarUpdate(a,c):a.plotType===b.ChartPlotType.Pie?this.processSeriesPieUpdate(a,c):a.plotType===b.ChartPlotType.Tree&&this.processSeriesTreeUpdate(a,c)},n.prototype.processLegendUpdate=function(a,c){var d=b.PlotlyConverter.convertStackablePlotArrangement(this.layout.stackablePlotArrangement);"relative"===d?c.traceorder="reversed":c.traceorder="normal",c.orientation=b.PlotlyConverter.ConvertLegendOrientation(a.orientation);var e,f=.02,g=.05;switch(a.horizontalAnchor){case b.ChartLegendHorizontalAnchorPoint.OuterLeft:if(e=this.calcExtraMarginForLegend(b.ChartAxisDimension.Y,1)/1500,this.layout._axisLayouts.Y2&&this.layout._axisLayouts.Y2.title&&this.layout._axisLayouts.Y2.title.length>0){var j=1;j=this.container.offsetWidth>0?this.container.offsetWidth:1,j<500?g=.3:j<600?g=.2:j<900&&(g=.1)}c.x=-g-e,c.xanchor=h.Right;break;case b.ChartLegendHorizontalAnchorPoint.OuterRight:if(e=this.calcExtraMarginForLegend(b.ChartAxisDimension.Y,2)/1500,this.layout._axisLayouts.Y2&&this.layout._axisLayouts.Y2.title&&this.layout._axisLayouts.Y2.title.length>0){var j=1;j=this.container.offsetWidth>0?this.container.offsetWidth:1,j<500?(g=.4,e=0):j<600?(g=.25,e=0):j<900&&(g=.15,e=0)}c.x=1+g+e,c.xanchor=h.Left;break;case b.ChartLegendHorizontalAnchorPoint.Center:c.x=.5,c.xanchor=h.Center;break;case b.ChartLegendHorizontalAnchorPoint.InnerLeft:c.x=f,c.xanchor=h.Left;break;case b.ChartLegendHorizontalAnchorPoint.InnerRight:c.x=1-f,c.xanchor=h.Right}switch(a.verticalAnchor){case b.ChartLegendVerticalAnchorPoint.OuterTop:c.y=1+g,c.yanchor=i.Bottom;break;case b.ChartLegendVerticalAnchorPoint.OuterBottom:c.y=-g,c.yanchor=i.Top;break;case b.ChartLegendVerticalAnchorPoint.Center:c.y=.5,c.yanchor=i.Center;break;case b.ChartLegendVerticalAnchorPoint.InnerTop:c.y=1-f,c.yanchor=i.Top;break;case b.ChartLegendVerticalAnchorPoint.InnerBottom:c.y=f,c.yanchor=i.Bottom}},n.prototype.iterateWindowAxis=function(a){var c=this,d=b.ChartAxisId.All.map(function(a){return c.layout.axis(a)}).filter(function(a){return a.rangeMode===b.ChartAxisRangeMode.Window});d.length>0&&d.forEach(function(b){a(b)})},n.prototype.handlePlotlyDragstartAction=function(a){var b=this;this.iterateWindowAxis(function(a){b._disabledAutoScrollAxisMap[a.id.index]=!1})},n.prototype.handlePlotlyDragendAction=function(a){var b=this;this.iterateWindowAxis(function(a){var c=b.getActualRange(a.id),d=b.normalizeToTimestamp(b.getLastValue(a.id)),e=b.normalizeToTimestamp(c.to);b._disabledAutoScrollAxisMap[a.id.index]=e<d})},n.prototype.normalizeToTimestamp=function(a,b){var c=a;if("string"==typeof c)if(b){var d=new Date(this._plotly.dateTime2ms(c));c=new Date(d.getTime()+60*b.getTimezoneOffset()*1e3)}else c=new Date(this._plotly.dateTime2ms(c));return c instanceof Date&&(c=c.getTime()),c},n.prototype.updatePlotlyAxisRange=function(a,c,d){var e=this.getPlotlyAxis(d.id),f=this.getActualRange(d.id),g=d.rangeMode===b.ChartAxisRangeMode.Auto;e.autorange!==g&&(a[c+".autorange"]=g);var h=null;switch(d.rangeMode){case b.ChartAxisRangeMode.Auto:break;case b.ChartAxisRangeMode.Fixed:b.ChartAxisLayout.rangesAreEqual(f,d.range)||(h=b.PlotlyConverter.convertRangeToNumberArray(d.range,d.axisType===b.ChartAxisType.DateTime));break;case b.ChartAxisRangeMode.Window:if(!this._disabledAutoScrollAxisMap[d.id.index]){if(d.axisType===b.ChartAxisType.Categorized)throw new Error(b.Strings.Err_PlotlyChartRenderer_WindowRangeMode_NotSupported_InCategorizedAxes);var i=this.normalizeToTimestamp(this.getLastValue(d.id)),j=this.normalizeToTimestamp(f.to);if(d.startup){if(i>j){var k=this.getRangeFromWindow(i,d);h=b.PlotlyConverter.convertRangeToNumberArray(k,!1)}}else{var k=this.getRangeFromWindow(i,d);h=b.PlotlyConverter.convertRangeToNumberArray(k,!1),h[1]+=.03*(h[1]-h[0]),d.startup=1}}break;default:throw new Error(b.Strings.Err_PlotlyChartRenderer_Unsupported_ChartAxis_RangeMode)}h&&(a[c+".range"]=h)},n.prototype.getLastValue=function(a){var c=null;return this.getShownSeriesOnAxis(a).forEach(function(d){var e=b.ChartSeries.getValueForDimension(a.dimension,d.lastPoint);(null===c||e>c)&&(c=e)}),c},n.prototype.collectSeriesPointsCollectionChanged=function(a){var b=this;a.forEach(function(a){return b._updatedSeries[a.name]=a}),this._throttledCommitSeriesDataChanges()},n.prototype.commitSeriesDataChanges=function(){var a=this;if(this.isDisposed()!==!0&&this.layout){var b={},c=null;this.isSorted()?(c=this.dataIndexer.sortedCategories,b=this.dataIndexer.sortedSeriesMap):Object.keys(this._updatedSeries).filter(function(b){return"undefined"!=typeof a._series2TraceIndex[b]}).forEach(function(c){b[c]=a._updatedSeries[c].items()}),Object.keys(b).length>0&&this.updateTracesData(b,c),this._updatedSeries={}}},n.prototype.bindToPlotlyEvents=function(){$(this.container).on("click",this._rootClickHandler),$(this.container).on("mousedown",this._rootMousedownHandler),$(this.container).on("plotly_click",this._plotlyClickHandler),$(this.container).on("plotly_zoom",this._plotlyZoomHandler),$(this.container).on("plotly_relayout",this._plotlyRelayoutHandler),$(this.container).on("plotly_legend_toggleVisible",this._plotlyLegendActionHandler),$(this.container).on("plotly_dragstart",this._plotlyDragstartHandler),$(this.container).on("plotly_dragend",this._plotlyDragendHandler)},n.prototype.unbindFromPlotlyEvents=function(){$(this.container).off("click",this._rootClickHandler),$(this.container).off("mousedown",this._rootMousedownHandler),$(this.container).off("plotly_click",this._plotlyClickHandler),$(this.container).off("plotly_zoom",this._plotlyZoomHandler),$(this.container).off("plotly_relayout",this._plotlyRelayoutHandler),$(this.container).off("plotly_legend_toggleVisible",this._plotlyLegendActionHandler),$(this.container).off("plotly_dragstart",this._plotlyDragstartHandler),$(this.container).off("plotly_dragend",this._plotlyDragendHandler)},n.prototype.handleRootClick=function(a,b){this._isInPieMode||this._isInGeoMode||(0===a.button&&this.updateSelection([]),this.raiseFeedback(a.button,[]))},n.prototype.handleRootMousedown=function(a,b){(this._isInPieMode||this._isInGeoMode)&&(0===a.button&&this.updateSelection([]),this.raiseFeedback(a.button,[]))},n.prototype.getSelectionFromMouseEvent=function(a){var b;if(this._isInPieMode){var c=a.points[0],d=this.getSeriesLayoutFromTraceIndex(c.curveNumber);b={seriesName:d.seriesName,reference:{x:c.label}}}else if(this._isInTreeMode){var e=a.points[0],f=e.data.originalPoints,g=f[e.pointNumber];b={seriesName:g.seriesName,reference:{x:g.x}},g.id&&(b.reference.id=g.id)}else if(this._isInGeoMode){var h=a.points[0],d=this.getSeriesLayoutFromTraceIndex(h.curveNumber);b={seriesName:d.seriesName,reference:{id:h.data.locations[h.pointNumber]}}}else if(this._isInCandleMode);else if(this._isInBoxMode){var i=a.points;if(i&&i.length){var h=i[0],d=this.getSeriesLayoutFromTraceIndex(h.curveNumber);b=1===i.length?{seriesName:d.seriesName,reference:h.data.references[h.pointNumber]}:{seriesName:d.seriesName,reference:{}}}}else{var h=a.points[0],d=this.getSeriesLayoutFromTraceIndex(h.curveNumber);b={seriesName:d.seriesName,reference:h.data.references[h.pointNumber]}}return[b]},n.prototype.updateSelection=function(a){this.layout.selection=a},n.prototype.raiseFeedback=function(a,c){if(this.feedback){var d=this.feedback.seriesPointSelected,e=new b.ChartSeriesPointSelectedEventArgs;e.selection=c,e.mouseButton=a,d.raise(this.feedback,e)}},n.prototype.handlePlotlyClick=function(a,b){var c=window.event;c&&"undefined"!=typeof c.button&&0===c.button&&c.stopImmediatePropagation&&c.stopImmediatePropagation();var d=this.getSelectionFromMouseEvent(b);0===b.button&&this.layout.selectOnClick&&this.updateSelection(d),this.raiseFeedback(b.button,d);var e=$(a.currentTarget).closest("[ionweb-component]");if(e&&e.length>0){var f=e.scope()&&e.scope().component;f&&f.canBeActive&&e.click()}},n.prototype.handlePlotlyZoom=function(a,c){if(c.pre||this.updateActualRanges(),this.feedback){var d=b.PlotlyConverter.convertFromPlotlyZoomInfo(c,this.layout);this.feedback.zoom.raise(this.feedback,d),d.pre&&(c.userHandled=d.userHandled)}},n.prototype.handlePlotlyRelayout=function(a,c){c&&!this.layout.flipAxes?("undefined"!=typeof c.title&&(this.layout.title=c.title),"undefined"!=typeof c["xaxis.title"]&&(this.layout.axis(b.ChartAxisId.X1).title=c["xaxis.title"]),"undefined"!=typeof c["xaxis2.title"]&&(this.layout.axis(b.ChartAxisId.X2).title=c["xaxis2.title"]),"undefined"!=typeof c["yaxis.title"]&&(this.layout.axis(b.ChartAxisId.Y1).title=c["yaxis.title"]),"undefined"!=typeof c["yaxis2.title"]&&(this.layout.axis(b.ChartAxisId.Y2).title=c["yaxis2.title"])):c&&("undefined"!=typeof c.title&&(this.layout.title=c.title),"undefined"!=typeof c["xaxis.title"]&&(this.layout.axis(b.ChartAxisId.Y1).title=c["xaxis.title"]),"undefined"!=typeof c["xaxis2.title"]&&(this.layout.axis(b.ChartAxisId.Y2).title=c["xaxis2.title"]),"undefined"!=typeof c["yaxis.title"]&&(this.layout.axis(b.ChartAxisId.X1).title=c["yaxis.title"]),"undefined"!=typeof c["yaxis2.title"]&&(this.layout.axis(b.ChartAxisId.X2).title=c["yaxis2.title"]))},n.prototype.getSeriesLayoutFromTraceIndex=function(a){for(var b=null,c=Object.keys(this._series2TraceIndex),d=0,e=c;d<e.length;d++){var f=e[d];if(this._series2TraceIndex[f]===a){b=this.layout.series(f);break}}return b},n.prototype.handlePlotlyLegendAction=function(a,b){var c=this;b.traceIndices&&b.traceIndices.forEach(function(a){var d=c.getSeriesLayoutFromTraceIndex(a);d&&(d.show=b.visible===!0)})},n.prototype.updateActualRanges=function(){var a=this;b.ChartAxisId.All.forEach(function(c){var d=a.layout.axis(c),e=a.getPlotlyAxis(c);if(e&&e.range){var f=b.PlotlyConverter.convertNumberArrayToRange(e.range,d.axisType===b.ChartAxisType.DateTime);d.setActualRange(f)}})},n.prototype.getRangeFromWindow=function(a,b){var c={from:null,to:null};a instanceof Date?c.to=a.getTime():c.to=a;var d=Math.min(Math.max(.01,b.windowSlackRatio),.8);return b.startup&&(c.to+=b.windowLength*d),c.from=c.to-b.windowLength,c},n.prototype.getPlotAreaMeasurement=function(a){var b=$(this.container).find("svg.main-svg g.subplot.xy > rect"),c=b.attr(a);return Number(c)},n.prototype.getThemeDefault=function(a,b){return this._themeManager.getThemeVariableValue(a)||b},n.MIN_CHART_WIDTH=10,n.MIN_CHART_HEIGHT=10,n}(b.ChartRenderer);b.PlotlyChartRenderer=m}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(a,b,c){this._themeManager=c,this._rendererFactories={},this._logger=a.create("ChartRendererService"),this.registerDefaultRenderers(b)}return c.prototype.registerFactory=function(a,c){if(!c)throw new Error(b.Strings.Err_ChartRenderService_Factory_CannotBe_nullOrUndefined);if(!a)throw new Error(b.Strings.Err_ChartRenderService_Factory_Name_CannotBe_nullOrUndefined);this._rendererFactories[a]=c},c.prototype.unregisterFactory=function(a){if(!a)throw new Error(b.Strings.Err_ChartRenderService_Factory_Name_CannotBe_nullOrUndefined);delete this._rendererFactories[a]},Object.defineProperty(c.prototype,"factories",{get:function(){var a=this;if(!name)throw new Error(b.Strings.Err_ChartRenderService_Factory_Name_CannotBe_nullOrUndefined);return Object.keys(this._rendererFactories).map(function(b){return{name:b,factory:a._rendererFactories[b]}})},enumerable:!0,configurable:!0}),c.prototype.factory=function(a){if(!a)throw new Error(b.Strings.Err_ChartRenderService_Factory_Name_CannotBe_nullOrUndefined);return this._rendererFactories[a]},c.prototype.registerDefaultRenderers=function(c){var d=this;this.registerFactory("plotly",function(c,e){var f=Q.defer();return a.asyncRequire(["plotly"],function(a){f.resolve(new b.PlotlyChartRenderer(c,e,a,d._themeManager))}),f.promise})},c}();b.ChartRendererService=c,angular.module("ionwebCharts").service("ionweb.charts.rendererService",["ionweb.loggerFactory","ionweb.q","ionweb.themeManager",function(a,b,d){return new c(a,b,d)}])}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(a,b,c,d,e){var f=this;this.resizeService=c,this._rendererName="plotly",this.postLinked=!1,this._logger=a.create("ChartDirectiveController"),this.$postLink=function(){f._element=$('<div class="chart-directive-inner-container"></div>').get(0),d.append(f._element),d.addClass("chart-directive-outer-container"),f.postLinked=!0,f.tryStart()},this._rendererSrv=b,e.$on("$destroy",function(){f.stop()})}return Object.defineProperty(c.prototype,"data",{get:function(){return this._dm},set:function(a){if(a!==this._dm){if(this._started){var b=this._layout;this.stop(),this._layout=b}this._dm=a,this.tryStart()}},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"renderer",{get:function(){return this._rendererName},set:function(a){this._rendererName!==a&&(this._rendererName=a,this.tryStart())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"layout",{get:function(){return this._layout},set:function(a){this._layout!==a&&(this._layout=a,this.trySetRendererLayout())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"feedback",{get:function(){return this._feedback},set:function(a){this._feedback!==a&&(this._feedback=a,this.trySetRendererFeedback())},enumerable:!0,configurable:!0}),c.prototype.stop=function(){this._renderer&&(this._renderer.dispose(),this._renderer=null),this._layout&&(this._layout=null),this._dm&&(this._dm=null),this.resizeServiceSusbscription&&(this.resizeServiceSusbscription(),this.resizeServiceSusbscription=null),this._started=!1},c.prototype.tryStart=function(){var c=this;if(this._started)throw new Error(b.Strings.Err_ChartDirective_AlreadyStarted);if(this._rendererName&&this._dm&&this.postLinked){this._started=!0;var d=this._rendererSrv.factory(this._rendererName);if(!d){var e=a.stringFormat(b.Strings.Err_ChartDirective_NoFactory_ForRenderer,{renderName:this._rendererName});throw new Error(e)}d(this._dm,this._element).then(function(b){if(c._renderer=b,c.trySetRendererLayout(),c.trySetRendererFeedback(),c._renderer.layout.isActive=!0,!c.resizeServiceSusbscription){var d=function(){c._renderer&&c._renderer.resizeRequested()};c._throttledResize=a.debounce(d,250,!1),c.resizeServiceSusbscription=c.resizeService.register(c._element,c._throttledResize,!0)}}).done()}},c.prototype.trySetRendererLayout=function(){this._renderer&&this._layout&&(this._renderer.layout=this._layout)},c.prototype.trySetRendererFeedback=function(){this._renderer&&this._feedback&&(this._renderer.feedback=this._feedback)},c}();angular.module("ionwebCharts").controller("ionweb.charts.ChartDirectiveController",["ionweb.loggerFactory","ionweb.charts.rendererService","ionweb.responsivenessService","$element","$scope",function(a,b,d,e,f){return new c(a,b,d,e,f)}]),angular.module("ionwebCharts").directive("ionwebChart",[function(){return{scope:{},bindToController:{data:"=",renderer:"@?",layout:"=",feedback:"=?"},controller:"ionweb.charts.ChartDirectiveController",controllerAs:"vm",restrict:"A"}}])}(b=a.charts||(a.charts={}))}(ionweb||(ionweb={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),ionweb;!function(a){var b;!function(b){b.PREFERRED_TAG="$pref";var c="$tags",d=function(){function a(a,b,c){var d=this;this.preferenceService=b,this.ns=c,this.promise=a.waitForStartupConfiguration.then(function(){if(b.isLoaded)return d.load(),Q.when(d);var a,c=Q.defer();return a=b.loaded.add(function(){d.load(),a(),c.resolve(d)}),c.promise})}return a.prototype.load=function(){this.state=this.preferenceService.getValue("ionweb.md."+this.ns)||{},("object"!=typeof this.state||Array.isArray(this.state))&&(this.state={}),this.stateStr=JSON.stringify(this.state)},a.prototype.save=function(){if(this.suspended)this.dirty=!0;else{var a=JSON.stringify(this.state);a!==this.stateStr&&(this.stateStr=a,this.preferenceService.setValue("ionweb.md."+this.ns,this.state))}},a.prototype.getMd=function(a,b){var c=this.state[a];return c?c:(c={},b&&(this.state[a]=c),c)},a.prototype.getValue=function(a,b,c){var d=this.getMd(a)[b];return"undefined"==typeof d?c:d},a.prototype.setValue=function(a,b,c){this.getMd(a,!0)[b]=c,this.save()},a.prototype.deleteValue=function(a,b){var c=this.getMd(a);c&&"undefined"!=typeof c[b]&&(delete c[b],this.save())},a.prototype.getTags=function(a){return(this.getMd(a)[c]||[]).slice()},a.prototype.setTags=function(a,b){this.getMd(a,!0)[c]=b.slice(),this.save()},a.prototype.addTag=function(a,b){var d=this.getMd(a,!0),e=d[c];Array.isArray(e)||(e=[]),e.indexOf(b)<0&&(e.push(b),d[c]=e,this.save())},a.prototype.removeTag=function(a,b){var d=this.getMd(a);if(d){var e=d[c];if(Array.isArray(e)){var f=e.length;e=e.filter(function(a){return a!==b}),e.length!==f&&(d[c]=e,this.save())}}},a.prototype.bulkChange=function(a){this.suspended=!0,this.dirty=!1;try{a(this)}finally{this.suspended=!1,this.dirty&&this.save()}},a.prototype.clear=function(){this.state={},this.stateStr=JSON.stringify(this.state),this.dirty=!1,this.suspended=!1},a}(),e=function(){function a(a,b){this.preferenceService=b,this._widgetSpace=new d(a,b,"widgets"),this._dashboardSpace=new d(a,b,"dashboards")}return a.prototype.getWidgetSpace=function(){return this._widgetSpace.promise},a.prototype.getDashboardSpace=function(){return this._dashboardSpace.promise},a.prototype.clear=function(){this._widgetSpace.clear(),this._dashboardSpace.clear()},a}();b.MetadataService=e,a.module("ionwebShell").service("metadataService",["ionweb.applicationStatusService","ionweb.preferenceService"],function(a,b){return new e(a,b)})}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){a[a.Dashboard=0]="Dashboard",a[a.WidgetState=1]="WidgetState"}(b=a.DashboardDefinitionType||(a.DashboardDefinitionType={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(){}return b.prototype.processChange=function(b,c){var d=Object.getOwnPropertyNames(b&&b.components||{}),e=c&&c.components||{};return d=d.filter(function(c){return!e[c]||!a.equals(b.components[c],e[c])}),{compDiff:d}},b.prototype.coalesce=function(a){var b=a.reduce(function(a,b){return b&&Array.isArray(b.compDiff)&&b.compDiff.forEach(function(b){a[b]=!0}),a},{});return{compDiff:Object.getOwnPropertyNames(b)}},b.mergeMd=function(a){var b=a.reduce(function(a,b){return b&&b.forEach(function(b){a[b]=!0}),a},{});return Object.getOwnPropertyNames(b)},b}();b.ComponentExtractorProvider=c}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(c){function d(a){return a&&0===a.indexOf(c.APP_DASH_PREFIX)&&0!==a.indexOf(c.INTERNAL_DASH_PREFIX)}function e(a){return a&&0===a.indexOf(c.INTERNAL_DASH_PREFIX)}function f(a){return!!/^[0-9]+$/.test(a)}function g(b){function c(a){return"undefined"!=typeof a.name}var d,e;return"string"==typeof b&&(b={path:b}),c(b)?"undefined"==typeof b.category||b.category===a.shell.Strings.Text_Dashboard_Private_Section?(e=!1,d=[b.name]):(e=!0,d=[b.category,b.name]):Array.isArray(b.path)?(d=b.path,e=!!b.shared):"string"==typeof b.path&&(d=b.path.trim().split("/").filter(function(a){return!!a}),e=!!b.shared),{path:d,shared:e}}var h;!function(a){a[a.Private=0]="Private",a[a.Shared=1]="Shared"}(h=c.SerializableDashboardTreeType||(c.SerializableDashboardTreeType={})),c.APP_DASH_PREFIX="$",c.INTERNAL_DASH_PREFIX="$$",c.isAppDashboard=d,c.isInternalDashboard=e,c.isStorageDashboard=f;var i=function(){function b(b,c,d,e){this.dashService=b,this.category=c,this.isShared=d,this.path=e,this.taskQueue=new a.TaskQueue,this.versionedStorageChanged=new a.Event,this.storageService=this.dashService.storageService,this.notifService=this.dashService.notificationService}return b.toClonedId=function(a){return c.INTERNAL_DASH_PREFIX+a+"_"+b.clonedCount++},b.fromStorage=function(a,c,d,e,f){var g=new b(a,d,e,{root:e?h.Shared:h.Private,path:f});return g.id=c.md.id,g.uuid=c.md.contentProperties.uuid,g.logger=g.dashService.loggerFactory.create("SerializableDashboard_"+g.id),g.updateMd(c.md),g.setVersionedStorage(c.storage),g},b.fromDashboardAppData=function(c,d,e,f){var g=new b(c,a.shell.Strings.Text_Dashboard_AppDashboards,!1);return g.id=d.id,e&&(g.id=b.toClonedId(g.id)),g.logger=g.dashService.loggerFactory.create("SerializableDashboard_"+g.id),g._name=d.displayName,g._description=d.description,g.isReadOnly=!0,g.isLocal=f,g._version=-1,g.readOnlyContent=d.content&&JSON.stringify(d.content,a.LazySerializable.jsonReplacer)||"{}",g.definedCustomController=d.controllerFunction,g.storeType=d.type===a.DashboardDefinitionType.WidgetState?k.WidgetFileType:k.DashboardFileType,g._userData={widgetType:d.componentTypeId},g},b.fromClonedData=function(c,d,e,f){var g=new b(c,d.category,!1);return g.id=b.toClonedId(d.id),g.logger=g.dashService.loggerFactory.create("SerializableDashboard_"+g.id),g._name=d._name,g._description=d._description,g.isReadOnly=!0,g.isLocal=f,g._version=-1,g.readOnlyContent=e&&JSON.stringify(e)||"{}",g.storeType=d.storeType,g._userData=a.extend({},[d._userData]),g},b.linkFrom=function(c,d,e,f,g,h){var i=new b(c.dashService,null,!1,h&&a.extend({},[h.path]));return i.id=d,i.uuid=e,i._version=f,i.logger=i.dashService.loggerFactory.create("SerializableDashboard_link_"+i.id),i.parentMetaId=g,i.isLink=c.id,i.owner=c.owner,i.linkTo=c,i._name=c.getName(),i},b.prototype.dispose=function(){this.disposeVerStorage()},b.prototype.disposeVerStorage=function(){this.versionedStorage&&(this.versionedStorageUnsub(),this.versionedStorageUnsub=null,this.versionedStorage.dispose(),this.versionedStorage=null)},b.prototype.checkReadOnly=function(){return this.readOnlyContent?Q.reject(a.shell.Strings.Err_Dashboard_ReadOnly):null},b.prototype.getVersion=function(){return this._version},b.prototype.updateVersionExt=function(a){a>this._version&&(this._version=a),this.versionedStorage&&this.versionedStorage.updateVersionRootExt(a)},b.prototype._updateMeta=function(b){var c=this,d=this.checkReadOnly();if(d)return d;var e=a.extend({},[this._userData,b.userData]),f=null;if(!a.equals(this._userData,e)){f=this.dashService.buildUserData(e);var g=this.storageService.validateUserData(f);if(g)return Q.reject(new Error(g))}var h;return h=this.isLink?this.storageService.update(this.id,this._version,{description:b.description||this._description,displayName:b.displayName||this._name,userData:f},null,"ds.updMeta").then(function(a){return c._version=a.affectedStoreMetadata.version,a.affectedStoreMetadata}):this.getVersionedStorage().then(function(){return c.versionedStorage.updateMeta({description:b.description,displayName:b.displayName,userData:f})}),h.then(function(a){c._version=a.version,c._name=a.contentProperties.displayName,c._description=a.contentProperties.description,c._userData=c.dashService.extractUserData(a.contentProperties.userData)})},b.traceAnalyticsDisplayNameMapping=function(a,c,d){b.dashboardMappingLogged[c]||(b.dashboardMappingLogged[c]=!0,a.analytics("Mapping","Dashboard","Id:"+c+";DisplayName:"+d));
},b.prototype.traceAnalytics=function(a,c,d){b.traceAnalyticsDisplayNameMapping(this.logger,this.id,this._name),b.traceAnalyticsString(this.logger,this.id,a,c,d)},b.traceAnalyticsString=function(b,c,d,e,f){var g=e?"Id:"+c+";"+e:c;b.analytics("Dashboard",d,g,a.AnalyticsTraceLevel.Info,f)},Object.defineProperty(b.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),b.prototype.getName=function(){return this._name},b.prototype.setIntName=function(a){this._name=a},b.toErrStr=function(a){return a&&a.storageErrorTypeMessage||JSON.stringify(a)},Object.defineProperty(b.prototype,"description",{get:function(){return this._description},enumerable:!0,configurable:!0}),b.prototype.getDescription=function(){return this._description},b.prototype.setIntDescription=function(a){this._description=a},b.prototype.setVersionedStorage=function(a){var b=this;!this.versionedStorage&&a&&(this.versionedStorage=a,this.versionedStorageUnsub=this.versionedStorage.changed.add(function(a,c){b.versionedStorageChanged.raise(b,c)}))},b.prototype.getVersionedStorage=function(){var a=this;return this.versionedStorage?Q.when(null):this.dashService.versionManager.open(this.id).then(function(b){a.setVersionedStorage(b.storage)},function(b){throw a.logger.logExc(b,"in getVersionedStorage"),new Error("Error opening dashboard '"+a.getName()+"', caused by: "+b.message)})},b.prototype.updateMeta=function(b){var c=this,d=function(){return{displayName:c._name,description:c._description,userData:c._userData,version:c._version}};if(b.displayName){var e=this.storageService.validateName(b.displayName);if(e)return this.notifService.showError(a.shell.Strings.Err_Dashboard_InvalidName,e),Q.when({result:d()})}if(b.description){var e=this.storageService.validateDescriptor(b.description);if(e)return this.notifService.showError(a.shell.Strings.Err_Dashboard_InvalidDesc,e),Q.when({result:d()})}if(b.userData&&b.userData.tags){b.userData.tags=b.userData.tags.map(function(a){return a.trim()}).filter(function(a){return!!a});for(var f=/^[A-Za-z0-9 ]+$/,g=[],h=0;h<b.userData.tags.length;h++)f.test(b.userData.tags[h])||g.push(b.userData.tags[h]);if(g.length){var i=a.stringFormat(a.shell.Strings.Err_Home_InvalidTag,{err:g.join(", ")});return Q.when({result:d(),error:new Error(i)})}}var j=function(b,c){return!b&&!c||!(!b||!c)&&((!c.widgetType||c.widgetType===b.widgetType)&&!(c.tags&&!a.equals(c.tags,b.tags||[])))};return this.taskQueue.enqueue(function(){return b.displayName&&c._name===b.displayName&&(b.displayName=null),"string"==typeof b.description&&c._description===b.description&&(b.description=null),b.userData&&j(c._userData,b.userData)&&(b.userData=null),b.displayName||"string"==typeof b.description||b.userData?c._updateMeta(b).then(function(){return{result:d()}},function(a){return{result:d(),error:a}}):Q.when({result:d()})})},b.prototype.getState=function(b,c){var d=this;return this.readOnlyContent?Q.when(JSON.parse(this.readOnlyContent)):this.taskQueue.enqueue(function(){return d.getVersionedStorage().then(function(){var e=Q.when(null);return b&&(e=d.versionedStorage.update()),c&&(e=e.then(function(){return d.storageService.loadTree(d.versionedStorage.id,a.NodeRetrieveMode.NodeOnly,null,"ds.getState").then(function(a){d.updateMd(a.storages[0])})})),e.then(function(){return d.versionedStorage.read()})})})},b.prototype.shouldSetState=function(a){var b=this;return this.readOnlyContent?Q.when(!1):this.getVersionedStorage().then(function(){return b.versionedStorage.shouldWrite(a)})},b.prototype.setState=function(b,d){var e=this;if(this.readOnlyContent){var f=new Error(a.shell.Strings.Err_Dashboard_ReadOnly);return f.storageErrorType=a.StorageErrorTypes.USER_NOT_AUTHORIZED,Q.when({result:!1,error:f})}return this.taskQueue.enqueue(function(){return e.getVersionedStorage().then(function(){return e.versionedStorage.write(b||{},new c.ComponentExtractorProvider)}).then(function(a){e.coalesce();var b=d?e._updateMeta({userData:d}):Q.when(null);return b.then(function(){return{result:!0,notSaved:!a}})},function(a){return{result:!1,error:a}})})},b.prototype.delete=function(){var a=this,b=this.checkReadOnly();return b?b:this.isLink?this.storageService.delete(this.id,this._version,"ds.delete").then(function(){a.traceAnalytics("Delete",null)}):(this.disposeVerStorage(),this.dashService.versionManager.delete(this.id).then(function(){a.traceAnalytics("Delete",null)}))},b.prototype.move=function(a){var c=this;return this.parentMetaId===a?Q.when({}):this.checkReadOnly()||this.taskQueue.enqueue(function(){return c.isLink?c.storageService.update(c.id,c._version,{parentId:a},null,"ds.move").then(function(a){return c.updateMd(a.affectedStoreMetadata),{version:a.affectedStoreMetadata.version}},function(a){return{error:b.toErrStr(a)}}).then(function(b){return c.traceAnalytics("Move","Folder:"+a),b}):c.getVersionedStorage().then(function(){return c.versionedStorage.move(a)}).then(function(a){return c.updateMd(a),{version:a.version}},function(a){return{error:b.toErrStr(a)}}).then(function(b){return c.traceAnalytics("Move","Folder:"+a),b})})},b.setDashSourceInState=function(a,c){a.properties||(a.properties={}),a.properties[b.SOURCE_DASH_MD]={lastUuid:c.uuid,lastVersion:c._version}},b.prototype.clone=function(c){var d=this;if(c.source&&f(c.source.id)&&c.source._version>0&&c.source.uuid&&b.setDashSourceInState(c.state,c.source),c.targetPath||(c.targetPath={path:null}),!c.targetPath.path){var e=this._name,h=RegExp(a.shell.Strings.Text_Suffix_CopyOf+" \\([0-9]+\\)\\s*$"),i=RegExp(a.shell.Strings.Text_Suffix_CopyOf+"\\s*$");this._name.match(h)||this._name.match(i)||(e+=a.shell.Strings.Text_Suffix_CopyOf),c.targetPath.path=[e]}var j=g(c.targetPath),k=j.path.splice(j.path.length-1,1)[0];return this.dashService.creationQueue.enqueue(function(){return d.dashService.getValidName(k,d.storeType,j).then(function(b){return d.logger.low("clone",{name:b.name,parent:b.parentId,source:c.source&&c.source.id}),d.hasHistory?d.getVersionedStorage().then(function(a){return d.versionedStorage.clone(b.name,b.parentId,c.state,!0)}).then(function(a){return d.dashService.getSerializableDashboard(a)}):d.storageService.create({displayName:b.name,parentId:b.parentId,isTreeNode:!1,storeType:d.storeType,description:d.getDescription(),userData:d.dashService.buildUserData(d._userData)},{contentType:a.ContentType.Json,content:c.state},"ds.clone").then(function(a){return d.dashService.getSerializableDashboard(a.affectedStoreMetadata.id)})})})},Object.defineProperty(b.prototype,"hasHistory",{get:function(){return!this.readOnlyContent},enumerable:!0,configurable:!0}),b.prototype.getHistory=function(){var a=this;return this.hasHistory?this.getVersionedStorage().then(function(){return a.versionedStorage.getHistory()}):Q.when({metadata:[]})},b.prototype.updateHistoryComments=function(a,b){var c=this;return this.hasHistory?this.getVersionedStorage().then(function(){return c.versionedStorage.updateHistoryComments(a,b)}):Q.when(null)},Object.defineProperty(b.prototype,"changed",{get:function(){return this.versionedStorageChanged},enumerable:!0,configurable:!0}),b.prototype.coalesce=function(){var d=this;if(!this.hasHistory)return Q.when(null);var e=a.localization.moment();if(this.lastCoalesceTime&&e.diff(this.lastCoalesceTime,"seconds")<b.COALESCE_CHECK_PERIOD||this.coalesceInProgress)return Q.when(null);this.logger.low("CoalescingHistory_Check"),this.coalesceInProgress=!0;var f=[{age:a.localization.moment.duration(1,"days").asSeconds(),distance:a.localization.moment.duration(2,"minutes").asSeconds()},{age:a.localization.moment.duration(1,"weeks").asSeconds(),distance:a.localization.moment.duration(1,"hours").asSeconds()},{age:a.localization.moment.duration(1,"months").asSeconds(),distance:a.localization.moment.duration(1,"days").asSeconds()},{age:a.localization.moment.duration(2,"months").asSeconds(),distance:a.localization.moment.duration(1,"weeks").asSeconds()}];return this.getVersionedStorage().then(function(){return d.versionedStorage.checkForHistoryCoalescing(f)}).then(function(a){if(a.removeCount>0)return d.logger.low("CoalescingHistory_Applying",{removeCount:a.removeCount}),d.versionedStorage.coalesceHistory(a,new c.ComponentExtractorProvider).then(function(){d.lastCoalesceTime=e},function(a){d.dashService.excHelper.log(a,d.logger,"coalesce_err")})}).finally(function(){d.coalesceInProgress=!1})},b.prototype.updateMd=function(a){this.isShared=a.contentProperties.shared,this._version=a.version,this._name=a.contentProperties.displayName,this._description=a.contentProperties.description,this._userData=this.dashService.extractUserData(a.contentProperties.userData),this.owner=a.contentProperties.ownerUsername,this.isReadOnly=!a.contentProperties.canReadWrite||this.dashService.lockDashboards,this.parentMetaId=a.contentProperties.parentId,this.storeType=a.contentProperties.storeType},Object.defineProperty(b.prototype,"widgetId",{get:function(){return this._userData&&this._userData.widgetType},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"tags",{get:function(){return this._userData&&this._userData.tags},enumerable:!0,configurable:!0}),b.SOURCE_DASH_MD="_sourceDashMd",b.COALESCE_CHECK_PERIOD=14400,b.clonedCount=0,b.dashboardMappingLogged={},b}();c.SerializableDashboard=i;var j="0:",k=function(){function k(b,c,d,e,f,g,h){this.storageService=b,this.excHelper=c,this.notificationService=d,this.versionManager=e,this.loggerFactory=f,this.metadataService=g,this.configService=h,this.creationQueue=new a.TaskQueue,this.workspaceLoaded=!1,this.logger=f.create("DashStorageSvc"),this.clearDashboardDefs()}return k.prototype.startup=function(a){var b=this;return Q.all([this.metadataService.getWidgetSpace(),this.metadataService.getDashboardSpace()]).then(function(c){b.widgetMdSpace=c[0],b.dashboardMdSpace=c[1],a&&Object.getOwnPropertyNames(a.categories).forEach(function(c){a.categories[c].components.forEach(function(a){!a.isHidden&&a.isFavorite&&b.setDefaultComponentFavorite(a)})})})},Object.defineProperty(k.prototype,"lockDashboards",{get:function(){return this.configService.config.shell.lockedWorkspace},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"canCreateDashboard",{get:function(){return!this.configService.config.shell.lockedWorkspace},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"supportsUuid",{get:function(){return this.storageService.supportsUuid},enumerable:!0,configurable:!0}),k.prototype.intDashboardContent=function(a){return this.configService.config.shell.intDashboardsContent&&this.configService.config.shell.intDashboardsContent[a]},k.prototype.getSerializableDashboard=function(b,c,g){var h=this;if("string"==typeof b&&d(b)){var j=this.appDashboards[b];return j?Q.when(i.fromDashboardAppData(this,j,c,g)):Q.when(null)}if("string"==typeof b&&e(b)&&this.intDashboardContent(b))return Q.when(i.fromDashboardAppData(this,this.intDashboardContent(b),c,g));if("string"==typeof b&&!f(b))return Q.reject(new Error("Invalid dashboard ID: "+b));var l="string"==typeof b?b:b.md.id,m=this.storageService.loadAncestors(l,"ds.getDash").then(function(a){return a.storages.map(function(a){return{md:a}})}),n="string"==typeof b?this.storageService.loadTree(b,a.NodeRetrieveMode.NodeOnly,null,"ds.getDash").then(function(a){return a.storages.map(function(a){return{md:a}})}):Q.when([b]);return this.supportsUuid.then(function(b){return Q.all([m,n]).then(function(d){var e=!1,f=a.firstOrDefault(d[0],function(a){return a.md.contentProperties.storeType===h.storageService.systemUserHomeType});f&&(e=!!a.firstOrDefault(d[0],function(a){return a.md.contentProperties.parentId===f.md.id&&a.md.contentProperties.displayName===k.DashboardRootFolderName}));var i=a.selectMany(d,function(a){return a}),j=h.parseStorages(i,e);return h.processLinks(b,j,!1),j&&1===j.length?c?h.makeReadonlyClone(j[0],g):j[0]:null},function(){return null})})},k.prototype.makeReadonlyClone=function(a,b){var c=this;return a.getState(!1,!1).then(function(d){return i.fromClonedData(c,a,d,b)})},k.prototype.fetchRoots=function(){var a=this,b={};return this.storageService.listRoots("ds.fetchRoots").then(function(c){var d=c.storages.filter(function(b){return b.contentProperties.storeType===a.storageService.systemUserHomeType})[0];return Q.all(c.storages.map(function(c){var e=c.id===d.id;return a.storageService.loadByPath(c.id,"/"+k.DashboardRootFolderName+"/","ds.fetchRoots").then(function(c){a.lockDashboards&&c.storages[0]&&(c.storages[0].contentProperties.canReadWrite=!1),e?b.privateDashboardRootFolder=c.storages[0]:b.sharedDashboardRootFolder=c.storages[0]},function(a){})}))}).then(function(){return b})},k.prototype.fetch=function(b,c){var d=this;c=c||[k.DashboardFileType,k.WidgetFileType],c.push(k.LinkFileType);var e=this.storageService.loadTreesByPath("/"+k.DashboardRootFolderName+"/",a.NodeRetrieveMode.Recursive,c,"ds.fecth");return this.supportsUuid.then(function(a){return e.then(function(c){var e,f,g,h,i=[];return c.forEach(function(a){d.lockDashboards&&a.storages.forEach(function(a){return a.contentProperties.canReadWrite=!1});var b=d.parseFolders(a.storages),c=b[0];if(c){b.splice(0,1);var j=!c.contentProperties.shared;j?(h=b,e=c):(g=b,f=c),i=i.concat(d.parseStorages(a.storages.map(function(a){return{md:a}}),j))}}),d.processLinks(a,i,b),{dashboards:i,privateFolders:h,sharedFolders:g,privateDashboardRootFolder:e,sharedDashboardRootFolder:f}})})},k.prototype.fetchStorage=function(a,b){return this.parseStorages([{md:a}],b)[0]},k.prototype.parseFolders=function(a){var b=this,c=a.filter(function(a){return a.contentProperties.isTreeNode}),d=c.reduce(function(a,b){return a[b.id]=b,a},{}),e=function(a){if(b.versionManager.isHistoryFolder(a))return!0;var c=d[a.contentProperties.parentId];return c&&e(c)};c=c.filter(function(a){return!e(a)});var f=function(a){var b=-1;do b++,a=d[a.contentProperties.parentId];while(a);return b};return c.sort(function(a,b){return f(a)-f(b)})},k.prototype.parseStorages=function(b,c){var d=this,e={};return b.forEach(function(a){e[a.md.id]=a}),b.map(function(a){return{storage:a,path:d.computePath(a,e)}}).filter(function(a){return!a.storage.md.contentProperties.isTreeNode}).map(function(b){var e=c?a.shell.Strings.Text_Dashboard_Private_Section:b.path.join(" / ");return i.fromStorage(d,b.storage,e,!c,b.path)})},k.prototype.computePath=function(a,b){var c=a.md.contentProperties.parentId,d=c?b[c]&&b[c].md:null;if(!d)return[];if(!d.contentProperties.displayName)return[];if(this.isRootFolder(d))return[];if(d.contentProperties.displayName===k.DashboardRootFolderName){var d=d.contentProperties.parentId?b[d.contentProperties.parentId]&&b[d.contentProperties.parentId].md:null;if(!d||this.isRootFolder(d))return[]}var e=this.computePath({md:d},b);return e.push(d.contentProperties.displayName),e},k.prototype.isRootFolder=function(a){return a.contentProperties.storeType===this.storageService.systemSharedHomeType||a.contentProperties.storeType===this.storageService.systemUserHomeType},k.prototype.getValidName=function(b,c,d){return this.fetch(!1,[c]).then(function(c){function e(b){function d(d,e){var f=b.shared?c.sharedFolders:c.privateFolders,g=f&&a.firstOrDefault(f,function(a){return a.contentProperties.displayName===d&&a.contentProperties.parentId===e});if(g)return g.id;var h=a.firstOrDefault(c.dashboards,function(a){return a.name===d&&a.parentMetaId===e});return h&&h.id}var e=b.shared?c.sharedDashboardRootFolder&&c.sharedDashboardRootFolder.id:c.privateDashboardRootFolder&&c.privateDashboardRootFolder.id;return b.path.forEach(function(a){e=e&&d(a,e)}),e}var f;return f="string"==typeof d?d:d?e(d):c.privateDashboardRootFolder.id,{parentId:f,name:a.getUniqueName(b,c.dashboards.filter(function(a){return a.parentMetaId===f}).map(function(a){return a.getName()}))}})},k.prototype.overwriteInteractive=function(b,c,d,e,f,g){var h=this;return this.fetch(!1,[c]).then(function(i){b=b||i.privateDashboardRootFolder.id;var j=a.firstOrDefault(i.dashboards,function(a){return a.parentMetaId===b&&a.getName()===d});if(j){var k=a.getUniqueName(d,i.dashboards.map(function(a){return a.getName()})),l=a.stringFormat(a.shell.Strings.Text_Dashboard_WidgetConfirmOverwrite_Text,{name:d,altName:k}),m=[a.shell.Strings.Text_Dashboard_WidgetConfirmOverwrite_OverwriteBtn,a.shell.Strings.Text_Dashboard_WidgetConfirmOverwrite_UseDiffNameBtn,a.shell.Strings.Text_Dashboard_WidgetConfirmOverwrite_Cancel];return h.showOptionDialog(l,m,a.shell.Strings.Text_Dashboard_WidgetConfirmOverwrite_Title).then(function(a){switch(a){case 0:return j.setState(e,g).then(function(a){if(a.error)throw a.error;return j});case 1:return h._create(b,c,k,e,f,g).then(function(a){return a.dashboard});default:return null}})}return h._create(b,c,d,e,f,g).then(function(a){return a.dashboard})})},k.prototype._create=function(a,b,c,d,e,f){var g=this,h=b;return this.versionManager.create(a,c,h,d,e,this.buildUserData(f)).then(function(a){return g.getSerializableDashboard(a).then(function(b){return{dashboard:b,md:a.md}})})},k.prototype.create=function(a,b,c,d,e,f){var g=this;return this.creationQueue.enqueue(function(){return g.getValidName(c,b,a).then(function(a){return g._create(a.parentId,b,a.name,d,e,f)})})},k.prototype.createSharedFolder=function(a){var b=this;return this.fetchRoots().then(function(c){if(!c.sharedDashboardRootFolder)throw new Error("Cannot access the shared storage root");return b.storageService.createNode({displayName:a,parentId:c.sharedDashboardRootFolder.id},"ds.createFold")}).then(function(a){return a.affectedStoreMetadata.id})},k.prototype.renameSharedFolder=function(b,c){var d=this;return this.storageService.loadTree(b,a.NodeRetrieveMode.NodeOnly,null,"ds.renFold").then(function(a){return d.storageService.updateNode(b,a.storages[0].version,{displayName:c},"ds.renFold")})},k.prototype.deleteSharedFolder=function(b){var c=this;return this.storageService.loadTree(b,a.NodeRetrieveMode.NodeAndChildren,null,"ds.delFold").then(function(a){return c.storageService.deleteNode(b,a.storages[0].version,!0,"ds.delFold")})},k.prototype.updateLastAccessTime=function(a,b,c){var d=c?this.dashboardMdSpace:this.widgetMdSpace;d&&d.setValue(a,k.LAST_USED_TAG,b.format())},k.prototype.getLastAccessTimesBySpace=function(b,c){var d=c?this.dashboardMdSpace:this.widgetMdSpace;return d&&b.map(function(b){var c=d.getValue(b,k.LAST_USED_TAG);return c&&a.localization.moment(c)})},k.prototype.setFavorite=function(a,b,c){var d=a?this.dashboardMdSpace:this.widgetMdSpace;d&&d.setValue(b,k.FAVORITE_TAG,c)},k.prototype.isFavorite=function(a,b){var c=a?this.dashboardMdSpace:this.widgetMdSpace;return!c||!!c.getValue(b,k.FAVORITE_TAG)},k.prototype.isComponentFavorite=function(b){var c=a.home.HomeService.EMPTY_COMP_PREFIX+b.id;return this.isFavorite(!1,c)},k.prototype.setDefaultComponentFavorite=function(b){var c=a.home.HomeService.EMPTY_COMP_PREFIX+b.id;null===this.widgetMdSpace.getValue(c,k.FAVORITE_TAG,null)&&this.widgetMdSpace.setValue(c,k.FAVORITE_TAG,!0)},k.prototype.processLinks=function(b,c,d){var e=this,f=a.spliceAll(c,function(a){return a.storeType===k.LinkFileType});if(f.length>0){var g=c.reduce(function(a,b){return a[b.id]=b,a},{}),h={};b&&(h=c.reduce(function(a,b){return a[b.uuid]=b,a},{})),f.forEach(function(a){var b=a.getName(),f=g[b]||h[b],j=f&&f.parentMetaId!==a.parentMetaId&&i.linkFrom(f,a.id,a.uuid,a.getVersion(),a.parentMetaId,a);j?c.push(j):d&&e.storageService.delete(a.id,a.getVersion(),"ds.procLink").then(function(){},function(a){}).done()})}},k.prototype.createLink=function(c,d){var e=this;return this.supportsUuid.then(function(f){var g=f&&c.uuid?c.uuid:c.id;return e.storageService.create({displayName:g,storeType:b.DashboardStorageService.LinkFileType,parentId:d},{contentType:a.ContentType.Null},"ds.createLink").then(function(a){return i.linkFrom(c,a.affectedStoreMetadata.id,a.affectedStoreMetadata.contentProperties.uuid,a.affectedStoreMetadata.version,d)})})},k.prototype.findDashboardsByPath=function(b){var c=this;if(a.all(b,function(a){return!a})){for(var d=[],e=0;e<b.length;e++)d.push(null);return Q.when(d)}return this.fetch().then(function(d){return b.map(function(b){function e(b,c,d){return b&&a.equals(b.concat([c]),h)&&!d==!j}if(!b)return null;var f=g(b),h=f.path,j=f.shared,k=a.firstOrDefault(d.dashboards,function(a){return e(a.path&&a.path.path,a.getName(),a.isShared)});if(k&&k.isLink&&(k=k.linkTo),!k){var l=c.getAppDashboards(),m=a.firstOrDefault(l,function(a){return e(c.toDashboardInfo(a).itemPath.path,a.displayName,!0)});m&&(k=i.fromDashboardAppData(c,m))}return k})})},k.prototype.getAppDashboards=function(){var a=this;return Object.getOwnPropertyNames(this.appDashboards).map(function(b){return a.appDashboards[b]}).filter(function(a){return!a.isInternal})},k.prototype.toDashboardInfo=function(a){return{id:a.id,name:a.displayName,description:a.description,tags:a.tags,itemPath:{path:a.categoryPath||[a.category||"Samples"],shared:!0},isAppDefined:!0}},k.prototype.getEmbeddedDashboardSelector=function(){return i.fromDashboardAppData(this,this.appDashboards[k.EMBEDDED_SELECTOR_DASH_ID],!1,!0)},k.prototype.clearDashboardDefs=function(){this.appDashboardsPerModule={},this.appDashboards={},this.appDashId=0,this.appDashboards[k.EMBEDDED_SELECTOR_DASH_ID]={displayName:a.shell.Strings.Text_Prefix_New_Dashboard,id:k.EMBEDDED_SELECTOR_DASH_ID,isInternal:!0,moduleName:this.configService.appName}},k.prototype.registerDashboardDef=function(a,b,d){var e=c.APP_DASH_PREFIX+a+"_"+this.appDashId++;return d.id=e,d.moduleName=b||this.configService.appName,this.appDashboards[e]=d,this.appDashboardsPerModule[a]||(this.appDashboardsPerModule[a]=[]),this.appDashboardsPerModule[a].push(d),e},k.prototype.hasController=function(a){return d(a)&&this.appDashboards[a]&&!!this.appDashboards[a].controllerFunction},k.prototype.checkDefaultDashboards=function(b,c){var d=this,e=[],f=0===b.length;if(f){var g=Object.getOwnPropertyNames(this.appDashboardsPerModule);g.sort(),g.forEach(function(a){e=e.concat(d.appDashboardsPerModule[a].filter(function(a){return a.isDefault}).map(function(a){return i.fromDashboardAppData(d,a)}))}),this.logger.low("LoadDefaults",e.map(function(a){return a.id}))}var h=c.defaultDashboards,j=!1,k=function(b){var c;return"string"==typeof b||Array.isArray(b)?c={path:b,shared:!0}:(c=a.clone(b),c.shared=!c.private),j&&(c.forced=!0),c};if(c.loadWorkspace&&(c.workspaces&&c.workspaces[c.loadWorkspace]&&Array.isArray(c.workspaces[c.loadWorkspace])?(h=c.workspaces[c.loadWorkspace],j=!0,this.workspaceLoaded=!0):this.logger.low("ConfigError",{error:"Missing workspace definition",workspace:c.loadWorkspace})),Array.isArray(h)){this.logger.low("LoadConfigDefaults",{defaultDashboards:h,workspace:c.loadWorkspace});var l=h.map(function(a){return k(a)});return this.findDashboardsByPath(l).then(function(b){var c=null,g=b.map(function(a,b){return{serDash:a,def:l[b],toClonePath:!a&&l[b].sourcePath&&k(l[b].sourcePath)}});return d.findDashboardsByPath(g.map(function(a){return a.toClonePath})).then(function(a){return a.forEach(function(a,b){a&&(g[b].toClone=a)}),g}).then(function(a){var b=[];return a.forEach(function(a){a.toClone&&(d.logger.low("CloneSource",{targetPath:a.def,sourcePath:a.def.sourcePath}),b.push(d.cloneDashboard(a.toClone,{targetPath:k(a.def),trackSource:!0}).then(function(b){a.serDash=b,a.forceEdit=!0})))}),Q.all(b).then(function(){return a})}).then(function(b){b=b.filter(function(a){return!!a.serDash});var g=b.filter(function(a){return a.def.sourcePath&&a.serDash});g.length>0&&d.logger.low("ToCheckLink",{checkForUpdate:g.map(function(a){return a.serDash.id})});var h=b.filter(function(a){return a.def.forced});h.length>0?e=h.map(function(a){var b=a.serDash;return b.checkForUpdate=!!a.def.sourcePath,b.forceEdit=a.forceEdit,b}):f&&(e=e.concat(b.map(function(a){var b=a.serDash;return b.checkForUpdate=!!a.def.sourcePath,b.forceEdit=a.forceEdit,b})));var i=a.firstOrDefault(b,function(a){return a.def.active});return c=i&&i.serDash,e=a.dedupe(e,function(a){return a.id}),{dashboards:e,active:c}})})}return Q.when({dashboards:e})},k.prototype.buildUserData=function(a){if(!a)return null;var b={wt:a.widgetType,tag:a.tags&&a.tags.join("~")};return j+Object.getOwnPropertyNames(b).filter(function(a){return b[a]}).map(function(a){return a+"="+encodeURIComponent(b[a])}).join("&")},k.prototype.extractUserData=function(a){if(!a)return{};if(0!==a.indexOf(j))return{};var b=a.substr(j.length).split("&"),c=b.reduce(function(a,b){var c=b.split("=");return 2===c.length&&(a[c[0]]=decodeURIComponent(c[1])),a},{});return{widgetType:c.wt,tags:c.tag&&c.tag.split("~")}},k.prototype.fetchDashboards=function(){var b=this;return this.fetch(!1,[k.DashboardFileType]).then(function(c){return c.dashboards.map(function(a){return{id:a.id,name:a.name,description:a.description,tags:a.tags,itemPath:a.path&&{path:a.path.path,shared:a.path.root===h.Shared},isLink:a.isLink}}).concat(b.getAppDashboards().filter(function(b){return"undefined"==typeof b.type||b.type===a.DashboardDefinitionType.Dashboard}).map(function(a){return b.toDashboardInfo(a)}))})},k.prototype.cloneDashboard=function(a,b){return a.getState(!0,!1).then(function(c){return a.clone({state:c,targetPath:b&&b.targetPath,source:b&&b.trackSource&&a})})},k.DashboardRootFolderName="IONWEB_DASHBOARDS",k.DashboardFileType="Dashboard",k.WidgetFileType="Widget",k.WorkspaceFileType="DashboardSet",k.LinkFileType="Link",k.LAST_USED_TAG="$lastused",k.FAVORITE_TAG="$favorite",k.EMBEDDED_SELECTOR_DASH_ID=c.INTERNAL_DASH_PREFIX+"selector",k}();c.DashboardStorageService=k,a.module("ionwebShell").service("dashboardStorageService",["ionweb.storageService","ionweb.excHelper","ionweb.notificationService","ionweb.versionedStorageService","ionweb.loggerFactory","ionweb.metadataService","ionweb.configurationService"],function(a,b,c,d,e,f,g){return new k(a,b,c,d,e,f,g)})}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c="$dash.userStates",d=72,e=function(){function b(a,b,c){var d=this;this.logger=a,this.owner=b,this.prefService=c,this.data={},this.prefService.isLoaded?this.restoreUserState():this.prefService.loadedPromise.then(function(){return d.restoreUserState()}).done()}return b.prototype.restoreUserState=function(){var b=a.LazySerializable.unbox(this.prefService.getValue(c));this.setState(this.owner,b)},b.prototype.saveAll=function(){var b=this;this.prefService.setValue(c,new a.LazySerializable(function(){return b.data}))},b.prototype.getData=function(a){var b=this.calcPath(a),c=this.findNode(b,!0);return c&&!c.data&&(c.data={}),c.data},b.prototype.getDataOrNull=function(a){var b=this.calcPath(a),c=this.findNode(b,!1);return c&&c.data},b.prototype.calcPath=function(a){if(Array.isArray(a))return a;for(var b=[];this.owner!==a;)if(b.unshift(a.id),a=a.parent,!a)return null;return b},b.prototype.findNode=function(a,b){if(a){for(var c=this.data;a.length>0;){if(!c.children){if(!b)return null;c.children={}}var d=a.shift(),e=c.children[d];if(!e){if(!b)return null;e=c.children[d]={}}c=e}return c}},b.prototype.create=function(a){var b=this,c=new f(a,this);return c.subscribeChanges(null,function(){return b.saveAll()}),c},b.prototype.changeId=function(b,c,d){var e=this.calcPath(b);if(e&&e.length>0){var f=e.pop(),g=this.findNode(e,!1);g&&g.children&&g.children[c]&&(g.children[f]=a.extendChildren({},[g.children[c]]),d&&delete g.children[c],this.saveAll())}},b.prototype.getState=function(b){var c=this.findNode(this.calcPath(b),!1);return c&&a.extendChildren({},[c])},b.prototype.setState=function(b,c){if("object"==typeof c&&!Array.isArray(c)){var d=this.findNode(this.calcPath(b),!0);delete d.children,delete d.data,a.extendChildren(d,[c])}},b.prototype.userDataGc=function(a,b,c){var e=this,f=!1;this.data.children&&Object.getOwnPropertyNames(this.data.children).forEach(function(g){var h=e.data.children[g];if(a[g])h.lingerTs=void 0,f=!0;else if(h.lingerTs){var i=b(c).diff(b(h.lingerTs),"hours");i>=d&&(e.logger.low("CollectUserDashData",{dashId:g,elapsedH:i}),delete e.data.children[g],f=!0)}else h.lingerTs=c.toISOString(),f=!0}),f&&this.saveAll()},b.prototype.removeCompUserData=function(a,b){var c=this.data.children&&this.data.children[a];c&&c.children&&c.children[b]&&(delete c.children[b],this.saveAll())},b}(),f=function(){function b(b,c){this.comp=b,this.tree=c,this.eventSubscribers=new a.preferences.KeySubscriptions}return b.prototype.getValue=function(a,b){var c=this.tree.getDataOrNull(this.comp);return c&&c.hasOwnProperty(a)?c[a]:b},b.prototype.setValue=function(a,b){if("undefined"==typeof b||null===b)this.deleteKey(a);else{var c=this.tree.getData(this.comp);c[a]=b,this.eventSubscribers.raise(a,this,{key:a,value:b})}},b.prototype.deleteKey=function(a){var b=this.tree.getDataOrNull(this.comp);b&&delete b[a],this.eventSubscribers.raise(a,this,{key:a,deleted:!0})},b.prototype.subscribeChanges=function(a,b){return this.eventSubscribers.subscribe(a,b)},b}(),g=function(b){function c(a,c,d){var f=b.call(this,"DashboardRootId",null,a)||this;return f.prefService=c,f.dashboardService=d,f.scenarioComponents={},f.inDirectMode=d.inSingleDashboardMode,f.logger.low("created",{inDirectMode:f.inDirectMode}),f.editMode=!1,f._userDataProvider=new e(f.logger,f,f.prefService),f}return __extends(c,b),c.prototype.getState=function(){return b.prototype.getState.call(this,!this.inDirectMode&&this.scenarioComponents)},c.prototype.setState=function(c){c&&a.RootComponentState.version===c.version&&(this.inDirectMode||(this.scenarioComponents=c.components,c.components={}),b.prototype.setState.call(this,c))},c.prototype.onDirtySet=function(a){b.prototype.onDirtySet.call(this,a),a&&(this.prefService.dirty=!0)},c.prototype.checkDirty=function(){return this.dashboardService.isAnyDirty()},Object.defineProperty(c.prototype,"userDataProvider",{get:function(){return this._userDataProvider},enumerable:!0,configurable:!0}),c.prototype.importDashboardUserPrefs=function(a,b){this._userDataProvider.setState([a],b)},c.prototype.userDataGc=function(a,b,c){this._userDataProvider.userDataGc(a,b,c)},c.prototype.removeCompUserData=function(a,b){this._userDataProvider.removeCompUserData(a,b)},c}(a.Component);b.DashboardRootComponent=g}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(){this._components={}}return b.prototype.clear=function(a,b,c){a(),this.inSetState=!0;try{this._components={},b()}finally{c(),this.inSetState=!1}},b.prototype.setState=function(a,b,c,d){var e=this;if(b(),a&&a.components){this.inSetState=!0;try{Object.getOwnPropertyNames(a.components).forEach(function(b){var d=a.components[b];e.addComponent(b,d),c(b,d)})}finally{this.inSetState=!1}}d()},b.prototype.getComponent=function(a){return this._components[a]},b.prototype.addComponent=function(a,b){return this._components[a]=b},b.prototype.removeComponent=function(a){delete this._components[a]},b.prototype.cleanCompData=function(a){return a},b.prototype.getState=function(){var a=this,b=Object.getOwnPropertyNames(this._components).reduce(function(b,c){return b[c]=a.cleanCompData(a._components[c]),b},{});return{components:b}},b.prototype.getComponentData=function(){return a.toArray(this._components)},b}();b.DashboardComponent=c}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(c){function d(a,b,d,e,f){var g=c.call(this,"SingleRootId",null,b)||this;return g.locationProvider=a,g.catalog=d,g.prefService=e,g.viewNameToStateMap={},g.scenarioProperties={},g.isRestoringState=!1,g.logger.low("created"),g.editMode=!0,g.updateCurrentViewName(),f&&(f.$on("$routeChangeSuccess",function(){g.logger.high("location",{change:"success",path:g.locationProvider.getPath()}),g.restoreState()}),f.$on("$routeChangeStart",function(a,b,c){g.logger.high("location",{change:"start"}),g.preserveState(),"/"===b.originalPath&&c.originalPath&&"/"!==c.originalPath&&a.preventDefault()})),g}return __extends(d,c),Object.defineProperty(d.prototype,"isContainer",{get:function(){return!0},enumerable:!0,configurable:!0
}),Object.defineProperty(d.prototype,"lastVisitedPath",{get:function(){return this.scenarioProperties[a.RootComponentState.lastVisitedPathKey]},set:function(b){this.scenarioProperties[a.RootComponentState.lastVisitedPathKey]=b},enumerable:!0,configurable:!0}),d.prototype.onDirtySet=function(a){c.prototype.onDirtySet.call(this,a),this.prefService&&!this.isRestoringState&&a&&(this.prefService.dirty=!0)},d.prototype.preserveState=function(){var b=this,c=Object.keys(this.childComponents).map(function(a){return{childKey:a,childState:b.childComponents[a].getState()}}).reduce(function(a,b){return b.childState&&(a[b.childKey]=b.childState),a},{});0===Object.getOwnPropertyNames(c).length&&(c=void 0);var d=a.clone(this.properties);d&&0===Object.getOwnPropertyNames(d).length&&(d=void 0),this.logger.high("RootComponent",{action:"saveState",path:this.currentViewName}),this.viewNameToStateMap[this.currentViewName]={components:c,properties:d,version:a.RootComponentState.version}},d.prototype.updateCurrentViewName=function(){this.currentViewName=this.locationProvider.getPath().replace("/","")},d.prototype.restoreState=function(){this.isRestoringState=!0;try{this.updateCurrentViewName();var b=a.clone(this.viewNameToStateMap[this.currentViewName]);this.childIdToState=b&&b.components,this.properties=b&&b.properties,this.childIdToState&&"object"==typeof this.childIdToState||(this.childIdToState={}),this.properties&&"object"==typeof this.properties||(this.properties={}),this.lastVisitedPath=this.currentViewName,this.dirty=!0}finally{this.isRestoringState=!1}},d.prototype.pruneOrphanStates=function(){var a=this;this.catalog&&Object.keys(this.viewNameToStateMap).forEach(function(b){a.catalog.isComponentIdValid(b)||delete a.viewNameToStateMap[b]})},d.prototype.getState=function(){return this.preserveState(),this.pruneOrphanStates(),{properties:this.scenarioProperties,components:this.viewNameToStateMap,version:a.RootComponentState.version}},d.prototype.setState=function(b){c.prototype.setState.call(this,b),b&&a.RootComponentState.version===b.version?(this.viewNameToStateMap=b.components||{},this.scenarioProperties=b.properties||{}):(this.viewNameToStateMap={},this.scenarioProperties={})},d.prototype.checkDirty=function(){return{isDirty:this.prefService.dirty,reason:b.Strings.Msg_QuitWithoutSaving}},d}(a.Component);b.SingleRootComponent=c}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){function c(b){if(!b)return null;var c,d=function(a){return a.trim().toLocaleLowerCase().split(/[\s_\('"\[{#<]+/g)};return c="string"==typeof b?d(b):a.selectMany(b.filter(function(a){return a}),function(b){return"string"==typeof b?d(b):a.selectMany(b.map(function(a){return d(a)}),function(a){return a})}),Object.getOwnPropertyNames(c.filter(function(a){return a}).reduce(function(a,b){return a[b]=!0,a},{}))}function d(b,c){return!b||!!c&&a.all(b,function(b){return a.any(c,function(a){return 0===a.indexOf(b)})})}function e(a,c){return!(!c.showDashboards&&a.type===b.TreeNodeType.Dashboard)&&(!!(c.showWidgets||a.type!==b.TreeNodeType.DefaultWidget&&a.type!==b.TreeNodeType.StatefulWidget)&&(a.type!==b.TreeNodeType.Folder||!c.pruneEmptyFolders||!(!a.children||0===a.children.length)&&a.children.some(function(a){return e(a,c)})))}function f(a,b){return!!this.filterByNodeType(a,b)&&d(b.words,c([a.name,a.description,a.tags]))}b.tokenize=c,b.filterByNodeType=e,b.filterNode=f}(b=a.home||(a.home={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.Folder=0]="Folder",a[a.Dashboard=1]="Dashboard",a[a.DefaultWidget=2]="DefaultWidget",a[a.StatefulWidget=3]="StatefulWidget"}(b=a.TreeNodeType||(a.TreeNodeType={}))}(b=a.home||(a.home={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function a(a,b){this.model=a,this.eventToRaise=b||[]}return a.prototype.add=function(a){this.eventToRaise.indexOf(a)<0&&this.eventToRaise.push(a)},a.prototype.addWithLinks=function(a){var b=this;this.add(a),a.linkedTo&&this.add(a.linkedTo),a.linkedBy&&a.linkedBy.forEach(function(a){return b.add(a)})},a.prototype.raise=function(a){var b=this;a.$evalAsync(function(){b.eventToRaise.forEach(function(a){b.model.nodeChanged.raise(b,{node:a})})})},a}();b.BulkEvent=c;var d=function(){function c(c,d,e,f,g,h,i){this.service=c,this.$q=d,this.$rootScope=e,this.storageService=f,this.dashboardService=g,this.dashboardStorageService=h,this.currentUsername=i,this.nodeMap={},this.nodeChanged=new a.Event,this.allTagOptions=[],this.allTags={},this.private={key:void 0,name:a.shell.Strings.Text_Home_Folder_My_Workspace,type:b.TreeNodeType.Folder},this.favorites={key:void 0,name:a.shell.Strings.Text_Home_Folder_Favorites,type:b.TreeNodeType.Folder},this.lastUsed={key:void 0,name:a.shell.Strings.Text_Home_Folder_Last_Used,type:b.TreeNodeType.Folder},this.shared={key:void 0,name:a.shell.Strings.Text_Home_Folder_Shared,type:b.TreeNodeType.Folder},this.root={key:void 0,name:"Workspace",type:b.TreeNodeType.Folder,children:[this.private,this.favorites,this.lastUsed,this.shared]}}return c.prototype.updateRootMd=function(a,b){a.key&&delete this.nodeMap[a.key],a.key=b.id,a.storage={id:b.id,version:b.version},a.canWrite=!1,a.canWriteChildren=b.contentProperties.canReadWrite,this.nodeMap[a.key]=a},c.prototype.updateDashNode=function(a){var b=this,c=[a];a.linkedBy&&(c=c.concat(a.linkedBy));var d=a.serializableItem;c.forEach(function(a){a.name=d.getName(),a.description=d.getDescription(),a.canWrite=a.canWriteChildren=!d.isReadOnly,a.isShared=d.isShared,a.owner=d.owner,b.updateNodeProps(a)})},c.prototype.find=function(a){return this.nodeMap[a]},c.prototype.getMasterLinks=function(a){var b=this,c=[];return a.forEach(function(a){a.linkedTo&&c.push(a.linkedTo),a.children&&(c=c.concat(b.getMasterLinks(a.children)))}),c},c.prototype.getSlaveLinks=function(a){var b=this,c=[];return a.forEach(function(a){a.linkedBy&&(c=c.concat(a.linkedBy)),a.children&&(c=c.concat(b.getSlaveLinks(a.children)))}),c},c.prototype.canDelete=function(a){var b=this;return a.canDelete&&(a.children||[]).every(function(a){return b.canDelete(a)})},c.prototype.delete=function(a){return this.$q.when(this.service.delete(this,a))},c.prototype.removeNode=function(b,c){b.linkedTo&&a.spliceAll(b.linkedTo.linkedBy||[],function(a){return a===b});var d=b.parent;d&&d.children&&a.spliceAll(d.children,function(a){return a===b}),b.parent=null,delete this.nodeMap[b.key],d&&(c?c.addWithLinks(d):this.raiseNodeUpdated(d))},c.prototype.removeAndDelete=function(a,b){return this.removeNode(a,b),a.serializableItem&&a.serializableItem.delete()||Q.when(null)},c.prototype.rename=function(a,b){return this.service.updateMd(this,a,b)},c.prototype.validateNewName=function(a,b){var c=this.storageService.validateName(b);return c?{error:c}:{error:this.service.validateNewName(this,a,b)}},c.prototype.canRename=function(a){var b=a.linkedTo||a;return b.canWrite},c.prototype.editDesc=function(a,b){var c=this.storageService.validateDescriptor(b);return c?this.$q.reject(new Error(c)):this.service.updateMd(this,a,null,b)},c.prototype.updateTags=function(b,c){var d=this,e=b.tags||[];if(c=c||[],a.sequenceEquals(c,e))return{oldState:e,promise:Q.when(null)};var f=Q.defer(),g={promise:f.promise};return this.service.updateMd(this,b,null,null,c).then(function(){d.$rootScope.$evalAsync(function(){g.state=a.validation.ValidationState.Success,f.resolve(null),d.updateAllTags(c)})},function(b){d.$rootScope.$evalAsync(function(){g.state=a.validation.ValidationState.Error,g.message=b.message,f.reject(b.message),Object.defineProperty(g,"oldState",{get:function(){return e}})})}),g},c.prototype.move=function(a,b){return this.service.move(this,a,b)},c.prototype.canMove=function(a,c){return!(!a.canMove&&!a.isSample)&&((!c||!(a.parent&&a.parent.key===c.key||a.key===c.key))&&(!c||c.canWriteChildren&&c.storage&&c.type===b.TreeNodeType.Folder&&c.canWriteChildren))},c.prototype.unshare=function(a){return this.service.unshare(this,a)},c.prototype.canUnshare=function(a){return!this.checkUnshare(a).error},c.prototype.checkUnshare=function(b){var c=this;if(!b.canUnshare)return{error:"Item cannot be unshared"};for(;b.linkedTo;)b=b.linkedTo;if(this.getRoot(b)!==this.shared)return{error:"Item not under shared tree"};if(!b.serializableItem)return{error:"Storage item required"};var d=a.firstOrDefault((b.linkedBy||[]).filter(function(a){return c.getRoot(a)===c.private&&!!a.serializableItem})),e=d?d.parent:this.private;return e.canWriteChildren?{item:b,targetFolder:e}:{error:"Cannot move the storage back to the private space"}},c.prototype.createDashboard=function(a){return this.service.createDashboard(this,a)},c.prototype.canCreateDashboard=function(a){return a.type===b.TreeNodeType.Folder&&a.canWriteChildren&&!!a.storage},c.prototype.createFolder=function(a){return this.service.createFolder(this,a)},c.prototype.canCreateFolder=function(a){return a.type===b.TreeNodeType.Folder&&a.canWriteChildren&&!!a.storage},c.prototype.add=function(a,b,c){return a.children?a.children.push(b):a.children=[b],b.parent=a,c||(this.nodeMap[b.key]=b),this.updateAllTags(b.tags),b},c.prototype.createLink=function(b){function c(a,b,c){Object.defineProperty(b,c,{get:function(){return a[c]},set:function(b){return a[c]=b},enumerable:!0})}for(;b.linkedTo;)b=b.linkedTo;var d=a.clone(b);return b.linkedBy?b.linkedBy.push(d):b.linkedBy=[d],d.children=null,d.linkedBy=null,d.linkedTo=b,d.storage=null,d.serializableItem=null,d.owner=this.currentUsername,this.updateNodeProps(d),c(b,d,"isFavorite"),d},c.prototype.getOrCreate=function(c,d,e,f,g,h){c.children=c.children||[];var i=a.firstOrDefault(c.children,function(a){return a.key===d});return i||(i={key:d,name:e,description:g,type:b.TreeNodeType.Folder,storage:h,isSample:f},this.add(c,i)),i},c.prototype.createFolderNode=function(b,c,d,e){var f=c.contentProperties.displayName,g=a.stringFormat(d?a.shell.Strings.Text_Dashboard_Folder_Desc:a.shell.Strings.Text_Dashboard_FolderPrivate_Desc,{name:f,created:c.contentProperties.ownerUsername}),h={id:c.id,version:c.version},i=this.getOrCreate(b,c.id,f,!1,g,h);return this.updateStorageMd(i,c,e),i},c.prototype.reparentNoEvents=function(b,c){b.parent!==c&&(b.parent&&a.spliceAll(b.parent.children,function(a){return a===b}),c.children?c.children.push(b):c.children=[b],b.parent=c)},c.prototype.raiseNodeUpdated=function(a){var b=this;this.$rootScope.$evalAsync(function(){b.nodeChanged.raise(b,{node:a}),a.linkedTo&&b.nodeChanged.raise(b,{node:a.linkedTo}),a.linkedBy&&a.linkedBy.forEach(function(a){b.nodeChanged.raise(b,{node:a})})})},c.prototype.updateNodeProps=function(a){a.isOwner=a.owner===this.currentUsername,a.canUnshare=a.isShared&&a.isOwner,a.canDelete=(a.isOwner||!!a.linkedTo)&&a.canWrite,a.canMove=a.type!==b.TreeNodeType.Folder||!a.isShared||!a.canWrite},c.prototype.updateStorageMd=function(a,b,c){if(c.add(a),a.name=b.contentProperties.displayName,a.description=b.contentProperties.description,a.canWrite=a.canWriteChildren=b.contentProperties.canReadWrite,a.isShared=b.contentProperties.shared,a.owner=b.contentProperties.ownerUsername,this.updateNodeProps(a),a.parent&&a.parent.storage&&a.parent.storage.id!==b.contentProperties.parentId){var d=this.nodeMap[b.contentProperties.parentId];d&&(this.reparentNoEvents(a,d),c.add(d))}},c.prototype.addToFavorite=function(b){var c=a.firstOrDefault(this.favorites.children||[],function(a){return a.key===b.key||a.linkedTo&&a.linkedTo.key===b.key});return c||(this.add(this.favorites,this.createLink(b),!0),this.raiseNodeUpdated(this.favorites)),Q.when(null)},c.prototype.removeFromFavorite=function(b){var b=a.firstOrDefault(this.favorites.children||[],function(a){return a.key===b.key||a.linkedTo&&a.linkedTo.key===b.key});return b?Q.when(this.removeNode(b)):Q.when(null)},c.prototype.getMasterNodes=function(a){var b=[],c=function(d){a(d)&&b.push(d),d.children&&d.children.forEach(function(a){return c(a)})};return c(this.private),c(this.shared),b},c.prototype.moveItem=function(a,c,d){var e=this;return d.add(a.parent),a.type===b.TreeNodeType.Folder&&a.storage?this.storageService.updateNode(a.storage.id,a.storage.version,{parentId:c.storage.id}).then(function(b){a.storage={id:b.affectedStoreMetadata.id,version:b.affectedStoreMetadata.version},a.isShared=b.affectedStoreMetadata.contentProperties.shared,e.reparentNoEvents(a,c),d.add(a)}):a.serializableItem?a.serializableItem.move(c.storage.id).then(function(b){if(b.error)throw new Error(b.error);e.updateDashNode(a),e.dashboardService.updateMd(a.serializableItem.id,b.version),e.reparentNoEvents(a,c),d.add(a)}):Q.when(null)},c.prototype.getRoot=function(a){for(;a.parent;)a=a.parent;return a},c.prototype.makeLink=function(a,b,c){var d=this;return b.storage?a.serializableItem?this.dashboardStorageService.createLink(a.serializableItem,b.storage.id).then(function(e){var f=d.add(b,d.createLink(a));c.add(b),f.serializableItem=e;var g=d.getRoot(f),h=a.linkedBy.filter(function(a){return a!==f&&a.serializableItem&&d.getRoot(a)===g}),i=Q.when(null);return h.forEach(function(a){i=i.then(function(){return d.removeAndDelete(a,c)})}),i}):Q.reject(new Error("Cannot link a non-storage item")):Q.reject(new Error("Cannot link the item in a virtual folder"))},c.prototype.makeItemFromSample=function(c,d,e){var f=this;return d.storage?c.serializableItem?c.serializableItem.getState(!1,!1).then(function(g){switch(c.type){case b.TreeNodeType.Dashboard:return f.dashboardStorageService.create(d.storage.id,a.dashboard.DashboardStorageService.DashboardFileType,c.name,g,c.description).then(function(a){f.service.registerDashboardData(f,a.dashboard,d),e.add(d)});case b.TreeNodeType.DefaultWidget:case b.TreeNodeType.StatefulWidget:return Q.reject(new Error("Operation not allowed"));default:return Q.reject(new Error("Unable to copy the give file type: "+c.type))}}):Q.reject(new Error("Cannot copy a non-storage item")):Q.reject(new Error("Cannot copy the item in a virtual folder"))},c.prototype.updateAllTags=function(a){var b=this;a&&a.length&&this.$rootScope.$evalAsync(function(){a.forEach(function(a){b.allTags[a]||(b.allTags[a]=!0,b.allTagOptions.push({value:a}))})})},c.prototype.switchFavorite=function(a,b,c){var d=this;b._isFavorite=c,this.dashboardStorageService.setFavorite(a,b.key,c);var e;return e=c?this.addToFavorite(b):this.removeFromFavorite(b),e.then(function(){return d.raiseNodeUpdated(b)})},c}();b.TreeModel=d}(b=a.home||(a.home={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c,d=a.syncRequire("moment");!function(a){a[a.None=0]="None",a[a.Move=1]="Move",a[a.MoveAndMakeLinkBack=2]="MoveAndMakeLinkBack",a[a.MakeLink=3]="MakeLink",a[a.MakeFromSample=4]="MakeFromSample"}(c||(c={}));var e=function(){function e(a,b,c,d,e,f,g,h,i,j,k){this.$rootScope=a,this.$q=b,this.$timeout=c,this.dashboardService=d,this.dashboardStorageService=e,this.storageService=f,this.serverService=g,this.loggerFactory=h,this.catalog=i,this.rootComponentService=j,this.configService=k,this._logger=h.create("HomeService")}return Object.defineProperty(e.prototype,"showWidgets",{get:function(){return!this.configService.config.shell.lockedWorkspace},enumerable:!0,configurable:!0}),e.prototype.fetchTree=function(){var a=this,c=new b.TreeModel(this,this.$q,this.$rootScope,this.storageService,this.dashboardService,this.dashboardStorageService,this.serverService.getUserName());return this.showWidgets&&this.loadEmptyWidgets(c),this.loadAppDashboards(c),this.$q.when(this.loadStorages(c,!0).then(function(){return a.populateLastUsed(c),c}))},e.prototype.loadEmptyWidgets=function(a){var c=this,d=Object.keys(this.catalog.categories).map(function(a){return c.catalog.categories[a]});d.forEach(function(d){var f=d.components.filter(function(a){return!a.isHidden});if(f.length>0){var g=d.path||[d.displayName||d.id],h=a.shared;g.forEach(function(b){var c=e.SAMPLE_FOLDER_PREFIX+b;h=a.getOrCreate(h,c,b,!0)}),f.forEach(function(d){if(!c.catalog.isHidden(d)){var f=a.add(h,{key:e.EMPTY_COMP_PREFIX+d.id,name:d.displayName,type:b.TreeNodeType.DefaultWidget,description:d.description,widgetId:d.id,tags:d.tags});c.initFavorite(a,f)}})}})},e.prototype.loadAppDashboards=function(c){var d=this;this.dashboardService.getAppDashboards().forEach(function(f){var g=d.dashboardStorageService.toDashboardInfo(f),h=g.itemPath.path,i=c.shared;h.forEach(function(b){var d=e.SAMPLE_FOLDER_PREFIX+b.replace(/\./g,"_");i=c.getOrCreate(i,d,b,!0,a.stringFormat(a.shell.Strings.Text_Dashboard_AppFolder_Desc,{module:f.moduleName}))});var j=c.add(i,{key:g.id,name:g.name,description:g.description,type:f.type===a.DashboardDefinitionType.WidgetState?b.TreeNodeType.StatefulWidget:b.TreeNodeType.Dashboard,serializableItem:a.dashboard.SerializableDashboard.fromDashboardAppData(d.dashboardStorageService,f),isSample:!0,isShared:!0,widgetId:f.componentTypeId,tags:g.tags});d.initFavorite(c,j)})},e.prototype.loadStorages=function(c,e){var f=this,g=new b.BulkEvent(c);return this.dashboardStorageService.fetch(e).then(function(b){b.privateDashboardRootFolder&&c.updateRootMd(c.private,b.privateDashboardRootFolder),b.sharedDashboardRootFolder&&c.updateRootMd(c.shared,b.sharedDashboardRootFolder),[{root:b.sharedFolders,shared:!0},{root:b.privateFolders,shared:!1}].forEach(function(a){a.root&&a.root.forEach(function(b){var d=c.find(b.id);if(!d){var e=c.find(b.contentProperties.parentId);e&&c.createFolderNode(e,b,a.shared,g)}})}),b.dashboards.forEach(function(a){var b=c.find(a.parentMetaId);b&&!c.find(a.id)&&f.registerDashboardData(c,a,b)}),g.raise(f.$rootScope);var e=f.rootComponentService.getRootComponent();if(e instanceof a.dashboard.DashboardRootComponent){var h=b.dashboards.reduce(function(b,c){return c.isLink||c.storeType!==a.dashboard.DashboardStorageService.DashboardFileType||(b[c.id]=!0),b},{});e.userDataGc(h,d,d())}})},e.prototype.registerDashboardData=function(a,b,c){if(b.isLink){var d=a.find(b.isLink);if(d){var e=a.add(c,a.createLink(d));e.serializableItem=b,e.owner=b.owner,a.updateNodeProps(e)}}else{var f=a.add(c,this.createDashNode(a,b));this.initFavorite(a,f)}},e.prototype.createDashNode=function(c,d){var e={key:d.id,type:d.storeType===a.dashboard.DashboardStorageService.DashboardFileType?b.TreeNodeType.Dashboard:b.TreeNodeType.StatefulWidget,serializableItem:d,widgetId:d.widgetId,tags:d.tags};return c.updateDashNode(e),e},e.prototype.traceAnalyticsForFavoriteItems=function(c,d){switch(c.type){case b.TreeNodeType.Dashboard:a.dashboard.SerializableDashboard.traceAnalyticsDisplayNameMapping(this._logger,c.key,c.name);var e=d?"SetDashboardFavorite":"SetDashboardNoFavorite";this._logger.analytics("Workspace",e,c.key);break;case b.TreeNodeType.DefaultWidget:var f=d?"SetWidgetFavorite":"SetWidgetNoFavorite";this._logger.analytics("Workspace",f,c.name);break;case b.TreeNodeType.StatefulWidget:var g=d?"SetSampleWidgetFavorite":"SetSampleWidgetNoFavorite";this._logger.analytics("Workspace",g,c.name)}},e.prototype.initFavorite=function(a,c){var d,e=this;switch(c.type){case b.TreeNodeType.Dashboard:d=!0;break;case b.TreeNodeType.StatefulWidget:case b.TreeNodeType.DefaultWidget:d=!1;break;default:throw new Error("Not supported")}c._isFavorite=this.dashboardStorageService.isFavorite(d,c.key),Object.defineProperty(c,"isFavorite",{get:function(){return c._isFavorite},set:function(b){e.traceAnalyticsForFavoriteItems(c,b),a.switchFavorite(d,c,b).done()},enumerable:!0}),c._isFavorite&&a.addToFavorite(c).done()},e.prototype.populateLastUsed=function(a){var c=this,d=function(b,d){var f=c.dashboardStorageService.getLastAccessTimesBySpace(b.map(function(a){return a.key}),d),g=b.map(function(a,b){return{item:a,time:f[b]}}).filter(function(a){return!!a.time});g=g.sort(function(a,b){return b.time.diff(a.time,"seconds")}),g.slice(0,e.lastUsedCount).forEach(function(b){a.add(a.lastUsed,a.createLink(b.item),!0)})};d(a.getMasterNodes(function(a){return a.type===b.TreeNodeType.Dashboard}),!0),d(a.getMasterNodes(function(a){return a.type===b.TreeNodeType.DefaultWidget||a.type===b.TreeNodeType.StatefulWidget}),!1)},e.prototype.getContained=function(a,b){var c=this,d=[];return b.forEach(function(b){a.indexOf(b)>=0&&d.push(b),d=d.concat(c.getContained(a,b.children||[]))}),d},e.prototype.delete=function(c,d,e){var f=this;this._logger.ifMedium(function(){return{key:"Deleting",params:d&&d.map(function(a){return{key:a.key,name:a.name}})}});var g=d.map(function(a){return{canDelete:c.canDelete(a),node:a}}).filter(function(a){return!a.canDelete});if(g.length>0)return Q.when(g.map(function(a){return{node:a.node,error:new Error("Missing delete rights")}}));var h=[],i=function(a){a.forEach(function(a){h.indexOf(a)<0&&c.canDelete(a)&&h.push(a)})},j=function(a,b){return a!==b&&a.parent&&(a.parent===b||j(a.parent,b))};e||(e=new b.BulkEvent(c)),i(d);var k=c.getMasterLinks(d.concat(c.getSlaveLinks(d)));i(k),i(c.getSlaveLinks(k)),a.spliceAll(h,function(b){return a.any(h,function(a){return j(b,a)})});var l=(this.dashboardService.dashboardList||[]).map(function(a){return c.find(a.id)}),m=this.getContained(l,d),n=Q.when(null),o=[];return h.forEach(function(a){n=n.then(function(){return a.type==b.TreeNodeType.Folder&&a.storage?f.storageService.deleteNode(a.storage.id,a.storage.version,!0).then(function(){}):a.serializableItem?a.serializableItem.delete():void 0}).then(function(){c.removeNode(a,e)}).catch(function(b){o.push({error:b,node:a})})}),n.then(function(){return e.raise(f.$rootScope),f.$rootScope.$evalAsync(function(){m.forEach(function(a){f.dashboardService.removeDashboard(a.key).done()})}),o})},e.prototype.getUniqueStorageName=function(b,c){return this.storageService.loadTree(c,a.NodeRetrieveMode.NodeAndChildren).then(function(b){return a.getUniqueName(a.shell.Strings.Text_Prefix_New_Folder,b.storages.map(function(a){return a.contentProperties.displayName}))})},e.prototype.createFolder=function(c,d){var e=this;if(!c.canCreateFolder(d))return this.$q.reject(new Error('Cannot write in "'+d.name+'" folder'));var f=d.storage;return this.$q.when(this.getUniqueStorageName(a.shell.Strings.Text_Prefix_New_Folder,f.id).then(function(a){return e.storageService.createNode({displayName:a,parentId:f.id})}).then(function(a){var f=new b.BulkEvent(c),g=c.createFolderNode(d,a.affectedStoreMetadata,a.affectedStoreMetadata.contentProperties.shared,f);return f.raise(e.$rootScope),g}))},e.prototype.createDashboard=function(c,d){var e=this;if(!c.canCreateDashboard(d))return this.$q.reject(new Error('Cannot write in "'+d.name+'" folder'));var f,g,h=d.storage,i=new b.BulkEvent(c);return this.$q.when(this.dashboardStorageService.create(h.id,a.dashboard.DashboardStorageService.DashboardFileType,a.shell.Strings.Text_Prefix_New_Dashboard).then(function(a){if(g=a.dashboard,f=c.add(d,e.createDashNode(c,a.dashboard)),i.add(d),d.isShared||d===c.shared)return c.makeLink(f,c.private,i)}).then(function(){return i.raise(e.$rootScope),{node:f,data:g}}))},e.prototype.validateNewName=function(b,c,d){var e=c.linkedTo||c;return e.parent&&a.firstOrDefault(e.parent.children||[],function(a){return a.name===d&&a.type===c.type})?a.shell.Strings.Err_Home_DuplicatedName:null},e.prototype.updateMd=function(a,c,d,e,f){var g=this;if(!a.canRename(c))return this.$q.reject(new Error('Cannot rename read-only item "'+c.name+'"'));var h=c.linkedTo||c,i=function(a){if(a.type===b.TreeNodeType.Folder&&a.storage){if(f&&f.length)throw new Error("Tags not supported for folders");return g.storageService.updateNode(a.storage.id,a.storage.version,{displayName:d,description:e}).then(function(b){a.storage={id:b.affectedStoreMetadata.id,version:b.affectedStoreMetadata.version},a.name=b.affectedStoreMetadata.contentProperties.displayName,a.description=b.affectedStoreMetadata.contentProperties.description})}if(a.serializableItem){if(!a.serializableItem.isLink)return a.serializableItem.updateMeta({displayName:d,description:e,userData:f&&{tags:f}}).then(function(b){if(b.error)throw b.error;d&&a.serializableItem.traceAnalytics("Rename",null),g.dashboardService.updateMd(a.serializableItem.id,b.result.version,b.result.displayName,b.result.description),a.name=b.result.displayName,a.description=b.result.description,a.tags=b.result.userData&&b.result.userData.tags});a.name=h.name,a.description=h.description,a.tags=h.tags}};return this.$q.when(i(h).then(function(){return Q.all((h.linkedBy||[]).map(function(a){return i(a)})).then(function(){a.raiseNodeUpdated(c)})}))},e.prototype.calcMoveAction=function(a,b,d){var e=a.getRoot(b),f=a.getRoot(d);if(b.isSample)return Q.when(c.MakeFromSample);if(b.serializableItem||b.storage){if(e===a.private&&f===a.shared)return Q.when(c.MoveAndMakeLinkBack);if(e===a.shared&&f===a.private)return Q.when(c.MakeLink)}return Q.when(c.Move)},e.prototype.move=function(d,e,f){var g=this;this._logger.ifMedium(function(){var a=e&&e.map(function(a){return{key:a.key,name:a.name}});return{key:"Moving",params:{items:a,parent:f&&{key:f.key,name:f.name}}}});var h=f.storage;if(!f.canWriteChildren||!h)return this.$q.when([new Error(a.shell.Strings.Err_Home_CannotMoveToTarget)]);var i=new b.BulkEvent(d,[f]),j=e.map(function(a){if(!d.canMove(a,f))return Q.reject(new Error("Item cannot be moved"));for(;a.linkedTo;)a=a.linkedTo;return g.calcMoveAction(d,a,f).then(function(b){switch(g._logger.ifMedium(function(){return{key:"Moving action",params:{action:b}}}),b){case c.Move:return d.moveItem(a,f,i);case c.MakeLink:return d.makeLink(a,f,i);case c.MoveAndMakeLinkBack:var e=a.parent;return d.moveItem(a,f,i).then(function(){return d.makeLink(a,e,i)});case c.MakeFromSample:return d.makeItemFromSample(a,f,i)}})});return this.$q.when(Q.allSettled(j).then(function(a){return i.raise(g.$rootScope),a.map(function(a){return"fulfilled"===a.state?null:a.reason})}))},e.prototype.unshare=function(a,c){var d=this,e=new b.BulkEvent(a),f=c.map(function(b){var c=a.checkUnshare(b),f=c.error,g=c.item,h=c.targetFolder;return f?Q.reject(f):(d._logger.low("unshare",{item:g.key,sharedFolder:g.parent.key,privateFolder:h.key}),a.moveItem(g,h,e).then(function(){var b=(g.linkedBy||[]).filter(function(b){return a.getRoot(b)===a.private&&!!b.serializableItem}),c=Q.when(null);return b.forEach(function(b){c=c.then(function(){return a.removeAndDelete(b,e)})}),c}))});return this.$q.when(Q.allSettled(f).then(function(a){return e.raise(d.$rootScope),a.map(function(a){return"fulfilled"===a.state?null:a.reason})}))},e.SAMPLE_FOLDER_PREFIX="_S",e.EMPTY_COMP_PREFIX="_C",e.lastUsedCount=10,e}();b.HomeService=e,a.module("ionwebShell").service("homeService",["$rootScope","$q","$timeout","ionweb.dashboardService","ionweb.dashboardStorageService","ionweb.storageService","ionweb.serverService","ionweb.loggerFactory","ionweb.catalogService","ionweb.rootComponentService","ionweb.configurationService"],function(a,b,c,d,f,g,h,i,j,k,l){return new e(a,b,c,d,f,g,h,i,j,k,l)})}(b=a.home||(a.home={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b=function(){function b(){this._preferenceDialogConfigs={},this._config={}}return Object.defineProperty(b.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isDisabled",{get:function(){return!!this._config&&(this.shouldHideGeneralTab()&&this.shouldHideDateTab()&&this.shouldHideTimeTab()&&this.shouldHideLanguageTab()&&this.shouldHideNumberTab())},enumerable:!0,configurable:!0}),b.prototype.shouldHideGeneralTab=function(){if(!this._config)return!1;var a=this._config.hideGeneralPreferences;return void 0!==a&&null!==a&&("boolean"==typeof a||a instanceof Boolean?a:!!(a.hideThemePreference&&a.hideDensityPreference&&a.hideResetMultiSortingConfirmationDialogPreferences&&a.hideAutoEditPreferences&&a.hideMultipleNotificationsPreferences&&a.hideWidgetMaximizeButtonPreferences))},b.prototype.shouldHideDateTab=function(){return!!this._config&&this.shouldHideDateTimeTab(this._config.hideDatePreferences)},b.prototype.shouldHideTimeTab=function(){return!!this._config&&this.shouldHideDateTimeTab(this._config.hideTimePreferences)},b.prototype.shouldHideLanguageTab=function(){if(!this._config)return!1;var a=this._config.hideLanguagePreferences;return void 0!==a&&null!==a&&("boolean"==typeof a||a instanceof Boolean?a:!!a.hideLanguagePreference)},b.prototype.shouldHideNumberTab=function(){if(!this._config)return!1;var a=this._config.hideNumberPreferences;return void 0!==a&&null!==a&&("boolean"==typeof a||a instanceof Boolean?a:!!a.hideNumberPreference)},b.prototype.updateConfig=function(a,b){a&&(this._preferenceDialogConfigs[a]=b,this._config=this.mergeDialogConfig())},b.prototype.shouldHideDateTimeTab=function(a){return void 0!==a&&null!==a&&("boolean"==typeof a||a instanceof Boolean?a:!!a.hideShortFormatPreference&&!!a.hideLongFormatPreference&&!!a.hideRangeSeparatorPreference)},b.prototype.mergeDialogConfig=function(){var a=this,b=Object.getOwnPropertyNames(this._preferenceDialogConfigs),c={};return b.forEach(function(b){var d=a._preferenceDialogConfigs[b];if(d){var e=Object.getOwnPropertyNames(d);e.forEach(function(b){c[b]=a.mergedPreferenceConfig(c[b],d[b])})}}),c},b.prototype.mergedPreferenceConfig=function(b,c){if("boolean"==typeof b||b instanceof Boolean)return b||c;if("boolean"==typeof c||c instanceof Boolean)return c||b;if(b&&c){var d=Object.getOwnPropertyNames(c),e=a.extend({},[b]);return d.forEach(function(a){e[a]=e[a]||c[a]}),e}return b||c},b}();a.PreferenceDialogConfigManager=b}(ionweb||(ionweb={}));var ionweb;!function(a){var b=function(){function b(){this.preferenceApplied=new a.Event,this.onPreferenceDialogDisabledChanged=new a.Event,this._tabs=[],this._preferenceChanged=!1,this._configManager=new a.PreferenceDialogConfigManager}return Object.defineProperty(b.prototype,"configManager",{get:function(){return this._configManager},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isDisabled",{get:function(){return this.configManager.isDisabled&&(!this._tabs||!this._tabs.length)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"tabs",{get:function(){return this._tabs},enumerable:!0,configurable:!0}),b.prototype.updateConfig=function(a,b){if(a){var c=this.isDisabled;this.configManager.updateConfig(a,b),c!==this.isDisabled&&this.onPreferenceDialogDisabledChanged.raise(this,null)}},b.prototype.addTab=function(a){var b=this.isDisabled,c=this._tabs.some(function(b){return b.title===a.title});c||this._tabs.push(a),b!==this.isDisabled&&this.onPreferenceDialogDisabledChanged.raise(this,null)},b.prototype.removeTab=function(a){var b=this.isDisabled,c="string"==typeof a?a:a.title,d=-1;this._tabs.some(function(a,b){if(a.title===c)return d=b,!0}),d>-1&&this._tabs.splice(d,1),b!==this.isDisabled&&this.onPreferenceDialogDisabledChanged.raise(this,null)},b.prototype.setPreferenceChanged=function(){this._preferenceChanged=!0},b.prototype.isPreferenceChanged=function(){return this._preferenceChanged},b.prototype.onDialogClosed=function(){this._preferenceChanged=!1},b.prototype.notify=function(){this.preferenceApplied.raise(this,null),this._preferenceChanged=!1},b}();a.PreferenceDialogService=b,a.module("ionwebShell").service("preferenceDialogService",[],function(){return new b})}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){}return a.Menu_Dashboard_LockLayout="Lock layout",a.Menu_Dashboard_Edit="Edit dashboard",a.Menu_Dashboard_AddWidget="Add widget",a.Menu_Dashboard_ShowCaption="Show captions",a.Menu_Dashboard_FillHeightMode="Fit to browser window",a.Menu_Dashboard_CompactMode="Compact mode",a.Menu_Dashboard_PopOut="Pop out dashboard",a.Menu_Dashboard_Clone="Make my own copy",a.Menu_Dashboard_ShowHistory="Show history",a.Toolbar_Dashboard_AddWidget="Add widget",a.Toolbar_Dashboard_AddWidget_Tooltip="Add widget",a.Dashboard_User_Workflow="My space",a.Dashboard_Company_Workflow="Shared with me",a.Menu_Dashboard_ExportFile="Download dashboard",a.Menu_Dashboard_ImportFile="Import...",a.Menu_Dashboard_OpenSingle="Open dashboard",a.Menu_Dashboard_CheckForUpdate="Check for updates",a.Create_New_Dashboard="Create my own dashboard",a.Delete_Confirmation_Title="Delete items",
a.Delete_Confirmation_Delete="Delete",a.Delete_Confirmation_Cancel="Cancel",a.Move_Confirmation_Title="Move items",a.Move_Confirmation_Move="Move",a.Move_Confirmation_Cancel="Cancel",a.Menu_Dashboard_Toggle_Fullscreen="Full screen",a.Menu_Enter_Fullscreen="Enter full screen",a.Menu_Exit_Fullscreen="Exit full screen",a.Menu_Native_Reload="Reload",a.Tooltip_Dashboard_LockLayout="Lock and disable edit of the layout of the dashboard",a.Tooltip_Dashboard_Edit="Enter/exit edit mode",a.Tooltip_Dashboard_AddWidget="Open the widget selector to add widgets to the dashboard",a.Tooltip_Dashboard_ShowCaption="Show widgets captions",a.Tooltip_Dashboard_CompactMode="Remove the margins between widgets",a.Tooltip_Dashboard_PopOut="Open the current dashboard in a separate window",a.Tooltip_Dashboard_ShowHistory="Show the revision history of the dashboard",a.Tooltip_Dashboard_ExportFile="Download the current dashboard as file",a.Tooltip_Dashboard_ImportFile="Import a dashboard or a widget file",a.Tooltip_Dashboard_OpenSingle="Open a dashboard from the ION.WEB Storage",a.Tooltip_Dashboard_CheckForUpdate="Check for any changes made on the original source dashboard",a.Tooltip_Dashboard_FillHeightMode="Fit dashboard to fill the vertical space of the browser window",a.Tooltip_Dashboard_Rename_Dashboard="Rename the current dashboard",a.Tooltip_Dashboard_Clone="Make a private copy of the dashboard",a.Tooltip_Dashboard_ExportWidget="Download the current widget as file",a.Tooltip_Dashboard_Menu_Caption_Show="Always show the widget caption",a.Tooltip_Dashboard_Menu_Caption_Hide="Always hide the widget caption",a.Tooltip_Dashboard_Menu_Caption_Default="Inherit caption visibility from dashboard âShow captionâ option",a.Dashboard_Single_UpdateMsg='The original dashboard "${name}" has been modified since it was imported. Do you want to reload the dashboard and lose your changes or skip it?',a.Dashboard_Single_UpdatePos="Reload",a.Dashboard_Single_UpdateNeg="Skip",a.Dashboard_Single_UpdateTitle="Update found",a.Dashboard_Single_Update_No="No need to update",a.Dashboard_Single_Update_NotFound="Not found",a.Text_SaveAs_Title="Save widget...",a.Text_SaveAs_SelectFileName="Choose file name...",a.Text_SaveAs_SelectFolder="Select folder...",a.Text_SaveAs_Save="Save",a.Text_Decimal_Numbers="Decimal numbers",a.Text_Negative_Numbers="Negative numbers",a.Text_Decimal_Symbol="Decimal symbol",a.Text_Digit_Group_Symbol="Digit group symbol",a.Err_Decimal_Symbol_Required="Decimal symbol required",a.Err_FeedbackFailed="Feedback sending has failed",a.Text_Dashboard_FilterPlaceholder="Enter text to filter dashboards",a.Text_Dashboard_Share="Share",a.Text_Dashboard_Unshare="Unshare",a.Text_Dashboard_ConfirmDelete="Are you sure to delete the ${name} dashboard?",a.Text_Dashboard_ConfirmDeleteFolder="Are you sure to delete the ${name} group?",a.Text_Dashboard_ConfirmDeleteFolder_NotEmpty="Are you sure to delete the ${name} group with all its content? ${count} items will be deleted too!",a.Text_Prefix_New_Dashboard="New Dashboard",a.Text_Prefix_New_Group="New Group",a.Text_Prefix_New_Folder="New Folder",a.Text_Suffix_CopyOf=" Copy",a.Text_Dashboard_Selector_All_Items="All items",a.Text_ReadOnlyDashboard_Tooltip="${name} (read-only)",a.Text_Dashboard_EmptyListMessage="No available dashboards. Create a new one!",a.Text_Dashboard_CreateNew_Desc="Create a new dashboard",a.Text_Dashboard_CreateNewFolder_FormText="Enter the name of the shared group to create:",a.Text_Dashboard_CreateNewFolder_Desc="Create a new shared group",a.Text_Dashboard_Owner="By ${owner}",a.Text_Dashboard_Owner_Me="By me",a.Text_Dashboard_Private_Section="Private",a.Text_Dashboard_Private_Section_Desc="My Dashboards and widgets",a.Text_Dashboard_Favorite_Section="Favorite",a.Text_Dashboard_Favorite_Section_Desc="Favorite dashboards and widgets",a.Text_Dashboard_LastUsed_Section="Last Used",a.Text_Dashboard_LastUsed_Section_Desc="Groups of recently used dashboards and widgets",a.Text_Dashboard_AppFolder_Desc="From ${module} module",a.Text_Dashboard_AddSection_Desc="Create a new shared folder",a.Text_Dashboard_FolderPrivate_Desc="${name}",a.Text_Dashboard_Folder_Desc="${name}, created by ${created}",a.Text_Dashboard_AppDashboards="Templates",a.Text_Dashboard_CloseDashboard="Close dashboard",a.Text_Dashboard_CloseWidget="Close widget",a.Text_Dashboard_CloneWidget="Clone",a.Text_Dashboard_CopyWidget="Copy configuration",a.Text_Dashboard_PasteWidget="Paste configuration",a.Text_Dashboard_RestoreWidget="Restore widget",a.Text_Dashboard_MaximizeWidget="Maximize widget",a.Text_Dashboard_SaveWidget="Save",a.Text_Dashboard_ExportWidget="Download",a.Text_Dashboard_Menu_RenameWidget="Rename",a.Text_Dashboard_WidgetOptions="Options",a.Text_Dashboard_ComponentHelp="Help",a.Text_Dashboard_PopOutWidget="Pop out widget",a.Text_Dashboard_Loading="Loading...",a.Text_Dashboard_Deleted='Dashboard "${name}" successfully deleted.',a.Text_Widget_Deleted='Widget "${name}" successfully deleted.',a.Text_Dashboard_FolderDeleted='Group "${name}" successfully deleted.',a.Text_Dashboard_Moved='Dashboard "${name}" successfully moved into "${folder}" folder.',a.Text_Dashboard_Created='Dashboard "${name}" successfully created in "${folder}" folder.',a.Text_Dashboard_WidgetCreated='Widget "${name}" successfully created in "${folder}" folder.',a.Text_Dashboard_WidgetCreated_Organize="Organize",a.Text_Dashboard_FolderCreated="Group ${name} successfully created.",a.Text_Dashboard_Renamed='The dashboard "${oldName}" was successfully renamed to "${newName}".',a.Text_Dashboard_Saved="${name} saved.",a.Text_Dashboard_SavedOn="Saved ${when}",a.Text_Dashboard_Saving="Saving...",a.Text_Dashboard_DropHereToUndock="Drop here to remove from tab group",a.Text_Dashboard_DropHereGroup="Drop here to group",a.Text_Dashboard_ReleaseToGroup="Release to group",a.Text_Dashboard_Btn_Clone="Make my own copy",a.Text_Widgets_EmptyListMessage="No available widgets.",a.Text_Dashboard_DragDashboard_Tooltip="Drag to move the dashboard in different category.",a.Text_Dashboard_Enter_TextTo_FilterWidgets="Enter text to filter widgets",a.Text_Dashboard_CannotWrite_Ro_Tooltip1="The dashboard is read-only and cannot be edited.",a.Text_Dashboard_CannotWrite_Ro_Tooltip2="Do you want to make a private copy?",a.Text_Dashboard_AlreadyOpened_Ext="The dashboard ${name} is already opened in an external window.",a.Text_Dashboard_EditModeTooltip="Quit the edit mode.",a.Text_Dashboard_NotEditModeTooltip="Enter edit mode.",a.Text_Dashboard_DashboardPoppedOut='The dashboard "${name}" is now opened in a new window.',a.Text_Dashboard_NotProtectedModeTooltip="Quit the edit mode.",a.Text_Dashboard_ProtectedModeTooltip="The dashboard is in Protected Mode, any change will not be saved. Click to enter edit mode.",a.Text_Dashboard_UpdateExternally="Reload the dashboard to fetch the recent updates.",a.Text_Dashboard_Updated='The dashboard "${name}" was updated by ${author}.',a.Text_Dashboard_Updated_Self='You updated the dashboard "${name}" from another session.',a.Text_Dashboard_Moved_Info='The dashboard "${name}" was moved by ${author}.',a.Text_Dashboard_Moved_Info_Self='You moved the dashboard "${name}" from another session.',a.Text_Dashboard_Moved_Info_Self_Local='You moved the dashboard "${name}" to another folder. Please reload the dashboard.',a.Text_Dashboard_RenamedExt='The dashboard "${name}" was renamed as "${newName}".',a.Text_Dashboard_RenamedExt_Self='You renamed the dashboard "${name}" to "${newName}".',a.Text_Dashboard_DeletedExt='The dashboard "${name}" was deleted from another session.',a.Text_Dashboard_Warn_Conflict='The dashboard "${name}" has been modified outside the current session. Do you want to reload the dashboard and lose your changes or overwrite it?',a.Text_Dashboard_Warn_Conflict_Title="Conflict while saving",a.Text_Dashboard_Warn_UnsavedProt_1="Switching to edit mode, but local changes are detected.",a.Text_Dashboard_Warn_UnsavedProt_2="If you continue these modifications will be automatically saved. Do you want to keep your changes or discard it?",a.Text_Dashboard_Warn_UnsavedProt_Cont="Keep changes",a.Text_Dashboard_Warn_UnsavedProt_Rev="Discard changes",a.Text_Dashboard_Warn_Unsaved_Quit='The dashboard "${name}" contains unsaved changes.',a.Text_Dashboard_Warn_Unsaved_QuitN="The dashboards ${names} contain unsaved changes.",a.Text_Dashboard_Warn_Unsaved_Close="Dashboard changes are not going to be saved. Do you want to close it?",a.Text_Dashboard_Err_Duplicate_Side_Panel_Tab="Duplicate side panel tab found.",a.Text_Dashboard_Placeholder_Details="${compName} (${moduleName})",a.Text_Dashboard_Placeholder_Title="Widget not loaded.",a.Text_Dashboard_RevisionHistory="Revision history",a.Text_Dashboard_RevisionHistory_FilterTags="Only show versions with comments",a.Text_Dashboard_RevisionHistory_ShowMore="Show more versions",a.Text_Dashboard_RevisionHistory_Restore="Restore this version",a.Text_Dashboard_RevisionHistory_EditComment_Desc="Edit the comment of the version",a.Text_Dashboard_WidgetConfirmOverwrite_Text="The widget ${name} already exists. Do you want to overwrite it or use a different name (${altName})?",a.Text_Dashboard_WidgetConfirmOverwrite_Title="Widget exists",a.Text_Dashboard_WidgetConfirmOverwrite_UseDiffNameBtn="Use different name",a.Text_Dashboard_WidgetConfirmOverwrite_OverwriteBtn="Overwrite",a.Text_Dashboard_WidgetConfirmOverwrite_Cancel="Cancel",a.Text_Folder_Menu_Delete="Delete",a.Text_Folder_Deleted='Folder "${name}" successfully deleted.',a.Text_Folder_Menu_MoveTo="Move to",a.Text_Folder_Menu_Rename="Rename",a.Text_Dashboard_Menu_Delete="Delete",a.Text_Dashboard_Menu_Add="Add",a.Text_Dashboard_Menu_Open="Open",a.Text_Dashboard_Menu_MoveTo="Move to",a.Text_Dashboard_Menu_Rename="Rename",a.Text_Dashboard_Menu_Caption="Caption",a.Text_Dashboard_Menu_Caption_Show="Show",a.Text_Dashboard_Menu_Caption_Hide="Hide",a.Text_Dashboard_Menu_Caption_Default="Default",a.Text_Dashboard_Menu_Rename_DashBoard="Rename dashboard",a.Text_Dashboard_Menu_Favorite="Favorite",a.Text_Dashboard_Menu_Unshare="Unshare",a.Text_Dashboard_Tooltip_SetFavorite="Add to favorites",a.Text_Dashboard_Tooltip_ResetFavorite="Remove from favorites",a.Text_Dashboard_Tooltip_Select="Select",a.Text_Dashboard_Tooltip_Deselect="Deselect",a.Text_Dashboard_MultipleSelection_Cancel="Cancel",a.Text_Dashboard_MultipleSelection_Info_Single="1 item selected",a.Text_Dashboard_MultipleSelection_Info_Multiple="${count} items selected",a.Text_Dashboard_Menu_Rename_Desc="Edit description",a.Text_Dashboard_Menu_DashList="Dashboards",a.Text_Dashboard_Menu_CloseAll="Close all",a.Text_Widget_Menu_Delete="Delete",a.Text_Widget_Menu_MoveTo="Move to",a.Text_Widget_Menu_Rename="Rename",a.Text_Widget_Menu_Favorite="Favorite",a.Text_Widget_Menu_Rename_Desc="Edit description",a.Text_Widget_Menu_Unshare="Unshare",a.Text_Dashboard_MultipleDeleteConfirmation_Single="Are you sure you want to delete '${name}'?",a.Text_Dashboard_MultipleDeleteConfirmation_Multiple="Are you sure you want to delete these ${count} items?",a.Text_Dashboard_MultipleDeleteSuccess_Single="'${name}' deleted",a.Text_Dashboard_MultipleDeleteSuccess_Multiple="${count} items deleted",a.Text_Dashboard_MultipleDeleteError_Single="Error deleting item: ",a.Text_Dashboard_MultipleDeleteError_Multiple="Error deleting ${count} items: ",a.Text_Dashboard_MultipleMoveError_Single="Error moving item: ",a.Text_Dashboard_MultipleMoveError_Multiple="Error moving ${count} items: ",a.Text_Dashboard_MultipleSelectionOpen_Multiple="Open ${count} items",a.Text_Dashboard_MultipleSelectionOpen_Single="Open 1 item",a.Text_Dashboard_MultipleSelectionDelete_Multiple="Delete ${count} items",a.Text_Dashboard_MultipleSelectionDelete_Single="Delete 1 item",a.Text_Dashboard_MultipleSelectionMove_Multiple="Move ${count} items",a.Text_Dashboard_MultipleSelectionMove_Single="Move 1 item",a.Text_Dashboard_MultipleMoveSuccess="${count} items moved",a.Text_MovingToDifferentRootConfirmation_Single="Item already present in '${prevFolder}', do you want to move it into '${targetFolder}'?",a.Text_MovingToDifferentRootConfirmation_MultiplePrivate="One or more items are already present in your private workspace, do you want move them into '${targetFolder}'?",a.Text_MovingToDifferentRootConfirmation_MultipleShared="One or more items are already shared, do you want to move them into '${targetFolder}'?",a.Text_Dashboard_DeletedCompUndo="Widget '${name}' closed.",a.Text_Navigation_NoDashboard="No dashboard has been selected",a.Text_Home_Loading="Loading...",a.Text_Home_Offline="Cannot load storages right now",a.Text_Home_SearchResults="Search results...",a.Text_Home_All="All",a.Text_Home_Folders="Folders",a.Text_Home_Dashboards="Dashboards",a.Text_Home_Widgets="Widgets",a.Text_Home_No_Result="No result.",a.Text_Home_Folder_My_Workspace="My Workspace",a.Text_Home_Folder_Favorites="Favorites",a.Text_Home_Folder_Last_Used="Last used",a.Text_Home_Folder_Shared="Shared",a.Text_Home_Shared="Shared",a.Text_Home_SharedIn="Shared in ${folder}",a.Text_Home_Owner="Owner",a.Text_Home_Move="Move",a.Text_Home_Share="Share",a.Text_Home_Organize="Organize",a.Text_Home_EditName="Rename",a.Text_Home_EditDescription="Edit description",a.Text_Home_Select="Select",a.Text_Home_Deselect="Deselect",a.Text_Home_Favorite="Favorite",a.Text_Home_AddFavorite="Add to favorites",a.Text_Home_Removefavorite="Remove from favorites",a.Text_Home_New_Folder="New folder",a.Text_Home_New_Dashboard="New dashboard",a.Text_Home_New_Widget="New widget",a.Text_Home_DeleteFile="Are you sure to delete the item?",a.Text_Home_DeleteFiles="Are you sure to delete the items?",a.Text_Home_UnshareFile="Are you sure to unshare the item?",a.Text_Home_UnshareFiles="Are you sure to unshare the items?",a.Text_Home_ConfirmMoveInShared="Are you sure to move the target within the shared folder?",a.Text_Home_ConfirmCopy="This operation will copy the item(s) in the selected folder. Do you want to continue?",a.Text_Home_DeleteShared="You have selected some shared items. By continuing you will remove them from the shared space.",a.Text_Home_DeleteSharedSubfolder="Some folder you have selected contains shared item(s). By continuing you will remove them from the shared space.",a.Err_Home_Title_Rename="Rename error",a.Err_Home_BadNameFormat="Name is invalid: ${err}",a.Err_Home_BadDescriptionFormat="Description is invalid: ${err}",a.Err_Home_DuplicatedName="An item with the same name already exists.",a.Err_Home_CannotMoveToTarget="Cannot move items in the target folder.",a.Err_Home_StorageNotFound="The underlying object was removed from the server. The view will be refreshed.",a.Err_Home_VersionMismatch="The underlying object was updated by other people. The view will be refreshed.",a.Err_Home_ErrorDuringDelete="Unable to delete ${node}.",a.Err_Home_InvalidTag="Invalid tag name: ${err}",a.Err_Home_RefreshBtn="Refresh",a.Text_Home_Tags_Title="Tags: ${tags}",a.Text_Home_NoTags="No tags",a.Err_Dashboard_RootFolder="A problem occurred on Dashboard repository.",a.Err_Dashboard_RootFolder_Sec="Please verify Dashboard repository is accessible on the web server.",a.Err_Dashboard_InvalidName="Invalid dashboard name.",a.Err_Dashboard_InvalidDesc="Invalid dashboard description.",a.Err_Dashboard_Save_Unauthorizeds="You don't have rights to save the dashboards: ${names}. Consider to make a copy before saving.",a.Err_Dashboard_Save_Unauthorized="You don't have rights to save the dashboard ${name}. Consider to make a copy before saving.",a.Err_Dashboard_Save_Generic="Server error while saving dashboard '${name}': ${err}",a.Err_Dashboard_Update_Generic="Server error while updating '${name}': ${err}",a.Err_Dashboard_ReadOnly="The dashboard is read-only",a.Err_Dashboard_Template_NoHistory="The dashboard is a template and it doesn't have history.",a.Text_LogoutAction="Sign out",a.Msg_QuitWithoutSaving="All unsaved changes will be lost.",a.Msg_LogoutWithoutSaving_Title="Confirm log out",a.Menu_Help="Help",a.Menu_About="About",a.Menu_Save="Save",a.Menu_Preferences="Preferences",a.Err_AuthBanner_Logout_Title="The server connection is terminating",a.Err_AuthBanner_Logout_Message="Logging out, please wait.",a.Err_AuthBanner_Disconnected_Title="You appear to be offline",a.Err_AuthBanner_Disconnected_Message="Trying to reconnect...",a.Err_AuthBanner_Disconnected_Message_Timeout="Trying to reconnect in ${retryInterval} seconds...",a.Err_AuthBanner_Disconnected_TryNow_Text="Try now",a.Err_AuthBanner_Reauth_Title="The server requires re-authentication",a.Err_AuthBanner_Reauth_Message="Trying to reconnect. If this message persists, try to reload the page",a.Err_AuthBanner_Reauth_Message_IDP="You should sign in again",a.Err_ServerVer_NotMet="Server version ${ver} doesn't meet the requirements (${reqVer}).",a.Text_EditButton_Desc="Click to edit the name",a.Title_OTP_Required="Enter OTP",a.Err_Session_Requires_OTP_Message="Session expired, please provide a new OTP",a.Title_Preference_Dialog="Preferences",a.Title_Density_Selector="Display density",a.Title_Change_Password="Change password",a.Title_Preference_General="General",a.Title_Preference_Date="Date",a.Title_Preference_Time="Time",a.Title_Preference_Language="Language",a.Title_Preference_Number="Number",a.Title_Preference_CurrentTheme="Theme",a.Title_Preference_CurrentDensity="Density",a.Title_LanguageChanged="Language Change Detected",a.Title_Download="Download File",a.Title_Dashboard_PickWidget_ToCreate="Pick a Widget to create",a.Title_Dashboard_Selector="Pick a Dashboard to open",a.Title_Dialog_Confirmation="Confirmation",a.Title_Error_Warning="ERRORS & WARNINGS (${length})",a.Title_Service_Error="SERVICE ERRORS (${length})",a.Title_Columns="Columns",a.Title_Grouping="Grouping",a.Title_Columns_Drop_Here="Drop columns here",a.Msg_Preference_TableTitle="Tables",a.Msg_Preference_MiscTitle="Miscellaneous",a.Msg_Preference_MultiSorting="Show the table 'Reset multi-sorting' confirmation dialog",a.Msg_Preference_AutoEdit="Start edit on next cell automatically on enter/tab",a.Msg_Preference_NotificationMaxToastsOnScreen="Show multiple notifications on screen",a.Msg_Preference_ShowMaximizeWhenCaptionsAreHidden="Show widgets maximize button",a.Msg_Preference_EnableAnalyticsPreferenceCaption="Enable analytics",a.Text_FeedbackSent="Feedback successfully sent",a.Text_Feedback="Feedback",a.Err_PleaseSupply_SharingFile="Please supply a file for sharing",a.Err_PleaseSupply_FileId_Unshare="Please supply file id to unshare",a.Err_PleaseSupply_FileIdGet_DownloadLink="Please supply File id to get download link",a.Err_You_Cant_SpecifyBoth_ComponentsAndUsers="You can't specify both components and users",a.Btn_Download="Download",a.Msg_Download_Content="Your file is ready to be downloaded",a.Msg_LanguageChanged="Language selected in preference do not match with the one currently loaded. Language from preference will be loaded once you re-login or reload page.",a.Msg_PreferenceLanguageChanged="Changes will take effect at the next login or reloading the page.",a.Comp_Banner_Name="Banner",a.Comp_Banner_Desc="A resizable and configurable generic banner. Used to organize group of widgets.",a.DateTime_Text_Default="Default",a.Err_DateTime_RangeSeparator="Range separator cannot be same as date separator",a.Err_DateTime_InvalidRangeSeparator="Please specify a valid range separator",a.Text_DateTime_ShortFormat="Short Format",a.Text_DateTime_ShortFormat_IonNetHybrid="The short format is externally managed: ",a.Text_DateTime_ShortFormat_IonNetHybrid_Link="open preferences",a.Text_DateTime_LongFormat="Long Format",a.Text_DateTime_RangeSeparator="Range Separator",a.Text_Preview="Preview:",a.IonNetMenu_Widget_Timeout="Timeout contacting the server",a.IonNetMenu_Widget_Offline="Server connection lost",a.Reauthentication_Err_Bad_Password="Bad password",a.Reauthentication_Remaining_Attempts="Remaining attempts: ${attempts}",a.Reauthentication_Dialog_Title="ION.WEB",a.Reauthentication_Dialog_Description="The requested operation requires re-authentication. Please enter your password.",a.About_Version="Version",a.About_User="User",a.About_PoweredBy_IONWEB="Powered by ION.WEB",a.About_Modules="Modules",a.About_LogId="Log id",a.About_Btn_Details="Details",a.About_Traffic="Network",a.About_Traffic_TotalTx="Total sent:",a.About_Traffic_TotalRx="Total received:",a.About_Traffic_LOGGING="Logging",a.About_Traffic_DATA="Data",a.About_Traffic_SESSION="Session",a.About_Traffic_OTHER="Other",a.Text_Predefined="Predefined",a.Text_Custom="Custom",a.Tooltip_Dashboard_Menu="Dashboard Menu",a.Tooltip_Current_SignedIn_User="Current signed-in user",a.Tooltip_Show_Message="Show messages",a.Tooltip_Show_Warnings="Show warnings",a.Tooltip_Show_Errors="Show errors",a}();a.Strings=b}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){function b(a){return Math.log(a)/g}function c(a){var c=2-(a>0?Math.max(Math.floor(b(a)),0):0),d=Math.pow(10,c);return Math.floor(a*d)/d}function d(a){if(a<1024)return a+" "+e[0];if(a<1024e3){var b=a/1024;return c(b)+" "+e[1]}var d=Math.floor(Math.log(a/1e3)/f)+1,b=a/Math.pow(1024,Math.floor(d));return c(b)+" "+e[d]}var e=["bytes","KB","MB","GB","TB","PB"],f=Math.log(1024),g=Math.log(10);a.prettyPrintBytes=d}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={})),ionweb.services.registerCoreSubmodule("ionwebShell",["ionwebCore","ionwebCharts","ionwebGrids","ionwebAuth","ionwebTk","ionwebComm","ionwebCm","ionwebStorages","ionwebServer"],ionweb.shell.Strings);var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),ionweb;!function(a){a.Version="1.1.8-p1d8-r15018",a.Copyright="Â© Copyright 2018, ION.",a.GitSha="50b0bb1ece4773cd76bcd2a243f03fa86727291f"}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.Root=0]="Root",a[a.And=1]="And",a[a.Or=2]="Or",a[a.Not=3]="Not",a[a.Condition=4]="Condition"}(b=a.NodeType||(a.NodeType={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.QueryInProgress=0]="QueryInProgress",a[a.QuerySuccess=1]="QuerySuccess",a[a.QueryFailed=2]="QueryFailed"}(b=a.FilterPanelQueryStatus||(a.FilterPanelQueryStatus={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){a.COLUMN_RESIZING_CLASS="gridxColumnResizing",a.ROWHEADERHEADER_DIV_CLASS="gridxRowHeaderHeader",a.ROWHEADERBODY_DIV_CLASS="gridxRowHeaderBody";var b;!function(a){a[a.Left=0]="Left",a[a.Right=1]="Right"}(b=a.MouseButton||(a.MouseButton={}));var c;!function(a){a[a.Center=0]="Center"}(c=a.ScrollAlignment||(a.ScrollAlignment={}));var d;!function(a){a[a.Top=0]="Top",a[a.Bottom=1]="Bottom"}(d=a.GridContextMenuPosition||(a.GridContextMenuPosition={}));var e=function(){function a(){}return a.GridSelection="IGridDnDSelection",a.GridIdentifier="dndGridUID",a}();a.DnDFormatType=e;var f;!function(a){a[a.None=1]="None",a[a.Cells=2]="Cells",a[a.Keys=3]="Keys",a[a.Captions=4]="Captions",a[a.CaptionsCells=5]="CaptionsCells"}(f=a.DnDGridContentMode||(a.DnDGridContentMode={}));var g;!function(a){a[a.None=1]="None",a[a.Insert=2]="Insert",a[a.Overlay=3]="Overlay"}(g=a.DnDDropFeedbackLocationMode||(a.DnDDropFeedbackLocationMode={}));var h;!function(a){a[a.Column=1]="Column",a[a.Row=2]="Row"}(h=a.DnDDropFeedbackOrientation||(a.DnDDropFeedbackOrientation={}));var i;!function(a){a[a.Default=0]="Default",a[a.Enabled=1]="Enabled",a[a.Disabled=2]="Disabled"}(i=a.GridResponsivenessMode||(a.GridResponsivenessMode={}));var j;!function(a){a[a.Always=0]="Always",a[a.Hover=1]="Hover"}(j=a.columnIconVisibility||(a.columnIconVisibility={}));var k;!function(a){a[a.ShowOnSelection=0]="ShowOnSelection",a[a.ShowOnTopBar=1]="ShowOnTopBar",a[a.Hide=2]="Hide"}(k=a.SummaryPanelMode||(a.SummaryPanelMode={}));var l;!function(a){a[a.Auto=0]="Auto",a[a.Enabled=1]="Enabled",a[a.Disabled=2]="Disabled"}(l=a.GridEditOptionsMode||(a.GridEditOptionsMode={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var gridx;!function(a){function b(a,b,c){d.push({name:a,deps:b,handler:c})}function c(){return e||(e=ionweb.qRequire("gridx").then(function(){d.forEach(function(a){window.define(a.name,a.deps,a.handler)})})),e}var d=[];a.registerModule=b;var e;a.load=c}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/AsyncCache",["dojo/_base/declare","gridx/core/_Module","dojo/_base/array","dojo/_base/lang","gridx/core/model/cache/Async"],function(a,b,c,d,e){return b.register(a(e,{_onSet:function(a){var b,c,d=a.__fetchData;"function"==typeof d?(b=a.__rowId,c=this._cache[b],c&&this.inheritedOnSet(a.__fetchData())):(b=this.store.getIdentity(a),c=this._cache[b],c&&this.inherited(arguments))},inheritedOnSet:function(a){var b=this,c=b.store.getIdentity(a),d=b.idToIndex(c),e=b.treePath(c),f=b._cache[c];e.length&&b._addRow(c,d,b._itemToObject(a),a,e.pop());var g={};Object.keys(a).forEach(function(a){return g[a]=a}),b.onSet(c,d,b._cache[c],f,g)},_addRow:function(a,b,e,f,g){var h,i=(d.hitch,d.mixin,c.indexOf),j=this,k=j._struct,l=j._priority,m=j.model.isId(g)?g:"",n=k[m];if(!n)throw new Error("Fatal error of _Cache._addRow: parent item "+m+" of "+a+" is not loaded");var o=n[b+1];if(j.model.isId(o)&&o!==a&&console.error("Error of _Cache._addRow: different row id "+a+" and "+n[b+1]+" for same row index "+b),n[b+1]=a,k[a]=k[a]||[m],""===m&&(h=i(l,a),h>=0&&l.splice(h,1),l.push(a)),j._cache[a]){var p=function(a){var b={};for(var c in a){var d=a[c];b[c]=d}return b},q=p(j._cache[a].rawData),r=p(j._cache[a].item);Object.keys(f).forEach(function(a){r[a]=f[a]});var s=p(j._cache[a].data);Object.keys(e).forEach(function(b){q[b]=e[b],j.columns[b]&&(s[b]=j._formatCell(q,a,b))}),j._cache[a]={data:s,rawData:q,item:r}}else j._cache[a]={data:j._formatRow(e,a),rawData:e,item:f};j.onLoadRow(a)}}))})}(gridx||(gridx={}));var ionweb;!function(a){var b;!function(a){function b(a,b,d){if(!a)return 0;var e=document.createElement("canvas");e.width=100,e.height=100,document.body.appendChild(e);var f=e.getContext("2d"),g=c(a),h=window.getComputedStyle(a,null);f.font=h.fontStyle+" "+h.fontVariant+" "+h.fontWeight+" "+h.fontSize+"/"+h.lineHeight+" "+h.fontFamily;var i=f.measureText("W").width;return b.forEach(function(a,b){return i=Math.max(f.measureText(a).width+(d?d[b]:0),i)}),document.body.removeChild(e),i+g}function c(a){for(var b=window.getComputedStyle(a,null),d=parseInt(b.getPropertyValue("padding-left")),e=parseInt(b.getPropertyValue("padding-right")),f=parseInt(b.getPropertyValue("margin-left")),g=parseInt(b.getPropertyValue("margin-right")),h=f+d+e+g,i=0;i<a.children.length;i++)h+=c(a.children[i]);return h>=0?h:0}function d(b){if(void 0===b||null===b)return null;if("number"==typeof b)return b;var c=b.indexOf(a.ROW_HEADER_COLUMN_ID_PREFIX);return 0===c?parseInt(b.substr(a.ROW_HEADER_COLUMN_ID_PREFIX.length)):null}function e(b){return a.ROW_HEADER_COLUMN_ID_PREFIX+b}function f(a){var b=d(a);return null!==b&&b>=-1?b:a}function g(a,b){try{a.innerHTML=b.innerHTML}catch(e){for(;a.firstChild;)a.removeChild(a.firstChild);for(var c=b.childNodes.length,d=0;d<c;d++)a.appendChild(b.childNodes[d].cloneNode(!0))}}function h(a){return a&&a.indexOf("<")>=0}a.ROW_HEADER_COLUMN_ID_PREFIX="iongrid_sortable_header_",a.getMaxWidth=b,a.getAdditionalSpace=c,a.fromRowHeaderId=d,a.toRowHeaderId=e,a.toKeyOrLevel=f,a.cloneInnerHtml=g,a.isHtmlFast=h}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ExpandState=ionweb.tables.ExpandState,gridx;!function(a){var b,c,d,e,f,g,h,i,j,k=function(a){return a?a.clientHeight:0},l=function(){function l(){this.movedRows={},this.defaultRowHeight="24px",this.width="100px",this.DEFAULT_HEADER_CELL_WIDTH=90,this.HEADER_GRIP_WIDTH=20,this._rowToUpdates={},this.init()}return l.prototype.init=function(a){this.rowHeightCache={},this.name="rowHeader",this.bodyNode=e.create("div",{class:"gridxRowHeaderBody"}),this._isHierarchical=!0,a?this.rowAxis=a:this.rowAxis=this.arg("rowAxis"),this.rowAxis.getAs(ionweb.tables.FlatAxis)&&(this._isHierarchical=!1);var b=e.create("table",{});b.style.height=this.defaultRowHeight,b.style.tableLayout="fixed",b.style.borderCollapse="collapse",f.add(b,"gridxRowHeaderCellBottom"),f.add(b,"gridxRowHeaderCellRight"),this._isHierarchical&&f.add(b,"gridRowHeaderCellRightDotted"),this.headerTableColGroup=e.create("colgroup",{}),b.appendChild(this.headerTableColGroup),this.tableNode=e.create("tbody",{}),b.appendChild(this.tableNode),this.cachedExpandoWidth=-1,this.idProperty="__dojo__store__id",this.bodyNode.appendChild(b)},l.prototype.destroy=function(){this.inherited(arguments),e.destroy(this.headerNode),e.destroy(this.bodyNode),$(window).unbind("resize",this.resizeHandler),this.isDestroyed=!0},l.prototype.refreshWidth=function(){var a=this.DEFAULT_HEADER_CELL_WIDTH;if(this.outlineModeConfig&&this.outlineModeConfig.rowLevelDescriptors&&this.outlineModeConfig.rowLevelDescriptors.length>1){var b=this.outlineModeConfig.compact!==!1?1:0,c=this.outlineModeConfig.rowLevelDescriptors.length-b;a=this.DEFAULT_HEADER_CELL_WIDTH*c}this.setWidth(a+"px")},l.prototype.preload=function(){var a=this,e=this.grid,f=this.arg("width");this.rowAxis=this.arg("rowAxis"),this.dynamicRowHeight=this.arg("dynamicRowHeight"),this.outlineModeConfig=this.arg("outlineModeConfig"),this.changedStateHandler=this.arg("changedStateHandler"),this.onlyDragMode=this.arg("onlyDragMode"),this.showLeavesCounter=this.arg("showLeavesCounter"),e._initEvents(["RowHeaderHeader","RowHeaderCell"],e._eventNames),this.headerNode=this._buildHeaderNode(),e.header.domNode.appendChild(this.headerNode),this.headerNode.style.width=f,e._connectEvents(this.headerNode,"_onHeaderMouseEvent",this),e.mainNode.appendChild(this.bodyNode),this.bodyNode.style.width=f,e.hLayout.register(null,this.bodyNode),this.batchConnect([e.body,"onRender","_onRendered"],[e.body,"onAfterRow","_onAfterRow"],[e.body,"onAfterCell","_onAfterCell"],[e.body,"onUnrender","_onUnrender"],[e.body,"onEmpty",function(){a.tableNode.innerHTML=""}],[e.bodyNode,"onscroll","_onScroll"],[e,"onRowMouseOver","_onRowMouseOver"],[e,"onRowMouseOut","_onRowMouseOver"],[e,"_onResizeEnd","_onResize"],e.columnWidth&&[e.columnWidth,"onUpdate","_onResize"],e.columnResizer&&[e.columnResizer,"onResize","_onResize"],[e,"onRowHeaderCellMouseOver","_onCellMouseOver"],[e,"onRowHeaderCellMouseOut","_onCellMouseOver"],[this.model,"onSizeChange","_onSizeChange"]),this._cnnts.push(d.before(e.body,"renderRows",c.hitch(this,this._onRenderRows),!0),d.before(e.body,"_onDelete",c.hitch(this,this._onDelete),!0)),e._connectEvents(this.bodyNode,"_onBodyMouseEvent",this),this._initFocus(),this.refreshWidth();var g=this;this.resizeHandler=function(){for(var a=0;a<g.tableNode.childElementCount;a++){var c=g.tableNode.children[a].getAttribute("visualindex"),d=b('[visualindex="'+c+'"].gridxRowHeaderRow',g.tableNode)[0],e=g.grid.dod?b('[visualindex="'+c+'"].gridxRow',g.grid.bodyNode)[0]:b('[visualindex="'+c+'"].gridxRow .gridxRowTable',g.grid.bodyNode)[0];g._syncRowHeight(d,e)}},$(window).bind("resize",this.resizeHandler)},l.prototype.load=function(a,b){var c=this;b.then(function(){c.layoutRowHeaders(),c.loaded.callback(void 0)})},l.prototype.layoutRowHeaders=function(){var a=this.bodyNode,b=a.offsetWidth||g.get(a,"width"),c=this.grid.isLeftToRight();if(this.grid.mainNode){var d=h.getBorderExtents(this.grid.mainNode);a.style[c?"left":"right"]=-(b+(c?d.l:d.r))+"px"}},l.prototype.notifyChanges=function(){var a=this.changedStateHandler;a&&a()},l.prototype.getRow=function(a,b,c){var d,e=this;e.grid;return d=d||e.mixin(e.grid,new j(e.grid),"row"),e.delegate(d,{id:a})},l.prototype.delegate=function(a,b){function d(){}d.prototype=a;var e=new d;return d.prototype=null,b&&c.mixin(e,b),e},l.prototype.mixin=function(a,b,d){var e,f,g=this.grid._modules;for(e in g)e=g[e].mod,f=e[d+"Mixin"],c.isFunction(f)&&(f=f.apply(e)),
c.mixin(b,f||{});return b},l.prototype.exportRowHeaders=function(a,b){if(b.rowHeader){this.init(b.rowHeaderRowAxis),this.grid=b,this.printPreload(),this.bodyNode.style.height="auto",this.bodyNode.style.overflow="visible";var d=0,e=b.rowCount();this._onRenderRows(d,e,a);var f=this;if(b.rows)for(var g=b.rows(d,e),h={count:e,parentId:"",start:0},i=c.mixin({},[h]),j=this,l=j.grid,m=l.store.query({},i),n=0;n<g.length;n++){var o=g[n];if(!o){var p=m.length&&l.model._cache._itemToObject(m[n]);o=j.getRow(p.__dojo__store__id,1,""),o.item=function(){return p},o.visualIndex=function(){return n}}f.updateCellsForRow(o,!0)}this.grid.rowHeader&&this.outlineHeadersColGroup&&this.setColumnWidths(this.grid.rowHeader.getHeadersWidth()),this.layoutRowHeaders();var q=this.grid.bodyNode&&k(this.grid.bodyNode.firstChild)*e;return{rowHeaderNode:this.bodyNode,height:q}}},l.prototype.printPreload=function(){var a=this.grid,b=a.rowHeader?a.rowHeader.getWidth():this.width;this.rowAxis=a.rowHeaderRowAxis,a.rowHeader&&(this._isCollapse=a.rowHeader._isCollapse,this.onlyDragMode=a.rowHeader.onlyDragMode,this.outlineModeConfig=a.rowHeader.outlineModeConfig),this.headerNode=this._buildHeaderNode(),this.headerNode.style.width=b,this.bodyNode.style.width=b;var c=this.DEFAULT_HEADER_CELL_WIDTH*(this.outlineModeConfig?this.outlineModeConfig.rowLevelDescriptors.length-(this.outlineModeConfig.compact!==!1?1:0):1);this.setWidth(c+"px")},l.prototype.onMoveToRowHeaderCell=function(a,b){},l.prototype.setWidth=function(a){this.onlyDragMode&&(a=this.HEADER_GRIP_WIDTH+"px"),this.headerNode.style.width=a,this.bodyNode.style.width=a,this.currentWidth=a,this.grid.body.onRender(),this.grid.hLayout.reLayout(),this.grid.vLayout.reLayout(),this.notifyChanges()},l.prototype.getWidth=function(){return this.currentWidth||(this.currentWidth=this.bodyNode.style.width),this.currentWidth},l.prototype.getHeadersWidth=function(){var a=[];if(this.outlineHeadersColGroup)for(var b=this.outlineHeadersColGroup.children,c=0;c<b.length;c++)a.push(parseFloat(b[c].width));return a},l.prototype.getState=function(){return{totalHeaderWidth:this.getWidth(),headersWidth:this.getHeadersWidth()}},l.prototype.setState=function(a){this.outlineHeadersColGroup&&this.outlineHeadersColGroup.children.length==a.headersWidth.length&&this.setColumnWidths(a.headersWidth),this.setWidth(a.totalHeaderWidth)},l.prototype.length=function(){if(!this.outlineHeadersColGroup)return 1;var a=this.outlineHeadersColGroup.children;return a?a.length:1},l.prototype.setLevelWidth=function(a,b){var c=this.outlineHeadersColGroup.children;if(c&&!(c.length<a)){var d=parseFloat(b),e=parseFloat(this.getWidth()),f=parseFloat(c[a].width),g=f/100*e,h=d-g,i=e+h;this.setWidth(i+"px");var j=[];this.getHeadersWidth().forEach(function(b,c){if(c!=a){var f=b/100*e;j[c]=100*f/i}else j[c]=100*d/i}),this.setColumnWidths(j),this.notifyChanges()}},l.prototype._buildHeaderNode=function(){var a=e.create("div",{class:ionweb.tables.ROWHEADERHEADER_DIV_CLASS,role:"row"}),b=e.create("table",{role:"presentation",border:"0",cellspacing:"0",cellpadding:"0"});b.style.width="100%",a.appendChild(b);var c=e.create("tr",{height:"100%",class:"gridxRowHeaderHeaderFiller"});if(b.appendChild(c),this.onlyDragMode){var d={role:"rowheader",tabindex:"-1"};d.class="gridxRowHeaderCellRight"+(this._isHierarchical?" dashed-right-border":""),this.headerCellNode=e.create("td",d)}else if(this.outlineModeConfig){this.headerCellNode=e.create("td",{role:"rowheader",class:"gridxRowHeaderHeaderCell gridxSubHeader dashed-right-border",tabindex:"-1"});var f=this.headerCellNode.ownerDocument.createElement("div");f.setAttribute("class","gridxCellContainer"),this.headerCellNode.appendChild(f)}else{this.headerCellNode=e.create("td",{role:"rowheader",class:"gridxCell"+(this._isHierarchical?" dashed-right-border":""),tabindex:"-1",colid:ionweb.tables.toRowHeaderId(-1),rowHeaderColumn:"-1"});var g=this.rowAxis.options&&this.rowAxis.options.descriptor,h=g&&(g.alias||g.caption)||"",i=this.headerCellNode.ownerDocument.createElement("div");i.setAttribute("class","gridxSortNode ion-row-header-groups-column-cell"),i.innerHTML=h;var f=this.headerCellNode.ownerDocument.createElement("div");f.setAttribute("class","gridxCellContainer gridxCellContainerGroupsHeader"),f.appendChild(i),this.headerCellNode.appendChild(f)}if(c.appendChild(this.headerCellNode),!this.onlyDragMode&&this.outlineModeConfig){this.outlineHeadersColGroup=e.create("colgroup",{}),this.outlineHeadersRow=e.create("tr",{}),e.place(this.outlineHeadersColGroup,b,"first"),b.appendChild(this.outlineHeadersRow);var j=this.outlineModeConfig.rowLevelDescriptors.length-(this.outlineModeConfig.compact!==!1?1:0);j>0&&(this.headerCellNode.colSpan=j);var k=this.DEFAULT_HEADER_CELL_WIDTH*(this.outlineModeConfig.rowLevelDescriptors.length-(this.outlineModeConfig.compact!==!1?1:0)),l=[];this.contentNodes=[];for(var m=this.outlineModeConfig.compact!==!1?1:0;m<this.outlineModeConfig.rowLevelDescriptors.length;m++){l.push(100*this.DEFAULT_HEADER_CELL_WIDTH/k);var n=e.create("td",{role:"columnheader",tabindex:"-1",rowHeaderColumn:""+m,colid:ionweb.tables.toRowHeaderId(m),class:"gridxCell gridxMeasureHeader gridxSubHeader"});this.outlineHeadersRow.appendChild(n);var o=e.create("div",{tabindex:"-1",class:"gridxSortNode"});this.contentNodes.push(o),this.refreshLevelCaption(m);var f=n.ownerDocument.createElement("div");f.setAttribute("class","gridxCellContainer"),f.appendChild(o),n.appendChild(f)}this.setColumnWidths(l)}return a},l.prototype.refreshLevelCaption=function(a){if(this.outlineModeConfig){var b=a-(this.outlineModeConfig.compact!==!1?1:0);this.contentNodes&&this.contentNodes[b]&&(this.contentNodes[b].innerText=this.outlineModeConfig.rowLevelDescriptors[a].alias||this.outlineModeConfig.rowLevelDescriptors[a].caption)}},l.prototype.invalidateRowHeights=function(){this.rowHeightCache={},this.grid.body.refresh()},l.prototype.setColumnWidths=function(a){if(this.outlineHeadersColGroup&&this.outlineModeConfig){this.outlineHeadersColGroup.innerHTML="";for(var b=0;b<a.length;b++){var c=e.create("col",{width:a[b]+"%"});this.outlineHeadersColGroup.appendChild(c)}ionweb.tables.cloneInnerHtml(this.headerTableColGroup,this.outlineHeadersColGroup)}},l.prototype.setupOutlineHeaderResizers=function(){},l.prototype._onRenderRows=function(a,b,c){var d=this.tableNode;if(b>0){var f=this._buildRows(a,b);"top"==c?e.place(f,d,"first"):"bottom"==c?e.place(f,d,"last"):(e.place(f,d,"only"),d.scrollTop=0)}else"top"!=c&&"bottom"!=c&&(d.innerHTML="")},l.prototype.callOnAfterRow=function(a){this.isDestroyed||this._onAfterRow(a)},l.prototype._onAfterRow=function(a){this.updateCellsForRow(a)},l.prototype.updateCellsForRow=function(a,c){function d(a){for(var b=0;b<a.length;b++)if(0===a[b].indexOf("pivot-level"))return a[b]}var g=this;if(a){var h=a.visualIndex(),i=b('[visualindex="'+h+'"].gridxRowHeaderRow',this.tableNode)[0];if(i){var j=this.grid.dod?b('[visualindex="'+h+'"].gridxRow',this.grid.bodyNode)[0]:b('[visualindex="'+h+'"].gridxRow .gridxRowTable',this.grid.bodyNode)[0];c&&(j=this.grid.dod?b('[visualindex="0"].gridxRow',this.grid.bodyNode)[0]:b('[visualindex="0"].gridxRow .gridxRowTable',this.grid.bodyNode)[0]),i.setAttribute("rowid",a.id),i.setAttribute("rowindex",a.index()),i.setAttribute("parentid",this.grid.model.treePath(a.id).pop()||""),this.colorLevels(a,i);var k=this,l=a.item()[this.idProperty],m=this.rowAxis.options.getTreeNode(l),n=m.level(),o=m.key();if(i&&i.children)for(var p,q,r,s,t,u,s,v,w,x,y,z=function(c){var j=i.children[c];p=parseInt(j.getAttribute("rowHeaderColumn"));var l=m;if(A.outlineModeConfig)for(;n>p&&l.parent();)l=l.parent();if((n<=p||A.outlineModeConfig&&A.rowAxis.getFirstSlice(o)==h)&&f.add(j,"gridxRowHeaderCellTop"),p<=n&&p>0&&f.add(j,"gridxRowHeaderCellLeft"),j.setAttribute("nodekey",o),j.innerHTML="",q=A._generateHeaderCellContent(a,p),j.appendChild(q),j.onmouseenter=function(){if(g.grid.body.rowHoverEffect){var a=b('[nodeKey="'+o+'"]',g.bodyNode);a.forEach(function(a){return f.add(a,"cellHover")},null)}},j.onmouseleave=function(){var a=b('[nodeKey="'+l.key()+'"]',g.bodyNode);a.forEach(function(a){return f.remove(a,"cellHover")},null)},r=function(a,b){for(var c=-1,d=0;d<t;d++)if(s.children[d]==j){c=d;break}return c},n!=p||!k.outlineModeConfig||parseInt(q.style.top)>0){if(j.colSpan>1&&j.parentElement){j.colSpan=1,s=j.parentElement,v=s.children[s.children.length-1],w=d(v.classList),x=k.outlineModeConfig.rowLevelDescriptors.length-s.children.length-(k.outlineModeConfig.compact!==!1?1:0);for(var z=0;z<x;z++)y=e.create("td",{}),$(y).addClass(w),s.appendChild(y)}}else{j.colSpan=A.outlineModeConfig.rowLevelDescriptors.length-n,s=j.parentElement,t=s.children.length,u=r(s.children,j);for(var z=t-1;z>u;z--)s.removeChild(s.children[z])}},A=this,B=0;B<i.children.length;B++)z(B);i&&j&&this._syncRowHeight(i,j,c)}}},l.prototype.colorLevels=function(b,c){var d=this.grid.rowHeaderRowAxis&&this.grid.rowHeaderRowAxis.getAs(ionweb.tables.PivotAxis);if(d&&this._isHierarchical){var e=d.getNode(b.id);if(e){for(var g=0;g<=c.children.length;g++){var h=c.children[g];if(h){var i;i=this.outlineModeConfig&&this.outlineModeConfig.rowLevelDescriptors?this.outlineModeConfig&&this.outlineModeConfig.compact!==!1?d.options.isNodeSummaryVisible(d.options.getVisibleRoot().key())?e===d.options.getVisibleRoot()?"pivot-header-level-summary":g:e===d.options.getVisibleRoot()?"pivot-header-level-summary":g:0==g?"pivot-header-level-summary":g-1:d.options.isNodeSummaryVisible(d.options.getVisibleRoot().key())&&e===d.options.getVisibleRoot()?"pivot-header-level-summary":e.level()-1,"number"==typeof i&&(i="pivot-level-"+Math.min(i,a.PIVOT_HEADER_MAX_SHADE_LEVEL)),f.add(h,i.toString())}}if(!this._hasActionButton(b.id)){var h=c.children.length?c.children[c.children.length-1]:void 0;h&&!f.contains(h,"pivot-header-level-summary")&&(e.parent()&&e.parent().parent()?f.add(h,"pivot-level-leaf"):f.add(h,"pivot-header-level-0"))}}}},l.prototype._onAfterCell=function(a,c){var d=this;if(!a.__justTextContentChanged){var e=function(a,c){var e=b('[visualindex="'+a+'"].gridxRowHeaderRow',d.tableNode)[0];c||(c=b('[visualindex="'+a+'"].gridxRow .gridxRowTable',d.grid.bodyNode)[0]),d._syncRowHeight(e,c)},f=a.row.visualIndex();this._rowToUpdates[f]=c,this._fetchDataAndSyncTimeout||(this._fetchDataAndSyncTimeout=setTimeout(function(){Object.keys(d._rowToUpdates).forEach(function(a){e(a,d._rowToUpdates[a])}),d._rowToUpdates={},d._fetchDataAndSyncTimeout=null},0))}},l.prototype._syncRowHeight=function(a,c,d){var e=this;if(void 0===this._isCollapse){var f=b(".gridxCell",this.grid.header.innerNode)[0];this._isCollapse=f&&"collapse"==g.get(f,"borderCollapse")}var h=function(){if(e._isCollapse)return c.offsetHeight+"px";var a=c&&g.getComputedStyle(c).height;return parseInt(a)?a:null},i=function(){if(!e.isDestroyed&&a&&a.firstChild){var b=null,c=a.getAttribute("rowid"),d=void 0;e.dynamicRowHeight?b||(b=h()):(d=e.rowHeightCache[c],b=d?d:h()),!b||e.dynamicRowHeight||d||(e.rowHeightCache[c]=b),b||(b=e.defaultRowHeight),a.style.height=a.firstChild.style.height=b,e.defaultRowHeight=b}};d?i():setTimeout(function(){i()},0)},l.prototype._onRendered=function(a,b){var c=this.arg("headerProvider");c&&(this.headerCellNode.innerHTML=c()),this._onScroll()},l.prototype._onSizeChange=function(a,b){var c=this.arg("headerProvider");!a&&c&&(this.headerCellNode.innerHTML=""),this._onScroll()},l.prototype._findRowById=function(a){for(var b=this.tableNode.children.length,c=b-1;c>=0;c--){var d=this.tableNode.children[c];if(d.getAttribute("rowid")===a&&d.classList.contains("gridxRowHeaderRow"))return d}return null},l.prototype._onDelete=function(a){var b=this.model.isId(a)&&this._findRowById(this.grid._escapeId(a));if(b){var c,d,e=b.getAttribute("parentid"),f={},g=1;for(f[a]=1,c=b.nextSibling;c&&f[c.getAttribute("parentid")];c=c.nextSibling)d=c.getAttribute("rowid"),g++,f[d]=1;for(;c;c=c.nextSibling){c.getAttribute("parentid")==e&&c.setAttribute("rowindex",parseInt(c.getAttribute("rowindex"),10)-1);var h=parseInt(c.getAttribute("visualindex"),10);c.setAttribute("visualindex",h-g)}}},l.prototype._onUnrender=function(a,b,c){if(a?delete this.movedRows[a]:this.movedRows={},a&&!this.dynamicRowHeight&&delete this.rowHeightCache[a],!this.model.isId(a)&&c)"post"===c?this.tableNode.lastChild&&e.destroy(this.tableNode.lastChild):this.tableNode.firstChild&&e.destroy(this.tableNode.firstChild);else if("refresh"!=b){var d=this.model.isId(a)&&this._findRowById(this.grid._escapeId(a));d&&e.destroy(d)}},l.prototype._onScroll=function(){var a=this;this.grid._isLoaded&&(this.bodyNode.scrollTop=this.grid.bodyNode.scrollTop,this.bodyNode.scrollHeight-this.bodyNode.clientHeight>=this.grid.bodyNode.scrollTop?(this.bodyNode.scrollTop=this.grid.bodyNode.scrollTop,this.outlineModeConfig&&this.checkFirstRow()):setTimeout(function(){a.isDestroyed||(a.bodyNode.scrollTop=a.grid.bodyNode.scrollTop,a.outlineModeConfig&&a.checkFirstRow())},0))},l.prototype.checkFirstRow=function(){var a=this,b=this.firstVisibleRow;this.firstVisibleRow=0,this.firstRowOffset=0;for(var c=0;c<this.bodyNode.scrollTop;)this.firstRowOffset=this.bodyNode.scrollTop-c,c+=this.getRowHeight(this.firstVisibleRow),c<this.bodyNode.scrollTop&&this.firstVisibleRow++;var d={};if(this.tableNode.children.length>0){var e=parseInt(this.tableNode.children[this.firstVisibleRow].getAttribute("visualIndex"));this.firstVisibleRow=e;var f=this.grid.row(this.firstVisibleRow);f&&(this._onAfterRow(f),d[f.id]=!0);var g=!1;this.firstVisibleRow!=b&&(f=this.grid.row(b),f&&(this._onAfterRow(f),d[f.id]=!0),this.firstVisibleRow+1===b&&(g=!0)),g||0!==this.firstVisibleRow||this.outlineModeConfig.compact!==!0||(f=this.grid.row(this.firstVisibleRow+1),f&&(this._onAfterRow(f),d[f.id]=!0))}Object.keys(this.movedRows).forEach(function(b){if(!d[b]){var c=a.grid.row(b);a._onAfterRow(c)}})},l.prototype.getRowHeight=function(a){return this.tableNode.children[a].getBoundingClientRect().height},l.prototype._onResize=function(){if(this.grid._isLoaded){for(var a,b=this.grid.bodyNode.firstElementChild,c=this.tableNode.firstElementChild;b&&c;b=b.nextElementSibling,c=c.nextElementSibling){a=this.grid.dod?b:b.firstElementChild;var d="0px"!==g.getComputedStyle(a).height?g.getComputedStyle(a).height:this.defaultRowHeight;c.firstChild&&(c.style.height=c.firstChild.style.height=d)}a=this.bodyNode;var e=this.grid,f=a.offsetWidth||g.get(a,"width"),i=e.isLeftToRight(),j=h.getBorderExtents(e.mainNode);a.style[i?"left":"right"]=-(f+(i?j.l:j.r))+"px"}},l.prototype._buildRows=function(a,b){for(var c=[],d=0;d<b;++d){c.push('<tr style="height: '+this.defaultRowHeight+'" visualindex="',a+d,'" class="gridxRowHeaderRow" role="row" draggable="true">');var e=1,f=0;!this.onlyDragMode&&this.outlineModeConfig&&(e=this.outlineModeConfig.rowLevelDescriptors.length,this.outlineModeConfig.compact!==!1&&(f=e>1?1:0));for(var g=f;g<e;g++)c.push('<td class="gridxRowHeaderCell" role="rowheader" tabindex="-1" rowHeaderColumn="'+g+'" ></td>');c.push("</tr>")}return c.join("")},l.prototype._onHeaderMouseEvent=function(a,b){var c=this.grid,d="onRowHeaderHeader"+a;c._isConnected(d)&&c[d](b)},l.prototype._onBodyMouseEvent=function(a,b){var c=this.grid,d="onRowHeaderCell"+a,e="onRow"+a,f=c._isConnected(d),g=c._isConnected(e);(f||g)&&(this._decorateBodyEvent(b),b.rowIndex>=0&&(b.isRowHeader&&f&&c[d](b),g&&c[e](b)))},l.prototype._decorateBodyEvent=function(a){for(var b=a.target||a.originalTarget;b&&b!=this.bodyNode;){if(f.contains(b,"gridxRowHeaderCell"))a.isRowHeader=!0,a.rowHeaderCellNode=b;else if(f.contains(b,"gridxRowHeaderRow"))return a.rowId=b.getAttribute("rowid"),a.parentId=b.getAttribute("parentid"),a.rowIndex=parseInt(b.getAttribute("rowindex"),10),void(a.visualIndex=parseInt(b.getAttribute("visualindex"),10));b=b.parentNode}},l.prototype._onRowMouseOver=function(a){var b=this._findRowById(this.grid._escapeId(a.rowId));b&&f.toggle(b,"gridxRowOver","mouseover"==a.type.toLowerCase()&&this.grid.body.rowHoverEffect)},l.prototype._onCellMouseOver=function(a){var c=b('> [rowid="'+this.grid._escapeId(a.rowId)+'"].gridxRowHeaderRow .gridxRowHeaderCell',this.tableNode)[0];c&&f.toggle(c,"gridxRowHeaderCellOver","mouseover"==a.type.toLowerCase()&&this.grid.body.rowHoverEffect)},l.prototype._initFocus=function(){var a=this.grid.focus;a&&a.registerArea({name:"rowHeader",priority:.9,focusNode:this.bodyNode,scope:this,doFocus:this._doFocus,onFocus:this._onFocus,doBlur:this._blur,onBlur:this._blur,connects:[this.connect(this.bodyNode,"onkeydown","_onKeyDown")]})},l.prototype._doFocus=function(a){var b;return b=!l.SUPPORT_FOCUS||this._focusRow(this.grid.body._focusCellRow),b&&this.grid.focus.stopEvent(a),b},l.prototype._onFocus=function(a){if(!l.SUPPORT_FOCUS)return!1;for(var b=a.target;b!=this.tableNode;){if(f.contains(b,"gridxRowHeaderRow")){var c=this.grid.body._focusCellRow=parseInt(b.getAttribute("visualindex"),10);return this._focusRow(c),this._onScroll(),!0}b=b.parentNode}return!1},l.prototype._focusRow=function(a){var c=b('[visualindex="'+a+'"] .gridxRowHeaderCell',this.tableNode)[0];return this._blur(),c=c||this.tableNode.firstChild,c&&(f.add(c,"gridxCellFocus"),c.focus()),c},l.prototype._blur=function(){return l.SUPPORT_FOCUS&&b(".gridxCellFocus",this.tableNode).forEach(function(a){f.remove(a,"gridxCellFocus")},null),!0},l.prototype._onKeyDown=function(a){var b=this;if(l.SUPPORT_FOCUS){var c=this.grid;if(!this._busy&&"rowHeader"==c.focus.currentArea())if(a.keyCode==i.UP_ARROW||a.keyCode==i.DOWN_ARROW){c.focus.stopEvent(a);var d=a.keyCode==i.UP_ARROW?-1:1,e=c.body,f=e._focusCellRow+d;e._focusCellRow=f=f<0?0:f>=c.view.visualCount?c.view.visualCount-1:f,this._busy=!0,c.vScroller.scrollToRow(f).then(function(){b._focusRow(f),b._busy=!1,b.onMoveToRowHeaderCell(f,a)})}else if(a.keyCode==i.SPACE||a.keyCode==i.RIGHT_ARROW||a.keyCode==i.LEFT_ARROW){var g=$(a.rowHeaderCellNode).find("a.expandButton");g&&(a.keyCode==i.SPACE||a.keyCode==i.RIGHT_ARROW&&g.hasClass("ionicon-expand")||a.keyCode==i.LEFT_ARROW&&g.hasClass("ionicon-collapse"))&&g.click()}}},l.prototype._getExpandoWidth=function(){if(this.cachedExpandoWidth<0){var a=this._getActionButton();if(!a)return 0;var b=document.createElement("div");b.appendChild(a),document.body.appendChild(b);var c=b.firstElementChild,d=window.getComputedStyle(c,null);this.cachedExpandoWidth=parseInt(d.width)+ionweb.tables.getAdditionalSpace(c),document.body.removeChild(b)}return this.cachedExpandoWidth},l.prototype._getActionButton=function(a){var b=this,c=a?this.rowAxis.options.getExpandState(a):null;if(0!==(c&ExpandState.SwitchInProgress)){var d=document.createElement("div");return d.className="loader",d}var e="ionicon-expand",f=!0;0!=(c&ExpandState.Expanded)&&(f=!1,e="ionicon-collapse");var g=document.createElement("a");return g.className="expandButton ionicon "+e,g.onmousedown=function(a){return a.stopPropagation()},a&&g.addEventListener("click",function(c){c.stopPropagation(),b.rowAxis.options.requestExpandState(a,f)},!0),g},l.prototype._getRowHeaderPadding=function(a){if(this.outlineModeConfig)return l.MIN_HEADER_PADDING;var b=this.rowAxis.options.getTreeNode(a),c=0;if(b)for(;b.parent();)b=b.parent(),this.rowAxis.options.isLevelSummaryVisible(b.level())&&c++;return c*this._getExpandoWidth()+l.MIN_HEADER_PADDING},l.prototype._hasActionButton=function(a){if(this.outlineModeConfig){var b=this.rowAxis.options.getTreeNode(a).level(),c=this.outlineModeConfig.rowLevelDescriptors[b];if(c&&c.hideBrowserControl)return!1}var d=this.rowAxis.options.getExpandState(a);return d!=ExpandState.None},l.prototype._getDisplayValue=function(a){if(this.showLeavesCounter){var b=a.leavesCount;if(b)return a.displayName()+" ("+b+")"}return a.displayName()},l.prototype._generateHeaderCellContent=function(a,b){var c=this,d=document.createElement("div");if(this.onlyDragMode)return d.classList.add("ionicon"),d.classList.add("ionicon-dragHandler"),d;for(var e=a.item()[this.idProperty],f=this.rowAxis.options.getTreeNode(e),g=f;g.level()>b;)g=g.parent();var h;this.outlineModeConfig&&(h=this.rowAxis.getFirstSlice(g.key()));var i;if(f){var j,k=f.key(),l=function(){d.style.position="relative",d.style.top=c.firstRowOffset+"px",d.style.overflowY="visible",d.style.zIndex="10",c.movedRows[e]=!0};if(!this.outlineModeConfig||f.level()===b||this.outlineModeConfig.compact!==!1&&0===f.level()&&1===b)j=this._getDisplayValue(f),this._hasActionButton(k)&&(i=this._getActionButton(k)),!this.outlineModeConfig||a.visualIndex()!==this.firstVisibleRow||this.rowAxis.lastSliceIndex(f.key())===this.firstVisibleRow||this.outlineModeConfig.compact!==!1&&0==f.level()||l();else if(!(this.outlineModeConfig&&f.level()>b)||a.visualIndex()!==this.firstVisibleRow&&a.visualIndex()!==h||this.rowAxis.options.forceHideOfChildlessSummaries&&!this.rowAxis.options.isLevelSummaryVisible(g.level()))j="";else{j=this._getDisplayValue(g),this._hasActionButton(g.key())&&(i=this._getActionButton(g.key()));var m=this.rowAxis.lastSliceIndex(g.key());if(m!==this.firstVisibleRow&&h<=this.firstVisibleRow){var n=this.rowAxis.getFirstSlice(g.key());m!==n&&l()}}d.style.overflow="hidden",d.style.whiteSpace="nowrap",d.style.textAlign="left",d.style.marginLeft=this._getRowHeaderPadding(k)+"px",i&&d.appendChild(i);var o=document.createElement("div");o.style.display="inline-block",o.innerHTML=j,d.appendChild(o)}return d},l.prototype.fitHeader=function(a,b){this.outlineModeConfig?this.fitOutlineHeader(a,b):this.fitNormalHeader(b)},l.prototype.fitOutlineHeader=function(a,c){var d=this,e=[],f=this.rowAxis.options.getVisibleRoot();f.visitTree(function(b){b.level()===a&&e.push(b)},ionweb.tables.TreeVisitMode.PostOrder,function(b){return b.level()<=a});var g=b("[rowHeaderColumn = "+a+"]",this.outlineHeadersRow)[0];if(g){var h=0;c||(h=ionweb.tables.getMaxWidth(g,[g.innerText])),h=Math.max(h,ionweb.tables.getMaxWidth(g,e.map(function(a){return d._getDisplayValue(a)}),e.map(function(a){return d._getRowHeaderPadding(a.key())+(d._hasActionButton(a.key())?d._getExpandoWidth():0)}))),this.outlineModeConfig.compact!==!1&&a--,this.setLevelWidth(a,5+h+"px")}},l.prototype.fitNormalHeader=function(a){var c=this,d=this.rowAxis.getSliceRange(0,this.rowAxis.length()),e=b("tr",this.bodyNode)[0],f=ionweb.tables.getMaxWidth(e,d.map(function(a){return c._getDisplayValue(a)}),d.map(function(a){return c._getRowHeaderPadding(a.key())+(c._hasActionButton(a.key())?c._getExpandoWidth():0)}));if(!a){var g=b(".gridxCellContainerGroupsHeader .gridxSortNode",this.headerNode);g&&g.length&&(f=Math.max(f,ionweb.tables.getMaxWidth(g[0],[g[0].innerText])))}this.setWidth(5+f+"px")},l.MIN_HEADER_PADDING=4,l.SUPPORT_FOCUS=!1,l}();a.registerModule("ion/RowHeader",["dojo/_base/declare","gridx/support/query","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/keys","gridx/core/Row","gridx/core/_Module"],function(a,k,m,n,o,p,q,r,s,t,u){return b=k,c=m,d=n,e=o,f=p,g=q,h=r,i=s,j=t,a(u,l.prototype)})}(gridx||(gridx={}));var ionweb;!function(a){var b;!function(a){var b=function(){function b(c,d,e){var f=this;this.logger=c,this.data=d;var g=a.getInstanceId();this.logId=e&&e.logId?e.logId+"_"+g:g,this.rowCollectionEventsLogger=new a.CollectionEventsLogger(c,this.logId,a.LogKeys.GridEvents.RowEventBurst),this.columnCollectionEventsLogger=new a.CollectionEventsLogger(c,this.logId,a.LogKeys.GridEvents.ColumnEventBurst),this.rowCollectionEventsLogger.begin(),this.columnCollectionEventsLogger.begin(),this.unsub=[this.data.getColumnAxis().options.slicesEvent.add(function(a,c){b.logSliceEvents(c,f.columnCollectionEventsLogger)}),this.data.getRowAxis().options.slicesEvent.add(function(a,c){b.logSliceEvents(c,f.rowCollectionEventsLogger)})]}return b.logSliceEvents=function(b,c){b.forEach(function(b){switch(b.type){case a.SliceEventType.SliceAdded:b.args.keys.forEach(function(a){var d=function(){return{ItemPos:b.args.target}};c.add(a,d)});break;case a.SliceEventType.SliceRemoved:b.args.keys.forEach(function(a){c.remove(a)});break;case a.SliceEventType.SliceMoved:b.args.keys.forEach(function(a){var d=function(){return{start:b.args.start,target:b.args.target}};c.move(a,d)});break;case a.SliceEventType.Reset:}})},b.prototype.dumpIds=function(){if(this.data&&"function"==typeof this.data.dumpLogId){var b=this.data.dumpLogId("");this.logger.low(a.LogKeys.GridEvents.DumpIds,{Id:this.logId,SourceDataModel:this.data.getLogId(),IDs:b})}},b.prototype.dumpDispose=function(){this.logger.low(a.LogKeys.GridEvents.Disposed,{Id:this.logId})},b.prototype.dispose=function(){this.unsub.forEach(function(a){return a()})},b.prototype.doLoggingForSelectionChange=function(b){function c(b){var c=[];switch(b.type){case a.GridRangeType.Cell:var d={};b.args.forEach(function(a){d[a.columnKey]=!0}),c=Object.getOwnPropertyNames(d)}return c.length}function d(b){var c=[];switch(b.type){case a.GridRangeType.Cell:var d={};b.args.forEach(function(a){d[a.rowKey]=!0}),c=Object.getOwnPropertyNames(d)}return c.length}var e=this,f=function(){var f;switch(b.type){case a.GridRangeType.Cell:f=a.LogKeys.GridEvents.CurrentCell+"["+b.args.map(function(a){return"("+a.rowKey+","+a.columnKey+")"}).join(",")+"], "+a.LogKeys.GridEvents.Ranges+" [1],"+a.LogKeys.GridEvents.PartRows+"["+d(b)+"],"+a.LogKeys.GridEvents.PartCols+"["+c(b)+"]";break;case a.GridRangeType.Row:f=a.LogKeys.GridEvents.Ranges+" [2], "+a.LogKeys.GridEvents.FullRows+"["+b.args.length+"]";break;case a.GridRangeType.Column:f=a.LogKeys.GridEvents.Ranges+" [3],"+a.LogKeys.GridEvents.FullCols+"["+b.args.length+"]";break;case a.GridRangeType.Table:f=a.LogKeys.GridEvents.Ranges+" [4], "+a.LogKeys.Selection.FullTableSelection;break;default:f=a.LogKeys.GridEvents.Ranges+" [0], "+a.LogKeys.Selection.NoSelection}return{key:a.LogKeys.Selection.Key,params:{Id:e.logId,SourceDataModel:e.data.getLogId(),Action:a.LogKeys.Selection.OnSelectionChanged,CurrentSelection:f}}};this.logger.ifLow(f)},b.prototype.logTouchEnd=function(b){this.logger.low(a.LogKeys.Mouse.TouchEnd,{Id:this.logId,SourceDataModel:this.data.getLogId(),LongTouchInterval:b})},b.prototype.logTouchStart=function(){this.logger.low(a.LogKeys.Mouse.TouchStart,{Id:this.logId,SourceDataModel:this.data.getLogId()})},b.prototype.logClick=function(b,c,d){var e="unknown";b.cellNode?e=a.LogKeys.GridEvents.Cell+",R:"+b.rowId+",C:"+b.columnId:b.headerCellNode?e=a.LogKeys.GridEvents.ColumnHeader+",R:"+b.rowId+",C:"+b.columnId:b.rowHeaderCellNode&&(e=a.LogKeys.GridEvents.RowHeader+",R:"+b.rowId+",C:"+b.columnId),this.logger.low(a.LogKeys.Mouse.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),Action:a.LogKeys.Mouse.Click,HitTest:e,ClickProcessedBySdk:c,CellClickSubscribedByApplication:d})},b.prototype.logCellClick=function(b){var c="unknown";b.cellNode?c=a.LogKeys.GridEvents.Cell+",R:"+b.rowId+",C:"+b.columnId:b.headerCellNode?c=a.LogKeys.GridEvents.ColumnHeader+",R:"+b.rowId+",C:"+b.columnId:b.rowHeaderCellNode&&(c=a.LogKeys.GridEvents.RowHeader+",R:"+b.rowId+",C:"+b.columnId),this.logger.low(a.LogKeys.Mouse.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),Action:a.LogKeys.Mouse.Click,HitTest:c})},b.prototype.logCellDblClick=function(b){var c="unknown";b.cellNode?c=a.LogKeys.GridEvents.Cell+",R:"+b.rowId+",C:"+b.columnId:b.headerCellNode?c=a.LogKeys.GridEvents.ColumnHeader+",R:"+b.rowId+",C:"+b.columnId:b.rowHeaderCellNode&&(c=a.LogKeys.GridEvents.RowHeader+",R:"+b.rowId+",C:"+b.columnId),this.logger.low(a.LogKeys.Mouse.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),Action:a.LogKeys.Mouse.DoubleClick,HitTest:c})},b.prototype.connectClickEvents=function(b){var c=this;b.connect(b,a.LogKeys.GridEvents.onRowHeaderCellClick,function(a){c.logCellClick(a)}),b.connect(b,a.LogKeys.GridEvents.onHeaderCellClick,function(a){c.logCellClick(a)}),b.connect(b,a.LogKeys.GridEvents.onCellDblClick,function(a){c.logCellDblClick(a)}),b.connect(b,a.LogKeys.GridEvents.onRowHeaderCellDblClick,function(a){c.logCellDblClick(a)}),b.connect(b,a.LogKeys.GridEvents.onHeaderCellDblClick,function(a){c.logCellDblClick(a)})},b.prototype.logCopyToClipboard=function(b,c){var d={Id:this.logId,SourceDataModel:this.data.getLogId(),Format:a.LogKeys.Clipboard.Text,Selection:a.LogKeys.Clipboard.Copy+a.GridRangeType[b.type],Options:c};this.logger.low(a.LogKeys.Clipboard.CopyToClipboard,d)},b.prototype.logExportToCsv=function(b){var c=this;this.logger.ifLow(function(){return{key:a.LogKeys.Exporting.Key,params:{Id:c.logId,SourceDataModel:c.data.getLogId(),Action:a.LogKeys.Exporting.ExportingToFile,Format:a.LogKeys.Exporting.CSV,Selection:a.LogKeys.Exporting.Export+a.GridRangeType[b.type],FileName:"exportedData.csv"}}})},b.prototype.logSliceManagerMove=function(b,c){var d=this;this.logger.ifLow(function(){return{key:a.LogKeys.ColumnDef.ColumnMove,params:{Id:d.logId,SourceDataModel:d.data.getLogId(),Action:a.LogKeys.ColumnDef.ColumnMoved,ColumnKey:b.join(", "),ColumnVisible:c.join(", ")}}})},b.prototype.logOptionsDialogVisibleColumnsMove=function(b,c,d){var e=this;this.logger.ifMedium(function(){return{key:a.LogKeys.OptionsDialog.Key,params:{Id:e.logId,SourceDataModel:e.data.getLogId(),Action:a.LogKeys.OptionsDialog.VisColMove,MovedKeys:b.join(", "),CurrentVisKeys:c.map(function(a){return a.descriptor.id}).join(", "),Destination:d}}})},b.prototype.logOptionsDialogVisibleColumnsHide=function(b,c){var d=this;this.logger.ifMedium(function(){return{key:a.LogKeys.OptionsDialog.Key,params:{Id:d.logId,SourceDataModel:d.data.getLogId(),Action:a.LogKeys.OptionsDialog.VisColHide,HiddenKeys:b.join(", "),CurrentVisKeys:c.map(function(a){return a.descriptor.id}).join(", ")}}})},b.prototype.logOptionsDialogVisibleColumnsShow=function(b,c,d){var e=this;this.logger.ifMedium(function(){return{key:a.LogKeys.OptionsDialog.Key,params:{Id:e.logId,SourceDataModel:e.data.getLogId(),Action:a.LogKeys.OptionsDialog.VisColShow,ShownKeys:b.join(", "),CurrentVisKeys:c.map(function(a){return a.descriptor.id}).join(", "),Destination:d}}})},b.prototype.logAskToggleSorting=function(b,c){this.logger.low(a.LogKeys.Sorting.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),Action:"AskingTogglingUserConfirmation",ItemKey:b,MultiSorting:c})},b.prototype.logToggleSorting=function(b,c){this.logger.low(a.LogKeys.Sorting.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),Action:"Toggling",ItemKey:b,MultiSorting:c})},b.prototype.logToggleCanceled=function(b,c){this.logger.low(a.LogKeys.Sorting.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),Action:"TogglingUserConfirmationCancelled",ItemKey:b,MultiSorting:c})},b.prototype.logSortBeginConfiguration=function(b){this.logger.low(a.LogKeys.Sorting.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),AxisType:b==a.AxisType.Row?a.LogKeys.Sorting.AxisTypeRow:a.LogKeys.Sorting.AxisTypeColumn,Action:a.LogKeys.Sorting.ActionBeginTraceConfiguration})},b.prototype.logSortConfigurationItem=function(b,c,d,e){this.logger.low(a.LogKeys.Sorting.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),AxisType:b==a.AxisType.Row?a.LogKeys.Sorting.AxisTypeRow:a.LogKeys.Sorting.AxisTypeColumn,Action:a.LogKeys.Sorting.ActionTracingConfiguration,ColKey:c,IsAscending:d?"True":"False",SortType:e})},b.prototype.logSortEndConfiguration=function(b){this.logger.low(a.LogKeys.Sorting.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),AxisType:b==a.AxisType.Row?a.LogKeys.Sorting.AxisTypeRow:a.LogKeys.Sorting.AxisTypeColumn,Action:a.LogKeys.Sorting.ActionEndTraceConfiguration})},b.prototype.logSortSkipInformationToUI=function(b){this.logger.low(a.LogKeys.Sorting.Key,{HiddenSortCriterion:b})},b.prototype.logSortToggleBegin=function(b,c){this.logger.low(a.LogKeys.Sorting.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),AxisType:b==a.AxisType.Row?a.LogKeys.Sorting.AxisTypeRow:a.LogKeys.Sorting.AxisTypeColumn,Action:a.LogKeys.Sorting.ActionTogglingStart,ItemKey:c})},b.prototype.logSortAdded=function(b,c,d,e,f){this.logger.low(a.LogKeys.Sorting.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),AxisType:b==a.AxisType.Row?a.LogKeys.Sorting.AxisTypeRow:a.LogKeys.Sorting.AxisTypeColumn,
Action:b==a.AxisType.Row?a.LogKeys.Sorting.AddingColumn:a.LogKeys.Sorting.AddingHeaderLevel,ColKey:c,MultiSorting:d,IsAscending:e?"True":"False",SortType:f})},b.prototype.logSortSkip=function(b,c,d){this.logger.low(a.LogKeys.Sorting.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),AxisType:b==a.AxisType.Row?a.LogKeys.Sorting.AxisTypeRow:a.LogKeys.Sorting.AxisTypeColumn,Action:b==a.AxisType.Row?a.LogKeys.Sorting.SkippingColumn:a.LogKeys.Sorting.SkippingHeaderLevel,ColKey:c,MultiSorting:d})},b.prototype.logGroupKeyToSortingKey=function(b,c,d){this.logger.low(a.LogKeys.Sorting.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),AxisType:b==a.AxisType.Row?a.LogKeys.Sorting.AxisTypeRow:a.LogKeys.Sorting.AxisTypeColumn,Action:b==a.AxisType.Row?a.LogKeys.Sorting.SkippingColumn:a.LogKeys.Sorting.SkippingHeaderLevel,GroupKey:c,SortingKey:d})},b.prototype.logSortRemove=function(b,c){this.logger.low(a.LogKeys.Sorting.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),AxisType:b==a.AxisType.Row?a.LogKeys.Sorting.AxisTypeRow:a.LogKeys.Sorting.AxisTypeColumn,ColKey:c,Action:b==a.AxisType.Row?a.LogKeys.Sorting.RemoveColumn:a.LogKeys.Sorting.RemoveHeaderLevel})},b.prototype.logSortReset=function(b){this.logger.low(a.LogKeys.Sorting.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),AxisType:b==a.AxisType.Row?a.LogKeys.Sorting.AxisTypeRow:a.LogKeys.Sorting.AxisTypeColumn,Action:a.LogKeys.Sorting.ResetAllSorting})},b.prototype.logDelayInit=function(){this.logger.low(a.LogKeys.GridEvents.DelayInit,{Id:this.logId,SourceDataModel:this.data.getLogId()})},b.prototype.logDelayInitDone=function(b){this.logger.low(a.LogKeys.GridEvents.ReInit,{Id:this.logId,SourceDataModel:this.data.getLogId(),newHeight:b})},b.editorToString=function(a){return a.getDisplayName()},b.editEditStartReasonToString=function(b){var c=null;switch(b){case a.EditStartReason.Click:c=a.LogKeys.Editing.ReasonClick;break;case a.EditStartReason.F2:c=a.LogKeys.Editing.ReasonF2;break;case a.EditStartReason.Api:c=a.LogKeys.Editing.ReasonApi;break;case a.EditStartReason.AutoStart:c=a.LogKeys.Editing.ReasonAutoStart;break;case a.EditStartReason.None:default:c=a.LogKeys.Editing.ReasonNone}return c},b.editCompleteReasonToString=function(b){var c=null;switch(b){case a.EditCompleteReason.Blur:c=a.LogKeys.Editing.ReasonBlur;break;case a.EditCompleteReason.Enter:c=a.LogKeys.Editing.ReasonEnter;break;case a.EditCompleteReason.Esc:c=a.LogKeys.Editing.ReasonEsc;break;case a.EditCompleteReason.Tab:c=a.LogKeys.Editing.ReasonTab;break;case a.EditCompleteReason.Api:c=a.LogKeys.Editing.ReasonApi;break;case a.EditCompleteReason.None:c=a.LogKeys.Editing.ReasonNone;break;case a.EditCompleteReason.EditStarting:c=a.LogKeys.Editing.EditStarting;break;case a.EditCompleteReason.ControllerNotInitialized:c=a.LogKeys.Editing.ControllerNotInitialized;break;case a.EditCompleteReason.RowRender:c=a.LogKeys.Editing.RowRender;break;case a.EditCompleteReason.RowUnrender:c=a.LogKeys.Editing.RowUnrender;break;default:c=a.LogKeys.Editing.ReasonOther+"("+b+")"}return c},b.prototype.logExecuteDeferStartEdit=function(c,d,e,f){var g=b.editEditStartReasonToString(f),h=b.editorToString(c);this.logger.low(a.LogKeys.Editing.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),RowKey:d,ColKey:e,Action:a.LogKeys.Editing.ExecuteDeferStartEdit,Reason:g,Editor:h})},b.prototype.logTimeoutDeferStartEdit=function(c,d,e,f){var g=b.editEditStartReasonToString(f),h=b.editorToString(c);this.logger.low(a.LogKeys.Editing.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),RowKey:d,ColKey:e,Action:a.LogKeys.Editing.TimeoutDeferStartEdit,Reason:g,Editor:h})},b.prototype.logCancelDeferStartEdit=function(c,d,e,f){var g=b.editEditStartReasonToString(f),h=b.editorToString(c);this.logger.low(a.LogKeys.Editing.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),RowKey:d,ColKey:e,Action:a.LogKeys.Editing.CancelDeferStartEdit,Reason:g,Editor:h})},b.prototype.logDeferStartEdit=function(c,d,e,f,g,h){var i=b.editEditStartReasonToString(h),j=b.editorToString(c);this.logger.low(a.LogKeys.Editing.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),RowKey:d,ColKey:e,EditingRowKey:f,EditingColKey:g,Action:a.LogKeys.Editing.DeferStartEdit,Reason:i,Editor:j})},b.prototype.logStartEdit=function(c,d,e,f){var g=b.editEditStartReasonToString(f),h=b.editorToString(c);this.logger.low(a.LogKeys.Editing.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),RowKey:d,ColKey:e,Action:a.LogKeys.Editing.StartEdit,Reason:g,Editor:h})},b.prototype.logEndEdit=function(c,d,e,f,g){var h=b.editCompleteReasonToString(e);this.logger.low(a.LogKeys.Editing.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),RowKey:c,ColKey:d,Action:a.LogKeys.Editing.EndEdit,Reason:h,EnteredValue:f,IsEnteredValueUndefined:"undefined"==typeof f,AutoStartPref:g})},b.prototype.logPaste=function(b,c){var d=b[0],e=c.replace(/\t/g,",").replace(/\r\n/g,";"),f=e.length;f>100&&(e=e.substr(0,100)+"...(tot size: "+f+")"),this.logger.low(a.LogKeys.Editing.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),RowKey:d.rowKey,ColKey:d.columnKey,SelectedCellsCount:b.length,Action:a.LogKeys.Editing.Paste,EnteredValue:e})},b.prototype.logPasteFailed=function(b){this.logger.low(a.LogKeys.Editing.Key,{Id:this.logId,SourceDataModel:this.data.getLogId(),Action:a.LogKeys.Editing.PasteFailed,Error:b})},b}();a.GridLogger=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(b,c,d){var e=this;this.data=b,this.gridLogger=c,this.options=d;var f=b.getColumnAxis(),g=b.getRowAxis();this.unsub=[f.options.slicesEvent.add(function(a,b){return e.handleColumnRemoval(b,f)}),g.options.slicesEvent.add(function(a,b){return e.handleRowRemoval(b,g)})],this.onSelectionChange=new a.Event}return c.prototype.cleanup=function(){isNaN(this.timeoutId)||(clearTimeout(this.timeoutId),this.timeoutId=null)},c.prototype.dispose=function(){this.onSelectionChange=null,this.cleanup()},c.prototype.onInitGrid=function(a,b){var c=this;this.cleanup(),this.gridLogger=a,this.options=b;var d=this.data.getColumnAxis(),e=this.data.getRowAxis();this.unsub=[d.options.slicesEvent.add(function(a,b){return c.handleColumnRemoval(b,d)}),e.options.slicesEvent.add(function(a,b){return c.handleRowRemoval(b,e)})]},c.prototype.init=function(a){if(this.grid&&this.options.gridSelectionType!==b.GridSelectionType.None){var c=this.getGridSelection();this.grid=a,c&&this.setGridSelection(c)}else this.grid=a,this._lastSelection=null;this.options.gridSelectionType!==b.GridSelectionType.None&&this.connectEvents()},c.prototype.reset=function(){this.setGridSelection(b.SelectionHelper.noSelection(this.data))},c.prototype.convertToIonCellSelection=function(a){var b=[];return a&&a.forEach(function(a,c){return b[c]={rowKey:a[0],columnKey:a[1],colKey:a[1]}}),b},c.prototype.getGridSelection=function(){if(!this.grid||!this.grid.select)return b.SelectionHelper.noSelection(this.data);if(this.grid.select.table&&this.grid.select.table.isSelected())return b.SelectionHelper.tableSelection(this.data);if(this.grid.select.cell){var a=this.grid.select.cell.getSelected();if(a&&a.length>0)return b.SelectionHelper.cellsSelection(this.data,this.convertToIonCellSelection(a),this.currentActiveCell())}if(this.grid.select.row){var c=this.grid.select.row.getSelected();if(c&&c.length>0)return b.SelectionHelper.rowsSelection(this.data,c)}if(this.grid.select.column){var d=this.grid.select.column.getSelected();if(d&&d.length>0)return b.SelectionHelper.columnsSelection(this.data,d)}return b.SelectionHelper.noSelection(this.data)},c.prototype.getAllSelection=function(){return b.SelectionHelper.tableSelection(this.data)},c.prototype.setGridSelection=function(a){if(this.grid.select){if(this.clearingSelection=!0,this.grid.select.cell){var c=this.grid.select.cell.getSelected();c&&c.length>0&&this.grid.select.cell.clear()}if(this.grid.select.row){var d=this.grid.select.row.getSelected();d&&d.length>0&&this.grid.select.row.clear()}if(this.grid.select.column){var e=this.grid.select.column.getSelected();e&&e.length>0&&this.grid.select.column.clear()}if(this.grid.select.table&&this.grid.select.table.isSelected()&&this.grid.select.table.clear(),this.clearingSelection=!1,!a||a.type===b.GridRangeType.None)return void this.handleSelectionChange(b.GridRangeType.None,null,null);if(this.grid.select.table&&a.type===b.GridRangeType.Table)return void this.grid.select.table.select();var f,g,h;switch(a.type){case b.GridRangeType.Cell:g=this.data&&this.data.getRowAxis(),h=this.data&&this.data.getColumnAxis(),f=this.grid.select.cell;break;case b.GridRangeType.Row:g=this.data&&this.data.getRowAxis(),f=this.grid.select.row;break;case b.GridRangeType.Column:h=this.data&&this.data.getColumnAxis(),f=this.grid.select.column;break;default:f=null,g=null,h=null}f&&a.args&&a.args.forEach(function(c){var d=!0;a.type===b.GridRangeType.Cell?(g&&(d=g.contains(c.rowKey)),h&&(d=d&&h.contains(c.columnKey)),d&&f.selectById(c.rowKey,c.columnKey)):(g&&(d=g.contains(c)),h&&(d=d&&h.contains(c)),d&&f.selectById(c))})}},c.selectionIdentical=function(b,c){return Array.isArray(b)&&Array.isArray(c)?b.length===c.length&&a.equals(b,c):b===c},c.prototype.sameCell=function(b,c){return a.equals(b,c)},c.prototype.currentActiveCell=function(){var a=this.grid.body.getActiveCell();return a&&{rowKey:a.rowId,colKey:a.colId,columnKey:a.colId}},c.prototype.handleSelectionChange=function(a,d,e){if(!this.clearingSelection){a!==b.GridRangeType.Cell&&this.grid.body.resetActiveCell();var f=this.currentActiveCell(),g=this.grid.select.table&&this.grid.select.table.isSelected();if(!c.selectionIdentical(d,this._lastSelection)||g&&a!==b.GridRangeType.Table||!this.sameCell(f,this._lastActiveCell)){a!==b.GridRangeType.Table&&this.grid.select.table&&this.grid.select.table.clear(!0);var h;if(h=a===b.GridRangeType.None||d===!1||Array.isArray(d)&&0===d.length?b.SelectionHelper.noSelection(this.data):b.SelectionHelper.fromArgs(a,d,this.data,f),a===b.GridRangeType.Cell&&h.args&&1===h.args.length){var i=h.args[0];if(h.activeCell.columnKey!==i.columnKey||h.activeCell.rowKey!==i.rowKey)return}this.gridLogger.doLoggingForSelectionChange(h),this.onSelectionChange.raise(this,h),this.options&&"function"==typeof this.options.onSelectionChange&&this.options.onSelectionChange(h)}this._lastActiveCell=f,this._lastSelection=d}},c.prototype.connectEvents=function(){var a=this,c=function(a,b){return(a&&a.length||b)&&(b.length||a.length)};this.grid.connect(this.grid.select.cell,"onSelectionChange",function(c,d){a.handleSelectionChange(b.GridRangeType.Cell,a.convertToIonCellSelection(c),a.convertToIonCellSelection(d))}),this.grid.connect(this.grid.select.row,"onSelectionChange",function(d,e){c(d,e)&&a.handleSelectionChange(b.GridRangeType.Row,d,e)}),this.grid.connect(this.grid.select.column,"onSelectionChange",function(d,e){c(d,e)&&a.handleSelectionChange(b.GridRangeType.Column,d,e)}),this.grid.connect(this.grid.select.table,"onSelectionChange",function(c,d){c!==d&&a.handleSelectionChange(b.GridRangeType.Table,c,d)})},c.prototype.selectionContainsCell=function(a,c){return b.SelectionHelper.containsCell(this.getGridSelection(),a,c)},c.prototype.isCellInSelection=function(a,c,d){return b.SelectionHelper.containsCell(a,c,d)},c.prototype.isCellSelected=function(a,c){return b.SelectionHelper.containsCell(this.getGridSelection(),a,c)},c.prototype.isColumnInSelection=function(a,c){return b.SelectionHelper.isColumnInSelection(a,c)},c.isContiguous=function(a,c){return b.SelectionHelper.isContiguous(a,c)},c.prototype.handleActiveCellChange=function(a,c,d){if(this.selectionContainsCell(a,c)||d){var e=this.getGridSelection();this.handleSelectionChange(e.type,e.args,e.args)}else this.options.gridSelectionType&b.GridSelectionType.Cell?this.setGridSelection({type:b.GridRangeType.Cell,args:[{rowKey:a,colKey:c,columnKey:c}]}):this.setGridSelection({type:b.GridRangeType.None})},c.prototype.getActiveCell=function(){return this.grid.body.getActiveCell()},c.prototype.alignActiveCell=function(){var a=this,c=this.grid.body.getActiveCell();c&&(c.rowId||c.colId)&&(isNaN(this.timeoutId)||(clearTimeout(this.timeoutId),this.timeoutId=null),this.timeoutId=setTimeout(function(){a.grid.body.refresh().then(function(){c&&a.getGridSelection().type===b.GridRangeType.Cell&&a.grid.body.setActiveCell(c.rowId,c.colId,!0)})},0))},c.prototype.handleColumnRemoval=function(a,c){var d=this,e=this.getGridSelection(),f=e.type;if(f===b.GridRangeType.Column||f===b.GridRangeType.Cell)if(a.some(function(a){return a.type===b.SliceEventType.Reset}))if(0===c.length())this.grid.select.cell&&this.grid.select.cell.clear(),this.grid.select.column&&this.grid.select.column.clear();else if(f===b.GridRangeType.Column){var g=e.args;g.forEach(function(a){c.contains(a)||d.grid.select.column.deselectById(a)})}else{var h=this.grid.select.cell.getSelected();h.forEach(function(a){var b=a[1];if(!c.contains(b)){var e=a[0];d.grid.select.cell.deselectById(e,b)}})}else a.filter(function(a){return a.type===b.SliceEventType.SliceRemoved}).forEach(function(a){a.args.keys.forEach(function(a){if(f===b.GridRangeType.Column){var c=e.args;c.indexOf(a)>=0&&d.grid.select.column.deselectById(a)}else if(d.grid.select.cell){var g=d.grid.select.cell.getSelected();g.filter(function(b){return b[1]===a}).forEach(function(a){d.grid.select.cell.deselectById(a[0],a[1])})}})});this.alignActiveCell()},c.prototype.handleRowRemoval=function(a,c){var d=this,e=this.getGridSelection(),f=e.type;if(f===b.GridRangeType.Row||f===b.GridRangeType.Cell)if(a.some(function(a){return a.type===b.SliceEventType.Reset}))if(0===c.length())this.grid.select.cell&&this.grid.select.cell.clear(),this.grid.select.row&&this.grid.select.row.clear();else if(f===b.GridRangeType.Row){var g=e.args;g.forEach(function(a){c.contains(a)||d.grid.select.row.deselectById(a)})}else{var h=this.grid.select.cell.getSelected();h.forEach(function(a){var b=a[0];if(!c.contains(b)){var e=a[1];d.grid.select.cell.deselectById(b,e)}})}else a.filter(function(a){return a.type===b.SliceEventType.SliceRemoved}).forEach(function(a){a.args.keys.forEach(function(a){if(f===b.GridRangeType.Row){var c=e.args;c.indexOf(a)>=0&&d.grid.select.row.deselectById(a)}else if(d.grid.select.cell){var g=d.grid.select.cell.getSelected();g.filter(function(b){return b[0]===a}).forEach(function(a){d.grid.select.cell.deselectById(a[0],a[1])})}})});this.alignActiveCell()},c}();c.Manager=d}(c=b.selection||(b.selection={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){function d(a,b){if(Array.isArray(a)){var c=b.getColumnAxis(),d=c.getSliceRange(0,c.length());if(d.length){var e=d[0],f=c.getNodeAndMeasureKey(e.key());if(f.measureKey){var g=c.options.getSliceKeys(f.nodeKey),h=[];g.forEach(function(b){var d=c.getNodeAndMeasureKey(b);d.measureKey&&a.forEach(function(a){a.nodeKey===d.measureKey&&h.push({nodeKey:b,alias:a.alias})})}),c.options.setAlias(h,!0)}else c.options.setAlias(a,!0)}}}var e=2;c.restoreColumnAliases=d;var f=function(){function c(a,b,c,d,e,f,g,h,i,j,k,l,m){this.scope=a,this.data=b,this.sortingManager=c,this.summaryPanelManager=d,this.gridHeaderPanelManager=e,this.headerRegionManager=f,this.filterPanelManger=g,this.sidePanelManager=h,this.templateManager=i,this.optionsDialogManager=j,this.initHandler=l,this.stateSetHandler=m,this.unsub=[],this.watch(a,k)}return Object.defineProperty(c.prototype,"options",{get:function(){return this.scope.options},enumerable:!0,configurable:!0}),c.prototype.init=function(a){this.grid=a},c.prototype.dispose=function(){this.canNotifyChanges=!1,this.unsub.forEach(function(a){return a()}),this.unsubscribeRestoreAliasEvent&&this.unsubscribeRestoreAliasEvent()},c.prototype.watch=function(a,b){this.registerWrapColumnWatch(a,b),this.registerLayoutAndFlashingWatch(a),this.registerForStateChanges(),this.registerForTemplateChange(),this.registerForHeaderPanelChanges(),this.registerColumnSeparatorWatch(a,b),this.registerEnableZebraColoringWatch(a)},c.prototype.udpateFrozenColumnHeightOnWordWrap=function(a){for(var b=$(a).find("td[locked='true']"),c=0;c<b.length;c++){var d=$(a).find("td[id='"+b[c].getAttribute("id")+"']").not("td[locked='true']"),e=d&&$(d).outerHeight()+"px";$(b[c]).css({height:e})}},c.prototype.registerWrapColumnWatch=function(a,b){var c=this;this.unsub.push(a.$watch("options.wrapColumnHeaders",function(a,d){a?b.addClass("ion-grid-leaf-column-headers-wrap"):b.removeClass("ion-grid-leaf-column-headers-wrap"),c.udpateFrozenColumnHeightOnWordWrap(b),a!==d&&c.notifyChanges()}))},c.prototype.registerForTemplateChange=function(){var a=this;this.templateManager&&this.unsub.push(this.templateManager.configTemplateChanged.add(function(b,c){c&&a.setState(a.grid,c.state),a.notifyChanges()}))},c.prototype.registerColumnSeparatorWatch=function(a,b){var c=this,d="ion-grid-hide-column-separator";this.unsub.push(a.$watch("options.showColumnSeparators",function(a,e){a===!1?b.addClass(d):b.removeClass(d),a!==e&&c.notifyChanges()}))},c.prototype.registerEnableZebraColoringWatch=function(a){var b=this;this.unsub.push(a.$watch("options.enableZebraColoring",function(a,c){a!==c&&b.notifyChanges()}))},c.prototype.registerLayoutAndFlashingWatch=function(a){var b=this,c=this;this.unsub.push(a.$watchGroup(["options.showRowHeaders","options.showColumnHeaders","options.disableFlashing","options.enableOutlineMode","options.compactColumnMode","options.responsivenessMode","options.toolbarOptions.enabled","options.disableVirtualColumns"],function(d,e){for(var f=0;f<d.length&&d[f]===e[f];f++);if(f<d.length){var g=a.options.gridState;g&&(g.showRowHeaders=a.options.showRowHeaders,g.showColumnHeaders=a.options.showColumnHeaders,g.disableFlashing=a.options.disableFlashing,g.enableOutlineMode=a.options.enableOutlineMode,g.toolbarOptions||(g.toolbarOptions={}),g.toolbarOptions.enabled=a.options.toolbarOptions.enabled),c.notifyChanges(),b.initHandler()}})),this.unsub.push(a.$watch("options.dndOptions",function(a,d){a||d||(c.notifyChanges(),b.initHandler())},!0))},c.prototype.getSortColumnAxis=function(){return this.data.getColumnAxis().getAs(b.SortingPivotAxisAdapter)||this.data.getColumnAxis().getAs(b.VirtualSortingPivotAxisAdapter)},c.prototype.getSortRowAxis=function(){return this.data.getRowAxis().getAs(b.SortingPivotAxisAdapter)||this.data.getRowAxis().getAs(b.VirtualSortingPivotAxisAdapter)},c.prototype.registerForStateChanges=function(){var a=this;this.unsub.push(this.data.getColumnAxis().nodeStateUpdated.add(function(b,c){return a.notifyChanges(c)})),this.unsub.push(this.data.getRowAxis().nodeStateUpdated.add(function(b,c){return a.notifyChanges(c)})),this.unsub.push(this.filterPanelManger.stateUpdated.add(function(){a.notifyChanges()}));var c=this.getSortColumnAxis();c&&this.unsub.push(c.options.sortingChangedEvent.add(function(){return a.notifyChanges()}));var d=this.getSortRowAxis();d&&this.unsub.push(d.options.sortingChangedEvent.add(function(){return a.notifyChanges()}));var e=this.data.getAs(b.PresentationDataModelAdapter);e&&(e.onConditionalFormattingRulesChanged.add(function(){return a.notifyChanges()}),e.onFormattingOptionsChanged.add(function(){return a.notifyChanges()}));var f=this.data.getAs(b.GroupingDataModel);f&&f.groupingChanged.add(function(){return a.notifyChanges()})},c.prototype.registerForHeaderPanelChanges=function(){var a=this;this.unsub.push(this.scope.$watchGroup(["options.rowLevelHeaderPanels","options.headerPanels"],function(b,c){a.headerRegionManager.refreshHeaderRegion()})),this.unsub.push(this.data.getColumnAxis().nodeStateUpdated.add(function(b){a.headerRegionManager.refreshHeaderRegion()})),this.unsub.push(this.data.getColumnAxis().options.slicesEvent.add(function(b){a.headerRegionManager.refreshHeaderRegion()}))},c.prototype.notifyChanges=function(b){if(!b||a.any(b,function(a){return a.displayName||a.alias||a.description||a.tooltip||a.value||a.category})){var c=Object.getOwnPropertyNames(this.scope.options).indexOf("gridState")!==-1;this.grid&&!this.isApplingStateMode&&c&&(this.scope.options.gridState=this.getState(this.grid)),this.canNotifyChanges&&(this.scope.gridStateUpdatedEvent.raise(this,null),this.scope.options.onGridStateChanged&&this.scope.options.onGridStateChanged())}},c.prototype.getColumnAlias=function(){var a=this.data.getColumnAxis(),b=a.getSliceRange(0,a.length()),c=[];if(b.length){var d=b[0],e=a.getNodeAndMeasureKey(d.key());if(e.measureKey){var f=a.options.getSliceKeys(e.nodeKey);f.forEach(function(b){var d=a.getNodeAndMeasureKey(b),e=a.getSlice(b);e.alias&&c.push({nodeKey:d.measureKey,alias:e.alias})})}else for(var g=a.getSliceRange(0,this.data.getColumnAxis().length()),h=0;h<g.length;h++)g[h].alias&&c.push({nodeKey:g[h].key(),alias:g[h].alias})}return c.length>0?c:void 0},c.prototype.getState=function(a){var c=a.columnResizer.getResizedColumns(),d=null;this.data.getState&&(d=this.data.getState());var f=a.rowHeader&&a.rowHeader.getState(),g=this.sidePanelManager.getState(),h={version:e,frozenColumnCount:a.columnLockService.getState(),columnWidths:c,dataModelState:d,rowHeaderState:f,enableOutlineMode:this.scope.options.enableOutlineMode,responsivenessMode:b.GridResponsivenessMode[this.scope.options.responsivenessMode],showColumnHeaders:this.scope.options.showColumnHeaders,showRowHeaders:this.scope.options.showRowHeaders,disableFlashing:this.scope.options.disableFlashing,wrapColumnHeaders:this.scope.options.wrapColumnHeaders,aliases:this.getColumnAlias(),summaryPanel:this.summaryPanelManager&&this.summaryPanelManager.getState(),rowHeaderPanel:this.gridHeaderPanelManager.getState(),filterState:this.filterPanelManger.getState(),templateState:this.templateManager&&this.templateManager.state,enableZebraColoring:this.scope.options.enableZebraColoring,showColumnSeparators:this.scope.options.showColumnSeparators,sidePanelState:g,toolbarOptions:{enabled:this.scope.options.toolbarOptions.enabled,enableAppearanceOptions:this.scope.options.toolbarOptions.enableAppearanceOptions}};return h},c.prototype.setState=function(c,f){var g=this;if(!f)return!1;var h=!1;this.isApplingStateMode=!0;var i=f;if(i.version===e){i.dataModelState&&this.data.setState&&this.data.setState(i.dataModelState),i.columnWidths&&c.columnResizer.setState(i.columnWidths),i.rowHeaderState&&c.rowHeader&&c.rowHeader.setState(i.rowHeaderState),this.sortingManager.reinit(),i.sidePanelState&&this.sidePanelManager.setState(i.sidePanelState),i.toolbarOptions&&a.extend(this.scope.options.toolbarOptions,[i.toolbarOptions]);var j=b.restoreAppearanceOptions(this.scope,i),k=this;j&&this.scope.$evalAsync(function(){return k.initHandler()}),i.summaryPanel&&this.summaryPanelManager&&this.summaryPanelManager.setState(i.summaryPanel),i.rowHeaderPanel&&this.gridHeaderPanelManager.setState(i.rowHeaderPanel),i.filterState&&this.filterPanelManger.setState(i.filterState),i.templateState&&this.templateManager&&(this.templateManager.state=i.templateState),this.optionsDialogManager&&this.optionsDialogManager.refreshOptionDialog(),c.columnLockService.setState(i.frozenColumnCount),this.stateSetHandler(),h=j,this.unsubscribeRestoreAliasEvent&&this.unsubscribeRestoreAliasEvent(),this.data.getColumnAxis().length&&i.aliases&&(this.unsubscribeRestoreAliasEvent=this.data.getColumnAxis().options.slicesEvent.add(function(){g.data.getColumnAxis().length()&&(d(i.aliases,g.data),g.unsubscribeRestoreAliasEvent())}))}return this.isApplingStateMode=!1,h},c}();c.Manager=f}(c=b.settings||(b.settings={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){angular.module("ionwebGrids").directive("appearancePopup",[function(){var a=function(a){a.close=function(){a.isOpen=!1}};return{restrict:"EA",scope:{isOpen:"=?",appearanceOptions:"=ngModel",hasHierarchicalRows:"&?",showResponsiveness:"&?",configOptions:"=?"},link:a,templateUrl:"grids.ui/gridAppearance/appearancePopup.tpl.html"}}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){function b(b){return{enableOutlineMode:b.enableOutlineMode,showColumnHeaders:b.showColumnHeaders,showRowHeaders:b.showRowHeaders,enableFlashing:!b.disableFlashing,enableZebraColoring:b.enableZebraColoring,wrapHeadersText:b.wrapColumnHeaders,responsiveMode:b.responsivenessMode||a.GridResponsivenessMode.Default,showColumnSeparators:b.showColumnSeparators,showSidePanel:b.showSidePanel}}function c(b,c){c.enableOutlineMode=c.enableOutlineMode!==!1,c.showColumnHeaders=c.showColumnHeaders!==!1,c.showRowHeaders=c.showRowHeaders!==!1,c.disableFlashing=!!c.disableFlashing,c.wrapColumnHeaders=c.wrapColumnHeaders===!0,c.responsivenessMode=c.responsivenessMode||a.GridResponsivenessMode[a.GridResponsivenessMode.Default];var d=!1;if(c){b.options.enableOutlineMode!=c.enableOutlineMode&&(d=!0,b.options.enableOutlineMode=c.enableOutlineMode),b.options.showColumnHeaders!=c.showColumnHeaders&&(d=!0,b.options.showColumnHeaders=c.showColumnHeaders),b.options.showColumnSeparators!=c.showColumnSeparators&&(b.options.showColumnSeparators=c.showColumnSeparators),b.options.enableZebraColoring!=c.enableZebraColoring&&(b.options.enableZebraColoring=c.enableZebraColoring),b.options.showRowHeaders!=c.showRowHeaders&&(d=!0,b.options.showRowHeaders=c.showRowHeaders),b.options.disableFlashing!=c.disableFlashing&&(d=!0,b.options.disableFlashing=c.disableFlashing),b.options.wrapColumnHeaders!=c.wrapColumnHeaders&&(d=!0,b.options.wrapColumnHeaders=c.wrapColumnHeaders);var e=a.GridResponsivenessMode[c.responsivenessMode];b.options.responsivenessMode!=e&&(d=!0,b.options.responsivenessMode=e)}return a.settings.restoreColumnAliases(c.aliases,b.data),d}function d(c){var d=c.options;void 0==d.wrapColumnHeaders&&(d.wrapColumnHeaders=!1);var e=c.$watch("isAppearancePopupOpen",function(a){a&&(c.appearanceOptions=b(c.options))}),f=c.$watch("appearanceOptions",function(a,b){a!==b&&c.options&&c.appearanceOptions&&(c.options.showColumnHeaders=a.showColumnHeaders,c.options.showRowHeaders=a.showRowHeaders,c.options.disableFlashing=!a.enableFlashing,c.options.enableZebraColoring=a.enableZebraColoring,c.options.enableOutlineMode=a.enableOutlineMode,c.options.wrapColumnHeaders=a.wrapHeadersText,c.options.responsivenessMode=a.responsiveMode,c.options.showColumnSeparators=a.showColumnSeparators,c.options.showSidePanel=a.showSidePanel)},!0);return c.showAppearanceOptions=function(){var a=!0;return c.options&&c.options.toolbarOptions&&c.options.toolbarOptions.enableAppearanceOptions===!1&&(a=!1),a},c.showResponsiveness=function(){var b=c.data.getAs(a.ResponsiveDataModel);return!!b},function(){e(),f()}}a.createAppearanceOptions=b,a.restoreAppearanceOptions=c,a.initAppearanceOptions=d,angular.module("ionwebGrids").directive("appearance",[function(){return{restrict:"EA",scope:{appearanceOptions:"=ngModel",configOptions:"=?",toolbarOptions:"=?",hasHierarchicalRows:"&",showResponsiveness:"&"},link:function(){},templateUrl:"grids.ui/gridAppearance/appearance.tpl.html"}}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function d(b,c,d,e,f){this.data=b,this.gridLogger=c,this.selectionManager=d,this.scope=e,this.compile=f,this.removeTooltipFromCell=function(){},this.numberFormattingService=a.getService("ionweb.numberFormattingService"),this.dateFormattingService=a.getService("ionweb.dateFormattingService")}return d.prototype.init=function(b,c){var d=this;this.gridx=c,this.settingsManager=b,this.onSummaryInfoChanged=new a.Event;var e=a.throttle(function(){return d.calculate()},1e3);this.dataModelUnsubscriber=this.data.getDataSet().rangeUpdated.add(function(a){d.onSummaryInfoChanged.observersCount()&&e()}),this.selectionUnsubscriber=this.selectionManager.onSelectionChange.add(function(a,b){d.currentSelection=b,d.calculate()}),this.initTooltip()},d.prototype.removeTooltipFromGridCell=function(){this.scope.contextMenu&&(this.scope.contextMenu.rowKey=this.currentCell.rowKey)&&(this.scope.contextMenu.columnKey=this.currentCell.columnKey)&&this.removeTooltipFromCell()},d.prototype.getSummaryPanelInfo=function(){return this.currentSummaryInfo},d.prototype.getSummaryPanelCustomInfo=function(){return this.customSummaryInfo},d.prototype.summaryInfoToDescription=function(a){if(!a){if(!this.currentSummaryInfo)return[];a=this.currentSummaryInfo}var c=this.getState(),d=[];d.push({label:b.Strings.Summary_Panel_Info_Sum+":",value:a.sum.getFormatted(),additionalClass:a.sum.isNegative?b.NegativeNumericFormattingClass:"",visible:c.sum}),d.push({label:b.Strings.Summary_Panel_Info_Avg+":",value:a.avg.getFormatted(),additionalClass:a.avg.isNegative?b.NegativeNumericFormattingClass:"",visible:c.avg}),d.push({label:b.Strings.Summary_Panel_Info_Count+":",value:a.count.toFixed(0),visible:c.count}),d.push({label:b.Strings.Summary_Panel_Info_Count_Num+":",value:a.countNum.toFixed(0),visible:c.count}),d.push({label:b.Strings.Summary_Panel_Info_Max+":",value:a.max.getFormatted(),additionalClass:a.max.isNegative?b.NegativeNumericFormattingClass:"",visible:c.max}),d.push({label:b.Strings.Summary_Panel_Info_Min+":",value:a.min.getFormatted(),additionalClass:a.min.isNegative?b.NegativeNumericFormattingClass:"",visible:c.min});var e=this.customSummaryInfoToDescription();return d=d.concat(e)},d.prototype.getFormattedValue=function(c,d){var e={};if(c||"boolean"==typeof c)if(c instanceof Date)e.displayValue=d&&d.datePresenter?d.datePresenter(c).getFormatted():this.dateFormattingService.toShortDate(c);else if(c instanceof a.IsoTimeStamp){var f=c.getNormalizeDate();e.displayValue="",f&&(e.displayValue=d&&d.datePresenter?d.dateTimePresenter(f).getFormatted():this.dateFormattingService.toShortTime(f))}else"number"==typeof c?(e.displayValue=d&&d.datePresenter?d.numericPresenter(c).getFormatted():this.numberFormattingService.getFormattedNumber(c),e.classes=c<0?b.NegativeNumericFormattingClass:b.PositiveNumericFormattingClass):e.displayValue=c.toString();else e.displayValue="";return e},d.prototype.customSummaryInfoToDescription=function(){var a=this,c=[];if(this.customSummaryInfo){var d,e=this.data.getAs(b.PresentationDataModelAdapter);if(e){var f=e.tableAppliedFormattingOptions();d=b.PresentationDataModelAdapter.getPresentersWithFormatting(f)}Object.keys(this.customSummaryInfo).forEach(function(b){var e=a.getFormattedValue(a.customSummaryInfo[b],d);c.push({label:b+":",value:e.displayValue,additionalClass:e.classes,visible:!0})})}return c},d.prototype.setSummaryPaneStateAndNotify=function(a){this.setState(a),this.settingsManager.notifyChanges()},d.prototype.getState=function(){return this.state||{sum:!0,avg:!0,count:!0,max:!0,min:!0}},d.prototype.setState=function(a){this.state=a},d.prototype.dispose=function(){this._isDisposed=!0,this.dataModelUnsubscriber&&this.dataModelUnsubscriber(),this.selectionUnsubscriber&&this.selectionUnsubscriber(),this.disposeTooltip&&this.disposeTooltip()},d.prototype.calculate=function(){if(!this._isDisposed){var a=c.Model.getSummaryPanelInfo(this.data,this.currentSelection,this.currentSummaryInfo);this.customSummaryInfo=this.scope.options.onUpdateSummaryPanel&&this.scope.options.onUpdateSummaryPanel(this.currentSelection),a&&(this.currentSummaryInfo=a),(a||this.scope.options.onUpdateSummaryPanel)&&this.onSummaryInfoChanged.raise(this,this.currentSummaryInfo)}},d.prototype.isCurrentCellinSelection=function(a){var c=this.currentSelection&&this.currentSelection.type==b.GridRangeType.Table;if(c)return!0;for(var d=this.currentSelection&&this.currentSelection.args&&this.currentSelection.args.length,e=0;e<d;e++){if(this.currentSelection.type==b.GridRangeType.Column&&this.currentSelection.args[e]==a.columnKey)return!0;if(this.currentSelection.type==b.GridRangeType.Row&&this.currentSelection.args[e]==a.rowKey)return!0;var f=this.currentSelection.args[e];if(this.currentSelection.type==b.GridRangeType.Cell&&f.columnKey==a.columnKey&&f.rowKey==a.rowKey)return!0}return!1},d.prototype.isContentWidthSmalltoShowTooltip=function(a){if(!a||$(a).hasClass("gridxCellWidget"))return!1;
var c=b.getMaxWidth(a,[a.innerText]);return Math.round(c)>Math.round($(a).outerWidth())+2},d.prototype.isTooltipAllowedForColumn=function(a){return!(this.scope.options&&this.scope.options.cellTooltip&&this.scope.options.cellTooltip[a]&&this.scope.options.cellTooltip[a].hideTooltip)},d.prototype.showOnlyValidationTooltip=function(c){var d=this.data&&this.data.getAs(b.ValidationDataModelAdapter);if(d){var e=d.getDataSet(),f=e&&e.getValidationState(c.rowKey,c.columnKey);if(f&&f.state!=a.validation.ValidationState.Valid)return!0}return!1},d.prototype.extractUnderlyingCellValues=function(a,c,d){var e=d.getSourceDataModel().getColumnAxis().getSlice(c).displayName(),f=b.getCellPresentation(d.getSourceDataModel().getDataSet().getValue(a,c)).getFormatted(b.PresentationContext.Export);return{displayName:e,value:f}},d.prototype.extractCellValue=function(a,c){var d=this,e=this.data.getAs(b.ResponsiveDataModel);if(e&&e.isGroup(c)){var f=[],g=e.getSourceColumnKeys(c);return g.forEach(function(b){var c=d.extractUnderlyingCellValues(a,b,e);f.push(c)}),f}var h=b.gridElementFromKeys(this.gridx,a,c);return h.textContent},d.prototype.processCellValue=function(a,c,d,e){var f=this.extractCellValue(d,e);if("string"==typeof f){var g={label:a.panelValues.length>0?b.Strings.Tooltip_Cell_Value:"",value:f,visible:!0,additionalClass:c.className,showSeparator:a.panelValues.length>1};a.panelValues.splice(0,0,g)}else for(var h=f,i=a.panelValues.length>1,j=0;j<h.length;j++){var k={label:h[j].displayName,value:h[j].value,visible:!0,additionalClass:c.className,showSeparator:i&&j===h.length-1};a.panelValues.splice(j,0,k)}},d.prototype.updateTooltip=function(a){var c=this;a&&!this._isDisposed&&this.scope.$evalAsync(function(){a.panelValues=c.summaryInfoToDescription();var d=b.gridElementFromKeys(c.gridx,c.currentCell.rowKey,c.currentCell.columnKey),e=c.currentSelection&&c.currentSelection.type==b.GridRangeType.Cell&&c.currentSelection.args&&c.currentSelection.args.length<=1;c.isCurrentCellinSelection(c.currentCell)&&!e&&c.scope.options.summaryPanelMode==b.SummaryPanelMode.ShowOnSelection||(a.panelValues=[]),c.isContentWidthSmalltoShowTooltip(d)&&c.isTooltipAllowedForColumn(c.currentCell.columnKey)&&c.processCellValue(a,d,c.currentCell.rowKey,c.currentCell.columnKey)})},d.prototype.initTooltip=function(){var c,d,e=this,f=null,g=null,h=function(){e.tooltipObserverUnsub&&(e.tooltipObserverUnsub(),e.tooltipObserverUnsub=null),clearTimeout(d),d=null,c&&e.scope.$evalAsync(function(){c&&(c.$destroy(),f&&f.remove(),c=null)})};this.removeTooltipFromCell=h;var i=function(a){e._isDisposed||e.gridx.select&&e.gridx.select.cell&&e.gridx.select.cell._selecting||e.showOnlyValidationTooltip(a)||e.scope.contextMenu||(g&&(clearTimeout(g),g=null),g=setTimeout(function(){e.scope.$evalAsync(function(){if(clearTimeout(d),d=null,!e.scope.contextMenu){var g=b.gridElementFromKeys(e.gridx,a.rowKey,a.columnKey);c=e.scope.$new(),c.panelValues=e.summaryInfoToDescription();var h=e.isCurrentCellinSelection(a),i=e.currentSelection&&e.currentSelection.type==b.GridRangeType.Cell&&e.currentSelection.args&&e.currentSelection.args.length<=1;if(h&&!i&&e.scope.options.summaryPanelMode==b.SummaryPanelMode.ShowOnSelection||(c.panelValues=[]),e.isTooltipAllowedForColumn(a.columnKey)&&e.isContentWidthSmalltoShowTooltip(g)&&e.processCellValue(c,g,a.rowKey,a.columnKey),c.panelValues.length>0&&e.gridx.select&&e.gridx.select.cell&&!e.gridx.select.cell._selecting){e.tooltipObserverUnsub&&(e.tooltipObserverUnsub(),e.tooltipObserverUnsub=null),e.tooltipObserverUnsub=e.onSummaryInfoChanged.add(function(){c&&e.updateTooltip(c)}),1===c.panelValues.length&&(c.panelValues[0].textAlign=$(g).css("text-align")),c.tooltipOptions={contentTemplateUrl:"grids.ui/gridSummaryPanel/tooltip.tpl.html",scope:c,showImmediately:!0};var j=b.safeGetClientHeight(e.gridx.bodyNode.firstChild),k=$('<div class="summary-panel-tooltip-placeholder" style="height:'+j+"px; margin-top:-"+j+'px;" ion-tooltip="tooltipOptions"></div>'),l=e.compile(k)(c);e.isCurrentCellinSelection(a)&&e.previousHoveredElement?l.appendTo(e.previousHoveredElement):l.appendTo(g),f=l,h&&!e.previousHoveredElement&&e.currentSelection&&(e.currentSelection.type==b.GridRangeType.Table||e.currentSelection.type==b.GridRangeType.Column||e.currentSelection.type==b.GridRangeType.Row||e.currentSelection.args.length>1&&e.currentSelection.type==b.GridRangeType.Cell)&&(e.previousHoveredCell=a,e.previousHoveredElement=g),h||(e.previousHoveredElement=void 0,e.previousHoveredCell=void 0)}}})},1e3))},j=function(a,c){if(e.selectionManager.isCellSelected(a,c)){var d=e.selectionManager.getGridSelection(),f=!(d.type===b.GridRangeType.Row&&1===d.args.length)&&(d.type!==b.GridRangeType.Cell||d.args.length>1);if(f)return!0}return!1};this.gridx.connect(this.gridx.bodyNode,"mouseover",function(f){e.currentCell=a.tables.gridElementAxesIDsFromElement(f.target),e.currentCellElement=b.gridElementFromKeys(e.gridx,e.currentCell.rowKey,e.currentCell.columnKey);var g=j(e.currentCell.rowKey,e.currentCell.columnKey);e.currentCell.rowKey&&g?d&&c?(clearTimeout(d),d=null,e.previousHoveredElement?e.updateTooltip(c):(h(),i(e.currentCell))):(h(),i(e.currentCell)):(e.previousHoveredElement=void 0,h(),i(e.currentCell))}),this.gridx.connect(this.gridx.bodyNode,"mouseout",function(a){g&&(clearTimeout(g),g=null),c&&(d=setTimeout(function(){h()},100))}),this.gridx.connect(this.gridx,"onCellMouseOut",function(b){var c=a.tables.gridElementAxesIDsFromElement(b.toElement),d=""!=c.rowKey&&""!=c.columnKey;d&&e.isCurrentCellinSelection(c)||(e.previousHoveredElement=void 0,e.previousHoveredCell=void 0),e.showOnlyValidationTooltip(c)&&h()}),this.gridx.connect(this.gridx.body,"onAfterCell",function(a){e.previousHoveredCell&&a.row.id==e.previousHoveredCell.rowKey&&a.column.id==e.previousHoveredCell.columnKey&&(h(),e.previousHoveredElement=b.gridElementFromKeys(e.gridx,e.previousHoveredCell.rowKey,e.previousHoveredCell.columnKey),i(e.currentCell))});var k=this.selectionManager.onSelectionChange.add(function(){h(),e.currentCell&&e.currentCell.rowKey&&e.currentCell.columnKey&&(h(),i({rowKey:e.currentCell.rowKey,columnKey:e.currentCell.columnKey}))});this.disposeTooltip=function(){g&&(clearTimeout(g),g=null),h(),k&&k()}},d}();c.Manager=d}(c=b.summaryPanel||(b.summaryPanel={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(){}return a}();a.SerializableFilterNode=b;var c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(b);a.SerializableFilterConditionNode=c}(b=a.xrs||(a.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={})),function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.xrs.SerializableFilterNode);a.SerializableFilterNode=b;var c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.xrs.SerializableFilterConditionNode);a.SerializableFilterConditionNode=c}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(b){function c(c){var d=void 0;return c===a.NodeType.And?d=new b.FilterAndNode:c===a.NodeType.Condition?d=new b.FilterCondition:c===a.NodeType.Or?d=new b.FilterOrNode:c===a.NodeType.Not?d=new b.FilterNotNode:c===a.NodeType.Root&&(d=new b.FilterRootNode),d}var d=function(){function d(b,c,d){var e=this;if(b===a.NodeType.Condition)throw new Error(a.Strings.Text_Filter_Panel_Error_Node_Internal_Condition);this.enabled=!0,this.internalNodeType=b,this.internalChildren=[],c&&c.length>0&&c.forEach(function(a){e.internalChildren.push(a),a.parent=e}),this.visible=!0}return d.prototype.addChild=function(b){if(null!=b.parent)throw new Error(a.Strings.Text_Filter_Panel_Error_Node_Add_Child);b.parent=this,this.internalChildren.push(b)},d.prototype.removeChild=function(b){if(b.parent!==this)throw new Error(a.Strings.Text_Filter_Panel_Error_Node_Remove_Child);b.parent=null;var c=this.internalChildren.indexOf(b);return this.internalChildren.splice(c,1)},d.prototype.insertChild=function(b,c){if(null!=c.parent)throw new Error(a.Strings.Text_Filter_Panel_Error_Node_Insert_Child);if(c.parent=this,b<0)throw new RangeError("OutOfRange: 'index'.");this.internalChildren.splice(b,0,c)},d.prototype.clear=function(){this.internalChildren=[]},d.prototype.equals=function(a){if(!a)return!1;if(this.nodeType!==a.nodeType)return!1;if(void 0===this.children&&void 0!==a.children||void 0!==this.children&&void 0===a.children)return!1;if(this.children.length!==a.children.length)return!1;if(this.id!==a.id)return!1;if(this.fieldDisplayName!==a.fieldDisplayName)return!1;if(this.description!==a.description)return!1;if(this.enabled!==a.enabled)return!1;if(this.tag!==a.tag)return!1;if(this.visible!==a.visible)return!1;for(var b=!0,c=0,d=this.children;c<d.length;c++){for(var e=d[c],f=!1,g=0,h=a.children;g<h.length;g++){var i=h[g];if(e.equals(i)){f=!0;break}}b=b&&f}return b},d.prototype.cloneChildren=function(){var a=null;return null!=this.internalChildren&&(a=[],this.internalChildren.forEach(function(b){a.push(b.clone())})),a},Object.defineProperty(d.prototype,"children",{get:function(){return this.internalChildren},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"nodeType",{get:function(){return this.internalNodeType},enumerable:!0,configurable:!0}),d.prototype.toJSON=function(){var a=new b.SerializableFilterNode;return a.serializableType=this.getSerializableType(),a.nodeType=this.nodeType,a.tag=this.tag,a.id=this.id,a.description=this.description,a.isDefault=this.isDefault,a.enabled=this.enabled,a.fieldDisplayName=this.fieldDisplayName,a.children=this.children&&this.children.map(function(a){return a.toJSON()}),a},d.prototype.fromJSON=function(a){if(a&&(this.tag=a.tag,this.internalNodeType=a.nodeType,this.id=a.id,this.description=a.description,this.isDefault=a.isDefault,this.enabled=a.enabled,this.fieldDisplayName=a.fieldDisplayName,a.children))for(var b=0,d=a.children;b<d.length;b++){var e=d[b];this.addChild(c(e.nodeType).fromJSON(e))}return this},d.prototype.getLogInfo=function(a){var b=this,c={field:a.tag,value:a.description},d=[];return a.children&&(a.children.forEach(function(a){d.push(b.getLogInfo(a))}),d.length&&(c.children=d)),c},d.prototype.logDescription=function(){return this.getLogInfo(this)},d}();b.BaseInternalFilterNode=d}(b=a.xrs||(a.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={})),function(a){var b;!function(a){var b=function(a){function b(b,c,d){return a.call(this,b,c,d)||this}return __extends(b,a),b}(a.xrs.BaseInternalFilterNode);a.BaseInternalFilterNode=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(b){var c=function(b){function c(c){return b.call(this,a.NodeType.Root,c)||this}return __extends(c,b),c.prototype.clone=function(){var a=b.prototype.cloneChildren.call(this),d=new c(a);return d.tag=this.tag,d.description=this.description,d.enabled=this.enabled,d.fieldDisplayName=this.fieldDisplayName,d.id=this.id,d.visible=this.visible,d.isDefault=this.isDefault,d},c.prototype.getSerializableType=function(){return"FilterRootNode"},c}(b.BaseInternalFilterNode);b.FilterRootNode=c}(b=a.xrs||(a.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={})),function(a){var b;!function(a){var b=function(a){function b(b){return a.call(this,b)||this}return __extends(b,a),b}(a.xrs.FilterRootNode);a.FilterRootNode=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d;!function(a){a[a.Add=0]="Add",a[a.Remove=1]="Remove",a[a.Rename=2]="Rename",a[a.Update=3]="Update"}(d=c.FilterStorageEventType||(c.FilterStorageEventType={}));var e=function(){function c(b){this.filterStorageService=b,this.filters=[],this._storageUpdated=new a.Event}return Object.defineProperty(c.prototype,"storageUpdated",{get:function(){return this._storageUpdated},enumerable:!0,configurable:!0}),c.prototype.initFilters=function(a){this.filters=a},c.prototype.getFilters=function(){return this.filters},c.prototype.getFilter=function(a){var b=null;return this.filters.forEach(function(c){b||c.description!==a||(b=c)}),b},c.prototype.addFilter=function(c,e,f){if(void 0===f&&(f=!0),!c)return{succeeded:!1,message:b.Strings.Text_Filter_Panel_Error_Invalid_Filter_Name};if(!e)return{succeeded:!1,message:b.Strings.Text_Filter_Panel_Error_Invalid_Filter_Name};var g=this.getFilter(c);return g?{succeeded:!1,message:a.stringFormat(b.Strings.Text_Filter_Panel_Error_Filter_Exists,{name:c})}:(e.description=c,this.filters.push(e),this.filterStorageService.save(),f&&this._storageUpdated.raise(this,{eventType:d.Add,newFilterName:c,oldFilterName:null}),{succeeded:!0,message:b.Strings.Text_Filter_Panel_Error_Filter_OK})},c.prototype.updateFilter=function(c,e){if(!c)return{succeeded:!1,message:b.Strings.Text_Filter_Panel_Error_Invalid_Filter_Name};if(!e)return{succeeded:!1,message:b.Strings.Text_Filter_Panel_Error_Invalid_Filter};var f=this.getFilter(c);if(!f)return{succeeded:!1,message:a.stringFormat(b.Strings.Text_Filter_Panel_Error_Filter_Not_Found,{name:c})};var g=this.removeFilter(c,!1);return g.succeeded?(g=this.addFilter(c,e,!1),g.succeeded?(this._storageUpdated.raise(this,{eventType:d.Update,newFilterName:c,oldFilterName:c}),{succeeded:!0,message:b.Strings.Text_Filter_Panel_Error_Filter_OK}):g):g},c.prototype.removeFilter=function(c,e){void 0===e&&(e=!0);var f=this.getFilter(c);if(!f)return{succeeded:!1,message:a.stringFormat(b.Strings.Text_Filter_Panel_Error_Filter_Not_Found,{name:c})};var g=this.filters.indexOf(f);return g>-1?(this.filters.splice(g,1),this.filterStorageService.save(),e&&this._storageUpdated.raise(this,{eventType:d.Remove,newFilterName:null,oldFilterName:c}),{succeeded:!0,message:b.Strings.Text_Filter_Panel_Error_Filter_OK}):{succeeded:!1,message:a.stringFormat(b.Strings.Text_Filter_Panel_Error_Filter_Not_Found,{name:c})}},c.prototype.renameFilter=function(c,e,f){if(void 0===f&&(f=!0),!c)return{succeeded:!1,message:b.Strings.Text_Filter_Panel_Error_Invalid_Old_Filter_Name};if(!e)return{succeeded:!1,message:b.Strings.Text_Filter_Panel_Error_Invalid_New_Filter_Name};var g=this.getFilter(c);if(!g)return{succeeded:!1,message:a.stringFormat(b.Strings.Text_Filter_Panel_Error_Filter_Not_Found,{name:c})};var h=this.getFilter(e);if(h)return{succeeded:!1,message:a.stringFormat(b.Strings.Text_Filter_Panel_Error_Filter_Exists,{name:e})};var i=this.removeFilter(c,!1);return i.succeeded?(i=this.addFilter(e,g,!1),i.succeeded?(f&&this._storageUpdated.raise(this,{eventType:d.Rename,newFilterName:e,oldFilterName:c}),{succeeded:!0,message:b.Strings.Text_Filter_Panel_Error_Filter_OK}):i):i},c.prototype.cloneFilter=function(c,d){if(!c)return{succeeded:!1,message:b.Strings.Text_Filter_Panel_Error_Invalid_Original_Filter_Name};if(!d)return{succeeded:!1,message:b.Strings.Text_Filter_Panel_Error_Invalid_Target_Filter_Name};var e=this.getFilter(c);if(!e)return{succeeded:!1,message:a.stringFormat(b.Strings.Text_Filter_Panel_Error_Filter_Not_Found,{name:c})};var f=e.clone(),g=this.addFilter(d,f);return g.succeeded?{succeeded:!0,message:b.Strings.Text_Filter_Panel_Error_Filter_OK}:g},c}(),f=function(){function a(a){this.prefProvider=a,this.contexts={},this.load()}return a.prototype.reload=function(){this.contexts={},this.load()},a.prototype.loadContextStorage=function(a){var b=this.contexts[a];return b||(b=new e(this),this.contexts[a]=b),b},a.prototype.dumpContextsOld=function(){var a=this,b={};Object.keys(this.contexts).forEach(function(c){var d=a.contexts[c],e=d.getFilters(),f={};e.forEach(function(a){var b=a.toJSON(),c=JSON.stringify(b);f[a.description]=c}),b[c]=f});var c=JSON.stringify(b);return c},a.prototype.dumpContexts=function(){var a=this;return Object.keys(this.contexts).reduce(function(b,c){return b[c]=a.contexts[c].getFilters().reduce(function(a,b){return a[b.description]=b,a},{}),b},{})},a.prototype.save=function(){var b=this.dumpContextsOld();this.prefProvider().setValue(a.OldPreferenceKey,b);var c=this.dumpContexts();this.prefProvider().setValue(a.PreferenceKey,c)},a.prototype.load=function(){var b=this,d=this.prefProvider().getValue(a.PreferenceKey,null);if(d)Object.keys(d).forEach(function(a){var e=d[a],f=Object.keys(e).map(function(a){var b=new c.FilterRootNode;return b.fromJSON(e[a])}),g=b.loadContextStorage(a);g.initFilters(f)});else{var e=this.prefProvider().getValue(a.OldPreferenceKey,null),f=e&&JSON.parse(e);f&&Object.keys(f).forEach(function(a){var d=f[a],e=Object.keys(d).map(function(a){var b=d[a],e=JSON.parse(b),f=new c.FilterRootNode,g=f.fromJSON(e);return g}),g=b.loadContextStorage(a);g.initFilters(e)})}},a.OldPreferenceKey="__Filter_Storage__",a.PreferenceKey="ionweb.xrs.filterStorage",a}();c.FilterStorageService=f;var g=function(){function b(a,b){this.dashboardService=a,this.preferenceService=b,this.instances={},this.fallbackInstance=null}return b.getComponentFromScope=function(b){for(var c=b;c;){if(c.component instanceof a.Component)return c.component;c=c.$parent}return null},b.prototype.loadFilterStorageService=function(a){var b=this;if(!a)throw new Error("component is undefined");if(this.dashboardService.isEnabled){var c=this.dashboardService.findParent(a);if(!c)throw new Error("Dashboard not found");var d=this.instances[c.id];return d||(d=new f(function(){return c.preferenceProvider}),this.instances[c.id]=d,c.reloaded.add(function(){d.reload()})),d}return this.fallbackInstance||(this.fallbackInstance=new f(function(){return b.preferenceService})),this.fallbackInstance},b}();c.FilterStorageProviderService=g,angular.module("ionwebGrids").service("ionweb.filterStorageProviderService",["ionweb.dashboardService","ionweb.preferenceService",function(a,b){return new g(a,b)}])}(c=b.xrs||(b.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b){this.value=a,this.displayValue=b}return a.prototype.clone=function(){return new a(this.value,this.displayValue)},a.prototype.equals=function(a){return this.value===a.value},a}();a.FilterValue=b}(b=a.xrs||(a.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={})),function(a){var b;!function(a){var b=function(a){function b(b,c){return a.call(this,b,c)||this}return __extends(b,a),b}(a.xrs.FilterValue);a.FilterValue=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function d(){this.internalChildren=void 0,this.enabled=!0,this.values=[],this.visible=!0,this.xrsOperatorRegistry=new a.xrs.XrsOperatorsRegistry}return d.prototype.clone=function(){var a=new d;a.field=this.field,a.operator=this.operator,a.id=this.id,a.description=this.description,a.enabled=this.enabled,a.tag=this.tag,a.visible=this.visible,a.fieldDisplayName=this.fieldDisplayName;var b=[];return this.values?(this.values.forEach(function(a){b.push(a.clone())}),a.values=b,a):a},Object.defineProperty(d.prototype,"children",{get:function(){return this.internalChildren},enumerable:!0,configurable:!0}),d.prototype.isExcluded=function(){return this.operator===this.xrsOperatorRegistry.notLike.id||this.operator===this.xrsOperatorRegistry.notIn.id||this.operator===this.xrsOperatorRegistry.notEquals.id},Object.defineProperty(d.prototype,"nodeType",{get:function(){return b.NodeType.Condition},enumerable:!0,configurable:!0}),d.prototype.equals=function(b){if(!b)return!1;if(this.field!==b.field)return!1;if(this.operator!==b.operator)return!1;if(this.id!==b.id)return!1;if(this.fieldDisplayName!==b.fieldDisplayName)return!1;if(this.enabled!==b.enabled)return!1;if(this.visible!==b.visible)return!1;if(this.tag!==b.tag)return!1;if(!this.values&&!b.values)return!0;if(this.values&&!b.values||!this.values&&b.values)return!1;if(this.values.length!==b.values.length)return!1;for(var c=0,d=0;d<this.values.length;d++){var e=this.values[d],f=function(a){return e.equals(a)};if(c=a.indexOf(b.values,f),c===-1)return}return c!==-1},d.prototype.getSerializableType=function(){return"FilterCondition"},d.prototype.toJSON=function(){var a=new c.SerializableFilterConditionNode;return a.serializableType=this.getSerializableType(),a.field=this.field,a.operator=this.operator,a.nodeType=this.nodeType,a.tag=this.tag,a.id=this.id,a.description=this.description,a.enabled=this.enabled,a.values=this.values,a.visible=this.visible,a.fieldDisplayName=this.fieldDisplayName,a},d.prototype.fromJSON=function(a){this.field=a.field,this.operator=a.operator,this.id=a.id,this.description=a.description,this.enabled=a.enabled,this.tag=a.tag,this.operator=a.operator,this.visible=a.visible,this.fieldDisplayName=a.fieldDisplayName;for(var b=0,d=a.values;b<d.length;b++){var e=d[b],f=new c.FilterValue("undefined"==typeof e.value?e.internalValue:e.value,"undefined"==typeof e.displayValue?e.internalDisplayValue:e.displayValue);this.values.push(f.clone())}return this},d}();c.FilterCondition=d}(c=b.xrs||(b.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={})),function(a){var b;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b}(a.xrs.FilterCondition);a.FilterCondition=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(b){var c=function(b){function c(c){return b.call(this,a.NodeType.And,c)||this}return __extends(c,b),c.prototype.clone=function(){var a=new c(b.prototype.cloneChildren.call(this));return a.tag=this.tag,a.description=this.description,a.enabled=this.enabled,a.fieldDisplayName=this.fieldDisplayName,a.id=this.id,a.visible=this.visible,a},c.prototype.getSerializableType=function(){return"FilterAndNode"},c}(b.BaseInternalFilterNode);b.FilterAndNode=c}(b=a.xrs||(a.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={})),function(a){var b;!function(a){var b=function(a){function b(b){return a.call(this,b)||this}return __extends(b,a),b}(a.xrs.FilterAndNode);a.FilterAndNode=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(b){var c=function(b){function c(c){return b.call(this,a.NodeType.Or,c)||this}return __extends(c,b),c.prototype.clone=function(){var a=new c(b.prototype.cloneChildren.call(this));return a.tag=this.tag,a.description=this.description,a.enabled=this.enabled,a.visible=this.visible,a.fieldDisplayName=this.fieldDisplayName,a.id=this.id,a},c.prototype.getSerializableType=function(){return"FilterOrNode"},c}(b.BaseInternalFilterNode);b.FilterOrNode=c}(b=a.xrs||(a.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={})),function(a){var b;!function(a){var b=function(a){function b(b){return a.call(this,b)||this}return __extends(b,a),b}(a.xrs.FilterOrNode);a.FilterOrNode=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(b){var c=function(b){function c(c){return b.call(this,a.NodeType.Not,c?[c]:void 0)||this}return __extends(c,b),c.prototype.clone=function(){var a=this.children.length>0?this.children[0].clone():void 0,b=new c(a);return b.tag=this.tag,b.description=this.description,b.enabled=this.enabled,b.visible=this.visible,b.fieldDisplayName=this.fieldDisplayName,b.id=this.id,b},c.prototype.getSerializableType=function(){return"FilterNotNode"},c}(b.BaseInternalFilterNode);b.FilterNotNode=c}(b=a.xrs||(a.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={})),function(a){var b;!function(a){var b=function(a){function b(b){return a.call(this,b)||this}return __extends(b,a),b}(a.xrs.FilterNotNode);a.FilterNotNode=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){"undefined"!=typeof angular&&angular.module("ionwebGrids").directive("ionwebAppliedFiltersToolbar",function(){return{restrict:"E",scope:{alwaysVisible:"=",showFieldNames:"=",filterPanelContext:"=",logId:"=?",customContentTemplate:"@?",customContentTemplateUrl:"@?",customContentScope:"=?"},controller:["$scope","ionweb.notificationService","ionweb.filterStorageProviderService","ionweb.contextMenuService",function(a,b,c,e){return new d(a,b,c,e)}],templateUrl:"grids.ui/filterPanel/appliedFiltersToolbar.tpl.html"}});var d=function(){function d(a,b,d,e){var f=this;this.notificationService=b,this.contextMenuService=e,this.$scope=a,this.filterStorageService=d.loadFilterStorageService(c.FilterStorageProviderService.getComponentFromScope(a)),this.$scope.filterPanelContext.contextIsReadyToUse?this.init():(this.$scope.filterPanelContext.contextReady.add(function(a,b){f.init()}),this.$scope.filterPanelContext.setFilterStorageService(this.filterStorageService))}return d.prototype.init=function(){var d=this;this.$scope.toolbarIconName="refresh",this.$scope.filterNodes=[],this.$scope.activeFilterDescription=void 0,this.$scope.doQuery=function(){d.doQuery()},this.$scope.removeFilterCondition=function(a){d.handleRemoveFilterCondition(a)},this.$scope.filterPanelContext.filtersUpdated.add(function(a,b){d.handleFiltersUpdated(b)}),this.$scope.filterPanelContext.filterQueryStatusEvent.add(function(a,b){d.handleQueryUpdates(b)}),this.$scope.filterPanelContext.activeFavoriteFilterUpdated.add(function(a,b){d.handleFiltersUpdated(b)});var e=this.filterStorageService.loadContextStorage(this.$scope.filterPanelContext.sharedFiltersContextKey);this.$scope.favoriteFilters=e.getFilters(),e.storageUpdated.add(function(a,b){if(b.eventType===c.FilterStorageEventType.Remove){var e=d.$scope.filterPanelContext.indexOfFavoriteOnToolbar({description:b.oldFilterName});e>=0&&(d.$scope.filterPanelContext.favoritesOnToolbar.splice(e,1),d.$scope.filterPanelContext.raiseStateChanged())}else if(b.eventType===c.FilterStorageEventType.Rename){var e=d.$scope.filterPanelContext.indexOfFavoriteOnToolbar({description:b.oldFilterName});e>=0&&(d.$scope.filterPanelContext.favoritesOnToolbar.splice(e,1,{description:b.newFilterName}),d.$scope.filterPanelContext.raiseStateChanged())}}),this.$scope.showFilterOptions=function(c){var e=d,f=[{groupId:"1",menuType:a.MenuItemType.Checkbox,checked:!d.$scope.filterPanelContext.showFavoriteFiltersOnToolbarInternal,action:function(){e.$scope.filterPanelContext.showFavoriteFiltersOnToolbarInternal=!1,e.$scope.filterPanelContext.raiseStateChanged()},text:b.Strings.Menu_Options_Show_Current_Filter_Values},{groupId:"1",menuType:a.MenuItemType.Checkbox,checked:d.$scope.filterPanelContext.showFavoriteFiltersOnToolbarInternal,action:function(){e.$scope.filterPanelContext.showFavoriteFiltersOnToolbarInternal||(e.$scope.filterPanelContext.showFavoriteFiltersOnToolbarInternal=!0,e.$scope.filterPanelContext.raiseStateChanged())},text:b.Strings.Menu_Options_Show_Favorite_Filters}];(d.$scope.favoriteFilters.length||d.$scope.filterPanelContext.defaultFiltersAvailable())&&(f.push({menuType:a.MenuItemType.Divider}),d.$scope.filterPanelContext.defaultFiltersAvailable()&&f.push({menuType:a.MenuItemType.Checkbox,text:b.Strings.Menu_Options_Show_default_Filters,disabled:!d.$scope.filterPanelContext.showFavoriteFiltersOnToolbarInternal,checked:d.$scope.filterPanelContext.showDefaultFiltersOnToolbarInternal,autoClose:!1,action:function(){e.$scope.filterPanelContext.showDefaultFiltersOnToolbarInternal=!e.$scope.filterPanelContext.showDefaultFiltersOnToolbarInternal,e.$scope.addRemoveDefaultFilterFromToolbar(),e.$scope.filterPanelContext.raiseStateChanged()}}),d.$scope.favoriteFilters.forEach(function(b){f.push({menuType:a.MenuItemType.Checkbox,text:b.description,checked:d.$scope.filterPanelContext.favoritesOnToolbar&&d.$scope.filterPanelContext.indexOfFavoriteOnToolbar({description:b.description})>=0,disabled:!d.$scope.filterPanelContext.showFavoriteFiltersOnToolbarInternal,autoClose:!1,action:function(){e.$scope.addRemoveFavoriteFromToolbar(b)}})}));var g={anchorPoint:a.ContextMenuAnchorPoint.BottomRight};d.contextMenuService.openContextMenu(f,c.target,g)},this.$scope.onFavoriteFilterApply=function(a){if(d.$scope.filterPanelContext.currentFilters&&d.$scope.filterPanelContext.isSameFilter(d.$scope.filterPanelContext.currentFilters,a)){var b=d.$scope.filterPanelContext.isRequiredFilterPresent();d.$scope.filterPanelContext.updateActiveFavoriteFilter(null,!b,!0),d.$scope.filterPanelContext.isAllFilterValid()}else{var c=d.$scope.favoriteFilters.filter(function(b){return d.$scope.filterPanelContext.isSameFilter(b,a)});if(c&&0===c.length&&d.$scope.filterPanelContext.defaultFiltersAvailable()&&(c=d.$scope.filterPanelContext.defaultFilters.filter(function(b){return d.$scope.filterPanelContext.isSameFilter(b,a)})),c&&c.length){var e=c[0];d.$scope.filterPanelContext.setActiveFavoriteFilter(e),d.$scope.filterPanelContext.updateFilters(e,!0),d.$scope.filterPanelContext.isAllFilterValid()}}},this.$scope.addRemoveFavoriteFromToolbar=function(a){var b=d.$scope.filterPanelContext.indexOfFavoriteOnToolbar({description:a.description});b>=0?d.$scope.filterPanelContext.favoritesOnToolbar.splice(b,1):(d.reorderFiltersOnToolBar([{description:a.description,isDefault:a.isDefault}]),d.$scope.filterPanelContext.indexOfFavoriteOnToolbar({description:a.description})<0&&d.$scope.filterPanelContext.favoritesOnToolbar.push({description:a.description})),d.$scope.filterPanelContext.raiseStateChanged()},this.$scope.addRemoveDefaultFilterFromToolbar=function(){if(d.$scope.filterPanelContext.defaultFiltersAvailable())if(d.$scope.filterPanelContext.showDefaultFiltersOnToolbarInternal){var a=[];d.$scope.filterPanelContext.defaultFilters.forEach(function(b){a.unshift({description:b.description,isDefault:!0})}),d.reorderFiltersOnToolBar(a),a.forEach(function(a){d.$scope.filterPanelContext.indexOfFavoriteOnToolbar(a)<0&&d.$scope.filterPanelContext.favoritesOnToolbar.unshift(a)})}else d.$scope.filterPanelContext.defaultFilters.forEach(function(a){var b={description:a.description,isDefault:!0},c=d.$scope.filterPanelContext.indexOfFavoriteOnToolbar(b);c>=0&&d.$scope.filterPanelContext.favoritesOnToolbar.splice(c,1)})},this.$scope.isCurrentFavoriteFilterUpdated=function(){return d.$scope.filterPanelContext.currentFavoriteFilterUpdated},this.processFiltersUpdated(this.$scope.filterPanelContext.currentFilters,!0)},d.prototype.reorderFiltersOnToolBar=function(b){var c=this,d=this.$scope.filterPanelContext.favoriteFiltersOrder;if(d&&d.length>0){var e=this.$scope.filterPanelContext.favoritesOnToolbar.splice(0);d.forEach(function(d){(a.indexOf(e,function(a){return c.$scope.filterPanelContext.isSameFilter(a,d)})>=0||a.indexOf(b,function(a){return c.$scope.filterPanelContext.isSameFilter(a,d)})>=0)&&c.$scope.filterPanelContext.favoritesOnToolbar.push(d)}),e.forEach(function(a){c.$scope.filterPanelContext.indexOfFavoriteOnToolbar(a)<0&&c.$scope.filterPanelContext.favoritesOnToolbar.push(a)})}},d.prototype.handleQueryUpdates=function(a){if(a){var c=a.status;if(c===b.FilterPanelQueryStatus.QueryInProgress)this.$scope.isSearchInProgress=!0,this.$scope.toolbarIconName="",this.$scope.$evalAsync();else if(c===b.FilterPanelQueryStatus.QuerySuccess||c===b.FilterPanelQueryStatus.QueryFailed){this.$scope.isSearchInProgress=!1,this.$scope.toolbarIconName="refresh",this.$scope.$evalAsync();var d=a.statusMsg;d&&c===b.FilterPanelQueryStatus.QueryFailed&&this.notificationService.showWarning(d)}}},d.prototype.doQuery=function(){if(this.$scope.isSearchInProgress)return void this.$scope.filterPanelContext.cancelApplyFilters();if(this.$scope.filterNodes){var a=this.createRootNode();this.$scope.filterPanelContext.updateFilters(a,!0)}},d.prototype.createRootNode=function(){var a=c.FilterRootNodeBuilder.buildFilterTree(this.$scope.filterNodes);return a.description=this.$scope.filterPanelContext.getActiveFavoriteFilterName(),a},d.prototype.handleRemoveFilterCondition=function(a){var b=this.$scope.filterNodes[a].id,c=b&&this.$scope.filterPanelContext.filterMap[b];if(!c||!c.required){this.$scope.filterNodes.splice(a,1);var d=this.createRootNode();!this.$scope.filterPanelContext.isFilterPanelInitialized&&c&&c.valueChanged&&this.$scope.filterPanelContext.filterMap[b].valueChanged.raise(this,{
newValue:null}),this.$scope.filterPanelContext.updateFilters(d,!this.$scope.filterPanelContext.isFilterPanelInitialized&&this.$scope.filterPanelContext.shouldApplyOnValueChange())}},d.prototype.handleFiltersUpdated=function(a){var b=a&&a.fireQuery;this.processFiltersUpdated(a&&a.filterTree,b)},d.prototype.processFiltersUpdated=function(a,b){var d=[];if(a){var e=c.FilterRootNodeBuilder.extractFilterNodes(a);for(var f in e)if(e.hasOwnProperty(f)){var g=e[f].clone();d.push(g)}}(b||0!==d.length)&&(this.$scope.filterNodes=d),this.$scope.filterPanelContext.activeFavoriteFilter?this.$scope.activeFilterDescription={description:this.$scope.filterPanelContext.activeFavoriteFilter.description,isDefault:this.$scope.filterPanelContext.activeFavoriteFilter.isDefault}:this.$scope.activeFilterDescription={description:""},this.$scope.$evalAsync()},d}();c.AppliedFiltersToolbarController=d}(c=b.xrs||(b.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){"undefined"!=typeof angular&&angular.module("ionwebGrids").directive("ionwebAutocompleteFilter",function(){return{restrict:"E",scope:{field:"@?",isVisible:"=?",isDisabled:"=?",filterNode:"=?",label:"@?",searchOperator:"@",acbScopeOptions:"=",filterUpdatedEvent:"=?",item:"=?"},controller:["$scope",function(a){return new d(a)}],templateUrl:"grids.ui/filterPanel/autocompleteFilter.tpl.html"}});var d=function(){function d(a){this.$scope=a,this.scope=a,this.init()}return d.prototype.clearValidationStateForRerquiredValue=function(){this.scope.item.internalValidationState=this.scope.item.validationState?this.scope.item.validationState:a.validation.ValidationState.Valid,this.scope.item.internalValidationState===a.validation.ValidationState.Valid&&(this.scope.item.internalValidationMessage=null)},d.prototype.setValidationStateForRequiredValue=function(){this.scope.item.internalValidationState=a.validation.ValidationState.Error,this.scope.item.missingRequiredMessage&&this.scope.item.missingRequiredMessage.length>0?this.scope.item.internalValidationMessage=this.scope.item.missingRequiredMessage:this.scope.item.internalValidationMessage=b.Strings.Text_Filter_Panel_Missing_Required_Value},d.prototype.createEmptyNode=function(){if(this.scope.excludedFilter){var a=[],b=new c.FilterValue("","");a.push(b),this.scope.item.filterNode=this.createFilterCondition(a,[])}else this.scope.item.filterNode=void 0},d.prototype.setOperator=function(){var a=this.xrsOperatorRegistry.in.id;return"Like"===this.scope.searchOperator?a=this.scope.excludedFilter?this.xrsOperatorRegistry.notLike.id:this.xrsOperatorRegistry.like.id:this.scope.excludedFilter&&(a=this.scope.value?this.xrsOperatorRegistry.notIn.id:this.xrsOperatorRegistry.notEquals.id),a},d.prototype.init=function(){var b=this;this.xrsOperatorRegistry=new a.xrs.XrsOperatorsRegistry,this.scope.acbDropdownOptionsCache=[],void 0!==this.scope.item&&null!==this.scope.item||(this.scope.item={id:this.scope.field,displayName:this.scope.label,filterNode:this.scope.filterNode,visible:this.scope.isVisible,enabled:this.scope.isDisabled!==!0,filterUpdated:this.scope.filterUpdatedEvent},this.scope.$watch("filterNode",function(a,c){b.handleConditionChanged(a,c)}),this.scope.$watch("isVisible",function(a){void 0!==a&&(b.scope.item.visible=a)})),void 0===this.scope.acbScopeOptions.multiple&&(this.scope.acbScopeOptions.multiple=!0),this.scope.item.filterNode?(this.scope.value=this.scope.item.filterNode.values.map(function(a){return a.value}),this.scope.excludedFilter=this.scope.item.filterNode.isExcluded()):(this.scope.item.filterNode=new c.FilterCondition,this.condition.field=this.scope.item.id,this.condition.id=this.scope.item.id,this.condition.fieldDisplayName=this.scope.item.displayName,this.scope.excludedFilter=!1,this.condition.operator=this.scope.acbScopeOptions.multiple?(new a.xrs.XrsOperatorsRegistry).in.id:(new a.xrs.XrsOperatorsRegistry).equals.id,this.condition.values=[]),this.scope.acbScopeOptions.scopeOptions={onAutocompleteBound:function(a){b.scope.autocomplete=a}},this.scope.$watch("value",function(a,c){(a||c)&&a!=c&&b.handleSelectionChanged(a,c)}),this.scope.$watch("excludedFilter",function(a,c){if(a!==c){if(!b.scope.value||0===b.scope.value.length){if(b.scope.item&&b.scope.item.required)return;return b.createEmptyNode(),void b.raiseValueChangedEvent()}b.handleSelectionChanged(b.scope.value,b.scope.value)}}),this.scope.$watch("item.required",function(a,c){a===!0?b.scope.value&&0!==b.scope.value.length||b.setValidationStateForRequiredValue():b.clearValidationStateForRerquiredValue()}),this.scope.$watch("item.filterNode",function(a,c){!a&&!c||a&&a.equals(c)||(b.handleConditionChanged(a,c),b.scope.filterNode=b.scope.item.filterNode&&b.scope.item.filterNode.clone()||null)}),this.scope.handleEnter=function(c){c.which==a.KeyCodes.ENTER&&b.raiseEnterKeyEvent()},this.interceptACBDropdownOptions(),this.scope.$watch("acbScopeOptions.options",function(a,c){b.interceptACBDropdownOptions()}),this.scope.acbScopeOptions.optionProvider&&(this.scope.acbOptionProvider=function(a){return Q.when(b.scope.acbScopeOptions.optionProvider(a)).then(function(a){if(a){b.scope.acbDropdownOptionsCache.push(a);var c=[];b.scope.item.filterNode.values.forEach(function(b){b.value==a.value&&a.label&&(b.displayValue=a.label),c.push(b.displayValue)}),b.scope.item.filterNode.description=c.join(", ")}return a})})},d.prototype.interceptACBDropdownOptions=function(){var a=this;this.scope.acbScopeOptions.options&&("function"==typeof this.scope.acbScopeOptions.options?this.scope.acbDropdownItems=function(b){return Q.when(a.scope.acbScopeOptions.options(b)).then(function(b){return a.scope.acbDropdownOptionsCache=b.options,b})}:(this.scope.acbDropdownOptionsCache=this.scope.acbScopeOptions.options,this.scope.acbDropdownItems=this.scope.acbScopeOptions.options,this.scope.item.filterNode&&(this.scope.value=this.getACBSelectionFromFilterNode(this.scope.item.filterNode))))},Object.defineProperty(d.prototype,"condition",{get:function(){return this.scope.item.filterNode},enumerable:!0,configurable:!0}),d.prototype.createFilterCondition=function(a,b){var d=new c.FilterCondition;return d.description=b.join(", "),d.field=this.scope.item.id,d.id=this.scope.item.id,d.fieldDisplayName=this.scope.item.displayName,d.values=a,d.operator=this.setOperator(),d},d.prototype.handleSelectionChanged=function(a,b){function d(a){var b;if(e.scope.acbDropdownOptionsCache)for(var c=0;c<e.scope.acbDropdownOptionsCache.length;c++)if(e.scope.acbDropdownOptionsCache[c].value===a){b=e.scope.acbDropdownOptionsCache[c].label||a;break}return b||(b=e.getDisplayValueFromConditions(a)),b}if(!a||0===a.length)return this.createEmptyNode(),this.scope.item&&this.scope.item.required&&this.setValidationStateForRequiredValue(),void(b&&b.length&&this.raiseValueChangedEvent());var e=this,f=[],g=[];if(a instanceof Array)for(var h=0;h<a.length;++h){var i=d(a[h].toString()),j=new c.FilterValue(this.getFilterValueFormatted(a[h]),i);f.push(j),g.push(i)}else{var i=d(a.toString()),j=new c.FilterValue(this.getFilterValueFormatted(a.toString()),i);f.push(j),g.push(i)}this.scope.item.filterNode=this.createFilterCondition(f,g),this.scope.item&&this.scope.item.required&&f&&f.length&&this.clearValidationStateForRerquiredValue(),this.raiseValueChangedEvent()},d.prototype.getDisplayValueFromConditions=function(a){if(this.condition&&this.condition.values)for(var b=0;b<this.condition.values.length;++b){var c=this.condition.values[b];if(a===c.value)return c.displayValue||a}return a},d.prototype.handleConditionChanged=function(a,b){if(a||b)if(a){var c=a,d=b;c.equals(d)||(this.scope.value=this.getACBSelectionFromFilterNode(c)),this.scope.excludedFilter=a.isExcluded()}else this.scope.excludedFilter=!1,this.scope.value&&(this.scope.value=null)},d.prototype.getFilterValueFormatted=function(a){return"Like"===this.scope.searchOperator&&(a="%"+a+"%"),a},d.prototype.raiseEnterKeyEvent=function(){this.scope.item.filterUpdated&&this.scope.item.filterUpdated.raise(this,{fireQuery:!0})},d.prototype.getACBSelectionFromFilterNode=function(a){var b=this,c=[],d=a;return d.values.forEach(function(a){if(a.value){var d=a.value.toString();"Like"===b.scope.searchOperator&&(d=d.substring(1,d.length-1)),c.push(d)}}),0===c.length?null:1==c.length?c[0]:c},d.prototype.raiseValueChangedEvent=function(){var a=this;this.valueChangedTimer&&clearTimeout(this.valueChangedTimer),this.valueChangedTimer=setTimeout(function(){a.scope.item.valueChanged&&a.scope.$evalAsync(function(){a.scope.item.valueChanged.raise(a,{newValue:a.scope.value})})},100)},d}()}(c=b.xrs||(b.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){function d(a,b){return new e(a,b)}"undefined"!=typeof angular&&angular.module("ionwebGrids").directive("ionwebDateRangeFilter",function(){return{restrict:"E",scope:{field:"@?",isVisible:"=?",isDisabled:"=?",filterNode:"=?",presenter:"=?",label:"@?",filterUpdatedEvent:"=?",dtreScopeOptions:"=",rangeTags:"=?",item:"=?"},controller:["$scope","ionweb.dateTimePickerHelperService",function(a,b){return new e(a,b)}],templateUrl:"grids.ui/filterPanel/dateRangeFilter.tpl.html"}}),c.createDateFilterControllerInternal=d;var e=function(){function d(b,c){var d=this;this.xrsOperatorRegistry=new a.xrs.XrsOperatorsRegistry,this.scope=b,this.dateTimePickerHelper=c,this.init(),this.scope.handleEnter=function(b){b.which==a.KeyCodes.ENTER&&setTimeout(function(){d.raiseEnterKeyEvent()},1)}}return Object.defineProperty(d.prototype,"condition",{get:function(){return this.scope.item.filterNode},enumerable:!0,configurable:!0}),d.prototype.handleValueChanged=function(a,b){if((void 0!==b||void 0!==a)&&!this.areDateRangeEquals(a,b)){a&&!b?this.clearValidationStateForRequiredValue():a||this.setValidationStateForRequiredValue();var c=this.createFilterCondition(a);this.scope.item.filterNode=c,this.raiseValueChangedEvent()}},d.prototype.createFilterCondition=function(a){var b=void 0;if(a){var d=this.getFieldValueFromDate(a.fromDate),e=this.getFieldValueFromDate(a.toDate);if(void 0!==d&&void 0!==e){var f=new c.FilterCondition;f.operator=this.xrsOperatorRegistry.rangeClosedInterval.id,f.values=[d,e],b=f}else if(void 0!==d){var f=new c.FilterCondition;f.operator=this.xrsOperatorRegistry.greaterThanOrEqualsTo.id,f.values=[d],b=f}else if(void 0!==e){var f=new c.FilterCondition;f.operator=this.xrsOperatorRegistry.lessThanOrEqualsTo.id,f.values=[e],b=f}b&&(b.field=this.scope.item.id,b.id=this.scope.item.id,b.fieldDisplayName=this.scope.item.displayName,b.description=this.getDateRangeDisplayValue(b))}return b},d.prototype.getFieldValueFromDate=function(b){var d=void 0;if(b){var e=void 0,f=b.date||b;e=this.scope.dtreScopeOptions.mode===a.toolkit.DateTimePickerMode.DateTime?f.toISOString():this.scope.dtreScopeOptions.mode===a.toolkit.DateTimePickerMode.Time?a.utils.DateUtils.getIonTimeFromDate(f):a.utils.DateUtils.getIonDateFromDate(f);var g=b.name||f.toDateString();d=new c.FilterValue(e,g)}return d},d.prototype.getDateFromFieldValue=function(b){var c;return c=this.scope.dtreScopeOptions.mode===a.toolkit.DateTimePickerMode.DateTime?new a.IsoTimeStamp(b).getNormalizeDate():this.scope.dtreScopeOptions.mode===a.toolkit.DateTimePickerMode.Time?a.utils.DateUtils.getDateFromIonTime(b):a.utils.DateUtils.getDateFromIonDate(b)},d.prototype.handleConditionChanged=function(a,b){if(a!==b){if(!a)return void(this.scope.value=void 0);var c=a,d=b;if(!c.equals(d))if(void 0===c.values)this.scope.value.fromDate=void 0,this.scope.value.toDate=void 0;else{this.scope.value={};var e;if(c.description&&this.scope.rangeTags)for(var f=0;f<this.scope.rangeTags.length;f++)if(this.scope.rangeTags[f].name===c.description){e=this.scope.rangeTags[f];break}c.description&&e?this.scope.value=e:0===c.values.length?(this.scope.value.fromDate=void 0,this.scope.value.toDate=void 0):1===c.values.length?c.operator===this.xrsOperatorRegistry.greaterThanOrEqualsTo.id?(this.scope.value.fromDate=this.getDateFromFieldValue(c.values[0].value),this.scope.value.toDate=void 0):c.operator===this.xrsOperatorRegistry.lessThanOrEqualsTo.id?(this.scope.value.fromDate=void 0,this.scope.value.toDate=this.getDateFromFieldValue(c.values[0].value)):(this.scope.value.fromDate=this.getDateFromFieldValue(c.values[0].value),this.scope.value.toDate=this.getDateFromFieldValue(c.values[0].value)):2===c.values.length&&(this.scope.value.fromDate=this.getDateFromFieldValue(c.values[0].value),this.scope.value.toDate=this.getDateFromFieldValue(c.values[1].value))}}},d.prototype.areDateRangeEquals=function(a,b){return void 0===a&&void 0!==b?void 0===b.fromDate&&void 0===b.toDate:void 0!==a&&void 0===b?void 0===a.fromDate&&void 0===a.toDate:!(a&&b&&(a.fromDate&&b.fromDate&&a.fromDate-b.fromDate!==0||void 0===a.fromDate&&void 0!==b.fromDate||void 0!==a.fromDate&&void 0===b.fromDate))&&!(a&&b&&(a.toDate&&b.toDate&&a.toDate-b.toDate!==0||void 0===a.toDate&&void 0!==b.toDate||void 0!==a.toDate&&void 0===b.toDate))},d.prototype.resetCondition=function(){this.scope.item.filterNode=new c.FilterCondition,this.condition.field=this.scope.item.id,this.condition.id=this.scope.item.id,this.condition.fieldDisplayName=this.scope.item.displayName,this.condition.operator=(new a.xrs.XrsOperatorsRegistry).rangeClosedInterval.id,this.condition.values=[],this.setValidationStateForRequiredValue()},d.prototype.setValidationStateForRequiredValue=function(){this.scope.item&&this.scope.item.required&&(this.scope.item.internalValidationState=a.validation.ValidationState.Error,this.scope.item.missingRequiredMessage&&this.scope.item.missingRequiredMessage.length>0?this.scope.item.internalValidationMessage=this.scope.item.missingRequiredMessage:this.scope.item.internalValidationMessage=b.Strings.Text_Filter_Panel_Missing_Required_Value)},d.prototype.clearValidationStateForRequiredValue=function(){this.scope.item.internalValidationState=void 0!==this.scope.item.validationState?this.scope.item.validationState:a.validation.ValidationState.Valid,this.scope.item.internalValidationState===a.validation.ValidationState.Valid&&(this.scope.item.internalValidationMessage=null)},d.prototype.raiseEnterKeyEvent=function(){var a=this;setTimeout(function(){a.scope.item.filterUpdated&&a.scope.item.filterUpdated.raise(a,{fireQuery:!0})},0)},d.prototype.raiseValueChangedEvent=function(){var a=this;this.valueChangedTimer&&clearTimeout(this.valueChangedTimer),this.valueChangedTimer=setTimeout(function(){a.scope.item.valueChanged&&a.scope.$evalAsync(function(){a.scope.item.valueChanged.raise(a,{newValue:a.scope.value})})},100)},d.prototype.init=function(){var b=this;void 0!==this.scope.item&&null!==this.scope.item||(this.scope.item={id:this.scope.field,displayName:this.scope.label,filterNode:this.scope.filterNode,visible:this.scope.isVisible,enabled:this.scope.isDisabled!==!0,filterUpdated:this.scope.filterUpdatedEvent},this.scope.$watch("filterNode",function(a,c){!a&&!c||a&&a.equals(c)||b.handleConditionChanged(a,c)}),this.scope.$watch("isVisible",function(a){void 0!==a&&(b.scope.item.visible=a)})),this.scope.item.filterNode?(this.handleConditionChanged(this.scope.item.filterNode,null),this.formattedDateDisplayValue=this.scope.item.filterNode&&this.scope.item.filterNode.description):this.resetCondition(),this.scope.onDateRangeUpdated=function(a,c){return b.scope.presenter?b.formattedDateDisplayValue=b.handleDateRangeUpdated(a,c):b.formattedDateDisplayValue=a&&a.name||c,b.scope.value&&a&&b.areDateRangeEquals(b.scope.value,a)&&b.scope.item.filterNode.description!==b.formattedDateDisplayValue&&(b.scope.item.filterNode.description=b.formattedDateDisplayValue,b.scope.item.displayValueChanged&&b.scope.item.displayValueChanged.raise(b,{id:b.scope.item.id,newValue:b.scope.item.filterNode.description})),b.formattedDateDisplayValue},this.scope.$watch("value",function(a,c){b.handleValueChanged(a,c)}),this.scope.$watch("item.internalValidationState",function(c,d){c!==d&&c===a.validation.ValidationState.Valid&&(b.scope.value||b.setValidationStateForRequiredValue())}),this.scope.$watch("item.filterNode",function(a,c){!a&&!c||a&&a.equals(c)||(b.handleConditionChanged(a,c),b.scope.filterNode=b.scope.item.filterNode&&b.scope.item.filterNode.clone()||null)}),this.scope.$watch("item.required",function(a,c){a===!0?b.scope.value||b.setValidationStateForRequiredValue():b.clearValidationStateForRequiredValue()}),this.scope.$watch("userInput",function(a,c){""===a&&c&&(b.resetCondition(),b.raiseValueChangedEvent())})},d.prototype.handleDateRangeUpdated=function(a,b){return this.getDateRangeDisplayValue(this.createFilterCondition(a))||b},d.prototype.getDateRangeDisplayValue=function(a){var b;if(this.scope.presenter)try{var c=this.scope.presenter.getDisplayValue(a);c&&c.length&&(b=c[0])}catch(a){}else b=this.formattedDateDisplayValue;return b},d}()}(c=b.xrs||(b.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){"undefined"!=typeof angular&&angular.module("ionwebGrids").directive("ionwebDateFilter",function(){return{restrict:"E",scope:{presenter:"=?",dteScopeOptions:"=?",dateTimeTags:"=?",item:"="},controller:["$scope","ionweb.dateTimePickerHelperService",function(a,b){return new d(a,b)}],templateUrl:"grids.ui/filterPanel/dateFilter.tpl.html"}});var d=function(){function d(b,c){var d=this;this.xrsOperatorRegistry=new a.xrs.XrsOperatorsRegistry,this.scope=b,this.dateTimePickerHelper=c,this.init(),this.scope.handleEnter=function(b){b.which==a.KeyCodes.ENTER&&setTimeout(function(){d.raiseEnterKeyEvent()},1)}}return Object.defineProperty(d.prototype,"condition",{get:function(){return this.scope.item.filterNode},enumerable:!0,configurable:!0}),d.prototype.handleValueChanged=function(a,b){if((void 0!==b||void 0!==a)&&(a?this.clearValidationStateForRequiredValue():this.scope.item.required?this.setValidationStateForRequiredValue():this.clearValidationStateForRequiredValue(),!this.areDateEquals(a,b))){var c=this.createFilterCondition(a);this.scope.item.filterNode=c,this.raiseValueChangedEvent()}},d.prototype.handleConditionChanged=function(b,c){if(b!==c){if(!b)return void(this.scope.value=void 0);var d=b,e=c;if(!d.values||!d.values[0])return void(this.scope.value=void 0);if(!d.equals(e))if(void 0===d.values)this.scope.value=void 0;else{var f,g=void 0;if(d.description&&this.scope.dateTimeTags)for(var h=0;h<this.scope.dateTimeTags.length;h++)if(this.scope.dateTimeTags[h].name===d.description){f=this.scope.dateTimeTags[h];break}d.description&&f?this.scope.value=f:(g=this.scope.dteScopeOptions.mode===a.toolkit.DateTimePickerMode.DateTime?new a.IsoTimeStamp(d.values[0].value).getNormalizeDate():this.scope.dteScopeOptions.mode===a.toolkit.DateTimePickerMode.Time?a.utils.DateUtils.getDateFromIonTime(d.values[0].value):a.utils.DateUtils.getDateFromIonDate(d.values[0].value),this.areDateEquals(this.scope.value,g)||(this.scope.value=g))}}},d.prototype.createFilterCondition=function(b){var d=this,e=void 0,f=function(b){var e,f=void 0,g=b.date||b;if(void 0!==b){e=d.scope.dteScopeOptions.mode===a.toolkit.DateTimePickerMode.DateTime?g.toISOString():d.scope.dteScopeOptions.mode===a.toolkit.DateTimePickerMode.Time?a.utils.DateUtils.getIonTimeFromDate(g):a.utils.DateUtils.getIonDateFromDate(g);var h=b.name||b.toDateString();f=new c.FilterValue(e,h)}return f};if(b){var g=f(b);if(void 0!==g){var h=new c.FilterCondition;h.operator=this.xrsOperatorRegistry.equals.id,h.values=[g],e=h}e&&(e.field=this.scope.item.id,e.id=this.scope.item.id,e.fieldDisplayName=this.scope.item.displayName,e.description=this.getDateDisplayValue(e))}return e},d.prototype.resetCondition=function(){this.scope.item.filterNode=new c.FilterCondition,this.condition.field=this.scope.item.id,this.condition.id=this.scope.item.id,this.condition.fieldDisplayName=this.scope.item.displayName,this.condition.operator=(new a.xrs.XrsOperatorsRegistry).equals.id,this.condition.values=[],this.setValidationStateForRequiredValue()},d.prototype.setValidationStateForRequiredValue=function(){this.scope.item&&this.scope.item.required&&(this.scope.item.internalValidationState=a.validation.ValidationState.Error,this.scope.item.missingRequiredMessage&&this.scope.item.missingRequiredMessage.length>0?this.scope.item.internalValidationMessage=this.scope.item.missingRequiredMessage:this.scope.item.internalValidationMessage=b.Strings.Text_Filter_Panel_Missing_Required_Value)},d.prototype.clearValidationStateForRequiredValue=function(){this.scope.item.internalValidationState=void 0!==this.scope.item.validationState?this.scope.item.validationState:a.validation.ValidationState.Valid,this.scope.item.internalValidationState===a.validation.ValidationState.Valid&&(this.scope.item.internalValidationMessage=null)},d.prototype.raiseEnterKeyEvent=function(){var a=this;setTimeout(function(){a.scope.item.filterUpdated&&a.scope.item.filterUpdated.raise(a,{fireQuery:!0})},0)},d.prototype.raiseValueChangedEvent=function(){var a=this;this.valueChangedTimer&&clearTimeout(this.valueChangedTimer),this.valueChangedTimer=setTimeout(function(){a.scope.item.valueChanged&&a.scope.$evalAsync(function(){a.scope.item.valueChanged.raise(a,{newValue:a.scope.value})})},100)},d.prototype.init=function(){var b=this;this.scope.item.filterNode?(this.handleConditionChanged(this.scope.item.filterNode,null),this.formattedDateDisplayValue=this.scope.item.filterNode&&this.scope.item.filterNode.description):this.resetCondition(),this.scope.onDateUpdated=function(a,c){return b.scope.presenter?b.formattedDateDisplayValue=b.handleDateUpdated(a,c):b.formattedDateDisplayValue=a&&a.name||c,b.scope.value&&a&&b.areDateEquals(b.scope.value,a)&&b.scope.item.filterNode&&b.scope.item.filterNode.description!==b.formattedDateDisplayValue&&(b.scope.item.filterNode.description=b.formattedDateDisplayValue,b.scope.item.displayValueChanged&&b.scope.item.displayValueChanged.raise(b,{id:b.scope.item.id,newValue:b.formattedDateDisplayValue})),b.formattedDateDisplayValue},this.scope.$watch("value",function(a,c){b.handleValueChanged(a,c)}),this.scope.$watch("item.filterNode",function(a,c){!a&&!c||a&&a.equals(c)||b.handleConditionChanged(a,c)}),this.scope.$watch("item.required",function(a){a===!0?b.scope.value||b.setValidationStateForRequiredValue():b.clearValidationStateForRequiredValue()}),this.scope.$watch("item.internalValidationState",function(c,d){c!==d&&c===a.validation.ValidationState.Valid&&(b.scope.value||b.setValidationStateForRequiredValue())}),this.scope.$watch("userInput",function(a,c){""===a&&c&&(b.resetCondition(),b.raiseValueChangedEvent())})},d.prototype.handleDateUpdated=function(a,b){return this.getDateDisplayValue(this.createFilterCondition(a))||b},d.prototype.getDateDisplayValue=function(a){var b;if(this.scope.presenter)try{var c=this.scope.presenter.getDisplayValue(a);c&&c.length&&(b=c[0])}catch(a){}else b=this.formattedDateDisplayValue;return b},d.prototype.areDateEquals=function(b,c){if(void 0===b&&void 0===c)return!0;if(void 0===b||void 0===c)return!1;var d=this.dateTimePickerHelper.dateFromDateTimeTag(b),e=this.dateTimePickerHelper.dateFromDateTimeTag(c),f=this.scope.dteScopeOptions.timepickerOptions&&this.scope.dteScopeOptions.timepickerOptions.showSeconds;return 0===(d&&e&&this.dateTimePickerHelper.compare(d,e,this.scope.dteScopeOptions.mode,f&&a.toolkit.TimeComparisonLevel.Seconds))},d}()}(c=b.xrs||(b.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(b){var c=function(){function b(a,b){var c=this;this.scope=a,this.notificationService=b,a.$watch("filterName",function(a){c.isSaveDisabled=!(a&&a.length>0)}),this.filterStorage=a.filterStorage,this.selectedFilter=a.selectedFilter}return b.prototype.delete=function(){var a=this.filterStorage.removeFilter(this.scope.filterName);this.logFilterRepositoryActionResult("Delete",a)},b.prototype.save=function(){if(this.selectedFilter.description===this.scope.filterName){var a=this.filterStorage.updateFilter(this.scope.filterName,this.selectedFilter);this.logFilterRepositoryActionResult("Update",a)}else if(this.selectedFilter.description&&this.selectedFilter.description.length>0){var a=this.filterStorage.renameFilter(this.selectedFilter.description,this.scope.filterName);this.logFilterRepositoryActionResult("Rename",a),a.succeeded&&(this.selectedFilter.description=this.scope.filterName)}},b.prototype.logFilterRepositoryActionResult=function(b,c){c.succeeded||this.notificationService.showError(a.Strings.Text_Filter_Panel_Error_Favorite_Filter_Operation_Failed,c.message)},b}();b.FavoriteFilterEditTilesController=c,angular.module("ionwebGrids").controller("ionweb.favoriteFilterEditTilesController",["$scope","ionweb.notificationService",function(a,b){return new c(a,b)}])}(b=a.xrs||(a.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(a,b,c,d){var e=this;this.notificationService=c,this.dialogService=d,a.$watch("filterName",function(a){e.isSaveDisabled=!(a&&a.length>0)}),this.scope=a,this.filterStorage=a.filterStorage,this.selectedFilter=a.selectedFilter,this.logger=b.create("FavoriteFilterEditDialogController")}return c.prototype.handleKeyAction=function(b){switch(b.keyCode){case a.KeyCodes.ESC:this.cancel();break;case a.KeyCodes.ENTER:this.save()}},c.prototype.cancel=function(){this.scope.cancel()},c.prototype.save=function(){var c=this;if(this.scope.filterName)if(this.selectedFilter.description=this.scope.filterName,this.filterStorage.getFilter(this.scope.filterName)){var d=this.dialogService.showQuestionDialog(a.stringFormat(b.Strings.Text_Filter_Panel_Error_Filter_Exists,{name:this.scope.filterName}),b.Strings.Text_Filter_Panel_Error_Filter_Overwrite,b.Strings.Text_Filter_Panel_Error_Filter_Overwrite,b.Strings.Text_Filter_Panel_Error_Filter_Cancel);d.closed.then(function(a){if(!a.cancel&&0===a.value){var b=c.filterStorage.updateFilter(c.scope.filterName,c.selectedFilter);c.parseRepositoryActionResult("Update",b)}})}else{var e=this.filterStorage.addFilter(this.scope.filterName,this.selectedFilter);this.parseRepositoryActionResult("Add",e)}},c.prototype.parseRepositoryActionResult=function(a,d){this.logger.low(c.LogKey,{Action:a,Filter:this.scope.filterName,ActionCompleted:d.succeeded,Message:d.message}),d.succeeded?this.scope.complete(this.filterStorage.getFilter(this.scope.filterName)):this.notificationService.showError(b.Strings.Text_Filter_Panel_Error_Favorite_Filter_Operation_Failed,d.message)},c.LogKey="FavoriteFilterEditDialogController",c}();angular.module("ionwebGrids").controller("ionweb.favoriteFilterEditDialogController",["$scope","ionweb.loggerFactory","ionweb.notificationService","ionweb.dialogService",function(a,b,c,e){return new d(a,b,c,e)}])}(c=b.xrs||(b.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function d(a,b,d,e){var f=this;this.$scope=a,this.notificationService=b,this.environmentService=d;var g=e.loadFilterStorageService(c.FilterStorageProviderService.getComponentFromScope(a));this.filterContextStorage=g.loadContextStorage(a.filterPanelOptions.filterPanelContext.sharedFiltersContextKey),this.$scope.filterPanelOptions.filterPanelContext.contextIsReadyToUse?(this.init(),this.$scope.filterPanelOptions.filterPanelContext.stateRestored||this.$scope.filterPanelOptions.filterPanelContext.contextReady.add(function(a,b){f.restoreFavoriteFiltersOrderState()})):(this.$scope.filterPanelOptions.filterPanelContext.contextReady.add(function(a,b){f.init()}),this.$scope.filterPanelOptions.filterPanelContext.setFilterStorageService(g)),this.isTouchable=this.environmentService.isTouchDevice(),this.$scope.dashboardComponent=this.getComponent(),this.$scope.$parent.favoritePanelController=this}return d.prototype.init=function(){var a=this;this.restoreFavoriteFiltersOrderState(),this.filterContextStorage.storageUpdated.add(function(b,d){d.eventType!==c.FilterStorageEventType.Rename&&a.restoreFavoriteFiltersOrderState()}),this.$scope.filterPanelOptions.filterPanelContext.defaultFiltersAvailable()&&this.$scope.filterPanelOptions.filterPanelContext.resetDefaultFilterEvent.add(function(){a.restoreFavoriteFiltersOrderState()})},d.prototype.getComponent=function(){for(var b=this.$scope;b;){if(b.component instanceof a.Component)return b.component;b=b.$parent}return null},d.prototype.restoreFavoriteFiltersOrderState=function(){var b=[],c=this.$scope.filterPanelOptions.filterPanelContext;if(c.defaultFiltersAvailable()){var d=c.defaultFilters.slice(),e=this.filterContextStorage.getFilters().slice();b=d.concat(e)}else b=this.filterContextStorage.getFilters().slice();var f=this.$scope.filterPanelOptions.filterPanelContext.favoriteFiltersOrder;if(f&&f.length){var g=[];f.forEach(function(a){var d=b.filter(function(b){if(c.isSameFilter(b,a))return b});d&&d.length&&g.push(d[0])}),g.length!=b.length&&b.forEach(function(b){a.indexOf(f,function(a){return c.isSameFilter(a,b)})==-1&&g.push(b)}),this.favoriteFilters=g}else this.favoriteFilters=b},d.prototype.applyFilter=function(a){var b=this.$scope.filterPanelOptions.filterPanelContext;if(b.isSameFilter(b.currentFilters,a)){var c=b.isRequiredFilterPresent();b.updateActiveFavoriteFilter(null,!c,!0)}else b.setActiveFavoriteFilter(a),b.updateFilters(a,!0)},d.prototype.setEditMode=function(b,c){this.filterTobeEdited=c.clone(),this.filterName=c.description,this.state=a.validation.ValidationState.Valid,this.message=null,setTimeout(function(){$(".saved-filter-class").focus()}),b.stopPropagation()},d.prototype.delete=function(a){var b=this.filterContextStorage.removeFilter(a.description);if(this.logFilterRepositoryActionResult("Delete",b),b.succeeded){var c=this.$scope.filterPanelOptions.filterPanelContext;c.isSameFilter(c.activeFavoriteFilter,a)&&(c.setActiveFavoriteFilter(null),c.updateActiveFavoriteFilter(null,!1)),c.updateFavoriteFilter(a,null)}},d.prototype.rename=function(b){if(!(b.description===this.filterName||this.filterName&&0===this.filterName.length)){var c=this.filterContextStorage.renameFilter(b.description,this.filterName);if(c.succeeded){var d=this.filterTobeEdited;this.filterName="",this.filterTobeEdited=null,this.state=a.validation.ValidationState.Valid;var e=this.$scope.filterPanelOptions.filterPanelContext;this.message=null,e.isSameFilter(e.activeFavoriteFilter,d)&&(e.setActiveFavoriteFilter(b),e.updateActiveFavoriteFilter(b,!1)),e.updateFavoriteFilter(d,b),this.resetFilterOnToolbar(),this.serializeFavoritesOrder()}else this.state=a.validation.ValidationState.Error,this.message=c.message}},d.prototype.filterShownOnToolbar=function(){return!this.$scope.filterPanelOptions.hideAppliedFiltersToolbar&&this.$scope.filterPanelOptions.filterPanelContext.showFavoriteFiltersOnToolbarInternal},d.prototype.isPinned=function(a){return this.$scope.filterPanelOptions.filterPanelContext.indexOfFavoriteOnToolbar({description:a.description,isDefault:a.isDefault})>=0},d.prototype.pinToToolBar=function(a,b){var c={description:b.description};b.isDefault&&(c.isDefault=!0);var d=this.$scope.filterPanelOptions.filterPanelContext.indexOfFavoriteOnToolbar(c);d>=0?this.$scope.filterPanelOptions.filterPanelContext.favoritesOnToolbar.splice(d,1):(this.$scope.filterPanelOptions.filterPanelContext.favoritesOnToolbar.push(c),this.resetFilterOnToolbar()),this.serializeFavoritesOrder(),a.stopPropagation()},d.prototype.removeFocus=function(){this.filterName="",this.filterTobeEdited=null},d.prototype.handleFilterEditAction=function(b,c){switch(b.keyCode){case a.KeyCodes.ESC:this.removeFocus();break;case a.KeyCodes.ENTER:this.rename(c)}},d.prototype.getClass=function(a){return this.$scope.filterPanelOptions.filterPanelContext.isSameFilter(this.$scope.filterPanelOptions.filterPanelContext.activeFavoriteFilter,a)?"filter-panel-favorite-selected-filter-container":"filter-panel-favorite-normal-filter-container"},d.prototype.logFilterRepositoryActionResult=function(a,c){c.succeeded||this.notificationService.showError(b.Strings.Text_Filter_Panel_Error_Favorite_Filter_Operation_Failed,c.message);
},d.prototype.dragStart=function(a,b,c){var d=document.createElement("div"),e=this.$scope.filterPanelOptions.filterPanelContext;d.textContent=this.favoriteFilters[b].description,d.classList.add(e.isSameFilter(e.activeFavoriteFilter,a)?"filter-panel-favorite-filter-ghost-selected-filter":"filter-panel-favorite-filter-ghost-normal-filter"),c.setDragPlaceholder(d,25,25),c.setData("FavFilter",{filterIndex:b})},d.prototype.dragEnd=function(){this.droppingIndex=-1},d.prototype.drop=function(a){if(a.getData("FavFilter")){var b=a.getData("FavFilter");this.droppingIndex!==-1&&this.moveFilter(b.filterIndex,this.draggedOnIndex)}this.droppingIndex=-1},d.prototype.dragOver=function(b,c){var d=a.DnDDropEffect.None;if(c.getData("FavFilter")){var e=c.getData("FavFilter");b===-2?d=e.filterIndex===this.draggedOnIndex?a.DnDDropEffect.None:a.DnDDropEffect.Move:(this.draggedOnIndex=b,e.filterIndex<b?(this.droppingIndex=b+1,d=a.DnDDropEffect.Move):e.filterIndex>b?(this.droppingIndex=b,d=a.DnDDropEffect.Move):this.droppingIndex=-1)}return d},d.prototype.moveFilter=function(a,b){var c=this.favoriteFilters,d=c[a];a>b?(c.splice(a,1),c.splice(b,0,d)):a<b&&(c.splice(b+1,0,d),c.splice(a,1)),this.serializeFavoritesOrder(),this.resetFilterOnToolbar()},d.prototype.serializeFavoritesOrder=function(){this.$scope.filterPanelOptions.filterPanelContext.favoriteFiltersOrder=this.favoriteFilters.map(function(a){return{description:a.description,isDefault:a.isDefault}}),this.$scope.filterPanelOptions.filterPanelContext.raiseStateChanged()},d.prototype.resetFilterOnToolbar=function(){var b=this.$scope.filterPanelOptions.filterPanelContext,c=b.favoritesOnToolbar.splice(0);this.favoriteFilters.forEach(function(d){a.indexOf(c,function(a){return b.isSameFilter(a,d)})>=0&&b.favoritesOnToolbar.push({description:d.description,isDefault:d.isDefault})})},d}();c.FavoritePanelController=d,angular.module("ionwebGrids").controller("ionweb.favoritePanelController",["$scope","ionweb.notificationService","ionweb.environmentService","ionweb.filterStorageProviderService",function(a,b,c,e){return new d(a,b,c,e)}])}(c=b.xrs||(b.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){"undefined"!=typeof angular&&angular.module("ionwebGrids").directive("ionwebFilterPanelToolbar",function(){return{restrict:"E",templateUrl:"grids.ui/filterPanel/filterPanelToolbar.tpl.html"}})}(b=a.xrs||(a.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){angular.module("ionwebGrids").directive("ionwebTextFilter",function(){return{restrict:"E",scope:{field:"@?",isVisible:"=?",isDisabled:"=?",filterNode:"=?",label:"@?",filterUpdatedEvent:"=?",item:"=?",operator:"@?"},controller:["$scope","$element",function(a,b){return new d(a,b)}],templateUrl:"grids.ui/filterPanel/textFilter.tpl.html"}});var d=function(){function d(b,c){var d=this;this.scope=b,this.$element=c,this.xrsOperatorRegistry=new a.xrs.XrsOperatorsRegistry,void 0!==this.scope.item&&null!==this.scope.item||(this.scope.item={id:this.scope.field,displayName:this.scope.label,filterNode:this.scope.filterNode,visible:this.scope.isVisible,enabled:this.scope.isDisabled!==!0,filterUpdated:this.scope.filterUpdatedEvent},this.scope.$watch("filterNode",function(a,b){d.handleConditionChanged(a,b)}),this.scope.$watch("isVisible",function(a){void 0!==a&&(d.scope.item.visible=a)})),this.scope.item.filterNode&&(this.scope.value=this.extractValueFromCondition(this.scope.item.filterNode),this.scope.excludedFilter=this.scope.item.filterNode.isExcluded()),this.scope.$watch("excludedFilter",function(a,b){if(a!==b){if(d.scope.value&&0!==d.scope.value.length)d.scope.item.filterNode=d.createFilterCondition(d.scope.item.id,d.scope.value,d.scope.item.displayName);else{if(d.scope.item&&d.scope.item.required)return;d.createEmptyNode()}d.raiseValueChangedEvent()}}),this.scope.$watch("item.filterNode",function(a,b){!a&&!b||a&&a.equals(b)||(d.handleConditionChanged(a,b),d.scope.filterNode=d.scope.item.filterNode&&d.scope.item.filterNode.clone()||null)}),this.scope.$watch("item.required",function(a,b){a===!0?d.scope.value||d.setValidationStateForRequiredValue():d.clearValidationStateForRequiredValue()}),this.scope.$watch("value",function(b,c){if(b!==c){d.scope.item&&d.scope.item.required&&(b&&0!==b.length?d.clearValidationStateForRequiredValue():d.setValidationStateForRequiredValue());var e=a.getService("$timeout");d.throttleTimer&&e.cancel(d.throttleTimer),d.throttleTimer=e(function(){d.scope.item.filterNode=d.createFilterCondition(d.scope.item.id,d.scope.value,d.scope.item.displayName),d.raiseValueChangedEvent()},500)}}),this.scope.handleFocusLost=function(){d.handleFocusLost()},this.scope.handleFocusGot=function(){d.handleFocusGot()},this.scope.handleEnter=function(b){b.which==a.KeyCodes.ENTER&&(d.scope.item.filterNode=d.createFilterCondition(d.scope.item.id,d.scope.value,d.scope.item.displayName),setTimeout(function(){d.raiseEnterKeyEvent()},0))}}return d.prototype.clearValidationStateForRequiredValue=function(){this.scope.item.internalValidationState=this.scope.item.validationState?this.scope.item.validationState:a.validation.ValidationState.Valid,(this.scope.item.internalValidationState=a.validation.ValidationState.Valid)&&(this.scope.item.internalValidationMessage=null)},d.prototype.setValidationStateForRequiredValue=function(){this.scope.item.internalValidationState=a.validation.ValidationState.Error,this.scope.item.missingRequiredMessage&&this.scope.item.missingRequiredMessage.length>0?this.scope.item.internalValidationMessage=this.scope.item.missingRequiredMessage:this.scope.item.internalValidationMessage=b.Strings.Text_Filter_Panel_Missing_Required_Value},d.prototype.handleFocusLost=function(){this.scope.value!==this.valueOnFocus&&(this.scope.item.filterNode=this.createFilterCondition(this.scope.item.id,this.scope.value,this.scope.item.displayName))},d.prototype.handleFocusGot=function(){this.valueOnFocus=this.scope.value},d.prototype.handleConditionChanged=function(a,b){if(void 0==a||null==a)return this.scope.excludedFilter=!1,this.scope.value="",void(this.scope.item&&this.scope.item.required&&this.setValidationStateForRequiredValue());if(a!==b){var c=a,d=b;c.equals(d)||(this.scope.excludedFilter=c.isExcluded(),this.scope.value=this.extractValueFromCondition(c),this.scope.item&&this.scope.item.required&&this.scope.value&&this.scope.value.length>0&&this.clearValidationStateForRequiredValue())}},d.prototype.extractValueFromCondition=function(a){var b=a.values[0]&&""!=a.values[0].value.toString()?a.values[0].displayValue.toString():"";return b},d.prototype.createFilterCondition=function(a,b,d){if(b&&b.length||this.scope.excludedFilter){var e=new c.FilterCondition;return e.description=b,e.field=a,e.id=a,e.fieldDisplayName=d,e.operator=this.setOperator(),e.values=[new c.FilterValue(b,b)],e}},d.prototype.createEmptyNode=function(){this.scope.excludedFilter?this.scope.item.filterNode=this.createFilterCondition(this.scope.item.id,"",this.scope.item.displayName):this.scope.item.filterNode=void 0},d.prototype.setOperator=function(){var a;return a=this.scope.excludedFilter?this.xrsOperatorRegistry.notEquals.id:this.scope.operator?this.scope.operator:this.xrsOperatorRegistry.equals.id},d.prototype.raiseEnterKeyEvent=function(){this.scope.item.filterUpdated&&this.scope.item.filterUpdated.raise(this,{fireQuery:!0})},d.prototype.raiseValueChangedEvent=function(){this.scope.item.valueChanged&&this.scope.item.valueChanged.raise(this,{newValue:this.scope.value})},d}()}(c=b.xrs||(b.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function d(){}return d.getFilterValue=function(a,d){var e=new c.FilterValue(a,d?d:b.Strings.Value_Filter_Panel_Util_Unspecified_Value);return e},d.getRangeFilterValues=function(a,c,e,f){var g=[];return g.push(d.getFilterValue(a,e?e:b.Strings.Value_Filter_Panel_Util_Unspecified_Value)),g.push(d.getFilterValue(c,f?f:b.Strings.Value_Filter_Panel_Util_Unspecified_Value)),g},d.getCondition=function(a,b,d,e){var f=new c.FilterCondition;return f.enabled=!0,f.field=a,f.operator=b,f.values=d,f.tag=a,f.description=e,f},d.getRangeOpenInterval=function(a,b,c,e,f){var g=d.getRangeFilterValues(b,c,e,f);return d.getCondition(a,d.xrsOperators.rangeOpenInterval.id,g)},d.getRangeClosedInterval=function(a,b,c,e,f){var g=d.getRangeFilterValues(b,c,e,f);return d.getCondition(a,d.xrsOperators.rangeClosedInterval.id,g)},d.getRangeLeftOpenInterval=function(a,b,c,e,f){var g=d.getRangeFilterValues(b,c,e,f);return d.getCondition(a,d.xrsOperators.rangeLeftOpenInterval.id,g)},d.getRangeRightOpenInterval=function(a,b,c,e,f){var g=d.getRangeFilterValues(b,c,e,f);return d.getCondition(a,d.xrsOperators.rangeRightOpenInterval.id,g)},d.getGreaterThan=function(a,b,e){return d.getCondition(a,d.xrsOperators.greaterThan.id,[new c.FilterValue(b,e)])},d.getGreaterThanOrEquals=function(a,b,e){return d.getCondition(a,d.xrsOperators.greaterThanOrEqualsTo.id,[new c.FilterValue(b,e)])},d.getLessThan=function(a,b,e){return d.getCondition(a,d.xrsOperators.lessThan.id,[new c.FilterValue(b,e)])},d.getLessThanOrEquals=function(a,b,e){return d.getCondition(a,d.xrsOperators.lessThanOrEqualsTo.id,[new c.FilterValue(b,e)])},d.getIn=function(a,e,f){if(f&&e.length!==f.length)throw new Error(b.Strings.Text_Filter_Panel_Error_Util_In_Operator);for(var g=[],h=0;h<e.length;h++)f?g.push(new c.FilterValue(e[h],f[h])):g.push(new c.FilterValue(e[h],void 0));var i=d.getCondition(a,d.xrsOperators.in.id,g);return f&&(i.description=f.join(", ")),i},d.getNotEquals=function(a,b,e){return d.getCondition(a,d.xrsOperators.notEquals.id,[new c.FilterValue(b,e)])},d.getEquals=function(a,b,e){return d.getCondition(a,d.xrsOperators.equals.id,[new c.FilterValue(b,e)])},d.getEqualsCaseInsensitive=function(a,b,e){return d.getCondition(a,d.xrsOperators.equalsCaseInsensitive.id,[new c.FilterValue(b,e)])},d.getNotEqualsCaseInsensitive=function(a,b,e){return d.getCondition(a,d.xrsOperators.notEqualsCaseInsensitive.id,[new c.FilterValue(b,e)])},d.getNotNode=function(a){return new c.FilterNotNode(a)},d.getOrNode=function(a){return new c.FilterOrNode(a)},d.getAndNode=function(a){return new c.FilterAndNode(a)},d.getNotRootNode=function(a){return d.getRootNode([d.getNotNode(a)])},d.getOrRootNode=function(a){return d.getRootNode([d.getOrNode(a)])},d.getAndRootNode=function(a){return d.getRootNode([d.getAndNode(a)])},d.getRootNode=function(a){return new c.FilterRootNode(a)},d.xrsOperators=new a.xrs.XrsOperatorsRegistry,d}();c.FilterUtil=d}(c=b.xrs||(b.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={})),function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.xrs.FilterUtil);a.FilterUtil=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function d(b,c,d){void 0===d&&(d=!1),this.applyOnFilterValueChange=d,this.filtersUpdatedEvent=new a.Event,this.filtersCancelledEvent=new a.Event,this.filterQueryStatusUpdatedEvent=new a.Event,this.activeFavoriteFilterUpdatedEvent=new a.Event,this.favoriteFilterUpdatedEvent=new a.Event,this.stateChangedEvent=new a.Event,this._currentFilters=null,this._currentStatus=null,this._sharedFiltersContextKey=null,this._filterMap={},this.contextReadyEvent=new a.Event,this.hideFavoriteFilters=!1,this._stateRestored=!1,this._activeDefaultFilter=null,this._filterOrderFromState=[],this.showFavoriteFiltersOnToolbar=!1,this.resetDefaultFilterEvent=new a.Event,this._sharedFiltersContextKey=b,this.showFavoriteFiltersOnToolbar=c,this._favoritesOnToolbar=[],this._hiddenFilterItems=[]}return Object.defineProperty(d.prototype,"sharedFiltersContextKey",{get:function(){return this._sharedFiltersContextKey},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"filtersCancelled",{get:function(){return this.filtersCancelledEvent},enumerable:!0,configurable:!0}),d.prototype.cancelApplyFilters=function(){this.filtersCancelledEvent.raise(this,{})},d.prototype.updateFilters=function(a,b){this._currentFilters=a,this.updateFilterItems(this._currentFilters),this.raiseFiltersUpdatedEvent(a,b),this.raiseStateChanged()},d.prototype.raiseFiltersUpdatedEvent=function(a,b){var c=this;this._throttleFiltersUpdatedTimer&&clearTimeout(this._throttleFiltersUpdatedTimer),this._throttleFiltersUpdatedTimer=setTimeout(function(){c.filtersUpdatedEvent.raise(c,{filterTree:a,fireQuery:b})},0)},d.prototype.updateFilterValue=function(a,b,c){void 0===c&&(c=!1);var d=this.filterMap[a];if(d&&(d.filterNode=b,c||this.applyOnFilterValueChange)){var e=this.validateAndCreateFilterTree();e&&(e.description=this.getActiveFavoriteFilterName(),this.updateFilters(e,c&&this._contextIsReadyToUse||this.applyOnFilterValueChange&&!this.shouldBeginApplyOnValueChange))}},d.prototype.validateAndCreateFilterTree=function(){function d(c){h=!0,c.internalValidationState=a.validation.ValidationState.Error,c.missingRequiredMessage&&c.missingRequiredMessage.length?c.internalValidationMessage=c.missingRequiredMessage:c.internalValidationMessage=b.Strings.Text_Filter_Panel_Missing_Required_Value}function e(b){b.internalValidationState=b.validationState||a.validation.ValidationState.Valid,b.internalValidationState==a.validation.ValidationState.Valid&&(b.internalValidationMessage=null)}var f=this,g=[],h=!1;if(Object.keys(this.filterMap).forEach(function(c){var i=f.filterMap[c];if(i.internalValidationState===a.validation.ValidationState.Error)return void(h=!0);if(!i.filterNode)return void(i.required&&d(i));var j=i.filterNode;if(j.nodeType===b.NodeType.Condition){var k=i.filterNode;if(!k.values||0===k.values.length)return void(i.required===!0&&d(i));i.required===!0&&e(i),j.fieldDisplayName=i.displayName,g.push(j)}else{if(j.nodeType!==b.NodeType.And)throw new TypeError(a.stringFormat(b.Strings.Text_Filter_Panel_Exception_Create_Filter_Tree,{nodeType:j.nodeType}));var l=i.filterNode;if(!l.children||0===l.children.length)return;l.fieldDisplayName=i.displayName,g.push(l)}}),h)return null;var i=c.FilterRootNodeBuilder.buildFilterTree(g);return i},d.prototype.updateFiltersInternal=function(a,b,c,d){if(void 0===c&&(c=!1),void 0===d&&(d=!0),this._currentFilters=a,d&&this.updateFilterItems(this._currentFilters),c&&b){var e=this.isAllFilterValid();b=e||this._currentFilters.description&&this._currentFilters.description.length>0}this.raiseFiltersUpdatedEvent(a,b),!c&&d&&this.raiseStateChanged()},Object.defineProperty(d.prototype,"enableExclude",{get:function(){return this._enableExclude},set:function(a){if(this._enableExclude=a,this.items)for(var b=0,c=this.items.length;b<c;b++)this.items[b].enableExclude=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"items",{get:function(){return this._items},set:function(b){this._items=b;for(var c=0,d=this.items.length;c<d;c++){var e=this.items[c];e.enableExclude=this.enableExclude,this.filterMap[e.id]=e,e.valueChanged||(e.valueChanged=new a.Event),e.displayValueChanged||(e.displayValueChanged=new a.Event)}},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"filtersUpdated",{get:function(){return this.filtersUpdatedEvent},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"currentFilters",{get:function(){return this._currentFilters},enumerable:!0,configurable:!0}),d.prototype.updateFilterQueryStatus=function(a,b){this._currentStatus={status:a,statusMsg:b},this.filterQueryStatusUpdatedEvent.raise(this,{status:a,statusMsg:b})},Object.defineProperty(d.prototype,"filterQueryStatusEvent",{get:function(){return this.filterQueryStatusUpdatedEvent},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"currentStatus",{get:function(){return this._currentStatus},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"currentFavoriteFilterUpdated",{get:function(){return this._isCurrentFavoriteFilterUpdated},enumerable:!0,configurable:!0}),d.prototype.setCurrentFavoriteFilterUpdated=function(a){this._isCurrentFavoriteFilterUpdated=a},d.prototype.isRequiredFilterPresent=function(){if(!this.items)return!1;var a=this.items.filter(function(a){return a.required===!0})[0];return!!a},Object.defineProperty(d.prototype,"isFilterInErrorState",{get:function(){return this._isFilterInErrorState},set:function(a){this._isFilterInErrorState=a},enumerable:!0,configurable:!0}),d.prototype.isAllFilterValid=function(){if(this.isFilterInErrorState=!1,!this.items)return!0;for(var c=0,d=this.items.length;c<d;c++){var e=this.items[c];if(e.internalValidationState===a.validation.ValidationState.Error)this.isFilterInErrorState=!0;else if(e.required){var f=e.filterNode;if(f){if(f.nodeType===b.NodeType.Condition){var g=e.filterNode;g.values&&0!==g.values.length||(this.isFilterInErrorState=!0)}}else this.isFilterInErrorState=!0}if(this.isFilterInErrorState===!0)return!1}return!0},d.prototype.getIconClass=function(){return this.isFilterInErrorState?"filter-panel-invalid-filter-icon":""},d.prototype.getIconTitle=function(){return this.isFilterInErrorState?b.Strings.Err_Filter_Panel_Invalid_Filter_Value:b.Strings.Text_Filter_Chooser_Title},d.prototype.updateActiveFavoriteFilter=function(a,b,d){var e=this;if(this._pauseApplyOnValueChange=!0,this.activeFavoriteFilterUpdatedEvent.raise(this,{filterTree:a,fireQuery:b,clear:d}),d){this.setActiveFavoriteFilter(null);var f=new c.FilterRootNode,g=this.isRequiredFilterPresent();this.updateFilters(f,!g)}setTimeout(function(){e._pauseApplyOnValueChange=!1},1e3)},Object.defineProperty(d.prototype,"activeFavoriteFilterUpdated",{get:function(){return this.activeFavoriteFilterUpdatedEvent},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"favoritesOnToolbar",{get:function(){return this._favoritesOnToolbar},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"favoriteFilterUpdated",{get:function(){return this.favoriteFilterUpdatedEvent},enumerable:!0,configurable:!0}),d.prototype.updateFavoriteFilter=function(a,b){this.favoriteFilterUpdated.raise(this,{oldFilter:a,newFilter:b})},Object.defineProperty(d.prototype,"stateChanged",{get:function(){return this.stateChangedEvent},enumerable:!0,configurable:!0}),d.prototype.raiseStateChanged=function(){this.stateChangedEvent.raise(this,this.getState())},d.prototype.getState=function(){function a(a){return a?a.filter(function(a){return!a.isDefault}).map(function(a){return a.description}):[]}return{version:118,filtersOnToolbar:this._favoritesOnToolbar,filtersOrder:this._favoriteFiltersOrder,favoritesOnToolbar:a(this._favoritesOnToolbar),favoriteFiltersOrder:a(this._favoriteFiltersOrder),selectedFilter:this._currentFilters&&this._currentFilters.toJSON(),showFavoriteFiltersInToolbar:this.showFavoriteFiltersOnToolbarInternal,showDefaultFiltersOnToolbar:this.showDefaultFiltersOnToolbarInternal,filterItemsOrder:this._filterItemsOrder,hiddenFilterItems:this._hiddenFilterItems}},d.prototype.setState=function(a){function b(a){return a?a.map(function(a){return{description:a}}):[]}var d=a&&a;if(d){if(d.selectedFilter){var e=new c.FilterRootNode,f=e.fromJSON(d.selectedFilter);this._currentFilters=f}d.version>=118?(d.filtersOnToolbar&&(this._favoritesOnToolbar=d.filtersOnToolbar),d.filtersOrder&&(this._favoriteFiltersOrder=d.filtersOrder)):(d.favoritesOnToolbar&&(this._favoritesOnToolbar=b(d.favoritesOnToolbar)),d.favoriteFiltersOrder&&(this._favoriteFiltersOrder=b(d.favoriteFiltersOrder))),this._showFavoriteFiltersOnToolbarInternal=d.showFavoriteFiltersInToolbar,this._showDefaultFiltersOnToolbarInternal=d.showDefaultFiltersOnToolbar,this._filterItemsOrder=d.filterItemsOrder,this._hiddenFilterItems=d.hiddenFilterItems}this._favoritesOnToolbar||(this._favoritesOnToolbar=[]),this._favoriteFiltersOrder||(this._favoriteFiltersOrder=[]),this._filterItemsOrder||(this._filterItemsOrder=[]),this._hiddenFilterItems||(this._hiddenFilterItems=[]),this._stateRestored=!0,this.refreshContext()},d.prototype.setFilterStorageService=function(a){this._filterStorageService||(this._filterStorageService=a,this.refreshContext())},d.prototype.getFilterStorageService=function(){return this._filterStorageService},d.prototype.refreshContext=function(){if(this.reconcileFavoritesOnToolbar(this._favoritesOnToolbar),this.reconcileStateForDefaultFilters(),this._filterStorageService){if(this._currentFilters)if(this._currentFilters.description){var a,b=this._filterStorageService.loadContextStorage(this._sharedFiltersContextKey);a=this._currentFilters.isDefault?this.getDefaultFilter(this._currentFilters.description):b.getFilter(this._currentFilters.description),a?(this.setActiveFavoriteFilter(a),this.updateFiltersInternal(a,!0,!0)):this.updateFiltersInternal(this._currentFilters,!0,!0)}else this.updateFiltersInternal(this._currentFilters,!0,!0);else!this._stateRestored&&this._activeDefaultFilter&&(this.updateActiveFavoriteFilter(this._activeDefaultFilter),this.updateFiltersInternal(this._activeDefaultFilter,!0,!0));this._contextIsReadyToUse=!0,this.contextReadyEvent.raise(this,null)}},d.prototype.reconcileStateForDefaultFilters=function(){var b=this;if(this.defaultFiltersAvailable()){var c=this.defaultFilters.slice().map(function(a){return{description:a.description,isDefault:a.isDefault}}).reverse();this._favoritesOnToolbar=this._favoritesOnToolbar&&this._favoritesOnToolbar.filter(function(c){return!c.isDefault||c.isDefault&&a.indexOf(b.defaultFilters,function(a){return b.isSameFilter(c,a)})>=0}),this._favoriteFiltersOrder=this._favoriteFiltersOrder&&this._favoriteFiltersOrder.filter(function(c){return!c.isDefault||c.isDefault&&a.indexOf(b.defaultFilters,function(a){return b.isSameFilter(c,a)})>=0});for(var d=0;d<c.length;d++)this.showDefaultFiltersOnToolbarInternal&&this.indexOfFavoriteOnToolbar(c[d])===-1&&this._favoritesOnToolbar.unshift(c[d]),this._favoriteFiltersOrder&&this._favoriteFiltersOrder.length&&this.indexOfFavoriteInFilterOrder(c[d])===-1&&this._favoriteFiltersOrder.unshift(c[d])}},d.prototype.reconcileFavoritesOnToolbar=function(b){var c=this;if(this._filterStorageService){var d=this._filterStorageService.loadContextStorage(this._sharedFiltersContextKey),e=d.getFilters();this.defaultFiltersAvailable()&&(e=e.concat(this.defaultFilters));var f=[];if(e&&e.length){if(this._favoriteFiltersOrder&&this._favoriteFiltersOrder.length){var g=this._favoriteFiltersOrder.slice(0);this._favoriteFiltersOrder=this._favoriteFiltersOrder.filter(function(b){return a.indexOf(e,function(a){return c.isSameFilter(b,a)})>=0}),g.length!==this._favoriteFiltersOrder.length&&(this._filterOrderFromState=g.slice(0)),e.forEach(function(a){var b={description:a.description};a.isDefault&&(b.isDefault=!0),c.indexOfFavoriteInFilterOrder(b)===-1&&c._favoriteFiltersOrder.push(b)}),this._favoriteFiltersOrder.forEach(function(d){a.indexOf(b,function(a){return c.isSameFilter(a,d)})>=0&&a.indexOf(f,function(a){return c.isSameFilter(a,d)})===-1&&f.push(d)})}else b.forEach(function(b){a.indexOf(e,function(a){return c.isSameFilter(a,b)})>=0&&a.indexOf(f,function(a){return c.isSameFilter(a,b)})===-1&&f.push(b)});this._favoritesOnToolbar=f.slice(0)}}},d.prototype.setActiveFavoriteFilter=function(a){var b=this;this._pauseApplyOnValueChange=!0,this._activeFavoriteFilter=a&&a.clone(),setTimeout(function(){b._pauseApplyOnValueChange=!1},1e3)},Object.defineProperty(d.prototype,"activeFavoriteFilter",{get:function(){return this._activeFavoriteFilter},enumerable:!0,configurable:!0}),d.prototype.isActiveFavoriteFilterUpdated=function(a){return!(!this._activeFavoriteFilter||!a)&&(a.description=this._activeFavoriteFilter.description,!a.equals(this._activeFavoriteFilter))},d.prototype.getActiveFavoriteFilterName=function(){return this._activeFavoriteFilter?this._activeFavoriteFilter.description:null},d.prototype.isShowFavoriteFiltersStateSaved=function(){return void 0!==this._showFavoriteFiltersOnToolbarInternal},Object.defineProperty(d.prototype,"showFavoriteFiltersOnToolbarInternal",{get:function(){return this.isShowFavoriteFiltersStateSaved()?this._showFavoriteFiltersOnToolbarInternal:this.showFavoriteFiltersOnToolbar},set:function(a){this._showFavoriteFiltersOnToolbarInternal=a},enumerable:!0,configurable:!0}),d.prototype.isShowDefaultFilterStateSaved=function(){return void 0!==this._showDefaultFiltersOnToolbarInternal},Object.defineProperty(d.prototype,"showDefaultFiltersOnToolbarInternal",{get:function(){return this.isShowDefaultFilterStateSaved()?this._showDefaultFiltersOnToolbarInternal:this._showDefaultFiltersOnToolbar},set:function(a){this._showDefaultFiltersOnToolbarInternal=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"filterMap",{get:function(){return this._filterMap},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"filterItemsOrder",{get:function(){return this._filterItemsOrder},set:function(a){this._filterItemsOrder=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"hiddenFilterItems",{get:function(){return this._hiddenFilterItems},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"favoriteFiltersOrder",{get:function(){return this._favoriteFiltersOrder},set:function(a){this._favoriteFiltersOrder=a},enumerable:!0,configurable:!0}),d.prototype.indexOfFavoriteOnToolbar=function(b){var c=this;return a.indexOf(this.favoritesOnToolbar,function(a){return c.isSameFilter(a,b)})},d.prototype.indexOfFavoriteInFilterOrder=function(b){var c=this;return a.indexOf(this.favoriteFiltersOrder,function(a){return c.isSameFilter(a,b)})},d.prototype.isSameFilter=function(a,b){var c;return c=!(!a||!b)&&(a.description===b.description&&!a.isDefault==!b.isDefault)},Object.defineProperty(d.prototype,"contextIsReadyToUse",{get:function(){return this._contextIsReadyToUse},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"stateRestored",{get:function(){return this._stateRestored},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"shouldBeginApplyOnValueChange",{get:function(){return this._shouldBeginApplyOnValueChange},set:function(a){this._shouldBeginApplyOnValueChange=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"contextReady",{get:function(){return this.contextReadyEvent},enumerable:!0,configurable:!0}),d.prototype.shouldApplyOnValueChange=function(){return this.applyOnFilterValueChange&&!this._pauseApplyOnValueChange},Object.defineProperty(d.prototype,"isFilterPanelInitialized",{get:function(){return this._isFilterPanelInitialized},set:function(a){this._isFilterPanelInitialized=a},enumerable:!0,configurable:!0}),d.prototype.updateFilterItems=function(a){var b=c.FilterRootNodeBuilder.extractFilterNodes(a);for(var d in this.filterMap)if(b&&b.hasOwnProperty(d)){var e=b[d].clone();this.filterMap[d].filterNode=e}else this.filterMap[d].filterNode=null},d.prototype.setDefaultFilters=function(b,c,d){var e=this;if(this.defaultFilters=b,c&&c.length&&(this._activeDefaultFilter=this.getDefaultFilter(c)),this._showDefaultFiltersOnToolbar=d,this._stateRestored?this.reconcileStateForDefaultFilters():this.contextIsReadyToUse&&(this.reconcileStateForDefaultFilters(),this._activeDefaultFilter&&(this.setActiveFavoriteFilter(this._activeDefaultFilter),this.updateFiltersInternal(this._activeDefaultFilter,!0))),this._filterOrderFromState.length){for(var f=[],g=function(b){(h.indexOfFavoriteInFilterOrder(h._filterOrderFromState[b])>=0||a.indexOf(h.defaultFilters,function(a){return e.isSameFilter(a,e._filterOrderFromState[b])})>=0)&&f.push(h._filterOrderFromState[b])},h=this,i=0;i<this._filterOrderFromState.length;i++)g(i);if(f.length!==this.favoriteFiltersOrder.length)for(var j=function(b){a.indexOf(f,function(a){return e.isSameFilter(a,e.favoriteFiltersOrder[b])})===-1&&f.push(k.favoriteFiltersOrder[b])},k=this,i=0;i<this.favoriteFiltersOrder.length;i++)j(i);this.favoriteFiltersOrder=f.slice(0);var l=[];this._favoriteFiltersOrder.forEach(function(a){e.indexOfFavoriteOnToolbar(a)>=0&&l.push({description:a.description,isDefault:a.isDefault})}),this._favoritesOnToolbar=l.slice(0)}if(this._stateRestored&&this._currentFilters&&this._currentFilters.isDefault){var m=this.getDefaultFilter(this._currentFilters.description);m?this._currentFilters.description!==this.getActiveFavoriteFilterName()&&this.setActiveFavoriteFilter(m):(this._currentFilters.description="",this.setActiveFavoriteFilter(this._currentFilters))}this.resetDefaultFilterEvent.raise(this,{})},Object.defineProperty(d.prototype,"defaultFilters",{get:function(){return this._defaultFilters},set:function(a){if(this._defaultFilters=a,this._defaultFilters){var b=0;this._defaultFilters.forEach(function(a){a.description&&0!==a.description.length||(b++,a.description="Default_"+b),a.isDefault=!0})}},enumerable:!0,configurable:!0}),d.prototype.getDefaultFilter=function(a){var b;if(this.defaultFiltersAvailable())for(var c=0;c<this.defaultFilters.length;c++)if(this.defaultFilters[c].description===a){b=this.defaultFilters[c];break}return b},d.prototype.defaultFiltersAvailable=function(){return this.defaultFilters&&this.defaultFilters.length>0},d.prototype.isDefaultFilterSelected=function(){return this.defaultFiltersAvailable()&&this.activeFavoriteFilter&&this.activeFavoriteFilter.isDefault},d}();c.FilterPanelContext=d}(c=b.xrs||(b.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={})),function(a){var b;!function(a){var b=function(a){function b(b,c,d){return void 0===d&&(d=!1),a.call(this,b,c,d)||this}return __extends(b,a),b}(a.xrs.FilterPanelContext);a.FilterPanelContext=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(){this.restrict="E",this.scope={filterTitle:"=?",excluded:"=?",enableExclude:"=?"},this.templateUrl="grids.ui/filterPanel/filterLabel/filterLabel.tpl.html",this.controller=c,this.controllerAs="ctrl",this.bindToController=!0}return a}(),c=function(){function a(a){this.$scope=a}return a.prototype.toggleExcluded=function(){this.$scope.ctrl.enableExclude&&(this.$scope.ctrl.excluded=!this.$scope.ctrl.excluded)},a.$inject=["$scope"],a}();angular.module("ionwebGrids").directive("ionwebFilterLabel",function(){return new b})}(b=a.xrs||(a.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d;!function(a){a[a.None=0]="None",a[a.Adding=1]="Adding",a[a.Overwriting=2]="Overwriting"}(d=c.SaveAsMode||(c.SaveAsMode={})),angular.module("ionwebGrids").controller("ionweb.tables.filtersPanelController",["$scope","ionweb.filterStorageProviderService","ionweb.notificationService","ionweb.loggerFactory","ionweb.contextMenuService",function(a,b,c,d,f){return new e(a,b,c,d,f)}]),angular.module("ionwebGrids").directive("ionwebFilterPanel",["ionweb.filterStorageProviderService","ionweb.notificationService","ionweb.loggerFactory","ionweb.contextMenuService","ionweb.environmentService","$templateCache","$compile",function(b,c,d,f,g,h,i){var j={templateUrl:"grids.ui/filterPanel/filterPanelDirective.tpl.html",restrict:"EA",scope:!0,link:function(j,k,l){function m(){var a=j.filterPanelOptions.filterPanelContext.hiddenFilterItems;a&&a.length>0&&a.forEach(function(a){var b=j.items.filter(function(b){return b.displayName===a})[0];b&&(j.items[j.items.indexOf(b)].visible=!1)})}function n(){var a=j.filterPanelOptions.filterPanelContext.filterItemsOrder;if(a&&a.length){var b=[];a.forEach(function(a){var c=j.items.filter(function(b){if(b.id==a)return b});c&&c.length&&b.push(c[0])}),b.length!=j.items.length&&j.items.forEach(function(c){a.indexOf(c.id)==-1&&b.push(c)}),j.reorderedItems=b,j.refreshFilters()}}function o(){for(var b=j;b;){if(b.component instanceof a.Component)return b.component;b=b.$parent}return null}j.filterPanelOptions.filterPanelContext.contextReady.add(function(){m(),j.filterPanelOptions.filterTemplateScope&&n()}),!j.filterPanelOptions&&l.filterPanelOptions&&(j.filterPanelOptions=j.$eval(l.filterPanelOptions));
var p,q=g.isTouchDevice()?"":" non-touch-device";if(j.items=j.filterPanelOptions.filterPanelContext.items||j.filterPanelOptions.items,!j.items)throw new Error("Filter items are missing");j.filterPanelOptions.filterTemplateScope&&(j.reorderedItems=j.items.slice(),j.refreshFilters=function(){k.find(".filter-panel-content-dynamic-filters").empty(),p&&p.$destroy(),p=j.filterPanelOptions.filterTemplateScope.$new(),p.$on("$destroy",function(){p=null});for(var a=0;a<j.reorderedItems.length;a++){var b=j.reorderedItems[a],c=b.filterTemplate&&h.get(b.filterTemplate)||b.filterTemplate;if(c){var d=i(c)(p),e=i('<div ionweb-droppable drag-leave="dragLeave('+a+', $dataTransfer)" drag-over="dragOver('+a+', $dataTransfer, $event)" ng-show="reorderedItems['+a+'].visible" class="ionweb-filter-panel-dnd-container ionweb-filter-panel-dnd-container-'+a+'" ng-class="{\'ionweb-filter-panel-dnd-container-hover\': dashboardComponent.editMode}"><ionweb-icon icon="dragHandler" ng-show="reorderedItems.length > 1 && dashboardComponent.editMode" ionweb-draggable drag-start="dragStart('+a+', $dataTransfer)" drag-end="dragEnd('+a+', $dataTransfer)" class="ionweb-filter-panel-dnd-handle'+q+' + "></ionweb-icon></div>')(j);$(e).append(d);var f=k.find(".filter-panel-content-dynamic-filters");f.append(e)}}},n(),j.refreshFilters()),m(),j.dragStart=function(b,c){var d=document.createElement("div");d.classList.add("ionweb-filter-panel-dnd-preview"),d.textContent=j.reorderedItems[b].displayName,c.setDragPlaceholder(d,25,25),c.setEffectAllowed(a.DnDEffectAllowed.Move),c.setData("filterItem",{index:b})},j.dragEnd=function(a,b){j.droppingIndex=-1},j.drop=function(a){if(a.getData("filterItem")){var b=a.getData("filterItem"),c=j.draggedOnIndex;if(c!==b.index){var d=j.reorderedItems[b.index];b.index>c?(j.reorderedItems.splice(b.index,1),j.reorderedItems.splice(c,0,d)):b.index<c&&(j.reorderedItems.splice(c+1,0,d),j.reorderedItems.splice(b.index,1)),j.filterPanelOptions.filterPanelContext.filterItemsOrder=j.reorderedItems.map(function(a){return a.id}),j.filterPanelOptions.filterPanelContext.raiseStateChanged()}}j.droppingIndex=-1,j.refreshFilters()},j.dragLeave=function(a,b){a===-2&&(a=j.reorderedItems.length-1);var c=$(".ionweb-filter-panel-dnd-container-"+a);c.removeClass("ionweb-filter-panel-dnd-below-decorator"),c.removeClass("ionweb-filter-panel-dnd-above-decorator")},j.dragOver=function(b,c,d){d&&d.stopPropagation();var e=a.DnDDropEffect.None;if(c.getData("filterItem")){var f,g=c.getData("filterItem");b===-2?(f=$(k).find(".ionweb-filter-panel-dnd-container-"+(j.reorderedItems.length-1)),j.droppingIndex===j.reorderedItems.length?f.addClass("ionweb-filter-panel-dnd-below-decorator"):f.removeClass("ionweb-filter-panel-dnd-below-decorator"),e=g.index===j.draggedOnIndex?a.DnDDropEffect.None:a.DnDDropEffect.Move):(f=$(k).find(".ionweb-filter-panel-dnd-container-"+b),j.draggedOnIndex=b,g.index<b?(j.droppingIndex=b+1,f.addClass("ionweb-filter-panel-dnd-below-decorator"),e=a.DnDDropEffect.Move):g.index>b?(j.droppingIndex=b,f.addClass("ionweb-filter-panel-dnd-above-decorator"),e=a.DnDDropEffect.Move):(j.droppingIndex=-1,e=a.DnDDropEffect.None))}return e},k.on("$destroy",function(){p&&(p.$destroy(),p=null)}),j.dashboardComponent=o(),new e(j,b,c,d,f)}};return j}]);var e=function(){function e(b,e,f,g,h){var i=this;this.$scope=b,this.notificationService=f,this.contextMenuService=h,this.saveFilterItemVisibility=function(a){var b=i.$scope.filterPanelOptions.filterPanelContext.hiddenFilterItems;b.indexOf(a.displayName)>=0?b.splice(b.indexOf(a.displayName),1):b.push(a.displayName),i.$scope.filterPanelOptions.filterPanelContext.raiseStateChanged()},this.logger=g.create("FiltersPanelController"),this.contextMenuService=h,this.$scope.items||(this.$scope.items=b.filterPanelOptions.filterPanelContext.items||b.filterPanelOptions.items),this.filterStorageService=e.loadFilterStorageService(c.FilterStorageProviderService.getComponentFromScope(b)),this.$scope.filterPanelOptions.filterPanelContext.contextIsReadyToUse?this.init():(this.$scope.filterPanelOptions.filterPanelContext.contextReady.add(function(a,b){i.init()}),this.$scope.filterPanelOptions.filterPanelContext.setFilterStorageService(this.filterStorageService)),this.$scope.$parent.filterPanelController=this,this.$scope.saveEditorMode=d.None,this.$scope.filterPanelOptions.filterPanelContext.filtersUpdated.add(function(a,b){i.$scope.showSaveAsEditor(d.None)}),this.$scope.filterPanelOptions.filterPanelContext.activeFavoriteFilterUpdated.add(function(a,b){if(!b.clear)if(b&&b.filterTree){var c=i.$scope.filterPanelOptions.filterPanelContext.validateAndCreateFilterTree(),d=!1;c&&(c.description=b.filterTree.description,d=!c.equals(b.filterTree),i.$scope.updateFilter(d,c))}else i.$scope.applyFilter()}),this.$scope.items.forEach(function(a){a.filterUpdated&&a.filterUpdated.add(function(a,b){b.fireQuery&&i.$scope.applyFilter()}),a.displayValueChanged&&a.displayValueChanged.add(function(a,b){if(i.$scope.filterPanelOptions.filterPanelContext.currentFilters){var d=[],e=c.FilterRootNodeBuilder.extractFilterNodes(i.$scope.filterPanelOptions.filterPanelContext.currentFilters);if(e&&e.hasOwnProperty(b.id)){e[b.id].description=b.newValue,Object.keys(e).forEach(function(a){d.push(e[a])});var f=c.FilterRootNodeBuilder.buildFilterTree(d);i.$scope.filterPanelOptions.filterPanelContext.updateFiltersInternal(f,!1,!1,!1)}}}),a.valueChanged&&a.valueChanged.add(function(a,b){i.$scope.filterPanelOptions.filterPanelContext.shouldApplyOnValueChange()&&i.shouldBeginApplyOnValueChange&&i.$scope.applyFilter()})}),this.$scope.applyFilter=function(){var a=100;i.$scope.filterPanelOptions.filterPanelContext.shouldApplyOnValueChange()&&(i.queryTimer&&window.clearTimeout(i.queryTimer),a=600),i.queryTimer=window.setTimeout(function(){i.$scope.$evalAsync(function(){var a=i.$scope.filterPanelOptions.filterPanelContext.validateAndCreateFilterTree();if(a){var b=i.$scope.getActiveFavoriteFilterName();a.description=b,i.$scope.filterPanelOptions.filterPanelContext.updateFilters(a,!0)}})},a)},this.$scope.saveFilter=function(a){if(i.$scope.filterName&&0!==i.$scope.filterName.length){var b=i.$scope.filterPanelOptions.filterPanelContext.validateAndCreateFilterTree();if(b){var c=i.filterStorageService.loadContextStorage(i.$scope.filterPanelOptions.filterPanelContext.sharedFiltersContextKey);if(a===d.Adding&&c.getFilter(i.$scope.filterName))return void i.$scope.showSaveAsEditor(d.Overwriting);var e;a===d.Overwriting?(e=c.updateFilter(i.$scope.filterName,b),i.parseRepositoryActionResult("Update",i.$scope.filterName,e,b)):(e=c.addFilter(i.$scope.filterName,b),i.parseRepositoryActionResult("Add",i.$scope.filterName,e,b)),i.filterName=""}}},this.$scope.updateFilter=function(a,b){if(void 0===a&&(a=!0),b||(b=i.$scope.filterPanelOptions.filterPanelContext.validateAndCreateFilterTree()),b){var c=i.filterStorageService.loadContextStorage(i.$scope.filterPanelOptions.filterPanelContext.sharedFiltersContextKey),d=i.$scope.getActiveFavoriteFilterName();b.description=d;var e=c.updateFilter(d,b);i.parseRepositoryActionResult("Update",d,e,b,a)}},this.$scope.isActiveFavoriteFilterUpdated=function(){var a=i.$scope.filterPanelOptions.filterPanelContext.isActiveFavoriteFilterUpdated(i.createFilterTree());return i.$scope.canSaveBeEnabled=a,i.$scope.isAllFilterValid=i.$scope.filterPanelOptions.filterPanelContext.isAllFilterValid(),i.$scope.filterPanelOptions.filterPanelContext.setCurrentFavoriteFilterUpdated(a),i.$scope.filterPanelOptions.filterPanelContext.isDefaultFilterSelected()&&(a=!1),a},this.$scope.showSaveAsEditor=function(a){if(i.$scope.saveEditorMode=a,a===d.Adding){if(!i.$scope.filterPanelOptions.filterPanelContext.validateAndCreateFilterTree())return;setTimeout(function(){$(".filter-panel-save-as-container-input").focus()})}else a===d.None&&(i.$scope.filterName="")},this.$scope.handleKeyAction=function(b){switch(b.keyCode){case a.KeyCodes.ESC:i.$scope.showSaveAsEditor(d.None);break;case a.KeyCodes.ENTER:$(".filter-panel-save-as-container-input").blur(),i.$scope.saveFilter(d.Adding)}},this.$scope.getActiveFavoriteFilterName=function(){return i.$scope.filterPanelOptions.filterPanelContext.getActiveFavoriteFilterName()}}return e.prototype.parseRepositoryActionResult=function(c,f,g,h,i){void 0===i&&(i=!0),this.logger.low(e.LogKey,{Action:c,Filter:f,ActionCompleted:g.succeeded,Message:g.message}),g.succeeded?(this.notificationService.showSnackBar(a.stringFormat(b.Strings.Text_Filter_Panel_Favorite_Filter_Update_Operation_Success,{filterName:f})),this.$scope.filterPanelOptions.filterPanelContext.setActiveFavoriteFilter(h),this.$scope.showSaveAsEditor(d.None),i&&this.$scope.applyFilter()):this.notificationService.showError(b.Strings.Text_Filter_Panel_Error_Favorite_Filter_Operation_Failed,g.message)},e.prototype.init=function(){var a=this;this.$scope.filterPanelOptions.filterPanelContext.isFilterPanelInitialized=!0,this.$scope.filterPanelOptions.filterPanelContext.items||(this.$scope.filterPanelOptions.filterPanelContext.items=this.$scope.items,this.$scope.filterPanelOptions.filterPanelContext.updateFilterItems(this.$scope.filterPanelOptions.filterPanelContext.currentFilters)),setTimeout(function(){a.shouldBeginApplyOnValueChange=!0},0)},e.prototype.createFilterTree=function(){var d=this,e=[];Object.keys(this.$scope.filterPanelOptions.filterPanelContext.filterMap).forEach(function(c){var f=d.$scope.filterPanelOptions.filterPanelContext.filterMap[c];if(f.filterNode){var g=f.filterNode;if(g.nodeType===b.NodeType.Condition){var h=f.filterNode;if(!h.values||0===h.values.length)return;g.fieldDisplayName=f.displayName,e.push(g)}else{if(g.nodeType!==b.NodeType.And)throw new TypeError(a.stringFormat(b.Strings.Text_Filter_Panel_Exception_Create_Filter_Tree,{nodeType:g.nodeType}));var i=f.filterNode;if(!i.children||0===i.children.length)return;i.fieldDisplayName=f.displayName,e.push(i)}}});var f=c.FilterRootNodeBuilder.buildFilterTree(e);return f},e.prototype.clearFilters=function(){this.$scope.filterPanelOptions.filterPanelContext.updateFilterItems(null),this.$scope.filterPanelOptions.filterPanelContext.setActiveFavoriteFilter(null);var a=this.$scope.filterPanelOptions.filterPanelContext.validateAndCreateFilterTree(),b=!0;null===a&&(a=new c.FilterRootNode,b=!1),this.$scope.filterPanelOptions.filterPanelContext.updateFilters(a,b)},e.prototype.resetFilters=function(){this.$scope.filterPanelOptions.filterPanelContext.updateFilters(this.$scope.filterPanelOptions.filterPanelContext.activeFavoriteFilter,!0)},e.prototype.showFilterConfiguration=function(c,d){var e=this;void 0===d&&(d=!0);var f=[];if(d&&this.$scope.getActiveFavoriteFilterName()&&f.push({menuType:a.MenuItemType.Custom,templateUrl:"grids.ui/filterPanel/filterPanelToolbar.tpl.html",scope:this.$scope},{menuType:a.MenuItemType.Divider}),f.push({menuType:a.MenuItemType.General,text:b.Strings.Text_Clear_Filter,icon:"clearFilter",action:function(){e.clearFilters()}}),!this.$scope.filterPanelOptions.filterPanelContext.hideFavoriteFilters){var g=this.$scope.getActiveFavoriteFilterName(),h=g&&g.length>0;f.push({menuType:a.MenuItemType.General,text:b.Strings.Text_Reset_Filter,icon:"resetFilter",disabled:!h,action:function(){e.resetFilters()}})}this.$scope.items.length&&this.$scope.dashboardComponent.editMode&&(f.push({menuType:a.MenuItemType.Divider}),this.$scope.items.forEach(function(b){f.push({menuType:a.MenuItemType.Checkbox,text:b.displayName,checked:b.visible,autoClose:!1,action:function(){b.visible=!b.visible,e.saveFilterItemVisibility(b)}})}));var i={anchorPoint:a.ContextMenuAnchorPoint.BottomLeft};this.contextMenuService.openContextMenu(f,c.target,i)},e.LogKey="FiltersPanelController",e}();c.FiltersPanelController=e}(c=b.xrs||(b.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(b,c,d,e){var f=this;this.gScope=b,this.container=c,this.lastVisibility=-1,this.sscope=b.$new(),this.sscope.panes=[],this.sscope.selectPane=function(a){f.scope.tabModel.activeTabIndex=a},this.vm={isCollapsed:!0,isShown:!1,panes:[],titleTemplateUrl:"grids.ui/gridSidePanelTitle.tpl.html",titleTemplateScope:this.sscope,getCollapsiblePaneSetting:function(){return(f.scope.tabModel.activeTabIndex||0===f.scope.tabModel.activeTabIndex)&&f.scope.vm.panes.length>f.scope.tabModel.activeTabIndex?f.scope.vm.panes[f.scope.tabModel.activeTabIndex].collapsiblePaneSettings:void 0}},this.throttleResize=a.throttle(function(){f.isShown&&f.scope.$evalAsync(function(){return f.scope.height=f.gScope.currentGridSize})}),this.scope=this.sscope.$new(),this.scope.tabModel={activeTabIndex:0},this.scope.vm=this.vm;var g=d.get("grids.ui/gridSidePanel.tpl.html");e(angular.element(g))(this.scope,function(a){c.append(a[0])}),this.addDefaultPanes(),this.syncPanes(),this.scope.$watch("options.sidePanels",function(a,b){a!==b&&f.syncPanes()}),this.gScope.$watch("options.showSidePanel",function(a){!a!=!f.isShown&&(f.isShown=a,f.settingsManager.notifyChanges())})}return c.prototype.reinit=function(a,b){var c=this;this.settingsManager=a,this.gridObject=b,this.editModeUnsub&&this.editModeUnsub();var d=function(a){c.scope.forceHideSidePanel=!a&&c.hasJustConfigurationPanel,c.scope.isInEditMode=a,c.sscope.isInEditMode=a,c.sscope.isInEditMode&&null===c.scope.tabModel.activeTabIndex&&setTimeout(function(){c.syncActiveTab(c.vm.panes)},0),c.notifyGridSizeChanged()},e=b.currentContainer;e?(this.editModeUnsub=e.editModeChanged.add(function(){return d(e.editMode)}),d(e.editMode)):d(b.inEditMode())},c.prototype.dispose=function(){this.scope.$destroy(),this.sscope.$destroy(),this.container.find(".ionweb-grid-side-panel-container").remove(),this.editModeUnsub&&this.editModeUnsub()},c.prototype.getState=function(){return{isShown:this.isShown,isCollapsed:this.vm.isCollapsed,splitterPosition:this.vm.splitterPosition}},c.prototype.setState=function(a){this.isShown=a&&a.isShown,this.gScope.options.showSidePanel=this.isShown,this.vm.isCollapsed=a&&a.isCollapsed,this.vm.splitterPosition=a&&a.splitterPosition},c.prototype.onGridResize=function(){this.throttleResize()},Object.defineProperty(c.prototype,"panes",{get:function(){return this.vm.panes},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isShown",{get:function(){return this.vm.isShown},set:function(a){a||(this.vm.isCollapsed=!a),this.vm.isShown=a,this.syncActiveTab(this.vm.panes),this.onGridResize()},enumerable:!0,configurable:!0}),c.prototype._expand=function(a){this.vm.isCollapsed=!a},c.prototype._selectPane=function(a){this.sscope.selectPane(a)},c.prototype._getTabPanelScope=function(a){for(var b=0;b<this.vm.panes.length;b++){var c=this.vm.panes[b];if(c.title===a)return c.templateScope}},c.prototype.addDefaultPanes=function(){var a=this,c=this.sscope.options.verticalGroupingGridOptions&&this.sscope.options.verticalGroupingGridOptions.disableGroupingChange,d=this.sscope.data.getAs(b.GroupingDataModel);if(d&&!c){var e=this.sscope.$new();this._defaultPanes=[{title:b.Strings.Grid_SidePanel_Grouping_Title,icon:"table",templateUrl:"grids.ui/gridGroupingSidePanel.tpl.html",templateScope:e,isConfiguration:!0}]}else this._defaultPanes=[];if(this.scope.$watch("vm.isCollapsed",function(b,c){b!==c&&a.settingsManager.notifyChanges(),a.notifyGridSizeChanged(),a.scope.vm.isCollapsed||(a.scope.initialized=!0)}),this.scope.$watch("vm.isShown",function(b,c){b!==c&&(a.settingsManager.notifyChanges(),a.notifyGridSizeChanged())}),this.gScope.options&&this.gScope.options.filterPanelOptions&&(this.gScope.options.filterPanelOptions.templateUrl||this.gScope.options.filterPanelOptions.filterTemplateScope)){var f=this.sscope.$new();f.filterPanelOptions=this.gScope.options.filterPanelOptions;var g={title:b.Strings.Text_Filter_Chooser_Title,icon:"filter",iconClass:function(){return f.filterPanelOptions.filterPanelContext.getIconClass()},template:"<ionweb-filter-panel class='ionweb-filter-panel' filter-panel-options='filterPanelOptions'></ionweb-filter-panel>",templateScope:f,collapsiblePaneSettings:{icon:"optionsVertical",visible:!0,clickHandler:function(a){f.filterPanelController.showFilterConfiguration(a)}}};if(Object.defineProperty(g,"title",{get:function(){return f.filterPanelOptions.filterPanelContext.getIconTitle()},enumerable:!0,configurable:!0}),this._defaultPanes.push(g),this.gScope.options.filterPanelOptions.filterPanelContext&&this.gScope.options.filterPanelOptions.filterPanelContext.sharedFiltersContextKey&&this.gScope.options.filterPanelOptions.filterPanelContext.hideFavoriteFilters!==!0){var h=this.sscope.$new();h.filterPanelOptions=this.gScope.options.filterPanelOptions;var i={title:b.Strings.Text_Favorite_Filter_Panel_Title,icon:"star",templateUrl:"grids.ui/filterPanel/favoriteFilterPanel.tpl.html",templateScope:h};this._defaultPanes.push(i)}}},c.prototype.notifyGridSizeChanged=function(){var a=this,b=0;this.scope.vm.isCollapsed||(b+=2),this.scope.vm.isShown||(b+=1),this.lastVisibility!==b&&(this.lastVisibility=b,setTimeout(function(){a.scope.$evalAsync(function(){a.gridObject.notifyGridSizeChanged()})},0))},c.prototype.syncActiveTab=function(a){var b=this,c=function(a){return a&&!a.isConfiguration||b.scope.isInEditMode},d=this.scope.tabModel.activeTabIndex||0===this.scope.tabModel.activeTabIndex?this.scope.tabModel.activeTabIndex:0;c(a[d])||(d=-1,a.forEach(function(a,b){c(a)&&d<0&&(d=b)})),d===-1&&(d=0),this.scope.tabModel.activeTabIndex=d},c.prototype.syncPanes=function(){var a=this._defaultPanes.slice();this.gScope.options.sidePanels&&this.gScope.options.sidePanels.length>0&&(a=a.concat(this.gScope.options.sidePanels)),this.vm.panes=a,this.sscope.panes=a,this.syncActiveTab(a),this.hasJustConfigurationPanel=0===a.filter(function(a){return!a.isConfiguration}).length},c}();c.Manager=d}(c=b.gridSidePanel||(b.gridSidePanel={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){function d(c,d,e,f){c.$watch("options.toolbarOptions.enabled",function(a,b){a!==b&&f&&f.body.refresh()}),c.showToolbar=function(){return c.options.toolbarOptions&&c.options.toolbarOptions.enabled&&(c.options.filterPanelOptions&&!c.options.filterPanelOptions.hideAppliedFiltersToolbar||c.options.isDashboardInEditMode&&c.options.isDashboardInEditMode()&&c.showFormattingWidget&&c.showFormattingWidget()||c.showAppearanceOptions&&c.showAppearanceOptions()&&c.options.isDashboardInEditMode&&c.options.isDashboardInEditMode()||c.options.summaryPanelMode===b.SummaryPanelMode.ShowOnTopBar)},c.showSummaryOnToolbar=function(){return c.options.summaryPanelMode===a.tables.SummaryPanelMode.ShowOnTopBar};var g=$('<div class="gridxHeader ionweb-grid-toolbar ng-cloak" ng-show="showToolbar()"></div>'),h='<div class="ionweb-grid-toolbar-filter-container"><ionweb-applied-filters-toolbar filter-panel-context="options.filterPanelOptions.filterPanelContext" always-visible="true" custom-content-template="{{options.filterPanelOptions.toolbarCustomContentTemplate}}" custom-content-template-url="{{options.filterPanelOptions.toolbarCustomContentTemplateUrl}}" custom-content-scope="options.filterPanelOptions.toolbarCustomContentScope" show-field-names="options.filterPanelOptions.showFieldNamesInFiltersToolbar" class="pull-left ion-toolbar-button-margin" ng-if="options.filterPanelOptions && !options.filterPanelOptions.hideAppliedFiltersToolbar"></ionweb-applied-filters-toolbar></div>';angular.element(h).appendTo(g);var i=$('<div class="ionweb-grid-toolbar-right-buttons-container"></div>');angular.element(i).appendTo(g);var j='<grid-formatting-control-popup is-open="isOpen" options="options.gridFormattingControlOptions" ng-model="options.formattingOptions" ng-show="options.isDashboardInEditMode && options.isDashboardInEditMode() && showFormattingWidget && showFormattingWidget()" class="pull-right ion-toolbar-button-margin"></grid-formatting-control-popup>';angular.element(j).appendTo(i);var k='<appearance-popup is-open="isAppearancePopupOpen" class="pull-right ion-toolbar-button-margin" ng-model="appearanceOptions" config-options="options.configOptions" ng-show="showAppearanceOptions() && (options.isDashboardInEditMode && options.isDashboardInEditMode())" has-hierarchical-rows="hasHierarchicalRows()" show-responsiveness="showResponsiveness()"></appearance-popup>';angular.element(k).appendTo(i);var l='<ionweb-grid-summary-panel ng-if="showSummaryOnToolbar()" summary-panel-manager="summaryPanelManager"></ionweb-grid-summary-panel>';angular.element(l).appendTo(i);var m=e(g)(c);angular.element(m).prependTo(d[0])}c.init=d}(c=b.topbar||(b.topbar={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){angular.module("ionwebGrids").directive("gridFormattingControlPopup",[function(){var a=function(a,b,c){a.dialog={},a.close=function(){a.isOpen=!1},a.$watch("formattingOptions",function(b){a.dialog.formattingOptions=b}),a.$watch("dialog.formattingOptions",function(b){a.formattingOptions=b},!0)};return{restrict:"EA",scope:{isOpen:"=?",formattingOptions:"=ngModel",options:"=?"},link:a,templateUrl:"grids.ui/gridFormatting/gridFormattingControlPopup.tpl.html"}}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){function b(b){b.options&&(b.options.gridFormattingControlOptions=b.options.gridFormattingControlOptions||{},b.options.gridFormattingControlOptions.showDecimalPlaces=b.options.gridFormattingControlOptions.showDecimalPlaces!==!1,b.options.gridFormattingControlOptions.showDateFormat=b.options.gridFormattingControlOptions.showDateFormat!==!1,b.options.gridFormattingControlOptions.showNegativeFormat=b.options.gridFormattingControlOptions.showNegativeFormat!==!1,b.options.gridFormattingControlOptions.showScaleFactor=b.options.gridFormattingControlOptions.showScaleFactor!==!1),b.showFormattingWidget=function(){var c=!1;return b.options&&void 0==b.options.gridFormattingControlOptions?c=!0:b.options&&(b.options.gridFormattingControlOptions.showDecimalPlaces||b.options.gridFormattingControlOptions.showNegativeFormat||b.options.gridFormattingControlOptions.showScaleFactor||b.options.gridFormattingControlOptions.showDateFormat)&&(c=!0),b.options&&b.options.toolbarOptions&&b.options.toolbarOptions.enableFormatting===!1&&(c=!1),c&&b.data&&!!b.data.getAs(a.PresentationDataModelAdapter)},b.$evalAsync()}a.initGridFormattingControlOptions=b,angular.module("ionwebGrids").directive("gridFormattingControl",["ionweb.dateFormattingService",function(b){var c=function(c,d,e){function f(a){var b=0,c=[];return Object.keys(a).forEach(function(a){isNaN(Number(a))&&(c[b++]=a)}),c}c.options=c.options||{},c.options.showDecimalPlaces=c.options.showDecimalPlaces!==!1,c.options.showDateFormat=c.options.showDateFormat!==!1,c.options.showNegativeFormat=c.options.showNegativeFormat!==!1,c.options.showScaleFactor=c.options.showScaleFactor!==!1,c.scaleFactors=f(a.NumberScaleFactor);var g=new Date;c.dateFormats={},c.dateFormats[a.DefaultDateFormat[a.DefaultDateFormat.Short]]=b.toShortDate(g)+" ("+a.Strings["Enum_DefaultDateFormat_"+a.DefaultDateFormat[a.DefaultDateFormat.Short]]+")",c.dateFormats[a.DefaultDateFormat[a.DefaultDateFormat.Long]]=b.toLongDate(g)+" ("+a.Strings["Enum_DefaultDateFormat_"+a.DefaultDateFormat[a.DefaultDateFormat.Long]]+")",c.dateFormats["MMM dd, yyyy"]=b.toCustom(g,"MMM dd, yyyy")+" (MMM dd, yyyy )",c.dateFormats["MMMM dd, yyyy"]=b.toCustom(g,"MMMM dd, yyyy")+" (MMMM dd, yyyy )",c.dateFormats["MM/dd/yyyy"]=b.toCustom(g,"MM/dd/yyyy")+" (MM/dd/yyyy )",c.dateFormats["dd/MM/yyyy"]=b.toCustom(g,"dd/MM/yyyy")+" (dd/MM/yyyy )",c.reset=function(){c.formattingOptions=void 0},c.$watch("formattingOptions",function(b,d){b&&(c.formattingControlValues={decimalPlaces:b.decimalPlaces,selectedScaleFactor:a.NumberScaleFactor[b.scaleFactor],selectedDateFormat:a.DefaultDateFormat[b.dateFormat]?a.DefaultDateFormat[b.dateFormat]:b.dateFormat,negativeFormat:!1},b.negativeFormat!==a.NegativeNumberFormat.Braces&&b.negativeFormat!==a.NegativeNumberFormat.RedAndBraces||(c.formattingControlValues.negativeFormat=!0))}),c.$watch("formattingControlValues.selectedScaleFactor",function(b){c.formattingOptions||(c.formattingOptions={}),b!==a.NumberScaleFactor[c.formattingOptions.scaleFactor]&&(c.formattingOptions.scaleFactor=a.NumberScaleFactor[b],c.formattingOptions.isScaleFactorMixed=!1)}),c.$watch("formattingControlValues.decimalPlaces",function(a){c.formattingOptions||(c.formattingOptions={}),a!==c.formattingOptions.decimalPlaces&&(c.formattingOptions.decimalPlaces=a,c.formattingOptions.isDecimalPlacesMixed=!1)}),c.$watch("formattingControlValues.selectedDateFormat",function(b){c.formattingOptions||(c.formattingOptions={}),b!==c.formattingOptions.dateFormat&&a.DefaultDateFormat[b]!==c.formattingOptions.dateFormat&&(c.formattingOptions.dateFormat=void 0!=a.DefaultDateFormat[b]?a.DefaultDateFormat[b]:b,c.formattingOptions.isDateFormatMixed=!1)}),c.$watch("formattingControlValues.negativeFormat",function(b){c.formattingOptions||(c.formattingOptions={}),void 0!=b&&(b&&c.formattingOptions.negativeFormat!==a.NegativeNumberFormat.RedAndBraces||b===!1&&c.formattingOptions.negativeFormat!==a.NegativeNumberFormat.Red)&&(c.formattingOptions.negativeFormat=b?a.NegativeNumberFormat.RedAndBraces:a.NegativeNumberFormat.Red,c.formattingOptions.isNegativeFormatMixed=!1)}),c.isAtleastOneFormattingOptionVisible=function(){return c.options.showDecimalPlaces||c.options.showNegativeFormat||c.options.showScaleFactor||c.options.showDateFormat}};return{restrict:"EA",link:c,scope:{formattingOptions:"=?ngModel",options:"=?"},templateUrl:"grids.ui/gridFormatting/gridFormattingControl.tpl.html"}}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(a,d,e,f,g){var h=c.call(this,e,a)||this;h.dialogService=d,h.excHelper=f,h.scope=g,h.unsub=[];var i=h.getSortRowAxis();if(i){i.disabledKeys=i.disabledKeys||{},i.oneShotSortKeys=i.oneShotSortKeys||{},i.preferredTypes=i.preferredTypes||{},i.preferredTypesLevel=i.preferredTypesLevel||{},h.setCurrentSorting(b.DataTable.convertSortCriteria(i.getSortCriteria())),h.toggleFunction=function(c,d){var e=h.getColumnSortingKeyForKeyOrLevel(c);return e!==c&&a.logGroupKeyToSortingKey(b.AxisType.Row,c,e),!e||i.disabledKeys[e]?void a.logSortSkip(b.AxisType.Row,e,d):(a.logSortToggleBegin(b.AxisType.Row,e),void h.toggleSorting(e,d).then(function(c){if(c.length){var f=c[c.length-1];a.logSortAdded(b.AxisType.Row,e,d,f.direction===b.SortDirection.Ascending,b.SortType[f.sortType])}h.processSorting(c,i)},function(){}).catch(function(a){return h.excHelper.report(a)}))},h.unsub.push(i.options.sortingChangedEvent.add(function(a,b){return h.updateSortCriteria(b)}));var j=h.dataModel.getColumnAxis();h.unsub.push(j.options.slicesEvent.add(function(a,b){return h.updateSortCriteria(i.getAppliedSortCriteria())}))}var k=h.getSortColumnAxis();if(k&&(k.disabledKeys=k.disabledKeys||{},k.preferredTypes=k.preferredTypes||{},k.preferredTypesLevel=k.preferredTypesLevel||{},h.setCurrentColumnSorting(b.DataTable.convertSortCriteria(k.getAppliedSortCriteria())),h.unsub.push(k.options.sortingChangedEvent.add(function(a,b){h.updateColumnSortCriteria(b)}))),g){h.unsub.push(g.$watch("options.enableOutlineMode",function(a,b){a!==b&&h.outlineModeChanged(g.options)}));var l=g.data.getAs(b.GroupingDataModel);l&&g.options.verticalGroupingGridOptions&&!g.options.verticalGroupingGridOptions.disableGroupingChange&&h.unsub.push(l.groupingChanged.add(function(){h.groupingChanged(g.options,l.getGroupedColumns())}))}return h}return __extends(d,c),d.prototype.dispose=function(){this.unsub.forEach(function(a){return a()})},d.prototype.updateSortCriteria=function(a){var c=this;if(this.grid){var d=[];this.logger.logSortBeginConfiguration(b.AxisType.Row);this.dataModel.getColumnAxis();b.DataTable.convertSortCriteria(a).forEach(function(a){var e="string"==typeof a.keyOrLevel?a.keyOrLevel:null,f="string"!=typeof a.keyOrLevel?a.keyOrLevel:null;d.push({colId:e,level:f,descending:a.direction===b.SortDirection.Descending}),c.logger.logSortConfigurationItem(b.AxisType.Row,a.keyOrLevel,a.direction===b.SortDirection.Ascending,b.SortType[a.sortType])}),this.logger.logSortEndConfiguration(b.AxisType.Row),this.grid.sort.setState(d,this.getCurrentSortResponsiveConfig())}},d.prototype.init=function(a){this.grid=a;var b=this.getSortRowAxis();b&&this.updateSortCriteria(b.getAppliedSortCriteria())},d.prototype.reinit=function(){var a=this.getSortRowAxis();a&&this.setCurrentSorting(b.DataTable.convertSortCriteria(a.getSortCriteria()));var c=this.getSortColumnAxis();c&&this.setCurrentColumnSorting(b.DataTable.convertSortCriteria(c.getSortCriteria()))},d.prototype.outlineModeChanged=function(a){var b=this.getSortRowAxis();if(b){var c=b.getSortCriteria();c.length&&this.switchSortCriteria(c,a)}},d.prototype.groupingChanged=function(a,b){var c=this.getSortRowAxis();if(c){var d=c.getSortCriteria();d.length&&this.reconcileSortCriteriaForGrouping(d,b,a)}},d.prototype.reconcileSortCriteriaForGrouping=function(a,c,d){var e=[],f=!1;a.forEach(function(a){a instanceof b.LevelSortCriterion&&a.level!==-1?a.level<c.length+1?e.push(a):f=!0:e.push(a)}),this.getSortRowAxis().setSortCriteria(e),this.setCurrentSorting(b.DataTable.convertSortCriteria(e))},d.prototype.switchSortCriteria=function(a,c){var d=this,e=[];if(c.enableOutlineMode)a.forEach(function(a){if(c.outlineModeConfiguration&&a instanceof b.LevelSortCriterion&&a.level===-1){var f=0;for(c.outlineModeConfiguration.compact!==!1&&(f=1);f<c.outlineModeConfiguration.rowLevelDescriptors.length;f++){a.level=f;var g=b.DataTable.convertSortCriteria([a]),h=d.convertSortedColumn(g);h.length&&e.push(h[0])}}else e.push(a)});else{var f=!1;a.forEach(function(a){a instanceof b.LevelSortCriterion?f||(a.level=-1,e.push(a),f=!0):e.push(a)})}this.getSortRowAxis().setSortCriteria(e),this.setCurrentSorting(b.DataTable.convertSortCriteria(e))},d.prototype.processSorting=function(b,c){var d=this,e=a.firstOrDefault(b,function(a){return c.oneShotSortKeys&&c.oneShotSortKeys[a.keyOrLevel]});e?this.showSortingConfirmation(e).then(function(a){null!==d.sortDirection&&void 0!==d.sortDirection&&(e.direction=d.sortDirection,c.executeOneShotSorting(d.convertSortedColumn([e])),d.setCurrentSorting([]),d.sortDirection=null)}):c.setSortCriteria(this.convertSortedColumn(b))},d.prototype.showSortingConfirmation=function(c){var d=this;this.cScope=this.scope.$new(!1,this.scope),this.cScope.sortAscending=function(){d.sortDirection=b.SortDirection.Ascending,d.cScope.closeDialog()},this.cScope.sortDescending=function(){d.sortDirection=b.SortDirection.Descending,d.cScope.closeDialog()},this.cScope.closeDialog=function(){d.cScope.cancel(),d.cScope.$destroy()},this.cScope.dialogMessage=a.stringFormat(b.Strings.One_Time_Grid_Sorting_Title,{name:c.keyOrLevel});var e={canClose:!1,templateUrl:"grids.ui/oneShotSortingConfirmationDialog.tpl.html",title:"ION.WEB",size:a.DialogSize.Large,scope:this.cScope};return Q.when(this.dialogService.show(e).closed.then(function(a){return!a.cancel&&a.value}))},d.prototype.showChangeConfirmation=function(){var a=b.Strings.Msg_Sorting_Change_Confirmation,c=b.Strings.Msg_Sorting_Reset;return Q.when(this.dialogService.showPreferenceQuestionDialog(c,b.GRID_QUICK_SORTING_CHANGE_PREFERENCE_KEY,a).closed.then(function(a){return!a.cancel&&a.value}))},d}(c.ManagerBase);c.Manager=d}(c=b.sorting||(b.sorting={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(){var c=this;this.currentSelectionContains=function(a){var d=c.selectionManager.getGridSelection();return d.type===b.GridRangeType.Column?a.columnKey&&d.args.indexOf(a.columnKey)>=0:d.type===b.GridRangeType.Row&&(a.rowKey&&d.args.indexOf(a.columnKey)>=0)},this.isDragging=!1,this.uid=a.createNewGuid()}return c.prototype.dispose=function(){this.dragWrapper&&this.dragWrapper.dispose(),this.dropWrapper&&this.dropWrapper.dispose()},c.prototype.convertKeysToCaption=function(a,c){
var d,e=[];return c==b.GridRangeType.Column?d=this.dataModel.getColumnAxis():c==b.GridRangeType.Row&&(d=this.dataModel.getRowAxis()),d&&a.forEach(function(a){return e.push(d.getSlice(a).displayName())}),e},c.prototype.populateGridDnDSelection=function(a){var c=null,d=null,e=this.selectionManager.getGridSelection();return this.currentSelectionContains(a)&&e.type===b.GridRangeType.Row||e.type===b.GridRangeType.Column?(c=e.args,d=e.type):a.rowKey&&!a.columnKey?(c=[a.rowKey],d=b.GridRangeType.Row):!a.rowKey&&a.columnKey?(c=[a.columnKey],d=b.GridRangeType.Column):a.rowKey&&a.columnKey&&(c=[{rowKey:a.rowKey,columnKey:a.columnKey}],d=b.GridRangeType.Cell),{selectionType:d,keysToTransfer:c}},c.prototype.populateDataTransferUsingKeysAndFormat=function(a,c){var d,e=this.populateGridDnDSelection(c),f=e.keysToTransfer,g=e.selectionType;if(d=g===b.GridRangeType.Row?this.dndOptions.predefinedRowDragContentMode:g===b.GridRangeType.Column?this.dndOptions.predefinedColumnDragContentMode:b.DnDGridContentMode.Cells,d||(d=g===b.GridRangeType.Column?b.DnDGridContentMode.Captions:b.DnDGridContentMode.CaptionsCells),d!==b.DnDGridContentMode.None){g&&(a.setData(b.DnDFormatType.GridSelection,{type:g,args:f}),a.setData(b.DnDFormatType.GridIdentifier,this.uid));var h,i,j="\r\n",k="\t";switch(d){case b.DnDGridContentMode.Cells:h=new b.DataExporter(this.dataModel,{columnSeparator:b.ColumnSeparatorChar.Tab,excludeColumnHeader:!0,excludeRowHeader:!0}),i=h.exportToText({type:g,args:f});break;case b.DnDGridContentMode.Keys:g==b.GridRangeType.Column?i=f.join(k):g==b.GridRangeType.Row&&(i=f.join(j));break;case b.DnDGridContentMode.Captions:var l=this.convertKeysToCaption(f,g);g==b.GridRangeType.Column?i=l.join(k):g==b.GridRangeType.Row&&(i=l.join(j));break;case b.DnDGridContentMode.CaptionsCells:h=new b.DataExporter(this.dataModel,{columnSeparator:b.ColumnSeparatorChar.Tab}),i=h.exportToText({type:g,args:f})}var m=a.getData("Text");i&&!m&&a.setData("Text",i)}},c.prototype.getKeysFromEvent=function(a){return a.clientX&&a.clientY?b.gridElementAxesIDsFromScreenCoords(a.clientX,a.clientY):b.gridElementAxesIDsFromElement(a.target)},c.prototype.getNextColKey=function(a){return a&&a.nextElementSibling&&a.nextElementSibling.getAttribute("colid")},c.prototype.getNextRowKey=function(a){var b=a&&a.parentElement&&a.parentElement.nextSibling;return b&&b.getAttribute("rowid")},c.prototype.infoFromEvent=function(a,b,c,d){var e=this,f=this.getTargetCoordsFromEvent(a,b,c,d);return{mode:c,orientation:b,keys:f,getKeys:function(b,c){return e.infoFromEvent(a,b,c,d).keys}}},c.prototype.getTargetCoordsFromEvent=function(a,c,d,e){var f=this.getKeysFromEvent(a);if(e&&this.isSingleCellSelectionType(e))return f;if(d==b.DnDDropFeedbackLocationMode.Insert){var g,h=this.getElementHeader(f,c);if(h)g=this.getBoundingClientRect(h);else{var i=this.getLastHeaderElement(c);g=this.getBoundingClientRect(i)}if(g)if(c==b.DnDDropFeedbackOrientation.Column){var j=a.clientX-g.left,k=j>g.width/2;k&&(f.columnKey=this.getNextColKey(h))}else if(c==b.DnDDropFeedbackOrientation.Row){var j=a.clientY-g.top,k=j>g.height/2;k&&(f.rowKey=this.getNextRowKey(h))}}return f},c.prototype.getHeaderGhost=function(a,b){var c=document.createElement("div");c.setAttribute("class","dndGridGhostContainer");var d=document.createElement("div");d.setAttribute("class","dndGridGhostHeader");var e=document.createTextNode(""+a);if(d.appendChild(e),c.appendChild(d),b>1){var f=document.createElement("span");f.setAttribute("class","badge");var g=document.createTextNode(""+b);f.appendChild(g),c.appendChild(f)}return c},c.prototype.isDraggable=function(){return this.dndOptions.isDragSource||this.editingOptions.reorderColumns||this.sliceAxisManager.isAvailable},c.prototype.isValidDragDropElement=function(b){if("undefined"==typeof b.clientX||"undefined"==typeof b.clientY)return!0;for(var c=document.elementFromPoint(b.clientX,b.clientY);c;){if(c.classList&&c.classList.contains(a.tables.ROWHEADERHEADER_DIV_CLASS))return!1;c=c.parentElement}return!0},c.prototype.isDroppingonRowHeader=function(b){if("undefined"==typeof b.clientX||"undefined"==typeof b.clientY)return!1;for(var c=document.elementFromPoint(b.clientX,b.clientY);c;){if(c.classList&&c.classList.contains(a.tables.ROWHEADERBODY_DIV_CLASS))return!0;c=c.parentElement}return!1},c.prototype.getTooltip=function(a){return!!$(a).data("bs.tooltip")},c.prototype.removeTooltip=function(a){this.getTooltip(a)&&$(a).tooltip("destroy")},c.prototype.isCellDnDEnabled=function(){return this.gridOptions&&this.gridOptions.gridSelectionType===b.GridSelectionType.None},c.prototype.dragStart=function(c,d,e){if(this.isDraggable()&&!e.ctrlKey&&!e.shiftKey&&!(document.getElementsByClassName(a.tables.COLUMN_RESIZING_CLASS).length>0)){var f=this.getKeysFromEvent(e),g=!!f.columnKey&&!!f.rowKey;if((!g||this.isCellDnDEnabled())&&this.isValidDragDropElement(e)){var h=!1;if(this.dndOptions.userDragStart){var i;if(g)i={type:b.GridRangeType.Cell,args:[{rowKey:f.rowKey,columnKey:f.columnKey}]};else{i=this.selectionManager.getGridSelection();var j=this.populateGridDnDSelection(f);i.type=j.selectionType,i.args=j.keysToTransfer}h=this.dndOptions.userDragStart(i,d)}if(h||g||!this.editingOptions.reorderColumns||(h=!!f.columnKey),h&&this.populateDataTransferUsingKeysAndFormat(d,f),h&&!g){var k=this.selectionManager.getGridSelection();this.removeTooltip(c);var l;if(f.rowKey&&this.gridOptions.showRowHeaders===!1){var m=$(this.grid.domNode).find("div[role='row'][rowid='"+f.rowKey+"'] .gridxRowTable");if(m&&m.length){var n=m[0].cloneNode(!0);n.classList.add("dndGridGhostHeader"),l=n,l.style.maxWidth=this.grid.domNode.getBoundingClientRect().width+"px"}}else{var o,p="",q=1;f.columnKey?o=this.convertKeysToCaption([f.columnKey],b.GridRangeType.Column):f.rowKey&&(o=this.convertKeysToCaption([f.rowKey],b.GridRangeType.Row)),o&&o.length>0&&(p=o[0]),k.type!==b.GridRangeType.Column&&k.type!==b.GridRangeType.Row||(q=k.args.length),l=this.getHeaderGhost(p,q)}l&&d.setDragPlaceholder(l,-10,0)}this.isDragging=h,this.applyDropFeedbackLocation(this.infoFromEvent(e,this.defaultDropFeedbackOrientation(),this.defaultDropFeedbackLocationMode(),d),d)}}},c.prototype.dragEnter=function(a,b){if(this.isDroppable(b)){var c=!0;return this.dndOptions.userDragEnter&&(c=!!this.dndOptions.userDragEnter(b)),c}return!1},c.prototype.getElementHeader=function(a,c){var d=null;return c==b.DnDDropFeedbackOrientation.Column?d=$(this.grid.domNode).find("td[role='columnheader'][colid='"+a.columnKey+"']").not("td[locked='true']"):c==b.DnDDropFeedbackOrientation.Row&&(d=$(this.grid.domNode).find("td[role='rowheader'][nodekey='"+a.rowKey+"']")),d&&d.length?d[d.length-1]:null},c.prototype.getBoundingClientRect=function(a){return a&&a.getBoundingClientRect()},c.prototype.getLastHeaderElement=function(a){var c;return a==b.DnDDropFeedbackOrientation.Column?c=$(this.grid.domNode).find("td[role='columnheader']").not("[rowheadercolumn]").not("td[locked='true']"):a==b.DnDDropFeedbackOrientation.Row&&(c=$(this.grid.domNode).find("td[role='rowheader']")),c&&c[c.length-1]},c.prototype.isSingleCellSelectionType=function(a){var c=a.getData(b.DnDFormatType.GridSelection);return c&&c.type===b.GridRangeType.Cell&&c.args&&1===c.args.length},c.prototype.applyDropFeedbackLocation=function(c,d){if(c.mode==b.DnDDropFeedbackLocationMode.None)return void this.restoreDropFeedbackLocation();var e,f,g=function(a){var b={};return a&&(b.left=a.left,b.top=a.top,b.width=a.width,b.height=a.height),b},h=this.isSingleCellSelectionType(d);if(f=h?a.tables.gridElementFromKeys(this.grid,c.keys.rowKey,c.keys.columnKey):this.getElementHeader(c.keys,c.orientation),f?e=g(this.getBoundingClientRect(f)):c.mode==b.DnDDropFeedbackLocationMode.Insert&&(e=g(this.getBoundingClientRect(this.getLastHeaderElement(c.orientation))),c.orientation==b.DnDDropFeedbackOrientation.Column?e.left=e.left+e.width-1:c.orientation==b.DnDDropFeedbackOrientation.Row&&(e.top=e.top+e.height-1)),e){this.dropEffectElement||(this.dropEffectElement=document.createElement("div"),this.dropEffectElement.style.position="absolute",this.dropEffectElement.style.pointerEvents="none",this.grid.domNode.appendChild(this.dropEffectElement));var i=c.mode==b.DnDDropFeedbackLocationMode.Overlay||h,j=c.orientation==b.DnDDropFeedbackOrientation.Row;this.dropEffectElement.className=i?" ion-accent-border ion-border":" ion-accent-bg",this.dropEffectElement.style.width=(j?this.grid.domNode.clientWidth:i?e.width:1)+"px",this.dropEffectElement.style.height=(j?i?e.height:1:b.safeGetClientHeight(this.grid.bodyNode)+e.height)+"px";var k=this.grid.domNode.getBoundingClientRect(),l=Math.max(0,e.left-k.left-1);this.dropEffectElement.style.left=l+"px",this.dropEffectElement.style.top=Math.max(0,e.top-k.top-1)+"px",h&&(this.dropEffectElement.style.height=e.height+"px")}},c.prototype.restoreDropFeedbackLocation=function(){this.dropEffectElement&&(this.grid.domNode.removeChild(this.dropEffectElement),this.dropEffectElement=null)},c.prototype.dragLeave=function(a){this.dndOptions.userDragLeave&&this.dndOptions.userDragLeave(),this.restoreDropFeedbackLocation(),this.onDragStartAndSourceLeft&&this.onDragStartAndSourceLeft()},c.prototype.doScrollIfNeeded=function(a,b,c){var d=this.grid;d.autoScroll.enabled=!0;var e=this.getTargetCoordsFromEvent(a,b,c);e&&e.columnKey&&d.autoScroll._onMouseMove(a),d.autoScroll.enabled=!1},c.prototype.checkFreezing=function(a,c,d,e){var f=a.getData(b.DnDFormatType.GridSelection),g=this.grid.columnLockService.getLockedColumns();if(0===g.length)return!0;if(g.length===this.dataModel.getColumnAxis().length())return!0;var h=!0;if(f&&f.type===b.GridRangeType.Column&&this.isValidDragDropElement(c)){if(this.isDroppingonRowHeader(c))return!1;var i=f.args[0],j=g.indexOf(i)>=0,k=this.getTargetCoordsFromEvent(c,d,e,a),l=k.columnKey,m=this.dataModel.getColumnAxis(),n=m.getSliceRange(m.length()-1,1);l||(l=n[0].key());var o=g.indexOf(l)>=0;if(j)if(o)h=!0;else{var p=this.dataModel.getColumnAxis().getSlice(l).index();h=p===g.length}else h=!o}return h},c.prototype.isValidDropZoneForSliceMoving=function(a,b,c,d){return this.checkFreezing(a,b,c,d)},c.prototype.isValidDropZoneForMeasureMoving=function(a,c,d,e){var f=this.checkFreezing(a,c,d,e);if(!f)return!1;var g=a.getData(b.DnDFormatType.GridSelection);if(g&&g.type==b.GridRangeType.Column&&this.isValidDragDropElement(c)){var h,i=this.getTargetCoordsFromEvent(c,d,e,a),j=i.columnKey,k=this.dataModel.getColumnAxis(),l=k.getSliceRange(k.length()-1,1);h=j?k.getNodeAndMeasureKey(j).nodeKey:k.getNodeAndMeasureKey(l[0].key()).nodeKey;var m=k.getNodeAndMeasureKey(g.args[0]).nodeKey;if(j){var n=k.getFirstSlice(m)+k.options.getMeasures().length-1,o=k.getSliceRange(n+1,1);return h==m||o.length&&o[0].key()==j}return h==m||k.length()-1==n}return!1},c.prototype.dragOver=function(c,d,e){if(!this.isDroppable(d)||!this.isValidDragDropElement(e))return a.DnDDropEffect.None;var f=a.DnDDropEffect.None,g=this.defaultDropFeedbackOrientation(),h=this.defaultDropFeedbackLocationMode(),i=this.getTargetCoordsFromEvent(e,g,h,d),j=this.infoFromEvent(e,g,h,d),k=d.getData(b.DnDFormatType.GridSelection);return this.dndOptions.userDragOver?(f=this.dndOptions.userDragOver(j,d),g=j.orientation,h=j.mode,j=this.infoFromEvent(e,g,h,d)):this.isMoveSlicesOp(d)?f=""!==i.columnKey&&""!==i.rowKey&&k&&k.type==b.GridRangeType.Row?a.DnDDropEffect.None:this.isValidDropZoneForSliceMoving(d,e,g,h)?a.DnDDropEffect.Move:a.DnDDropEffect.None:this.isMoveMeasuresOp(d)&&(f=this.isValidDropZoneForMeasureMoving(d,e,g,h)?a.DnDDropEffect.Move:a.DnDDropEffect.None),f!==a.DnDDropEffect.None&&this.applyDropFeedbackLocation(j,d),this.doScrollIfNeeded(e,g,h),this._currentDropFeedbackOrientation=g,this._currentDropFeedbackLocationMode=h,f},c.prototype.findMeasureIndex=function(a,b){var c=-1;return a&&b&&a.forEach(function(a,d){var e="string"==typeof a?a:a.key;e==b&&(c=d)}),c},c.prototype.moveMeasures=function(a,b){var c=this.dataModel.getColumnAxis().options,d=c.getMeasures(),e=[],f=0,g=0;d.forEach(function(b){var c="string"==typeof b?b:b.key;a.indexOf(c)>-1&&(e[g]=f,g++),f++}),this.sliceAxisManager.moveFunction(e,b)},c.prototype.drop=function(c,d,e){var f=this,g=!0,h=this.currentDropFeedbackOrientation(),i=this.currentDropFeedbackLocationMode(),j=this.getTargetCoordsFromEvent(e,h,i,d);if(this.dndOptions&&this.dndOptions.userDrop){var k={mode:i,orientation:h,keys:j,getKeys:function(a,b){return f.infoFromEvent(e,a,b,d).keys}};g=this.dndOptions.userDrop(k,d)}var l=$.inArray(b.DnDFormatType.GridSelection,d.availableFormats())>-1;if(g){if(this.isMoveSlicesOp(d)&&l&&this.isValidDropZoneForSliceMoving(d,e,h,i)){var m=d.getData(b.DnDFormatType.GridSelection);if(m.type==b.GridRangeType.Column){var n=this.dataModel.getColumnAxis(),o=[];m.args.forEach(function(a){o.push(n.getSlice(a).index())});var p=j.columnKey?n.getSlice(j.columnKey).index():n.length(),q=a.tables.sliceAxis.Manager.adjustTargetIndex(o,p);this.sliceAxisManager.moveFunction(o,q)}}if(this.isMoveMeasuresOp(d)&&this.isValidDropZoneForMeasureMoving(d,e,h,i)){var m=d.getData(b.DnDFormatType.GridSelection);if(m.type==b.GridRangeType.Column){var r,s,t,n=this.dataModel.getColumnAxis(),u=this.dataModel.getColumnAxis().options.getMeasures();j.columnKey?(r=n.getNodeAndMeasureKey(j.columnKey),s=r.measureKey,t=this.findMeasureIndex(u,s)):t=n.length()-1;var v,w=[],x=0;m.args.forEach(function(a){v=n.getNodeAndMeasureKey(a),w.push(v.measureKey),f.findMeasureIndex(u,v.measureKey)<f.findMeasureIndex(u,s)&&x++}),0==t&&r&&r.nodeKey!=v.nodeKey&&(t=u.length),this.moveMeasures(w,t-x)}}}this.restoreDropFeedbackLocation()},c.prototype.isDraggingInsideGrid=function(a){var c=a.getData(b.DnDFormatType.GridIdentifier),d=c==this.uid&&a.availableFormats().indexOf(b.DnDFormatType.GridSelection)>-1;return d},c.prototype.isMoveSlicesOp=function(a){return this.isDraggingInsideGrid(a)&&!(this.dataModel.getColumnAxis().options.getMeasures()&&this.dataModel.getColumnAxis().options.getMeasures().length)&&this.sliceAxisManager.isAvailable},c.prototype.isMoveMeasuresOp=function(a){return this.editingOptions.reorderColumns&&this.isDraggingInsideGrid(a)&&!(!this.dataModel.getColumnAxis().options.getMeasures()||!this.dataModel.getColumnAxis().options.getMeasures().length)},c.prototype.isDroppable=function(a){var b=this.isMoveSlicesOp(a),c=this.isMoveMeasuresOp(a),d=this.dndOptions.isDropTarget;return d||c||b},c.prototype.defaultDropFeedbackLocationMode=function(){return this.dndOptions&&this.dndOptions.predefinedDropFeedbackLocationMode?this.dndOptions.predefinedDropFeedbackLocationMode:b.DnDDropFeedbackLocationMode.Insert},c.prototype.defaultDropFeedbackOrientation=function(){return this.dndOptions&&this.dndOptions.predefinedDropFeedbackOrientation?this.dndOptions.predefinedDropFeedbackOrientation:b.DnDDropFeedbackOrientation.Column},c.prototype.currentDropFeedbackLocationMode=function(){return this._currentDropFeedbackLocationMode||this.defaultDropFeedbackLocationMode()},c.prototype.currentDropFeedbackOrientation=function(){return this._currentDropFeedbackOrientation||this.defaultDropFeedbackOrientation()},c.prototype.sameOrigin=function(a){var c=a.getData(b.DnDFormatType.GridIdentifier);return c==this.uid},c.prototype.touchEndPerformed=function(){this.isDragging=!1},c.prototype.init=function(c,d,e,f,g,h,i,j,k){var l=this;this.dataModel=e,this.dndOptions=f.dndOptions||{},this.selectionManager=g,this.sliceAxisManager=h,this.grid=c,this.editingOptions=f.editingOptions||{},this.gridOptions=f,this.onDragStartAndSourceLeft=i;var m=$(d),n=function(){var a={dragStart:function(a,b,c){return l.dragStart(a,b,c)},dragEnd:function(a,b,c){l.dndOptions.userDragEnd&&l.dndOptions.userDragEnd(b),l.restoreDropFeedbackLocation()}};return a};this.dragWrapper=new a.toolkit.DnDDragWrapper(m,n,j);var o=function(){return{dragEnter:function(a,b){return l.dragEnter(a,b)},dragLeave:function(a){return l.dragLeave(a)},dragOver:function(a,b,c){return l.dragOver(a,b,c)},drop:function(a,b,c){return l.drop(a,b,c)}}};this.dropWrapper=new a.toolkit.DnDDropWrapper(m,o,j),this._logger=j.create("GridDnDManager"),j&&this._logger.ifLow(function(){return{key:b.LogKeys.GridEvents.IdBinding,params:{uid:l.uid,gridId:k}}})},c}();c.Manager=d}(c=b.dnd||(b.dnd={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(){this.templateUrl="grids.ui/columnHeaderPanel/headerIconsRegion.tpl.html",this.scope={headerIcons:"=ngModel",column:"=",columnHovered:"=",levelId:"="}}return a.prototype.compile=function(a){return{pre:function(a){a.shouldVisible=function(b){for(var c=0;c<a.headerIcons.length;c++)if(1==a.headerIcons[c].keepVisible)return!0;return!(!b.alwaysVisible&&!b.showIcon)||!(0!=b.alwaysVisible||!a.columnHovered)}}}},a}();angular.module("ionwebGrids").directive("headerRegionDirective",[function(){return new b}])}(b=a.headerPanel||(a.headerPanel={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(b){var c=function(){function b(b,c){this.$compile=b,this.scope=c,this._headerIcons={},this._headerPanelScopes={},this._headerReloadEvent=new a.Event,this._popupRequested=new a.Event}return Object.defineProperty(b.prototype,"headerReloadEvent",{get:function(){return this._headerReloadEvent},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"popupRequested",{get:function(){return this._popupRequested},enumerable:!0,configurable:!0}),b.prototype.notifyOpeningPopup=function(a){this._popupRequested.raise(a,void 0)},b.prototype.init=function(a){var b=this;this._gridX=a,this._gridX.headerRegions.add(function(a){return b.createHeaderPanel(a)},0,!1),this._gridX.headerRegions.addColumnMouseOverEvent(function(a){b.checkAndSet(a.target,!0)}),this._gridX.headerRegions.addColumnMouseOutEvent(function(a){b.checkAndSet(a.target,!1)})},b.prototype.levelFromId=function(b){var c=b.indexOf(a.tables.ROW_HEADER_COLUMN_ID_PREFIX);return 0===c?parseInt(b.substr(a.tables.ROW_HEADER_COLUMN_ID_PREFIX.length)):null},b.prototype.checkAndSet=function(a,b){var c=$(a).parents('[role="columnheader"]');if(c.length){var d=c.first().attr("colid"),e=this._headerPanelScopes[this.levelFromId(d)||d];d&&e&&e.columnHovered!==b&&e.$evalAsync(function(){e.columnHovered=b})}},b.prototype.addHeaderIcon=function(a,b){var c=this._headerIcons[b];c||(c=[],this._headerIcons[b]=c),c.push(a)},b.prototype.refreshHeaderRegion=function(){var a=this;Object.keys(this._headerPanelScopes).forEach(function(b){return a._headerPanelScopes[b].$destroy()}),this._headerPanelScopes={},this._headerIcons={},this._headerReloadEvent.raise(this,void 0),this._gridX.headerRegions.refresh&&this._gridX.headerRegions.refresh()},b.prototype.createHeaderPanel=function(a){var b=this.levelFromId(a.id)||a.id;if(this._headerIcons[b]&&this._headerIcons[b].length){var c=this.scope.$new(!1);this._headerPanelScopes[b]=c,c.headerIcons=this._headerIcons[b],c.column=a.id,c.columnHovered=!1;var d=angular.element('<header-region-directive ng-model="headerIcons" column="column" column-hovered="columnHovered"></header-region-directive>'),e=this.$compile(d)(c);return c.$on("$destroy",function(){e.get(0).parentNode&&e.get(0).parentNode.removeChild(e.get(0)),$(e).remove()}),e.get(0)}},b.prototype.dispose=function(){var a=this;Object.keys(this._headerPanelScopes).forEach(function(b){return a._headerPanelScopes[b].$destroy()}),this._headerPanelScopes={},this._headerIcons={}},b}();b.ColumnHeaderRegionManager=c}(c=b.headerPanel||(b.headerPanel={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d;!function(a){a[a.Left=0]="Left",a[a.Right=1]="Right"}(d||(d={}));var e=function(){function c(b,c,d,e,f){var g=this;this.$compile=b,this.headerRegionManager=c,this.scope=d,this.dataModel=e,this.contextMenuService=f,this.currentColId="",this.aliases={},this.headerRegionManager.headerReloadEvent.add(function(){g.initHeaderRegion()}),this.keepVisibleNotification=new a.Event}return Object.defineProperty(c.prototype,"options",{get:function(){return this.scope.options},enumerable:!0,configurable:!0}),c.prototype.init=function(c,e,f,g){var h=this;this.grid=c,this.sliceAxisManager=e,this.settingsManager=f,this.condFormattingManager=g,this.unsub=[],this.columnHeaderPopupOpenEvent=new a.Event,this.scope.closeContextMenu=function(){h.closeContextMenu()},this.scope.setColumnFormattingOption=function(a,c){var d=h.scope.data.getAs(b.PresentationDataModelAdapter);if(d){var e={type:b.GridRangeType.Column,args:[a]};e=b.ResponsiveDataModel.explodeSelection(h.scope.data,e).explodedSelection,e&&d.__setColumnFormattingOptions(e,c),c||(h.scope.formattingOptions=d.tableAppliedFormattingOptions(),d.__setColumnFormattingOptions(e,void 0))}},this.scope.moveColumnLeftClicked=function(){var a=h,b=j();return a.headerPanelConfig.onColumnMoveLeft&&!a.headerPanelConfig.onColumnMoveLeft(h.scope.column.id,b,b-1)?void h.closeContextMenu():void i(d.Left,b)},this.scope.moveColumnRightClicked=function(){var a=h,b=j();return a.headerPanelConfig.onColumnMoveRight&&!a.headerPanelConfig.onColumnMoveRight(h.scope.column.id,b,b+1)?void h.closeContextMenu():void i(d.Right,b)};var i=function(a,b){if(h.sliceAxisManager.isPivotAxisAdapter){var c=h.sliceAxisManager.getManagedAxis().options.getMeasures();b>=c.length&&(b%=c.length)}if(j()>-1)switch(a){case d.Left:b>=0&&h.sliceAxisManager.moveFunction([b],b-1);break;case d.Right:var e=h.scope.data.getColumnAxis();b<=e.length()-2&&h.sliceAxisManager.moveFunction([b],b+1)}},j=function(){return"string"==typeof h.scope.column.id&&h.sliceAxisManager.isAvailable?h.sliceAxisManager.getManagedAxis().getSlice(h.scope.column.id).index():-1};this.scope.hideColumnClicked=function(){"string"==typeof h.scope.column.id&&h.sliceAxisManager.isAvailable?h.scope.hideColumn(h.scope.column.id):"number"==typeof h.scope.column.id,h.closeContextMenu()},this.initHeaderRegion()},c.prototype.initHeaderRegion=function(){var a=this;this.headerConfigIcons={},this.scope.options.headerPanels&&Object.keys(this.scope.options.headerPanels).forEach(function(b){var c=a.scope.options.headerPanels[b];c.showHeaderPanel&&a.createHeaderPanel(b,c,"settings")});for(var b=0,c=this.scope.options.rowLevelHeaderPanels&&this.scope.options.rowLevelHeaderPanels.length;b<c;b++)this.scope.options.rowLevelHeaderPanels[b].showHeaderPanel&&this.createHeaderPanel(b,this.scope.options.rowLevelHeaderPanels[b],"edit",!0);var d,e=function(b,c){if(!d){var e=a.headerConfigIcons[c.columnId],f=c.keepVisible;e.keepVisible!=f&&(e.keepVisible=f)}},f=function(b,c){var e=a.headerConfigIcons[c.columnId],f=d=c.keepVisible;f&&a.headerRegionManager.notifyOpeningPopup(a),e&&e.keepVisible!=f&&(e.keepVisible=f)};this.columnHeaderPopupOpenEvent.add(e),this.condFormattingManager.performOperationOnHeaderPanel.add(f),this.headerRegionManager.popupRequested.add(function(b){b!==a&&a.condFormattingManager&&a.condFormattingManager.dispose()})},c.prototype.getState=function(){var a=this,b={},c=this.options.outlineModeConfiguration&&this.options.outlineModeConfiguration.rowLevelDescriptors;return c&&c.forEach(function(c){if(c.referenceKey){var d=a.aliases[c.referenceKey]||c.alias;d&&(b[c.referenceKey]={alias:d})}}),b},c.prototype.setState=function(a){var b=this,c=this.options.outlineModeConfiguration&&this.options.outlineModeConfiguration.rowLevelDescriptors;if(c){var d=c.map(function(a){return a.referenceKey});Object.keys(a).forEach(function(c){if(a.hasOwnProperty(c)){var e=d.indexOf(c);e>=0&&b.setRowHeaderAlias(e,a[c].alias)}})}},c.prototype.closeContextMenu=function(){this.headerPanel&&this.headerPanel.headerContextMenu&&this.headerPanel.headerContextMenu.close(),this.unregisterFormattingWatch&&this.unregisterFormattingWatch(),this.headerPanel=null},c.prototype.dispose=function(){this.closeContextMenu(),this.unsub.forEach(function(a){return a()})},c.prototype.setButtonStatus=function(){if(this.scope.columnLeftMovementDisabled=!0,this.scope.columnRightMovementDisabled=!0,this.scope.columnHideDisabled=!0,this.sliceAxisManager.isAvailable){this.scope.columnHideDisabled=!1;var a=this.sliceAxisManager.getManagedAxis();if("string"==typeof this.scope.column.id&&a.getSlice(this.scope.column.id)){var c;if(a instanceof b.PivotAxisAdapter){var d=a,e=d.getNodeAndMeasureKey(this.scope.column.id),f=d.options.getMeasures();if(e.measureKey&&f.length>0)for(var g=0;g<f.length&&(c=g,e.measureKey!==f[g].key)&&e.measureKey!==String(f[g]);++g);else c=a.getSlice(this.scope.column.id).index()}else c=a.getSlice(this.scope.column.id).index();c>0&&(this.scope.columnLeftMovementDisabled=!1);var h=a.options.getMeasures()&&a.options.getMeasures().length||a.length();c<h-1&&(this.scope.columnRightMovementDisabled=!1)}}},c.prototype.show=function(c,d,e,f){var g=this,h=this.levelFromId(c),i=null!=h,j=i?this.grid.column(h,!0):this.grid.column(c);if(!d){if(i)d=$("[role=columnheader][rowheadercolumn="+h+"]",this.grid.domNode);else{var k=j._domId,l=$(document).find("td[id='"+k+"']");d=l.length>1?$(l[1]):$(l[0])}d=d.get(0)}if(this.headerPanel&&(this.headerPanel.columnId===c||this.headerPanel.columnId===h))return void this.closeContextMenu();this.closeContextMenu(),!i&&this.scope.fetchFilteredColumns&&this.scope.fetchFilteredColumns();var m=function(){return g.options.outlineModeConfiguration&&g.options.outlineModeConfiguration.rowLevelDescriptors[h].alias},n=i?m():j.alias;this.headerPanelConfig=i?this.options.rowLevelHeaderPanels[h]:this.options.headerPanels[c],i?(this.scope.column={id:h,alias:m()},this.scope.columnLeftMovementDisabled=!this.headerPanelConfig.onColumnMoveLeft,this.scope.columnRightMovementDisabled=!this.headerPanelConfig.onColumnMoveRight,this.scope.columnHideDisabled=!this.headerPanelConfig.onColumnHide,this.scope.isRowLevelHeaderPanel=!0):(this.scope.column=j,this.setButtonStatus(),this.scope.isRowLevelHeaderPanel=!1);var o,p=[],q=function(){return g.scope.$watch("formattingOptions",function(a,b){var d=!1;if(void 0==a&&(g.unregisterFormattingWatch(),d=!0),d){g.unregisterFormattingWatch=q()}a!=b&&g.scope.setColumnFormattingOption(c,g.scope.formattingOptions)},!0)};if(this.headerPanelConfig&&this.headerPanelConfig.showHeaderPanel){if(this.headerPanelConfig.onCreate){var r=this.headerPanelConfig.onCreate(c,function(){g.closeContextMenu()});Array.isArray(r)?p=p.concat(r):r&&p.push(r)}if(this.scope.formattingOptions=this.getColumnFormattingOption(c),this.scope.column=i?{id:h,alias:m()}:j,this.currentColId=c,!i&&this.scope.formattingOptions){this.scope.fmtCtrlOptions=a.extend({},[this.scope.options.gridFormattingControlOptions]);var s=b.SelectionHelper.columnsSelection(this.dataModel,[c]);!this.options.disableConditionalFormatting&&this.condFormattingManager.isPanelAvailable(s)&&(this.scope.fmtCtrlOptions.onShowConditionalFormattingClicked=function(){g.contextMenuService.closeAll(),g.condFormattingManager.showPanel(s,d)}),this.scope.options.toolbarOptions.enableFormatting&&(this.scope.fmtCtrlOptions.showScaleFactor||this.scope.fmtCtrlOptions.showDateFormat||this.scope.fmtCtrlOptions.showDecimalPlaces||this.scope.fmtCtrlOptions.showNegativeFormat||this.scope.fmtCtrlOptions.onShowConditionalFormattingClicked)&&p.push({text:b.Strings.Grid_FormattingOption_Title_Formatting,menuType:a.MenuItemType.Submenu,subMenu:[{menuType:a.MenuItemType.Custom,template:'<grid-formatting-control class="cellformattingoption-popup-container" ng-model="formattingOptions" options="fmtCtrlOptions"></grid-formatting-control>',scope:this.scope}]})}this.scope.options.headerPanelToolbarOptions=e,p.push({menuType:a.MenuItemType.Divider},{menuType:a.MenuItemType.Custom,templateUrl:"grids.ui/gridHeaderPanels.tpl.html",scope:this.scope});var t={anchorPoint:a.ContextMenuAnchorPoint.BottomRight,onCreate:function(a){g.columnHeaderPopupOpenEvent.raise(g,{keepVisible:!0,columnId:i?h:c}),g.headerPanel={headerContextMenu:a,columnId:c},i||g.scope.formattingOptions&&g.scope.$evalAsync(function(){g.unregisterFormattingWatch=q()})},onDestroy:function(){g.columnHeaderPopupOpenEvent.raise(g,{keepVisible:!1,columnId:i?h:c}),g.scope.column.alias!==(i?m():n)&&g.setNewAliasToColumn(!0),g.headerPanelConfig&&r&&(Array.isArray(r)?r.forEach(function(a){a.closeHandler&&a.closeHandler()}):r.closeHandler&&r.closeHandler()),i||o&&o(),g.headerPanel&&(g.headerPanel=null)}};if(this.headerRegionManager.notifyOpeningPopup(this),this.contextMenuService.openContextMenu(p,d,t),f)var u=function(){v(),w(),g.headerConfigIcons[c].keepVisible=!1,f()},v=this.keepVisibleNotification.add(function(a,b){a===g.headerConfigIcons[c]&&b===!1&&g.scope.$evalAsync(function(){u()})}),w=this.headerRegionManager.headerReloadEvent.add(u)}},c.prototype.setRowHeaderAlias=function(a,b,c){var d=this.options.outlineModeConfiguration.rowLevelDescriptors[a];d.alias=b,this.grid.rowHeader&&this.grid.rowHeader.refreshLevelCaption(a),d.referenceKey&&(this.aliases[d.referenceKey]=b,c&&this.settingsManager.notifyChanges())},c.prototype.setNewAliasToColumn=function(a){if("string"==typeof this.scope.column.id&&this.sliceAxisManager.isAvailable){var b=this.dataModel.getColumnAxis(),c=[{nodeKey:this.scope.column.id,alias:this.scope.column.alias}];b.options.setAlias(c,a)}else if("number"==typeof this.scope.column.id){var d=this.scope.column.id;this.setRowHeaderAlias(d,this.scope.column.alias,a)}a&&this.settingsManager.notifyChanges()},c.prototype.levelFromId=function(b){var c=b.indexOf(a.tables.ROW_HEADER_COLUMN_ID_PREFIX);return 0===c?parseInt(b.substr(a.tables.ROW_HEADER_COLUMN_ID_PREFIX.length)):null},c.prototype.createHeaderPanel=function(c,d,e,f){var g,h,i=this,j=!1;void 0!=d&&d.hasOwnProperty("icon")&&(d.icon&&"string"!=typeof d.icon?(void 0!=d.icon.iconName&&(e=d.icon.iconName),g=d.icon.color,h=d.icon.visible,j=!0):e=d.icon),j&&(h=this.scope.options.editingOptions.showColumnGearIconOnMouseHover===!1?b.columnIconVisibility.Always:b.columnIconVisibility.Hover);var k=!1,l={name:e,color:g,alwaysVisible:h===b.columnIconVisibility.Always};Object.defineProperty(l,"keepVisible",{get:function(){return k},set:function(a){a!==k&&i.keepVisibleNotification.raise(l,a),k=a}}),l.clicked=function(b){i.condFormattingManager&&i.condFormattingManager.dispose(),f?i.show(a.tables.ROW_HEADER_COLUMN_ID_PREFIX+c,b.currentTarget.parentNode):i.show(c,b.currentTarget.parentNode),b.stopPropagation()};var m=function(){i.scope.$evalAsync(function(){return l.keepVisible=!1}),i.closeContextMenu()};this.grid.connect(this.grid.bodyNode,"onscroll",m),this.grid.connect(this.grid,"onHScroll",m),this.headerRegionManager.addHeaderIcon(l,c),this.headerConfigIcons[c]=l},c.prototype.getColumnFormattingOption=function(a){var c=this.dataModel.getAs(b.PresentationDataModelAdapter),d={type:b.GridRangeType.Column,args:[a]};return d=b.ResponsiveDataModel.explodeSelection(this.scope.data,d).explodedSelection,c&&c.__getColumnFormattingOptions(d)},c}();c.Manager=e}(c=b.headerPanel||(b.headerPanel={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function b(){}return b.prototype.createItem=function(a,b,c,d,e){var f={id:a,displayName:b,description:c,category:d};return e&&(f.customStyle={semiTransparent:!0}),f},b.isCategoryNode=function(a){return 0===a.id.indexOf(b.categoryIdPrefix)},b.findElement=function(a,c,d){var e=b.findElementIndex(a,c,d);return e>=0?a[e]:null},b.findElementIndex=function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];if(b(e))return d}if(c)throw new Error(c);return-1},b.prototype.createNode=function(a,b,c,d,e,f){var g=this.createItem(a,b,c,e,f),h={descriptor:g,children:d?[]:null};return h},b.prototype.validateUnchoose=function(){return!0},b.ValidatationChooseResultNotValid=function(){return{valid:!1,targetItem:null,lastPosition:null,itemKeys:null}},b.prototype.validateChoose=function(a,c){for(var d={},e=[],f=function(f){var g=a.items[f];if(b.isCategoryNode(g)){var h=b.findElement(c.availableItems,function(a){return a.descriptor.id===g.id});if(!h)return{value:b.ValidatationChooseResultNotValid()};h.children.forEach(function(a){d[g.id]||(e.push(a.id),
d[a.id]=!0)})}else d[g.id]||(e.push(g.id),d[g.id]=!0)},g=0;g<a.items.length;g++){var h=f(g);if("object"==typeof h)return h.value}return a.targetItem?{valid:!0,targetItem:a.targetItem,itemKeys:e}:{valid:!0,targetItem:null,lastPosition:!0,itemKeys:e}},b.prototype.validateMove=function(a,b){if(a.targetItem){var c=a.items.indexOf(a.targetItem);if(c>=0){if(0===c)return{valid:!0,targetItem:null,putBefore:!0};var d=c-1,e=b.chosenItems[d].descriptor;return a.items.indexOf(e)>=0?{valid:!1,targetItem:null,putBefore:!1}:{valid:!0,targetItem:e,putBefore:!1}}return{valid:!0,targetItem:a.targetItem,putBefore:!0}}return{valid:!0,targetItem:null,putBefore:!1}},b.prototype.prepareSwapPanelInput=function(c){var d=this,e=[],f=[],g={},h=function(a){var c=b.categoryIdPrefix+a,f=g[c];return f?f:(f=d.createNode(c,a,a,!0,null),g[c]=f,e.push(f),f)};return c.forEach(function(b){var c=b.key,e=b.displayName||b.key,g=b.description||e;if(b.isChosen){var i=d.createNode(c,e,g,!1,b.category,b.isDropped);f.push(i),b.children&&b.children.length&&(i.children=b.children.map(function(a){return d.createItem(a.key,a.displayName||a.key,a.description||e,a.category,b.isDropped)}))}else{var j=b.category||a.Strings.Grid_ColumnSelector_Empty_Category,k=h(j),i=d.createItem(c,e,g,b.category,b.isDropped);k.children.push(i)}}),{availableItems:e,chosenItems:f}},b.prototype.evaluateItemOperations=function(a,b,c){return!0},b.prototype.evaluateAction=function(a,c,d){if(a.fromLeft&&a.toLeft)return!1;if(a.fromLeft&&!a.toLeft){var e=b.findElementIndex(c.chosenItems,function(b){return b.descriptor===a.targetItem});if(a.targetItem&&e<0)return!1;var f=this.validateChoose(a,c);return!!f.valid&&(d&&d.executeChooseCallback(f),!0)}if(!a.fromLeft&&a.toLeft){var g=this.validateUnchoose();return!!g&&(d&&d.executeUnchooseCallback(),!0)}if(a.items.length>1)for(var h=-1,i=function(d){var e=a.items[d],f=b.findElementIndex(c.chosenItems,function(a){return a.descriptor===e});if(f<0)return{value:!1};if(h<0)h=f;else{if(h!==f-1)return{value:!1};h=f}},j=0;j<a.items.length;j++){var k=i(j);if("object"==typeof k)return k.value}if(a.targetItem){var l=a.items[0],m=a.items[a.items.length-1],n=b.findElementIndex(c.chosenItems,function(a){return a.descriptor===l});if(n<0)return!1;var o=b.findElementIndex(c.chosenItems,function(a){return a.descriptor===m});if(o<0)return!1;var e=b.findElementIndex(c.chosenItems,function(b){return b.descriptor===a.targetItem});if(e<0)return!1;if(e>=n&&e<=o+1)return!1}else{var p=a.items[a.items.length-1],q=b.findElementIndex(c.chosenItems,function(a){return a.descriptor===p});if(q<0)return!1;if(q===c.chosenItems.length-1)return!1}var r=this.validateMove(a,c);return!!r.valid&&(d&&d.executeRearrangeCallback(r),!0)},b.categoryIdPrefix="__category__",b}();a.OptionsDialogAdapterBase=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(c){function d(a){var b=c.call(this)||this;return b.hasMeasures=a,b}return __extends(d,c),d.prototype.refresh=function(a){var c=this;this.responsiveDataModel=a.data.getAs(b.ResponsiveDataModel),a.fetchFilteredColumns();var d=a.filteredColumns,e=d,f=null,g={},h={},i=null;if(this.responsiveDataModel){f={};var j={},k={};i=e,i.forEach(function(a){var d=a.key;if(b.ResponsiveDataModel.isResponsiveGroup(c.responsiveDataModel,d)){var e=d;h[d]=a,g[d]=b.ResponsiveDataModel.groupedKeys(c.responsiveDataModel,d),g[d].forEach(function(a){j[a]=e,f[a]=a})}else h[d]=a,f[d]=d});var l=this.responsiveDataModel.getColumnAxis().getAs(b.SliceManagerAxisAdapter);d=l.options.getFilterVisibleSlices(),e=[],d.forEach(function(a){h[a.key]=a}),d.forEach(function(a){var b=j[a.key];b?k[b]||(k[b]=!0,e.push(h[b])):e.push(a)})}var m=e.map(function(a){var d=function(a){var b={isChosen:a.checked,key:a.key,displayName:a.displayName,description:a.description,category:a.category};return b},e=d(a),i=a.key;a.checked&&f&&(f[i]||c.responsiveDataModel&&b.ResponsiveDataModel.isResponsiveGroup(c.responsiveDataModel,i)||(e.isDropped=!0));var j=g[i];return j&&(e.children=j.map(function(a){return d(h[a])})),e}),n=this.prepareSwapPanelInput(m);return{sliceManagerColumns:d,swapPanelInput:n,allShownToTheUserColumns:e}},d.prototype.moveColumns=function(c,d,e,f,g,h){for(var i=[],j=0;j<e.length&&i.length<c.length;j++)c.indexOf(e[j].key)>=0&&i.push(j);if(i.length!==c.length)throw new Error("moved item not found");var k=0;if(g.targetItem){var l=b.OptionsDialogAdapterBase.findElementIndex(e,function(a){return a.key===g.targetItem.id},"Target item not found while moving items");k=g.putBefore?l:l+1,k=a.tables.sliceAxis.Manager.adjustTargetIndex(i,k)}else g.putBefore||(k=e.filter(function(a){return a.checked}).length);if(this.responsiveDataModel){var m=[];i&&i.length&&(m=e.splice(i[0],i.length));var n=[k,0].concat(m);Array.prototype.splice.apply(e,n),h.sliceManager.logger.logOptionsDialogVisibleColumnsMove(c,f,k);var o=b.ResponsiveDataModel.responsiveConfiguration(this.responsiveDataModel),p=a.tables.ResponsiveAxisAdapter.prepareSourceCollection(e,d,o&&o.groups),q=this.responsiveDataModel.getColumnAxis().getAs(b.SliceManagerAxisAdapter);q.options.setFilterVisibleSlices(p)}else h.sliceManager.moveFunction(i,k)},d.prototype.processHideMeasure=function(a,c,d){var e=a.map(function(a){return b.OptionsDialogAdapterBase.findElement(c,function(b){return b.key===a},"Measure not found while making it hidden")}),f=d.sliceManager.getManagedAxis();e.forEach(function(a){a.checked=!1,f.hideMeasure(a.key,!0)})},d.prototype.processHideSlice=function(a,c,d){var e=this,f={},g=a.length;a.forEach(function(a){if(e.responsiveDataModel&&b.ResponsiveDataModel.isResponsiveGroup(e.responsiveDataModel,a)){var c=b.ResponsiveDataModel.groupedKeys(e.responsiveDataModel,a);g--,c&&(c.forEach(function(a){return f[a]=a}),g+=c.length)}else f[a]=a});for(var h=0,i=0;i<c.length&&g>h;i++){var j=c[i];f[j.key]&&(j.checked=!1,h++)}if(g!==h)throw new Error("Column not found while making it hidden");d.sliceManager.setFilterVisibleSlices(c)},d.prototype.hideColumns=function(a,b,c,d){d.sliceManager.logger.logOptionsDialogVisibleColumnsHide(a,c),this.hasMeasures?this.processHideMeasure(a,b,d):this.processHideSlice(a,b,d)},d.prototype.processShowMeasure=function(a,c,d,e){var f,g=e.sliceManager.getManagedAxis();f=d.targetItem?b.OptionsDialogAdapterBase.findElementIndex(a.filter(function(a){return a.checked}),function(a){return a.key===d.targetItem.id},"Target measure not found while making showing columns"):d.lastPosition?a.filter(function(a){return a.checked}).length:0,e.sliceManager.logger.logOptionsDialogVisibleColumnsShow(d.itemKeys,c,f),d.itemKeys.forEach(function(c){var d=b.OptionsDialogAdapterBase.findElementIndex(a,function(a){return a.key===c},"Measure not found while making it visible"),h=a[d];h.checked=!0,g.hideMeasure(h.key,!1),d<f?e.sliceManager.moveFunction([d],f+1):e.sliceManager.moveFunction([d],f),e.fetchFilteredColumns(),a=e.filteredColumns})},d.prototype.processShowSliceNotResponsive=function(a,b,c,d){for(var e={},f=[],g=0,h=-1,i=0;i<a.length;i++){var j=a[i];c.itemKeys.indexOf(j.key)>=0?e[j.key]=j:f.push(j),j.checked&&(g++,c.targetItem&&c.targetItem.id===j.key&&(h=i))}if(c.targetItem){if(h<0)throw new Error("Target column not found while making showing columns")}else h=c.lastPosition?g:0;d.sliceManager.logger.logOptionsDialogVisibleColumnsShow(c.itemKeys,b,h),c.itemKeys.forEach(function(a){var b=e[a];if(!b)throw new Error("Column not found while making it visible");b.checked=!0,f.splice(h,0,b),h++}),d.sliceManager.setFilterVisibleSlices(f)},d.prototype.processShowSliceResponsive=function(a,b,c,d,e){var f={};d.itemKeys.forEach(function(a){return f[a]=a}),a.forEach(function(a){f[a.key]&&(a.checked=!0)});var g={valid:d.valid,targetItem:d.targetItem,putBefore:!0};this.moveColumns(d.itemKeys,a,b,c,g,e)},d.prototype.showColumns=function(a,b,c,d,e){this.hasMeasures?this.processShowMeasure(b,c,d,e):this.responsiveDataModel?this.processShowSliceResponsive(a,b,c,d,e):this.processShowSliceNotResponsive(a,c,d,e)},d.prototype.applyAction=function(a,b,c){var d=this,e=function(a){d.showColumns(b.sliceManagerColumns,b.allShownToTheUserColumns,b.swapPanelInput.chosenItems,a,c)},f=function(){var e=a.items.map(function(a){return a.id});d.hideColumns(e,b.sliceManagerColumns,b.swapPanelInput.chosenItems,c)},g=function(e){var f=a.items.map(function(a){return a.id});d.moveColumns(f,b.sliceManagerColumns,b.allShownToTheUserColumns,b.swapPanelInput.chosenItems,e,c)},h={executeChooseCallback:e,executeUnchooseCallback:f,executeRearrangeCallback:g};return this.evaluateAction(a,b.swapPanelInput,h)},d}(b.OptionsDialogAdapterBase);b.OptionsDialogVisibleColumnAdapter=c}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(c){var d=this;this.scope=c,this.adapter=new b.OptionsDialogVisibleColumnAdapter(c.sliceManager.isPivotAxisAdapter);var e=this.adapter.refresh(this.scope);this.scope.availableNodes=e.swapPanelInput.availableItems,this.scope.chosenNodes=e.swapPanelInput.chosenItems;var f=c.gridStateUpdatedEvent.add(function(){g()});this.scope.$on("$destroy",function(){f()});var g=function(){e=d.adapter.refresh(d.scope),d.scope.$evalAsync(function(){d.scope.availableNodes=e.swapPanelInput.availableItems,d.scope.chosenNodes=e.swapPanelInput.chosenItems})};this.scope.onAction=function(a){var b=d.adapter.applyAction(a,e,d.scope);b&&g()},this.scope.allowedOperationOptions={onAllowedOperationRequest:function(b){var c=d.adapter.evaluateAction(b.action,e.swapPanelInput,null);b.allowedOperation=c?a.toolkit.SwapPanelAllowedOperation.Move:a.toolkit.SwapPanelAllowedOperation.None},onHasAllowedOperation:function(a){}}}return c}();angular.module("ionwebGrids").controller("OptionsDialogVisibleColumnsController",["$scope",function(a){return new c(a)}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(b){function c(a,c){var d=b.call(this)||this;return d.toggleSortingCallback=a,d.toggleAbsoluteCallback=c,d}return __extends(c,b),c.loadLevelId=function(a){var b=a>=0?c.levelIdPrefix+a:c.rowHeaderPrefix;return c.levelIds[b]=a,b},c.isLevelId=function(a){return 0===a.indexOf(c.levelIdPrefix)||a===c.rowHeaderPrefix},c.sortedColumnKeyToItemId=function(a){return"number"==typeof a?c.loadLevelId(a):a},c.itemIdToSortedColumnKey=function(a){return c.isLevelId(a)?c.levelIds[a]:a},c.prototype.getSortingDataModel=function(b){var c=b.data.getAs(a.SortingDataModel);if(c)return c;var d=b.data.getAs(a.VirtualSortingDataModel);if(d)return d;throw new Error("Sorting is not supported")},c.prototype.createColumnDefinitionForLevel=function(a,b,d){var e={isChosen:!1,key:c.loadLevelId(a),displayName:b,description:b,category:d};return e},c.prototype.prepareColumnDefinitions=function(b,c,d,e){var f=d.map(function(a){var b={isChosen:!1,key:a.nodeKey,displayName:a.displayName(),description:a.description,category:a.category};return b});if(b.hasHierarchicalRows())if(b.options.enableOutlineMode){if(b.options.outlineModeConfiguration&&b.options.outlineModeConfiguration.rowLevelDescriptors&&b.options.outlineModeConfiguration.rowLevelDescriptors.length>1)for(var g=b.options.outlineModeConfiguration.compact!==!1?1:0,h=(b.options.outlineModeConfiguration.rowLevelDescriptors.length-g,g);h<b.options.outlineModeConfiguration.rowLevelDescriptors.length;h++){var i=b.options.outlineModeConfiguration.rowLevelDescriptors[h].alias||b.options.outlineModeConfiguration.rowLevelDescriptors[h].caption||"Level "+(h+1),j=i+" ("+a.Strings.Grid_Row_Header_Groups+")",k=this.createColumnDefinitionForLevel(h,j,a.Strings.Grid_Row_Header_Groups);f.push(k)}}else{var j=b.data.getRowAxis().options.descriptor&&b.data.getRowAxis().options.descriptor.caption||a.Strings.Grid_Row_Header_Groups,k=this.createColumnDefinitionForLevel(-1,j,a.Strings.Grid_Row_Header_Groups);f.push(k)}else{var l=e.filter(function(a){return"number"==typeof a.keyOrLevel});if(l.length>1)throw new Error("Unexpected sortedLevels while creating sorting panel");if(1===l.length&&l[0].keyOrLevel!==-1)throw new Error("Unexpected level while creating sorting panel");if(b.options.showRowHeaders||e.some(function(a){return"number"==typeof a.keyOrLevel})){var j=b.data.getRowAxis().options.descriptor&&b.data.getRowAxis().options.descriptor.caption||a.Strings.Grid_Row_Header_Sorting_Title,k=this.createColumnDefinitionForLevel(-1,j,a.Strings.Grid_Row_Header_Sorting_Title);f.push(k)}}return f},c.prototype.collectSortableItems=function(b,c){var d=a.collectAvailableItems(c.getColumnAxis()),e=c.getRowAxis(),f=d.filter(function(a){return!(e.disabledKeys[a.nodeKey]||e.oneShotSortKeys[a.nodeKey])});return f},c.prototype.refresh=function(b){var d=this,e=this.getSortingDataModel(b),f=this.collectSortableItems(b,e),g=b.sortingManager.getCurrentSorting()||[],h=[];g.forEach(function(c){if("string"==typeof c.keyOrLevel){var d=a.OptionsDialogAdapterBase.findElement(f,function(a){return a.nodeKey===c.keyOrLevel});d&&h.push(c)}else 0===c.keyOrLevel&&b.options.enableOutlineMode&&b.options.outlineModeConfiguration&&b.options.outlineModeConfiguration.compact!==!1||h.push(c)});var i=this.prepareColumnDefinitions(b,e,f,h);h.forEach(function(b,d){var e=c.sortedColumnKeyToItemId(b.keyOrLevel),f=a.OptionsDialogAdapterBase.findElementIndex(i,function(a){return a.key===e},"Sorted item is not found in sortable items while refreshing the sorting swap panel. Item id: "+e+"."),g=i[f];g.isChosen=!0,i.splice(f,1),i.splice(d,0,g)});var j=this.prepareSwapPanelInput(i);return h.forEach(function(b){var e=c.sortedColumnKeyToItemId(b.keyOrLevel),f=a.OptionsDialogAdapterBase.findElement(j.chosenItems,function(a){return a.descriptor.id===e},"Sorted item is not found in sortable items while refreshing directions in the sorting swap panel. Item id: "+e+".");f.descriptor.actions=[{button:b.direction===a.SortDirection.Descending?"triangleDown":"triangleUp",action:function(a){d.toggleSortingCallback(f.descriptor)}},{button:b.sortType===a.SortType.NumericAbsolute,action:function(a){d.toggleAbsoluteCallback(f.descriptor)}}]}),{sortedColumns:h,swapPanelInput:j}},c.prototype.sortColumns=function(b,d,e){var f=b.slice(),g=d.itemKeys.map(function(b){var d=c.itemIdToSortedColumnKey(b),f=e.sortingManager.createSortedColumn(d,a.SortDirection.Ascending);return f});!d.lastPosition;this.enrichSorting(g,f,d.targetItem,d.lastPosition,e)},c.prototype.enrichSorting=function(b,d,e,f,g){var h=0;if(e){var i=c.itemIdToSortedColumnKey(e.id);h=a.OptionsDialogAdapterBase.findElementIndex(d,function(a){return a.keyOrLevel===i},"Target item not found while updating sorting items")}else f&&(h=d.length);d.splice.apply(d,[h,0].concat(b)),this.applySorting(d,g)},c.prototype.unsortColumns=function(a,b,d){var e=[];b.forEach(function(b){var d=c.sortedColumnKeyToItemId(b.keyOrLevel);a.indexOf(d)<0&&e.push(b)}),this.applySorting(e,d)},c.prototype.updateSortingPriority=function(b,d,e,f){var g=b.map(function(b){var e=c.itemIdToSortedColumnKey(b),f=a.OptionsDialogAdapterBase.findElement(d,function(a){return a.keyOrLevel===e},"Item not found while moving sorting items");return f}),h=d.filter(function(a){return b.indexOf(c.sortedColumnKeyToItemId(a.keyOrLevel))<0}),i=!e.putBefore;this.enrichSorting(g,h,e.targetItem,i,f)},c.prototype.applySorting=function(b,c){c.sortingManager.setCurrentSorting(b);var d=a.DataTable.convertSortedColumn(b,c.sortingManager.getSortRowAxis());c.sortingManager.getSortRowAxis().setSortCriteria(d)},c.prototype.toggleSorting=function(b,d,e){var f=d.sortedColumns.slice(),g=c.itemIdToSortedColumnKey(b.id),h=a.OptionsDialogAdapterBase.findElement(f,function(a){return a.keyOrLevel===g},"Item not found while changing the sorting direction");return!!h&&(h.direction=h.direction===a.SortDirection.Descending?a.SortDirection.Ascending:a.SortDirection.Descending,this.applySorting(f,e),!0)},c.prototype.toggleAbsolute=function(b,d,e){var f=d.sortedColumns.slice(),g=c.itemIdToSortedColumnKey(b.id),h=a.OptionsDialogAdapterBase.findElement(f,function(a){return a.keyOrLevel===g},"Item not found while changing the sorting type");return!!h&&(h.sortType=h.sortType===a.SortType.NumericAbsolute?a.SortType.Generic:a.SortType.NumericAbsolute,this.applySorting(f,e),!0)},c.prototype.validateChoose=function(c,d){var e=c.items.some(function(b){return a.OptionsDialogAdapterBase.isCategoryNode(b)});return e?{valid:!1,targetItem:null,itemKeys:null}:b.prototype.validateChoose.call(this,c,d)},c.prototype.evaluateItemOperations=function(b,c,d){if(c){var e=b.some(function(b){return a.OptionsDialogAdapterBase.isCategoryNode(b)});if(e)return!1}return!0},c.prototype.applyAction=function(a,b,c){var d=this,e=function(a){d.sortColumns(b.sortedColumns,a,c)},f=function(){var e=a.items.map(function(a){return a.id});d.unsortColumns(e,b.sortedColumns,c)},g=function(e){var f=a.items.map(function(a){return a.id});d.updateSortingPriority(f,b.sortedColumns,e,c)},h={executeChooseCallback:e,executeUnchooseCallback:f,executeRearrangeCallback:g};return this.evaluateAction(a,b.swapPanelInput,h)},c.levelIdPrefix="__level__",c.rowHeaderPrefix="__row_header__",c.levelIds={},c}(a.OptionsDialogAdapterBase);a.OptionsDialogSortingAdapter=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(c){var d=this;this.scope=c;var e=null,f=function(){e=d.adapter.refresh(d.scope),d.scope.$evalAsync(function(){d.scope.availableNodes=e.swapPanelInput.availableItems,d.scope.chosenNodes=e.swapPanelInput.chosenItems,d.scope.chosenActionDescriptors=[b.Strings.Grid_OptionsDialog_Sorting_Direction,b.Strings.Grid_OptionsDialog_Sorting_Absolute]})},g=function(a){var b=d.adapter.toggleSorting(a,e,d.scope);b&&f()},h=function(a){var b=d.adapter.toggleAbsolute(a,e,d.scope);b&&f()};this.adapter=new b.OptionsDialogSortingAdapter(g,h),f(),this.scope.onAction=function(a){var b=d.adapter.applyAction(a,e,d.scope);b&&f()},this.scope.allowedOperationOptions={onAllowedOperationRequest:function(b){var c=d.adapter.evaluateAction(b.action,e.swapPanelInput,null);b.allowedOperation=c?a.toolkit.SwapPanelAllowedOperation.Move:a.toolkit.SwapPanelAllowedOperation.None},onHasAllowedOperation:function(a){var b=d.adapter.evaluateItemOperations(a.items,a.fromLeft,e.swapPanelInput);a.noOperation=!b}};var i=[];i.push(this.scope.$watch("options.enableOutlineMode",function(){f()})),this.scope.options.outlineModeConfiguration&&i.push(this.scope.$watch("options.outlineModeConfiguration.rowLevelDescriptors",function(){f()})),i.push(this.scope.gridStateUpdatedEvent.add(function(){f()})),this.scope.$on("$destroy",function(){i.forEach(function(a){return a()})})}return c}();angular.module("ionwebGrids").controller("OptionsDialogSortingController",["$scope",function(a){return new c(a)}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.getGroupingDataModel=function(b){var c=b.data.getAs(a.GroupingDataModel);if(c)return c;throw new Error("Grouping is not supported")},c.prototype.isGroupableColumn=function(a,b){var c=!0;return b.options&&b.options.verticalGroupingGridOptions&&b.options.verticalGroupingGridOptions.columnOptions&&b.options.verticalGroupingGridOptions.columnOptions[a]&&b.options.verticalGroupingGridOptions.columnOptions[a].disableGrouping&&(c=!1),c},c.prototype.prepareColumnDefinitions=function(a,b){var c=b.map(function(a){var b={isChosen:!1,key:a.nodeKey,displayName:a.displayName(),description:a.description,category:a.category};return b});return c},c.prototype.collectGroupableItems=function(b){var d=this,e=c.getGroupingDataModel(b),f=a.collectAvailableItems(e.getColumnAxis()),g=f.filter(function(a){return d.isGroupableColumn(a.nodeKey,b)});return g},c.prototype.refresh=function(b){var d=c.getGroupingDataModel(b).getGroupedColumns(),e=this.collectGroupableItems(b),f=d.filter(function(b){return!!a.OptionsDialogAdapterBase.findElement(e,function(a){return a.nodeKey===b.key})}),g=this.prepareColumnDefinitions(b,e);f.forEach(function(b,c){var d=a.OptionsDialogAdapterBase.findElementIndex(g,function(a){return a.key===b.key},"Grouped item is not found in groupable items while refreshing the grouping swap. Item id: "+b.key+"."),e=g[d];e.isChosen=!0,g.splice(d,1),g.splice(c,0,e)});var h=this.prepareSwapPanelInput(g);return{groupedColumns:f,swapPanelInput:h}},c.prototype.groupByColumns=function(a,b,c){var d=a.slice(),e=b.itemKeys.map(function(a){var b={key:a};return b});!b.lastPosition;this.enrichGrouping(e,d,b.targetItem,b.lastPosition,c)},c.prototype.enrichGrouping=function(b,c,d,e,f){var g=0;d?g=a.OptionsDialogAdapterBase.findElementIndex(c,function(a){return a.key===d.id},"Target item not found while updating grouped items"):e&&(g=c.length),c.splice.apply(c,[g,0].concat(b)),this.applyGrouping(c,f)},c.prototype.ungroupByColumns=function(a,b,c){var d=[];b.forEach(function(b){a.indexOf(b.key)<0&&d.push(b)}),this.applyGrouping(d,c)},c.prototype.updateGroupingPriority=function(b,c,d,e){var f=b.map(function(b){var d=a.OptionsDialogAdapterBase.findElement(c,function(a){return a.key===b},"Item not found while moving grouped items");return d}),g=c.filter(function(a){return b.indexOf(a.key)<0}),h=!d.putBefore;this.enrichGrouping(f,g,d.targetItem,h,e)},c.prototype.applyGrouping=function(a,b){c.getGroupingDataModel(b).setGroupedColumns(a)},c.prototype.validateChoose=function(c,d){var e=c.items.some(function(b){return a.OptionsDialogAdapterBase.isCategoryNode(b)});return e?{valid:!1,targetItem:null,itemKeys:null}:b.prototype.validateChoose.call(this,c,d)},c.prototype.evaluateItemOperations=function(b,c,d){if(c){var e=b.some(function(b){return a.OptionsDialogAdapterBase.isCategoryNode(b)});if(e)return!1}return!0},c.prototype.applyAction=function(a,b,c){var d=this,e=function(a){d.groupByColumns(b.groupedColumns,a,c)},f=function(){var e=a.items.map(function(a){return a.id});d.ungroupByColumns(e,b.groupedColumns,c)},g=function(e){var f=a.items.map(function(a){return a.id});d.updateGroupingPriority(f,b.groupedColumns,e,c)},h={executeChooseCallback:e,executeUnchooseCallback:f,executeRearrangeCallback:g};return this.evaluateAction(a,b.swapPanelInput,h)},c}(a.OptionsDialogAdapterBase);a.OptionsDialogGroupingAdapter=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(c){var d=this;this.scope=c;var e=null,f=function(){e=d.adapter.refresh(d.scope),d.scope.$evalAsync(function(){d.scope.availableNodes=e.swapPanelInput.availableItems,d.scope.chosenNodes=e.swapPanelInput.chosenItems})},g=c.data.getAs(b.GroupingDataModel);if(!g)throw new Error("GroupingDataModel not found.");this.adapter=new b.OptionsDialogGroupingAdapter,f();var h=!1;this.scope.onAction=function(a){h=!0;var b=d.adapter.applyAction(a,e,d.scope);b&&f(),h=!1},this.scope.allowedOperationOptions={onAllowedOperationRequest:function(b){var c=d.adapter.evaluateAction(b.action,e.swapPanelInput,null);b.allowedOperation=c?a.toolkit.SwapPanelAllowedOperation.Move:a.toolkit.SwapPanelAllowedOperation.None},onHasAllowedOperation:function(a){var b=d.adapter.evaluateItemOperations(a.items,a.fromLeft,e.swapPanelInput);a.noOperation=!b}};var i=[];i.push(g.groupingChanged.add(function(){h||f()})),this.scope.$on("$destroy",function(){i.forEach(function(a){return a()})})}return c}();angular.module("ionwebGrids").controller("OptionsDialogGroupingController",["$scope",function(a){return new c(a)}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(a,b,c,d){this.scope=a,this.dataModel=b,this.dialogService=c,this.templateManager=d,this.unsubs=[],this.initWatches()}return Object.defineProperty(c.prototype,"options",{get:function(){return this.scope.options},enumerable:!0,configurable:!0}),c.prototype.refreshOptionDialog=function(){if(this.cScope){if(this.options.toolbarOptions&&this.options.toolbarOptions.enableAppearanceOptions===!1||(this.scope.appearanceOptions=b.createAppearanceOptions(this.scope.options)),this.shouldShowGridFormattingOptions()){var a=this.scope.data.getAs(b.PresentationDataModelAdapter);a.tableAppliedFormattingOptions();this.removeGridFormattingOptionsWatch&&(this.removeGridFormattingOptionsWatch(),this.cScope.dialogOptions.formattingOptions=a.tableAppliedFormattingOptions(),this.removeGridFormattingOptionsWatch=this.registerFormattingGridOptionsWatch())}this.initTemplateScope()}},c.prototype.init=function(a){this.templateManager=a,this.initWatches()},c.prototype.initWatches=function(){var a=this;this.unsubs.push(this.scope.$watch("isOpen",function(c){var d=a.scope.data.getAs(b.PresentationDataModelAdapter);d&&a.cScope&&(a.cScope.dialogOptions.formattingOptions=d.tableAppliedFormattingOptions())}))},c.prototype.initTemplateScope=function(){var a=this;this.templateManager&&(this.unsubTemplateMetaDataWatch&&this.unsubTemplateMetaDataWatch(),this.cScope.onRestore=function(){a.templateManager.restoreTemplate().catch(function(b){a.cScope.$evalAsync(function(){a.cScope.templateModelConfig.error=b})})},this.unsubTemplateMetaDataWatch=this.cScope.$watch("templateModelConfig.templateMd",function(b,c){b!==c&&(b?a.templateManager.applyTemplate(b).catch(function(b){a.cScope.$evalAsync(function(){a.cScope.templateModelConfig.error=b})}):a.templateManager.clearTemplate())}))},c.prototype.dispose=function(){this.unsubs.forEach(function(a){return a()}),this.unsubs=[]},c.prototype.shouldShowGridFormattingOptions=function(){var a=this.dataModel.getAs(b.PresentationDataModelAdapter);return!(!a||this.options.toolbarOptions&&this.options.toolbarOptions.enableFormatting===!1)&&(!this.options.gridFormattingControlOptions||this.options.gridFormattingControlOptions.showDecimalPlaces!==!1||this.options.gridFormattingControlOptions.showNegativeFormat!==!1||this.options.gridFormattingControlOptions.showScaleFactor!==!1||this.options.gridFormattingControlOptions.showDateFormat!==!1)},c.prototype.show=function(){var c=this;if(this.cScope=this.scope.$new(!1,this.scope),this.cScope.optionsDialogTabs=[],this.cScope.dialogOptions={formattingOptions:this.options.formattingOptions},this.templateManager&&(this.cScope.templateModelConfig={templateMd:this.templateManager.getTemplateMd(),gridState:this.templateManager.gridState},this.cScope.templateStorageManager=this.templateManager.storageManager,this.initTemplateScope()),!this.options.toolbarOptions||this.options.toolbarOptions.enableAppearanceOptions!==!1){this.scope.appearanceOptions=b.createAppearanceOptions(this.options);var d={heading:b.Strings.Grid_AppearanceOption_Title_Appearance,content:"grids.ui/optionsDialog/AppearanceTab.tpl.html"};this.cScope.optionsDialogTabs.push(d)}if(this.shouldShowGridFormattingOptions()){var e=this.dataModel.getAs(b.PresentationDataModelAdapter),d={heading:b.Strings.Grid_FormattingOption_Title_Formatting,content:"grids.ui/optionsDialog/FormattingTab.tpl.html"};this.cScope.optionsDialogTabs.push(d),this.cScope.dialogOptions.formattingOptions=e.tableAppliedFormattingOptions(),this.scope.$evalAsync(function(){return c.removeGridFormattingOptionsWatch=c.registerFormattingGridOptionsWatch()})}var f=!1;if(this.scope.columnSelectorEnabled()){var g={heading:b.Strings.Grid_OptionsDialog_VisibleColumns_Title,content:"grids.ui/optionsDialog/OptionsDialogVisibleColumns.tpl.html"};this.cScope.optionsDialogTabs.push(g),f=!0}if(this.scope.sortingSelectorEnabled()&&!this.scope.sliceManager.isPivotAxisAdapter){var h={heading:b.Strings.Grid_OptionsDialog_Sorting_Title,content:"grids.ui/optionsDialog/OptionsDialogSorting.tpl.html"};this.cScope.optionsDialogTabs.push(h),f=!0}var i=this.scope.options.verticalGroupingGridOptions&&this.scope.options.verticalGroupingGridOptions.disableGroupingChange,j=this.scope.data.getAs(b.GroupingDataModel);if(j&&!i){var k={heading:b.Strings.Grid_OptionsDialog_Grouping_Title,content:"grids.ui/optionsDialog/OptionsDialogGrouping.tpl.html"};this.cScope.optionsDialogTabs.push(k),f=!0}var l={title:b.Strings.Title_Options,templateUrl:"grids.ui/optionsDialog/optionsDialog.tpl.html",scope:this.cScope,canClose:!0,disableFullScreenMode:!0,enableFlexLayout:!0};f?l.size=a.DialogSizeInternal.MediumSmall:(l.size=a.DialogSize.Fixed,l.fixedSizeDialogOptions={width:"320px"}),this.dialogService.show(l).closed.finally(function(){c.removeGridFormattingOptionsWatch&&(c.removeGridFormattingOptionsWatch(),c.removeGridFormattingOptionsWatch=null),c.cScope.$destroy()})},c.prototype.registerFormattingGridOptionsWatch=function(){var a=this;return this.cScope.$watch("dialogOptions.formattingOptions",function(c,d){if(c!==d){var e=!1;void 0==c&&(a.removeGridFormattingOptionsWatch&&(a.removeGridFormattingOptionsWatch(),a.removeGridFormattingOptionsWatch=null),e=!0);var f=a.scope.data.getAs(b.PresentationDataModelAdapter);f&&(f.setUserTableFormattingOptions(a.cScope.dialogOptions.formattingOptions),e&&(a.cScope.dialogOptions.formattingOptions=f.tableAppliedFormattingOptions(),a.removeGridFormattingOptionsWatch=a.registerFormattingGridOptionsWatch()))}},!0)},c}();c.Manager=d}(c=b.optionsDialog||(b.optionsDialog={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(){}return c.getFirstValidCondition=function(){return b.conditionTypes.filter(function(a){return null!==a})[0]},c.allConditionTypeToOptions=function(a){for(var c,d,e=[],f=0,g=b.conditionTypes.length;f<g;f++)if(null===b.conditionTypes[f]){var h;h=0===f?b.Strings.Text_Cond_None:"-",e.push({label:h,value:f.toString()})}else c=b.conditionTypes[f].conditionDataType(),!b.conditionTypes[f]||void 0!==a&&c!==a||(void 0!==d&&c!==d&&e.push({label:"-",value:(f+100).toString()}),e.push({label:b.conditionTypes[f]&&b.conditionTypes[f].toString(!0)||"-",value:f.toString()}),d=c);return"-"===e[e.length-1].label&&e.pop(),e},c.findTypeIndex=function(a){var c=b.cloneCondition(a);c.value=c.min=c.max=void 0;for(var d=JSON.stringify(c),e=0;e<b.conditionTypes.length;e++)if(b.conditionTypes[e]&&JSON.stringify(b.conditionTypes[e])===d)return e;return 0},c.newFromTemplate=function(c){if(c instanceof b.StringCompareCondition)return b.StringCompareCondition.create(a.extend({},[c,{value:b.Strings.Text_Cond_Default_Text}]));if(c instanceof b.StringContainsCondition)return b.StringContainsCondition.create(a.extend({},[c,{value:b.Strings.Text_Cond_Default_Text}]));if(c instanceof b.NumericCompareCondition)return b.NumericCompareCondition.create(a.extend({},[c,{value:100}]));if(c instanceof b.DateCompareCondition)return b.DateCompareCondition.create(a.extend({},[c,{value:new Date(Date.now())}]));if(c instanceof b.NumericRangeCondition)return b.NumericRangeCondition.create(a.extend({},[c,{min:0,max:100}]));if(c instanceof b.DateRangeCondition)return b.DateRangeCondition.create(a.extend({},[c,{min:new Date(Date.now()),max:new Date(Date.now())}]));throw new Error("Unsupported template type "+c.toString())},c}();b.Utilities=c}(b=a.rules||(a.rules={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(b){var c=function(){function a(){}return a}();b.VisitingArgs=c;var d=function(){function b(a,b){this.impl={root:void 0,listener:void 0,default:void 0},this.impl.root=a,this.impl.listener=b,this.impl.default={and:function(a,b){return b.children=a.children,!0},or:function(a,b){return b.children=a.children,!0},not:function(a,b){return b.children=a.children,!0}}}return b.prototype.visit=function(){var a=this.impl.root;this.visitRoot(a)},b.prototype.visitRoot=function(a){if(a&&a.children&&a.children.length)for(var b=0,c=a.children;b<c.length;b++){var d=c[b];this.visitNode(d)}},b.prototype.visitNode=function(b){if(b)switch(b.nodeType){case a.NodeType.And:var c=b;this.visitAndNode(c);break;case a.NodeType.Or:var d=b;this.visitOrNode(d);break;case a.NodeType.Not:var e=b;this.visitNotNode(e);break;case a.NodeType.Condition:var f=b;this.visitCondition(f)}},b.prototype.visitAndNode=function(a){var b=new c,d=this.impl.listener.and&&this.impl.listener.and(a,b)||this.impl.default.and(a,b);
if(d&&b.children&&b.children.length)for(var e=0,f=b.children;e<f.length;e++){var g=f[e];this.visitNode(g)}},b.prototype.visitOrNode=function(a){var b=new c,d=this.impl.listener.or&&this.impl.listener.or(a,b)||this.impl.default.or(a,b);if(d&&b.children&&b.children.length)for(var e=0,f=b.children;e<f.length;e++){var g=f[e];this.visitNode(g)}},b.prototype.visitNotNode=function(a){var b=new c,d=this.impl.listener.not&&this.impl.listener.not(a,b)||this.impl.default.not(a,b);if(d&&b.children&&b.children.length)for(var e=0,f=b.children;e<f.length;e++){var g=f[e];this.visitNode(g)}},b.prototype.visitCondition=function(a){var b=new c;this.impl.listener.condition&&this.impl.listener.condition(a,b)},b}();b.FilterTreeVisitor=d}(b=a.xrs||(a.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function d(){}return d.buildFilterTree=function(d){var e=new c.FilterRootNode;if(void 0===d||0===d.length)return e;var f=new c.FilterAndNode;e.addChild(f);for(var g=0,h=d;g<h.length;g++){var i=h[g];if(i.nodeType===b.NodeType.Condition){var j=i;f.addChild(j.clone())}else{if(i.nodeType!==b.NodeType.And)throw new TypeError(a.stringFormat(b.Strings.Text_Filter_Panel_Exception_Root_Node_Build_Filter_Tree,{nodeType:i.nodeType}));var k=i;if(void 0===k.children||0===k.children.length)continue;for(var l=0,m=k.children;l<m.length;l++){var n=m[l];f.addChild(n.clone())}}}return e},d.extractFilterNodes=function(d){var e={};if(d){var f=function(c){var d=c.id||c.tag;if(c.nodeType===b.NodeType.Condition&&!d)throw new Error(a.stringFormat(b.Strings.Text_Filter_Panel_Exception_Extract_Filter_Node,{nodeDesc:c.description}));return d},g={condition:function(a,b){var c=f(a),d=c;return e[d]=a,!0}},h=new c.FilterTreeVisitor(d,g);h.visit()}return e},d}();c.FilterRootNodeBuilder=d}(c=b.xrs||(b.xrs={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function a(){}return a.getDefaultColumnFilterCondition=function(a,c,e){return new d(a,c&&b.Utilities.newFromTemplate(c)||b.conditionTypes[0],e&&e.slice()||[])},a}();b.ColumnFilterConditionFactory=c;var d=function(){function a(a,b,c){this.column=a,this.condition=b,this.inValues=c}return a.prototype.getColumn=function(){return this.column},a.prototype.getCondition=function(){var a,c=null;switch(this.getValueType()){case"number":c=b.NumericInCondition.create(this.inValues);break;case"object":c=b.DateInCondition.create(this.inValues);break;case"string":c=b.StringInCondition.create(this.inValues)}return a=this.condition,c&&a?a=b.AndCondition.create([c,a]):c&&(a=c),a},a.prototype.getValueType=function(){return this.inValues.length&&typeof this.inValues[0]},a.prototype.getState=function(){return{condition:this.condition,values:this.inValues,column:this.column}},a.prototype.setState=function(a){var c=a;this.condition=b.deserializeCondition(c.condition),this.inValues=c.values,this.column=c.column},a}(),e=function(){function c(a){var b=this;this.$scope=a,this.conditionFilter=this.$scope.conditionFilter,this.initActionButtons(),this.initConditionPanel(),this.initUIHandlingMethods(),this.$scope.$watch("cellValues",function(){b.initListSelector()})}return c.prototype.initActionButtons=function(){var a=this;this.$scope.closeClicked=function(){a.$scope.close()},this.$scope.applyAndCloseClicked=function(){a.conditionFilter.condition=a.$scope.conditionScope,a.conditionFilter.inValues=a.selectedItems.map(function(b){return a.getCompareValue(b)}),a.conditionFilter.condition||a.conditionFilter.inValues.length?a.$scope.applyAndClose({condition:a.conditionFilter}):a.$scope.clearAndClose()}},c.prototype.initConditionPanel=function(){var a=this;this.$scope.conditionTypes=b.Utilities.allConditionTypeToOptions(this.$scope.filterConfiguration.conditionDataType),this.conditionFilter.condition?this.$scope.typeIndex=b.Utilities.findTypeIndex(this.conditionFilter.condition).toString():this.$scope.typeIndex="0",this.$scope.conditionScope=b.cloneCondition(this.conditionFilter.condition||b.conditionTypes[0]),this.$scope.$watch("typeIndex",function(c,d){if(c!==d)try{a.$scope.conditionScope=b.Utilities.newFromTemplate(b.conditionTypes[c||0])}catch(b){a.$scope.conditionScope=null}})},c.prototype.initUIHandlingMethods=function(){var a=this;this.$scope.expandedIconForConditionPanel=!1,this.$scope.expandedIconForValuePanel=!1,this.$scope.changeIconForConditionPanel=function(){a.$scope.expandedIconForConditionPanel=!a.$scope.expandedIconForConditionPanel},this.$scope.changeIconForValuePanel=function(){a.$scope.expandedIconForValuePanel=!a.$scope.expandedIconForValuePanel}},c.prototype.initListSelector=function(){var a=this;this.selectedItems=[],this.$scope.cellValues&&(this.$scope.listSelectorItems=this.cellValuesListSelectorItems(this.$scope.cellValues)),this.$scope.itemClicked=function(b){var c=a.cellValueListSelector.indexOf(b),d=a.$scope.cellValues[c];b.checked?a.selectedItems.splice(a.selectedItems.indexOf(d),1):a.selectedItems.push(d),b.checked=!b.checked},this.$scope.displayOptions={hideItemDescription:!0,hideListHeader:!0,disableSorting:!0},this.$scope.invalid=function(){return a.$scope.conditionScope&&a.$scope.conditionScope.validate()},this.$scope.changeCheckedOnValues=function(b){a.$scope.listSelectorItems&&a.$scope.listSelectorItems.length&&(a.selectedItems=[],a.$scope.listSelectorItems.forEach(function(c){c.checked!==b&&(c.checked=b);var d=a.$scope.listSelectorItems.indexOf(c),e=a.$scope.cellValues[d];b&&a.selectedItems.push(e)}))}},c.prototype.cellValuesListSelectorItems=function(a){var b=this,c=[],d=[],e=this.conditionFilter.inValues||[];return this.cellValueListSelector=[],this.$scope.disableSorting||this.applySorting(a),a.forEach(function(a,f){var g={key:f.toString(),displayName:a.getFormatted(),checked:!1},h=b.getCompareValue(a);e.indexOf(h)!==-1?(g.checked=!0,b.selectedItems.push(a),d.push(g)):c.push(g),b.cellValueListSelector.push(g)}),d.concat(c)},c.prototype.applySorting=function(b){var c=this;if(b.length){var d=this.getCompareValue(b[0]);"number"==typeof d?b.sort(function(b,d){return a.ValueComparer.numberCompareAbsolute(c.getCompareValue(b),c.getCompareValue(d))}):d instanceof Date?b.sort(function(b,d){return a.ValueComparer.dateCompare(c.getCompareValue(b),c.getCompareValue(d),!1)}):b.sort(function(b,d){return a.ValueComparer.naturalStringCompare(c.getCompareValue(b),c.getCompareValue(d),!1)})}return b},c.prototype.getCompareValue=function(a){var b=a.rawValue;return a.getFormatted&&(b=a.getFormatted()),b},c}();angular.module("ionwebGrids").directive("filterPanelEditor",[function(){return{link:function(a){return new e(a)},scope:{conditionFilter:"=?ngModel",cellValues:"=?",close:"&?",applyAndClose:"&?",clearAndClose:"&?",filterConfiguration:"=?",disableSorting:"=?"},templateUrl:"grids.ui/rules/filterpanel/filterPanel.tpl.html"}}])}(b=a.rules||(a.rules={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(b){function c(b){var c={};if(b instanceof a.AndCondition)for(var e,f=0,g=b.conditions.length;f<g;f++)e=b.conditions[f],e instanceof a.InCondition?c.selectedColumnValues=e.values:c.condition=d(e);else b instanceof a.InCondition?c.selectedColumnValues=b.values:c.condition=d(b);return c}function d(b){function c(b){switch(b){case a.CompareOperator.Equality:return a.OperatorType.Equal;case a.CompareOperator.Inequality:return a.OperatorType.NotEqual;case a.CompareOperator.Greater:return a.OperatorType.GreaterThan;case a.CompareOperator.GreaterOrEqual:return a.OperatorType.GreaterThanOrEqual;case a.CompareOperator.Less:return a.OperatorType.LessThan;case a.CompareOperator.LessOrEqual:return a.OperatorType.LessThanOrEqual}}var d,e,f,g,h;return g=b.conditionDataType(),b instanceof a.NumericRangeCondition?(f=a.OperatorType.Range,e=[b.min,b.max],h=b.absolute):b instanceof a.StringContainsCondition?(f=a.OperatorType.Contains,e=[b.value]):(f=c(b.op),e=[b.value],b instanceof a.NumericCompareCondition&&(h=b.absolute)),d={values:e,operator:f,dataType:g,isAbsolute:h}}b.createFilterForApplication=c}(b=a.filterConditionMapper||(a.filterConditionMapper={}))}(b=a.rules||(a.rules={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){c.DEFAULT_COLUMN_WIDTH_NUMBER=90,c.DEFAULT_COLUMN_WIDTH=""+c.DEFAULT_COLUMN_WIDTH_NUMBER+"px";var d;!function(a){a[a.None=0]="None",a[a.Group=1]="Group",a[a.Tree=2]="Tree"}(d=c.HierarchicalType||(c.HierarchicalType={}));var e=function(){function e(c,d,e,f,g,h,i,j,k,l,m,n,o){var p=this;this.dm=c,this.selectionManager=d,this.sortingManager=e,this.dndManager=f,this.gridScope=g,this.directive=h,this.gridLogger=i,this.loadingPanel=j,this.component=k,this.headerPanelManager=l,this.fitContentManager=m,this.unsub=[],this.eventProcessingSuspended=!1,this.options=this.gridScope.options,this.logger=i,this.defaultTextStyle=new b.PresentationStyle,this.columnAxis=c.getColumnAxis();var q=b.getInstanceId();this.gridLogId=this.options&&this.options.logId?(this.options&&this.options.logId)+"_"+q:q,this.gridStatsAdapter=new a.GridStatsAdapter(this.gridLogId,c),this.statService=a.getService("ionweb.statService"),this.unsub.push(this.statService.registerStatProvider(this.gridStatsAdapter.statsProvider));var r=c.getAs(b.RecordDataModel);r&&this.unsub.push(this.statService.registerStatProvider(r.statsProvider)),this.columnBuilder=new b.ColumnBuilder(this.columnAxis,this.options),this.headerGroups=this.columnBuilder.prepareRootGroup(),this.addLevelInfoToAllNodes(this.headerGroups),this.structure=this.prepareColumns(),this.storeAdapter=new b.DataModelDojoStoreAdapter(c,n),this.store=o(this.storeAdapter),this.storeAdapter.observable=this.store,this.unsub.push(this.storeAdapter.onGridStatChange.add(this.gridStatsAdapter.logGridStat.bind(this.gridStatsAdapter))),this._debouncedRefreshColumns=a.debounce(function(){p._disposed||p.refreshColumns()},10,!1),this.unsub.push(c.getColumnAxis().options.slicesEvent.add(function(a,b){if(p.gridx._gridStarted&&!p._disposed&&!p.eventProcessingSuspended&&b.length>0){var d=p.gridScope.frozenColumnCountUserSetting>p.gridx.columnLockService.getLockedColumns().length&&p.gridScope.frozenColumnCountUserSetting<=c.getColumnAxis().length()?p.gridScope.frozenColumnCountUserSetting:0,e=function(){p.gridx.columnLockService.lock(d)},f=d>0?e:null;p._debouncedRefreshColumns(f)}})),this.unsub.push(this.columnAxis.nodeStateUpdated.add(function(){p.gridx._gridStarted&&!p.eventProcessingSuspended&&p._debouncedRefreshColumns()})),this.onRowScroll=new a.Event,this.waitForVisibleRowRangeAndNotify(),this.onGridSizeChanged=new a.Event,this.options.isDashboardInEditMode=function(){return p.inEditMode()},this.currentContainer=this.getContainerComponent()}return e.prototype.showHeaderPanelForColumn=function(a,b,c,d){this.headerPanelManager.show(a,b,c,d)},e.prototype.setGridx=function(a){this.gridx=a,this.storeAdapter.gridx=a},e.prototype.isCellUpdateLocked=function(a,b){return this.editingDriver&&this.editingDriver.isLocked(a,b)},e.prototype.processCellClick=function(a,b){return!!this.editingDriver&&this.editingDriver.processCellClick(a,b)},e.prototype.startEdit=function(a,c){this.editingDriver&&this.editingDriver.startEdit(a,c,b.EditStartReason.Api)},e.prototype.paste=function(){this.editingDriver&&this.editingDriver.paste()},e.prototype.cancelEdit=function(){this.editingDriver&&this.editingDriver.cancelEdit(b.EditCompleteReason.Api)},e.prototype.commitCell=function(a,b){return this.editingDriver?this.editingDriver.commitCell(a,b):Q.when(null)},e.prototype.commitCells=function(a){return this.editingDriver?this.editingDriver.commitCells(a):Q.when(null)},e.prototype.clearEditErrors=function(){this.editingDriver&&this.editingDriver.clearEditErrors()},e.prototype.supportInlineEditing=function(){return!!this.editingDriver},e.prototype.getEditedCellsByStatus=function(a){return this.editingDriver?this.editingDriver.getEditedCellsByStatus(a):null},e.prototype.getEditedCellStatus=function(a,c){return this.editingDriver?this.editingDriver.getEditedCellStatus(a,c):b.EditCellStatus.None},e.prototype.processEditedValue=function(a,b,c){this.editingDriver&&this.editingDriver.processEnteredValue(a,b,c)},e.prototype.freezeColumns=function(a){"number"==typeof a&&a>=0?this.gridx.columnLockService.lock(a):this.gridx.columnLockService.unlock()},e.prototype.unfreezeColumns=function(){this.gridx.columnLockService.unlock()},e.prototype.getFrozenColumnKeys=function(){return this.gridx.columnLockService.getLockedColumns()},e.prototype.refreshColumns=function(){var a=this.gridx.hScroller.getScrollPosition();this.gridx.header.groups=this.columnBuilder.prepareRootGroup(),this.addLevelInfoToAllNodes(this.gridx.header.groups),this.gridx.setColumns(this.prepareColumns()),this.gridx.columnResizer.refreshWidths(),this.gridx.hScroller.scroll(a)},e.prototype.getCellValueFromRow=function(a,c){var d=a.__dojo__store__id,e=a[c],f=b.getCellPresentation(e),g=f.getStyle&&f.getStyle(this.defaultTextStyle)||this.defaultTextStyle,h=[];if(this.editingDriver){var i=this.editingDriver.getVisibleCellStatus(d,c);switch(i){case b.EditCellStatus.ReadyToCommit:h.push("edit-cell-ready-to-commit");break;case b.EditCellStatus.EditInProgress:h.push("edit-cell-edit-in-progress");break;case b.EditCellStatus.EditOnSelection:h.push("edit-cell-edit-on-selection");var j=this.editingDriver.getClassesForEditOnSelectionCell();j.forEach(function(a){return h.push(a)});break;case b.EditCellStatus.OnTheWire:h.push("edit-cell-on-the-wire");break;case b.EditCellStatus.Error:h.push("edit-cell-error");break;case b.EditCellStatus.None:}}var k=!1,l=this.editingDriver&&this.editingDriver.getCellContent(d,c);if(l)k=!0;else{if(l=f.getFormatted(b.PresentationContext.Rendering),l&&"string"!=typeof l)throw Error("The getFormatted method is returning a value type different than string");l&&l.trim()||h.push("ion-empty-cell")}h.forEach(function(a){var c=new b.PresentationStyle([a]);g=g.mixin(c)});var m=!this.options.disableHtmlEscape;if(m)if(k)m=!1;else if(b.DataModelDojoStoreAdapter.isLoadingRow(a))m=!1;else{var n=this.dm.getAs(b.ResponsiveDataModel);if(n){var o=n.getConfiguration();if(o&&o.groups){var p=o.groups[c];p&&(m=!1)}}}return{formattedValue:l,style:g,escapeHtml:m}},e.prototype.addLevelInfoToAllNodes=function(a){function c(a,b){for(var d=[],e=0;e<a.length;e++){var g=void 0;if("number"!=typeof a[e].children){var h=a[e].children.slice();d=d.concat(h)}else 0===a[e].state&&(g="leaf");var i=a[e].id||a[e].name,j=a[e+1]&&(a[e+1].id||a[e+1].name);i!==j&&""!==j&&(a[e].borderNode=!0),b===-1&&(g="summary"),a[e].levelInfo=0!==b&&g||b,f[a[e].id||a[e].name]=0!==b&&g||b}0!==a.length&&c(d,++b)}var e=this.getColumnLayoutHierarchyType();if(e&&0!==a.length){var f={};if(e===d.Group){var g=a.slice();return c(g,0),g}var h=this.columnAxis.getAs(b.PivotAxis);if(h){var g=a.slice(),i=0;if(this.options.compactColumnMode===!1&&(i=-1),h.isLevelSummaryVisible(0)){var j=g[0];g=g.slice(1),j.levelInfo="summary",j.borderNode=0===g.length&&!0||this.options.compactColumnMode,f[j.id]="summary"}c(g,i),this._levelHeaderMap=f}}},e.prototype.getColumnLayoutHierarchyType=function(){var a=d.Tree,c=this.dm.getColumnAxis();return c.getAs(b.FlatAxis)||c.getAs(b.ConcatAxis)?a=d.None:(!this.headerGroups.length||1===this.headerGroups.length&&"number"==typeof this.headerGroups[0])&&(a=d.None),a},e.prototype.isRowLayoutHierarchical=function(){return!this.dm.getRowAxis().getAs(b.FlatAxis)},e.escapeValue=function(a){return null==a&&(a=""),new String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},e.prototype.prepareColumns=function(){function f(){var a=l.dm.getAs(b.SliceManagerDataModel),c=[];a&&a.groups&&(c=Object.keys(a.groups));for(var d={},e=0;e<c.length;e++)for(var f=a.groups[c[e]],g=0;g<f.length;g++)d[f[g]]=c[e];return d}function g(a,b){var c=!1,d=h&&Object.keys(h).length,e=d?h[b]:b.substring(0,b.lastIndexOf("|")),f=j[a+1];if(f){var g=f.key(),i=d?h[g]:g.substring(0,g.lastIndexOf("|"));i!==e&&(c=!0)}else c=!0;return c}var h,i=this,j=this.dm.getColumnAxis().getSliceRange(0,this.dm.getColumnAxis().length()),k=this.getColumnLayoutHierarchyType(),l=this,m=function(a){if(!a)return"<div></div>";var b="undefined"==typeof a.formattedValue?"":a.formattedValue,c=a.escapeHtml?e.escapeValue(b):b,d=i.dndManager.isCellDnDEnabled()?'draggable="true"':"",f=a.style.getClasses(),g=f&&f.length?'class="'+f.join(" ")+'"':"",h=a.style.getStyle(),j=Object.keys(h).map(function(a){return a+": "+h[a]}),k=j.length?'style = "'+j.join("; ")+'"':"";return"<div "+d+" "+k+" "+g+">"+c+"</div>"};h=f();for(var n,o=[],p=function(b){var e=j[b].key(),f=g(b,e);n=function(a){return function(b){return i.getCellValueFromRow(b,a)}};var h=q.options.defaultColumnsWidths&&q.options.defaultColumnsWidths[e]||c.DEFAULT_COLUMN_WIDTH,l={id:e,levelInfo:k===d.Group?0:q._levelHeaderMap&&q._levelHeaderMap[e.substr(0,e.lastIndexOf("|"))],name:j[b].displayName(),field:e,alias:j[b].alias,description:j[b].description,category:j[b].category,tooltip:j[b].tooltip,width:q.options._autoSize?void 0:h,decorator:m,formatter:n(e),borderNode:f},p=q.options.cellWidgets&&q.options.cellWidgets[e];p&&(l.widgetsInCell=!0,l.allowEventBubble=!0,l.onCellWidgetCreated=function(a,b){var c={rowKey:null,columnKey:e},d=p.onCreate(e,c);if(!d)throw Error("Must return a valid HTMLElement");a.domNode.appendChild(d),a._cachedData={widget:d,instance:c}},l.onCellWidgetDestroyed=function(b,c){var d=b._cachedData.widget;p.onDestroy&&p.onDestroy(d,e,b._cachedData.instance),a.dom.clearNode(b.domNode)},l.setCellValue=function(a,b,c,d){if(b){var e=c.cell.row.id,f=c.cell.column.id,g=a.style.getClasses();g&&g.length>0&&$(c.domNode).addClass(g.join(" ")),$(c.domNode).css(a.style.getStyle()),p.onUpdate(c._cachedData.widget,e,f,b,c._cachedData.instance)}},l.initializeCellWidget=function(a,b){var c=b.row.id,d=b.column.id;if(a.started){if(a._cachedData.instance.columnKey===d&&a._cachedData.instance.rowKey===c)return;p.onClear&&p.onClear(a._cachedData.widget,c,d,a._cachedData.instance)}a._cachedData.instance.rowKey=c,a._cachedData.instance.columnKey=d,p.onInitialize&&p.onInitialize(a._cachedData.widget,c,d,a._cachedData.instance)},l.needCellWidget=function(a){return!p.isNeededInCell||p.isNeededInCell(a.row.id,a.column.id)}),o.push(l)},q=this,r=0;r<j.length;r++)p(r);return o},e.prototype.onGridResize=function(){this.onScroll(),this.onGridSizeChanged.raise(this,null)},e.prototype.notifyGridSizeChanged=function(){this.gridx&&this.gridx.resize()},e.prototype.onScroll=function(){this.setRowWindow(),this.onRowScroll.raise(this,null)},e.prototype.setRowWindow=function(){var a=this,c=this.dm.getAs(b.VirtualDataModel),d=300;if(c){var e=function(){var b=a.getVisibileRowRange();if(b){var f=b.lastRow-b.firstRow+1;c.setRowWindow(b.firstRow,f),a._setRowWindowTimeout=null}else setTimeout(function(){return e()},d)};this._setRowWindowTimeout&&clearTimeout(this._setRowWindowTimeout),this._setRowWindowTimeout=setTimeout(function(){return e()},d)}},e.prototype.waitForVisibleRowRangeAndNotify=function(){var a=this;if(!this._disposed){var b=this.getVisibileRowRange();b&&null!==b.firstRow&&null!==b.lastRow?this.setRowWindow():setTimeout(function(){a.waitForVisibleRowRangeAndNotify()},200)}},e.prototype.getVisibileRowRange=function(){var a=this.gridx&&this.gridx.bodyNode;if(!a||!a.children.length)return null;for(var c=a.getBoundingClientRect().top,d=null,e=0;e<a.children.length;e++){var f=a.children[e],g=f.getBoundingClientRect().top;if(g>=c){d=parseInt(f.getAttribute("visualIndex"));break}}if(null===d)return null;var h=b.safeGetClientHeight(a.firstChild),i=b.safeGetClientHeight(a),j=i/h,k=Math.floor(j+d)-1;return{firstRow:d,lastRow:k}},e.prototype.scrollToRow=function(a,c){if(c===b.ScrollAlignment.Center){var d=this.gridx.bodyNode;if(d&&d.firstChild){var e=b.safeGetClientHeight(d),f=b.safeGetClientHeight(d.firstChild),g=e/f;this.gridx.vScroller.scrollToRow(a-Math.floor(g/2),!0)}}else this.gridx.vScroller.scrollToRow(a)},e.prototype.scrollUp=function(){this.scroll(-1)},e.prototype.scrollDown=function(){this.scroll(1)},e.prototype.scroll=function(a){var c=this.gridx.bodyNode;if(c&&c.firstChild){var d=(b.safeGetClientHeight(c),b.safeGetClientHeight(c.firstChild)),e=this.getRowScrollPosition();this.setRowScrollPosition({pixelOffset:e.pixelOffset+a*d})}},e.prototype.isCellSelected=function(a,b){return this.selectionManager.isCellSelected(a,b)},e.prototype.setColumnWidth=function(a,b){this.gridx.columnResizer.setWidth(a,b)},e.prototype.setRowHeaderWidth=function(a){this.gridx.rowHeader.setWidth(a)},e.prototype.getRowScrollPosition=function(){var a=this;if(!this.gridx.bodyNode||!this.gridx.bodyNode.firstChild)return{percentOffset:0,pixelOffset:0};var c=this.gridx.vScroller.position();return{pixelOffset:c,percentOffset:c/function(){var c=a.dm.getRowAxis().length(),d=b.safeGetClientHeight(a.gridx.bodyNode.firstChild);return d*c}()}},e.prototype.getColumnScrollPosition=function(){var a=this;if(!this.gridx.bodyNode||!this.gridx.bodyNode.firstChild)return{percentOffset:0,pixelOffset:0};var b=this.gridx.hScroller.getScrollPosition(),c=function(){return a.gridx.bodyNode.firstChild.clientWidth}();return{pixelOffset:b,percentOffset:b/c}},e.prototype.setRowScrollPosition=function(a){var c=this;if(this.gridx.bodyNode&&this.gridx.bodyNode.firstChild){var d=a.pixelOffset,e=a.percentOffset;"undefined"!=typeof d?this.gridx.vScroller.scroll(d):"undefined"!=typeof e&&this.gridx.vScroller.scroll(e*function(){var a=c.dm.getRowAxis().length(),d=b.safeGetClientHeight(c.gridx.bodyNode.firstChild);return d*a}())}},e.prototype.setColumnScrollPosition=function(a){var b=this;if(this.gridx.bodyNode&&this.gridx.bodyNode.firstChild){var c=a.pixelOffset,d=a.percentOffset;"undefined"!=typeof c?this.gridx.hScroller.scroll(a.pixelOffset):"undefined"!=typeof d&&this.gridx.hScroller.scroll(d*function(){return b.gridx.bodyNode.firstChild.clientWidth}())}},Object.defineProperty(e.prototype,"state",{get:function(){return this.settingsManager.getState(this.gridx)},set:function(a){this.settingsManager.setState(this.gridx,a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gridSelection",{get:function(){return this.selectionManager.getGridSelection()},set:function(a){this.selectionManager.setGridSelection(a)},enumerable:!0,configurable:!0}),e.prototype.getSortType=function(a){return this.sortingManager.getSortType(a)},e.prototype.getSortHeaderType=function(a){return this.sortingManager.getSortHeaderType(a)},e.prototype.setSortType=function(a,b){this.sortingManager.setSortType(a,b)},e.prototype.setSortHeaderType=function(a,b){this.sortingManager.setSortHeaderType(a,b)},e.prototype.headerOnExpandClick=function(a){this.eventProcessingSuspended=!0;var c=this.columnAxis.options.getExpandState(a);c===b.ExpandState.Collapsed&&this.columnAxis.options.requestExpandState(a,!0),c===b.ExpandState.Expanded&&this.columnAxis.options.requestExpandState(a,!1),this.eventProcessingSuspended=!1,this._debouncedRefreshColumns()},e.prototype.sameOrigin=function(a){return this.dndManager.sameOrigin(a)},e.prototype.getHTMLElement=function(a,b){var c=$("[rowid="+a+"] [colid="+b+"] > div",this.gridx.domNode);return c&&1===c.length?c[0]:null},e.prototype.performOperationWhenDMReady=function(a,c){var d=this,e=this.dm.getAs(b.ScrollerDataModel);if(e){var f=function(a){return c+"  "+Math.round(a)+"%"};this.loadingPanel.setText(b.Strings.Grid_Exporting_Progress),this.loadingPanel.show(),e.onFetchOperationUpdated.add(function(a,b){d.loadingPanel.setText(f(b))}),e.startFetchAllOperation().then(function(){a(),e.closeFetchAllOperation(),d.loadingPanel.hide()})}else a()},e.prototype.getDataModel=function(){return this.dm},e.prototype.exportToFileCsv=function(b){var c=this;this.exportToCsv(b).then(function(d){c.logger.logExportToCsv(b);var e=a.getService("ionweb.fileExportService");e.exportFile(d,"text/csv","exportedData.csv")})},e.prototype.exportToCsv=function(a){var c=this,d=Q.defer();return this.performOperationWhenDMReady(function(){var e=new b.DataExporter(c.dm,{columnSeparator:b.ColumnSeparatorChar.Comma,excludeColumnHeader:!c.options.showColumnHeaders,excludeRowHeader:!c.options.showRowHeaders},c.options.enableOutlineMode?c.options.outlineModeConfiguration:void 0);d.resolve(e.exportToText(a))},b.Strings.Grid_Exporting_Progress),d.promise},e.prototype.exportToCSV=function(a){var c;if(a){if(c=this.selectionManager.getGridSelection(),a&&c.type===b.GridRangeType.None)throw new Error(b.Strings.Err_GridObject_NoSelection_Available)}else c=this.selectionManager.getAllSelection();this.exportToFileCsv(c)},e.prototype.setColumnIconOptions=function(a,b){this.options&&this.options.headerPanels&&this.options.headerPanels[a]&&(this.options.headerPanels[a].icon=b)},e.prototype.getColumnIconOptions=function(a){if(this.options&&this.options.headerPanels&&this.options.headerPanels[a])return"string"==typeof this.options.headerPanels[a].icon?{iconName:this.options.headerPanels[a].icon}:this.options.headerPanels[a].icon},e.prototype.dispose=function(){this._disposed=!0,this.storeAdapter.dispose(),this.unsub.forEach(function(a){return a()})},e.prototype.getContainerComponent=function(){for(var a=this.component;a&&(!a.parent||!a.parent.isContainer);)a=a.parent;return a},e.prototype.inEditMode=function(){return this.options.editMode===b.GridEditOptionsMode.Enabled||this.options.editMode!==b.GridEditOptionsMode.Disabled&&(this.component&&this.component.editMode)},e.prototype.fitColumns=function(a,b){b&&b.length>0?this.fitContentManager.fitColumns(b,a):this.fitContentManager.fitAllColumns(a)},e.prototype.getResponsiveGroupDefinition=function(a){var c=null,d=this.dm&&this.dm.getAs(b.ResponsiveDataModel);if(d){var e=d.getConfiguration();e&&(c=e.groups[a]||null)}return c},e}();c.GridObject=e}(c=b.grid||(b.grid={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){function c(b,c,d){function e(b,c,d){var e=d.filter(function(a){return a.name===b});if(e.length>0)return e[0];var f={name:b,date:c,visibility:a.toolkit.TagVisibility.Dropdown};return d.push(f),f}if(c instanceof Date)return c;if(b&&b.parseDate){var f=b.parseDate(c);if(f)return e(c,f,d)}}var d;!function(a){a[a.StringUnary=0]="StringUnary",a[a.NumericUnary=1]="NumericUnary",a[a.DateUnary=2]="DateUnary",a[a.NumericBinary=3]="NumericBinary",a[a.DateBinary=4]="DateBinary"}(d||(d={})),b.parseLiteralDate=c;var e=function(){function e(a){var e=this;this.onParseDate=function(a){return c(e.condition&&e.condition.context,a,e.dateTags)},this.onDateChanged=function(a){return e._onDateChanged(a)},this.onMinDateChanged=function(a){return e._onMinDateChanged(a)},this.onMaxDateChanged=function(a){return e._onMaxDateChanged(a)},a.$watch("ctrl.condition",function(){e.condition instanceof b.StringCompareCondition?e.mode=d[d.StringUnary]:e.condition instanceof b.StringContainsCondition?e.mode=d[d.StringUnary]:e.condition instanceof b.NumericCompareCondition?e.mode=d[d.NumericUnary]:e.condition instanceof b.DateCompareCondition?(e.mode=d[d.DateUnary],e.date=e.fromLiteral(e.condition.value)):e.condition instanceof b.NumericRangeCondition?e.mode=d[d.NumericBinary]:e.condition instanceof b.DateRangeCondition&&(e.mode=d[d.DateBinary],e.minDate=e.fromLiteral(e.condition.min),e.maxDate=e.fromLiteral(e.condition.max))})}return e.prototype.fromLiteral=function(a){return this.dateTags=this.dateTags||[],c(this.condition&&this.condition.context,a,this.dateTags)},e.prototype.toLiteral=function(a){return a&&(a instanceof Date?a:a.name)},e.prototype._onDateChanged=function(a){this.condition instanceof b.DateCompareCondition&&(this.condition.value=this.toLiteral(a)),this.onValChanged()},e.prototype._onMinDateChanged=function(a){this.condition instanceof b.DateRangeCondition&&(this.condition.min=this.toLiteral(a)),this.onValChanged()},e.prototype._onMaxDateChanged=function(a){this.condition instanceof b.DateRangeCondition&&(this.condition.max=this.toLiteral(a)),this.onValChanged()},e.prototype.onValChanged=function(){this.validationMessage=this.condition&&this.condition.validate(),this.validationState=this.validationMessage?a.validation.ValidationState.Error:a.validation.ValidationState.Valid},e.$inject=["$scope"],e}();angular.module("ionwebGrids").directive("ionwebConditionEditor",[function(){return{scope:{condition:"=",dateTags:"=?"},controllerAs:"ctrl",templateUrl:"grids.ui/rules/condFormat/conditionEditor.tpl.html",controller:e,bindToController:!0}}])}(b=a.rules||(a.rules={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(b){this.rules=[],this._changed=new a.Event,b&&this.setState(b)}return Object.defineProperty(c.prototype,"context",{get:function(){return this._context},set:function(a){var b=this;this._context=a,this.rules.forEach(function(a){return a.condition.context=b.context})},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"changed",{get:function(){return this._changed},enumerable:!0,configurable:!0}),c.prototype.raiseChanged=function(){this._changed.raise(this,this)},c.prototype.evaluate=function(a){if(this.rules)for(var b=0;b<this.rules.length;b++){var c=this.rules[b];if(c.condition.evaluate(a))return c.style}return null},c.prototype.getState=function(){return this.rules.map(function(a){return{condition:a.condition,style:a.style}})},c.prototype.setState=function(a){var c=this;this.rules=a.map(function(a){var d=new b.Rule(b.deserializeCondition(a.condition),b.PresentationStyle.deserialize(a.style));return d.condition.context=c.context,d})},c}();b.RuleSet=c;var d=function(){function b(a,b,c){var d=this;this.scope=a,this.element=b,this.popupService=c,a.close=function(){d._ionPopup&&(d._ionPopup.hide(),d._ionPopup.destroy())},a.$watch("isOpen",function(){d.showHidePopup(d.scope.isOpen)})}return b.prototype.showHidePopup=function(a){a?(this.setupPopup(),this._ionPopup.show()):this._ionPopup&&(this._ionPopup.hide(),this._ionPopup.destroy())},b.prototype.setupPopup=function(){var b=this;this._ionPopup=this.popupService.createWithTemplate('<conditional-formatting ng-model="ruleSet" close="close"></conditional-formatting>',this.element,this.scope,{automaticallyClose:!1,anchorPoint:a.toolkit.PopupAnchorPoint.BottomLeft}),this._ionPopup.onClose.add(function(){b.scope.$evalAsync(function(){b.scope.isOpen=!1})})},b}();angular.module("ionwebGrids").directive("conditionalFormatting",["ionweb.themeManager","ionweb.environmentService",function(a,c){return{scope:{ruleSet:"=?ngModel",close:"=?"},link:function(d){new b.RulesEditor(d,a,c)},templateUrl:"grids.ui/rules/condFormat/view.tpl.html"}}]),angular.module("ionwebGrids").directive("conditionalFormattingPopup",["ionweb.popupService",function(a){return{scope:{ruleSet:"=?ngModel",isOpen:"=?"},link:function(b,c){new d(b,c,a)}}}])}(b=a.rules||(a.rules={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(c){var d=function(a){function d(b,c,d){var e=a.call(this,b,c)||this;return e.style=c,b.context=d,e}return __extends(d,a),d.prototype.onConditionSet=function(){this.conditionStr=this.condition&&this.condition.toString()||null,this.preview=this.toPreview()},d.prototype.toPreview=function(){return this.condition instanceof c.StringCompareCondition||this.condition instanceof c.StringContainsCondition?"ABC":this.condition instanceof c.NumericCompareCondition||this.condition instanceof c.NumericRangeCondition?"123":this.condition instanceof c.DateCompareCondition||this.condition instanceof c.DateRangeCondition?"Jan":""},d.prototype.clone=function(){return new d(b.cloneCondition(this.condition),c.PresentationStyle.clone(this.style),this.condition.context)},d}(c.Rule);c.RuleScope=d;var e=function(){function e(e,f,g){var h=this;this.scope=e,this.themeService=f,this.environmentService=g,e.ruleSet&&(this.scope.ruleContext=e.ruleSet.context,this.allRules=e.ruleSet.rules.map(function(a){return new d(a.condition,a.style,e.ruleSet.context)}),this.scope.rules=this.allRules,this.onRulesFetched()),this.scope.touchable=this.environmentService&&this.environmentService.isTouchDevice(),
this.defaultStyle=new c.PresentationStyle,this.defaultStyle.backgroundColor="#fff",this.defaultStyle.color="#000";var i="green",j="orange",k="red";if(f){var l=f.rawThemeVariables;this.defaultStyle.backgroundColor=l["@ion-text-bg"],this.defaultStyle.color=l["@ion-text-fg"],i=l["@ion-branding-bright-green"],j=l["@ion-branding-bright-orange"],k=l["@ion-branding-bright-red"]}this.scope.defaultStyles=[{backgroundColor:i,color:this.defaultStyle.backgroundColor},{backgroundColor:j,color:this.defaultStyle.backgroundColor},{backgroundColor:k,color:this.defaultStyle.backgroundColor},{backgroundColor:this.defaultStyle.backgroundColor,color:i},{backgroundColor:this.defaultStyle.backgroundColor,color:j},{backgroundColor:this.defaultStyle.backgroundColor,color:k}],this.scope.conditionTypes=c.Utilities.allConditionTypeToOptions(),null===b.conditionTypes[0]&&this.scope.conditionTypes.shift(),e.cancelEditing=function(){e.editingRule=null},this.scope.invalid=function(){return!h.scope.editingRule||!h.scope.editingRule.condition||h.scope.editingRule.condition.validate()},this.scope.options={typeIndex:"0",columnClicked:function(a){h.scope.$evalAsync(function(){a.checked=!a.checked})}},this.scope.$watch("options.typeIndex",function(a,b){a!==b&&h.scope.editingRule&&a!==h.editingTypeIdx&&(c.conditionTypes[a]&&(h.scope.editingRule.condition=c.Utilities.newFromTemplate(c.conditionTypes[a]),h.scope.editingRule.condition.context=h.scope.ruleContext),h.editingTypeIdx=null)}),this.scope.$watch("editingRule",function(a,c){if(a!=c){var d=0;h.scope.editingRule&&(d=b.Utilities.findTypeIndex(h.scope.editingRule.condition)),h.scope.options.typeIndex=h.editingTypeIdx=d.toString()}}),this.scope.newRule=function(){h.scope.editingRule=h.ruleScope({condition:b.Utilities.newFromTemplate(b.Utilities.getFirstValidCondition()),style:h.defaultStyle})},e.ruleContextMenu=function(a){return[{text:c.Strings.Rule_Menu_Delete_Rule,icon:"delete",action:function(){return e.deleteRule(a)}},{text:c.Strings.Rule_Menu_Move_Rule_UP,icon:"arrowUp",disabled:0===a,action:function(){h.swapRules(a,a-1)}},{text:c.Strings.Rule_Menu_Move_Rule_Down,icon:"arrowDown",disabled:a>=e.rules.length-1,action:function(){h.swapRules(a,a+1)}}]},e.invalid=function(){return!e.editingRule||!e.editingRule.condition||e.editingRule.condition.validate()},e.dragStart=function(b,c){var d=document.createElement("div");d.textContent=h.scope.rules[b].preview,d.classList.add("conditional-formatting-cell-preview"),d.style.color=e.rules[b].style.color,d.style.backgroundColor=e.rules[b].style.backgroundColor,c.setDragPlaceholder(d,25,25),c.setData("Text",{filterIndex:b}),c.setEffectAllowed(a.DnDEffectAllowed.All),e.draggingIndex=b},e.dragEnd=function(a,b){e.draggingIndex=-1,e.droppingIndex=-1},e.drop=function(a,b){if(b.getData("Text")){var c=b.getData("Text");a!==c.filterIndex&&h.moveRules(c.filterIndex,a)}e.draggingIndex=-1,e.droppingIndex=-1},e.dragEnter=function(a,b){if(b.getData("Text")){var c=b.getData("Text");return a!==c.filterIndex}return!1},e.dragOver=function(b,c){if(c.getData("Text")){var d=c.getData("Text");d.filterIndex<b?e.droppingIndex=b+1:d.filterIndex>b?e.droppingIndex=b:e.droppingIndex=-1}return a.DnDDropEffect.Move},this.scope.ruleClick=function(a){h.inEdit=!0,h.inEditIndex=h.allRules.indexOf(h.scope.rules[a]),h.scope.editingRule=h.ruleScope(h.scope.rules[a])},this.scope.defaultStyleClicked=function(a){h.scope.editingRule.style.color=h.scope.defaultStyles[a].color,h.scope.editingRule.style.backgroundColor=h.scope.defaultStyles[a].backgroundColor},this.scope.saveRule=function(){h.scope.editingRule=h.scope.editingRule.clone(),h.inEdit?h.allRules[h.inEditIndex]=h.scope.editingRule:h.allRules.push(h.scope.editingRule),h.commit()},this.scope.deleteRule=function(a){var b=h.scope.rules.splice(a,1);if(1===b.length){var c=h.allRules.indexOf(b[0]);c>=0&&h.allRules.splice(c,1),h.commit()}}}return e.prototype.commit=function(){this.inEdit=!1,this.scope.editingRule=null,this.scope.ruleSet&&(this.scope.ruleSet.rules=this.scope.rules,this.scope.ruleSet.raiseChanged())},e.prototype.toPreview=function(a){return a instanceof c.StringCompareCondition?"ABC":a instanceof c.NumericCompareCondition||a instanceof c.NumericRangeCondition?"123":a instanceof c.DateCompareCondition||a instanceof c.DateRangeCondition?"Jan":""},e.prototype.moveRules=function(a,b){var c=this.allRules.indexOf(this.scope.rules[a]),d=this.allRules.indexOf(this.scope.rules[b]),e=this.scope.rules,f=e[a];a>b?(e.splice(a,1),e.splice(b,0,f),this.allRules!==e&&(this.allRules.splice(c,1),this.allRules.splice(d,0,f))):a<b&&(e.splice(b+1,0,f),e.splice(a,1),this.allRules!==e&&(this.allRules.splice(d+1,0,f),this.allRules.splice(c,1))),this.commit()},e.prototype.swapRules=function(a,b){var c=this.allRules.indexOf(this.scope.rules[a]),d=this.allRules.indexOf(this.scope.rules[b]),e=this.scope.rules,f=e[b];if(e[b]=e[a],e[a]=f,this.allRules!==e&&c>=0&&d>=0){var g=this.allRules[d];this.allRules[d]=this.allRules[c],this.allRules[c]=g}this.commit()},e.prototype.ruleScope=function(a){return new d(b.cloneCondition(a.condition),c.PresentationStyle.clone(a.style),this.scope.ruleSet&&this.scope.ruleContext)},e.prototype.onRulesFetched=function(){var a=this;this.scope.allDateTags=[],this.scope.ruleContext&&this.scope.rules.forEach(function(d){d.condition instanceof b.DateCompareCondition?c.parseLiteralDate(a.scope.ruleContext,d.condition.value,a.scope.allDateTags):d.condition instanceof b.DateRangeCondition&&(c.parseLiteralDate(a.scope.ruleContext,d.condition.min,a.scope.allDateTags),c.parseLiteralDate(a.scope.ruleContext,d.condition.max,a.scope.allDateTags))})},e}();c.RulesEditor=e}(b=a.rules||(a.rules={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(a,b,d,e,f,g){var h=c.call(this,f,g,b.ruleContext)||this;return h.dm=a,h.pdma=b,h.columnsAreMeasures=e,h.style=g,h.selection=d,h}return __extends(d,c),Object.defineProperty(d.prototype,"selection",{get:function(){return this._selection},set:function(a){this._selection=b.ResponsiveDataModel.explodeSelection(this.dm,a).explodedSelection,this.selectionStr=this.toSelectionStr(this.selection)},enumerable:!0,configurable:!0}),d.prototype.toSelectionStr=function(a){return b.SelectionHelper.toString(this.pdma,a,{columnsAreMeasures:this.columnsAreMeasures,maxCount:4})},d.prototype.clone=function(){return new d(this.dm,this.pdma,a.extend({},[this.selection]),this.columnsAreMeasures,a.rules.cloneCondition(this.condition),b.PresentationStyle.clone(this.style))},d}(a.rules.RuleScope);c.GridRuleScope=d;var e=function(c){function e(d,e,f,g,h,i){var j=c.call(this,f,h,i)||this;return j.dm=d,j.selection=e,j.scope=f,j.columnsAreMeasures=g,j.pdma=d.getAs(b.PresentationDataModelAdapter),f.gridSpecific=!0,f.selectionPopupTitle=g?b.Strings.Grid_ColumnSelector_Select_Measure:b.Strings.Grid_ColumnSelector_Select_Column,f.close=function(){return j.close&&j.close()},f.options={typeIndex:"0",selPopupOpen:!1,columnClicked:function(a){f.$evalAsync(function(){a.checked=!a.checked,f.editingRule.selection=j.toSelection(f.selectedColumns)})}},f.$watch("editingRule",function(a,b){a!==b&&f.editingRule&&(f.options.selPopupOpen=!1)}),f.$watch("options.selPopupOpen",function(a,b){a!=b&&a&&(f.selectedColumns=j.getColumns(f.editingRule.selection),f.categories=j.getColumnsCategories())}),j.fetchRules(),f.newRule=function(){f.editingRule=j.ruleScope({selection:e,style:j.defaultStyle,condition:a.rules.Utilities.newFromTemplate(a.rules.Utilities.getFirstValidCondition())})},j}return __extends(e,c),e.prototype.commit=function(){c.prototype.commit.call(this),this.pdma.setRules(this.allRules),this.fetchRules()},e.prototype.ruleScope=function(c){var e=new d(this.dm,this.pdma,a.extend({},[c.selection]),this.columnsAreMeasures,a.rules.cloneCondition(c.condition),b.PresentationStyle.clone(c.style));return e.condition.context=this.scope.ruleContext,e},e.prototype.fetchRules=function(){var a=this;this.scope.ruleContext=this.pdma.ruleContext,this.allRules=this.pdma.getRules().map(function(b){return a.ruleScope(b)})||[],this.scope.rules=this.allRules.filter(function(c){var d=c.selection&&c.selection.type;if(d===b.GridRangeType.Column){var e={};c.selection.args.forEach(function(a){return e[a]=!0});for(var f=0;f<a.selection.args.length;f++){var g=a.selection.args[f];if(e[g])return!0}}return d===b.GridRangeType.Table||d===b.GridRangeType.Row}),this.onRulesFetched()},e.prototype.toSelection=function(a){return b.SelectionHelper.columnsSelection(this.pdma,a.filter(function(a){return a.checked}).map(function(a){return a.key}))},e.prototype.getColumnsCategories=function(){for(var a=this.pdma.getColumnAxis(),b=a.getCategories(),c=[],d=0;d<b.length;d++)c.push({value:b[d],label:b[d]});return c},e.prototype.getColumns=function(c){function d(c,d){return d?a.stringFormat(b.Strings.Grid_ColumnSelector_ItemWithAliasFmt,{alias:d,displayName:c}):c}function e(a){return c.args.indexOf(a)>=0}var f,g=this.pdma.getColumnAxis();return f=this.columnsAreMeasures?g.options.getMeasures().map(function(a){return{key:a.key,displayName:d(a.displayName||a.key,a.alias),checked:e(a.key),category:a.category,description:a.description}}):g.getSliceRange(0,g.length()).map(function(a){return{key:a.key(),displayName:d(a.displayName(),a.alias),checked:e(a.key()),category:a.category,description:a.description}})},e}(a.rules.RulesEditor);c.GridRulesEditor=e}(c=b.condFormatting||(b.condFormatting={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(b){this._grid=b,this.performOperationOnHeaderPanel=new a.Event}return c.prototype.extendSelection=function(a){return a?(a=b.SelectionHelper.extendColumns(this.presentationDataModel,a),this.gridSelection=a,a.type===b.GridRangeType.Column&&a):null},c.prototype.isPanelAvailable=function(a){return this._isPanelAvailable&&!!this.extendSelection(a)},c.prototype.initHeaderPanelEvent=function(a,b,c){this.performOperationOnHeaderPanel.raise(this,{keepVisible:a,columnId:b})},c.prototype.showPanel=function(a,b){if(this._originalColumnID=a.args[0],this.gridSelection=void 0,!this._isPanelAvailable)throw new Error(this.PANEL_ERROR_MESSAGE);if(a=this.extendSelection(a),!a)throw new Error(this.SELECTION_ERROR_MESSAGE);var c=this.getColumnTarget(a);this._showPanel(b||c,a)},c.prototype.getColumnTarget=function(a){if(a.type===b.GridRangeType.Column&&a.args.length){var c=$(this._grid.domNode).find('[colid="'+a.args[0]+'"]').first(),d=c.length&&c[0];return d}return this._grid.domNode},c.prototype._showPanel=function(a,b){throw new Error("Base class doesn't have panel")},c.prototype.dispose=function(){this.close(),this.gridSelection&&this.gridSelection.args&&this.gridSelection.args.length&&this.initHeaderPanelEvent(!1,this._originalColumnID||this.gridSelection.args[0],void 0)},c.prototype.close=function(){throw new Error("Base class doesn't have close close implementation")},c}();c.PanelManager=d;var e=function(d){function e(a,c,e,f,g){var h=d.call(this,c)||this;return h.dataModel=a,h.gridObject=e,h._scope=f,h._popupService=g,h.PANEL_ERROR_MESSAGE="The conditional formatting is not available for this data model",h.SELECTION_ERROR_MESSAGE="Only column, cell and table selections are supported",h.presentationDataModel=a.getAs(b.PresentationDataModelAdapter),h._isPanelAvailable=!!h.presentationDataModel,h}return __extends(e,d),e.prototype.close=function(){this._popupScope&&this._popupScope.$destroy()},e.prototype._showPanel=function(d,e){var f=this,g=!1;if(this.presentationDataModel.useMeasures&&e.type===b.GridRangeType.Column){var h=this.presentationDataModel.getColumnAxis();e.args=Object.keys(e.args.reduce(function(a,b){var c=h.contains(b)&&h.getNodeAndMeasureKey(b).measureKey;return c&&(a[c]=!0),a},{})),g=!0}if(this.close(),e.args.length){e.args[0]}var i={automaticallyClose:!1,showAnchorPointArrow:!0};this._popupScope=this._scope.$new();var j=new c.GridRulesEditor(this.dataModel,e,this._popupScope,g,a.module("ionwebGrids").getService("ionweb.themeManager"),a.module("ionwebGrids").getService("ionweb.environmentService"));this.initHeaderPanelEvent(!0,this._originalColumnID,void 0),this._popupService.createPopup("grids.ui/rules/condFormat/view.tpl.html",$(d),this._popupScope,i).then(function(a){a.show(),j.close=function(){f.initHeaderPanelEvent(!1,f._originalColumnID,void 0),a.destroy()},f._popupScope.$on("$destroy",function(){a.destroy()})})},e}(d);c.Manager=e}(c=b.condFormatting||(b.condFormatting={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=a.rules.ColumnFilterConditionFactory,e=a.rules.filterConditionMapper,f=function(c){function e(d,e,f,i,j){var k=c.call(this,void 0)||this;k.data=d,k._scope=e,k._popupService=f,k.headerRegionManager=i,k.selectionManager=j,k._popupStateEvent=new a.Event,k.PANEL_ERROR_MESSAGE="Filter Panel Not available",k.SELECTION_ERROR_MESSAGE="Filter is only supported for column type selection",k.presentationDataModel=d.getAs(b.FilterDataModelAdapter),k.stateUpdated=new a.Event;var l,m;return k._filterIconMap={},k.presentationDataModel&&(l=d.getAs(b.PresentationDataModelAdapter),m=new h(k.presentationDataModel,k._scope.options,l)),k._columnFilterConditions=new g(e.options,m),k._isPanelAvailable=!!k.presentationDataModel||!!k._scope.options.onFilterApplied||!!k._scope.options.onRetrievingColumnFilterValues,k.headerRegionManager.headerReloadEvent.add(function(){k.initHeaderFilterIcons()}),k}return __extends(e,c),e.prototype.isPanelAvailable=function(){return this._isPanelAvailable},e.prototype.init=function(a){this._grid=a,this.initHeaderFilterIcons()},e.prototype.initHeaderFilterIcons=function(){var a=this;if(this._isPanelAvailable){var c=this.data.getColumnAxis(),d=c.getSliceRange(0,c.length());d.forEach(function(c){var d=c.key();if(b.ResponsiveDataModel.isResponsiveGroup(a.data,d)){var f=b.ResponsiveDataModel.groupConfiguration(a.data,d);d=f&&f.groupDef&&f.groupDef.filteringKey}if(d&&!(a._scope.options.headerPanels&&a._scope.options.headerPanels[d]&&a._scope.options.headerPanels[d].filterConfiguration&&(a._scope.options.headerPanels[d].filterConfiguration.disableFilter===!0||a._scope.options.headerPanels[d].filterConfiguration.hideConditionFilters&&a._scope.options.headerPanels[d].filterConfiguration.hideValueFilters))){var g={name:"filter",alwaysVisible:!1,color:void 0};a.isColumnFiltered(d)&&(g.alwaysVisible=!0,g.color=e.FILTER_ICON_COLOR),a._filterIconMap[d]=g,g.clicked=function(c){if(c.stopPropagation(),g.keepVisible!==!0){var e=b.SelectionHelper.columnsSelection(a.presentationDataModel,[d]);a.showPanel(e,c.currentTarget)}},a.headerRegionManager.addHeaderIcon(g,c.key())}}),this._popupStateEvent.add(function(b,c){var d=c.columnId,e=a._filterIconMap[d];"alwaysVisible"in c&&(e.alwaysVisible=c.alwaysVisible),"keepVisible"in c&&(e.keepVisible=c.keepVisible),"color"in c&&(e.color=c.color),a._scope.$evalAsync()})}},e.prototype.close=function(){this._popup&&this._popup.destroy(),this._popupScope&&this._popupScope.$destroy()},e.prototype._showPanel=function(a,b){var c=this;if(this.close(),b.args.length)var e=b.args[0];this._popupStateEvent.raise(this,{columnId:e,keepVisible:!0});var f={automaticallyClose:!1,showAnchorPointArrow:!0};this.initPopupScope(e),this.initHeaderPanelEvent(!0,e,void 0),this._popupScope.filterConfiguration&&this._popupScope.filterConfiguration.hideValueFilters===!1&&this._columnFilterConditions.getFilterListValues(e).then(function(a){var b;a instanceof Array?b=a:(b=a.values,c._popupScope.disableSorting=!a.enableSorting),c._popupScope.cellValues=b}),this._popupScope.conditionFilter=this._columnFilterConditions.condition(e)||d.getDefaultColumnFilterCondition(e),this._popup=this._popupService.createWithTemplate('<filter-panel-editor ng-model="conditionFilter" close="close()" apply-and-close="applyAndClose(condition)" clear-and-close="clearAndClose()" cell-values="cellValues" filter-configuration="filterConfiguration" disable-sorting="disableSorting"></filter-panel-editor>',$(a),this._popupScope,f),this._popup.onClose.add(function(){c._popupStateEvent.raise(c,{columnId:e,keepVisible:!1})}),this.headerRegionManager.notifyOpeningPopup(this),this._popup.show()},e.prototype.initPopupScope=function(a){var b=this;this._popupScope=this._scope.$new(),this._popupScope.filterConfiguration={},this._popupScope.close=function(){b.initHeaderPanelEvent(!1,a,!1),b._popup.destroy()};var c=function(a){a!==b&&b._popupScope.close()};this.headerRegionManager.popupRequested.add(c),this._scope.options.headerPanels&&this._scope.options.headerPanels[a]&&this._scope.options.headerPanels[a].filterConfiguration&&(this._popupScope.filterConfiguration.hideConditionFilters=this._scope.options.headerPanels[a].filterConfiguration.hideConditionFilters,this._popupScope.filterConfiguration.hideValueFilters=this._scope.options.headerPanels[a].filterConfiguration.hideValueFilters,void 0!==this._scope.options.headerPanels[a].filterConfiguration.conditionDataType&&(this._popupScope.filterConfiguration.conditionDataType=this._scope.options.headerPanels[a].filterConfiguration.conditionDataType)),this._popupScope.applyAndClose=function(c){b._columnFilterConditions.setCondition(c),b.initHeaderPanelEvent(!0,a,!0),b.stateUpdated.raise(b,void 0),b._popupStateEvent.raise(b,{columnId:a,keepVisible:!1,alwaysVisible:!0,color:"bright-blue"}),b._popup.destroy()},this._popupScope.clearAndClose=function(){b._columnFilterConditions.clearCondition(b._popupScope.conditionFilter),b.initHeaderPanelEvent(!1,a,!1),b.stateUpdated.raise(b,void 0),b._popupStateEvent.raise(b,{columnId:a,keepVisible:!1,alwaysVisible:!1,color:void 0}),b._popup.destroy()},this._popupScope.$on("destroy",function(){b._popup.destroy(),b.headerRegionManager.popupRequested.remove(c)})},e.prototype.getState=function(){return{columnFilterConditions:this._columnFilterConditions.getState()}},e.prototype.setState=function(a){this._columnFilterConditions.setState(a.columnFilterConditions),this.updateHeaderPanel(),this._columnFilterConditions.handleFilter()},e.prototype.isColumnFiltered=function(a){return!!this._columnFilterConditions.condition(a)},e.prototype.updateHeaderPanel=function(){var a=this;this._columnFilterConditions.columnFilterConditions.forEach(function(b,c){var d=b.getColumn();a._filterIconMap[d]&&(a.isColumnFiltered(d)?(a._filterIconMap[d].alwaysVisible=!0,a._filterIconMap[d].color=e.FILTER_ICON_COLOR):(a._filterIconMap[d].alwaysVisible=!1,a._filterIconMap[d].color=void 0))}),this._scope.$evalAsync()},e.FILTER_ICON_COLOR="bright-blue",e}(b.condFormatting.PanelManager);c.Manager=f;var g=function(){function a(a,b){this._gridOptions=a,this._columnFilterDM=b,this._columnFilterCondition=[]}return a.prototype.setCondition=function(a){if(a){var b=this._columnFilterCondition.filter(function(b){return b.getColumn()===a.getColumn()});b.length&&this._columnFilterCondition.splice(this._columnFilterCondition.indexOf(b[0]),1),this._columnFilterCondition.push(a)}this.handleFilter()},Object.defineProperty(a.prototype,"columnFilterConditions",{get:function(){return this._columnFilterCondition},enumerable:!0,configurable:!0}),a.prototype.clearCondition=function(a){var b=this._columnFilterCondition.indexOf(a);b>=0&&(this._columnFilterCondition.splice(b,1),this.handleFilter())},a.prototype.handleFilter=function(){this.applicationFilterHandler()||this._columnFilterDM&&this._columnFilterDM.applyFilter(this._columnFilterCondition)},a.prototype.applicationFilterHandler=function(){var a={filters:{},cancel:!0};if(this._gridOptions.onFilterApplied){var b,c,d;return this.columnFilterConditions.forEach(function(f){b=f.getColumn(),d=f.getCondition(),c=e.createFilterForApplication(d),a.filters[b]=c}),this._gridOptions.onFilterApplied(a),a.cancel}return!1},a.prototype.convertApplicationValuesToFilterValues=function(a){var c=[];return a.forEach(function(a){var d;d=b.getCellPresentation(a.formattedValue)||a,c.push(d)}),c},a.prototype.getFilterListValues=function(a){var b,c=this,d=null;if(this._gridOptions.onRetrievingColumnFilterValues){var e={columnId:a};this._gridOptions.onRetrievingColumnFilterValues(e),d=e.values}return b=d?Q.when(e.values).then(function(a){return c.convertApplicationValuesToFilterValues(a)},function(){return[]}).then(function(a){return{values:a,enableSorting:e.enableSorting}}):this._columnFilterDM?Q.when(this._columnFilterDM.getUniqueColumnValues(a)):Q.when([])},a.prototype.condition=function(a){var b=this._columnFilterCondition.filter(function(b){return b.getColumn()==a});if(b.length)return b[0]},a.prototype.getState=function(){var a=[];return this._columnFilterCondition.forEach(function(b){a.push(b.getState())}),a},a.prototype.setState=function(a){var b=this;this._columnFilterCondition=[];var c=a;c&&c.forEach(function(a){var c=a;if(b.isFilterableColumn(c.column)){var e=d.getDefaultColumnFilterCondition();b._columnFilterCondition.push(e),e.setState(c)}})},a.prototype.isFilterableColumn=function(a){return!(this._gridOptions.headerPanels&&this._gridOptions.headerPanels[a]&&this._gridOptions.headerPanels[a].filterConfiguration&&this._gridOptions.headerPanels[a].filterConfiguration.disableFilter)},a}();c.ColumnFilterConditionAdapter=g;var h=function(){function a(a,b,c){this.filterDataModel=a,this.scopeOptions=b,this.pdma=c}return a.prototype.applyFilter=function(a){this.filterDataModel.gridFilter=this.createFilter(a)},a.prototype.createFilter=function(a){var c,d=this,f=[],g={};if(a.forEach(function(a){if(g[a.getColumn()]=e.createFilterForApplication(a.getCondition()),c=a.getCondition()){var h={columnKey:a.getColumn(),columnFilter:g[a.getColumn()]};"function"==typeof d.scopeOptions.onPreparingFilterForColumn&&d.scopeOptions.onPreparingFilterForColumn(h);var i=h.customFilter||new b.ColumnFilter(a.getColumn(),c,d.pdma);f.push(i)}}),"function"==typeof this.scopeOptions.onPreparingGridFilter){var h={columnFilters:g};this.scopeOptions.onPreparingGridFilter(h),h.customFilter&&f.push(h.customFilter)}var i=f.length?new b.AndFilter(f):null;return i},a.prototype.getUniqueColumnValues=function(a){var c=this,d={},e=[],f=this.filterDataModel.getDataSet();return this.filterDataModel.getSourceRowAxis().getSliceRange(0,this.filterDataModel.getSourceRowAxis().length()).forEach(function(g){var h,i=f.getSourceValue(g.key(),a);h=c.pdma?c.pdma.getPresentedValue(g.key(),a,i):b.getCellPresentation(i),d[h.getFormatted()||h.rawValue]||(d[h.getFormatted()||h.rawValue]=h,e.push(h||b.getCellPresentation(i)))}),e},a}();c.ColumnFilterAdapter=h}(c=b.filterPanel||(b.filterPanel={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(a,c){var d=this;this.dm=a,this.responsiveDm=c,this.validationControllers={},this.validationDms=new b.ValidationDmWrapper(a,function(a,b){return d.cellStateUpdated(a,b)},function(a,b){return d.cellValidationMessageUpdated(a,b)})}return c.prototype.init=function(a){this.grid=a,a.body.connect(a.body,"onAfterRow",this.onRowRendered,this),a.body.connect(a.body,"onAfterCell",this.onCellRendered,this),a.body.connect(a.body,"onUnrender",this.onRowUnrendered,this)},c.prototype.onRowRendered=function(a,b,c){var d=this,e=this.dm.getColumnAxis().getSliceRange(0,this.dm.getColumnAxis().length());e&&e.forEach(function(b){d.updateValidationForCell(a.id,b.key())})},c.prototype.onRowUnrendered=function(a){arguments.length?this.removeValidationsForRow(a):this.removeAllValidations()},c.prototype.onCellRendered=function(a){this.updateValidationForCell(a.row.id,a.column.id)},c.prototype.cellStateUpdated=function(a,b){var c=this.responsiveDm?this.responsiveDm.getGridColumnKey(b):b;this.updateValidationForCell(a,c)},c.prototype.cellValidationMessageUpdated=function(a,b){var c=this.responsiveDm?this.responsiveDm.getGridColumnKey(b):b;this.updateValidationForCell(a,c)},c.prototype.updateValidationForCell=function(b,c){this.removeValidationControllerForCell(b,c);var d=this.responsiveDm?this.responsiveDm.getEditableColumnKey(c):c,e=this.validationDms.getValidationStates(b,d);if(e.length>0){var f=this.grid.body.getCellNode({rowId:b,colId:c});if(f){var g=e[0].state,h=e.filter(function(a){return a.state===g}).map(function(a){return a.message}).join("<br/>"),i=new a.validation.ValidationController(angular.element(f.children[0]),h,g);i.useInnerBorder=!0;var j=this.validationControllers[b];j||(this.validationControllers[b]={},j=this.validationControllers[b]),j[c]=i}}},c.prototype.removeValidationControllerForCell=function(b,c){var d=this.validationControllers[b]?this.validationControllers[b]:void 0;d&&d[c]&&(d[c].state=a.validation.ValidationState.Valid,delete d[c],Object.keys(d).length||delete this.validationControllers[b])},c.prototype.removeAllValidations=function(){var a=this,b=Object.keys(this.validationControllers);b&&b.forEach(function(b){a.removeValidationsForRow(b)})},c.prototype.removeValidationsForRow=function(a){var b=this,c=this.validationControllers[a];if(c){var d=Object.keys(c);d&&d.forEach(function(c){b.removeValidationControllerForCell(a,c)})}},c.prototype.dispose=function(){this.removeAllValidations(),this.validationDms.dispose()},c}();c.Manager=d}(c=b.validation||(b.validation={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(b){var c=function(){function c(a){this.presentationDataModelAdapter=a}return c.prototype.init=function(a){this.grid=a,this.grid.body.connect(this.grid.body,"onAfterRow",this.onRowRendered,this)},c.prototype.appendClasses=function(b,c,d){var e,f,g,h=this;d===a.AxisType.Row?(e=function(){return h.presentationDataModelAdapter.getRowFormat(b)},f=function(){return h.presentationDataModelAdapter.getRowMeasureFormat(b)},g=this.presentationDataModelAdapter.getRowAxis().getAs(a.PivotAxis)):(e=function(){return h.presentationDataModelAdapter.getColumnFormat(b)},f=function(){return h.presentationDataModelAdapter.getColumnMeasureFormat(b)},g=this.presentationDataModelAdapter.getColumnAxis().getAs(a.PivotAxis));var i=e(b);if((!i||!i.cssClasses)&&g){var j=g.contains(b)&&g.getNodeAndMeasureKey(b);j&&(i=f(j.measureKey))}if(i&&i.cssClasses){var k=c;i.cssClasses.forEach(function(a){return k.classList.add(a)})}},c.prototype.applyStyles=function(c,d,e,f){var g=this.presentationDataModelAdapter.getTableFormat();g&&g.cssClasses&&g.cssClasses.forEach(function(a){return c.find("tbody")[0].classList.add(a)}),this.appendClasses(d,c.find("tr")[0],a.AxisType.Row);for(var h=c.find("[colid]"),i=0;i<h.length;i++){var j=h[i];this.appendClasses(j.attributes.colid.value,j,a.AxisType.Column),this.presentationDataModelAdapter.isRowOnColumnPriority()&&j.classList.add(b.Manager.RowOnColumnClassName)}},c.prototype.isLeaf=function(b){var c=this.presentationDataModelAdapter.getRowAxis().getAs(a.PivotAxis),d=!1;return c.options.getVisibleRoot().visitTree(function(a){0===a.children().length&&a.key()===b&&(d=!0)},a.TreeVisitMode.PostOrder,function(){return!0}),d},c.prototype.onRowRendered=function(a,b,c){var d=$(a.node());this.applyStyles(d,a.id,b,c)},c.RowOnColumnClassName="rowOnColumn",c}();b.Manager=c}(b=a.style||(a.style={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function d(d,e,f){var g=this;this.responsiveDataModel=d,this.respService=e,this.gridOptions=f,this.refreshConfigurationReentranceGuard=!1;var h=function(a){return function(){return a.reduce(function(a,d){var e=d&&d.getStyle?d.getStyle(new b.PresentationStyle):new b.PresentationStyle,f=d&&d.getFormatted?d.getFormatted(b.PresentationContext.Rendering):d,h=f||"";if(!h){var i=new b.PresentationStyle(["ion-empty-cell"]);e=e.mixin(i)}var j=!g.gridOptions.disableHtmlEscape,k=j?c.GridObject.escapeValue(h):h,l=e.getClasses(),m=l&&l.length?'class="'+l.join(" ")+'"':"",n=e.getStyle(),o=Object.keys(n).map(function(a){return a+": "+n[a]}),p=o.length?'style = "'+o.join("; ")+'"':"";return a+"<div "+m+" "+p+">"+k+"</div>"},"")}};d.registerPredefinedPresentationFunctorProvider(h),this._onConfigurationRefreshed=new a.Event}return d.prototype.init=function(c,d,e,f,g,h){var i=this;this.mode=h,this.isMobile=g,this.columnResizer=f,this.applicationDefinitions=d&&d.definitions||{},this.applicationContexts=d&&d.contexts||{},this.columnLockService=e,f.customColumnWidthProvider=function(){if(!i.responsivenessServiceRegistrationResult)return null;var b=i.responsiveDataModel.getConfiguration();if(b&&b.visibleKeys.length>0){for(var c=i.responsivenessServiceRegistrationResult.computeCurrentSize(),d={},e=c.width-b.visibleKeys.length,f=0;f<b.visibleKeys.length-1;f++){var g=b.visibleKeys[f],h=i.columnResizer.getCachedColumnWidth(g)||a.tables.getDefaultWidth(g,i.gridOptions);d[g]=h+"px",e-=h}var j=b.visibleKeys[b.visibleKeys.length-1];return d[j]=(e>0?e:a.tables.getDefaultWidth(j,i.gridOptions))+"px",d}return null},h===b.GridResponsivenessMode.Disabled?this.setPassThroughConfiguration():(this.responsivenessServiceRegistrationResult=this.respService.register(c,function(a){c.offsetParent&&i.resizeHandler(a)},!0),this.sourceAxisSubscriptionResult=this.responsiveDataModel.getSourceDataModel().getColumnAxis().options.slicesEvent.add(function(a,b){i.refreshConfiguration(i.responsivenessServiceRegistrationResult.computeCurrentSize())}),this.refreshConfiguration(this.responsivenessServiceRegistrationResult.initialSize))},Object.defineProperty(d.prototype,"onConfigurationRefreshed",{get:function(){return this._onConfigurationRefreshed},enumerable:!0,configurable:!0}),d.prototype.setPassThroughConfiguration=function(){this.responsiveDataModel.setConfiguration(null),this.columnLockService.setIsAvailable(!0)},d.prototype.setConfiguration=function(a){this.columnLockService.setIsAvailable(!1),this.responsiveDataModel.setConfiguration(a)},d.prototype.processColumnSizeChanged=function(){if(this.responsivenessServiceRegistrationResult){var a=this.responsivenessServiceRegistrationResult.computeCurrentSize();this.refreshConfiguration(a)}},d.prototype.getCachedWidth=function(a,b){var c=b[a];if(c&&c.indexOf("px")>=0){var d=parseInt(c.replace("px",""));return d}return null},d.prototype.getColumnWidth=function(a,c){var d=this.getCachedWidth(a,c)||b.getDefaultWidth(a,this.gridOptions);return d},d.prototype.computeGroupSize=function(a,b){var d=null;return b.forEach(function(b){a.groupedKeys.indexOf(b.key)>=0&&(!d||d<b.width)&&(d=b.width)}),d||(d=c.DEFAULT_COLUMN_WIDTH_NUMBER),d},d.prototype.getGroupWidth=function(a,b,c,d){var e=this.getCachedWidth(a,c)||this.computeGroupSize(b,d);return e},d.prototype.selectContext=function(a){return this.applicationContexts&&this.applicationContexts[a.designSize.name]?this.applicationContexts[a.designSize.name]:this.isMobile?"xl"===a.designSize.name||"l"===a.designSize.name?b.GridResponsiveContext.None:b.GridResponsiveContext.Mobile:b.GridResponsiveContext.None},d.prototype.selectDefinition=function(c){if(this.mode===b.GridResponsivenessMode.Disabled)return null;var d=this.mode===b.GridResponsivenessMode.Default?this.selectContext(c):b.GridResponsiveContext.MobileAndDesktop;if(this.isMobile&&0===(d&b.GridResponsiveContext.Mobile))return null;if(!this.isMobile&&0===(d&b.GridResponsiveContext.Desktop))return null;var e=this.applicationDefinitions[c.designSize.name];if(e)return e;var f=a.firstOrDefault(a.ResizeObserverService.designSizes,function(a){return a.name===c.designSize.name}),g=a.ResizeObserverService.designSizes.indexOf(f);g--;for(var h=g;h>=0;h--){var i=a.ResizeObserverService.designSizes[h];if(e=this.applicationDefinitions[i.name])return e}return e={}},d.prototype.beginRefreshConfiguration=function(){this.refreshConfigurationReentranceGuard=!0},d.prototype.endRefreshConfiguration=function(){this.columnResizer.refreshWidths(),this._onConfigurationRefreshed.raise(this,null),this.refreshConfigurationReentranceGuard=!1},d.prototype.refreshConfiguration=function(a){var c=this;if(!this.refreshConfigurationReentranceGuard){this.beginRefreshConfiguration();
var d=this.selectDefinition(a);if(!d)return this.setPassThroughConfiguration(),this.columnResizer.refreshWidths(),void(this.refreshConfigurationReentranceGuard=!1);var e=this.responsiveDataModel.getSourceDataModel().getColumnAxis().getSliceRange(0,this.responsiveDataModel.getSourceDataModel().getColumnAxis().length()),f=this.columnResizer.getResizedColumns(),g=e.map(function(a){var b=a.key(),d={key:b,width:c.getColumnWidth(b,f)};return d}),h={},i=[];d.groups&&Object.keys(d.groups).forEach(function(a){var b={key:a,width:c.getGroupWidth(a,d.groups[a],f,g)};h[a]=b,i.push(b)});var j=b.GridResponsiveUtils.processLayout(d,g,i,a),k=e.map(function(a){return a.key()}),l=j.visibleKeys;b.ResponsiveDataModel.compareUnorderedStringArrays(k,l)?this.setPassThroughConfiguration():(Object.keys(j.groups).forEach(function(a){var b=h[a].width;c.columnResizer.setWidth(a,b,!0)}),this.setConfiguration(j)),this.endRefreshConfiguration()}},d.prototype.resizeHandler=function(a){this.refreshConfiguration(a)},d.prototype.dispose=function(){this.responsivenessServiceRegistrationResult&&(this.responsivenessServiceRegistrationResult(),this.responsivenessServiceRegistrationResult=null),this.sourceAxisSubscriptionResult&&(this.sourceAxisSubscriptionResult(),this.sourceAxisSubscriptionResult=null)},d}();c.GridResponsiveDriver=d}(c=b.grid||(b.grid={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(b){var c=function(){function b(b,c,d,e){var f=this;this.dataModel=b,this.settingsManager=c,this.gridLogger=d;var g=b.getColumnAxis();this.localScope=e,this.isPivotAxisAdapter=g.options.getMeasures().length>0,this.isPivotAxisAdapter?this.managedAxis=b.getColumnAxis().getAs(a.PivotAxisAdapter):this.managedAxis=b.getColumnAxis().getAs(a.ResponsiveAxisAdapter)||b.getColumnAxis().getAs(a.SliceManagerAxisAdapter),this.managedAxis&&(this.sliceManagerAxisOptions=this.managedAxis.options);var h=function(a){for(var b=0;b<e.filteredColumns.length;b++){var c=e.filteredColumns[b];if(c.key===a)return c.checked&&f.isColumnHideEventHandled(c.key)||!c.checked&&f.isColumnShowEventHandled(c.key)?c:(c.checked=!c.checked,f.sliceManagerAxisOptions.setFilterVisibleSlices(e.filteredColumns),f.settingsManager.notifyChanges(),c)}};e.onListSelectorItemClicked=function(a){if(f.isPivotAxisAdapter){if(a.checked&&f.isColumnHideEventHandled(a.key)||!a.checked&&f.isColumnShowEventHandled(a.key))return;a.checked=!a.checked,f.managedAxis.hideMeasure(a.key,!a.checked)}else{var b=h(a.key);a.checked=b.checked}},!this.isPivotAxisAdapter&&this.isAvailable?e.fetchFilteredColumns=function(){e.filteredColumns=f.sliceManagerAxisOptions.getFilterVisibleSlices(),e.availableCategories=f.managedAxis.getCategories()}:this.isAvailable&&(e.fetchFilteredColumns=function(){var a=f.managedAxis.options.getMeasures();e.filteredColumns=a.map(function(a){return{key:a.key,displayName:a.alias||a.displayName||a.key,description:a.description,category:a.category,checked:!a.hidden}}),e.availableCategories=f.managedAxis.getCategories()}),e.hideColumn=function(a){if(f.isPivotAxisAdapter){if(f.isColumnHideEventHandled(a))return;var b=f.managedAxis.getNodeAndMeasureKey(a);f.managedAxis.hideMeasure(b.measureKey,!0)}else h(a)},this.sliceEventObserver=g.options.slicesEvent.add(function(){e.fetchFilteredColumns&&e.fetchFilteredColumns()}),e.fetchFilteredColumns&&e.fetchFilteredColumns()}return b.adjustTargetIndex=function(a,b){var c=0;return a.forEach(function(a){return b>a&&c++}),b-c},Object.defineProperty(b.prototype,"isAvailable",{get:function(){return!!this.managedAxis},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"logger",{get:function(){return this.gridLogger},enumerable:!0,configurable:!0}),b.prototype.setFilterVisibleSlices=function(a){this.sliceManagerAxisOptions.setFilterVisibleSlices(a),this.settingsManager.notifyChanges()},b.prototype.dispose=function(){this.sliceEventObserver()},b.prototype.getManagedAxis=function(){return this.managedAxis},b.prototype.isColumnShowEventHandled=function(a){if(this.localScope.options.headerPanels){var b=this.localScope.options.headerPanels[a];return b&&b.onColumnShow&&!b.onColumnShow(a)}return!1},b.prototype.isColumnHideEventHandled=function(a){if(this.localScope.options.headerPanels){var b=this.localScope.options.headerPanels[a];return b&&b.onColumnHide&&!b.onColumnHide(a)}return!1},b.prototype.moveFunction=function(a,b){if(this.isAvailable){if(this.isPivotAxisAdapter)return void this.moveFunctionForPivotAxis(a,b);for(var c=this.sliceManagerAxisOptions.getFilterVisibleSlices(),d=[],e=[],f=a.length-1;f>=0;--f){var g=a[f];d.unshift(c[g]),c.splice(g,1)}d.forEach(function(a){c.splice(b++,0,a),e.push(a.key)});var h=[];c.forEach(function(a){a.checked&&h.push(a.key)}),this.gridLogger.logSliceManagerMove(e,h),this.sliceManagerAxisOptions.setFilterVisibleSlices(c),this.settingsManager.notifyChanges()}},b.prototype.moveFunctionForPivotAxis=function(b,c){if(this.isAvailable){for(var d=this.dataModel.getColumnAxis(),e=d.getAs(a.PivotAxisAdapter),f=e.options.getMeasures(),g=[],h=[],i=b.length-1;i>=0;--i){var j=b[i];g.unshift(f[j]),f.splice(j,1)}g.forEach(function(a){f.splice(c++,0,a),h.push(a.key)});for(var k=this.managedAxis.options.getMeasures(),l=[],i=0;i<k.length;++i)l.push(k[i].key);this.gridLogger.logSliceManagerMove(h,l),e.options.setMeasures(f)}},b}();b.Manager=c}(b=a.sliceAxis||(a.sliceAxis={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){function b(b,c){var d=a.grid.DEFAULT_COLUMN_WIDTH_NUMBER,e=c.defaultColumnsWidths&&c.defaultColumnsWidths[b];return e&&e.indexOf("px")>=0&&(d=parseFloat(e)),d}function c(a,b){var c=document.elementFromPoint(a,b);return e(c)}function d(a,b,c){var d=$(a.bodyNode).find('[rowid="'+b+'"] [colid="'+c+'"] > div');return d&&1===d.length&&d[0]}function e(a){for(var b={rowKey:"",columnKey:""},c=a;c&&!c.getAttribute("colid");)c=c.parentElement;for(c&&c.getAttribute("colid")&&(b.columnKey=c.getAttribute("colid")),c=a;c&&!c.getAttribute("rowid");)c=c.parentElement;return c&&c.getAttribute("rowid")&&(b.rowKey=c.getAttribute("rowid")),b}a.safeGetClientHeight=function(a){return a?a.clientHeight:0},a.getDefaultWidth=b,a.gridElementAxesIDsFromScreenCoords=c,a.gridElementFromKeys=d,a.gridElementAxesIDsFromElement=e}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(a,b,c,d,e){this.columnLock=a,this.settingsManager=b,this.datamodel=c,this.gridObject=d,this.scope=e,this.lockedColumns=[],this.available=!0}return a.prototype.isAvailable=function(){return this.available},a.prototype.setIsAvailable=function(a){this.isAvailable()!==a&&(this.available=a,this.available?this.lock(this.scope.frozenColumnCountUserSetting):this.applyNoFreezing())},a.prototype.lock=function(a){this.scope.frozenColumnCountUserSetting=a,this.available&&(this.lockedColumns=this.datamodel.getColumnAxis().getSliceRange(0,a).map(function(a){return a.key()}),this.columnLock.lock(a),this.settingsManager.notifyChanges())},a.prototype.unlock=function(){this.scope.frozenColumnCountUserSetting=0,this.applyNoFreezing()},a.prototype.applyNoFreezing=function(){this.lockedColumns.length>0&&(this.lockedColumns=[],this.columnLock.unlock(),this.gridObject.refreshColumns(),this.settingsManager.notifyChanges())},a.prototype.getLockedColumns=function(){return this.available?this.lockedColumns:[]},a.prototype.getLockedColumnsCount=function(){return this.scope.frozenColumnCountUserSetting},a.prototype.getState=function(){return this.scope.frozenColumnCountUserSetting||0},a.prototype.setState=function(a){this.scope.frozenColumnCountUserSetting=a,this.scope.frozenColumnCountUserSetting>0?this.lock(this.scope.frozenColumnCountUserSetting):this.unlock()},a.prototype.dispose=function(){},a}();a.ColumnLockService=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){function b(a,b){"number"==typeof a?b.addClass(c):a instanceof Date?b.addClass(d):b.addClass(e)}var c="inline-editing-text-input-num-fmt",d="inline-editing-text-input-date-fmt",e="inline-editing-text-input-text-fmt";a.applyAdditionalClassesToTextBasedEditor=b;var f=function(){function b(a,b,c,d){this.gridx=a,this.currentSourceValue=b,this.forceCommitOnEnter=c,this.cellEditor=d,this.handleEnter=!0,this.handleTab=!0,this.handleEsc=!0,this._isDisposed=!1}return Object.defineProperty(b.prototype,"value",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"valueAlreadyParsed",{get:function(){return!1},enumerable:!0,configurable:!0}),b.prototype.gridxNode=function(){return this.gridx.domNode},b.prototype.show=function(a,b,c,d,e){},b.prototype.processEditCompleted=function(b,c,d){var e=this.forceCommitOnEnter&&(b===a.EditCompleteReason.Enter||b===a.EditCompleteReason.Tab),f=e||this.checkValueChange(),g=f?c:d;g&&g(b)},b.prototype.checkValueChange=function(){return this.initialValue!==this.value},b.prototype.dispose=function(){this._isDisposed=!0,this.unsubscribeFunctions&&this.unsubscribeFunctions.forEach(function(a){return a()}),this.unsubscribeFunctions=null},b.escapeKey=function(b){return a.EditingDataModel.escapeKeyForJQuery(b)},b.prototype.appendCellEditorToCell=function(a,c,d){var e=$(this.gridxNode()).find('[role=row][rowid="'+b.escapeKey(c)+'"]'),f=e.find('[role=gridcell][colid="'+b.escapeKey(d)+'"]');if(f){this.initialValue=this.value;var g=f.find("div.gridxCellWidget");g&&g.length>0?this.gridx.body.removeCellWidget(c,d):f.children().remove(),f.append(a),this.gridx.body.setActiveCell(c,d,!0)}},b.prototype.getHtmlElement=function(){return this.htmlElement},b.prototype.isInitialized=function(){return!!this.htmlElement},b.prototype.completeInitialization=function(b,c,d,e){var f=this;this.htmlElement=b;var g=!1,h=function(a){g||a.stopPropagation()},i=function(b){if(!g){var h=!0;b.keyCode===c.ENTER&&f.handleEnter?f.processEditCompleted(a.EditCompleteReason.Enter,d,e):b.keyCode===c.TAB&&f.handleTab?(f.processEditCompleted(a.EditCompleteReason.Tab,d,e),b.preventDefault()):b.keyCode===c.ESCAPE&&f.handleEsc?e&&e(a.EditCompleteReason.Esc):h=!1,g=h,h&&b.stopPropagation()}},j=function(b){g||(g=!0,f.processEditCompleted(a.EditCompleteReason.Blur,d,e))};b.addEventListener("keypress",h),b.addEventListener("keydown",i),b.addEventListener("blur",j),this.unsubscribeFunctions=[function(){b.removeEventListener("keydown",i)},function(){b.removeEventListener("keypress",h)},function(){b.removeEventListener("blur",j)}]},b.prototype.getClassesForEditOnSelectionCell=function(){return"number"==typeof this.currentSourceValue?[a.PositiveNumericFormattingClass]:this.currentSourceValue instanceof Date?[a.PositiveNumericFormattingClass]:[]},b}();a.CellEditorController=f}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.Enabled=0]="Enabled",a[a.Disabled=1]="Disabled",a[a.Hidden=2]="Hidden"}(b=a.EditingControlVisibility||(a.EditingControlVisibility={}));var c=function(){function a(){this._editingControlVisibilityCallback=null}return Object.defineProperty(a.prototype,"editingControlVisibility",{get:function(){return this._editingControlVisibilityCallback},set:function(a){this._editingControlVisibilityCallback=a},enumerable:!0,configurable:!0}),a.prototype.getDisplayName=function(){return"CellEditor"},a}();a.CellEditor=c}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(a){function b(b){var c=a.call(this)||this;return c.customControlOptions=b,c}return __extends(b,a),b.prototype.getDisplayName=function(){return"CustomCellEditor"},b}(a.CellEditor);a.CustomCellEditor=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.getDisplayName=function(){return"TextCellEditor"},b}(a.CellEditor);a.TextCellEditor=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(b){function c(c,d,e,f,g,h){var i=b.call(this,c,f,g,e)||this;i.keys=d,i.editor=e,i.cellValue=h,i.customHtmlElement=null,i.currentValue=null,i.isDisposed=!1,i.customControlOptions=e.customControlOptions,i.customControlOptions.disableEnter&&(i.handleEnter=!1),i.customControlOptions.disableTab&&(i.handleTab=!1),i.customControlOptions.disableEsc&&(i.handleEsc=!1);var j=function(b){i.currentValue=b,!i.isDisposed&&i.completeCallback&&i.completeCallback(a.EditCompleteReason.Api)},k=function(){!i.isDisposed&&i.cancelCallback&&i.cancelCallback(a.EditCompleteReason.Api)},l=function(a){i.currentValue=a,!i.isDisposed&&i.updateCallback&&i.updateCallback(a)},m=i.customControlOptions.onCreate(i.cellValue,j,k,l);return m&&(m instanceof HTMLElement?(i.customHtmlElement=m,i.currentValue=f):(i.customHtmlElement=m.element,i.currentValue=m.value)),i}return __extends(c,b),Object.defineProperty(c.prototype,"value",{get:function(){return this.currentValue},enumerable:!0,configurable:!0}),c.prototype.show=function(a,b,c,d,e){if(this.completeCallback=c,this.cancelCallback=d,this.updateCallback=e,this.customHtmlElement){var f=$(this.customHtmlElement);this.appendCellEditorToCell(f,a,b),this.completeInitialization(this.customHtmlElement,this.keys,c,d)}},c.prototype.dispose=function(){this.isDisposed=!0,this.customHtmlElement&&this.customControlOptions&&this.customControlOptions.onClear&&this.customControlOptions.onClear(this.customHtmlElement),this.customHtmlElement=null,b.prototype.dispose.call(this)},c}(a.CellEditorController);a.CustomCellEditorController=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.Checked=0]="Checked",a[a.Unchecked=1]="Unchecked"}(b=a.CheckBoxStatus||(a.CheckBoxStatus={}));var c=function(a){function c(){var c=a.call(this)||this;return c._checkedValue=!0,c._uncheckedValue=!1,c._defaultStatus=b.Unchecked,c}return __extends(c,a),Object.defineProperty(c.prototype,"defaultStatus",{get:function(){return this._defaultStatus},set:function(a){this._defaultStatus=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"uncheckedValue",{get:function(){return this._uncheckedValue},set:function(a){this._uncheckedValue=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"checkedValue",{get:function(){return this._checkedValue},set:function(a){this._checkedValue=a},enumerable:!0,configurable:!0}),c.prototype.getDisplayName=function(){return"CheckBoxCellEditor"},c}(a.CellEditor);a.CheckBoxCellEditor=c}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(a){function b(b,c,d,e,f){var g=a.call(this,c,d,e,f)||this;return g.scope=b,g}return __extends(b,a),Object.defineProperty(b.prototype,"value",{get:function(){return this.scope.value},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){var b=this.scope;setTimeout(function(){b.$destroy()}),a.prototype.dispose.call(this)},b}(a.CellEditorController);a.PredefinedCellEditorController=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(a){function b(b){void 0===b&&(b={});var c=a.call(this)||this;return c.acbOptions=b,c}return __extends(b,a),b.prototype.getDisplayName=function(){return"ACBCellEditor"},b}(a.CellEditor);a.ACBCellEditor=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(b){function c(a,c,d,e,f,g,h,i,j){var k=b.call(this,a,c,h,j,g)||this;return k.templateCache=d,k.keys=e,k.compiler=f,k.editor=g,k._acbEditorScope=a,k.handleEnter=!0,k.handleTab=!0,a.value=i,a.acbScopeOptions=g.acbOptions,k._currentText=i,k}return __extends(c,b),c.prototype.processEditCompleted=function(a,c,d){var e=this,f=function(){e._currentText!==e.scope.value&&(e._ignoreScopeValueChanged=!0,e.scope.value=e._currentText,e._ignoreScopeValueChanged=!1),b.prototype.processEditCompleted.call(e,a,c,d)};if(this._acb){if(!this._currentText)return void(this._acbEditorScope&&this._acbEditorScope.acbScopeOptions&&this._acbEditorScope.acbScopeOptions.allowEmptyValue?f():d(a));this._acbEditorScope&&this._acbEditorScope.acbScopeOptions&&this._acbEditorScope.acbScopeOptions.allowFreeText?f():this._acb.checkTextMatch(this._currentText)?f():d(a)}else d(a)},c.prototype.show=function(b,c,d,e,f){var g,h=this,i=this.scope;i.textChanged=function(a){h._currentText=a,h.editor.supportEditOnSelection&&f(a)},i.onWidgetBound=function(f){h._acb=f,h.appendCellEditorToCell(g,b,c);var i=g.find(".inline-editing-acb-input input");if(0===i.length)throw Error("Cannot find editor widget");setTimeout(function(){i.select(),i.focus()},100),a.applyAdditionalClassesToTextBasedEditor(h.currentSourceValue,i),h.completeInitialization(i.get(0),h.keys,d,e)};var j=this.templateCache.get("grids.ui/inlineEditing/acbCellEditor.tpl.html");this.compiler(angular.element(j))(i,function(b){var c=function(a){return null==a||0===a.length};g=angular.element(b),i.$watch("value",function(b,g){h._ignoreScopeValueChanged||c(g)&&c(b)||g===b||(h._currentText=b,h.editor.supportEditOnSelection&&f(b),setTimeout(function(){h._isDisposed||h.processEditCompleted(a.EditCompleteReason.None,d,e)}))})})},c}(a.PredefinedCellEditorController);a.CellACBEditorController=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(b){function c(a,c,d,e,f,g,h,i,j){var k=b.call(this,a,c,h,j,g)||this;return k.templateCache=d,k.keys=e,k.compiler=f,k.editor=g,a.value=i,k}return __extends(c,b),c.prototype.show=function(b,c,d,e,f){var g=this;this.cellEditor.supportEditOnSelection&&this.scope.$watch("value",f);var h=this.templateCache.get("grids.ui/inlineEditing/textCellEditor.tpl.html");this.compiler(angular.element(h))(this.scope,function(f){var h=f.find("[class~='inline-editing-text-input']");g.appendCellEditorToCell(f,b,c),a.applyAdditionalClassesToTextBasedEditor(g.currentSourceValue,h);var i=h.get(0);setTimeout(function(){i.select(),i.focus()},100),g.completeInitialization(i,g.keys,d,e)})},c}(a.PredefinedCellEditorController);a.CellTextEditorController=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(a){function b(b){void 0===b&&(b={});var c=a.call(this)||this;return c.options=b,c}return __extends(b,a),b.prototype.getDisplayName=function(){return"NumericUpDownCellEditor"},b}(a.CellEditor);a.NumericUpDownCellEditor=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){a.tryUntil=function(b,c,d,e){if(void 0===e&&(e=10),e<=0)throw new Error(d);var f=null,g=null;b()?c():f=window.setTimeout(function(){g=a.tryUntil(b,c,d,e-1)},20);var h=function(){g?g():f&&clearTimeout(f)};return h}}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=a.toolkit.NumericUpDownModel,d=function(c){function d(b,d,f,g,h,i,j,k,l,m){var n=c.call(this,b,d,j,!1,i)||this;return n.templateCache=f,n.keys=g,n.compiler=h,n.editor=i,n.tryUntilStopFunction=null,j!==j||null===j||"undefined"==typeof j?b.value=NaN:b.value=Number(j),b.options=i.options,n.nudModel=new e(i.options,l,m),b.nudModel=n.nudModel,b.spinnerPosition=a.toolkit.SpinnerPosition.ButtonOnRight,n}return __extends(d,c),Object.defineProperty(d.prototype,"valueAlreadyParsed",{get:function(){return!0},enumerable:!0,configurable:!0}),d.prototype.show=function(c,d,e,f,g){var h=this,i=this.scope;i.nudModel.rowKey=c,i.nudModel.colKey=d;var j=this.templateCache.get("grids.ui/inlineEditing/nudCellEditor.tpl.html");this.compiler(angular.element(j))(this.scope,function(j){var k,l=angular.element(j),m=function(){return k=l.find("input"),k.length>0},n=function(){h._isDisposed||(h.appendCellEditorToCell(l,c,d),setTimeout(function(){var a=k.get(0);a.select(),a.focus()},20),b.applyAdditionalClassesToTextBasedEditor(h.currentSourceValue,k),h.completeInitialization(k.get(0),h.keys,e,f),h.cellEditor.supportEditOnSelection&&(h.scope.$watch("value",g),i.onCurrentTextChange=function(a){g(a)}))};h.tryUntilStopFunction=a.tables.tryUntil(m,n,"Cannot find editor widget")})},d.prototype.dispose=function(){this.tryUntilStopFunction&&(this.tryUntilStopFunction(),this.tryUntilStopFunction=null),this.nudModel.dispose(),c.prototype.dispose.call(this)},d}(b.PredefinedCellEditorController);b.CellNumericUpDownEditorController=d;var e=function(a){function b(b,c,d){var e=a.call(this)||this;return e.options=b,e.defaultFormatter=c,e.defaultParser=d,e.disposed=!1,e.onlyParseValueOnCommit=!0,e}return __extends(b,a),b.prototype.formatValue=function(b){return this.disposed?"":this.defaultFormatter?this.defaultFormatter(b):a.prototype.formatValue.call(this,b)},b.prototype.parseValue=function(b){if(this.disposed)return Number.NaN;var c;return c=this.defaultParser?this.defaultParser(b):a.prototype.parseValue.call(this,b)},b.prototype.dispose=function(){this.disposed=!0},b}(c)}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(a){function b(b){void 0===b&&(b={});var c=a.call(this)||this;return c.options=b,c}return __extends(b,a),b.prototype.getDisplayName=function(){return"DateTimePickerCellEditor"},b}(a.CellEditor);a.DateTimePickerCellEditor=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){function c(a,b){return!(!a&&!b)&&(!!(!a&&b||a&&!b)||a.getTime&&b.getTime&&a.getTime()!==b.getTime())}var d=function(d){function e(b,c,e,f,g,h,i,j,k,l){var m=d.call(this,b,c,i,j,h)||this;m.templateCache=e,m.keys=f,m.compiler=g,m.editor=h,m.formatValue=k,m.parseValue=l,m.tryUntilStopFunction=null;var n=b;return m.dateTimePickerHelper=a.getService("ionweb.dateTimePickerHelperService"),n.disableFocusOnDatePicker=!0,n.value=i,i instanceof a.IsoTimeStamp?(n.normalizedDate=i.getNormalizeDate(),n.mode=a.toolkit.DateTimePickerMode.DateTime):(n.normalizedDate=i,n.mode=a.toolkit.DateTimePickerMode.Date),n.options=h.options,m}return __extends(e,d),Object.defineProperty(e.prototype,"valueAlreadyParsed",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.processEditCompleted=function(a,c,d){this.pendingReason=null;var e=this.getCurrentInputValue();e!==this.lastProcessedTextDate?this.pendingReason=a:!this.forceCommitOnEnter||a!==b.EditCompleteReason.Enter&&a!==b.EditCompleteReason.Tab?d(a):c(a)},e.prototype.getCurrentInputValue=function(){var a=this.rootelement.find("[data-value]"),b=this.rootelement.find("input");return a&&a.attr("data-value")||b&&b.val()},e.prototype.show=function(a,d,e,f,g){var h=this,i=this.scope;i.onDateUpdated=function(a){var b=h.convertToOriginalFormat(a);return h.formatValue(b)},i.onValueUpdate=function(a){if(i.options.useDateTimeTags&&i.options.dateTimeTags&&i.options.dateTimeTags.length>0){var b=h.dateTimePickerHelper.getTagWithName(a,i.options.dateTimeTags);if(b)return b.date}var c=h.parseValue(a);return c},i.$watch("userInput",function(a){h.editor.supportEditOnSelection&&g(a)});var j=this.templateCache.get("grids.ui/inlineEditing/dtpCellEditor.tpl.html");this.compiler(angular.element(j))(this.scope,function(i){h.rootelement=angular.element(i);var j,k=function(){return j=h.rootelement.find("input"),j.length>0&&""!==h.getCurrentInputValue()},l=function(){if(!h._isDisposed){h.appendCellEditorToCell(h.rootelement,a,d);var i=j.get(0);i.select(),i.focus(),h.completeInitialization(j.get(0),h.keys,e,f),h.lastProcessedTextDate=h.getCurrentInputValue(),h.scope.$watch("normalizedDate",function(a,d){var f=h.lastProcessedTextDate;h.lastProcessedTextDate=h.getCurrentInputValue(),h.editor.supportEditOnSelection&&g(h.lastProcessedTextDate);var i;i=h.dateTimePickerHelper.isDateTimeTag(a)?h.dateTimePickerHelper.dateFromDateTimeTag(a):a,(c(d,i)||h.lastProcessedTextDate!==f)&&(d&&!i||h.scope.$evalAsync(function(){h.scope.value=h.convertToOriginalFormat(i),e(h.pendingReason||b.EditCompleteReason.Enter)}))})}};h.tryUntilStopFunction=b.tryUntil(k,l,"Cannot find editor widget")})},e.prototype.dispose=function(){this.tryUntilStopFunction&&(this.tryUntilStopFunction(),this.tryUntilStopFunction=null),d.prototype.dispose.call(this)},e.prototype.convertToOriginalFormat=function(b){var c;return c=this.dateTimePickerHelper.isDateTimeTag(b)?this.dateTimePickerHelper.dateFromDateTimeTag(b):b,c&&this.scope.value instanceof a.IsoTimeStamp?new a.IsoTimeStamp(c.toISOString()):c},e}(b.PredefinedCellEditorController);b.CellDateTimePickerEditorController=d}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function a(){}return a}();b.CellEditInfo=c;var d=function(){function a(){}return a}();b.DeferredCellEditInfo=d;var e=function(){function c(a,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this;this.gridLogger=a,this.templateCache=c,this.keys=d,this.compiler=e,this.gridScope=f,this.gridx=g,this.editingDataModel=h,this.presentation=i,this.responsiveDm=j,this.getNextCellCallback=k,this.selectionManager=l,this.clipboardService=m,this.gridClipboardService=n,this.notificationService=o,this.preferenceService=p,this.editInfo=null,this.deferredEditInfo=null,this.keyDownCallback=null,this.formatValue=this.formatValue.bind(this),this.keyDownCallback=function(a){if(!q.isEditInProgress){var c=g.body.getActiveCell();if(c){var d=86;a.keyCode===q.keys.F2?q.startEdit(c.rowId,c.colId,b.EditStartReason.F2):a.keyCode===d&&a.ctrlKey&&q.clipboardService.supportGetClipboardContent()&&q.paste()}}},h.valueformatterCallback=this.formatValue,g.bodyNode.addEventListener("keydown",this.keyDownCallback)}return c.prototype.formatValue=function(a,c,d){var e=this.presentation.getPresentedValue(a,c,d);if(e&&"object"==typeof e&&e.getFormatted){var f=e;return f.getFormatted(b.PresentationContext.Export)}return e},Object.defineProperty(c.prototype,"isEditInProgress",{get:function(){return!!this.editInfo},enumerable:!0,configurable:!0}),c.prototype.getSelectedGridRowKeys=function(a,c){var d=[],e=this.selectionManager.getGridSelection();switch(e.type){case b.GridRangeType.Table:break;case b.GridRangeType.Row:break;case b.GridRangeType.Column:break;case b.GridRangeType.Cell:var f=e.args;f.forEach(function(b){b.columnKey===c&&b.rowKey!==a&&d.push(b.rowKey)})}return d},c.prototype.getCellContent=function(a,c){var d=this.editingDataModel.getCellEditor(a,c);if(d){if(d instanceof b.CheckBoxCellEditor){var e=d,f=b.EditingControlVisibility.Enabled;if("function"==typeof d.editingControlVisibility&&(f=e.editingControlVisibility(a,c)),f===b.EditingControlVisibility.Hidden)return null;var g=this.editingDataModel.getDataSet().getValue(a,c),h=e.defaultStatus===b.CheckBoxStatus.Checked?"checked":null;e.checkedValue===g?h="checked":e.uncheckedValue===g&&(h="");var i=f===b.EditingControlVisibility.Disabled?'disabled="disabled"':"",j='<input type="checkbox" class="ion-input inline-editing-checkbox-input" '+h+" "+i+" />";return j}throw new Error("The editor is not supported")}return null},c.predefinedValidationResult=function(a){return{error:null,value:a}},c.predefinedValidationError=function(a){return{error:a,value:null}},c.prototype.attachCheckbox=function(a,b,d){var e=this,f="[colid="+d+"] .inline-editing-checkbox-input",g=b.id,h=$(b.node()).find(f);h&&(h.prop("disabled")||(h.on("change",function(b){if(h.parents("body").length>0){var f=h[0],i=f.checked?a.checkedValue:a.uncheckedValue,j=null;a.supportEditOnSelection&&(j=e.getSelectedGridRowKeys(g,d)),e.editingDataModel.processEnteredValue(g,d,i,j,c.predefinedValidationResult(i))}}),h.on("mousedown",function(b){if(h.parents("body").length>0&&a.supportEditOnSelection){var c=e.getSelectedGridRowKeys(null,d);c.indexOf(g)>=0&&b.stopPropagation()}})))},c.prototype.notifyCellRendered=function(a){var c=a.row,d=a.column.id,e=this.editingDataModel.getColumnEditors(),f=e&&e[d];f instanceof b.CheckBoxCellEditor&&this.attachCheckbox(f,c,d)},c.prototype.notifyRowUnrendered=function(a){this.processRefreshingRow(a,b.EditCompleteReason.RowUnrender)},c.prototype.processRefreshingRow=function(a,b){if("undefined"==typeof a||null===a)this.cancelEdit(b);else{var c=this.editInfo&&this.editInfo.gridRowKey;a===c&&this.cancelEdit(b)}},c.prototype.notifyRowRendered=function(a){var c=this;this.processRefreshingRow(a.id,b.EditCompleteReason.RowRender);var d=this.editingDataModel.getColumnEditors();d&&Object.keys(d).forEach(function(e){var f=d[e];f instanceof b.CheckBoxCellEditor&&c.attachCheckbox(f,a,e)})},c.prototype.processEditedValue=function(a,b,c,d,e){this.hideEditor(e,c),this.editingDataModel.processEndEditOperation(a,b,c,d),this.executeDeferredEditing()},c.prototype.processEditCompleted=function(a){if(this.editInfo){var b=this.editInfo.controller.value,d=b,e=!1,f=null;if(!this.editInfo.controller.valueAlreadyParsed&&"string"==typeof b&&"function"==typeof this.editInfo.presValue.parse)try{d=this.editInfo.presValue.parse(b)}catch(a){e=!0,f=a.message}e?this.processEditedValue(this.editInfo.dmRowKey,this.editInfo.dmColKey,b,c.predefinedValidationError(f),a):this.processEditedValue(this.editInfo.dmRowKey,this.editInfo.dmColKey,b,c.predefinedValidationResult(d),a)}},c.prototype.processEditCancelled=function(a){this.hideEditor(a),this.editingDataModel.cancelEdit(),this.executeDeferredEditing()},c.prototype.cancelDeferredEditing=function(){this.deferredEditInfo&&(clearTimeout(this.deferredEditInfo.timeout),this.gridLogger.logCancelDeferStartEdit(this.deferredEditInfo.editor,this.deferredEditInfo.gridRowKey,this.deferredEditInfo.gridColKey,this.deferredEditInfo.reason),this.deferredEditInfo=null)},c.prototype.deferEditing=function(a,b,c,d,e,f){var g=this;this.gridLogger.logDeferStartEdit(a,d,e,this.editInfo.gridRowKey,this.editInfo.gridColKey,f);var h={gridRowKey:d,gridColKey:e,dmRowKey:b,dmColKey:c,editor:a,reason:f,timeout:null};this.cancelDeferredEditing(),this.deferredEditInfo=h,h.timeout=setTimeout(function(){var a=g.deferredEditInfo;a===h&&(g.deferredEditInfo=null,g.gridLogger.logTimeoutDeferStartEdit(a.editor,a.gridRowKey,a.gridColKey,f))},100)},c.prototype.executeDeferredEditing=function(){if(this.deferredEditInfo){var a=this.deferredEditInfo;this.deferredEditInfo=null,clearTimeout(a.timeout),this.gridLogger.logExecuteDeferStartEdit(a.editor,a.gridRowKey,a.gridColKey,a.reason),this.performStartEdit(a.editor,a.dmRowKey,a.dmColKey,a.gridRowKey,a.gridColKey,a.reason)}},c.prototype.showEditor=function(a,b,c,d,e,f,g){var h=this;this.gridx.body.settingFocusOnCellCallback=function(){return!1},this.gridx.body.processKeyDownCallback=function(){return!1};var i=e.value;this.editingDataModel.startEdit(a,b,i,g),this.editInfo={gridRowKey:c,gridColKey:d,dmRowKey:a,dmColKey:b,controller:e,presValue:f};var j=function(a){h.editingDataModel.updateEnteredValue(a)},k=function(a){h.processEditCompleted(a)},l=function(a){h.processEditCancelled(a)};e.show(this.editInfo.gridRowKey,this.editInfo.gridColKey,k,l,j),this.gridx.bodyNode.classList.add("inlineEditingInProgress")},c.prototype.processCellClick=function(a,c){var d=this.isEditInProgress&&this.editInfo.gridRowKey===a&&this.editInfo.gridColKey===c,e=!d&&this.startEdit(a,c,b.EditStartReason.Click);return e},c.prototype.convertGridCoordsToDmCoords=function(a,b){var c=this.responsiveDm?this.responsiveDm.getEditableColumnKey(b):b;return{dmRowKey:a,dmColKey:c}},c.prototype.performStartEdit=function(a,b,c,d,e,f){var g=this.loadCurrentValue(b,c,a),h=this.createControllerEditor(b,c,a,g),i=null;a.supportEditOnSelection&&(i=this.getSelectedGridRowKeys(d,e)),this.gridLogger.logStartEdit(a,d,e,f),this.showEditor(b,c,d,e,h,g.presValue,i)},c.prototype.startEdit=function(a,c,d){var e=this.convertGridCoordsToDmCoords(a,c),f=this.editInfo&&this.editInfo.controller instanceof b.CustomCellEditorController,g=!1;this.editInfo&&!this.editInfo.controller.isInitialized()&&this.cancelEdit(b.EditCompleteReason.ControllerNotInitialized),f||d!==b.EditStartReason.Click&&d!==b.EditStartReason.F2?d===b.EditStartReason.AutoStart?g=!0:this.cancelEdit(b.EditCompleteReason.EditStarting):this.editInfo&&(g=!0);
var h=!1,i=this.editingDataModel.shouldStartEdit(e.dmRowKey,e.dmColKey);if(i)if(i instanceof b.CheckBoxCellEditor)h=!0;else{var j=this.isEditorSupported(i);j&&(h=!0,g?(this.deferEditing(i,e.dmRowKey,e.dmColKey,a,c,d),this.editInfo.controller.getHtmlElement().blur()):this.performStartEdit(i,e.dmRowKey,e.dmColKey,a,c,d))}return h},c.prototype.pasteContent=function(a){var d=this,e=this.selectionManager.getGridSelection();if(e.type===b.GridRangeType.Cell&&e.args&&a){var f=this.responsiveDm||this.presentation,g=this.gridClipboardService.preparePaste(a,e.args,f);if(g.error)this.gridLogger.logPasteFailed(g.error),this.notificationService.showWarning(b.Strings.Grid_Paste_Error_Title,g.error);else{var h=g.cells,i=g.cells.map(function(a){var b=d.convertGridCoordsToDmCoords(a.rowKey,a.columnKey);return d.editingDataModel.shouldStartEdit(b.dmRowKey,b.dmColKey)}),j=i.some(function(a){return!a});if(j)this.gridLogger.logPasteFailed(g.error),this.notificationService.showWarning(b.Strings.Grid_Paste_Error_Title,b.Strings.Grid_Paste_Error_ReadonlyCells);else{this.gridLogger.logPaste(h,a);for(var k=0;k<h.length;k++){var l=h[k],m=this.convertGridCoordsToDmCoords(l.rowKey,l.columnKey),n=(i[k],this.presentation.getDataSet().getValue(m.dmRowKey,m.dmColKey)),o=l.value,p=o,q=!1,r=null;if(n&&n.parse)try{p=n.parse(o)}catch(a){q=!0,r=a.message}q?this.editingDataModel.processEnteredValue(m.dmRowKey,m.dmColKey,o,null,c.predefinedValidationError(r)):this.editingDataModel.processEnteredValue(m.dmRowKey,m.dmColKey,o,null,c.predefinedValidationResult(p))}}}}},c.prototype.paste=function(){var a=this.clipboardService.getClipboardContent();this.pasteContent(a)},c.prototype.cancelEdit=function(a){this.cancelDeferredEditing(),this.editInfo&&this.processEditCancelled(a)},c.prototype.hideEditor=function(a,c){var d=a!==b.EditCompleteReason.Blur&&a!==b.EditCompleteReason.RowRender&&a!==b.EditCompleteReason.RowUnrender&&a!==b.EditCompleteReason.ControllerNotInitialized&&a!==b.EditCompleteReason.EditStarting&&a!==b.EditCompleteReason.None,e=a===b.EditCompleteReason.Enter?1:0,f=a===b.EditCompleteReason.Tab?1:0,g=this.preferenceService.getValue(b.AUTO_EDIT_PREFERENCE_KEY,b.AUTO_EDIT_PREFERENCE_DEFAULT_VALUE),h=g&&(a===b.EditCompleteReason.Enter||a===b.EditCompleteReason.Tab),i=d&&this.editInfo?this.editInfo.gridRowKey:null,j=d&&this.editInfo?this.editInfo.gridColKey:null;if(this.editInfo&&(this.gridLogger.logEndEdit(this.editInfo.gridRowKey,this.editInfo.gridColKey,a,c,g),this.editInfo.controller.dispose()),this.gridx.body.settingFocusOnCellCallback=null,this.gridx.body.processKeyDownCallback=null,i&&j){var k=this.getNextCellCallback(i,j,e,f);this.selectionManager.setGridSelection(null),this.gridx.body.setActiveCell(k.rowKey,k.columnKey),!h||i===k.rowKey&&j===k.columnKey||this.startEdit(k.rowKey,k.columnKey,b.EditStartReason.AutoStart)}this.editInfo=null,this.gridx.bodyNode.classList.remove("inlineEditingInProgress")},c.prototype.loadCurrentValue=function(c,d,e){var f=this.presentation.getDataSet().getValue(c,d),g=!1;if(e instanceof b.NumericUpDownCellEditor){var h=f.rawValue;if(h!==h||null===h||"undefined"==typeof h)f=this.presentation.getPresentedValue(c,d,NaN),g=!0;else{var i=Number(h);f=this.presentation.getPresentedValue(c,d,i),g=!1}}else if(e instanceof b.DateTimePickerCellEditor){var j=f.rawValue;j===j&&(j instanceof Date||j instanceof a.IsoTimeStamp)||(g=!0,j=new Date,f=this.presentation.getPresentedValue(c,d,j))}else g=null===f.rawValue||"undefined"==typeof f.rawValue;var k={presValue:f,isUnderlyingValueNull:g};return k},c.prototype.isEditorSupported=function(a){if(a instanceof b.CustomCellEditor){if(a.customControlOptions)return!0}else{if(a instanceof b.TextCellEditor)return!0;if(a instanceof b.ACBCellEditor)return!0;if(a instanceof b.NumericUpDownCellEditor)return!0;if(a instanceof b.DateTimePickerCellEditor)return!0}return!1},c.prototype.createControllerEditor=function(a,d,e,f){var g=this,h=f.presValue&&f.presValue.getFormatted(b.PresentationContext.Export),i=!1,j=function(e){if(i)return e;if(f.presValue&&f.presValue.parse)try{var h=f.presValue.parse(e);return h}catch(f){i=!0,g.processEditedValue(a,d,e,c.predefinedValidationError(f.message),b.EditCompleteReason.None)}return e},k=function(b){return g.formatValue(a,d,b)};if(e instanceof b.CustomCellEditor){if(e.customControlOptions)return new b.CustomCellEditorController(this.gridx,this.keys,e,f.presValue.rawValue,!1,f.presValue)}else{if(e instanceof b.TextCellEditor)return new b.CellTextEditorController(this.gridScope.$new(!0),this.gridx,this.templateCache,this.keys,this.compiler,e,f.presValue.rawValue,h,!1);if(e instanceof b.ACBCellEditor)return new b.CellACBEditorController(this.gridScope.$new(!0),this.gridx,this.templateCache,this.keys,this.compiler,e,f.presValue.rawValue,h,!1);if(e instanceof b.NumericUpDownCellEditor)return new b.CellNumericUpDownEditorController(this.gridScope.$new(!0),this.gridx,this.templateCache,this.keys,this.compiler,e,f.isUnderlyingValueNull?NaN:f.presValue.rawValue,!1,k,j);if(e instanceof b.DateTimePickerCellEditor)return new b.CellDateTimePickerEditorController(this.gridScope.$new(!0),this.gridx,this.templateCache,this.keys,this.compiler,e,f.presValue.rawValue,f.isUnderlyingValueNull,k,j)}return null},c.prototype.processEnteredValue=function(a,b,d){var e=this.convertGridCoordsToDmCoords(a,b),f=this.editingDataModel.shouldStartEdit(e.dmRowKey,e.dmColKey),g=null;f&&f.supportEditOnSelection&&(g=this.getSelectedGridRowKeys(a,b)),this.editingDataModel.processEnteredValue(e.dmRowKey,e.dmColKey,d,g,c.predefinedValidationResult(d))},c.prototype.commitCell=function(a,b){var c=this.convertGridCoordsToDmCoords(a,b);return this.editingDataModel.commitCell(c.dmRowKey,c.dmColKey)},c.prototype.commitCells=function(a){var b=this,c=a?a.map(function(a){var c=b.convertGridCoordsToDmCoords(a.rowKey,a.columnKey);return{rowKey:c.dmRowKey,columnKey:c.dmColKey}}):null;return this.editingDataModel.commitCells(c)},c.prototype.clearEditErrors=function(){this.editingDataModel.clearErrors()},c.prototype.getEditedCellsByStatus=function(a){return this.editingDataModel.getEditedCellsByStatus(a)},c.prototype.isLocked=function(a,c){return this.getVisibleCellStatus(a,c)===b.EditCellStatus.EditInProgress},c.prototype.getEditedCellStatus=function(a,b){var c=this.convertGridCoordsToDmCoords(a,b);return this.editingDataModel.getEditedCellStatus(c.dmRowKey,c.dmColKey)},c.prototype.getClassesForEditOnSelectionCell=function(){return this.editInfo&&this.editInfo.controller?this.editInfo.controller.getClassesForEditOnSelectionCell():[]},c.prototype.getVisibleCellStatus=function(a,b){var c=this.convertGridCoordsToDmCoords(a,b);return this.editingDataModel.getVisibleCellStatus(c.dmRowKey,c.dmColKey)},c.prototype.dispose=function(){this.deferredEditInfo&&(clearTimeout(this.deferredEditInfo.timeout),this.deferredEditInfo=null),this.gridx.bodyNode.removeEventListener("keydown",this.keyDownCallback),this.hideEditor(b.EditCompleteReason.None)},c}();b.EditingDriver=e}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a.supportGetClipboardContent()||window.document.addEventListener("paste",function(b){var c=window.document.activeElement,d=b.clipboardData.getData("text");if(d){var e=a.tryPaste(c,d);e&&b.stopPropagation()}},!0),a}return __extends(c,b),c.prototype.supportGetClipboardContent=function(){return!!window.clipboardData},c.prototype.tryPaste=function(a,b){var c=!1;if(a){var d=$(a).parents("div.gridx[role='grid']");if(d&&d[0]){var e=$(d[0]);if(e&&e.scope&&"function"==typeof e.scope){var f=e.scope();f&&f.options&&f.options.internalInvokePaste&&"function"==typeof f.options.internalInvokePaste&&(f.options.internalInvokePaste(b),c=!0)}}}return c},c.prototype.copyToClipboardUserAction=function(b,c,d,e,f,g){d.columnSeparator=a.ColumnSeparatorChar.Tab;var h=new a.DataExporter(b,d,e.outlineModeConfiguration);f.logCopyToClipboard(c,d),g.copyToClipboard(h.exportToText(c))},c}(a.GridClipboardServiceBase);a.GridClipboardService=b,angular.module("ionwebGrids").service("ionweb.gridClipboardService",[function(){return new b}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function a(){this.hitItem={rowKey:null,colKey:null,columnKey:null,isRowHeader:!1,isColumnHeader:!1,isCell:!1,button:b.MouseButton.Left}}return a.createCell=function(b,c){var d=new a;return d.hitItem.isCell=d.isColumnSelection=d.isRowSelection=!0,d.hitItem.colKey=d.hitItem.columnKey=c,d.hitItem.rowKey=b,d},a.createRowHeader=function(b,c){var d=new a;return d.hitItem.isRowHeader=d.isRowSelection=!0,d.headerLvl=b,d.hitItem.rowKey=c,d},a.createColumnHeader=function(b){var c=new a;return c.hitItem.isColumnHeader=c.isColumnSelection=!0,c.hitItem.colKey=c.hitItem.columnKey=b,c},a.createNone=function(){return new a},a}(),e=function(){function e(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){var y=this;this.logger=a,this.element=b,this.dataModel=d,this.grid=e,this.gridObject=f,this.scope=g,this.clipboardService=h,this.gridClipboardService=i,this.fileExportService=j,this.selectionManager=k,this.sortingManager=l,this.optionsDialogManager=m,this.headerPanelManager=n,this.conditionalFormattingManager=o,this.sidePanelManager=p,this.onContextMenuCreated=q,this.fitContentManager=r,this.menuService=s,this.autoHandleContextMenu=t,this.groupingOptionManager=u,this.contextMenu=null,this.closeContextMenu=function(){y.contextMenu&&(y.contextMenu.close(),y.contextMenu=null)},this.alreadyDestroyed=!1,this.contextMenuOptions={disableAutoPosition:!0,onCreate:function(a){y.scope.contextMenu&&(y.contextMenuOptions.onDestroy(),y.alreadyDestroyed=!0),y.contextMenu=a,y.assignFormattingOptionsWatch(),y.scope.contextMenu={rowKey:y.contextItem.hitItem.rowKey,columnKey:y.contextItem.hitItem.columnKey},y.onContextMenuCreated&&y.onContextMenuCreated()},onDestroy:function(){return y.alreadyDestroyed?void(y.alreadyDestroyed=!1):(y.contextMenu&&(y.contextMenu=null),y.scope.contextMenu=void 0,void y.unRegisterFormattingOptionsWatch())}},this.autoHandleContextMenu&&s.attachElement($(this.element),function(a){return y.handleContextMenu(a)},null,this.contextMenuOptions),f.onRowScroll.add(this.closeContextMenu),this.grid.connect(this.grid,"onHScroll",this.closeContextMenu),this.scope.closeGridContextMenu=function(){y.closeContextMenu()},v&&(this.gridCtxTemplateStorageAdapter=new c.CtxTemplateStorageAdapter(v,w,x))}return e.prototype.assignFormattingOptionsWatch=function(){var a=this;this.scope.$evalAsync(function(){return a.removeFormattingOptionsWatch=a.registerFormattingOptionsWatch()})},e.prototype.unRegisterFormattingOptionsWatch=function(){this.removeFormattingOptionsWatch&&(this.removeFormattingOptionsWatch(),this.removeFormattingOptionsWatch=null)},e.prototype.registerFormattingOptionsWatch=function(){var c=this;return this.scope.$watch("options.formattingOptions",function(d,e){if(d!==e){var f=c.scope.data.getAs(b.PresentationDataModelAdapter);if(f){var g=!1;void 0==d&&(c.removeFormattingOptionsWatch&&(c.removeFormattingOptionsWatch(),c.removeFormattingOptionsWatch=null),g=!0);var h=b.ResponsiveDataModel.explodeSelection(c.scope.data,c.selectionManager.getGridSelection()).explodedSelection,i=f.__getColumnFormattingOptions(h),j=c.contextItem.hitItem.columnKey&&(c.scope.options.gridSelectionType===b.GridSelectionType.Row||c.scope.options.gridSelectionType===b.GridSelectionType.None);if(j?f.setColumnFormattingOptionsBasedOnActiveCell(c.contextItem.hitItem.columnKey,c.scope.options.formattingOptions):h.type===b.GridRangeType.Table||h.type===b.GridRangeType.None?f.setUserTableFormattingOptions(c.scope.options.formattingOptions):a.equals(i,c.scope.options.formattingOptions)||f.__setColumnFormattingOptions(h,c.scope.options.formattingOptions),g){var k=j?f.getColumnFormattingOptionsBasedOnActiveCell(c.contextItem.hitItem.columnKey):f.__getColumnFormattingOptions(h);a.equals(k,{})?c.scope.options.formattingOptions=f.tableAppliedFormattingOptions():c.scope.options.formattingOptions=k,c.removeFormattingOptionsWatch=c.registerFormattingOptionsWatch()}}}},!0)},e.prototype.open=function(b,c,d){if(!this.autoHandleContextMenu){this.closeContextMenu();var e=this.handleContextMenu(b),f=a.extend({},[this.contextMenuOptions]);f.position={left:c,top:d},this.menuService.openContextMenu(e,this.element,f)}},e.prototype.handleContextMenu=function(c){var d=this,e=[],f=this.hitTest(c);this.contextItem=f;var g=this.selectionManager.getGridSelection();if(f.hitItem.isColumnHeader){var h=g.args;g.type===b.GridRangeType.Column&&h.indexOf(f.hitItem.columnKey)>=0||(this.selectionManager.setGridSelection(b.SelectionHelper.columnsSelection(this.dataModel,[f.hitItem.columnKey])),g=this.selectionManager.getGridSelection())}if(f.hitItem.isRowHeader){var i=g.args;!f.hitItem.rowKey||g.type===b.GridRangeType.Row&&i.indexOf(f.hitItem.rowKey)>=0||(this.selectionManager.setGridSelection(b.SelectionHelper.rowsSelection(this.dataModel,[f.hitItem.rowKey])),g=this.selectionManager.getGridSelection())}this.gridObject.inEditMode()&&f.hitItem.isColumnHeader&&this.scope.options.headerPanels&&this.scope.options.headerPanels[f.hitItem.columnKey]&&e.push({text:b.Strings.Grid_Menu_ColumnOptions,action:function(){d.headerPanelManager.show(f.hitItem.columnKey)}}),this.gridObject.inEditMode()&&"number"==typeof f.headerLvl&&f.headerLvl>-1&&f.hitItem.isRowHeader&&!f.hitItem.rowKey&&this.scope.options.rowLevelHeaderPanels&&this.scope.options.rowLevelHeaderPanels[f.headerLvl]&&e.push({text:b.Strings.Grid_Menu_RowLevelOptions,action:function(){d.headerPanelManager.show(a.tables.ROW_HEADER_COLUMN_ID_PREFIX+f.headerLvl)}});var j=[];if("undefined"!=typeof this.scope.options.extendGridContextMenu){var k=this.scope.options.extendGridContextMenu(c,f.hitItem);Array.isArray(k)?j=k:k.position===b.GridContextMenuPosition.Top?e=e.concat(k.entries):j=k.entries}var l=f.hitItem.isCell?this.selectionManager.isCellInSelection(g,f.hitItem.rowKey,f.hitItem.columnKey):!!f.isColumnSelection&&this.selectionManager.isColumnInSelection(g,f.hitItem.columnKey),m=f.isColumnSelection?[f.hitItem.columnKey]:f.hitItem.isRowHeader?[f.headerLvl]:[];if(l&&!f.hitItem.isRowHeader){var n=(g.type===b.GridRangeType.Cell||g.type===b.GridRangeType.Column)&&1===g.args.length;n||(m=this.getSelectedColumns(g))}var o=this.scope.options.configOptions,p=b.selection.Manager.isContiguous(g,this.dataModel),q=this.sortingManager.getSortRowAxis(),r=[],s=m.map(function(a){return d.sortingManager.getColumnSortingKeyForKeyOrLevel(a)});if(q){var t=!0;this.sortingManager.getSortingOperations(s,q).forEach(function(c){c?(r.push({text:c.text,disabled:!c.available,action:function(){var a=d.sortingManager.setSortingOperation(s,c);if(c.action==b.sorting.SortAction.None)d.logger.logSortRemove(b.AxisType.Row,s[0]);else if(a.length){var e=a[a.length-1];d.logger.logSortAdded(b.AxisType.Row,s[0],!0,e.direction===b.SortDirection.Ascending,b.SortType[e.sortType])}else d.logger.logSortReset(b.AxisType.Row);d.sortingManager.processSorting(a,q)}}),c.available&&(t=!1)):r.push({menuType:a.MenuItemType.Divider})}),e.push({text:b.Strings.Grid_Menu_Sorting,menuType:a.MenuItemType.Submenu,subMenu:r,disabled:t})}var u={text:b.Strings.Grid_Menu_Copy,menuType:a.MenuItemType.Submenu,subMenu:[{text:b.Strings.Grid_Menu_CopyExport_All,action:function(){d.copyToClipboard(d.selectionManager.getAllSelection(),!0)},needDirectEvent:!0},{text:b.Strings.Grid_Menu_CopyExport_Selection,disabled:!p,action:function(){d.copyToClipboard(g,!1)},needDirectEvent:!0},{text:b.Strings.Grid_Menu_CopyExport_SelectionWHeaders,disabled:!p,action:function(){d.copyToClipboard(g,!0)},needDirectEvent:!0}]},v=this.dataModel.getAs(b.PresentationDataModelAdapter);if(v){var w=a.getService("ionweb.columnFmtClipboardService");o&&o.disableCopy||(u.subMenu.push({text:b.Strings.Grid_Menu_Copy_Column_Style,action:function(){var a=d.dataModel.getAs(b.PresentationDataModelAdapter);a&&w.copyColumnFormatting(a,b.SelectionHelper.extendColumns(a,d.selectionManager.getGridSelection()))}}),e.push(u)),o&&o.disablePasteColumnFormat||e.push({text:b.Strings.Grid_Menu_Paste_Column_Style,disabled:!w.isPasteAvailable(),action:function(){v&&w.pasteColumnFormatting(v,b.SelectionHelper.extendColumns(v,d.selectionManager.getGridSelection()))}})}if(this.clipboardService.supportGetClipboardContent()&&this.dataModel.getAs(b.EditingDataModel)&&e.push({text:b.Strings.Grid_Menu_Paste,menuType:a.MenuItemType.General,action:function(){d.paste()}}),this.groupingOptionManager){var x=[{text:b.Strings.Grid_Menu_Collapse_All,action:function(){d.groupingOptionManager.onCollapseAll()}},{menuType:a.MenuItemType.Divider}],y=this.groupingOptionManager.levels;y&&(y.forEach(function(a,b){x.push({text:a,action:function(){d.groupingOptionManager.onExpandToLevel(b)}})}),x.push({menuType:a.MenuItemType.Divider}),y.length>1&&x.push({text:b.Strings.Grid_Menu_Expand_Last_Level,action:function(){d.groupingOptionManager.onExpandToLastLevel()}})),x.push({text:b.Strings.Grid_Menu_Expand_Details,action:function(){d.groupingOptionManager.onExpandToDetails()}}),e.push({text:b.Strings.Grid_Row_Header_Groups,menuType:a.MenuItemType.Submenu,subMenu:x})}o&&o.disableExport||e.push({text:b.Strings.Grid_Menu_Export,menuType:a.MenuItemType.Submenu,subMenu:[{text:b.Strings.Grid_Menu_CopyExport_All,action:function(){d.exportToCsv(d.selectionManager.getAllSelection())}},{text:b.Strings.Grid_Menu_CopyExport_Selection,disabled:!p,action:function(){d.exportToCsv(g)}}]}),r=[],o&&o.disableColumnFit||(r.push({text:b.Strings.Grid_Menu_Fit_Content_All,action:function(){f.hitItem.isRowHeader?d.fitContentManager.fitAllHeaders(!0):d.fitContentManager.fitAllColumns(!0)}}),r.push({text:b.Strings.Grid_Menu_Fit_Content_Selected,action:function(){m.length&&"string"==typeof m[0]?d.fitContentManager.fitColumns(m,!0):m.forEach(function(a){d.fitContentManager.fitHeader(a,!0)})}}),r.push({text:b.Strings.Grid_Menu_Fit_Content_And_Header_All,action:function(){f.hitItem.isRowHeader?d.fitContentManager.fitAllHeaders():d.fitContentManager.fitAllColumns()}}),r.push({text:b.Strings.Grid_Menu_Fit_Content_And_Header_Selected,action:function(){m.length&&"string"==typeof m[0]?d.fitContentManager.fitColumns(m):m.forEach(function(a){d.fitContentManager.fitHeader(a)})}}));var z=this.grid.columnLockService;if(this.scope.options.enableColumnFreezing&&z.isAvailable()&&!f.hitItem.isRowHeader&&m&&m.length>0){var A=-1;if(m.forEach(function(a){if("string"==typeof a){var b=a;if(d.dataModel.getColumnAxis().contains(b)){var c=d.dataModel.getColumnAxis().getSlice(b),e=c.index();e>A&&(A=e)}}}),A>=0){r.length>0&&r.push({menuType:a.MenuItemType.Divider});var B=0===this.grid.columnLockService.getLockedColumns().length,C=this.grid.columnLockService.getLockedColumns().length>A;r.push({text:b.Strings.Grid_Menu_Freeze,disabled:C,action:function(){d.logger.logger.low(b.LogKeys.Freeezing.Key,{Id:d.scope.options.logId,SourceDataModel:d.dataModel.getLogId(),Action:b.LogKeys.Freeezing.Freeze,Count:A}),d.grid.columnLockService.lock(A+1)}}),r.push({text:b.Strings.Grid_Menu_Unfreeze,disabled:B,action:function(){d.logger.logger.low(b.LogKeys.Freeezing.Key,{Id:d.scope.options.logId,SourceDataModel:d.dataModel.getLogId(),Action:b.LogKeys.Freeezing.Unfreeze}),d.grid.columnLockService.unlock()}})}}var D=this.scope.options&&this.scope.options.outlineModeConfiguration&&this.scope.options.outlineModeConfiguration.columnLevelDescriptors;!f.hitItem.isRowHeader&&D&&D.length>0&&(r.push({menuType:a.MenuItemType.Divider,text:b.Strings.Grid_Menu_Sorting}),this.addColumnSortingSubMenu(r,D)),r.length>0&&e.push({text:f.hitItem.isRowHeader?b.Strings.Grid_Menu_Headers:b.Strings.Grid_Menu_Columns,menuType:a.MenuItemType.Submenu,subMenu:r}),f.hitItem.isCell&&!l&&this.selectionManager.setGridSelection({type:b.GridRangeType.Cell,args:[{rowKey:f.hitItem.rowKey,colKey:f.hitItem.colKey,columnKey:f.hitItem.columnKey}]}),this.scope.fmtCtrlOptions=a.extend({},[this.scope.options.gridFormattingControlOptions]),!this.scope.options.disableConditionalFormatting&&this.conditionalFormattingManager.isPanelAvailable(g)&&(this.scope.fmtCtrlOptions.onShowConditionalFormattingClicked=function(){d.closeContextMenu(),d.conditionalFormattingManager.showPanel(g)}),this.scope.options.toolbarOptions.enableFormatting&&this.initFomattingOption()&&(this.scope.fmtCtrlOptions.showScaleFactor||this.scope.fmtCtrlOptions.showDateFormat||this.scope.fmtCtrlOptions.showDecimalPlaces||this.scope.fmtCtrlOptions.showNegativeFormat||this.scope.fmtCtrlOptions.onShowConditionalFormattingClicked)&&e.push({text:b.Strings.Grid_FormattingOption_Title_Formatting,menuType:a.MenuItemType.Submenu,subMenu:[{menuType:a.MenuItemType.Custom,template:'<grid-formatting-control class="cellformattingoption-popup-container" ng-model="options.formattingOptions" options="fmtCtrlOptions"></grid-formatting-control>',scope:this.scope}]}),this.gridCtxTemplateStorageAdapter&&e.push(this.gridCtxTemplateStorageAdapter.getTemplateMenus()),o&&o.disableSelectAll||e.push({text:b.Strings.Grid_Menu_Grid_Select_All_Selection,action:function(){d.grid.select.table&&!d.grid.select.table.isSelected()&&d.grid.select.table.select()}}),o&&o.disablePrint||e.push({text:b.Strings.Grid_Menu_Print,action:function(){d.scope.options.printingOptions.print()}}),this.gridObject.supportInlineEditing()&&e.push({text:b.Strings.Grid_Menu_ClearErrors,disabled:0===this.gridObject.getEditedCellsByStatus(b.EditCellStatus.Error).length,action:function(){d.gridObject.clearEditErrors()}}),e=e.concat(j);var E=!this.scope.options.toolbarOptions||this.scope.options.toolbarOptions.enableAppearanceOptions!==!1||this.optionsDialogManager.shouldShowGridFormattingOptions()||this.scope.columnSelectorEnabled();return!E||o&&o.disableOptionsMenu||(e.push({menuType:a.MenuItemType.Divider}),e.push({text:b.Strings.Grid_Menu_Options,action:function(){return d.optionsDialogManager.show()}})),e},e.prototype.addColumnSortingSubMenu=function(c,d){var e=this,f=this.sortingManager.getSortColumnAxis();f&&(d.forEach(function(g){var h=d.indexOf(g)+1,i=e.sortingManager.getCurrentColumnSorting(h),j=[];e.sortingManager.getColumnSortingOperations(f,h).forEach(function(c){c?j.push({text:c.text,disabled:!c.available,action:function(){var a=e.sortingManager.setColumnSortingOperation(c,[h]);if(c.action==b.sorting.SortAction.None)e.logger.logSortRemove(b.AxisType.Column,h);else if(a.length){var d=a[a.length-1];e.logger.logSortAdded(b.AxisType.Column,h,!0,d.direction===b.SortDirection.Ascending,b.SortType[d.sortType])}f.setSortCriteria(e.sortingManager.convertSortedColumnForColumnAxis(a))}}):j.push({menuType:a.MenuItemType.Divider})}),c.push({text:g.alias||g.caption,menuType:a.MenuItemType.Submenu,subMenu:j,icon:i?i.direction==b.SortDirection.Ascending?"triangleUp":"triangleDown":null})}),this.sortingManager.getColumnSortingOperations(f).forEach(function(a){c.push({text:a.text,disabled:!a.available,action:function(){var c=e.sortingManager.setColumnSortingOperation(a);e.logger.logSortReset(b.AxisType.Column),f.setSortCriteria(e.sortingManager.convertSortedColumnForColumnAxis(c))}})}))},e.prototype.dispose=function(){this.gridObject.onRowScroll.remove(this.closeContextMenu),this.closeContextMenu(),this.menuService.detachElement($(this.element))},e.prototype.hitTest=function(a){for(var c=null,e=null;a.parentElement;){var f=a.getAttribute("role");if("rowheader"===f){var g=a.getAttribute("rowHeaderColumn");return null===g&&(g="-1"),d.createRowHeader(Number(g),a.getAttribute("nodeKey"))}if("columnheader"===f){var h=b.toKeyOrLevel(a.getAttribute("colId"));return"number"==typeof h?d.createRowHeader(h):d.createColumnHeader(h)}if(a.getAttribute("colId")&&(e=a.getAttribute("colId")),a.getAttribute("rowId")&&(c=a.getAttribute("rowId")),c&&e)return d.createCell(c,e);a=a.parentElement}return d.createNone()},e.prototype.getSelectedColumns=function(a){var c=this.dataModel.getColumnAxis(),d=[];switch(a.type){case b.GridRangeType.Table:case b.GridRangeType.Row:d=c.getSliceRange(0,c.length()).map(function(a){return a.key()});break;case b.GridRangeType.Column:d=a.args;break;case b.GridRangeType.Cell:var e={};a.args.forEach(function(a){e[a.columnKey]=!0}),d=Object.getOwnPropertyNames(e)}return d},e.prototype.copyToClipboard=function(a,b){var c={excludeRowHeader:!b||!this.scope.options.showRowHeaders,excludeColumnHeader:!b||!this.scope.options.showColumnHeaders};this.gridClipboardService.copyToClipboardUserAction(this.dataModel,a,c,this.scope.options,this.logger,this.clipboardService)},e.prototype.paste=function(){this.gridObject.paste()},e.prototype.exportToCsv=function(a){this.gridObject.exportToFileCsv(a)},e.prototype.initFomattingOption=function(){var a=this.scope.data.getAs(b.PresentationDataModelAdapter);if(!a)return!1;var c=b.ResponsiveDataModel.explodeSelection(this.dataModel,this.selectionManager.getGridSelection()).explodedSelection;return this.scope.options.gridSelectionType===b.GridSelectionType.Row||this.scope.options.gridSelectionType===b.GridSelectionType.None?this.scope.options.formattingOptions=a.getColumnFormattingOptionsBasedOnActiveCell(this.contextItem.hitItem.columnKey):c.type===b.GridRangeType.Column||c.type===b.GridRangeType.Cell?this.scope.options.formattingOptions=a.__getColumnFormattingOptions(c):this.scope.options.formattingOptions=a.tableAppliedFormattingOptions(),!0},e}();c.GridContextMenu=e}(c=b.menu||(b.menu={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(a,b,c){var d=this;this.gridScopeOptions=a,this.groupingDataModel=b,this.initHandler=c,this.unsub=[],this.updateConfiguration(),this.unsub.push(b.groupingChanged.add(function(){d.updateConfiguration()}))}return c.prototype.updateConfiguration=function(){var c=this,d=this.groupingDataModel.getGroupedColumns();this.gridScopeOptions.outlineModeConfiguration||(this.gridScopeOptions.outlineModeConfiguration={rowLevelDescriptors:[]});var e=this.gridScopeOptions.outlineModeConfiguration.rowLevelDescriptors,f=function(b){if(c.groupingDataModel.getColumnAxis().contains(b)){var d=c.groupingDataModel.getColumnAxis().getSlice(b);return{caption:d.displayName()||b,alias:d.alias||null}}var e=c.groupingDataModel.getColumnAxis().options.getAvailableSlices(),f=a.firstOrDefault(e,function(a){return a.nodeKey===b});return f?{caption:f.displayName()||b,alias:f.alias||null}:{caption:b,alias:b}},g=d.map(function(a){var b=f(a.key);return{alias:b.alias,referenceKey:a.key,caption:b.caption}}),h={referenceKey:null,caption:this.groupingDataModel.getRowAxis().options.getTreeNode(b.GroupingDataModel.GRAND_TOTAL_KEY).displayName()},i=[h].concat(g);this.gridScopeOptions.outlineModeConfiguration.rowLevelDescriptors=i;var j=!this.compareDescriptors(e,i);j&&this.initHandler()},c.prototype.compareDescriptors=function(a,b){if(!a&&!b)return!0;if(a&&!b)return!1;if(!a&&b)return!1;if(0===a.length&&0===b.length)return!0;if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++){var d=a[c],e=b[c];if(d.referenceKey!==e.referenceKey)return!1}return!0},c.prototype.dispose=function(){this.unsub.forEach(function(a){return a()})},c}();b.OutlineConfigurationManager=c}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(a,b,c){this.dataModel=b,this.scope=c}return c.prototype.fitAllColumns=function(a){var b=this.dataModel.getColumnAxis(),c=b.getSliceRange(0,b.length()),d=[];c.forEach(function(a){return d.push(a.key())}),this.fitColumns(d,a)},c.prototype.fitAllHeaders=function(a){var b=1,c=0;this.scope.options.outlineModeConfiguration&&(b=this.scope.options.outlineModeConfiguration.rowLevelDescriptors.length,this.scope.options.outlineModeConfiguration.compact!==!1&&(c=b>1?1:0));for(var d=this.grid.rowHeader.length(),e=c;e<=d;e++)this.fitHeader(e,a)},c.prototype.fitHeader=function(a,b){this.grid.rowHeader.fitHeader(a,b)},c.prototype.fitColumn=function(a,c){var d=this,e=0;if(!c){var f=this.grid.header.getHeaderNode(a),g=$(f),h=f.children.length&&f.children[0],i=0,j=g.find(".gridxSortNode"),k=g.find(".headerRegionsContainer");k.length&&(i=2*k[0].clientWidth||0),e=(j.length?b.getMaxWidth(j[0],[j[0].innerText]):0)+i;var l=$(h);e+=l.innerWidth()-l.width(),e+=l.outerWidth()-l.innerWidth(),e+=g.outerWidth()-g.innerWidth()}var m=this.dataModel.getRowAxis(),n=!1,o=this.grid.body.getCellNode({rowId:m.getKey(0),colId:a});if(!o){if(!this.firstColumn){var p=$(this.grid.bodyNode).find("[colid]");p.length&&(this.firstColumn=p[0],setTimeout(function(){d.firstColumn=null}))}if(!this.firstColumn)return null;o=this.firstColumn}if(this.grid.bodyNode.children&&this.grid.bodyNode.children.length)for(var q=this.grid.bodyNode.children[0].getAttribute("rowindex"),r=this.grid.bodyNode.children[this.grid.bodyNode.children.length-1].getAttribute("rowindex"),s=m.getSliceRange(Number(q),Number(r)+1),t=0,u=0;u<s.length;u++){var v=b.getCellPresentation(this.dataModel.getDataSet().getValue(s[u].key(),a)).getFormatted(b.PresentationContext.Rendering);if(v&&v.length&&(t++,/<[a-z][\s\S]*>/i.test(v)&&(n=!0),2==t))break}if(n)for(var w=b.getAdditionalSpace(o),u=0;u<s.length;u++){var x=this.grid.body.getCellNode({rowId:s[u].key(),colId:a}),y=x.children&&x.children.length?x.children[0]:null;if(!y||!y.children.length){n=!1;break}e=Math.max(e,y.children[0].offsetWidth+w)}if(!n&&o&&$(o).find(".gridxCellWidget").length>0)return"customWidth";if(!n){var z=m.getSliceRange(0,m.length()).map(function(c){return b.getCellPresentation(d.dataModel.getDataSet().getValue(c.key(),a)).getFormatted(b.PresentationContext.Rendering)});e=Math.max(e,b.getMaxWidth(o.children[0]||o,z))}return e=Math.ceil(e)},c.prototype.fitColumns=function(c,d){function e(a,c,d){var f=[];return a.children().length&&!c.options.isNodeSummaryVisible(a.key())&&(c.options.getExpandState(a.key())!==b.ExpandState.Collapsed||c.options.isNodeSummaryVisible(a.key()))||(f.push.apply(f,c.getNodeMeasures(a.key())),d)?(a.children().forEach(function(b){f.push.apply(f,e(b,c,a))}),f):f}var f=this,g={};if(c.forEach(function(a){var b=f.fitColumn(a,d);null!==b&&(g[a]=b)}),!d){var h=this.dataModel.getColumnAxis().getAs(b.PivotAxis);if(!(h instanceof b.FlatAxis)){var i={};c.forEach(function(a){for(var b=f.grid.header.getHeaderNode(a);b=f.grid.header._getUpNode(b);)if(b.innerText.length){var c=h.getNode(b.getAttribute("groupid"));c&&(i[c.level()]||(i[c.level()]=[]),i[c.level()].indexOf(c.key())===-1&&i[c.level()].push(c.key()))}});var j=Object.keys(i).sort(function(a,b){return Number(b)-Number(a)});j.forEach(function(d){i[d].forEach(function(d){var i=h.nodeKeyMap[d],j=e(i,h);j=j.filter(function(a){if(h.sliceMeasureKeys.indexOf(a)!==-1)return!0});var k=f.grid.header.getGroupHeaderNode(d),l=0;if(k){var m=$(k),n=m.find(".gridxSortNode");n.length&&(l=b.getMaxWidth(n[0],[n[0].innerText]));var o=$(k).find(".expandButton");o.length&&(l+=o[0].clientWidth),l+=m.innerWidth()-m.width(),l+=m.outerWidth()-m.innerWidth(),l+=m.outerWidth()-m.innerWidth()}var p=0,q=[];j.forEach(function(b){c.indexOf(b.key)>=0&&"number"==typeof g[b.key]?(p+=g[b.key],q.push(b.key)):p+=f.grid.columnResizer.getCachedColumnWidth(b.key)||a.tables.getDefaultWidth(b.key,f.scope.options)}),l>p&&q.forEach(function(a){"number"==typeof g[a]&&(g[a]+=Math.ceil(l-p)/q.length)})})})}}this.grid.columnResizer.setWidths(g)},c.prototype.dispose=function(){},c.prototype.init=function(a){this.grid=a},c}();c.Manager=d}(c=b.fitcontent||(b.fitcontent={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){}return a}();a.HeaderContentDescriptor=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(){}return a.prototype.dispose=function(){},a.prototype.generateElement=function(){return null},a}();a.HeaderContentController=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){
var b;!function(b){var c=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;return c._value=null,c._disabled=!1,c.valueChanged=new a.Event,c.disableChanged=new a.Event,c}return __extends(c,b),Object.defineProperty(c.prototype,"value",{get:function(){return this._value},set:function(a){this._value!==a&&(this._value=a,this.valueChanged.raise(null,null))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"disabled",{get:function(){return this._disabled},set:function(a){this._disabled!==a&&(this._disabled=a,this.disableChanged.raise(null,null))},enumerable:!0,configurable:!0}),c}(b.HeaderContentDescriptor);b.CheckBoxHeaderContentDescriptor=c}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(a){function b(b,c,d){var e=a.call(this)||this;return e.grid=b,e.headerContent=c,e.colId=d,e.subs=[],e.checkbox=null,e.updateCheckboxValue=function(){e.checkbox&&e.checkbox.checked!==e.headerContent.value&&(e.checkbox.checked=e.headerContent.value)},e.updateContentValue=function(){e.checkbox&&e.headerContent.value!==e.checkbox.checked&&(e.headerContent.value=e.checkbox.checked)},e.updateDisability=function(){e.checkbox&&(e.checkbox.disabled=e.headerContent.disabled)},e.checkedCallback=function(a){a.stopPropagation(),e.updateContentValue()},e}return __extends(b,a),b.prototype.dispose=function(){this.subs.forEach(function(a){return a()}),this.subs=[],this.checkbox&&(this.checkbox.removeEventListener("click",this.checkedCallback),this.checkbox=null),a.prototype.dispose.call(this)},b.prototype.generateElement=function(){if(this.checkbox)throw new Error("The checkbox was already created");return this.checkbox=document.createElement("input"),this.checkbox.setAttribute("type","checkbox"),this.headerContent.disabled&&this.checkbox.setAttribute("disabled","disabled"),this.checkbox.checked=this.headerContent.value,this.checkbox.addEventListener("click",this.checkedCallback),this.subs.push(this.headerContent.disableChanged.add(this.updateDisability)),this.subs.push(this.headerContent.valueChanged.add(this.updateCheckboxValue)),this.checkbox},b}(a.HeaderContentController);a.CheckboxHeaderController=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(b){var c=function(){function b(a){this.gridScope=a,this.controllers={}}return b.prototype.dispose=function(){var a=this;Object.keys(this.controllers).forEach(function(b){var c=a.controllers[b];c.dispose()}),this.controllers={}},b.prototype.init=function(a){this.grid=a},b.prototype.deleteController=function(a){var b=this.controllers[a];b&&(b.dispose(),delete this.controllers[a])},b.prototype.createController=function(b){var c=this.grid&&this.gridScope.options.headerContent[b]&&this.gridScope.options.headerContent[b].content;if(c instanceof a.CheckBoxHeaderContentDescriptor){var d=new a.CheckboxHeaderController(this.grid,c,b);return this.controllers[b]=d,d}return null},b.prototype.generateCustomHeader=function(a){this.deleteController(a);var b=this.createController(a);if(b){var c=b.generateElement();return c}return null},b}();b.Manager=c}(b=a.headercontent||(a.headercontent={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=128,d="800px",e="800px",f="100px",g=function(){function c(c,d){var e=this;this.QueryResults=d,this.unsub=[],this.flashedCells={},this.flashingTable=new b.CellDictionary,this.lastGarbageFlashingTime=0,this.viewEvents={suspend:function(){},resume:function(){}},this.dataModel=c,this.onGridStatChange=new a.Event,this.unsub.push(c.getDataSet().rangeUpdated.add(function(b,c){if(c.isReset)e.refresh();else{var d=c.columnKeys&&c.columnKeys.length?c.columnKeys:null;c.rowKeys.forEach(function(a){return e.updateCell(a,d,c.noFlash)}),e.raiseGridStatsEvent(a.GridStatEventType.CellUpdated,c.columnKeys.length*c.rowKeys.length)}})),this.unsub.push(c.getRowAxis().options.slicesEvent.add(function(c,d){d.forEach(function(c){switch(c.type){case b.SliceEventType.SliceAdded:e.viewEvents.suspend(),c.args.keys.forEach(function(a){return e.addRow(a)}),e.viewEvents.resume(),e.raiseGridStatsEvent(a.GridStatEventType.RowAdded,c.args.keys.length);break;case b.SliceEventType.SliceRemoved:e.viewEvents.suspend(),c.args.keys.forEach(function(a){return e.removeRow(a)}),e.viewEvents.resume(),e.raiseGridStatsEvent(a.GridStatEventType.RowRemoved,c.args.keys.length);break;case b.SliceEventType.SliceMoved:e.refresh();break;case b.SliceEventType.Reset:e.raiseGridStatsEvent(a.GridStatEventType.ResetGrid),e.refresh()}})})),this.unsub.push(c.getColumnAxis().options.slicesEvent.add(function(){return e.refresh()})),this.unsub.push(c.getRowAxis().nodeStateUpdated.add(function(){return e.refresh()}))}return c.prototype.get=function(a,b){var d=this.dataModel.getDataSet().__getRow(a,b)||{};this.populateLoadingValue(d);var e=d;return b&&(e={},b.forEach(function(a){return e[a]=d[a]})),e[c.idProperty]=a,e},c.prototype.manageFlashing=function(){var a=this,b=Object.keys(this.flashedCells);if(0!==b.length){var c=(new Date).getTime();b.forEach(function(b){c-a.flashedCells[b].timestamp>=500&&($(a.flashedCells[b].cell.__cellNode).removeClass("updatedGridCell"),delete a.flashedCells[b])})}},c.prototype.setFlashing=function(a,b,d){var e=this;this.disableFlashing=a.disableFlashing,this.disableFlashing?this.flashingInterval&&(clearInterval(this.flashingInterval),this.flashingInterval=null):(this.flashingInterval=setInterval(function(){return e.manageFlashing()},50),b.connect(b.body,"onAfterCell",function(a){var b=(new Date).getTime(),d=a.row.id,f=a.column.id,g=e.flashingTable.getValue(d,f);if(g){var h=b-g;e.flashingTable.deleteCell(d,f);var i=h>c.ELAPSED_TIME_NOT_IN_STACK;i||($(a.__cellNode).addClass("updatedGridCell"),e.flashedCells[d+"|"+f]={cell:a,timestamp:b})}}))},c.prototype.query=function(a,b){var d=this,e=this.dataModel.getDataSet(),f=b&&b.start?b.start:0,g=b&&b.count?b.count:this.dataModel.getRowAxis().length(),h=this.dataModel.getRowAxis().getSliceRange(f,g),i=h.map(function(a){var b=e.__getRow(a.key())||{};return b[c.idProperty]=a.key(),d.populateLoadingValue(b),b});return i.total=this.dataModel.getRowAxis().length(),this.QueryResults(i)},c.prototype.getIdentity=function(a){return a[c.idProperty]},c.isLoadingRow=function(a){var c=a[b.RowMetadataProperty],d=c&&!!c[b.VirtualDataSet.isLoadingRowProperty];return d},c.prototype.populateLoadingValue=function(a){var d=c.isLoadingRow(a);if(d){var e=this.dataModel.getColumnAxis().getSliceRange(0,this.dataModel.getColumnAxis().length());e.forEach(function(c,d){a[c.key()]={getFormatted:function(){return 0===d?'<div class="grid_loading_row"><div class="loader" style="position: relative; left:50%"></div></div>':'<div class="grid_loading_row"></div>'},getStyle:function(a){return b.PresentationStyle.mixin(a,new b.PresentationStyle(["ion-empty-cell"]))}}})}},c.prototype.getNotifyRowData=function(a,b){var c=this;return{__rowId:a,__fetchData:function(){return c.get(a,b)}}},c.prototype.garbageFlashingQueue=function(){var a=this,b=this.flashingTable.getRowKeys(),d=(new Date).getTime();b.forEach(function(b){var e=a.flashingTable.getRow(b);Object.keys(e).forEach(function(e){var f=a.flashingTable.getValue(b,e);d-f>c.ELAPSED_TIME_NOT_IN_STACK&&a.flashingTable.deleteCell(b,e)})}),this.garbagePending=!1},c.prototype.notify=function(a,b){var c=this;if(this.observable){if(this.gridVisibilityInterval)return;this.isGridHidden()?this.gridVisibilityInterval=setInterval(function(){c.isGridHidden()||(clearInterval(c.gridVisibilityInterval),c.gridVisibilityInterval=null,c.observable.notify())},150):this.observable.notify(a,b)}},c.prototype.updateCell=function(a,b,c){var d=this;if(this.observable&&(!this.dataModel||this.dataModel.getRowAxis().contains(a))){if(!(c||this.disableFlashing||this.isGridHidden())){var e=(new Date).getTime(),f=b;b||(f=this.dataModel.getColumnAxis().getSliceRange(0,this.dataModel.getColumnAxis().length()).map(function(a){return a.key()})),f.forEach(function(b){d.flashingTable.setValue(a,b,e)}),!this.garbagePending&&e-this.lastGarbageFlashingTime>5e3&&(this.garbagePending=!0,this.lastGarbageFlashingTime=e,setTimeout(function(){return d.garbageFlashingQueue()},0))}this.notify(this.getNotifyRowData(a,b),a)}},c.prototype.addRow=function(a){this.notify(this.getNotifyRowData(a,null))},c.prototype.removeRow=function(a){this.notify(void 0,a)},c.prototype.refresh=function(){this.notify()},c.prototype.isGridHidden=function(){var a=(new Date).getTime();return a-this._lastGridVisibilityCheck>2e3&&(this._isGridHidden=this.gridx&&this.gridx.domNode&&!this.gridx.domNode.offsetParent,this._lastGridVisibilityCheck=a),this._isGridHidden},c.prototype.raiseGridStatsEvent=function(a,b){var c={gridStatEventType:a,count:b>0&&b||0};this.onGridStatChange.raise(this,c)},c.prototype.dispose=function(){clearInterval(this.flashingInterval),clearInterval(this.gridVisibilityInterval),this.gridVisibilityInterval=null,this.unsub&&this.unsub.forEach(function(a){return a()}),this.unsub=null},c.idProperty="__dojo__store__id",c.ELAPSED_TIME_NOT_IN_STACK=70,c}();b.DataModelDojoStoreAdapter=g;var h=function(){function g(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=this;this.$q=c,this.interval=d,this.$compile=e,this.templateCache=f,this.menuService=g,this.dialogService=h,this.loggerFactory=i,this.clipboardService=j,this.gridClipboardService=k,this.fileExportService=l,this.excHelper=m,this.popupService=n,this.responsivenessService=o,this.environmentService=p,this.notificationService=q,this.themeService=r,this.configurationService=s,this.preferenceService=t,this.hiddenGridTimer=null,this.services=[],this.unsubscribers=[],this.modulePromise=c.when(gridx.load().then(function(){return a.qRequires(["gridx/Grid","ion/VirtualVScroller","ion/RowHeader","ion/TrackingColumnResizer","ion/Body","ion/HeaderRegions","ion/RowHeaderResizer","ion/ExpandableGroupHeader","ion/HScroller","ion/AutoScroll","ion/AsyncCache","ion/ExtendedSelectCell","gridx/modules/extendedSelect/Row","ion/ColumnSelection","ion/ColumnWidth","ion/TableSelection","ion/ResponsiveSizeManager","ion/VLayout","ion/HLayout","ion/View","ion/ViewportManager","ion/PivotColumnLock","ion/TouchScroll","ion/ModifiableNestedSort","ion/Printer","ion/CellWidget","dojo/store/util/QueryResults","dojo/keys","dojo/store/Observable"])}).then(function(a){u.modules={Grid:a["gridx/Grid"],VirtualVScroller:a["ion/VirtualVScroller"],RowHeader:a["ion/RowHeader"],ColumnResizer:a["ion/TrackingColumnResizer"],Body:a["ion/Body"],HeaderRegions:a["ion/HeaderRegions"],RowHeaderResizer:a["ion/RowHeaderResizer"],GroupHeader:a["ion/ExpandableGroupHeader"],HScroller:a["ion/HScroller"],AutoScroll:a["ion/AutoScroll"],asyncCache:a["ion/AsyncCache"],ExtendedSelectCell:a["ion/ExtendedSelectCell"],ExtendedSelectRow:a["gridx/modules/extendedSelect/Row"],ExtendedSelectColumn:a["ion/ColumnSelection"],ColumnWidth:a["ion/ColumnWidth"],ExtendedSelectTable:a["ion/TableSelection"],ResponsiveSizeManager:a["ion/ResponsiveSizeManager"],VLayout:a["ion/VLayout"],HLayout:a["ion/HLayout"],View:a["ion/View"],ViewportManager:a["ion/ViewportManager"],ColumnLock:a["ion/PivotColumnLock"],TouchScroll:a["ion/TouchScroll"],ModifiableNestedSort:a["ion/ModifiableNestedSort"],Printer:a["ion/Printer"],CellWidget:a["ion/CellWidget"],QueryResults:a["dojo/store/util/QueryResults"],Keys:a["dojo/keys"],Observable:a["dojo/store/Observable"]}})),this.logger=i.create(b.LogKeys.Tags.Grid),this._themeChangedSubscription=this.themeService.currentThemeChanged.add(function(){return u.invalidateRowHeights()})}return g.prototype.initRequestByBody=function(){this.handleHiddenGrid(null,!0)},g.prototype.handleHiddenGrid=function(a,c){var d=this;if(!this.hiddenGridTimer){var e=this._gridx,f=e?b.safeGetClientHeight(e.domNode):0;if(0===f||c){a&&a.logDelayInit();var g=function(){var c=d.gridContainer&&d.gridContainer[0];b.safeGetClientHeight(c)&&(d.interval.cancel(d.hiddenGridTimer),d.hiddenGridTimer=null,a&&a.logDelayInitDone(b.safeGetClientHeight(c)),d.initGrid())};this.hiddenGridTimer=this.interval(g,500)}}},g.prototype.invalidateRowHeights=function(){this._gridx&&this._gridx.rowHeader&&this._gridx.rowHeader.invalidateRowHeights()},g.prototype.disposeServices=function(){this.services.forEach(function(a){return a.dispose()}),this.services=[],this._themeChangedSubscription&&(this._themeChangedSubscription(),this._themeChangedSubscription=null)},g.prototype.getComponent=function(){for(var b=this.scope;b;){if(b.component instanceof a.Component)return b.component;b=b.$parent}return null},g.prototype.link=function(c,d,e,f){var g=this;this.scope=c,this.element=d,this.templateCache=f,this.gridContainer=$(document.createElement("div")),d[0].appendChild(this.gridContainer[0]);var h={max:100,now:0},i=c.$new();i.data=h;var j=f.get("grids.ui/gridLoaderView.tpl.html");e(angular.element(j))(i,function(a){d[0].appendChild(a[0]),g.loadingPanel={show:function(){return c.$evalAsync(function(){return a[0].style.display="block"})},hide:function(){return a[0].style.display="none"},setText:function(a){return c.$evalAsync(function(){return i.data.text=a})}}}),this.gridContainer.addClass("ionweb-grid-main-container"),this.gridContainer.addClass("claro"),c.options=c.options||{},c.options.enableColumnFreezing=!0,c.options.internalInvokePaste=null,c.gridStateUpdatedEvent=new a.Event,c.$watch("options.editingOptions",function(){g.initEditingOptions()}),this.scope.options.gridInitialState&&b.restoreAppearanceOptions(this.scope,this.scope.options.gridInitialState),b.topbar.init(this.scope,this.element,this.$compile,this._gridx),c.$watch("data",function(a,b){g._dmSet=!0,g.initGrid(!0)}),c.$watch("options.enableRowHighlightOnHover",function(a,b){g.fixRowHighlightOnOver()}),c.$watch("options.enableRowHighlightOnCurrentCell",function(a,b){g.fixRowHighlightOnCurrentCell()}),c.$watch("options.autoHeight",function(a,b){g.fixResponsiveHeight()}),c.$watch("options.fitToContent",function(a,b){g.fixResponsiveHeight()}),c.$watch("options.enableZebraColoring",function(a,b){g.fixZebraColoring()}),c.$watch("options.noRecordsMessage",function(a,b){g.updateNoRecordsMessage(a)}),c.$watch("options.isDataLoading",function(a,b){g.updateLadingStatus(a)}),c.$on("$destroy",function(){g.hiddenGridTimer&&(g.interval.cancel(g.hiddenGridTimer),g.hiddenGridTimer=null),g.gridLogger&&(g.gridLogger.dumpDispose(),g.gridLogger.dispose()),g.menuService.detachElement(g.gridContainer),g.disposeServices(),g.sidePanelManager&&g.sidePanelManager.dispose(),g.selectionManager&&g.selectionManager.dispose(),i.$destroy(),g.resizeUnsub&&g.resizeUnsub.off(),g.columnHeaderManager&&g.columnHeaderManager.dispose()}),this.resizeUnsub=$(document.body).bind("resize",function(){return g.invalidateRowHeights()})},g.prototype.fixRowHighlightOnOver=function(){var a=this.scope.options.enableRowHighlightOnHover;this.toggleRootClass("gridxHovering",a);var b=a===!0;this._gridx&&(this._gridx.domNode&&(this._gridx.body.rowHoverEffect=b),b?this._gridx.bodyNode&&this._gridx.bodyNode.classList.add("gridxBodyRowHoverEffect"):this._gridx.bodyNode&&this._gridx.bodyNode.classList.remove("gridxBodyRowHoverEffect"))},g.prototype.manageResponsivenessClass=function(){var a="ionweb-flex-grid",b=this.element&&this.element[0];this.scope.options.fluidHeight?b&&b.classList.add(a):b&&b.classList.remove(a)},g.prototype.fixRowHighlightOnCurrentCell=function(){this.toggleRootClass("gridxBodyRowFocusEffect",!!this.scope.options.enableRowHighlightOnCurrentCell)},g.prototype.fixZebraColoring=function(){this.toggleRootClass("gridxZebraColoring",this.scope.options.enableZebraColoring)},g.prototype.fixResponsiveHeight=function(){this.toggleRootClass("gridxResponsiveHeight",!!this.scope.options.autoHeight||!!this.scope.options.fitToContent)},g.prototype.updateLadingStatus=function(a){a||""===a?(this._gridx&&(this._gridx.body.isLoadingStatusShown=!0,$(this._gridx.emptyNode).hide()),this.loadingPanel.setText(a===!0?b.Strings.Grid_Loading_Progress:a),this.loadingPanel.show()):(this._gridx&&(this._gridx.body.isLoadingStatusShown=!1,$(this._gridx.emptyNode).show(),this.updateGridEmptyNodeMessage()),this.loadingPanel.hide())},g.prototype.updateGridEmptyNodeMessage=function(){this.scope.data&&0==this.scope.data.getRowAxis().length()&&(this._gridx.emptyNode.innerText=this._gridx.body.emptyInfo)},g.prototype.updateNoRecordsMessage=function(a){this._gridx&&(void 0===a||null===a?this._gridx.body.emptyInfo=b.Strings.Grid_No_Items_To_Display:this._gridx.body.emptyInfo=a),this.updateGridEmptyNodeMessage()},g.prototype.toggleRootClass=function(a,b){b?this._gridx&&this._gridx.domNode&&this._gridx.domNode.classList.add(a):this._gridx&&this._gridx.domNode&&this._gridx.domNode.classList.remove(a)},g.prototype.initEditingOptions=function(){var a=this.scope.options.editingOptions=this.scope.options.editingOptions||{};void 0==a.renameColumns&&(a.renameColumns=!0),void 0==a.deleteColumns&&(a.deleteColumns=!0),void 0==a.reorderColumns&&(a.reorderColumns=!0),void 0==a.showColumnGearIconOnMouseHover&&(a.showColumnGearIconOnMouseHover=!0)},g.prototype.initGrid=function(g){var h=this,i=this.scope.options;this._gridx&&this._gridx.domNode&&!i.fluidHeight&&(this.currentGridHeight=getComputedStyle(this._gridx.domNode).height),this.watchedOptionsUnsub&&(this.watchedOptionsUnsub(),this.watchedOptionsUnsub=null),g&&this.selectionManager&&this.selectionManager.reset(),this.disposeServices(),i.showRowHeaders=i.showRowHeaders!==!1,i.showColumnHeaders=i.showColumnHeaders!==!1,i.disableFlashing=!!i.disableFlashing,i.enableOutlineMode=i.enableOutlineMode!==!1,i.compactColumnMode=!!i.compactColumnMode,i.responsivenessMode=i.responsivenessMode||b.GridResponsivenessMode.Default,i.dndOptions=i.dndOptions||{},i.wrapColumnHeaders=i.wrapColumnHeaders===!0,i.enableRowHighlightOnHover=i.enableRowHighlightOnHover!==!1,i.enableRowHighlightOnCurrentCell=i.enableRowHighlightOnCurrentCell===!0,i.enableZebraColoring=i.enableZebraColoring===!0,i.enableColumnFreezing="undefined"==typeof i.enableColumnFreezing||i.enableColumnFreezing,i.showColumnSeparators=i.showColumnSeparators!==!1,i.toolbarOptions=i.toolbarOptions||{enabled:!1},"undefined"==typeof i.toolbarOptions.enableFormatting&&(i.toolbarOptions.enableFormatting=!0),this.scope.columnSelectorEnabled=function(){var a=!0;return a=(!i.configOptions||!i.configOptions.disableColumnSelector)&&i.toolbarOptions.enableColumnSelector!==!1,h.scope.fetchFilteredColumns&&i.editingOptions&&i.editingOptions.deleteColumns&&a},this.scope.sortingSelectorEnabled=function(){return t.isAvailable},i.toolbarOptions.enableColumnSelector!==!1&&(i.toolbarOptions.enableColumnSelector=!0),this.unsubscribers.forEach(function(a){a()}),this.unsubscribers=[];var j=this.scope.data;if(j&&this._dmSet){var k=j.getAs(b.GroupingDataModel);if(k)k.isGroupableCallback=function(a){return!(h.scope.options&&h.scope.options.verticalGroupingGridOptions&&h.scope.options.verticalGroupingGridOptions.columnOptions&&h.scope.options.verticalGroupingGridOptions.columnOptions[a]&&h.scope.options.verticalGroupingGridOptions.columnOptions[a].disableGrouping)};else{if(i.enableOutlineMode!==!1){var l=i.outlineModeConfiguration&&i.outlineModeConfiguration.rowLevelDescriptors&&i.outlineModeConfiguration.rowLevelDescriptors.slice(),m=j.getRowAxis();if(m){m.options.groupingLevelDescriptor=l;var n=m.getAs(b.SortingPivotAxisAdapter);n&&(n.options.groupingLevelDescriptor=l);var o=m.getAs(b.VirtualSortingPivotAxisAdapter);o&&(o.options.groupingLevelDescriptor=l)}}var p=i.outlineModeConfiguration&&i.outlineModeConfiguration.columnLevelDescriptors&&i.outlineModeConfiguration.columnLevelDescriptors.slice(),q=j.getColumnAxis();if(q){q.options.groupingLevelDescriptor=p;var r=q.getAs(b.SortingPivotAxisAdapter);r&&(r.options.groupingLevelDescriptor=p);var s=q.getAs(b.VirtualSortingPivotAxisAdapter);s&&(s.options.groupingLevelDescriptor=p)}}this.scope.hasHierarchicalRows=function(){var a=h.scope.data.getRowAxis().getAs(b.FlatAxis);return!a},b.initGridFormattingControlOptions(this.scope),this.unsubscribers.push(b.initAppearanceOptions(this.scope)),this.gridLogger=new b.GridLogger(this.logger,j,this.scope.options),g&&this.gridLogger.dumpIds(),this.scope.options.headerContent&&(this.columnHeaderManager=new b.headercontent.Manager(this.scope));var t=new b.sorting.Manager(this.gridLogger,this.dialogService,j,this.excHelper,this.scope);this.scope.sortingManager=t;var u=new b.fitcontent.Manager(this.gridLogger,j,this.scope);this.selectionManager?g?(this.selectionManager.dispose(),this.selectionManager=new b.selection.Manager(j,this.gridLogger,this.scope.options)):this.selectionManager.onInitGrid(this.gridLogger,this.scope.options):this.selectionManager=new b.selection.Manager(j,this.gridLogger,this.scope.options),"undefined"==typeof this.scope.options.summaryPanelMode&&(this.scope.options.summaryPanelMode=b.SummaryPanelMode.ShowOnSelection);var v;j.getAs(b.VirtualDataModel)&&this.scope.options.summaryPanelMode!==b.SummaryPanelMode.Hide||(v=new b.summaryPanel.Manager(j,this.gridLogger,this.selectionManager,this.scope,this.$compile)),this.scope.summaryPanelManager=v;var w=new b.dnd.Manager,x=new b.headerPanel.ColumnHeaderRegionManager(this.$compile,this.scope),y=new b.headerPanel.Manager(this.$compile,x,this.scope,j,this.menuService),z=new b.filterPanel.Manager(j,this.scope,this.popupService,x,this.selectionManager),A=new b.grid.GridObject(j,this.selectionManager,t,w,this.scope,this,this.gridLogger,this.loadingPanel,this.getComponent(),y,u,this.modules.QueryResults,this.modules.Observable);this.scope.options.configClass&&!this.templateManager?this.templateManager=new b.templates.Manager(this.scope.options.configClass,function(){return A.state}):this.scope.options.configClass&&this.templateManager.init(function(){return A.state}),this.optionsDialogManager?this.optionsDialogManager.init(this.templateManager):this.optionsDialogManager=new b.optionsDialog.Manager(this.scope,j,this.dialogService,this.templateManager),this.sidePanelManager?g&&(this.sidePanelManager.dispose(),this.sidePanelManager=new b.gridSidePanel.Manager(this.scope,this.gridContainer,this.templateCache,this.$compile)):this.sidePanelManager=new b.gridSidePanel.Manager(this.scope,this.gridContainer,this.templateCache,this.$compile);var B=new b.settings.Manager(this.scope,j,t,v,y,x,z,this.sidePanelManager,this.templateManager,this.optionsDialogManager,this.element,function(){h.initGrid()},function(){j.getColumnAxis().options.refreshRequiredSlices()});this.sidePanelManager.reinit(B,A),A.settingsManager=B,A.sidePanelManager=this.sidePanelManager,A.summaryPanelManager=v,A.optionsDialogManager=this.optionsDialogManager;var C,D=j.getAs(b.ResponsiveDataModel);b.ValidationDmWrapper.hasValidation(j)&&(C=new b.validation.Manager(j,D));var E,F=j.getAs(b.PresentationDataModelAdapter);F&&(E=new b.style.Manager(F)),this.services.push(this.gridLogger,t,B,this.optionsDialogManager,A,w,u,z,x,y),v&&this.services.push(v);var G;D&&(G=new a.tables.grid.GridResponsiveDriver(D,this.responsivenessService,i),this.services.push(G),G.onConfigurationRefreshed.add(function(){h.invalidateRowHeights()}));var H=i.dndOptions&&i.dndOptions.needDragOnRows,I=[this.modules.AutoScroll,this.modules.View,this.modules.VirtualVScroller,this.modules.ColumnResizer,this.modules.Body,this.modules.HeaderRegions,this.modules.CellWidget,this.modules.HScroller];this.environmentService.isTouchDevice()&&I.push(this.modules.TouchScroll),(i.showRowHeaders||H)&&(I.push(this.modules.RowHeader),i.showRowHeaders&&I.push(this.modules.RowHeaderResizer)),I.push(this.modules.ViewportManager),I.push(this.modules.ResponsiveSizeManager,this.modules.VLayout,this.modules.HLayout,this.modules.ColumnWidth);var J=new b.sliceAxis.Manager(j,B,this.gridLogger,this.scope);this.scope.sliceManager=J,this.services.push(J),"undefined"==typeof this.scope.options.gridSelectionType&&(this.scope.options.gridSelectionType=b.GridSelectionType.All),this.scope.options.gridSelectionType&b.GridSelectionType.Cell&&I.push(this.modules.ExtendedSelectCell),this.scope.options.gridSelectionType&b.GridSelectionType.Row&&I.push(this.modules.ExtendedSelectRow),(this.scope.options.gridSelectionType&b.GridSelectionType.Column||J.isAvailable)&&I.push(this.modules.ExtendedSelectColumn),this.scope.options.gridSelectionType&b.GridSelectionType.Table&&I.push(this.modules.ExtendedSelectTable),t.isAvailable&&I.push(this.modules.ModifiableNestedSort),I.push(this.modules.GroupHeader),I.push(this.modules.ColumnLock);var K,L,M,N,O,P,Q,R,S=!1,T=function(){clearTimeout(N),N=null},U=function(a){a&&h.menuService.closeAll(),clearTimeout(O),O=null},V=function(a,c,d){switch(c){case"single":if(d&&d.rowKey&&d.columnKey){var e={rowKey:d.rowKey,columnKey:d.columnKey};h.selectionManager.setGridSelection({type:b.GridRangeType.Cell,args:[e]})}ma(d,b.MouseButton.Left,!0);break;case"double":na(d,b.MouseButton.Left,!0);break;case"long":h.scope.options.disableContextMenu?ma(d,b.MouseButton.Right,!0):h.contextMenu.open(a.target,a.pageX,a.pageY)}},W=!1,X=function(a,b){return a&&b&&a.rowKey===b.rowKey&&a.columnKey===b.columnKey},Y=function(b){W=!0,h.gridLogger&&h.gridLogger.logTouchStart(),S=!1,R=!1,L=Date.now();var c=L-M,d=a.tables.gridElementAxesIDsFromElement(b.target);N&&(T(),!X(K,d)&&Q&&Q()),c<=a.DOUBLE_TOUCH_DELAY&&!P&&X(K,d)?(V(b,"double",d),L=0,P=!0):P=!1,O=setTimeout(function(){var a=M-L;a<0&&b.target&&b.target.offsetParent&&(N&&T(),V(b,"long",d),P=!0)},a.LONG_TOUCH_DELAY),K=a.tables.gridElementAxesIDsFromElement(b.target)},Z=function(b){M=Date.now();var c=M-L;h.gridLogger&&h.gridLogger.logTouchEnd(c),O&&T();var d=a.tables.gridElementAxesIDsFromElement(b.target);c<a.LONG_TOUCH_DELAY&&!R&&b&&X(K,d)&&(Q=function(){K=null,V(b,"single",d),T(),Q=void 0},N=setTimeout(Q,a.DOUBLE_TOUCH_DELAY)),w&&w.touchEndPerformed()},_=function(a){N&&T(),O&&U(),R=!0,Q=void 0},aa=function(){A.onGridResize();var a=h.gridContainer.children(".gridx");if(a&&a.length){var b=a[0].getBoundingClientRect().height;h.scope.currentGridSize=b}h.sidePanelManager.onGridResize()},ba=this.scope.currentGridSize||d,ca={store:A.store,structure:A.structure,cacheClass:this.modules.asyncCache,selectRowCanSwept:!1,cacheSize:c,height:i._autoSize?void 0:ba,width:i._autoSize?void 0:e,bodyActiveCellChangedHandler:function(a,b,c){return h.selectionManager.handleActiveCellChange(a,b,c)},bodyInitRequestHandler:function(){return h.initRequestByBody()},bodyIsCellUpdateLocked:function(a,b){return A.isCellUpdateLocked(a,b)},bodyEmptyInfo:b.Strings.Grid_No_Items_To_Display,autoHeight:i._autoSize,responsiveSizeManagerRowAxis:j.getRowAxis(),responsiveSizeManagerFitToContent:this.scope.options.fitToContent,responsiveSizeManagerResizeService:this.responsivenessService,responsiveSizeManagerMaxHeight:this.scope.options.maxHeight,responsiveSizeManagerMaxRows:this.scope.options.maxRows,responsiveSizeManagerMinHeight:this.scope.options.minHeight,responsiveSizeManagerAutoHeight:this.scope.options.autoHeight,responsiveSizeManagerNewResponsiveness:this.scope.options.fluidHeight,responsiveSizeManagerMainContainer:this.element[0],responsiveSizeManagerResizeHandler:function(){return aa()},modules:I,rowHeaderWidth:f,rowHeaderOutlineModeConfig:i.enableOutlineMode&&this.scope.options.outlineModeConfiguration?this.scope.options.outlineModeConfiguration:null,rowHeaderOnlyDragMode:!i.showRowHeaders&&H,rowHeaderChangedStateHandler:function(){return B.notifyChanges()},columnResizerChangedStateHandler:function(){B.notifyChanges(),G&&G.processColumnSizeChanged()},rowHeaderRowAxis:j.getRowAxis(),rowHeaderDynamicRowHeight:this.scope.options.dynamicRowHeight,rowHeaderShowLeavesCounter:this.scope.options.showLeavesCounter,compactColumnMode:i.compactColumnMode,topLevelSummaryVisible:this.scope.data.getColumnAxis().options.isLevelSummaryVisible(0),headerGroups:A.headerGroups,headerHidden:!i.showColumnHeaders,headerOnExpandClick:function(a){return A.headerOnExpandClick(a)},nestedSortToggleFunction:t.isAvailable?function(a,b){return t.toggleFunction(a,b)}:void 0,viewEvents:A.storeAdapter.viewEvents,viewExchelper:this.excHelper,bodyRowHoverEffect:this.scope.options.enableRowHighlightOnHover===!0,bodyRowRowHighlightOnCurrentCell:this.scope.options.enableRowHighlightOnCurrentCell===!0,viewportManagerNewRowWindowHandler:function(){return A.onScroll()},intervalService:function(){return h.interval},hScrollerDisableVirtualColumns:this.scope.options.disableVirtualColumns||this.configurationService.config.shell.disableColumnVirtualization,hScrollerShowColumnSeparators:this.scope.options.showColumnSeparators,vScrollerUseBiggestGroupSize:this.scope.options.useBiggestGroupSize,vScrollerDynamicRowHeight:this.scope.options.dynamicRowHeight,touchScrollTouchstart:Y,touchScrollTouchend:Z,touchScrollTouchmove:_,touchScrollShouldBlockScrolling:function(){return S},touchScrollShouldIgnoreScrolling:function(){return w.isDragging},getCustomColumnHeader:function(a){return h.columnHeaderManager&&h.columnHeaderManager.generateCustomHeader(a)}},da=new this.modules.Grid(ca);da.cellWidget&&(da.cellWidget.hasCellWidgets=!!i.cellWidgets),i.gridState||(da._gridStarted=!0),this.columnHeaderManager&&this.columnHeaderManager.init(da),B.init(da),v&&v.init(B,da);var ea=new b.ColumnLockService(da.columnLock,B,j,A,this.scope);da.columnLockService=ea,J.columnLockService=ea,this.services.push(ea),this.enablePrintOpts(A),this._gridx=da,A.setGridx(da);var fa="";A.getColumnLayoutHierarchyType()&&(fa="pivot-column "),A.isRowLayoutHierarchical()&&(fa+="pivot-row "),$(da.domNode).addClass(fa),t.init(da),u.init(da),this.selectionManager.init(da),C&&C.init(da),E&&E.init(da);var ga,ha=j.getAs(b.EditingDataModel);if(ha&&F){var ia=function(a,b,c){var d=b;if(0!==c){var e=a.getSlice(b).index(),f=e+c;f>=0&&f<a.length()&&(d=a.getSliceRange(f,1)[0].key())}return d},ja=function(a,b,c,d){var e=ia(j.getRowAxis(),a,c),f=ia(j.getColumnAxis(),b,d);return{rowKey:e,columnKey:f}};ga=new a.tables.EditingDriver(this.gridLogger,this.templateCache,this.modules.Keys,this.$compile,this.scope,da,ha,F,D,ja,this.selectionManager,this.clipboardService,this.gridClipboardService,this.notificationService,this.preferenceService),A.editingDriver=ga,this.services.push(ga),this.scope.options.internalInvokePaste=function(a){return!ga.isEditInProgress&&(ga.pasteContent(a),!0)}}x.init(da);var ka=new b.condFormatting.Manager(j,this._gridx,A,this.scope,this.popupService);this.services.push(ka),y.init(da,J,B,ka),z.init(da);var la=function(){h.scope.$evalAsync(function(){h.scope.isOpen===!0&&(h.scope.isOpen=!1),h.scope.isAppearancePopupOpen===!0&&(h.scope.isAppearancePopupOpen=!1),h.scope.isColumnFilterPopupOpen===!0&&(h.scope.isColumnFilterPopupOpen=!1),v&&v.removeTooltipFromCell()})},ma=function(a,b,c){h.scope.options.onCellClick&&h.scope.options.onCellClick({rowKey:a.rowKey,colKey:a.columnKey,columnKey:a.columnKey,isCell:!0,button:b})},na=function(a,b,c){h.scope.options.onCellDblClick&&h.scope.options.onCellDblClick({rowKey:a.rowKey,colKey:a.columnKey,columnKey:a.columnKey,isCell:!0,button:b})};if(k)var oa=new b.GroupingUserActionManager(j,i);this.scope.options.disableContextMenu?this.environmentService.isTouchDevice()||this.menuService.attachElement(this.gridContainer,null,function(c){var d=a.tables.gridElementAxesIDsFromElement(c);ma(d,b.MouseButton.Right,!1)}):(this.contextMenu=new b.menu.GridContextMenu(this.gridLogger,da.domNode,j,da,A,this.scope,this.clipboardService,this.gridClipboardService,this.fileExportService,this.selectionManager,t,this.optionsDialogManager,y,ka,this.sidePanelManager,la,u,this.menuService,!this.environmentService.isTouchDevice(),oa,this.templateManager,this.notificationService,this.$q),this.services.push(this.contextMenu)),da.connect(da,b.LogKeys.GridEvents.onCellClick,function(a){var c=!1,d="function"==typeof h.scope.options.onCellClick;W&&h.environmentService.isTouchDevice()||(c=A.processCellClick(a.rowId,a.columnId)),W||d&&!c&&h.scope.options.onCellClick({rowKey:a.rowId,colKey:a.columnId,columnKey:a.columnId,isCell:!0,button:b.MouseButton.Left
}),h.gridLogger.logClick(a,c,d)});var pa="function"==typeof this.scope.options.onCellDblClick;pa&&da.connect(da,b.LogKeys.GridEvents.onCellDblClick,function(a){h.scope.options.onCellDblClick({rowKey:a.rowId,colKey:a.columnId,columnKey:a.columnId,isCell:!0,button:b.MouseButton.Left})});var qa=this.environmentService.has("mac");da.connect(da.bodyNode,b.LogKeys.GridEvents.onKeyDown,function(a){if(("c"===a.key||"C"===a.key)&&(a.metaKey&&qa||a.ctrlKey&&!qa)){if(h.scope.options.configOptions&&h.scope.options.configOptions.disableCopy)return;var c={excludeRowHeader:!0,excludeColumnHeader:!0},d=h.selectionManager.getGridSelection();b.selection.Manager.isContiguous(d,j)&&h.gridClipboardService.copyToClipboardUserAction(j,d,c,ca,h.gridLogger,h.clipboardService)}}),this.gridLogger.connectClickEvents(da),A.storeAdapter.setFlashing(this.scope.options,da,this.scope.data),da.connect(da.body,"onUnrender",function(a){if(ga){var b=da.body.isId(a)?a:null;ga.notifyRowUnrendered(b)}}),da.connect(da.body,"onAfterRow",function(a){ga&&ga.notifyRowRendered(a)}),da.connect(da.body,"onAfterCell",function(a){ga&&ga.notifyCellRendered(a)}),this.currentGridHeight&&(da.domNode.style.height=this.currentGridHeight),da.placeAt(this.gridContainer[0]),this.services.push({dispose:function(){da.destroyRecursive(!1)}});var ra=function(){if(da.startup(),w.init(da,da.domNode,j,i,h.selectionManager,J,function(){return h.menuService.closeAll()},h.loggerFactory,A.gridLogId),da._gridStarted=!0,G){var a=i.responsivenessMode||b.GridResponsivenessMode.Default;G.init(da.bodyNode,h.scope.options.responsiveness,da.columnLockService,da.columnResizer,h.environmentService.isMobileDevice(),a)}if(h.scope.options.onGridBound&&h.scope.options.onGridBound(A),h.scope.frozenColumnCountUserSetting&&h.scope.frozenColumnCountUserSetting>0&&da.columnLockService.lock(h.scope.frozenColumnCountUserSetting),B.canNotifyChanges=!0,h.handleHiddenGrid(h.gridLogger),h.manageResponsivenessClass(),h.fixRowHighlightOnOver(),h.fixRowHighlightOnCurrentCell(),h.fixZebraColoring(),h.updateLadingStatus(h.scope.options.isDataLoading),h.updateNoRecordsMessage(h.scope.options.noRecordsMessage),h.fixResponsiveHeight(),j.getColumnAxis().options.refreshRequiredSlices(),k){var c=new b.OutlineConfigurationManager(i,k,function(){h.initGrid()});h.services.push(c)}h.scope.$watch("options.showColumnSeparators",function(a,b){da.columnLock&&da.columnLock._updateBody(null),da.hScroller.showColumnSeparatorsChanged(a)}),A.refreshColumns(),A.storeAdapter.refresh()};this.watchedOptionsUnsub=this.scope.$watch("options.gridState",function(b,c){if(!a.equals(b,c)){var d=!1;a.equals(b,B.getState(h._gridx))||(d=B.setState(h._gridx,h.scope.options.gridState)),d||da._gridStarted||ra()}}),this.scope.options.gridState&&B.setState(this._gridx,this.scope.options.gridState)||ra()}},g.prototype.cloneStyles=function(){for(var a=document.head.children,b="",c=0;c<a.length;c++)a[c]instanceof HTMLStyleElement?b+=a[c].outerHTML:a[c]instanceof HTMLLinkElement&&(b+=a[c].outerHTML);return b},g.prototype.enablePrintOpts=function(a){var c=this,d=this.scope.options.printingOptions=this.scope.options.printingOptions||{};d.print=function(){var e=c.getComponent(),f=a&&a.getColumnLayoutHierarchyType()?"pivot-column ":"";f+=a&&a.isRowLayoutHierarchical()?"pivot-row ":"",a.performOperationWhenDMReady(function(){c.modules.Printer(c._gridx,{title:d.title||e&&(e.title||e.id),style:c.cloneStyles(),wrapColumnHeaders:c.scope.options.wrapColumnHeaders,styleSrc:[],additionalClasses:f})},b.Strings.Grid_Printing_Progress)}},g}();b.GridDirective=h,angular.module("ionwebGrids").directive("ionwebGrid",["$q","ionweb.interval","$compile","ionweb.contextMenuService","ionweb.dialogService","ionweb.loggerFactory","ionweb.clipboardService","ionweb.gridClipboardService","ionweb.fileExportService","ionweb.excHelper","ionweb.popupService","$compile","$templateCache","ionweb.responsivenessService","ionweb.environmentService","ionweb.notificationService","ionweb.themeManager","ionweb.configurationService","ionweb.preferenceService",function(a,b,c,d,e,f,g,i,j,k,l,m,n,o,p,q,r,s,t){return{restrict:"E",scope:{data:"=",options:"=?"},replace:!1,link:function(u,v){var w=new h(a,b,c,n,d,e,f,g,i,j,k,l,o,p,q,r,s,t);w.modulePromise.then(function(){w.link(u,v,m,n)})}}}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=a.toolkit.PopupAnchorPoint;angular.module("ionwebGrids").directive("gridColumnHeaderElement",["$compile","ionweb.popupService",function(a,b){var d=function(a,b){void 0==a.showBottomBorder&&(a.showBottomBorder=!0),a.anchorPoint=c[c.RightTop]};return{restrict:"EA",link:d,transclude:!0,scope:{title:"@?",showBottomBorder:"=?"},templateUrl:"grids.ui/gridColumnHeaderSettings/gridColumnHeaderElementDirective.tpl.html"}}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){angular.module("ionwebGrids").directive("ionwebGridColumnHeaderPopup",["$compile",function(b){var c=function(b,c){b.aliasOptions={showColumnAliasEntryBox:!1},b.anchorPoint=a.toolkit.PopupAnchorPoint[a.toolkit.PopupAnchorPoint.RightTop],b.clearText=function(){b.alias=""},b.moveColumnLeftClicked=function(){b.moveColumnLeft(),b.closePopUp(b.columnId)},b.moveColumnRightClicked=function(){b.moveColumnRight(),b.closePopUp(b.columnId)},b.hideColumnButtonClicked=function(){b.hideColumn(),b.closePopUp(b.columnId)},b.isHeaderPanelSettingEnabled=function(){return b.editingOptions.reorderColumns||b.editingOptions.deleteColumns||b.editingOptions.renameColumns},b.doWhenEnterKeyIsPressed=function(c){var d=c.which||c.keyCode;d===a.KeyCodes.ENTER&&b.closePopUp(b.columnId)},b.$watch("aliasOptions.showColumnAliasEntryBox",function(){b.aliasOptions.showColumnAliasEntryBox===!0&&($(c).find(".columnheader-alias-input").focus(),$(document).ready(function(){b.aliasInputIsFocused=!0,$(c).find(".columnheader-alias-input").focus().select()}))})};return{restrict:"EA",link:c,scope:{alias:"=?ngModel",columnId:"=?",closePopUp:"=?",moveColumnLeft:"=?",moveColumnRight:"=?",hideColumn:"=?",columnLeftMovementDisabled:"=?",columnRightMovementDisabled:"=?",columnHideDisabled:"=?",editingOptions:"=?",isRowLevelHeaderPanel:"=?",toolbarOptions:"=?"},templateUrl:"grids.ui/gridColumnHeaderSettings/gridColumnHeaderSettings.tpl.html"}}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){angular.module("ionwebGrids").directive("ionwebGridSummaryPanel",["ionweb.contextMenuService",function(c){var d=function(c,d){c.tooltipOptions={contentTemplateUrl:"grids.ui/gridSummaryPanel/tooltip.tpl.html",scope:c};var e=function(a){var b=c.summaryPanelManager.getState();a(b),c.summaryPanelManager.setSummaryPaneStateAndNotify(b),h()};c.contextMenuHandler=function(d){return[{action:function(){return e(function(a){return a.sum=!a.sum})},checked:c.summaryPanelManager&&c.summaryPanelManager.getState().sum,text:b.Strings.Summary_Panel_Info_Sum,menuType:a.MenuItemType.Checkbox,autoClose:!1},{action:function(){return e(function(a){return a.avg=!a.avg})},checked:c.summaryPanelManager&&c.summaryPanelManager.getState().avg,text:b.Strings.Summary_Panel_Info_Avg,menuType:a.MenuItemType.Checkbox,autoClose:!1},{action:function(){return e(function(a){return a.count=!a.count})},checked:c.summaryPanelManager&&c.summaryPanelManager.getState().count,text:b.Strings.Summary_Panel_Info_Count,menuType:a.MenuItemType.Checkbox,autoClose:!1},{action:function(){return e(function(a){return a.max=!a.max})},checked:c.summaryPanelManager&&c.summaryPanelManager.getState().max,text:b.Strings.Summary_Panel_Info_Max,menuType:a.MenuItemType.Checkbox,autoClose:!1},{action:function(){return e(function(a){return a.min=!a.min})},checked:c.summaryPanelManager&&c.summaryPanelManager.getState().min,text:b.Strings.Summary_Panel_Info_Min,menuType:a.MenuItemType.Checkbox,autoClose:!1}]};var f,g,h=function(){c.$evalAsync(function(){c.panelValues=c.summaryPanelManager.summaryInfoToDescription(g)})};c.$watch("summaryPanelManager",function(){f&&f(),c.summaryPanelManager&&(f=c.summaryPanelManager.onSummaryInfoChanged.add(function(a,b){g=b,h()}))}),c.$on("$destroy",function(){f&&f()})};return{restrict:"EA",scope:{summaryPanelManager:"=?"},link:d,templateUrl:"grids.ui/gridSummaryPanel/summaryPanel.tpl.html"}}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var Length;!function(a){function b(a,b,d,e){d=d||"width";var g,h,k,l=(b.match(i)||[])[2],m="px"===l?1:j[l+"toPx"],n=/r?em/i;if(m||n.test(l)&&!e)a=m?a:"rem"===l?f:"fontSize"===d?a.parentNode||a:a,m=m||parseFloat(c(a,"fontSize")),k=parseFloat(b)*m;else{g=a.style,h=g[d];try{g[d]=b}catch(a){return 0}k=g[d]?parseFloat(c(a,d)):0,g[d]=void 0!==h?h:null}return k}function c(a,e){var f,g,j,k,l,m=/^top|bottom/,n=["paddingTop","paddingBottom","borderTop","borderBottom"],o=4;if(f=h?h(a)[e]:(g=a.style["pixel"+e.charAt(0).toUpperCase()+e.slice(1)])?g+"px":"fontSize"===e?b(a,"1em","left",1)+"px":a.currentStyle[e],j=(f.match(i)||[])[2],"%"===j&&d)if(m.test(e)){for(k=(l=a.parentNode||a).offsetHeight;o--;)k-=parseFloat(c(l,n[o]));f=parseFloat(f)/100*k+"px"}else f=b(a,f);else("auto"===f||j&&"px"!==j)&&h?f=0:j&&"px"!==j&&!h&&(f=b(a,f)+"px");return f}var d,e=document.createElement("div"),f=document.documentElement,g=document.defaultView,h=g&&g.getComputedStyle,i=/^(-?[\d+\.\-]+)([a-z]+|%)$/i,j={},k=[1/25.4,1/2.54,1/72,1/6],l=["mm","cm","pt","pc","in","mozmm"],m=6;for(f.appendChild(e),h&&(e.style.marginTop="1%",d="1%"===h(e).marginTop);m--;)j[l[m]+"toPx"]=k[m]?k[m]*j.intoPx:b(e,"1"+l[m]);f.removeChild(e),e=void 0,a.toPx=b}(Length||(Length={}));var gridx;!function(a){var b=function(a){return a?a.clientHeight:0};a.registerModule("ion/ResponsiveSizeManager",["dojo/_base/declare","dojo/_base/lang","dojo/_base/sniff","dojo/_base/json","gridx/core/_Module"],function(a,c,d,e,f){return a(f,{name:"responsiveSizeManager",destroyed:!1,destroy:function(){var a=this;a.resizeObserversToDestroy.forEach(function(a){return a()}),a.destroyed=!0,$(window).unbind("resize",a.throttledResizeHeight)},preload:function(){this.throttledResizeHeight=null,this.resizeObserversToDestroy=[],this.rowAxis=this.arg("rowAxis"),this.fitToContent=this.arg("fitToContent"),this.minHeight=this.arg("minHeight"),this.maxRows=this.arg("maxRows"),this.maxHeight=this.arg("maxHeight"),this.autoHeight=this.arg("autoHeight"),this.resizeHandler=this.arg("resizeHandler"),this.resizeService=this.arg("resizeService"),this.newResponsiveness=this.arg("newResponsiveness"),this.mainContainer=this.arg("mainContainer")},load:function(){function a(a){for(;a;)if(a=a.parentElement){if(a.style&&a.style.height)return a;if(a.classList.contains("grid-container"))return a;if(a.classList.contains("grid-flexbox-container"))return a;var b=".grid-stack-item-content [ionweb-component] > .pane-content",c=$(a).find(b);if(c&&c.length)return c[0];var b="[ionweb-component] > .pane-content",c=$(a).find(b);if(c&&c.length)return c[0]}return null}function c(a,b){var c=0;return a&&a.getBoundingClientRect&&(c-=a.getBoundingClientRect().top),b&&b.getBoundingClientRect&&(c+=b.getBoundingClientRect().top),c}var d=this,e=this,f=function(a,b){e.grid.domNode&&null!==e.grid.domNode.offsetParent&&(a?e.grid.resize({h:a}):e.grid.resize(),b||d.resizeHandler&&d.resizeHandler())},g=function(f){if(!e.grid.domNode)return void((void 0===typeof f||f)&&setTimeout(function(){return g(!1)},1e3));var h,i,j=a(e.grid.domNode);if(j){i=window.getComputedStyle(j),h=parseInt(i.height);var k=i&&i.paddingBottom&&parseInt(i.paddingBottom);k&&(h-=k)}else h=Math.max(b(document.documentElement),window.innerHeight||0);var l=Math.max(0,h-c(j,e.grid.domNode)),n=d.maxHeight?Math.min(d.maxHeight,l):l;n&&m(n)},h=function(){if(!e.destroyed)return e.grid.domNode&&null!==e.grid.domNode.offsetParent?void(e.autoHeight&&setTimeout(function(){return g()},10)):void e.throttledResizeHeight()},i=function(){if(!e.destroyed)return e.grid.domNode&&null!==e.grid.domNode.offsetParent?void f():void e.throttledResizeWidth()};e.throttledResizeHeight=ionweb.debounce(h,250,!1),e.throttledResizeWidth=ionweb.debounce(i,250,!1);var j=function(){if(!e.destroyed&&e.grid&&e.grid.domNode){if(m(10),e.grid.domNode.parentElement){var b=a(e.grid.domNode);if(b){var c=e.resizeService,d=function(){e.throttledResizeHeight()},f=c.register(b,d,!1);e.resizeObserversToDestroy.push(f)}$(window).bind("resize",e.throttledResizeHeight)}else window.requestAnimationFrame(j);h()}},k=null,l=null,m=function(a,b){l!=a&&(l=a,f(a,b))},n=function(){if(window.document.getElementById(e.grid.id)){k&&(clearTimeout(k),k=null);var a,c,d=e.grid.bodyNode,f=e.maxRows&&parseInt(e.maxRows),g=f?Math.min(e.maxRows,e.rowAxis.length()):e.rowAxis.length(),h=d&&e.rowAxis&&b(d.firstChild)*g,i=!0;if(e.maxHeight&&(a=parseFloat(Length.toPx($(e.grid.domNode)[0],e.maxHeight))),e.minHeight&&(c=parseFloat(Length.toPx($(e.grid.domNode)[0],e.minHeight))),a&&c&&a<=c)m(c),i=!1;else if(a&&h&&h>=a)m(a),i=!1;else{if(!h){var j=b(e.grid.emptyNode);h=j}if(h){var o=l,p=b(e.grid.header.domNode);m(p+h,!0);var q=h-(Math.max(b(e.grid.bodyNode),b(e.grid.emptyNode))-p),r=h+q;a&&r>=a?r=a:c&&r<=c&&(r=c);var s=r===o;m(r,s),i=!1}}i&&(k=setTimeout(n,10))}},o=function(){if(e.grid&&e.grid.domNode){var a=e.resizeService,b=a.register(e.grid.domNode,e.throttledResizeWidth,!0);e.resizeObserversToDestroy.push(b)}},p=function(){var a=function(a){a.width&&e.grid&&e.grid.domNode&&(e.grid&&e.grid.hScroller&&e.grid.hScroller.refresh(),e.grid&&e.grid.vScroller&&e.grid.vScroller._update(),e.resizeHandler&&e.resizeHandler())},b=ionweb.debounce(a,250,!1),c=e.resizeService,d=c.register(e.mainContainer,b);e.resizeObserversToDestroy.push(d)};e.newResponsiveness?p():(e.fitToContent?(e.batchConnect([e.grid.body,"onRender",ionweb.throttle(n)]),setTimeout(function(){n()},0)):e.autoHeight&&j(),setTimeout(function(){o()},0))}})})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/AutoScroll",["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/window","dojo/query","dojo/dom-geometry","gridx/modules/AutoScroll"],function(a,b,c,d,e,f){return a(f,{_scroll:function(){var a=this;if(a.arg("enabled")){var c,e,f=a.grid,g=a._vdir,h=a._hdir;if(a.arg("vertical")&&g&&f.bodyNode){c=g>0?1:-1;var i=a._findNode(f.bodyNode.childNodes,function(a){return c>0?a.offsetTop>=f.bodyNode.scrollTop+f.bodyNode.offsetHeight?-1:a.offsetTop+a.offsetHeight<f.bodyNode.scrollTop+f.bodyNode.offsetHeight?1:0:a.offsetTop>f.bodyNode.scrollTop?-1:a.offsetTop+a.offsetHeight<=f.bodyNode.scrollTop?1:0});if(i){var j=parseInt(i.getAttribute("visualindex"),10);e=f.vScroller.scrollToRow(j+c*a.arg("rowStep"))}}if(a.arg("horizontal")&&h&&f.header){c=h>0?1:-1;var k=a._findNode(d(".gridxCell",f.header.domNode),function(a){return c>0?a.offsetLeft>=f.hScrollerNode.scrollLeft+f.hScrollerNode.offsetWidth?-1:a.offsetLeft+a.offsetWidth<f.hScrollerNode.scrollLeft+f.hScrollerNode.offsetWidth?1:0:a.offsetLeft>f.hScrollerNode.scrollLeft?-1:a.offsetLeft+a.offsetHeight<=f.vScrollerNode.scrollLeft?1:0});if(k){var l=f._columnsById[k.getAttribute("colid")];if(l){var m=l.index+c*a.arg("columnStep");m>=f._columns.length?m=f._columns.length-1:m<0&&(m=0);var n=f._columns[m];f.hScroller.scrollToColumn(n.id)}e=e||1}}a._handler=e,e&&b.when(e,function(){a._handler=setTimeout(function(){a._scroll()},a._timeout)})}else delete a._handler}})})}(gridx||(gridx={}));var gridx;!function(a){var b=function(a){return a?a.clientHeight:0};a.PIVOT_HEADER_MAX_SHADE_LEVEL=3,a.registerModule("ion/Body",["dojo/_base/declare","dojo/dom-class","dojo/_base/sniff","dojo/dom-construct","dojo/_base/array","dojo/_base/Deferred","dojo/_base/lang","gridx/core/Row","dojo/keys","dojo/query","gridx/modules/Body"],function(c,d,e,f,g,h,i,j,k,l,m){function n(a,b,c,d){d?(a.add(c,"gridxBodyEmptyOnTop"),b.classList.add("gridxMainEmpty")):(a.remove(c,"gridxBodyEmptyOnTop"),b.classList.remove("gridxMainEmpty"))}var o=(i.mixin,i.delegate),p=i.isFunction;return c(m,{compareOnSet:function(a,b){return a.formattedValue===b.formattedValue&&JSON.stringify(a.style.toJSON())===JSON.stringify(b.style.toJSON())},_activeCellChanged:null,_currentFocusedKeys:null,processKeyDownCallback:null,isId:function(a){return this.model.isId(a)},_initFocus:function(){var a=this,c=a.grid,d=c.focus;d.registerArea({name:"body",priority:1,focusNode:a.domNode,scope:a,doFocus:a._doFocus,doBlur:a._blurCell,onFocus:a._onFocus,onBlur:a._blurCell}),a.connect(c.mainNode,"onkeydown",function(e){if((!a.processKeyDownCallback||a.processKeyDownCallback())&&d.arg("enabled")&&"body"==d.currentArea()){var f=k,g=c._isCtrlKey(e);if(e.keyCode!=f.HOME||g)if(e.keyCode!=f.END||g){if((!c.tree||!g)&&this.grid.bodyNode){d._noBlur=1;var h={},i=c.isLeftToRight()?1:-1,j=b(this.grid.bodyNode.firstChild)||1,l=b(this.grid.bodyNode)/j;l=Math.floor(l),l--,h[f.LEFT_ARROW]=[0,-i,e],h[f.RIGHT_ARROW]=[0,i,e],h[f.UP_ARROW]=[-1,0,e],h[f.DOWN_ARROW]=[1,0,e],h[f.PAGE_UP]=[-l,0,e],h[f.PAGE_DOWN]=[l,0,e],a._moveFocus.apply(a,h[e.keyCode]||[]),d._noBlur=0}}else a._focusCellCol=c._columns.length-1,a._focusCell(),d.stopEvent(e);else a._focusCellCol=0,a._focusCell(),d.stopEvent(e)}}),a.aspect(c,"onCellClick",function(b){a._focusCellRow=b.visualIndex,a._focusCellCol=b.columnIndex}),a.aspect(a,"onRender",function(b,c){var e=d.currentArea();d.arg("enabled")&&("body"==e?a._focusCellRow>=b&&a._focusCellRow<b+c&&a._focusCell():d.focusArea(e,1))}),a.connect(c.emptyNode,"onfocus",function(){d.focusArea("body")}),a.connect(a.grid,"_onResizeEnd",function(){if(c.hScroller._getVisibleColumns){var b=c.hScroller._getVisibleColumns();ionweb.equals(this.lastProcessedVisibleCells,b)||a.refresh()}})},onAfterRow:function(a){var b=this,c=a.id,d=a.node();if(!d)for(var e,f=0,g=this.domNode.childNodes;e=g[f];++f)if(e.getAttribute("rowid")==c){d=e;break}this.rowIdToNode[c]=d,this.visibleCells&&this.visibleCells.forEach(function(c){var e=b.grid.cell(a.id,c,1);b.onAfterCell(e,d,!0)})},onUnrenderRow:function(a){a&&this.rowIdToNode?delete this.rowIdToNode[a]:this.rowIdToNode={}},_getRowNode:function(a){return this.rowIdToNode[a]},_getTargetNode:function(a,b){var c=$(this.grid.bodyNode).children("[rowid='"+a+"']"),d=c&&c.length&&$(c).find("[colid='"+b+"']");return d&&d.length?d[0]:null},_getCellKeys:function(a){if(a){var b=a.attributes.colid.nodeValue,c=$(a).parents("[rowid]"),d=c&&c.length&&c[0].attributes.rowid.nodeValue;if(b&&d)return{rowId:d,colId:b}}return null},setActiveCell:function(a,b,c){var d=this._getTargetNode(a,b);if(d){for(var e=d.parentNode.childNodes,f=-1,g=0;g<e.length;g++)if(e[g]==d){f=g;break}var h=parseInt($(d).parents("[rowindex]")[0].attributes.rowindex.nodeValue);this._focusCell(null,h,f,c)}},resetActiveCell:function(){this._resetLastFocusedCell()},getActiveCell:function(){return{rowId:this.lastFocusedRowKey,colId:this.lastFocusedColKey}},preload:function(){this.rowIdToNode={},this._initFocus(),this._activeCellChanged=this.arg("activeCellChangedHandler"),this._initRequestHandler=this.arg("initRequestHandler"),this._isCellUpdateLocked=this.arg("isCellUpdateLocked");var a=this,b=a.grid;a.connect(b.body,"onUnrender",this.onUnrenderRow)},refreshCell:function(a,b){var c=new h,d=this,e=d.model,f=d.grid,g=f._columns[b],i=g&&d.getCellNode({visualIndex:a,colId:g.id});if(i){var j,k=f.view.getRowInfo({visualIndex:a}),l=k.rowIndex,m=k.parentId;return e.when({start:l,count:1,parentId:m},function(){if(j=e.byIndex(l,m)){k.rowId=e.indexToId(l,m);var b=f.cell(k.rowId,g.id,1),c=f.tree&&f.tree.isPaddingCell(k.rowId,g.id),h=d._buildCellContent(g,k.rowId,b,a,c);ionweb.dom.clearNode(i),"string"==typeof h?i.innerHTML=h:i.appendChild(h),d.onAfterCell(b)}}).then(function(){c.callback(!!j)}),c}return c.callback(!1),c},lazyRefresh:function(){var a=this;a.grid._gridStarted&&(clearTimeout(a._sizeChangeHandler),a._sizeChangeHandler=setTimeout(function(){var b=a.grid;a._ionHiddenGridHandler||(b&&b.domNode&&0===b.domNode.clientHeight?a._ionHiddenGridHandler=setInterval(function(){a._destroyed?(clearInterval(a._ionHiddenGridHandler),a._ionHiddenGridHandler=void 0):b.domNode&&0!==b.domNode.clientHeight&&(a.refresh(),clearInterval(a._ionHiddenGridHandler),a._ionHiddenGridHandler=void 0)},500):a._destroyed||a.refresh())},10))},removeCellWidget:function(a,b){var c=this,d=c.getCellWidgetModule();if(d)for(var e=this.grid._columns,f=0,g=e.length;f<g;++f)e[f].id===b&&d.detachCellWidget(a,e[f])},getCellWidgetModule:function(){return this.grid.cellWidget},wrapInFragment:function(a){var b=document.createDocumentFragment();return a.forEach(function(a){b.appendChild(a)}),b},refresh:function(a,b){var c=this,e=c.grid.loadingNode,i=new h;delete c._err;var j=c.grid&&c.grid.bodyNode&&c.grid.bodyNode.offsetParent;if(!j)return i.callback(),i;var k=c.getCellWidgetModule();if(k)for(var m=c.grid._columns,n=0,o=m.length;n<o;++n)k.detachCellWidget(null,m[n]);return clearTimeout(c._sizeChangeHandler),d.toggle(c.domNode,"gridxBodyRowHoverEffect",c.arg("rowHoverEffect")),d.toggle(c.domNode,"gridxBodyRowFocusEffect",c.arg("rowFocusEffect")),e&&d.add(e,"gridxLoading"),c.grid.view.updateVisualCount().then(function(){try{var j=c.renderStart,k=c.renderCount,m=c.grid.view.visualCount;if(j+k>m&&(k<m?j=c.renderStart=m-k:(j=c.renderStart=0,k=m)),"number"==typeof a&&a>=0){a=j>a?j:a;var n=j+k-a,o=l('> [visualindex="'+a+'"]',c.domNode)[0],p=[],q=[];if(o){var r=c.wrapInFragment(c._buildRows(a,n,p,q,!1,b));r&&f.place(r,o,"before")}var s={};for(g.forEach(q,function(a){s[a.id]=1});o;){var t=o.nextSibling,u=o.getAttribute("rowid");s[u]||c.onUnrender(u,"refresh"),f.destroy(o),o=t}g.forEach(q,c.onAfterRow,c),h.when(c._buildUncachedRows(p),function(){c.onRender(a,n),c.onForcedScroll(),d.remove(e,"gridxLoading"),i.callback()})}else c.renderRows(j,k,0,1,b),c.onForcedScroll(),d.remove(e,"gridxLoading"),i.callback()}catch(a){c._loadFail(a),d.remove(e,"gridxLoading"),i.errback(a)}},function(a){c._loadFail(a),d.remove(e,"gridxLoading"),i.errback(a)}),i},renderRows:function(a,b,c,e,i){var j=this,k=j.grid,l=[],m=[],o=j.domNode,p=k.emptyNode,q=j.emptyInfo||j.arg("emptyInfo"),r="";if(!j._err)if(b>0){n(d,o.parentNode,p,!1),"top"!=c&&"bottom"!=c&&j.model.free();var s=j._buildRows(a,b,l,m,!1,i),t=j.wrapInFragment(s),u=!1;if("top"==c){if(j.renderCount+=j.renderStart-a,j.renderStart=a,f.place(t,o,"first"),k.cellWidget&&k.vScroller._updateRowHeight){var v=j.renderStart+j.renderCount,w=k.vScroller._updateRowHeight("post");v-w<a+b&&(b=v-w-a)}}else if("bottom"==c)j.renderCount=a+b-j.renderStart,f.place(t,o,"last"),k.cellWidget&&k.vScroller._updateRowHeight&&(k.vScroller._updateRowHeight("pre"),j.renderStart>a&&(a=j.renderStart,b=j.renderCount));else{j.renderStart=a,j.renderCount=b;var x=e?o.scrollTop:0;j._skipUnrender||j.onUnrender(),ionweb.dom.clearNode(o),o.appendChild(t),o.scrollTop=x,u=!0;var y=!s||!s.length;r=y?q:"",y&&n(d,o.parentNode,p,!0)}g.forEach(m,j.onAfterRow,j),h.when(j._buildUncachedRows(l),function(){j._err||(p.innerText=r),j.onRender(a,b)}),u&&k.hScrollerNode&&(o.scrollLeft=k.hScrollerNode.scrollLeft)}else({top:1,bottom:1})[c]||(k._isLoaded&&(o.scrollTop=0,j._skipUnrender||j.onUnrender(),ionweb.dom.clearNode(o)),j.isLoadingStatusShown||(p.innerText!==q&&(p.innerText=q),n(d,o.parentNode,p,!0)),j.onEmpty(),j.model.free())},_raiseActiveCellChanged:function(a,b){if(this._activeCellChanged){var c=this._getCellKeys(a);c&&this._activeCellChanged(c.rowId,c.colId,b)}},_loadFail:function(a){console.error(a);var b=this.grid.emptyNode;b.innerText=this.arg("loadFailInfo",this.grid.nls.loadFailInfo),n(d,this.domNode.parentNode,b,!0),ionweb.dom.clearNode(this.domNode),this._err=a,this.onEmpty(),this.onLoadFail(a)},settingFocusOnCellCallback:null,_moveFocus:function(a,b,c){if(a||b){var d,f,g=this,h=g.grid,j=h._columns.length,k=h.view.visualCount,l=e("ie")<9?i.mixin({},c):c;h.focus.stopEvent(c),d=g._focusCellRow+a,d=d<0?0:d>=k?k-1:d,f=g._focusCellCol+b,f=f<0?0:f>=j?j-1:f,h.vScroller.scrollToRow(d).then(function(){g._focusCell(l,d,f,!1),g.onMoveToCell(d,f,l)})}},_setLastFocusedCell:function(a){var b=$(a).parents("[rowid]").attr("rowid"),c=$(a).attr("colid")||$(a).parents("[colid]").attr("colid");this.lastFocusedRowKey=b,this.lastFocusedColKey=c,d.add(a,"gridxLastCellFocus");var e=a&&$(a).parents("div.gridxRow[role=row]")[0];e&&d.add(e,"gridxRowFocus")},_resetLastFocusedCell:function(){this.lastFocusedRowKey=null,this.lastFocusedColKey=null,l(".gridxLastCellFocus",this.domNode).removeClass("gridxLastCellFocus"),l(".gridxRowFocus",this.domNode).removeClass("gridxRowFocus")},_focusCell:function(a,b,c,f,g){var h,i,j=this,k=j.grid;if(null!=b&&b!=-1&&"undefined"!=typeof b||!this._currentFocusedKeys){k.focus.stopEvent(a),c=c>=0?c:j._focusCellCol,b=b>=0?b:j._focusCellRow;var i=k._columns[c]?k._columns[c].id:void 0;h=i&&j.getCellNode({visualIndex:b,colId:i})}else h=j._getTargetNode(this._currentFocusedKeys.rowId,this._currentFocusedKeys.colId);if(j._resetLastFocusedCell(),h){if(j._blurCell(),j._setLastFocusedCell(h),d.add(h,"gridxCellFocus"),"undefined"!=typeof b&&(j._focusCellRow=b),"undefined"!=typeof c&&(j._focusCellCol=c),k.header._focusHeaderId=i,e("ie")<8){var l=k.bodyNode.scrollLeft;!f&&h.focus(),k.bodyNode.scrollLeft=l}else f||j.settingFocusOnCellCallback&&!j.settingFocusOnCellCallback()||h.focus();i&&k.hScroller.scrollToColumn(i,h.parentNode.parentNode.parentNode.parentNode);var m=!j.grid.select||!j.grid.select.cell||!j.grid.select.cell._selecting;!f&&m&&null!=a&&j._raiseActiveCellChanged(h,a&&a.shiftKey||g),this._currentFocusedKeys=this.getActiveCell()}else if(!k.rowCount())return!f&&k.emptyNode.focus(),this._currentFocusedKeys=null,!0;return h},getRow:function(a,b,c){var d,e=this;e.grid;return"number"!=typeof a||b||(a=e.model.indexToId(a,c)),d=d||e.mixin(e,new j(e),"row"),o(d,{id:a})},_buildRows:function(a,b,c,d,e,f){var g,h=this,j=a+b,k=[],l=h.grid,m=h.domNode.scrollWidth,n=l.columns(),o=this.grid._encodeHTML,p=a,q={count:b,parentId:"",start:p},r=i.mixin({},h.options||{},q);e&&(g=l.store.query(r.query||{},r));var s;for(p<j&&(s=l.hScroller._getVisibleColumns&&l.hScroller._getVisibleColumns());p<j;++p){var t=l.view.getRowInfo({visualIndex:p}),u=h.grid._gridStarted&&l.row(t.rowId,1);if(e){var v=g.length&&l.model._cache._itemToObject(g[p]);t.rowId=v.__dojo__store__id,u=h.getRow(t.rowId,1,"")}var w=[],x=!1;w.push('<div class="gridxRow ',u&&u.id===this.lastFocusedRowKey?"gridxRowFocus ":"",'" role="row" visualindex="',p),u?(h.model.keep(u.id),w.push('" rowid="',o(u.id),'" rowindex="',t.rowIndex,'" parentid="',o(t.parentId),'">',"</div>"),d.push(u),x=!0):(w.push('"><div class="gridxRowDummy" style="width:',m,'px;"></div></div>'),t.start=t.rowIndex,t.count=1,c.push(t));var y=$(w.join(""))[0];x&&y.appendChild(h._buildCells(u,p,n,e,f,s)),k.push(y)}return k},_buildRowContent:function(a){var b=this,c=l('> [visualindex="'+a.visualIndex+'"]',b.domNode)[0];if(c){var d=b.grid.row(a.rowIndex,0,a.parentId);d?(b.model.keep(d.id),c.setAttribute("rowid",d.id),c.setAttribute("rowindex",a.rowIndex),c.setAttribute("parentid",a.parentId||""),ionweb.dom.clearNode(c),c.appendChild(b._buildCells(d,a.visualIndex)),b.onAfterRow(d)):console.error("Error in Body._buildRowContent: Row is not in cache: "+a.rowIndex)}},mixin:function(a,b,c){var d,e,f=this.grid._modules;for(d in f)d=f[d].mod,e=d[c+"Mixin"],p(e)&&(e=e.apply(d)),i.mixin(b,e||{});return b},getRowData:function(a,b,c){var d=this,e=d.grid,f={count:b,parentId:"",start:a},g=i.mixin({},d.options||{},f),h=e.store.query(g.query||{},g),j=h.length&&e.model._cache._itemToObject(h[0]);return j&&(j.data=e.model._cache._formatRow(j,c)),j},_buildCells:function(b,c,d,e,f,g){var h=this,j=b.id,k={};h.onCheckCustomRow(b,k);var l=document.createElement("table");l.setAttribute("class","gridxRowTable"),l.setAttribute("role","presentation"),l.setAttribute("border","0"),l.setAttribute("cellpadding","0"),l.setAttribute("cellspacing","0");var m,n=l.insertRow(0),o=this.grid.rowHeader&&this.grid.rowHeader.rowAxis&&this.grid.rowHeader.rowAxis.getAs(ionweb.tables.PivotAxis);if(m=o&&o.getNode(b.id)?o.options.isNodeSummaryVisible(o.options.getVisibleRoot().key())&&o.getNode(b.id)===o.options.getVisibleRoot()?"summary-data-cell":this.grid.rowHeader._hasActionButton(b.id)?o.getNode(b.id).level()-1:"leaf"+(c%2?" gridxRowOdd":""):"leaf"+(c%2?" gridxRowOdd":""),"number"==typeof m&&(m=Math.min(m,a.PIVOT_HEADER_MAX_SHADE_LEVEL)),k[j]){k={},h.onBuildCustomRow(b,k);var p=[];p.push('<td class="gridxCustomRow pivot-level-'+m+'" aria-readonly="true" role="gridcell" tabindex="-1">',h._wrapCellData(k[j],j),"</td>"),n.appendChild($(p.join(""))[0])}else{var q;q=h.model.byId(j)?h.model.byId(j).data:h.getRowData(c,1,j).data;var r=h.grid,s="body"==r.focus.currentArea()&&h._focusCellRow===c,t=q,u=r._columns,v=h._cellCls[j]||{},o=this.grid.rowHeader&&this.grid.rowHeader.rowAxis&&this.grid.rowHeader.rowAxis.getAs(ionweb.tables.PivotAxis);h.visibleCells=[];var w=!e&&(g||r.hScroller._getVisibleColumns&&r.hScroller._getVisibleColumns());this.lastProcessedVisibleCells=w;var x=function(a){if(a){var b=a+"px",c=[];c.push('<td aria-readonly="true" role="gridcell" tabindex="-1" class="gridxCell" style="width:',b,";min-width:",b,";max-width:",b,'" aria-label="empty cell"></td>'),n.appendChild($(c.join(""))[0])}},y=function(a){if(!w)return!0;var b=!1;return w.forEach(function(c){a>=c.start&&a<c.start+c.count&&(b=!0)}),b},z=function(a){if(!w)return 0;var b=0;return w.forEach(function(c){c.start===a&&(b=c.widthBefore)}),b},A=function(a){if(!w)return 0;var b=0;return w.forEach(function(c){c.start+c.count-1===a&&(b=c.widthAfter)}),b},B=f&&$('.gridxRow[rowid="'+j+'"]',h.grid.bodyNode),C={};if(f&&B){var D=function(a){for(var b=!0,c=0;c<a.length;c++){var d=a[c];if(d.tagName&&"TD"===d.tagName.toUpperCase()){var e=d.getAttribute("colid");C[e]=d,b=!1}}b&&a.children().length>0&&D(a.children())};D(B)}for(var E=0,F=u.length;E<F;++E){var G=u[E],H=G.id,I=G.width;e&&parseFloat(I)>=700&&(I="500px"),"0px"===I&&this._initRequestHandler(),x(z(E));var J=y(E);if(J){h.visibleCells.push(G.id);var K=f&&C[H];if(K)n.appendChild(K);else{var L=r.tree&&r.tree.isPaddingCell(j,H),M=G.class,N=t[H],O=M&&i.isFunction(M),P=G.style&&i.isFunction(G.style),Q=O||P||!L&&G.decorator,R=Q&&r.cell(b,d&&d[E]||H,1),S=h._buildCellContent(G,j,R,c,L,N),p=[];p.push('<td aria-readonly="true" role="gridcell" tabindex="-1" aria-describedby="',G._domId,'" colid="',H,'" class="gridxCell '+(G.borderNode?"border-node ":"")+"pivot-level-"+m+" "+("summary"===G.levelInfo&&"summary-data-cell "!==m?"pivot-level-summary-data-cell ":""),s&&h._focusCellCol===E?"gridxCellFocus ":"",j===this.lastFocusedRowKey&&H===this.lastFocusedColKey?"gridxLastCellFocus ":"",L?"gridxPaddingCell ":"",G._class||""," ",(O?M(R):M)||""," ",v[H]?v[H].join(""):"",' " style="width:',I,";min-width:",I,";max-width:",I,";",r.getTextDirStyle(H,N),(P?G.style(R):G.style)||"",'">'),"string"==typeof S&&p.push(S),p.push("</td>");var T=$(p.join(""))[0];n.appendChild(T),"string"!=typeof S&&T.appendChild(S)}}x(A(E))}}return l},processUpdate:function(a,b,c,d){var e=this,f=e.grid;if(!e._isCellUpdateLocked(a,b.id)){var g=f&&f.row(a,1),h=g&&g.node();if(h){var i=null;if(h&&h.children&&h.children.length)for(var j=0;j<h.children.length&&!i;j++)h.children[j].classList.contains("gridxRowTable")&&(i=h.children[j]);var k=i&&i.children[0],l=k&&k.children[0],m=l&&l.children;if(!m)return;for(var n=null,o=0;o<m.length;o++){var p=m[o];if(p&&p.getAttribute("colid")===b.id){n=p;break}}if(!n)return;var q=f.tree&&f.tree.isPaddingCell(a,b.id),r=g.cell(b.id,1);if(r.__cellNode=n,"auto"===(b.textDir||f.textDir)){var s=f.getTextDir(b.id,n.innerHTML);s&&(n.style.direction=s)}var t=d[b.id],u=c[b.id];e.currentCellValue||(e.currentCellValue={}),e.currentCellValue[a]||(e.currentCellValue[a]={});var v=e.currentCellValue[a]&&e.currentCellValue[a][b.id];e.currentCellValue[a][b.id]=u;var w=t&&t.formattedValue,x=u&&u.formattedValue,y=v&&v.formattedValue,z=void 0,A=ionweb.tables.isHtmlFast(w)||ionweb.tables.isHtmlFast(x)||ionweb.tables.isHtmlFast(y);if(A||!ionweb.equals(u.style,t.style)||v&&!ionweb.equals(v.style,u.style)||(z=1===n.childNodes.length&&n.childNodes[0]||null,z&&z.children.length>0&&(z=null)),
z)z.textContent=x,r.__justTextContentChanged=!0;else{var B=g.visualIndex(),C=e._buildCellContent(b,a,r,B,q),D=r.column.def(),E=D&&(!D.needCellWidget||D.needCellWidget(r))&&D.widgetsInCell;E||(ionweb.dom.clearNode(n),"string"==typeof C?n.innerHTML=C:n.appendChild(C))}e.onAfterCell(r,h)}}},_buildCellContent:function(a,b,c,d,f,g){this.throttleDictionaryDelete(b,a.id);var h=void 0===g&&c?c.data():g;if(!f){var i=a.decorator?a.decorator(h,b,d,c):h;if(null===i||"undefined"==typeof i||"string"==typeof i){var j=this._wrapCellData(i,b,a.id),k=""!==j&&null!==j&&void 0!==j||!(e("ie")<8||this.arg("stuffEmptyCell"))?j:"&nbsp;";return k}return i}return e("ie")<8||this.arg("stuffEmptyCell")?"&nbsp;":""},startThrottleUpdateInterval:function(){var a=this,b=100;a.throttleCellUpdateInterval||(a.throttleCellUpdateInterval=setInterval(function(){var b=!1;a.throttleCellUpdateDictionary&&Object.keys(a.throttleCellUpdateDictionary).forEach(function(c){var d=a.throttleCellUpdateDictionary[c];d&&Object.keys(d).forEach(function(d){var e=a.throttleCellUpdateDictionary[c],f=e&&e[d];e&&(b=!0,f?(a.processUpdate(f.rowId,f.col,f.curData,f.oldData),e[d]=null):delete e[d])})}),b||(clearInterval(a.throttleCellUpdateInterval),a.throttleCellUpdateInterval=null,a.throttleCellUpdateDictionary=null,a.currentCellValue=null)},b))},throttleDictionaryDelete:function(a,b){var c=this;if(c.throttleCellUpdateDictionary){var d=c.throttleCellUpdateDictionary[a];d&&(delete d[b],0===Object.keys(d).length&&delete c.throttleCellUpdateDictionary[a])}},throttleDictionaryContains:function(a,b){var c=this;if(!c.throttleCellUpdateDictionary)return!1;var d=c.throttleCellUpdateDictionary[a];if(!d)return!1;var e=d[b];return!("undefined"==typeof e)},throttleDictionarySet:function(a,b,c){var d=this;d.throttleCellUpdateDictionary||(d.throttleCellUpdateDictionary={});var e=d.throttleCellUpdateDictionary[a];return e?void(d.throttleCellUpdateDictionary[a][b]=c):d.throttleCellUpdateDictionary[a]={}},throttleDictionaryGet:function(a,b){var c=this;if(c.throttleCellUpdateDictionary){var d=c.throttleCellUpdateDictionary[a];if(d)return d[b]}},_onSet:function(a,b,c,d,e){var f=this;if(f.autoUpdate&&c){var h=f.grid,i=h.row(a,1),j=i&&i.node();if(j){var k=c.data,l=d.data,m=h._columns,n=f.arg("renderWholeRowOnSet"),o=e?m.filter(function(a){return e[a.id]}):m;o.length===m.length&&(n=!0),n?(ionweb.dom.clearNode(j),j.appendChild(f._buildCells(i,i.visualIndex())),f.onAfterRow(i),f.onSet(i),f.onRender(b,1)):g.forEach(o,function(b){var c=b.id;f.startThrottleUpdateInterval(),f.throttleDictionaryContains(a,c)?f.throttleDictionarySet(a,c,{rowId:a,col:b,curData:k,oldData:l}):(f.processUpdate(a,b,k,l),f.throttleDictionarySet(a,c,null))})}}},_blurCell:function(){return!!l(".gridxCellFocus",this.domNode).removeClass("gridxCellFocus")},_onFocus:function(a){var b=this.domNode,c=l(a.target).closest(".gridxCell",b);if(a.target==this.domNode)return!0;if(c[0]&&this._isDescendantCellNode(c[0])){var d=this.grid._columnsById[c[0].getAttribute("colid")];if(!d)return!1;var e=d.index,f=parseInt(c.closest(".gridxRow",b)[0].getAttribute("visualindex"),10);return this._focusCell(0,f,e,!1,a&&a.shiftKey)}return!1},_decorateEvent:function(a){var b=["rowId","columnId","rowIndex","visualIndex","columnIndex","parentId","cellNode"];g.forEach(b,function(b){b in a&&delete a[b]});for(var c,e=a.target||a.originalTarget,f=this.grid;e&&e!=f.bodyNode;e=e.parentNode){if(c=e.tagName&&e.tagName.toLowerCase(),"td"==c&&d.contains(e,"gridxCell")&&e.parentNode.parentNode.parentNode.parentNode.parentNode===f.bodyNode){var h=f._columnsById[e.getAttribute("colid")];a.cellNode=e,h&&(a.columnId=h.id,a.columnIndex=h.index)}if("div"==c&&d.contains(e,"gridxRow")&&e.parentNode===f.bodyNode&&(a.rowId=e.getAttribute("rowid"),a.parentId=e.getAttribute("parentid"),a.rowIndex=parseInt(e.getAttribute("rowindex"),10),a.visualIndex=parseInt(e.getAttribute("visualindex"),10)),"table"==c&&d.contains(e,"gridxRowTable")&&e.parentNode.parentNode===f.bodyNode)return e=e.parentNode,a.rowId=e.getAttribute("rowid"),a.parentId=e.getAttribute("parentid"),a.rowIndex=parseInt(e.getAttribute("rowindex"),10),void(a.visualIndex=parseInt(e.getAttribute("visualindex"),10))}}})})}(gridx||(gridx={}));var gridx;!function(a){var b=30,c=function(){function a(a){var b=this;this.setCellValue=a,this.navigable=!0;var c=this.domNode=document.createElement("div");c.className="gridxCellWidget",this._unsub=function(a){return b.onMouseDown(a)},c.addEventListener("mousedown",this._unsub)}return a.prototype.onMouseDown=function(a){a.target===this.domNode||this.cell.column.allowEventBubble||(a.cancelBubble=!0)},a.prototype.startup=function(){var a=this.cell,b=a.grid.cellWidget;a.column;this.started&&b.uninitializeCellWidget(this,a),b.initializeCellWidget(this,a),this.started=!0},a.prototype.setValue=function(a,b,c){try{this.setCellValue&&(this.domNode.className="gridxCellWidget",this.domNode.style="",this.setCellValue(a,b,this,c))}catch(a){console.error("Can not set cell value: ",a)}},a.prototype.destroyRecursive=function(){var a=this.cell.grid.cellWidget;a.onCellWidgetDestroyed(this,this.cell.column),this.domNode&&this.domNode.removeEventListener("mousedown",this._unsub)},a}(),d=function(){function a(){this.name="cellWidget",this.backupCount=b,this._init()}return a.prototype.preload=function(){var a=this.grid.body;this.batchConnect([a,"onAfterRow","_showWidgets"],[a,"onAfterCell","_showWidget"],[a,"onUnrender","_onUnrenderRow"])},a.prototype.destroy=function(){for(var a=this.grid._columns,b=a.length-1;b>=0;--b){var c=a[b],d=c._cellWidgets;if(d){for(var e in d)d[e].destroyRecursive();delete c._cellWidgets}}},a.prototype.onCellWidgetCreated=function(a,b){b.onCellWidgetCreated&&b.onCellWidgetCreated(a,b)},a.prototype.onCellWidgetDestroyed=function(a,b){b.onCellWidgetDestroyed&&b.onCellWidgetDestroyed(a,b)},a.prototype.initializeCellWidget=function(a,b){var c=b.column;c.initializeCellWidget&&c.initializeCellWidget.apply(this,arguments)},a.prototype.uninitializeCellWidget=function(a,b){var c=b.column;c.uninitializeCellWidget&&c.uninitializeCellWidget.apply(this,arguments)},a.prototype._init=function(){for(var a=this,b=this.grid._columns,c=function(c){var d=b[c];if(d.widgetsInCell){var e=d.decorator;d.decorator=function(b,c,d,f){var g=f.column;if(!g.needCellWidget||g.needCellWidget(f)){var h=a._prepareCellWidget(f);return h.startup(),h.domNode}return e(b)},d._cellWidgets={},d._backupWidgets=[]}},d=b.length-1;d>=0;--d)c(d)},a.prototype._showWidgets=function(a){var b=this;this.hasCellWidgets&&a.cells().forEach(function(a){var c=a.column.def();if(c.widgetsInCell&&(!c.needCellWidget||c.needCellWidget(a))){var d=a.contentNode();if(d){var e=b._prepareCellWidget(a);ionweb.dom.clearNode(d),d.appendChild(e.domNode),e.startup()}}})},a.prototype._showWidget=function(a){if(this.hasCellWidgets&&a){var b=a.column.def();if((!b.needCellWidget||b.needCellWidget(a))&&b.widgetsInCell){var c=this._prepareCellWidget(a),d=a.contentNode();ionweb.dom.clearNode(d),d.appendChild(c.domNode),c.startup()}}},a.prototype._prepareCellWidget=function(a){var b,d=a.column.def(),e=d._cellWidgets[a.row.id];return e?b=!1:(b=!0,e=d._backupWidgets.shift(),e||(e=new c(d.setCellValue),this.onCellWidgetCreated(e,a.column)),d._cellWidgets[a.row.id]=e),e.cell=a,e.setValue(a.data(),a.rawData(),b),e},a.prototype._onUnrenderRow=function(a){for(var b=this,c=this.grid._columns,d=0,e=c.length;d<e;++d)b.detachCellWidget(a,c[d])},a.prototype.detachCellWidget=function(a,b){var c=this.arg("backupCount"),d=function(a,b){var d=a._cellWidgets[b];a._backupWidgets.length<c?(d.domNode.parentNode&&d.domNode.parentNode.removeChild(d.domNode),a._backupWidgets.push(d)):d.destroyRecursive()},e=b._cellWidgets;if(e)if(this.model.isId(a))e[a]&&(d(b,a),delete e[a]);else{for(var f in e)d(b,f);b._cellWidgets={}}},a}();a.registerModule("ion/CellWidget",["dojo/_base/declare","gridx/core/_Module","gridx/modules/NavigableCell"],function(a,b){var c=d.prototype;return c.name="cellWidget",c.required=["navigableCell"],a(b,c)})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/ColumnSelection",["dojo/_base/declare","dojo/_base/array","dojo/_base/event","dojo/query","dojo/_base/lang","dojo/_base/sniff","dojo/dom-class","dojo/mouse","dojo/keys","gridx/core/_Module","gridx/modules/extendedSelect/Column"],function(a,b,c,d,e,f,g,h,i,j,k){return a(k,{_init:function(){var a=this,b=a.grid;a.batchConnect([b,"onHeaderCellMouseDown",function(c){h.isLeft(c)&&c.ctrlKey&&!c.shiftKey&&!g.contains(c.target,"gridxArrowButtonNode")&&(a._start({column:c.columnIndex},b._isCtrlKey(c),!1),c.ctrlKey||a.arg("canSwept")||a._end())}],[b,"onHeaderCellMouseOver",function(b){a._highlight({column:b.columnIndex})}],[b,"onCellMouseOver",function(b){a._highlight({column:b.columnIndex})}],[b,f("ff")<4?"onHeaderCellKeyUp":"onHeaderCellKeyDown",function(d){d.keyCode!=i.SPACE&&d.keyCode!=i.ENTER||g.contains(d.target,"gridxArrowButtonNode")||(c.stop(d),a._start({column:d.columnIndex},b._isCtrlKey(d),d.shiftKey),a._end())}],[b.header,"onMoveToHeaderCell","_onMoveToHeaderCell"])},_focus:function(a){var b=this.grid;if(b.focus){var c=d('[colid="'+b._escapeId(b._columns[a.column].id)+'"].gridxCell',b.header.domNode);c&&c.length&&b.header._focusNode()}},_onRender:function(a,c){var e,f,h,i=a+c,j=this.grid,k=j.bodyNode,l=b.filter(j._columns,function(a){return a._selected});for(e=l.length-1;e>=0;--e)for(f=a;f<i;++f){var m=d(['[visualindex="',f,'"] [colid="',j._escapeId(l[e].id),'"]'].join(""),k);m&&m.length&&(h=m[0],g.add(h,"gridxColumnSelected"),h.setAttribute("aria-selected",!0))}}})})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/ExpandableGroupHeader",["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/sniff","dojo/dom-class","dojo/dom-construct","dojo/keys","dojo/query","gridx/modules/GroupHeader"],function(b,c,d,e,f,g,h,i,j,k){return c(k,{preload:function(a){var b=this;this._skipSub=!0,this.inherited(arguments);var c=this.grid._escapeId;this.grid.columnResizer&&this.aspect(this.grid.columnResizer,"onResize",function(a,d){d!=b.grid._columnsById[a].width&&j('[colid="'+c(a)+'"]',b.grid.domNode).forEach(function(a){var b=a.style;b.width=d,b.minWidth=d,b.maxWidth=d})})},_build:function(){function b(b){function f(a,b){function c(){return!!$(a).data("bs.tooltip")}function d(){c()&&$(a).tooltip("destroy")}function f(){n&&(s.cancel(n),n=null)}function g(){$(a).is(":hover")||(f(),d())}function i(){f();var c=0;if(b.alias&&b.alias!==b.name||b.description||b.tooltip||(o&&$(o).remove(),o=h.create("label"),o.innerText=b.name,$("body").append(o),c=$(o).width(),$(o).remove(),!($(a).width()>=c))){var d='<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner ion-accent-bg" style="white-space: pre-line; text-align: left;"></div>';$(a).tooltip({title:b.tooltip||b.name+(b.description?"<br/>"+b.description:""),template:d,html:!0,container:"body",trigger:"manual",placement:"auto bottom"}),n=s(g,300,0)}}function j(b){p||(p=!p&&setTimeout(function(){$(a).is(":hover")&&(i(),c()&&$(a).tooltip("show"))},1e3))}function k(a){f(),clearTimeout(p),p=void 0,d()}function l(){$(a).bind("mouseenter",j),$(a).bind("mouseleave",k),$(a).bind("mousedown",k)}function m(){$(a).unbind("mouseenter",j),$(a).unbind("mouseleave",k),$(a).unbind("mousedown",k)}var n,o,p;e.unregister.push(function(){m(),f(),d(),o&&$(o).remove()}),l()}function i(a){for(var b=0;b<u.length;b++)if(u[b].id===a)return u[b]}function j(a){var b;b=a?a:r;for(var d=0,e=b.length;d<e;d++){var f=b[d],g=c-v;if(v>=c)break;var h=f.children&&"number"!=typeof f.children[0];u[u.length]={id:f.id,columnCount:g>=f.colCount?f.colCount:g},h?j(f.children):v+=f.colCount}}function k(b){return"number"==typeof b&&(b=Math.min(b,a.PIVOT_HEADER_MAX_SHADE_LEVEL)),b}function l(){var a=w.ownerDocument.createElement("tr");w.appendChild(a);for(var c=0,e=this,g=0,h=r.length;g<h;++g){var j=r.shift();if("number"==typeof j){var l,s=j;if(b&&u.length>0){var v=o[c],x=i(v.groupId);s=x?x.columnCount>o.length?-1:x.columnCount:-1}for(var y=0;y<s;++y){var v=o[c+y],z=v.headerClass,A=v.headerStyle,B=v.width;v._domId=(m.id+"-"+v.id).replace(/\s+/,""),l=a.ownerDocument.createElement("td"),l.setAttribute("role","columnheader"),l.setAttribute("aria-readonly","true"),l.setAttribute("tabindex","-1"),l.setAttribute("id",v._domId),l.setAttribute("colid",v.id),q-p&&l.setAttribute("rowspan",q-p+1);var C="gridxCell gridxMeasureHeader ";C+=p?"gridxSubHeader pivot-header-level-"+k(v.levelInfo)+(v.borderNode?" border-node":""):"pivot-header-level-"+k(v.levelInfo)+(v.borderNode?" border-node":""),n&&"header"===n.currentArea()&&v.id===e._focusHeaderId&&(C+=e._focusClass),C+=(z&&d.isFunction(z)?z(v):z)||"",l.setAttribute("class",C),l.setAttribute("draggable",!0);var D="width:"+B+";min-width:"+B+";max-width:"+B+";";if(D+=m.getTextDirStyle(v.id,v.name),D+=(A&&d.isFunction(A)?A(v):A)||"",b){l.setAttribute("locked",!0);var E=$(m.header.innerNode).find("td[id='"+v._domId+"']");D+=" height: "+E.innerHeight()+"px; "}l.setAttribute("style",D);var F=l.ownerDocument.createElement("div");F.setAttribute("class","gridxSortNode");var G=m.getCustomColumnHeader&&m.getCustomColumnHeader(v.id);G?(F.setAttribute("class","gridxSortNode gridxCustomSortNode"),F.appendChild(G)):F.innerText=v.alias||v.name||"";var H=l.ownerDocument.createElement("div");H.setAttribute("class","gridxCellContainer"),b&&H.setAttribute("style","display: inline-block;"),H.appendChild(F),l.appendChild(H),a.appendChild(l),f(H,v)}o.splice(c,j)}else{c+=j.colCount;var I=!0;if(b&&u.length>0&&(I=void 0!=i(j.id)),I){r=r.concat(j.children),l=a.ownerDocument.createElement("td"),a.appendChild(l),l.setAttribute("tabindex",-1),l.setAttribute("colspan",j.colCount),l.setAttribute("class","gridxGroupHeader "+(p?"gridxSubHeader ":"")+(j.additionalClass||"")+" pivot-header-level-"+k(j.levelInfo)+(j.borderNode?" border-node":"")),l.setAttribute("groupid",j.id),p&&l.setAttribute("parentid",j.groupId);var F=l.ownerDocument.createElement("div");F.setAttribute("class","gridxSortNode");var H=l.ownerDocument.createElement("div");H.setAttribute("class","gridxCellContainer"),H.appendChild(F),l.appendChild(H);var J=function(a){if(a.name){if(0!==a.state)if(2===a.state){var b=F.ownerDocument.createElement("div");b.setAttribute("class","loader"),F.appendChild(b)}else{var c=F.ownerDocument.createElement("span");c.setAttribute("class","expandButton ionicon "+(1==a.state?"ionicon-expand":"ionicon-collapse"));var d=a.id;c.onclick=function(){t(d)},F.appendChild(c)}var e=F.ownerDocument.createTextNode(a.name);F.appendChild(e)}};J(j)}}}p++}void 0===b&&(b=!1);var m=e.grid,n=m.focus,o=m._columns.slice(),p=0,q=e._parse(),r=e.groups.slice(),s=m.intervalService(),t=e.arg("onExpandClick")||function(){},u=[],v=0;e.unregister=[];var w=e.innerNode.ownerDocument.createElement("table");for(w.setAttribute("role","presentation"),w.setAttribute("border","0"),w.setAttribute("cellpadding","0"),w.setAttribute("cellspacing","0"),w.setAttribute("height","24px"),b&&(w.style.position="absolute",w.style.top="0",w.setAttribute("class","gridxLockedHeadersTable"),w.style.left="0px",w.style.marginLeft="inherit",j()),e._configMoveColumn();r.length;)l();for(;!b&&e.innerNode.childNodes.length>0;)$(e.innerNode.childNodes[0]).remove();e.innerNode.appendChild(w),g.toggle(e.domNode,"gridxHeaderRowHidden",e.arg("hidden")),g.add(m.domNode,"gridxGH")}var c,e=this;b(),e.grid.columnLock&&e.grid.columnLock.count&&e.grid.columnLock.count<=e.grid._columns.length&&(c=e.grid.columnLock.count,b(!0))},getGroupHeaderNode:function(a){return j("[groupid='"+this.grid._escapeId(a)+"']",this.domNode)[0]},destroy:function(){this.unregister&&this.unregister.forEach(function(a){return a()}),this.inherited(arguments)},_onHScroll:function(a){(this.grid._isLoaded||a)&&this.inherited(arguments)}})})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/Exporter",["dojo/_base/lang","dojo/_base/Deferred","dojo/_base/array"],function(a,b,c){function d(a,b,c,d){return!a[b]||!1!==a[b](c||d,d)}function e(a,b,d){var e,f=[],g=0,h=0,i=a.progressStep;if("number"==typeof a.start&&a.start>=0&&(g=a.start),"number"==typeof a.count&&a.count>0&&(h=g+a.count),h=h||d,b)if(b=c.filter(b,function(a){return a>=g&&a<h}),b.length&&(!i||b.length<=i))f.push(b);else for(e=0;e<b.length;e+=i)f.push(b.slice(e,e+i));else{var j=h-g;if(!i||j<=i)f.push({start:g,count:j});else for(e=g;e<h;e+=i)f.push({start:e,count:e+i<h?i:h-e})}return f.p=0,f}function f(b,c){return a.isArray(b)?{p:0,row:c.row(b[0])}:{p:b.start,row:c.row(b.start)}}function g(b,c,d){var e=d.p+1,f=a.isArray(b);return e<(f?b.length:b.start+b.count)?{p:e,row:c.row(f?b[e]:e)}:null}function h(b,c){var d=b.formatters,e=c.column.id;return d&&a.isFunction(d[e])?d[e](c):b.useStoreData?c.rawData()||"":c.data()||""}function i(b,c,e,j,k,l,m){var n=k.filter,o=j.columnIds,p=m[m.p++],q=a.hitch(l,l.errback),r=function(){c.progress(m.p/m.length),b.when(p,function(){for(var a=f(p,b);a&&a.row;a=g(p,b,a))if(j.row=a.row,(!n||n(a.row))&&d(e,"beforeRow",j,k)){for(var c=0;c<o.length;++c){var i=b.column(o[c],1),l=j.cell=b.cell(a.row,i);j.column=i,j.data=h(k,l),d(e,"handleCell",j,k)}d(e,"afterRow",j,k)}}).then(function(){i(b,c,e,j,k,l,m)},q)};p?m.length>1?setTimeout(r,10):r():l.callback()}function j(b,d){var e,f=b._columnsById,g=b.select;g&&g.column;return a.isArrayLike(d.columns)&&d.columns.length?(e=c.filter(d.columns,function(a){return f[a]}),e.sort(function(a,b){return f[a].index-f[b].index})):e=c.map(b._columns,function(a){return a.id}),e}function k(f,g,h){var k=h.omitHeader;k=!0;var l,m,n=new b,o=f.model,p=j(f,h),q=f.select,r=q&&q.row,s=q&&q.column,t={grid:f,columnIds:p},u=function(){d(g,"afterBody",t,h),n.callback(g.getResult())},v=a.hitch(n,n.errback);try{d(g,"initialize",t,h),!k&&d(g,"beforeHeader",t,h)&&(c.forEach(p,function(a){t.column=f.column(a,1),d(g,"handleHeaderCell",t,h)}),d(g,"afterHeader",t,h)),d(g,"beforeBody",t,h)?(!h.selectedOnly||!r||s&&s.getSelected().length||(l=o.when().then(function(){m=r.getSelected()},v)),b.when(l,function(){var a,d=m&&o.when({id:m},function(){a=c.map(m,function(a){return o.idToIndex(a)}),a.sort(function(a,b){return a-b})},v);b.when(d,function(){var c=new b,d=o.size();i(f,n,g,t,h,c,e(h,a,d)),c.then(u,v)},v)},v)):n.callback(g.getResult())}catch(a){v(a)}return n}return k})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/ExtendedSelectCell",["dojo/_base/declare","dojo/_base/array","dojo/_base/event","dojo/query","dojo/_base/lang","dojo/_base/sniff","dojo/dom-class","dojo/mouse","dojo/keys","gridx/core/_Module","gridx/modules/extendedSelect/Cell"],function(a,b,c,d,e,f,g,h,i,j,k){return a(k,{name:"extendedSelectCell",_onRender:function(a,b){var c,e,f=this,h=f.model,i=f.grid,j=i._columns,k=a+b;for(c=0;c<j.length;++c){var l=j[c].id,m=f._getMarkType(l);if(h.getMarkedIds(m).length)for(e=a;e<k;++e){var n=f._getRowId(e);if(h.getMark(n,m)||f._selecting&&f._toSelect&&f._inRange(c,f._startItem.c,f._currentItem.c,1)&&f._inRange(e,f._startItem.r,f._currentItem.r,1)){var o=d('[visualindex="'+e+'"] [colid="'+i._escapeId(l)+'"]',i.bodyNode);o&&o.length&&g.add(o[0],"gridxCellSelected")}}}}})})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/HeaderRegions",["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/array","dojo/query","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojo/keys","dojo/_base/event","gridx/core/_Module","gridx/core/Column","gridx/modules/HeaderRegions","dojo/mouse","dojo/on"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){for(var b=0;b<a.length;b++)if(0===a[b].indexOf("pivot-header-level"))return a[b]}return j.register(a(l,{constructor:function(){function a(a,c,d){return function(a){var c=null;"enter"==d?b.mouseOverEventHandlers.forEach(function(c){var d=$(a.target).parents('[role="columnheader"]'),e=d.first().attr("colid");b.itemScheduledForMouseOut[e]&&(clearTimeout(b.itemScheduledForMouseOut[e]),delete b.itemScheduledForMouseOut[e]),e!==b.mouseOverId&&(b.mouseOverId=e,c.call(b,a))}):b.mouseOutEventHandlers.forEach(function(d){var e=$(a.target).parents('[role="columnheader"]'),f=e.first().attr("colid");b.itemScheduledForMouseOut[f]=c=setTimeout(function(){f==b.mouseOverId&&(b.mouseOverId=null),d.call(b,a)})})}}this.mouseOverEventHandlers=[],this.mouseOutEventHandlers=[];var b=this;this.itemScheduledForMouseOut={};var c=this,d=c.grid;d.on(n.selector('td[role="columnheader"] *',m.enter),a(d,"header","enter")),d.on(n.selector('td[role="columnheader"] *',m.leave),a(d,"header","left"))},addColumnMouseOverEvent:function(a){this.mouseOverEventHandlers.push(a)},addColumnMouseOutEvent:function(a){this.mouseOutEventHandlers.push(a)},_focusRegion:function(a){},getColumn:function(a,b){var c=ionweb.tables.fromRowHeaderId(a);return null!==c&&c>=-1?{id:a,name:function(){return""}}:this.grid.column(a,b)},refresh:function(a){var b=this,g=b.grid,h=b._regionNodes=[],i=b._regions;i.length&&(c.forEach(b._regionCnnts||[],function(a){a.remove(),b._cnnts.splice(c.indexOf(b._cnnts,a),1)}),b._regionCnnts=[],i.sort(function(a,b){return b.p-a.p}),d(".gridxCell",g.header.domNode).forEach(function(a){f.remove(a,"gridxCellRegion");var g=a.getAttribute("colid"),j=b.getColumn(g,1),k=[],l=d(".headerRegionsContainer",a)[0];l&&l.parentNode.removeChild(l),l=a.ownerDocument.createElement("div"),$(l).addClass("headerRegionsContainer"),c.forEach(i,function(c){var d=c.n[g];d&&d.parentNode&&d.parentNode.removeChild(d),d=c.n[g]=c.c(j);var h=o(a.classList);h&&$(d).addClass(h),d&&(f.add(d,"gridxHeaderRegion"),c.f&&(f.add(d,"gridxHeaderRegionFocusable"),d.setAttribute("tabindex",-1),b.connect(d,"onblur","_onRegionBlur"))),d&&(e.place(d,l,"first"),c.f&&k.push(d))});var m=d(".gridxCellContainer",a)[0];if(m&&e.place(l,m,"last"),k.length){var n=d(".gridxSortNode",a)[0];h.push(n),n.setAttribute("tabindex",-1),b._regionCnnts.push(b.connect(n,"onblur","_onRegionBlur"))}else h.push(a),f.add(a,"gridxCellRegion"),b._regionCnnts.push(b.connect(a,"onblur","_onRegionBlur"));h.push.apply(h,k)}),h[b._curRegionIdx]||(b._curRegionIdx=0))}}))})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/HScroller",["dojo/_base/declare","dojo/dom-style","dojo/_base/sniff","dojo/_base/Deferred","dojo/query","dojox/html/metrics","gridx/modules/HScroller"],function(a,b,c,d,e,f,g){return a(g,{preload:function(){var a=this,b=a.grid,d=b.hScrollerNode;b.autoWidth||(b.vLayout.register(a,"container","footerNode",0),d.style.display="block",a.aspect(b.columnWidth,"onUpdate","refresh"),a.connect(d,"onscroll","_onScroll"),b.dod&&a.connect(b.bodyNode,"onscroll",function(){a.domNode.scrollLeft=b.bodyNode.scrollLeft}),(c("ie")||c("trident"))&&(d.style.height=f.getScrollbar().h+2+"px")),this.disableVirtualColumns=this.arg("disableVirtualColumns"),this.showColumnSeparators=this.arg("showColumnSeparators")},_deferVirtualScroll:ionweb.throttle(function(){this._onVirtualScroll()},250),_onVirtualScroll:function(){var a=this._getVisibleColumns();a&&this.grid.body.refresh(void 0,!0)},showColumnSeparatorsChanged:function(a){!!this.showColumnSeparators!=!!a&&(this.showColumnSeparators=a,this.grid._destroyed||(this.grid.body.refresh(void 0,!0),this.grid.header.refresh()))},_getVisibleColumns:function(){var a=this;if(this.disableVirtualColumns)return null;var b=this,c=b.grid,d=c._columns,e=1,f=function(b){return a.showColumnSeparators?0===b?0:e:0},g=function(a,b){return parseFloat(a.width)+f(b)},h=[];if(d&&d.length){var i=0,j=0;if(c.columnLock&&d.length&&(i=c.columnLock.lockedColumnsCount(),i<=d.length))for(var k=0;k<i;k++)j+=g(d[k],k);var l=(c.bodyNode.clientWidth||0)-j,m=l?Math.floor(l/2):0,n=b.domNode.scrollLeft;l&&(l+=m,n&&(l+=m,n-=m));var o=0,p=0,q=0,r=0;for(i&&(h.push({start:0,count:i,widthBefore:0,widthAfter:0}),p=i);p<d.length&&o+g(d[p],p)<n&&o<n;){var s=g(d[p],p);q+=s,o+=s,p++}for(var t=p,u=0,v=0;p<d.length&&(l>0||!v);)l-=g(d[p],p),p++,u++,v++;for(;p<d.length;){var s=g(d[p],p);p++,r+=s}i&&this.showColumnSeparators&&q&&(q-=e),h.push({start:t,count:u,widthBefore:q,widthAfter:r})}for(var w=0,x=!0,y=function(a){var b=d[a],c=!1;h.forEach(function(b){var d=b.start,e=b.start+b.count-1;a>=d&&a<=e&&(c=!0)}),c?(b.index=w++,x=!0):(b.index=-1,x&&w++,x=!0)},z=0;z<d.length;z++)y(z);return h},_onScroll:function(a){var b=this,d=b.domNode.scrollLeft;(c("webkit")||c("ie")<8)&&!b.grid.isLeftToRight()&&(d=b.domNode.scrollWidth-b.domNode.offsetWidth-d),b._lastLeft=d,b._doScroll(),b._deferVirtualScroll()},getScrollPosition:function(){return this._lastLeft},refresh:function(){if(this.grid._isLoaded){var a=this,c=a.grid,d=c.isLeftToRight(),e=c.hLayout.lead,f=c.hLayout.tail,g=(c.domNode.clientWidth||b.get(c.domNode,"width"))-e-f,h=c.header.innerNode,i=b.get(h,d?"paddingLeft":"paddingRight")||(c.columnLock&&c.columnLock.count?$(c.header.innerNode).find(".gridxLockedHeadersTable").width():0),j=a.domNode.style,k=h.firstChild.offsetWidth,l=j.display,m=k<=g?"none":"block";j[d?"marginLeft":"marginRight"]=e+i+"px",j[d?"marginRight":"marginLeft"]=f+"px",j.width=(g-i<0?0:g-i)+"px",a.stubNode.style.width=(k-i<0?0:k-i)+"px",j.display=m,l!=m&&c.vLayout.reLayout()}},scroll:function(a){(this.grid._isLoaded||a)&&this.inherited(arguments)},scrollToColumn:function(a){var b=this.grid.columnLock&&this.grid.columnLock.lockedColumnsCount(),c=!1;if(b>0)for(var d=this.grid._columns,e=0;e<b;e++)if(d[e]&&d[e].id===a){c=!0;break}c||this.inherited(arguments)}})})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/ModifiableNestedSort",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/event","dojo/query","dojo/string","dojo/dom-class","dojo/dom-construct","dojo/mouse","dojo/keys","gridx/core/_Module"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b.filter,m=b.indexOf;g.remove,g.add;return k.register(a(k,{name:"sort",required:["headerRegions"],columnMixin:{isSorted:function(){return this.grid.sort.isSorted(this.id)},isSortable:function(){return this.grid.sort.isSortable(this.id)}},getSortData:function(){return this._sortData},constructor:function(a){this.toggleFunction=a.nestedSortToggleFunction},setState:function(a,b){a.forEach(function(a){null!=a.level&&(a.colId=ionweb.tables.toRowHeaderId(a.level))}),this._sortResponsiveConfig=b,this._sortData=a,this._updateUI()},isValidSortingKeys:function(a){var b=a.altKey||a.metaKey;return!b&&(a.shiftKey&&a.ctrlKey||!a.shiftKey&&!a.ctrlKey)},preload:function(a){var b=this,d=b.grid;if(b._sortData=b.arg("initialOrder",[]),d.persist){var e=d.persist.registerAndLoad("sort",function(){return b._sortData});e&&(b._sortData=e)}b._sortData=l(b._sortData,function(a){return b.isSortable(a.colId)}),b._sortData.length&&d.model.sort(b._sortData),b.connect(d.headerRegions,"refresh",b._updateUI),d.headerRegions.add(c.hitch(b,b._createBtn,1),10,1)},load:function(){var a=function(a){for(var b=a.target;b;){var c=b.getAttribute("colid");if(c)return c;b=b.parentElement}return null},b=this;this.grid.headerNode.addEventListener("click",function(c){if(i.isLeft(c)&&b.isValidSortingKeys(c)){var d=a(c);if(d){var e=ionweb.tables.toKeyOrLevel(d);b.toggleFunction(e,c.shiftKey&&c.ctrlKey)}}})},isRowHeaderColumn:function(a){var b=ionweb.tables.fromRowHeaderId(a);return null!==b&&b>=-1},isSortable:function(a){if(this.isRowHeaderColumn(a))return!0;var b=this.grid._columnsById[a];return b&&(b.sortable||void 0===b.sortable)},_setWaiState:function(a,b,c){var d=this,f=e(".iongridSortContainer",a)[0],g=function(){"none"!==f.style.display&&(f.style.display="none")},i=function(a){f.style.display="",f.innerHTML="";var b=h.create("div",{class:"iongridSortedBackground iongridSortedBackground"+(1===d._sortData.length?"Single":"Multiple")});if(b.innerHTML=a.descending?"&#x25bc;":"&#x25b2;",f.appendChild(b),1!==d._sortData.length){var c=h.create("div",{class:"iongridSortedCounter"+(a.descending?"Descending":"Ascending")});c.innerHTML=m(d._sortData,a)+1,f.appendChild(c)}};if(f){var j=this._sortResponsiveConfig,k=j&&j.groupToColumns[b];if(k){var l=b,n=[],o=this._sortData;if(o.forEach(function(a){k.forEach(function(b){b===a.colId&&n.push(a)})}),n.length){var p=j.groupToSortingKey[l],q=n.filter(function(a){return a.colId===p}),r=q.length;r?i(q[0]):g()}else g()}else c?i(c):g()}},_createBtn:function(a,b){var c=this,d=(c.grid.nls,h.create("div",{class:"iongridSortContainer",tabIndex:-1}));return d},_updateUI:function(){var a=this,b=(this._sortData||[]).reduce(function(b,c){return c.colId&&a.grid.headerRegions.getColumn(c.colId)&&(b[c.colId]=c),b},{});e(".gridxCell",this.grid.header.domNode).forEach(function(c){var d=c.getAttribute("colid");a.isSortable(d)&&a._setWaiState(c,d,b[d])})},isSorted:function(a){var c=0;return b.some(this._sortData,function(b){if(b.colId==a)return c=b.descending?-1:1,1}),c},clear:function(){this._sortData.length=0,this._doSort()},_doSort:function(){var a=this.grid,b=this._sortData;this._updateUI(),a.model.sort(b.length?b:null),a.body.refresh()}}))})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/PivotColumnLock",["dojo/_base/declare","dojo/_base/sniff","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/query","gridx/core/_Module","gridx/modules/ColumnLock"],function(a,b,c,d,e,f,g,h){return g.register(a(h,{freezeBg:null,lockedColumnsCount:function(){return this.count||0},load:function(a,b){this.count=this.arg("count");var c=this,d=this.grid;b.then(function(){d.columnWidth&&d.columnWidth.arg("autoResize")||(d.header&&(d.header.loaded.then(function(){c._updateHeader()}),d.move&&d.move.column&&c.connect(d.move.column,"move","_updateHeader")),c._hackHScroller(),c.count&&c.lock(c.count)),d.rowLock&&(c.connect(d.rowLock,"onLock",function(){c.grid.hScroller&&c.grid.hScroller._doScroll()}),c.connect(d.rowLock,"onUnlock",function(a){for(var b=c.grid.bodyNode.childNodes,d=0;d<a;d++)c._lockColumns(b[d])})),c.loaded.callback(),c.grid.body.connect(c.grid,"_onResizeEnd",function(a){this.grid.columnLockService.getLockedColumnsCount()&&(c.grid._columns.length&&c._shouldApplyFreeze(this.grid.columnLockService.getLockedColumnsCount())?c.count||(c.lock(c.grid.columnLockService.getLockedColumnsCount()),c.grid.body.refresh()):c.count&&(c.unlock(),c.grid.body.refresh()))})})},udpateFrozenColumnHeightOnResize:function(){for(var a=$(this.grid.domNode).find("td[locked='true']"),b=0;b<a.length;b++){var c=$(this.grid.domNode).find("td[id='"+a[b].getAttribute("id")+"']").not("td[locked='true']"),d=c&&$(c).outerHeight()+"px";$(a[b]).css({height:d})}},lock:function(a){if(!this.grid.columnWidth||!this.grid.columnWidth.arg("autoResize")){if(this.unlock(),a){if(!this._shouldApplyFreeze(a))return;this.freezeBg=document.createElement("div"),this.freezeBg.style.height="100%",this.freezeBg.style.position="absolute",c.add(this.freezeBg,"gridx-frozen-columns-bg"),this.grid.mainNode.appendChild(this.freezeBg),c.add(this.grid.domNode,"gridxColumnLock");var b=this,d=this.grid;d.columnWidth&&d.columnWidth.arg("autoResize")||(b.connect(d.body,"onAfterRow",function(a){b._lockColumns(a.node())}),d.columnResizer&&b.connect(d.columnResizer,"onResize",function(a,c){for(var e=d.columns(),f=!1,g=0;g<this.count;g++)if(g<e.length&&e[g].id===a){f=!0;break}f&&(this._updateHeader(),this._updateBody(void 0)),b.udpateFrozenColumnHeightOnResize()}),b.connect(d,"_onResizeEnd","_updateHorizontalScroller"))}this.count=a,this._updateUI()}},unlock:function(){if(this.freezeBg&&this.freezeBg.parentNode&&this.freezeBg.parentNode.removeChild(this.freezeBg),this._cnnts&&this._cnnts.forEach(function(a){a.remove()}),!this.grid.columnWidth||!this.grid.columnWidth.arg("autoResize")){c.remove(this.grid.domNode,"gridxColumnLock");for(var a=this.grid.bodyNode.childNodes,b=0;b<a.length;b++)this._unlockColumns(a[b],null);this.count=0,this.grid.header._build(),this._updateUI()}},_unlockColumns:function(a){for(var b=this.grid.isLeftToRight(),e=a.firstChild.rows[0],f=0;f<this.count;f++){var g=e.cells[f];g&&(c.remove(g,"gridxLockedCell"),c.remove(g,"gridxLockedCellRightBorder"),d.set(g,{height:"auto"}))}a.style[b?"paddingLeft":"paddingRight"]="0px",a.style.width="auto",a.firstChild.style.height="auto";
},_lockColumns:function(a){if(!this.count||this.count>this.grid._columns.length||!a.firstChild.rows)return void(this.freezeBg&&this.freezeBg.parentNode&&this.freezeBg.parentNode.removeChild(this.freezeBg));this.grid.mainNode.appendChild(this.freezeBg);var f,g=c.contains(a,"gridxHeaderRowInner"),h=this.grid.isLeftToRight(),i=a.firstChild.rows[0];for(a.firstChild.style.height="auto",f=0;f<this.count;f++){var j=i.cells[f];j&&d.set(j,"height","auto")}var k=i.cells[i.cells.length-1];if(k){var l,m;if(b("ie")>8||b("trident")>4){var n=d.getComputedStyle(a.firstChild).height;String(n).toString().indexOf(".")>=0&&(m=l=k.getBoundingClientRect().height)}else l=e.getContentBox(k).h,m=e.getMarginBox(k).h;"auto"!=a.firstChild.style.height&&d.set(a.firstChild,"height",m+"px");var o=g?this.grid.hLayout.lead:0,p=o;this.grid._columns;for(f=0;f<this.count;f++){var q=i.cells[f],r={height:l+"px"};q&&(this.count<i.cells.length?(c.add(q,"gridxLockedCell"),r[h?"left":"right"]=p+"px",p+=q.offsetWidth):(r.position="relative",r[h?"left":"right"]="0px"),f==this.count-1&&c.add(q,"gridxLockedCellRightBorder"),d.set(q,r))}a.firstChild.style[h?"paddingLeft":"paddingRight"]=p-o+"px",a.scrollLeft=this.grid.hScroller?this.grid.hScroller.domNode.scrollLeft:0,this.freezeBg.style.width=p-o+"px"}},_updateHeader:function(){this.grid.header._build(),this.grid.headerRegions.refresh()},_updateBody:function(a){if(!a||a._updateBody!==!1){var b=this.grid.bodyNode&&this.grid.bodyNode.childNodes;if(b)for(var c=0;c<b.length;c++)this._lockColumns(b[c],null)}},_shouldApplyFreeze:function(a){for(var b=0,c=0;c<a;c++){var d=this.grid._columns[c];d&&(b+=this.grid.columnResizer.getCachedColumnWidth(d.id)||ionweb.tables.grid.DEFAULT_COLUMN_WIDTH_NUMBER)}return b<this.grid.bodyNode.offsetWidth-50},_updateHorizontalScroller:function(){this.grid.hScroller.refresh()}}))})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/Printer",["ion/RowHeader","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/_base/xhr","dojo/_base/sniff","dojo/_base/window"],function(a,b,c,d,e,f,g){function h(a){function b(){++g,g==a.length&&f(h)}var c=new d,f=u(c,c.callback),g=0,h="";return a.length?a.forEach(function(a){e.get({url:a}).then(function(a){h+=a,b()},function(c){console.warn("Failed to load resource: ",a),b()})}):f(""),c}function i(a){var b=$(a)[0].querySelectorAll(".gridxHeaderRowInner");b.length>0&&$(b).css("margin-left","");var c=$(a)[0].querySelectorAll(".gridxMain");c.length>0&&$(c).css("margin-left","");var d=$(a)[0].querySelectorAll(".gridxRowHeaderHeader");d.length>0&&d[0].parentNode.removeChild(d[0]);var b=$(a)[0].querySelectorAll(".gridxRowHeaderBody");b.length>0&&b[0].parentNode.removeChild(b[0])}function j(a,b,c,d){var e,f=d.gridxHeaderRowInnerDOM;for(e=0;e<=b.length-1;e++){var g=$(f).find("td[groupid='"+b[e]+"']"),h=$(g).attr("parentid");void 0!=h&&b.indexOf(h)<0&&(b.push(h),c.push(c[e]))}k(a,b,c,d);for(var i=$(a)[0].querySelectorAll(".gridxHeaderRowInner tr"),j=0;j<i.length;j++){var l=i[j].lastChild;l&&(l.innerText.length||l.setAttribute("colspan","100%"))}}function k(a,b,c,d){var e,f=$(d.gridxHeaderRowInnerDOM)[0].querySelectorAll(".gridxGroupHeader");for(e=0;e<=f.length-1;e++){var g=b.indexOf($($(f)[e]).attr("groupid")),h=c[g];if(void 0===h?$(f[e]).remove():($(f[e]).attr("colspan",h),c.splice(g,1),b.splice(g,1)),0===b.length)break}}function l(a,b){var c=0,d=$($(a)[0].querySelectorAll("td[role='gridcell']"));for(c;c<d.length;c++){var e=(d[c],$(d[c]).attr("colid"));void 0!=e&&b.indexOf(e)<0&&$(d[c]).remove()}}function m(a,b,c,d,e){var f,g=[],h=[];if(d.length!==b.gridColumnsLength){var i="";if(!c){var k=$(a).find("td[colid^=iongrid_sortable_header]");void 0!=k&&$(k).hide()}navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&l(a,d);var m=$(b.gridxHeaderRowInnerDOM).find("td[role='columnheader']");for(f=0;f<=m.length-1;f++){i=$(m[f]).attr("colid");var n=d.indexOf(i);if(i.length>0&&n<0&&void 0==$(m[f]).attr("rowheadercolumn")&&(m[f].outerHTML=""),i.length>0&&n>=0)if(i.length>0&&i.indexOf("|")>0&&(i=i.substring(0,i.indexOf("|"))),g.indexOf(i)<0)g.push(i),h.push(1);else{var o=g.indexOf(i);o>=0&&(h[o]=h[o]+1)}if(n>=0&&d.splice(n,1),0===d.length)break}j(a,g,h,b)}}function n(a,b,c){var d,e=[],f=b.lastUsedIndex==-1;for(d=b.lastUsedIndex+1;d<b.gridColumnsLength;d++){var g=v[c._columns[d]._domId];if(g>=x&&(g=500),b.totalWidth+g>=b.pageWidth)break;var h=c._columns[d].id;void 0!=h&&e.push(h),b.totalWidth=b.totalWidth+g,b.lastUsedIndex=d}m(a,b,f,e,c)}function o(a){function b(a,b,c){var d,e,f={};for(d in b)e=b[d],d in a&&(a[d]===e||d in f&&f[d]===e)||(a[d]=c?c(e):e);return a}if(!a||"object"!=typeof a||"[object Function]"===Object.prototype.toString.call(a))return a;if(a.nodeType&&"cloneNode"in a)return a.cloneNode(!0);if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return new RegExp(a);var c,d,e;if(a instanceof Array)for(c=[],d=0,e=a.length;d<e;++d)d in a&&c.push(o(a[d]));else c=a.constructor?new a.constructor:{};return b(c,a,o)}function p(a,b,c){var d="ng-isolate-scope gridxPrintContainer";b.wrapColumnHeaders&&(d+=" ion-grid-leaf-column-headers-wrap");var e=a.document.createElement("div");e.setAttribute("class",d);var f,g=$(a.document.body).find(".claro"),h=a.document.body.appendChild(e),j=0,k=$(g)[0].querySelectorAll(".gridxRowHeaderHeader");k.length>0&&(j=$(k).outerWidth(!0));for(var l=a.document.createDocumentFragment(),m=0;m<g.length;m++){var p=!1,q=!1,r={totalWidth:j||0,pageWidth:x,originalGridDOM:g[m],lastUsedIndex:-1,leftPos:0,gridColumnsLength:0,gridxHeaderRowInnerDOM:void 0},s=$(g)[m].querySelectorAll(".gridxHeaderRowInner");for(s.length>0&&$(s).css("margin-right","");!p;){var t=o(g[m]);q&&(r.leftPos=r.leftPos+r.totalWidth,i(t),navigator.userAgent.toLowerCase().indexOf("firefox")>-1||$(t).find(".gridxMain").css("left",(r.leftPos-j)*-1+"px"),r.totalWidth=0),r.gridColumnsLength=c._columns.length,r.gridxHeaderRowInnerDOM=$(t).find(".gridxHeaderRowInner"),n(t,r,c),f=a.document.createElement("div"),f.style.cssText="overflow:hidden;page-break-after:always;width:"+r.totalWidth+";",l.appendChild(f);var u=o(t);$(u).appendTo(f).css({position:"relative"}),q=!0,p=r.lastUsedIndex>=r.gridColumnsLength-1}$(g)[m].innerHTML=""}try{h.appendChild(l)}catch(a){for(var v=angular.copy(l.childNodes),w=0,y=v;w<y.length;w++){var z=y[w];h.appendChild(z)}}}function q(a,b,c){if(!window.print)return void console.warn("Print function is not available");var d=window.open();setTimeout(function(){d&&(d.document.body.outerHTML=a,$(d.document.body).css("font",$(window.document.body).css("font")),p(d,b,c))},0)}function r(a,b,c,d){var e='<style>html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, menu, nav, output, ruby, section, summary, time, mark, audio, video { margin: 0; padding: 0; border: 0; font-size: 100%; line-height: inherit; white-space:nowrap} /* HTML5 display-role reset for older browsers */ article, aside, details, figcaption, figure, footer, header, menu, nav, section { display: block; } body { line-height: 1; } ol, ul { list-style: none; } blockquote, q { quotes: none; } blockquote:before, blockquote:after, q:before, q:after { content: ""; content: none; } table { border-collapse: collapse; border-spacing: 0; }</style>';return['<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html ',a.isLeftToRight()?"":'dir="rtl"',"><head><title>",b.title||"",'</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><base href="'+window.location.origin+'"><style type="text/css">',c,"</style>",e,b.style||"",'<style type="text/css">@media print { @page { size: A4 portrait; margin: 10mm;} body { background: none !important;} }</style>',b.customHead||"",'</head><body style="height: auto; width: auto;">',b.description||"",d,"</body></html>"].join("")}function s(a,b){s.toHTML(a,b).then(function(c){q(c,b,a)})}function t(a){var b=a.body.wrapInFragment(a.body._buildRows(0,a.rowCount(),[],[],!0)),c=g.doc.createElement("div");c.appendChild(b);var d=a.store.dataModel.getAs(ionweb.tables.PresentationDataModelAdapter),e=a.store.dataModel.getAs(ionweb.tables.ValidationDataModelAdapter);if(e&&e.getDataSet()&&e.getDataSet().validationStates){var f=Object.keys(e.getDataSet().validationStates);f.forEach(function(a){var b=$(c).find("[rowid = "+a+"]")[0],d=Object.keys(e.getDataSet().validationStates[a]);d.forEach(function(c){var d,f=$($(b).find("[colid = "+c+"]")[0]),g=e.getDataSet().getValidationState(a,c);switch(g.state){case ionweb.validation.ValidationState.Error:d=ionweb.validation.ValidationController.ErrorInnerBorderClassName;break;case ionweb.validation.ValidationState.Warning:d=ionweb.validation.ValidationController.WarningInnerBorderClassName;break;case ionweb.validation.ValidationState.Success:d=ionweb.validation.ValidationController.SuccessInnerBorderClassName}f.addClass(d)})})}else if(d){var h=a.rows(0,a.rowCount());h.forEach(function(a){if(a){var b=$(c).find('[rowid = "'+a.id+'"]')[0],e=new ionweb.tables.style.Manager(d);e.applyStyles($(b),a.id,0,[])}})}return c.innerHTML}var u=c.hitch,v={},w=navigator.userAgent.toLowerCase().indexOf("chrome")>-1?1040:900,x=720;return s.toHTML=function(b,c){var e=new d;return h(c.styleSrc).then(function(d){var f="",h=0;if(b.rowHeader){var i=new Object(a.prototype),j=i.exportRowHeaders("top",b),k=g.doc.createElement("div");k.appendChild(j.rowHeaderNode),f=k.innerHTML,h=j.height}else h=b.bodyNode.firstChild?b.bodyNode.firstChild.clientHeight*b.rowCount():0;var l="";if(b.headerNode){k=g.doc.createElement("div"),k.appendChild(b.headerNode.cloneNode(!0));var m=$(k).find(".gridxLockedHeadersTable");m&&m.remove();for(var n=$(b.headerNode)[0].querySelectorAll("td[role='columnheader']"),o=0;o<=n.length-1;o++)if(v[n[o].id]=n[o].getBoundingClientRect().width,$(n[o]).outerWidth(!0)>=x){var p=$(k).find(n[o]),q=500;$(p).css("min-width",q+"px"),$(p).css("width",q+"px")}l=k.innerHTML}for(var s=t(b),u=[],y=[],z=[],A=$(b.headerNode).outerHeight(!0),B=b.bodyNode.firstChild?b.bodyNode.firstChild.clientHeight:0,C=Math.ceil((h+A)/w),D=Math.floor((w-A)/B),E=s.split("</table></div>"),F=0,G=j&&j.rowHeaderNode&&$(j.rowHeaderNode).find("tr");C>=F+1;){u[F]=[],y[F]=[];for(var H=Math.min(E.length-1,D*(F+1)),o=F*D;o<H;o++)u[F].push(E[o]+"</table></div>"),G&&y[F].push(G[o].outerHTML);y.length&&(z[F]=f.substr(0,f.indexOf("<tr"))+y[F].join("")+"</table></div></div></div>"),F++}var I=[];if(u&&u.length>0)for(var J=0;J<u.length;J++){var K=u[J].length*B;I.push(['<div style="white-space: nowrap; -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none; overflow: visible;" class="claro" draggable="true">','<div class="gridx gridxDesktop gridxGH '+c.additionalClasses+'" role="grid" tabindex="0" aria-readonly="true" aria-label="grid" id="gridx_Grid_1" widgetid="gridx_Grid_1" aria-multiselectable="true" style="height: auto; overflow: visible;">',l,'<div class="gridxMain" role="presentation" data-dojo-attach-point="mainNode" style="height:'+K+"px; overflow: visible; margin-left:"+b.hLayout.lead+'px;margin-right: 0px;">','<div class="gridxBody gridxBodyRowHoverEffect" role="presentation" data-dojo-attach-point="bodyNode" style="height: auto; overflow: visible;">',u[J].join(""),"</div>",J<z.length&&z[J],"</div></div></div>"].join(""))}e.callback(r(b,c,d,I.join("")))}),e},s})}(gridx||(gridx={}));var gridx;!function(a){var b=function(){function a(a,b,c,d,e){this.element=a,this.x=b,this.y=c,this.w=d,this.h=e}return a.prototype.contains=function(a,b){return a>=this.x&&a<=this.x+this.w&&b>=this.y&&b<=this.y+this.h},a}();a.registerModule("ion/RowHeaderResizer",["dojo/_base/declare","dojo/_base/window","dojo/_base/event","dojo/dom","dojo/dom-style","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/keys","gridx/support/query","dojo/_base/sniff","gridx/core/_Module"],function(a,c,d,e,f,g,h,i,j,k,l,m){return a(m,{name:"rowHeaderResizer",load:function(){var a=this,b=a.grid;a.batchConnect([b.header.domNode,"onmousemove","_mousemove"],[b.header.domNode,"onmouseenter","_mouseenter"],[b,"onHeaderMouseOut","_mouseout"],[b,"onHeaderMouseDown","_mousedown",a,a.name],[c.doc,"onmousemove","_updateResizer"],[c.doc,"onmouseup","_mouseup"]),a.loaded.callback(),this.resizableAreas=[]},rowHeaderResizerMixin:{setWidth:function(a){this.grid.rowHeaderResizer.setWidth(a)}},minWidth:20,detectWidth:5,step:2,setWidth:function(a){var b=this,c=b.grid;c.rowHeader.setWidth(a),b.onResize()},calculateHandleAreas:function(){function a(a){for(var b=[],c=a.length>>>0;c--;)b[c]=a[c];return b}var c=this,d=c.grid,e=c.arg("detectWidth"),f=[],g=d.rowHeader.outlineHeadersRow?a(d.rowHeader.outlineHeadersRow.children):[];f=g.concat(d.rowHeader.headerNode),this.resizableAreas=f.map(function(a){var c=i.position(a);return new b(a,c.x+c.w-e,c.y,2*e,c.h)})},onResize:function(){this.calculateHandleAreas()},_mouseenter:function(a){this.calculateHandleAreas()},_mousemove:function(a){var b=this,d=this;if(!d._resizing&&!d._ismousedown){var e,f=d.grid,h=(f.isLeftToRight(),c.body()),j=f._eventFlags,k=null;this.resizableAreas.forEach(function(c,d){if(c.contains(a.clientX,a.clientY)&&(k=c,e=d,b.grid.rowHeader.outlineModeConfig&&k.element===b.grid.rowHeader.headerNode)){var f=b.resizableAreas.length-2;k=b.resizableAreas[f],e=f}}),k?(g.add(h,ionweb.tables.COLUMN_RESIZING_CLASS),d._targetCell=k.element,d._targetLevel=e,d._cellPos=i.position(k.element),j.onHeaderMouseDown=d.name,d._readyToResize=1):a.clientX<Math.max.apply(null,this.resizableAreas.map(function(a){return a.x}))&&(j.onHeaderMouseDown=void 0,g.remove(h,ionweb.tables.COLUMN_RESIZING_CLASS)),j.onHeaderCellMouseDown=j.onHeaderMouseDown}},_mouseout:function(a){if(!this._resizing){var b=i.position(this.grid.header.domNode);if(l("chrome"))for(var d in b)b[d]=Math.floor(b[d]);(a.clientY<=b.y||a.clientY>=b.y+b.h||a.clientX<=b.x||a.clientX>=b.x+b.w)&&(this._readyToResize=0,g.remove(c.body(),ionweb.tables.COLUMN_RESIZING_CLASS))}},_mousedown:function(a){var b=this;if(b._readyToResize){b._resizing=1;var d=b.grid,f=d.rowHeader.headerNode;e.setSelectable(d.domNode,!1),c.doc.onselectstart=function(){return!1},b._containerPos=i.position(d.domNode),b._headerPos=i.position(d.header.domNode),b._padBorder=i.getMarginBox(f).w-i.getContentBox(f).w,b._initResizer(),b._updateResizer(a),b._moving=0,setTimeout(function(){d.focus.blur()},0)}else b._ismousedown=1},_initResizer:function(){var a=this,b=a.grid,c=b.hScroller,d=c&&c.container.offsetHeight?c.container:b.bodyNode,e=b.header.domNode.offsetTop,f=d.parentNode.offsetTop+d.offsetHeight-b.header.domNode.offsetTop,g=a._resizer;g||(g=a._resizer=h.create("div",{className:"gridxColumnResizer"},b.domNode,"last"),a.connect(g,"mouseup","_mouseup"));var i=g.style;i.top=e+"px",i.height=f+"px",i.display="block"},_updateResizer:function(a){var b=this;if(b._resizing){var c=b.grid.isLeftToRight(),d=b.arg("minWidth")+b._padBorder,e=b._cellPos,f=a.clientX,g=c?e.x+d:e.x+e.w-d,h=b._containerPos.x+b._containerPos.w-d;(c?f<g:f>g)&&(f=g),f=Math.min(f,h),b._width=Math.min((c?f-e.x:e.x+e.w-f)-b._padBorder,h),b._resizer.style.left=f-b._containerPos.x-2+"px",b._moving=1}},_mouseup:function(a){var b=this;if(b._ismousedown=0,b._resizing){b._resizing=b._readyToResize=0,g.remove(c.body(),ionweb.tables.COLUMN_RESIZING_CLASS),e.setSelectable(b.grid.domNode,!0),c.doc.onselectstart=null,b._moving&&(b._moving=0,this._targetCell===this.grid.rowHeader.headerNode?b.setWidth(b._width+"px"):this.grid.rowHeader.setLevelWidth(b._targetLevel,b._width)),b._resizer.style.display="none";var d=a.clientX,f=a.clientY,h=b._headerPos;d>=h.x&&d<=h.x+h.w&&f>=h.y&&f<=h.y+h.h&&(a._target=b._targetCell,b._mousemove(a))}}})})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/TableSelection",["dojo/_base/declare","dojo/_base/array","dojo/_base/event","dojo/query","dojo/_base/lang","dojo/_base/sniff","dojo/dom-class","dojo/mouse","dojo/keys","dojo/_base/connect","gridx/core/_Module","gridx/modules/extendedSelect/_Base"],function(a,b,c,d,e,f,g,h,i,j,k,l){return a(l,{name:"selectTable",clear:function(a){var b=this._isSelected;this._isSelected=!1,this._onRender(),this._clear(),a||this.onSelectionChange(this._isSelected,b)},select:function(){var a=this._isSelected;return j.publish("gridClearSelection_"+this.grid.id,[this._type]),this._isSelected=!0,this.onSelectionChange(this._isSelected,a),this._onRender(),this},deselect:function(){var a=this._isSelected;return this._isSelected=!1,this.onSelectionChange(this._isSelected,a),this._onRender(),this},isSelected:function(){return this._isSelected},_type:"table",load:function(){function a(a,b){function c(a,b,e){for(var f=0;f<a.childNodes.length&&!e;f++){for(var g=a.childNodes[f],h=void 0!=g.className?g.className.split(" "):[],i=0,j=h.length;i<j;i++)if(h[i]==b){e=!0,d=a.childNodes[f];break}if(e)break;c(a.childNodes[f],b,e)}}var d=null;return c(a,b,!1),d}var b=this,c=b.grid,d=a(c.headerNode,"gridxRowHeaderHeaderCell");d&&d.addEventListener("click",function(a){b._isSelected?b.deselect():b.select()})},_onRender:function(){var a=this.grid;this._isSelected?(g.add(a.domNode,"gridxTableSelected"),a.domNode.setAttribute("aria-selected",!0)):(g.remove(a.domNode,"gridxTableSelected"),a.domNode.removeAttribute("aria-selected",!0))}})})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/TouchScroll",["dojo/_base/declare","dojo/_base/window","dojo/_base/event","dojo/dom","dojo/dom-construct","dojo/touch","gridx/core/_Module"],function(a,b,c,d,e,f,g){return a(g,{name:"touchScroll",required:["vScroller","hScroller"],_touchstart:null,_touchend:null,_scrolling:null,_maxTop:1e3,_minTop:0,_maxLeft:0,_minLeft:0,_frameTop:0,_frameLeft:0,_timestamp:0,_pressed:!1,_referenceTop:0,_referenceLeft:0,_velocityTop:0,_amplitudeTop:0,_velocityLeft:0,_amplitudeLeft:0,_ticker:null,_targetTop:0,_targetLeft:0,_timeConstant:325,constructor:function(){var a=this,c=a.grid,d=c.bodyNode;a.vWrapper=e.create("div",{class:"gridxTouchScrollVWrapper"},c.mainNode),a.vInner=e.create("div",{class:"gridxTouchScrollVBar"},a.vWrapper),a.hWrapper=e.create("div",{class:"gridxTouchScrollHWrapper"},c.mainNode),a.hInner=e.create("div",{class:"gridxTouchScrollHBar"},a.hWrapper),a.batchConnect([d,f.press,"_start"],[b.doc,f.release,"_end"])},preload:function(){this._touchstart=this.arg("touchstart"),this._touchend=this.arg("touchend"),this._touchmove=this.arg("touchmove"),this._scrolling=this.arg("scroll"),this._shouldBlockScrolling=this.arg("shouldBlockScrolling"),this._shouldIgnoreScrolling=this.arg("shouldIgnoreScrolling")},__moveOnTarget:function(a){a.clientY=a.touches[0].clientY,a.clientX=a.touches[0].clientX,this._scroll(a)},__endOnTarget:function(a){this._end(a)},_start:function(a){var b=this,c=b.grid;b.__scrollBound=b.__moveOnTarget.bind(this),b.__endBound=b.__endOnTarget.bind(this),a.target.addEventListener("touchmove",b.__scrollBound),a.target.addEventListener("touchcancel",b.__endBound),a.target.addEventListener("touchend",b.__endBound);var e=c.vScrollerNode,f=c.hScrollerNode;if(b._frameTop=e&&e.scrollTop,b._frameLeft=f&&f.scrollLeft,b._pressed=!0,b._referenceTop=a.clientY,b._referenceLeft=a.clientX,b._velocityTop=0,b._velocityLeft=0,b._amplitudeTop=0,b._amplitudeLeft=0,b._timestamp=Date.now(),clearInterval(b._ticker),e&&f&&("none"!==e.style.display||"none"!==f.style.display)){var g=b.vInner.style,h=b.hInner.style,i=c.bodyNode,j=i.clientHeight,k=i.clientWidth,l=e.scrollHeight,m=f.scrollWidth;b._last=a,c.domNode&&d.setSelectable(c.domNode,!1),b.vWrapper.style.height=j-4+"px",b.hWrapper.style.width=k-4+"px",g.height=j*(j-4)/l+"px",h.width=k*(k-4)/m+"px",b._vr=(j-4)/l,b._hr=(k-4)/m,1!=e.offsetWidth&&1!=f.offsetHeight||(g.opacity=1,h.opacity=1)}this._touchstart&&this._touchstart(a)},_scroll:function(a){var b=this,d=b.grid;this._pressed&&this._track(),this._touchmove&&this._touchmove(a);var e=new Event("silenttouchmove");if(window.dispatchEvent(e),!this._shouldIgnoreScrolling||!this._shouldIgnoreScrolling()){var f=(d.hScrollerNode,d.vScrollerNode,b._last);if(this._shouldBlockScrolling&&this._shouldBlockScrolling())c.stop(a);else if(f){var g=Math.max(Math.abs(f.clientY-a.clientY),Math.abs(f.clientX-a.clientX));b._referenceTop=a.clientY,b._referenceLeft=a.clientX,this._scrollUsingOffset(f.clientY-a.clientY,f.clientX-a.clientX),b._last=a,g>2&&this._scrolling&&this._scrolling&&this._scrolling(a),c.stop(a)}}},_end:function(a){var b=this,c=b.grid;b.__scrollBound&&a.target.removeEventListener("touchmove",b.__scrollBound),b.__endBound&&a.target.removeEventListener("touchcancel",b.__endBound),b.__endBound&&a.target.removeEventListener("touchend",b.__endBound);var e=c.vScrollerNode,f=c.hScrollerNode,g=b._pressed;if(b._pressed=!1,clearInterval(b._ticker),g&&e&&f){b._track(),b._timestamp=Date.now();var h=!1;(b._velocityTop>10||b._velocityTop<-10)&&(b._amplitudeTop=.8*b._velocityTop,b._targetTop=Math.round(e.scrollTop+b._amplitudeTop),h=!0),(b._velocityLeft>10||b._velocityLeft<-10)&&(b._amplitudeLeft=.8*b._velocityLeft,b._targetLeft=Math.round(f.scrollLeft+b._amplitudeLeft),h=!0),h&&(b._lastAutoScrolledPosition=null,requestAnimationFrame(function(){return b._autoScroll()}))}b._last&&(b._last=null,c.domNode&&d.setSelectable(b.grid.domNode,!0),b.vInner&&b.vInner.style&&(b.vInner.style.opacity=0),b.vInner&&b.vInner.style&&(b.hInner.style.opacity=0)),this._touchend&&this._touchend(a)},_scrollUsingOffset:function(a,b){var c=this,d=c.grid,e=d.hScrollerNode,f=d.vScrollerNode;e&&f&&(f.scrollTop+=a,e.scrollLeft+=b,c.vInner.style.top=f.scrollTop*c._vr+"px",c.hInner.style.left=e.scrollLeft*c._hr+"px")},_scrollUsingAbsolute:function(a,b){var c=this,d=c.grid,e=d.hScrollerNode,f=d.vScrollerNode;e&&f&&(f.scrollTop=a,e.scrollLeft=b,c.vInner.style.top=f.scrollTop*c._vr+"px",c.hInner.style.left=e.scrollLeft*c._hr+"px")},_track:function(){var a,b,c,d,e,f,g=this,h=g.grid,i=h.vScrollerNode,j=h.hScrollerNode;i&&j&&(a=Date.now(),b=a-g._timestamp,g._timestamp=a,c=(i.scrollTop-g._frameTop)/(window.devicePixelRatio||1),g._frameTop=i.scrollTop,e=1e3*c/(1+b),g._velocityTop=.8*e+.2*g._velocityTop,d=(j.scrollLeft-g._frameLeft)/(window.devicePixelRatio||1),g._frameLeft=j.scrollLeft,f=1e3*d/(1+b),g._velocityLeft=.8*f+.2*g._velocityLeft)},_autoScroll:function(){var a=this,b=a.grid,c=b.vScrollerNode,d=b.hScrollerNode;if(c&&d&&!(c&&d&&a._lastAutoScrolledPosition&&(Math.abs(a._lastAutoScrolledPosition.top-c.scrollTop)>1||Math.abs(a._lastAutoScrolledPosition.left-d.scrollLeft)>1))){var e=Date.now()-a._timestamp,f=0;a._amplitudeTop&&(f=-a._amplitudeTop*Math.exp(-e/a._timeConstant));var g=0;a._amplitudeLeft&&(g=-a._amplitudeLeft*Math.exp(-e/a._timeConstant));var h=a._targetTop+f,i=a._targetLeft+g;a._scrollUsingAbsolute(h,i),a._lastAutoScrolledPosition={top:c.scrollTop,left:d.scrollLeft},g>.5||g<-.5||f>.5||f<-.5?requestAnimationFrame(function(){return a._autoScroll()}):a._lastAutoScrolledPosition=null}}})})}(gridx||(gridx={}));var gridx;!function(a){var b,c,d,e=function(){function a(){this.resizedColumns={}}return a.prototype.applyWidth=function(a,b,c){var e=this.grid,f=e._columnsById[a];if(f){var g=e.header.getHeaderNode(a);if(g){var h=g.style;h.width=h.minWidth=h.maxWidth=b,f.width=b;for(var i=e._columns,j=0,k=i.length;j<k;++j)i[j].declaredWidth=i[j].width;d('[colid="'+e._escapeId(a)+'"]',e.bodyNode).forEach(function(a){var c=a.style;c.width=c.minWidth=c.maxWidth=b}),this.onResize(a,b),c||this.refreshLayout()}}},a.prototype.refreshLayout=function(){var a=this.grid;a.resize()},a.prototype.fixSizesInPixel=function(a){var c=this,e=function(a){a.forEach(function(a){var e=c.resizedColumns,f=c.grid,g=e[a];if(g&&g.indexOf("px")<0){var h=f.header.getHeaderNode(a);if(h){var i=0;"customWidth"===g&&d('[colid="'+f._escapeId(a)+'"]',f.bodyNode).forEach(function(a){a.style;i=Math.max(a.offsetWidth,i)});var j=i>0?i:b.get(h,"width"),k=j;"string"==typeof j||"number"==typeof j&&(k=j+"px"),e[a]=k,c.applyWidth(a,k)}}})};setTimeout(function(){e(a)},0)},a.prototype.setWidth=function(a,b,c,d){if(!a||!b){var e=ionweb.stringFormat(ionweb.tables.Strings.Err_TrackingColumnResize_InvalidParameter_ColId_Width,{colId:a,width:b});throw new Error(e)}if("string"==typeof b){var f=b.indexOf("px");f>=0&&(b=parseInt(b.substr(0,f)))}"number"==typeof b&&(b=Math.ceil(b)+"px"),parseFloat(b)<=0&&(b="20px");var g=this.grid,h=g._columnsById[a];h?(this.resizedColumns[a]=b,this.applyWidth(a,b,d),c||(this.fixSizesInPixel([a]),this.notifyChanges())):this.resizedColumns[a]=b},a.prototype.getCachedColumnWidth=function(a){var b=this.resizedColumns[a];if(b){var c=b.indexOf("px");if(c>=0){var d=parseInt(b.substr(0,c));return d}}return null},a.prototype.getResizedColumns=function(){var a=this,b={},c=this;return Object.getOwnPropertyNames(c.resizedColumns).forEach(function(c){b[c]=a.resizedColumns[c]}),b},a.prototype.notifyChanges=function(){var a=this.arg("changedStateHandler");a&&a()},a.prototype.refreshWidths=function(){if(this.customColumnWidthProvider){var a=this.customColumnWidthProvider();if(a)return void this.applyCachedWidths(a)}this.applyCachedWidths(this.resizedColumns)},a.prototype.applyCachedWidths=function(a){var b=this,c=Object.getOwnPropertyNames(a);c.forEach(function(c){b.applyWidth(c,a[c],!0)}),this.refreshLayout(),this.fixSizesInPixel(c)},a.prototype.setWidths=function(a){var b=this,c=this;if(a){var d=Object.getOwnPropertyNames(a);d.forEach(function(c){b.setWidth(c,a[c],!1,!0)}),this.refreshLayout(),this.fixSizesInPixel(d),c.notifyChanges()}else{var e=Object.getOwnPropertyNames(c.resizedColumns);e.forEach(function(a){b.applyWidth(a,c.resizedColumns[a],!0)}),this.refreshLayout(),this.fixSizesInPixel(e)}},a.prototype.setState=function(a){this.resizedColumns={},this.setWidths(a)},a}();a.TrackingColumnResizer=e,a.registerModule("ion/TrackingColumnResizer",["dojo/_base/declare","gridx/modules/ColumnResizer","dojo/dom-style","dojo/dom-geometry","gridx/support/query"],function(a,f,g,h,i){return b=g,c=h,d=i,a(f,new e)})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/View",["dojo/_base/declare","gridx/core/_Module","gridx/modules/View"],function(a,b,c){return b.register(a(c,{suspendCount:0,updateScheduled:!1,updateScheduledDoUpdate:!1,preload:function(){var a=this,b=a.arg("events");b&&(b.suspend=function(){a.suspendCount++},b.resume=function(){0===--a.suspendCount&&a.updateScheduled&&a.updateVisualCount().then(function(){a.updateScheduledDoUpdate&&a.onUpdate()})})},updateRootRange:function(a,b,c){var d=this;d.rootStart=a,d.rootCount=b,d.suspendCount<=0?d.updateVisualCount().then(function(){c||d.onUpdate()}):(d.updateScheduled=!0,d.updateScheduledDoUpdate=d.updateScheduledDoUpdate||!c)},updateVisualCount:function(){var a=this;return a._loadLevels().then(function(){a._updateVC()},function(b){var c=a.arg("exchelper");c.report(b,"Exception in grid rendering")})}}))})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/ViewportManager",["dojo/_base/declare","gridx/core/_Module"],function(a,b){return a(b,{name:"viewportManager",preload:function(){this._handler=this.arg("newRowWindowHandler")},load:function(){var a=this,b=this,c=b.grid,d=function(){c&&c.bodyNode&&c.bodyNode.firstChild&&a._handler()};this._handler&&b.connect(c.bodyNode,"onscroll",d)}})})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/VirtualVScroller",["dojo/_base/declare","gridx/core/_Module","gridx/modules/VirtualVScroller","dojo/_base/array","dojo/keys","dojo/_base/event","dojo/_base/Deferred","dojo/_base/sniff","dojox/html/metrics","dojo/dom-style"],function(a,b,c,d,e,f,g,h,i,j){return b.register(a(c,{preload:function(a){var b=this;this.grid.hLayout.register(null,this.domNode,1),this.useBiggestGroupSize=this.arg("useBiggestGroupSize"),this.dynamicRowHeight=this.arg("dynamicRowHeight"),this.rowChanged={},this.onSizeChanged=ionweb.debounce(function(){b.isDestroyed||null==b.domNode.offsetParent||(b._onBodyChange(),Object.keys(b.rowChanged).forEach(function(a){b.grid&&b.grid.rowHeader&&b.grid.rowHeader.callOnAfterRow(b.rowChanged[a])}),b.rowChanged={})},500,!1)},load:function(a,b){var c=this,d=c.grid,e=d.body,f=c.domNode,i=d.mainNode;c.batchConnect([c.domNode,"onscroll","_doScroll"],[i,"onmousewheel","_onMouseWheel"],[i,"onkeypress","_onKeyScroll"],[e,"onAfterRow","onAfterRow"],[e,"onUnrender","onUnrenderRow"],h("ff")&&[i,"DOMMouseScroll","_onMouseWheel"]),c.aspect(d,"_onResizeEnd","_onBodyChange"),c.aspect(e,"onForcedScroll","_onForcedScroll"),c.aspect(e,"onRender","_onBodyChange"),c.aspect(d.header,"onRender","_onBodyChange"),d.autoHeight||c.aspect(e,"onEmpty",function(){var a=f.style;a.display="none",a.width="",h("ie")<8&&(a.width=c.stubNode.style.width="0px"),d.hLayout.reLayout(),d.hScroller.refresh()}),b.then(function(){c._updatePos(),g.when(c._init(a),function(){c.domNode.style.width="",c.loaded.callback()})})},disposeResponsiveService:function(a){if(this.rowIdToResponsivenessRegistrationResult){var b=this.rowIdToResponsivenessRegistrationResult[a];b&&b()}},onAfterRow:function(a){var b=this,c=a.id,d=a.node();this.dynamicRowHeight&&(this.disposeResponsiveService(c),this.rowIdToResponsivenessRegistrationResult[c]=ionweb.getService("ionweb.responsivenessService").register(d,function(){b.rowChanged[c]=a,b.onSizeChanged()}))},onUnrenderRow:function(a){var b=this;this.dynamicRowHeight&&(a?(this.disposeResponsiveService(a),delete this.rowIdToResponsivenessRegistrationResult[a]):(this.rowIdToResponsivenessRegistrationResult&&Object.keys(this.rowIdToResponsivenessRegistrationResult).forEach(function(a){b.disposeResponsiveService(a)}),this.rowIdToResponsivenessRegistrationResult={}))},_subScrollToRow:function(){var a=this;this._updateRowHeight();var b;if(this.grid&&this.grid.bodyNode)b&&clearInterval(b),this.inherited(arguments);else{var c=arguments;b=setTimeout(function(){a._subScrollToRow(c)},5)}},_onKeyScroll:function(a){var b=this,c=b.grid.body,d=b.grid.view,g=b.grid.focus,h=b.domNode,i=b.grid._isCtrlKey(a),j="scrollTop",k="_focusCellRow";if(!g||"body"==g.currentArea()){if(a.keyCode==e.HOME&&i)c._focusCellCol=0,c[k]=0,h[j]=0,c._focusCell();else if(a.keyCode==e.END&&i)c._focusCellCol=b.grid._columns.length-1,c[k]=d.visualCount-1,h[j]=b.stubNode.clientHeight-c.domNode.offsetHeight,c._focusCell();else if(a.keyCode==e.PAGE_UP);else if(a.keyCode!=e.PAGE_DOWN)return;f.stop(a)}},_alignScroll:function(){var a=this,b=a.grid.bodyNode,c=a.domNode,d=b.firstChild;if(d){var e=parseInt(d.getAttribute("visualindex"));b.scrollTop=c.scrollTop-e*a._avgRowHeight,a.grid.rowHeader&&a.grid.rowHeader._onScroll()}},_updateRowHeight:function(a){if(this.grid.bodyNode){var b=this,c=0,e=0,f=b.grid,g=f.body,h=f.bodyNode,i=b.buffSize*b._avgRowHeight,j=h.scrollTop,k=j-i,l=j+h.clientHeight+i,m=b._rowHeight,n=0;d.forEach(h.childNodes,function(a){var b=a.offsetHeight;m[a.getAttribute("rowid")]=b,a.setAttribute("data-rowHeight",b),a.offsetTop>l?++e:a.offsetTop+a.offsetHeight<k&&++c}),"post"!=a&&(g.unrenderRows(c),n=c),"pre"!=a&&(g.unrenderRows(e,"post"),n=e);var o,p=0,q=0,r={};for(o in m){r[m[o]]=(r[m[o]]||0)+1;var s=m[o];p+=s,++q}if(p&&q){if(b.useBiggestGroupSize){var t=-1,u=-1,v=Object.keys(r);v.forEach(function(a){var b=r[a];b>t&&(u=parseFloat(a),t=b)}),b._avgRowHeight=u}else b._avgRowHeight=p/q;b._syncHeight()}return b._alignScroll(),n}},_update:function(){var a=this,b=a.grid;if(!b.autoHeight&&b.bodyNode){var c=b.body,d=b.bodyNode,e=d.scrollHeight>d.clientHeight||d.scrollHeight==d.clientHeight&&c.renderCount<b.view.visualCount,f=a.domNode.style,g=i.getScrollbar().w+(h("webkit")?1:0);if(h("ie")<8){var k=e?g+2+"px":"0px";a.stubNode.style.width=k,f.width=k}else f.width="";var l=e?"block":"none",m=l!=(j.get(a.domNode,"display")||"block");f.display=l,(a._updatePos()||m)&&b.hLayout.reLayout()}},_doVirtualScroll:function(a){
var b=this,c=b.domNode,d=c.scrollTop,e=d-(b._lastScrollTop||0),f=2;if(b.grid.bodyNode){if(a||e){b._lastScrollTop=d;var g,h,i,j,k=b.arg("buffSize"),l=c.scrollHeight-c.offsetHeight,m=b.grid.body,n=b.grid.view,o=0,p=o+n.visualCount,q=b.grid.bodyNode,r=q.firstChild,s=r&&r.offsetTop-e,t=q.lastChild,u=t&&t.offsetTop-e+t.offsetHeight,v=q.scrollTop,w=v+q.clientHeight,x=b._avgRowHeight,y=Math.ceil(c.offsetHeight/x)+2*k,z=b._ratio,A=d<=f,B=Math.abs(d-l)<=f;if(v==w&&!w||t&&t.offsetTop<0)return;if(r&&s>v&&s<w)h=m.renderStart,j=Math.ceil((s-v)*z/x)+k,g=A?o:Math.max(h-j,o),i="top";else if(t&&u>v&&u<w)g=m.renderStart+m.renderCount,j=Math.ceil((w-u)*z/x)+k,h=B&&d?p:Math.min(g+j,p),i="bottom",0===e&&g==p&&(h=m.renderStart,j=Math.ceil((s-v)*z/x)+k,g=A?o:Math.max(h-j,o),i="top");else if(!r||s>w||!t||u<v)d<=l/2?(g=A?o:o+Math.max(Math.floor(d*z/x)-k,0),h=Math.min(g+y,p)):(h=B?p:p+Math.min(y-Math.floor((l-d)*z/x),0),g=Math.max(h-y,o)),i="clear";else if(r)if(A){var C=m.renderStart;C>o&&(g=o,h=C,i="top")}else if(B){var D=m.renderStart+m.renderCount-1;D<p-1&&(g=D+1,h=p,i="bottom")}"number"==typeof g&&"number"==typeof h&&m.renderRows(g,h-g,i)}b._alignScroll(),b._doVirtual()}},destroy:function(){this.inherited(arguments),clearTimeout(this._lazyScrollHandle),clearTimeout(this._pVirtual),this.isDestroyed=!0}}))})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/VLayout",["dojo/_base/declare","gridx/core/_Module","gridx/modules/VLayout"],function(a,b,c){return b.register(a(c,{reLayout:function(){this.grid.domNode&&this.grid.mainNode&&this.grid._isLoaded&&this.inherited(arguments)}}))})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/HLayout",["dojo/_base/declare","gridx/core/_Module","gridx/modules/HLayout"],function(a,b,c){return b.register(a(c,{reLayout:function(){this.grid._isLoaded&&this.inherited(arguments)}}))})}(gridx||(gridx={}));var gridx;!function(a){a.registerModule("ion/ColumnWidth",["dojo/_base/declare","gridx/core/_Module","dojo/query","gridx/modules/ColumnWidth"],function(a,b,c,d){return b.register(a(d,{_onUpdateWidth:function(){var a=this,b=a.grid;if(b.autoWidth)a._adaptWidth();else{var d="none"==b.hScrollerNode.style.display,e=a.autoResize;a._adaptWidth(!d,1),!e&&d&&c(".gridxCell",b.bodyNode).forEach(function(a){var c=b._columnsById[a.getAttribute("colId")];if(c){var d=c.declaredWidth;if(e||!d||"auto"==d||/%$/.test(d)){var f=a.style,g=c.width;f.width=g,f.minWidth=g,f.maxWidth=g}}}),a.onUpdate()}}}))})}(gridx||(gridx={}));var ionweb;!function(a){var b;!function(a){angular.module("ionwebGrids").directive("ionwebGridColumnFilterPopup",[function(){var a=function(a){a.isColumnFilterPopupOpen=!1,a.$watch("isColumnFilterPopupOpen",function(b,c){b&&a.fetchFilteredColumns&&(a.fetchFilteredColumns(),a.categories=a.availableCategories.map(function(a){return{value:a,label:a}}))})};return{restrict:"EA",link:a,templateUrl:"grids.ui/columnFilterPopup/gridColumnSelectorPopup.tpl.html"}}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){angular.module("ionwebGrids").directive("ionwebListSelector",["$timeout",function(b){var c=function(c,e){function f(a){return a&&a.replace(h,"\\$&").trim()||""}function g(a,b,c){var d=void 0,e=void 0;if(!a||!a.length)return null;if(b&&b.length){var g="("+b.join(")|(")+")";d=b&&b.length&&new RegExp("\\b(?:"+g+")\\b","gi")}var h=f(c);if(h.length&&(e=new RegExp(h,"gi")),!b&&!e)return a;var i=[];return a.forEach(function(a){if(a){var b=!0;if(d){var c=a.category&&a.category.match(d);b=c&&!!c.length}if(e&&b){var f=a.displayName.match(e);b=f&&!!f.length}b&&i.push(a)}}),i}var h=/[-\/\\^$*+?.()|[\]{}]/g;c.listFilteredEvent=new a.Event;var i=[],j=null,k=function(b){if(!b)return[];var c=[],d=[];return b.forEach(function(a){a.checked?c.push(a):d.push(a)}),d.sort(function(b,c){return a.ValueComparer.naturalStringCompare(b.displayName,c.displayName,!1)}),c.concat(d)},l=function(){c.initializing=!0,j&&b.cancel(j),j=b(function(){i=c.displayOptions&&c.displayOptions.disableSorting?[].concat(c.itemList):k(c.itemList),c.filteredList=i,c.initializing=!1})};c.listItemSelections={selectAll:!1},c.selectedCategories={selection:null},c.inputFocus=function(a){c.inputFocused=!0},c.inputBlur=function(a){c.inputFocused=!1},c.mouseEnter=function(a,b){c.currentItem=b},c.mouseLeave=function(a,b){c.currentItem=null},c.onRowClicked=function(a,b){c.selectedItem=b,c.itemClicked?c.itemClicked(b):c.$evalAsync(function(){b.checked=!b.checked})},c.$watch("listItemSelections.selectAll",function(a,b){a!==b&&c.filteredList&&c.filteredList.length&&c.filteredList.forEach(function(b){b.checked!==a&&(b.checked=a)})}),c.$watch("selectedCategories.selection",function(a,b){(a||b)&&(c.filteredList=g(i,c.selectedCategories.selection,c.itemSearchFilter),c.listFilteredEvent.raise(d,null))}),c.$watch("itemSearchFilter",function(a,b){a!==b&&(c.filteredList=g(i,c.selectedCategories.selection,c.itemSearchFilter),c.listFilteredEvent.raise(d,null))}),c.$watch("itemList",function(a){l()}),c.clearSearch=function(a){c.itemSearchFilter=null},c.$on("$destroy",function(){b.cancel(j)})},d={restrict:"EA",link:c,scope:{itemList:"=",itemClicked:"=",categories:"=?",displayOptions:"=?"},templateUrl:"grids.ui/columnFilterPopup/listSelector.tpl.html"};return d}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){function b(){if("pageYOffset"in window)return{scrollTop:pageYOffset,scrollLeft:pageXOffset};var a,b,c=document,d=c.documentElement,e=c.body;return a=d.scrollLeft||e.scrollLeft||0,b=d.scrollTop||e.scrollTop||0,{scrollTop:b,scrollLeft:a}}function c(a,b){return a===window?"clientWidth"===b?window.innerWidth:window.innerHeight:a[b]}function d(a,c){return a===window?b()[c]:a[c]}function e(a,c,d){var e=a.getBoundingClientRect()[d?"left":"top"],f=c===window?0:c.getBoundingClientRect()[d?"left":"top"],g=e-f+(c===window?b():c)[d?"scrollLeft":"scrollTop"];return g}var f=document.documentElement,g=f.matches?"matches":f.matchesSelector?"matchesSelector":f.webkitMatches?"webkitMatches":f.webkitMatchesSelector?"webkitMatchesSelector":f.msMatches?"msMatches":f.msMatchesSelector?"msMatchesSelector":f.mozMatches?"mozMatches":f.mozMatchesSelector?"mozMatchesSelector":null,h=angular.element.prototype.closest||function(a){for(var b=this[0].parentNode;b!==document.documentElement&&null!=b&&!b[g](a);)b=b.parentNode;return b&&b[g](a)?angular.element(b):angular.element()};angular.module("ionwebGrids").directive("vsRepeat",["$compile","$parse",function(a,b){return{restrict:"A",scope:!0,compile:function(f,g){var i,j,k,l,m,n,o=angular.isDefined(g.vsRepeatContainer)?angular.element(f[0].querySelector(g.vsRepeatContainer)):f,p=o.children().eq(0),q=p[0].outerHTML,r="$vs_collection",s=!1,t={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsScrolledToEndOffset:"scrolledToEndOffset",vsExcess:"excess"};if(p.attr("ng-repeat"))n="ng-repeat",i=p.attr("ng-repeat");else if(p.attr("data-ng-repeat"))n="data-ng-repeat",i=p.attr("data-ng-repeat");else if(p.attr("ng-repeat-start"))s=!0,n="ng-repeat-start",i=p.attr("ng-repeat-start");else{if(!p.attr("data-ng-repeat-start"))throw new Error("angular-vs-repeat: no ng-repeat directive on a child element");s=!0,n="data-ng-repeat-start",i=p.attr("data-ng-repeat-start")}if(j=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(i),k=j[1],l=j[2],m=j[3],s)for(var u=0,v=o.children().eq(0);null==v.attr("ng-repeat-end")&&null==v.attr("data-ng-repeat-end");)u++,v=o.children().eq(u),q+=v[0].outerHTML;return o.empty(),{pre:function(f,g,i){function j(){if(!E||E.length<1)f[r]=[],A=0,f.sizesCumulative=[0];else if(A=E.length,J){f.sizes=E.map(function(a){var b=f.$new(!1);angular.extend(b,a),b[k]=a;var c=i.vsSize||i.vsSizeProperty?b.$eval(i.vsSize||i.vsSizeProperty):f.elementSize;return b.$destroy(),c});var a=0;f.sizesCumulative=f.sizes.map(function(b){var c=a;return a+=b,c}),f.sizesCumulative.push(a)}else o();w()}function o(){I&&f.$$postDigest(function(){if(B[0].offsetHeight||B[0].offsetWidth){for(var a=B.children(),b=0,c=!1,d=!1;b<a.length;){if(null!=a[b].attributes[n]||d){if(c||(f.elementSize=0),c=!0,a[b][N]&&(f.elementSize+=a[b][N]),!s)break;if(null!=a[b].attributes["ng-repeat-end"]||null!=a[b].attributes["data-ng-repeat-end"])break;d=!0}b++}c&&(w(),I=!1,f.$root&&!f.$root.$$phase&&f.$apply())}else var e=f.$watch(function(){(B[0].offsetHeight||B[0].offsetWidth)&&(e(),o())})})}function p(){var a="tr"===D?"":"min-",b=F?a+"width":a+"height";return b}function u(){z()&&f.$digest()}function v(){"undefined"!=typeof i.vsAutoresize&&(I=!0,o(),f.$root&&!f.$root.$$phase&&f.$apply()),z()&&f.$evalAsync()}function w(){P=void 0,Q=void 0,R=A,S=0,x(J?f.sizesCumulative[A]:f.elementSize*A),z(),f.$emit("vsRepeatReinitialized",f.startIndex,f.endIndex)}function x(a){f.totalSize=f.offsetBefore+a+f.offsetAfter}function y(){var a=c(K[0],M);a!==T&&(w(),f.$root&&!f.$root.$$phase&&f.$apply()),T=a}function z(){var a=d(K[0],O),g=c(K[0],M),h=B[0]===K[0]?0:e(B[0],K[0],F),j=f.startIndex,k=f.endIndex;if(J){for(j=0;f.sizesCumulative[j]<a-f.offsetBefore-h;)j++;for(j>0&&j--,j=Math.max(Math.floor(j-f.excess/2),0),k=j;f.sizesCumulative[k]<a-f.offsetBefore-h+g;)k++;k=Math.min(Math.ceil(k+f.excess/2),A)}else j=Math.max(Math.floor((a-f.offsetBefore-h)/f.elementSize)-f.excess/2,0),k=Math.min(j+Math.ceil(g/f.elementSize)+f.excess,A);R=Math.min(j,R),S=Math.max(k,S),f.startIndex=L.latch?R:j,f.endIndex=L.latch?S:k;var l=!1;if(null==P?l=!0:null==Q&&(l=!0),l||(L.hunked?Math.abs(f.startIndex-P)>=f.excess/2||0===f.startIndex&&0!==P?l=!0:(Math.abs(f.endIndex-Q)>=f.excess/2||f.endIndex===A&&Q!==A)&&(l=!0):l=f.startIndex!==P||f.endIndex!==Q),l){if(f[r]=E.slice(f.startIndex,f.endIndex),f.$emit("vsRepeatInnerCollectionUpdated",f.startIndex,f.endIndex,P,Q),i.vsScrolledToEnd){var m=E.length-(f.scrolledToEndOffset||0);(f.endIndex>=m&&Q<m||E.length&&f.endIndex===E.length)&&f.$eval(i.vsScrolledToEnd)}P=f.startIndex,Q=f.endIndex;var n=J?"(sizesCumulative[$index + startIndex] + offsetBefore)":"(($index + startIndex) * elementSize + offsetBefore)",o=b(n),q=o(f,{$index:0}),s=o(f,{$index:f[r].length}),t=f.totalSize;G.css(p(),q+"px"),H.css(p(),t-s+"px")}return l}var A,B=angular.isDefined(i.vsRepeatContainer)?angular.element(g[0].querySelector(i.vsRepeatContainer)):g,C=angular.element(q),D=C[0].tagName.toLowerCase(),E=[],F="undefined"!=typeof i.vsHorizontal,G=angular.element("<"+D+' class="vs-repeat-before-content"></'+D+">"),H=angular.element("<"+D+' class="vs-repeat-after-content"></'+D+">"),I=!i.vsRepeat,J=!!i.vsSize||!!i.vsSizeProperty,K=i.vsScrollParent?"window"===i.vsScrollParent?angular.element(window):h.call(B,i.vsScrollParent):B,L="vsOptions"in i?f.$eval(i.vsOptions):{},M=F?"clientWidth":"clientHeight",N=F?"offsetWidth":"offsetHeight",O=F?"scrollLeft":"scrollTop";if(f.totalSize=0,!("vsSize"in i)&&"vsSizeProperty"in i&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attribute which also accepts angular expressions."),0===K.length)throw"Specified scroll parent selector did not match any element";f.$scrollParent=K,J&&(f.sizesCumulative=[]),f.elementSize=+i.vsRepeat||c(K[0],M)||50,f.offsetBefore=0,f.offsetAfter=0,f.excess=2,F?(G.css("height","100%"),H.css("height","100%")):(G.css("width","100%"),H.css("width","100%")),Object.keys(t).forEach(function(a){i[a]&&i.$observe(a,function(b){f[t[a]]=+b,w()})}),f.$watchCollection(l,function(a){E=a||[],j()}),C.eq(0).attr(n,k+" in "+r+(m?" "+m:"")),C.addClass("vs-repeat-repeated-element"),B.append(G),B.append(C),a(C)(f),B.append(H),f.startIndex=0,f.endIndex=0,K.on("scroll",u),angular.element(window).on("resize",v),f.$on("$destroy",function(){angular.element(window).off("resize",v),K.off("scroll",u)}),f.$on("vsRepeatTrigger",j),f.$on("vsRepeatResize",function(){I=!0,o()});var P,Q,R,S;f.$on("vsRenderAll",function(){L.latch&&setTimeout(function(){var a=A;S=Math.max(a,S),f.endIndex=L.latch?S:a,f[r]=E.slice(f.startIndex,f.endIndex),Q=f.endIndex,f.$$postDigest(function(){G.css(p(),0),H.css(p(),0)}),f.$apply(function(){f.$emit("vsRenderAllDone")})})});var T;f.$watch(function(){"function"==typeof window.requestAnimationFrame?window.requestAnimationFrame(y):y()})}}}}}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){"use strict";var c;!function(b){function c(a){if(a){var b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate();return 1e4*b+100*c+d}}function d(a,b){if(a>2e7){var c=Math.floor(a/100)%100;if(c>=1&&c<=12){var d=a%100;if(d>=1&&d<=31)return new Date(Math.floor(a/1e4),c-1,d)}}return b}function e(a){var b;if(!isNaN(a)){var c=a,d=c/1e4,e=c/100%100,f=c%100;b=new Date(0,0,0,d,e,f)}return b}function f(b){var c,d=a.getService("ionweb.dateFormattingService");return b&&d&&(c=d.toCustom(b,"HH:mm:ss"),c=c.replace(/:/g,"")),parseInt(c)}b.getIonDateFromDate=c,b.getDateFromIonDate=d,b.getDateFromIonTime=e,b.getIonTimeFromDate=f}(c=b.DateUtils||(b.DateUtils={}))}(b=a.utils||(a.utils={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(){}return c.prototype.getQuery=function(c,d,e){var f=!1;c||(f=!0);var g=c.filterRootNode;if(g&&g.children&&0!==g.children.length){var h=g.children[0];h&&h.children&&0!==h.children.length&&h.nodeType===a.tables.NodeType.And||(f=!0)}else f=!0;if(e){var i=new b.XrsQueryBuilder,j=i.queryOn(d,e);if(!f){var k={condition:function(a,b){if(a.enabled){var c=a.id||a.tag;if(void 0!==c&&c.length>=0){var d=a.values.map(function(a,b,c){return a.value});j.appendCondition.apply(j,[a.field,a.operator].concat(d))}}return!0}},l=new a.tables.xrs.FilterTreeVisitor(g,k);l.visit()}if(c.searchOptions){var m=c.searchOptions;m.maxResults&&j.withMaxResultSize(m.maxResults),m.subscribedFields&&j.withSubscribedFields.apply(j,m.subscribedFields),m.includeAllRevisions&&j.includeAllRevisions()}return j.build()}},c}();b.XrsQueryBuilderService=c,angular.module("ionwebGrids").service("ionweb.xrsQueryBuilderService",function(){return new c})}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(){}return c.prototype.getDisplayValue=function(c){var d,e,f="";if(!c)return[f];if(1===c.values.length){var g=new b.XrsOperatorsRegistry;c.operator===g.greaterThanOrEqualsTo.id?(d=a.utils.DateUtils.getDateFromIonDate(c.values[0].value),e=void 0):c.operator===g.lessThanOrEqualsTo.id?(d=void 0,e=a.utils.DateUtils.getDateFromIonDate(c.values[0].value)):(d=a.utils.DateUtils.getDateFromIonDate(c.values[0].value),e=a.utils.DateUtils.getDateFromIonDate(c.values[0].value))}else{if(2!==c.values.length)throw new Error(a.tables.Strings.Text_Filter_Panel_Error_Invalid_Date_Range);d=a.utils.DateUtils.getDateFromIonDate(c.values[0].value),e=a.utils.DateUtils.getDateFromIonDate(c.values[1].value)}return void 0!==e&&null!==e&&void 0!==d&&null!==d?(f=d.getTime()===e.getTime()?d.toDateString():d.toDateString().trim()+" - "+e.toDateString().trim(),[f.trim()]):(void 0===d||null==d||void 0!==e&&null!==e||(f=a.tables.Strings.Grids_Text_After_Date+" "+d.toDateString().trim()),void 0===e||null===e||void 0!==d&&null!==d||(f=a.tables.Strings.Grids_Text_Before_Date+" "+e.toDateString().trim()),[f.trim()])},c}();b.DateRangeItemPresenter=c}(b=a.xrs||(a.xrs={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(){}return c.prototype.convertSelectionToMeasures=function(a,b){var c=a.getColumnAxis();b.args=Object.keys(b.args.reduce(function(a,b){var d=c.contains(b)&&c.getNodeAndMeasureKey(b).measureKey;return d&&(a[d]=!0),a},{}))},c.prototype.fetchRulesForSelection=function(a,c){var d=a.getRules().filter(function(a){var d=a.selection&&a.selection.type;if(d===b.GridRangeType.Column){var e={};a.selection.args.forEach(function(a){return e[a]=!0});for(var f=0;f<c.args.length;f++){var g=c.args[f];if(e[g])return!0}}return d===b.GridRangeType.Table||d===b.GridRangeType.Row});return d},c.prototype.deleteMixingFlag=function(a){return delete a.isDateFormatMixed,delete a.isDecimalPlacesMixed,delete a.isNegativeFormatMixed,delete a.isScaleFactorMixed,a},c.prototype.getClonedRules=function(){return this.rules.map(function(c){return{style:b.PresentationStyle.clone(c.style),selection:c.selection,condition:a.extendChildren({},[c.condition])}})},c.prototype.mergeColumnSelection=function(a,b){var c=a.args,d=b.args;d.forEach(function(a){c.indexOf(a)===-1&&c.push(a)})},c.prototype.copyColumnFormatting=function(a,c){this.formattingOptions=this.deleteMixingFlag(a.__getColumnFormattingOptions(c));var d=!1;a.useMeasures&&c.type===b.GridRangeType.Column&&(this.convertSelectionToMeasures(a,c),d=!0),this.rules=this.fetchRulesForSelection(a,c)},c.prototype.pasteColumnFormatting=function(a,c){var d=!1;a.useMeasures&&c.type===b.GridRangeType.Column&&(this.convertSelectionToMeasures(a,c),d=!0),a.__setColumnFormattingOptions(c,this.formattingOptions);for(var e=this.getClonedRules(),f=a.getRules(),g=[],h=[],i=0;i<e.length;i++){for(var j=!1,k=0;k<f.length;k++)if(this.areRulesEqual(e[i],f[k])){j=!0,this.mergeColumnSelection(f[k].selection,c),h.push(f[k]),g.push(f[k]);break}if(!j){var l=e[i];l.selection=c,g.push(l)}}a.setRules(g.concat(a.getRules().filter(function(a){return h.indexOf(a)==-1})))},c.prototype.areRulesEqual=function(b,c){var d=!0;return a.equals(b.condition,c.condition)||(d=!1),a.equals(b.style,c.style)||(d=!1),d},c.prototype.isPasteAvailable=function(){return!!this.formattingOptions||!(!this.rules||!this.rules.length)},c}();angular.module("ionwebGrids").service("ionweb.columnFmtClipboardService",[function(){return new c}])}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function b(b,c){this.dataModel=b,this.gridOptions=c,this.pivotAxis=b.getRowAxis().getAs(a.PivotAxis);this.gridOptions.outlineModeConfiguration&&this.gridOptions.outlineModeConfiguration.rowLevelDescriptors;this.groupingDataModel=this.dataModel.getAs(a.GroupingDataModel)}return b.prototype.onCollapseAll=function(){this.pivotAxis.collapseAll()},b.prototype.onExpandToLastLevel=function(){this.pivotAxis.expandToLevel(this.levels.length)},b.prototype.onExpandToDetails=function(){this.pivotAxis.expandToDetails()},b.prototype.onExpandToLevel=function(a){this.pivotAxis.expandToLevel(a+1)},Object.defineProperty(b.prototype,"levels",{get:function(){var a=this.gridOptions.outlineModeConfiguration&&this.gridOptions.outlineModeConfiguration.rowLevelDescriptors;if(a&&this.groupingDataModel)for(var b=[],c=1;c<a.length;c++)b.push(a[c].alias||a[c].caption);return b},enumerable:!0,configurable:!0}),b}();a.GroupingUserActionManager=b}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){a[a.None=0]="None",a[a.Mobile=1]="Mobile",a[a.Desktop=2]="Desktop",a[a.MobileAndDesktop=3]="MobileAndDesktop"}(b=a.GridResponsiveContext||(a.GridResponsiveContext={}));var c=function(){function a(){}return a.processLayout=function(a,b,c,d){var e=this,f={visibleKeys:[],groups:{}},g=a.priorityArray||[],h=a.groups||{},i=this.completePriorityArray(g,b,h),j={},k=[];b.forEach(function(a){j[a.key]=a.width,k.push(a.key)}),c&&c.forEach(function(a){j[a.key]=a.width});var l=this.prepareGroupList(k,h,i),m=this.doProposedColumnsFit(k,j,d.width);m||(m=l.some(function(a){return e.applyGroupCollapsion(k,a,f),e.doProposedColumnsFit(k,j,d.width)}));var n=this.visualColumnsInPriority(k,i);return m||this.performColumnDrop(k,n,j,d.width),k.forEach(function(a){a&&j[a]>0&&f.visibleKeys.push(a)}),0===f.visibleKeys.length&&i.length>0&&n.length>0&&f.visibleKeys.push(n[0]),f},a.doProposedColumnsFit=function(a,b,c){var d=0;return a.forEach(function(a){return d+=(a?b[a]:0)+1}),d<c},a.performColumnDrop=function(a,b,c,d){var e=0,f=[];b.forEach(function(a){e+=c[a],e>d&&f.push(a)}),f.forEach(function(b){return a[a.indexOf(b)]=null})},a.visualColumnsInPriority=function(a,b){var c=[];return b.forEach(this.applyInPriority(a,function(a){c.push(a)})),c},a.applyInPriority=function(a,b){return function(c){Array.isArray(c)?c.filter(function(b){return a.indexOf(b)!==-1}).sort(function(b,c){return a.indexOf(b)-a.indexOf(c)}).forEach(function(a){return b(a)}):a.indexOf(c)!==-1&&b(c)}},a.applyGroupCollapsion=function(a,b,c){var d=[];a.forEach(function(a,c){b.groupDef.groupedKeys.indexOf(a)!==-1&&d.push(c)}),a[d[0]]=b.key,d.forEach(function(c,d){0===d?a[c]=b.key:a[c]=null}),c.groups[b.key]=b},a.compareGroups=function(a,b,c,d,e){for(var f=e.length-1;f>=0;){var g=e[f];if(c.groupedKeys.indexOf(g)>=0)return-1;if(d.groupedKeys.indexOf(g)>=0)return 1;f--}return 0},a.intersectGropedColumns=function(a,b){var c={displayName:a.displayName,groupedKeys:a.groupedKeys.filter(function(a){return b.indexOf(a)>=0}),groupableKeys:a.groupedKeys,description:a.description,category:a.category,editableKey:a.editableKey,sortingKey:a.sortingKey,filteringKey:a.filteringKey};return c},a.prepareGroupList=function(b,c,d){var e=this.visualColumnsInPriority(b,d),f=Object.keys(c).filter(function(a){var b=c[a];return b.groupedKeys.filter(function(a){return e.indexOf(a)>=0}).length>1}).sort(function(b,d){return a.compareGroups(b,d,c[b],c[d],e)}).map(function(b){return{key:b,groupDef:a.intersectGropedColumns(c[b],e)}});return f},a.completePriorityArray=function(a,b,c){var d=this,e=[];b.forEach(function(b){a.some(d.findPriorityKey(b.key))===!1&&e.push(b.key)}),Object.keys(c).forEach(function(b){a.some(d.findPriorityKey(b))===!1&&e.push(b)});var f=a.slice(0);return e.length>0&&f.push(e),f},a.findPriorityKey=function(a){return function(b){return Array.isArray(b)?b.indexOf(a)!==-1:b===a}},a}();a.GridResponsiveUtils=c}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function a(a,b,c){this.templateStorageManager=a,this.currentUser=b,this.$qService=c}return a.prototype.getTemplate=function(a){return this.$qService.when(this.templateStorageManager.getTemplate(a.templateMetaData))},a.prototype.shareTemplate=function(a){return this.$qService.when(this.templateStorageManager.shareTemplate(a.templateMetaData))},a.prototype.unshareTemplate=function(a){return this.$qService.when(this.templateStorageManager.unshareTemplate(a.templateMetaData))},a.prototype.getFirstTemplateMdWithName=function(a){var b=this;return this.$qService.when(this.templateStorageManager.getTemplatesMetaData()).then(function(a){var c;return a.length&&(c=new e(a[0],b.currentUser)),c})},a.prototype.getTemplatesMetaData=function(){var a=this;return this.$qService.when(this.templateStorageManager.getTemplatesMetaData()).then(function(b){return b.map(function(b){return new e(b,a.currentUser)})})},a.prototype.getTemplateMetaDataWithId=function(a){return this.getTemplatesMetaData().then(function(c){var d=c.filter(function(b){return b.value===a});if(!d.length)throw b.Strings.Text_Template_Storage_Error_Template_Deleted;return d[0]})},a.prototype.removeTemplate=function(a){return this.$qService.when(this.templateStorageManager.removeTemplate(a.templateMetaData))},a.prototype.addTemplate=function(a){var b=this;return this.$qService.when(this.templateStorageManager.addTemplate(a)).then(function(a){return a.templateStorageMd&&(a.uiTemplateStorageMd=new e(a.templateStorageMd,b.currentUser)),a})},a.prototype.updateTemplate=function(a,b){var c=this;return this.$qService.when(this.templateStorageManager.updateTemplate(a.templateMetaData,b)).then(function(a){return a.templateStorageMd&&(a.uiTemplateStorageMd=new e(a.templateStorageMd,c.currentUser)),a})},a}(),e=function(){function a(a,b){this.templateMetaData=a,this._isOwner=this.templateMetaData.ownerId===b}return Object.defineProperty(a.prototype,"value",{get:function(){return this.templateMetaData.storage.id},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"name",{get:function(){return this.templateMetaData.name},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ownerId",{get:function(){return this.templateMetaData.ownerId},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"shared",{get:function(){return this.templateMetaData.shared},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isOwner",{get:function(){return this._isOwner},enumerable:!0,configurable:!0}),a}(),f=function(){function a(){this.restrict="EA",this.scope={gridState:"<?",gridClass:"<?",appliedFeedback:"<?",templateMetaData:"=?",onReset:"&",gridStateEvent:"<?",storageManager:"<?",error:"=?"},this.controller=h,this.controllerAs="ctrl",this.bindToController=!0,this.templateUrl="grids.ui/templatepod/gridTemplateSelector.tpl.html"}return a}(),g=function(){function a(a,b,c){this.getUITemplateMetaData=a,this.restorePoint=b,this.currentUserName=c,this._disableSave=!0,this._disableReset=!0}return a.prototype.isOwner=function(){return!!this.getUITemplateMetaData()&&this.getUITemplateMetaData().ownerId==this.currentUserName},Object.defineProperty(a.prototype,"shareIcon",{get:function(){return this.getUITemplateMetaData()&&this.getUITemplateMetaData().shared?"unshare":"public"},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"disableSave",{get:function(){return this._disableSave},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"disableReset",{get:function(){return this._disableReset},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"disableDelete",{get:function(){return!this.isOwner()||!this.getUITemplateMetaData()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"disableShare",{get:function(){return!this.isOwner()},enumerable:!0,configurable:!0}),a.prototype.updateResetState=function(a){var b=this.restorePoint();return b||this.getUITemplateMetaData()?void(this._disableReset=a):void(this._disableReset=!0)},a.prototype.updateSaveState=function(a,b,c){return b?void(a&&a.ownerId===this.currentUserName?this._disableSave=c:a&&a.name===b?this._disableSave=!0:this._disableSave=c):void(this._disableSave=!0)},a}(),h=function(){function c(a,b,c,e,f){var h=this;if(this.$scope=a,this.serverService=b,this.$timeout=c,this.notificationService=e,this.$qService=f,this.validation={state:void 0,message:void 0},this.acbCurrentString=this.uiTemplateMetaData&&this.uiTemplateMetaData.name,this.templateId=this.uiTemplateMetaData&&this.uiTemplateMetaData.value,this.loggedUserName=this.serverService.getUserName(),this.uiTemplateDataAdapter=new d(this.storageManager,this.loggedUserName,this.$qService),this.buttonAdapter=new g(function(){return h.uiTemplateMetaData},function(){return h.templateToBeRestore},this.loggedUserName),this.uiTemplateMetaData){var i=!0;this.uiTemplateDataAdapter.getTemplate(this.uiTemplateMetaData).then(function(a){h.compareGridStates(a.state,h.gridState())||(i=!1),h.buttonAdapter.updateSaveState(h.uiTemplateMetaData,h.acbCurrentString,i),h.buttonAdapter.updateResetState(i)}).catch(function(a){h.acbCurrentString=h.templateId=h.uiTemplateMetaData.name,h.buttonAdapter.updateResetState(i),h.buttonAdapter.updateSaveState(h.uiTemplateMetaData,h.acbCurrentString,!1),h.error=a})}this.initEvents(),this.filterTemplateMd=this.filterTemplateMd.bind(this),this.optionProvider=this.optionProvider.bind(this)}return Object.defineProperty(c.prototype,"templateMetaData",{get:function(){return this._templateMetaData},set:function(a){!a||a instanceof e||(this._uiTemplateMetaData=new e(a,this.loggedUserName)),this._templateMetaData=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"uiTemplateMetaData",{get:function(){return this._uiTemplateMetaData},set:function(a){a instanceof e?this._templateMetaData=a.templateMetaData:this._templateMetaData=a,this._uiTemplateMetaData=a},enumerable:!0,configurable:!0}),c.prototype.$onDestroy=function(){this.templateStateUnsubscriber&&this.templateStateUnsubscriber()},c.prototype.scheduleTask=function(a){var b=this;this.debounceTimer&&this.$timeout.cancel(this.debounceTimer),this.debounceTimer=this.$timeout(function(){a(),b.debounceTimer=null},50)},c.prototype.compareGridStates=function(b,c){var d=JSON.stringify(b,a.LazySerializable.jsonReplacer),e=JSON.stringify(c,a.LazySerializable.jsonReplacer);return d===e},c.prototype.createRestorePoint=function(){this.uiTemplateMetaData&&(this.templateToBeRestore=this.uiTemplateMetaData)},c.prototype.initEvents=function(){var a=this;this.$scope.$watch("ctrl.error",function(c){c===b.Strings.Text_Template_Storage_Error_Template_Deleted&&(a.notificationService.showError(b.Strings.Grid_Template_Info_Template_Deleted),a.uiTemplateMetaData=null,a.error=null,a.buttonAdapter.updateResetState(!0),a.buttonAdapter.updateSaveState(a.uiTemplateMetaData,a.acbCurrentString,!1))}),this.$scope.$watch("ctrl.templateId",function(b,c){if((b||c)&&b!==c)if(a.updateUI({succeeded:!0}),b)if(a.templateId===a.acbCurrentString){if(a.lastResult){var d=a.lastResult.filter(function(b){return b.name===a.templateId});d.length||a.createRestorePoint(),a.uiTemplateMetaData=d[0]}}else a.uiTemplateDataAdapter.getTemplateMetaDataWithId(a.templateId).then(function(b){a.acbCurrentString=b.name,a.uiTemplateMetaData=b}).catch(function(b){if(a.lastResult&&a.lastResult.length){var c=a.lastResult&&a.lastResult.filter(function(b){return b.value===a.templateId});a.acbCurrentString=c[0].name}a.uiTemplateMetaData=null,a.error=b});else a.createRestorePoint(),a.uiTemplateMetaData=null});var c=this;this.templateStateUnsubscriber=c.gridStateEvent.add(function(){c.scheduleTask(function(){c.uiTemplateMetaData&&c.uiTemplateDataAdapter.getTemplate(c.uiTemplateMetaData).then(function(a){var b;b=!!c.compareGridStates(a.state,c.gridState()),c.buttonAdapter.updateSaveState(c.uiTemplateMetaData,c.acbCurrentString,b),c.buttonAdapter.updateResetState(b)}).catch(function(b){a.error=b})})})},c.prototype.addUpdateTemplate=function(){var a=this;return this.uiTemplateDataAdapter.getTemplatesMetaData().then(function(b){var c=b.filter(function(b){return b.value===a.templateId}),d={name:a.acbCurrentString,state:a.gridState(),class:a.gridClass};return c.length?a.uiTemplateDataAdapter.updateTemplate(c[0],d):(d.state.templateState={name:a.acbCurrentString,ownerId:a.loggedUserName},a.uiTemplateDataAdapter.addTemplate(d))}).then(function(b){b.succeeded&&(a.uiTemplateMetaData=b.uiTemplateStorageMd),a.templateId=a.uiTemplateMetaData.value,a.updateUI(b)}).catch(function(b){a.updateUI({succeeded:!1,message:b})})},c.prototype.removeTemplate=function(){var a=this;return this.uiTemplateDataAdapter.removeTemplate(this.uiTemplateMetaData).then(function(b){b.succeeded&&(a.templateId=null,a.uiTemplateMetaData=null),a.updateUI(b)}).catch(function(b){a.error=b,a.updateUI({succeeded:!1,message:b})})},c.prototype.toggleShare=function(){var a,b=this;return a=this.uiTemplateMetaData.shared?this.uiTemplateDataAdapter.unshareTemplate(this.uiTemplateMetaData).then(function(a){b.updateUI(a)}):this.uiTemplateDataAdapter.shareTemplate(this.uiTemplateMetaData).then(function(a){b.updateUI(a)}),a.catch(function(a){b.error=a,b.updateUI({succeeded:!1,message:a})})},c.prototype.onTemplateReset=function(){this.uiTemplateMetaData?this.onReset():this.templateToBeRestore?(this.templateId=this.templateToBeRestore.value,this.templateToBeRestore=null):this.buttonAdapter.updateResetState(!0)},c.prototype.filterTemplateMd=function(a){var b=this;return this.uiTemplateDataAdapter.getTemplatesMetaData().then(function(c){var d={options:c.filter(function(b){return b.name.indexOf(a)>=0})};return b.lastResult=d.options,d})},c.prototype.onTextChange=function(a){var b=this;this.acbCurrentString=a,this.uiTemplateDataAdapter.getFirstTemplateMdWithName(a).then(function(c){b.buttonAdapter.updateSaveState(c,a,!1)}),this.buttonAdapter.updateResetState(!1)},c.prototype.optionProvider=function(a){var b=this;return this.uiTemplateDataAdapter.getTemplatesMetaData().then(function(c){var d=c.filter(function(b){return b.value===a});return d.length?(b.acbCurrentString=d[0].name,d[0]):a})},c.prototype.updateUI=function(b){b.succeeded?this.validation.state=a.validation.ValidationState.Valid:(this.validation.state=a.validation.ValidationState.Error,
this.validation.message=b.message)},c.$inject=["$scope","ionweb.serverService","$timeout","ionweb.notificationService","$q"],c}();angular.module("ionwebGrids").directive("gridTemplateDirective",[function(){return new f}])}(c=b.templates||(b.templates={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(c,d){this.templateType=c,this.gridState=d,this._gridTplStorageManager=new b.GridTemplateStorageManager(c),this._configTemplateChanged=new a.Event}return Object.defineProperty(c.prototype,"configTemplateChanged",{get:function(){return this._configTemplateChanged},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"storageManager",{get:function(){return this._gridTplStorageManager},enumerable:!0,configurable:!0}),c.prototype.init=function(b){this._configTemplateChanged=new a.Event,this.gridState=b},c.prototype.getTemplateMd=function(){return this._templateMd},c.prototype.applyTemplate=function(a){var b=this;return this._gridTplStorageManager.getTemplate(a).then(function(c){b._templateMd=a,b._configTemplateChanged.raise(b,c)})},c.prototype.restoreTemplate=function(){return this.applyTemplate(this._templateMd)},c.prototype.clearTemplate=function(){this._templateMd=null,this._configTemplateChanged.raise(this,null)},Object.defineProperty(c.prototype,"state",{get:function(){return this._templateMd&&{name:this._templateMd.name,ownerId:this._templateMd.ownerId}||this._volatileTemplate&&{name:this._volatileTemplate.name,ownerId:this._volatileTemplate.ownerId}},set:function(a){var b=this;a&&a.name&&(this._volatileTemplate=a,this._gridTplStorageManager.getTemplatesMetaData().then(function(c){var d=c.filter(function(b){return b.name===a.name&&a.ownerId===b.ownerId});d.length?b._templateMd=d[0]:(b._templateMd=null,b._configTemplateChanged.raise(b,null)),b._volatileTemplate=null}))},enumerable:!0,configurable:!0}),c}();b.Manager=c}(c=b.templates||(b.templates={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(a,b,c){this.templateManager=a,this.notificationService=b,this.$q=c}return c.prototype.getTemplateMenus=function(){var c=this,d=this.templateManager.storageManager;return{text:b.Strings.Grid_Menu_Templates,menuType:a.MenuItemType.Submenu,asyncSubMenus:function(){return c.$q.when(d.getTemplatesMetaData()).then(function(d){var e;if(!d.length)throw b.Strings.Grid_Template_Error_No_Template;return e=d.map(function(d){return{text:d.name,menuType:a.MenuItemType.Checkbox,checked:c.isSelected(d),action:function(){c.templateManager.applyTemplate(d).catch(function(a){a==b.Strings.Text_Template_Storage_Error_Template_Deleted&&c.notificationService.showError(b.Strings.Grid_Template_Error_Template_Deleted)})}}})}).catch(function(b){return[{text:b,menuType:a.MenuItemType.General,disabled:!0}]})}}},c.prototype.isSelected=function(a){var b=!1,c=this.templateManager.getTemplateMd();return c&&(b=c.name===a.name&&c.ownerId===a.ownerId),b},c}();c.CtxTemplateStorageAdapter=d}(c=b.menu||(b.menu={}))}(b=a.tables||(a.tables={}))}(ionweb||(ionweb={})),angular.module("ionwebGrids").run(["$templateCache",function(a){"use strict";a.put("grids.ui/columnFilterPopup/gridColumnSelectorPopup.tpl.html",'<ionweb-popup-container style="display: inline"><div ionweb-popup-anchor style="display: inline"><ionweb-icon icon=list-view ng-click="isColumnFilterPopupOpen = !isColumnFilterPopupOpen" class="list-filter-popup-anchor grid-toolbar-right-button-icon"></div><ionweb-popup class="ion-widget-padding list-selector-popup" visible=isColumnFilterPopupOpen show-anchor-point-arrow=true><div class=list-selector-popup-container><ionweb-list-selector item-list=filteredColumns categories=categories item-clicked=onListSelectorItemClicked></ionweb-list-selector></div></ionweb-popup></ionweb-popup-container>'),a.put("grids.ui/columnFilterPopup/listSelector.tpl.html",'<div class=list-selector-container><div class="ion-unrelated-control-bottom-margin list-selector-search-container"><div class=list-selector-search-box ng-class="inputFocused ? \'alias-textbox-border-focus\' : \'ion-border\'"><input type=text class=list-selector-search-input ng-focus=inputFocus($event) ng-blur=inputBlur($event) placeholder="{{\'Grid_ColumnSelector_SearchByColumnPlaceholder\' | resource}}" ng-model=itemSearchFilter ng-model-options="{updateOn: \'default blur\', debounce: {\'default\': 250, \'blur\': 0}}"><ionweb-icon ng-if=!!itemSearchFilter class=list-selector-clear-search-icon icon=clear ng-click=clearSearch($event)></ionweb-icon><ionweb-icon ng-if=!itemSearchFilter class=list-selector-search-icon icon=search></ionweb-icon></div><div class=list-selector-category-box ng-show="categories && categories.length > 0"><label class=list-selector-label>Category</label><ionweb-autocomplete placeholder="{{\'Grid_ColumnSelector_SelectCategoriesPlaceholder\' | resource}}" options=categories multiple=true ng-model=selectedCategories.selection></ionweb-autocomplete></div></div><div class="ion-border list-filter-list-container ion-grouped-control-bottom-margin"><div class=list-selector-empty-container ng-if="!initializing && (!filteredList || !filteredList.length)"><label>{{"Grid_ColumnSelector_NoResultFound" | resource}}</label></div><div ng-class="{\'loader\': !!initializing && (!filteredList || !filteredList.length)}"></div><div class=list-filter-table-header-container ng-if="(!!filteredList && !!filteredList.length && (!displayOptions || !displayOptions.hideListHeader))"><table class=list-filter-table><thead class=list-filter-table-header><tr class=list-filter-table-header-row><th class=list-filter-table-checkbox-header-column></th><th class=list-filter-table-header-column>{{"Grid_ColumnSelector_Column" | resource}}</th><th class=list-filter-table-header-column ng-if="!!categories && !!categories.length">{{"Grid_ColumnSelector_Category" | resource}}</th></tr></thead></table></div><div class=list-filter-table-container ng-if="!!filteredList && !!filteredList.length"><table class=list-filter-table><tbody vs-repeat vs-scroll-parent=.list-filter-table-container><tr ng-repeat="item in filteredList track by item.key" ng-class="selectedItem && selectedItem.key === item.key ? \'list-filter-table-row-selected\' : \'list-filter-table-row\'"><td class=list-filter-table-checkbox-column ng-mouseenter="mouseEnter($event, item)" ng-mouseleave="mouseLeave($event, item)" ng-click="onRowClicked($event, item)"><input type=checkbox ng-checked=item.checked></td><td class=list-filter-table-column ng-mouseenter="mouseEnter($event, item)" ng-mouseleave="mouseLeave($event, item)" ng-click="onRowClicked($event, item)">{{item.displayName}}</td><td class=list-filter-table-column ng-mouseenter="mouseEnter($event, item)" ng-mouseleave="mouseLeave($event, item)" ng-click="onRowClicked($event, item)" ng-click="onRowClicked($event, item)" ng-if="!!categories && !!categories.length">{{item.category}}</td></tr></tbody></table></div></div><div class=list-selector-description-container ng-class="{\'list-selector-description-container-hide\': displayOptions && displayOptions.hideItemDescription}"><label class="text-primary ion-related-control-bottom-margin" ng-show="!!currentItem || !!selectedItem">{{(currentItem && currentItem.displayName) || (selectedItem && selectedItem.displayName)}}</label><label class=list-selector-description-label ng-show="!!currentItem || !!selectedItem">{{(currentItem && currentItem.description) || (selectedItem && selectedItem.description)}}</label><div class=list-selector-empty-container ng-show="!currentItem && !selectedItem"><label>{{"Grid_ColumnSelector_Description" | resource}}</label></div></div></div>'),a.put("grids.ui/columnHeaderPanel/headerIconsRegion.tpl.html",'<div class=gridHeaderPanelIcon><div style="display: inline-block" ng-repeat="icon in headerIcons track by $index" class=grid-icon-anchor-element><ionweb-icon icon={{icon.name}} color={{icon.color}} ng-show=shouldVisible(icon) ng-click=icon.clicked($event) class=grid-header-panel-icon></ionweb-icon></div></div>'),a.put("grids.ui/filterPanel/appliedFiltersToolbar.tpl.html",'<div class=ionweb-applied-filter-toolbar ng-if=alwaysVisible><div class=ionweb-applied-filter-toolbar-applied-filter><div class=filter-loader-icon-container><ionweb-icon icon={{toolbarIconName}} ng-disabled=!filterPanelContext.isAllFilterValid() class=ionweb-applied-filter-toolbar-search-button ng-class="{loader: isSearchInProgress}" ng-click="filterPanelContext.isAllFilterValid() && doQuery()"></ionweb-icon></div><ionweb-icon ng-if="filterPanelContext.hideFavoriteFilters !== true" icon=optionsVertical class=ionweb-applied-filter-toolbar-filter-option ng-click=showFilterOptions($event)></ionweb-icon><ionweb-scrollable ng-show=filterPanelContext.showFavoriteFiltersOnToolbarInternal><div class=ionweb-applied-filter-toolbar-favorite-filters><div class=ionweb-applied-filter-toolbar-favorite-filters-item-container><ionweb-button ng-repeat="favorite in filterPanelContext.favoritesOnToolbar track by (favorite.description + favorite.isDefault)" ng-click=onFavoriteFilterApply(favorite) role="{{favorite.description  === filterPanelContext.currentFilters.description && !favorite.isDefault === !filterPanelContext.currentFilters.isDefault ? \'primary\' : \'secondary\'}}" class=ionweb-applied-filter-toolbar-favorite-filters-item>{{favorite.description}} <span ng-if="favorite.description === activeFilterDescription.description && !favorite.isDefault === !activeFilterDescription.isDefault && isCurrentFavoriteFilterUpdated()" class=ionweb-filter-panel-toolbar-title-update-status>*</span></ionweb-button></div></div></ionweb-scrollable><div ng-show=!filterPanelContext.showFavoriteFiltersOnToolbarInternal class=ionweb-applied-filter-toolbar-applied-filter><div ng-show="activeFilterDescription.description && activeFilterDescription.description.length>0" class=ionweb-applied-filter-toolbar-filter-name>{{activeFilterDescription.description}} <span ng-if=isCurrentFavoriteFilterUpdated() class=ionweb-filter-panel-toolbar-title-update-status>*</span></div><div class=ionweb-applied-filter-toolbar-progress ng-show=isSearchInProgress><div class="progress-bar progress-bar-striped active ionweb-applied-filter-toolbar-progress-bar" role=progressbar>{{\'Searching\' | resource}}</div></div><ionweb-scrollable ng-show=!isSearchInProgress><div class=ionweb-applied-filter-toolbar-filters-container><div ng-repeat="filterNode in filterNodes" class=ionweb-applied-filter-toolbar-filter-value><div ng-show=filterNode.visible class=ionweb-applied-filter-toolbar-button><span ng-class="{\'ionweb-applied-filter-toolbar-excluded-field\' : filterNode.isExcluded()}">{{(showFieldNames || ((filterNode.isExcluded() && !filterNode.description)) ? ((filterNode.fieldDisplayName || filterNode.tag)) + \' \' :\'\')}}<ionweb-icon ng-if=filterNode.isExcluded() icon=notEqual class=ionweb-applied-filter-toolbar-exclude-icon></ionweb-icon>{{(!filterNode.isExcluded() && showFieldNames ? "= " : " ") + (filterNode.description && filterNode.description.length ? filterNode.description : "Text_Empty" | resource) }}</span><ionweb-icon ng-show=!filterPanelContext.filterMap[filterNode.id].required class=ionweb-applied-filter-toolbar-clear-button icon=close ng-click=removeFilterCondition($index)></ionweb-icon></div></div></div></ionweb-scrollable></div><ionweb-custom-content ng-if="customContentTemplate || customContentTemplateUrl" template=customContentTemplate template-url={{customContentTemplateUrl}} template-scope=customContentScope class=ionweb-applied-filter-toolbar-custom-content></ionweb-custom-content></div></div>'),a.put("grids.ui/filterPanel/autocompleteFilter.tpl.html",'<div class=filter-panel-item ng-class="{\'filter-panel-exclude-item\': item.enableExclude && item.enabled !== false}" ng-show=item.visible><ionweb-filter-label enable-exclude="item.enableExclude && item.enabled !== false" excluded=excludedFilter filter-title=item.displayName></ionweb-filter-label><ionweb-autocomplete validation-state=item.internalValidationState validation-message=item.internalValidationMessage ng-model=value allow-free-text=acbScopeOptions.allowFreeText options=acbDropdownItems disable-cache=true scope-options=acbScopeOptions.scopeOptions option-provider=acbOptionProvider multiple=acbScopeOptions.multiple show-user-button=acbScopeOptions.showUserButton user-button-icon=acbScopeOptions.userButtonIcon show-arrow-button=acbScopeOptions.showArrowButton show-clear-button=acbScopeOptions.showClearButton option-template-item-name=acbScopeOptions.optionTemplateItemName option-template=acbScopeOptions.optionTemplate footer-options=acbScopeOptions.footerOptions placeholder={{acbScopeOptions.placeholder}} show-footer=acbScopeOptions.showFooter user-button-action=handleSearch() search-field="label value" ng-disabled="item.enabled === false " disable-default-sorting=acbScopeOptions.disableDefaultSorting editable=acbScopeOptions.editable value-field={{acbScopeOptions.valueField}} label-field={{acbScopeOptions.labelField}} limit=acbScopeOptions.limit query-options=acbScopeOptions.queryOptions select-all-summary-text=acbScopeOptions.selectAllSummaryText select-single-option-on-paste=acbScopeOptions.selectSingleOptionOnPaste enable-select-all=acbScopeOptions.enableSelectAll show-selected-options=acbScopeOptions.showSelectedOptions ng-keypress=handleEnter($event)></ionweb-autocomplete></div>'),a.put("grids.ui/filterPanel/dateFilter.tpl.html",'<div class=filter-panel-item ng-show=item.visible><label class=filter-panel-item-title>{{item.displayName}}</label><ionweb-date-time-entry-box validation-message=item.internalValidationMessage validation-state=item.internalValidationState ng-model=value ng-disabled="item.enabled === false" ng-keypress=handleEnter($event) date-time-tags=dateTimeTags on-date-updated=onDateUpdated user-input=userInput mode=dteScopeOptions.mode placeholder={{dteScopeOptions.placeholder}} show-clear-button=dteScopeOptions.showClearButton show-arrow-button=dteScopeOptions.showArrowButton editable=dteScopeOptions.editable compact=dteScopeOptions.compact datepicker-options=dteScopeOptions.datepickerOptions timepicker-options=dteScopeOptions.timepickerOptions use-date-time-tags=dteScopeOptions.useDateTimeTags number-of-tag-columns=dteScopeOptions.numberOfTagColumns hide-tag-panel=dteScopeOptions.hideTagPanel tags-header-text={{dteScopeOptions.tagsHeaderText}}></ionweb-date-time-entry-box></div>'),a.put("grids.ui/filterPanel/dateRangeFilter.tpl.html",'<div class=filter-panel-item ng-show=item.visible><label class=filter-panel-item-title>{{item.displayName}}</label><ionweb-date-time-range-entry-box ng-model=value validation-message=item.internalValidationMessage validation-state=item.internalValidationState ng-disabled="item.enabled === false" ng-keypress=handleEnter($event) date-time-range-tags=rangeTags on-range-updated=onDateRangeUpdated user-input=userInput mode=dtreScopeOptions.mode placeholder={{dtreScopeOptions.placeholder}} show-clear-button=dtreScopeOptions.showClearButton show-arrow-button=dtreScopeOptions.showArrowButton editable=dtreScopeOptions.editable compact=dtreScopeOptions.compact from-date-time-picker-options=dtreScopeOptions.fromDateTimePickerOptions to-date-time-picker-options=dtreScopeOptions.toDateTimePickerOptions number-of-range-tag-columns=dtreScopeOptions.numberOfRangeTagColumns use-range-tags=dtreScopeOptions.useRangeTags range-tags-header-text={{dtreScopeOptions.rangeTagsHeaderText}} hide-range-tag-panel=dtreScopeOptions.hideRangeTagPanel header-options=dtreScopeOptions.headerOptions></ionweb-date-time-range-entry-box></div>'),a.put("grids.ui/filterPanel/favoriteFilterEditDialog.tpl.html","<div ng-controller=\"ionweb.favoriteFilterEditDialogController as favoriteFilterEditDialogController\"><div class=ion-grouped-control-bottom-margin><label>{{'Text_Filter_Name' | resource}}</label><input type=text class=ion-input ng-model=filterName autofocus ng-keyup=favoriteFilterEditDialogController.handleKeyAction($event)></div><div class=button-container-bottom-right><ionweb-button role=primary ng-disabled=favoriteFilterEditDialogController.isSaveDisabled ng-click=favoriteFilterEditDialogController.save()>{{'Btn_Ok' | resource}}</ionweb-button><ionweb-button role=secondary ng-click=favoriteFilterEditDialogController.cancel()>{{'Btn_Cancel' | resource}}</ionweb-button></div></div>"),a.put("grids.ui/filterPanel/favoriteFilterEditTiles.tpl.html",'<div ng-controller="ionweb.favoriteFilterEditTilesController as favoriteFilterEditTilesController" style="height: 100%; width: 100%; display:inline-flex"><input type=text class=ion-input ng-model=filterName style="height: 19px; width: 80%" ng-enter=favoriteFilterEditTilesController.save()><div style="float: right;margin-left: 8px"><ionweb-button icon=delete title="Delete filter" style="min-height: 19px; height: 19px; margin-right: 0px; padding-right: 0px; padding-left: 0px; font-size: 0.85em" ng-click=favoriteFilterEditTilesController.delete()></ionweb-button><ionweb-button icon=rename title="Rename filter" style="min-height: 19px; height: 19px; margin-left: 0px; padding-right: 0px; padding-left: 0px; font-size: 0.85em" ng-disabled=favoriteFilterEditTilesController.isSaveDisabled ng-click=favoriteFilterEditTilesController.save()></ionweb-button></div></div>'),a.put("grids.ui/filterPanel/favoriteFilterPanel.tpl.html",'<div ionweb-droppable drop=favoritePanelController.drop($dataTransfer) drag-over="favoritePanelController.dragOver(-2, $dataTransfer)" ng-controller="ionweb.favoritePanelController as favoritePanelController" class=filter-panel-favorite-filter-panel><label class="ionweb-filter-panel-toolbar-title ion-primary-label-to-control-bottom-margin ionweb-filter-panel-toolbar">{{\'Text_Favorite_Filter_Panel_Title\' | resource}}</label><div><div ionweb-droppable drag-over="favoritePanelController.dragOver($index, $dataTransfer)" ng-repeat="filter in favoritePanelController.favoriteFilters"><div class=filter-panel-favorite-filter-separator><div ng-class="{\'filter-panel-favorite-filter-dropping\' : favoritePanelController.droppingIndex === $index}"></div></div><div ng-class=favoritePanelController.getClass(filter) class=filter-panel-favorite-filter-drag-container ng-click=favoritePanelController.applyFilter(filter) ng-mouseenter="showEditingOptions = true" ng-mouseleave="showEditingOptions = false"><div ng-if="favoritePanelController.filterTobeEdited.description === filter.description" class=filter-panel-favorite-filter-input ng-click=$event.stopPropagation()><input type=text ionweb-validation validation-state=favoritePanelController.state validation-message=favoritePanelController.message class="ion-input filter-panel-favorite-filter-input saved-filter-class" ng-model=favoritePanelController.filterName ng-keydown=favoritePanelController.handleFilterEditAction($event,filter) ng-blur=favoritePanelController.removeFocus()></div><ionweb-icon class=filter-panel-favorite-filter-drag-handler icon=dragHandler ng-class="{\'non-touch-device\' : !favoritePanelController.isTouchable}" ng-show="favoritePanelController.favoriteFilters.length > 1 && favoritePanelController.filterTobeEdited.description !== filter.description && dashboardComponent.editMode" ionweb-draggable drag-start="favoritePanelController.favoriteFilters.length > 1 && favoritePanelController.dragStart(filter,$index,$dataTransfer)" drag-end=favoritePanelController.dragEnd($index,$dataTransfer)></ionweb-icon><span ng-if="favoritePanelController.filterTobeEdited.description !== filter.description" class=filter-panel-favorite-filter-name ng-class="{\'filter-panel-favorite-filter-name-padding\' : (favoritePanelController.favoriteFilters.length === 1 || !dashboardComponent.editMode)}">{{filter.description}}</span><div class=filter-panel-favorite-filter-edit-options-container ng-show="showEditingOptions && favoritePanelController.filterTobeEdited.description !== filter.description"><ionweb-icon icon=edit title={{&quot;Text_Rename_Filter&quot;|resource}} class=filter-panel-favorite-filter-edit-button ng-click=favoritePanelController.setEditMode($event,filter); ng-show=!filter.isDefault></ionweb-icon><ionweb-icon icon=delete title={{&quot;Text_Delete_Filter&quot;|resource}} class=filter-panel-favorite-filter-edit-button ng-click=favoritePanelController.delete(filter) ng-show=!filter.isDefault></ionweb-icon><ionweb-icon ng-if="favoritePanelController.filterShownOnToolbar() && favoritePanelController.isPinned(filter)" icon=unpin title={{&quot;Text_Remove_Filter_From_ToolBar&quot;|resource}} class=filter-panel-favorite-filter-edit-button ng-click=favoritePanelController.pinToToolBar($event,filter); ng-show=!filter.isDefault></ionweb-icon><ionweb-icon ng-if="favoritePanelController.filterShownOnToolbar() && !favoritePanelController.isPinned(filter)" icon=pin title={{&quot;Text_Add_Filter_To_ToolBar&quot;|resource}} class=filter-panel-favorite-filter-edit-button ng-click=favoritePanelController.pinToToolBar($event,filter); ng-show=!filter.isDefault></ionweb-icon><ionweb-icon icon=show title={{&quot;Text_Default_Filter&quot;|resource}} class=filter-panel-default-filter-indicator ng-show=filter.isDefault></ionweb-icon></div></div><div ng-if="$index===favoritePanelController.favoriteFilters.length-1" class=filter-panel-favorite-filter-separator><div ng-class="{\'filter-panel-favorite-filter-dropping\' : favoritePanelController.droppingIndex === favoritePanelController.favoriteFilters.length}"></div></div></div></div></div>'),a.put("grids.ui/filterPanel/filterLabel/filterLabel.tpl.html","<label ng-class=\"{'excluded-filter-mode': ctrl.enableExclude && ctrl.excluded}\" class=filter-panel-item-title ng-click=ctrl.toggleExcluded()>{{ctrl.filterTitle}}<ionweb-icon ng-if=ctrl.enableExclude ng-class=\"{'excluded-filter-mode': ctrl.excluded}\" class=filter-exclude-indicator icon=notEqual></ionweb-icon></label>"),a.put("grids.ui/filterPanel/filterPanel.tpl.html",'<div class="filter-panel-content ionweb-filter-panel-stand-alone"><div class=ionweb-filter-panel-header><label class=ionweb-filter-panel-toolbar-title>{{filterPanelOptions.filterPanelContext.getActiveFavoriteFilterName()}} <span ng-if=filterPanelOptions.filterPanelContext.currentFavoriteFilterUpdated class=ionweb-filter-panel-toolbar-title-update-status>*</span></label><ionweb-icon title={{&quot;Text_Configure_Filter&quot;|resource}} icon=optionsVertical class=ionweb-filter-panel-filter-options ng-click=filterPanelController.showFilterConfiguration($event,false)></ionweb-icon></div><ionweb-filter-panel class=ionweb-filter-panel filter-panel-options=filterPanelOptions></ionweb-filter-panel></div>'),a.put("grids.ui/filterPanel/filterPanelDirective.tpl.html",'<div class="filter-panel-content ionweb-filter-panel"><div ng-include=filterPanelOptions.templateUrl class=filter-panel-content-scrollable ng-if=filterPanelOptions.templateUrl></div><div class="filter-panel-content-scrollable filter-panel-content-dynamic-filters" ng-show=filterPanelOptions.filterTemplateScope ionweb-droppable drag-over="dragOver(-2, $dataTransfer, $event)" drag-leaving drag-leave="dragLeave(-2, $dataTransfer)" drop=drop($dataTransfer)></div><div ng-if="saveEditorMode == 0" class=filter-panel-action-buttons-container ng-class="[filterPanelOptions.filterPanelContext.hideFavoriteFilters ? \'filter-panel-action-single-button-container\' : \'filter-panel-action-multi-buttons-container ion-button-group\', saveEditorMode != 0 ? \'filter-panel-action-buttons-container-hidden\' : \'\']"><ionweb-button role=primary icon=refresh class=filter-panel-action-buttons ng-disabled=!isAllFilterValid ng-click=applyFilter()>{{\'Btn_Apply\' | resource}}</ionweb-button><ionweb-button role=secondary icon=save ng-click=updateFilter(true) ng-hide="filterPanelOptions.filterPanelContext.hideFavoriteFilters === true" ng-if=filterPanelOptions.filterPanelContext.sharedFiltersContextKey ng-disabled="!isActiveFavoriteFilterUpdated() || !isAllFilterValid">{{\'Btn_Save\' | resource}}</ionweb-button><ionweb-button role=secondary icon=saveAs ng-click=showSaveAsEditor(1) ng-disabled=!isAllFilterValid ng-hide="filterPanelOptions.filterPanelContext.hideFavoriteFilters === true" ng-if=filterPanelOptions.filterPanelContext.sharedFiltersContextKey>{{\'Btn_Save_As\' | resource}}</ionweb-button></div><div ng-if="saveEditorMode == 1" class=filter-panel-save-as-container><input ng-model=$parent.filterName class=filter-panel-save-as-container-input ng-keyup=handleKeyAction($event)><div class=filter-panel-save-as-container-buttons><ionweb-button role=primary ng-disabled="!filterName || filterName.length === 0 " ng-click=saveFilter(1)>{{\'Title_Save_Filter\' | resource}}</ionweb-button><ionweb-button role=secondary ng-click=showSaveAsEditor(0)>{{\'Btn_Cancel\' | resource}}</ionweb-button></div></div><div ng-if="saveEditorMode == 2" class=filter-panel-save-as-container><label class=filter-panel-save-as-container-warning-label>{{\'Text_Filter_Panel_Error_Filter_Exists\' | resource: {name: "\'" + filterName + "\'"} }}</label><div class=filter-panel-save-as-container-buttons><ionweb-button role=primary ng-click=saveFilter(2)>{{\'Text_Dashboard_WidgetConfirmOverwrite_OverwriteBtn\' | resource}}</ionweb-button><ionweb-button role=secondary ng-click=showSaveAsEditor(1)>{{\'Btn_Cancel\' | resource}}</ionweb-button></div></div></div>'),a.put("grids.ui/filterPanel/filterPanelToolbar.tpl.html","<div class=ionweb-filter-configure-toolbar><label class=ionweb-filter-configure-toolbar-title>{{getActiveFavoriteFilterName()}} <span ng-if=canSaveBeEnabled class=ionweb-filter-panel-toolbar-title-update-status>*</span></label></div>"),a.put("grids.ui/filterPanel/textFilter.tpl.html",'<div class=filter-panel-item ng-class="{\'filter-panel-exclude-item\': item.enableExclude && item.enabled !== false}" ng-show=item.visible><ionweb-filter-label enable-exclude="item.enableExclude && item.enabled !== false" excluded=excludedFilter filter-title=item.displayName></ionweb-filter-label><div><input ionweb-validation validation-state=item.internalValidationState validation-message=item.internalValidationMessage class=ion-input type=text ng-model=value ng-disabled="item.enabled === false" ng-blur=handleFocusLost() ng-focus=handleFocusGot() ng-keypress=handleEnter($event)></div></div>'),a.put("grids.ui/gridAppearance/appearance.tpl.html",'<div class="ion-widget-padding appearance-container"><div ng-class="{\'ion-border-bottom\': hasHierarchicalRows(), \'ion-widget-padding-bottom\': hasHierarchicalRows(), \'ion-grouped-control-bottom-margin\': hasHierarchicalRows()}"><div><label class=ion-primary-label-to-control-bottom-margin>{{"Grid_AppearanceOption_Title_Basic" | resource}}</label></div><div class=ion-related-control-bottom-margin ng-if=toolbarOptions><label class=checkbox-inline><input type=checkbox ng-model="toolbarOptions.enabled">{{"Grid_AppearanceOption_Show_Toolbar" | resource}}</label></div><div class=ion-related-control-bottom-margin><label class=checkbox-inline><input type=checkbox ng-model="appearanceOptions.showRowHeaders"> {{"Grid_AppearanceOption_Show_RowHeaders" | resource}}</label></div><div class=ion-related-control-bottom-margin><label class=checkbox-inline><input type=checkbox ng-model="appearanceOptions.showColumnHeaders"> {{"Grid_AppearanceOption_Show_ColumnHeaders" | resource}}</label></div><div class=ion-related-control-bottom-margin><label class=checkbox-inline><input type=checkbox ng-model="appearanceOptions.wrapHeadersText"> {{"Grid_AppearanceOption_Show_Wrap_ColumnHeaders_Text" | resource}}</label></div><div class=ion-related-control-bottom-margin><label class=checkbox-inline><input type=checkbox ng-model="appearanceOptions.enableFlashing"> {{"Grid_AppearanceOption_Enable_Flashing" | resource}}</label></div><div class=ion-related-control-bottom-margin><label class=checkbox-inline><input type=checkbox ng-model="appearanceOptions.enableZebraColoring"> {{"Grid_AppearanceOption_Enable_Zebra_Coloring" | resource}}</label></div><div class=ion-related-control-bottom-margin><label class=checkbox-inline><input type=checkbox ng-model="appearanceOptions.showColumnSeparators"> {{"Grid_AppearanceOption_Show_Column_Separators" | resource}}</label></div><div class=ion-related-control-bottom-margin ng-if=!configOptions.disableSidePanel><label class=checkbox-inline><input type=checkbox ng-model="appearanceOptions.showSidePanel"> {{"Grid_Menu_ShowSidePanel" | resource}}</label></div><div ng-show=showResponsiveness()><label class=ion-primary-label-to-control-bottom-margin>{{"Grid_AppearanceOption_Title_HorizontalScrolling" | resource}}</label><div><div class=ion-related-control-bottom-margin><label class=radio-inline><input type=radio ng-model=appearanceOptions.responsiveMode ng-value="0">{{"Grid_AppearanceOption_HorizontalScrolling_Auto" | resource}}</label></div><div class=ion-related-control-bottom-margin><label class=radio-inline><input type=radio ng-model=appearanceOptions.responsiveMode ng-value="1"> {{"Grid_AppearanceOption_HorizontalScrolling_Never" | resource}}</label></div><div class=ion-related-control-bottom-margin><label class=radio-inline><input type=radio ng-model=appearanceOptions.responsiveMode ng-value="2"> {{"Grid_AppearanceOption_HorizontalScrolling_Always" | resource}}</label></div></div></div></div><div ng-show=hasHierarchicalRows()><label class=ion-primary-label-to-control-bottom-margin>{{"Grid_AppearanceOption_Title_RowGrouping" | resource}}</label><div><label class=ion-label-to-input-bottom-margin>{{"Grid_AppearanceOption_Title_DisplayAs" | resource}}</label><div class=ion-related-control-bottom-margin><label class=radio-inline><input type=radio ng-model=appearanceOptions.enableOutlineMode ng-value="false"> {{"Grid_AppearanceOption_DisplayAs_Hierarchical" | resource}}</label></div><div class=ion-related-control-bottom-margin><label class=radio-inline><input type=radio ng-model=appearanceOptions.enableOutlineMode ng-value="true">{{"Grid_AppearanceOption_DisplayAs_Outline" | resource}}</label></div></div></div></div>'),a.put("grids.ui/gridAppearance/appearancePopup.tpl.html",'<ionweb-popup-container style="display: inline"><div ionweb-popup-anchor style="display: inline"><ionweb-icon icon=appearanceOptions ng-click="isOpen = !isOpen" class="appearance-options-icon grid-toolbar-right-button-icon"></div><ionweb-popup visible=isOpen show-anchor-point-arrow=true><appearance ng-model=appearanceOptions config-options=configOptions class=appearance-popup-container has-hierarchical-rows=hasHierarchicalRows() show-responsiveness=showResponsiveness()></appearance></ionweb-popup></ionweb-popup-container>'),a.put("grids.ui/gridColumnHeaderSettings/gridColumnHeaderElementDirective.tpl.html",'<div ng-class="showBottomBorder ? \'ion-border-bottom\' : \'\'" ng-mouseover="isOpen = true" ng-mouseleave="isOpen = false"><ionweb-popup-container><div ionweb-popup-anchor class="clearfix gridHeaderPanelEntry"><label>{{title}}</label><ionweb-icon class="pull-right disclosure-icon" icon=disclosure></ionweb-icon></div><ionweb-popup visible=isOpen automatically-close=true anchor-point=anchorPoint><ng-transclude></ng-transclude></ionweb-popup></ionweb-popup-container></div>'),a.put("grids.ui/gridColumnHeaderSettings/gridColumnHeaderSettings.tpl.html",'<div class=columnheader-popup><div class="clearfix gridHeaderPanelSettings" ng-if="!isRowLevelHeaderPanel && isHeaderPanelSettingEnabled()"><ionweb-button class=grid-column-header-popup-menu ng-class="{\'ion-grouped-control-bottom-margin\': aliasOptions.showColumnAliasEntryBox}" icon="{{(toolbarOptions && toolbarOptions.moveColumnBackward && toolbarOptions.moveColumnBackward.icon) || \'moveleft\'}}" ng-click=moveColumnLeftClicked() ng-disabled=columnLeftMovementDisabled ng-if="(!toolbarOptions || !toolbarOptions.moveColumnBackward || !toolbarOptions.moveColumnBackward.hide) && editingOptions.reorderColumns"></ionweb-button><ionweb-button class=grid-column-header-popup-menu ng-class="{\'ion-grouped-control-bottom-margin\': aliasOptions.showColumnAliasEntryBox}" icon="{{(toolbarOptions && toolbarOptions.moveColumnForward && toolbarOptions.moveColumnForward.icon) || \'moveright\'}}" ng-click=moveColumnRightClicked() ng-disabled=columnRightMovementDisabled ng-if="(!toolbarOptions || !toolbarOptions.moveColumnForward || !toolbarOptions.moveColumnForward.hide) && editingOptions.reorderColumns"></ionweb-button><ionweb-button class=grid-column-header-popup-menu ng-class="{\'ion-grouped-control-bottom-margin\': aliasOptions.showColumnAliasEntryBox}" icon="{{(toolbarOptions && toolbarOptions.aliasColumn && toolbarOptions.aliasColumn.icon) || \'rename\'}}" ng-click="aliasOptions.showColumnAliasEntryBox = !aliasOptions.showColumnAliasEntryBox" ng-if="(!toolbarOptions || !toolbarOptions.aliasColumn || !toolbarOptions.aliasColumn.hide) && editingOptions.renameColumns"></ionweb-button><ionweb-button class=grid-column-header-popup-menu-delete ng-class="{\'ion-grouped-control-bottom-margin\': aliasOptions.showColumnAliasEntryBox}" icon="{{(toolbarOptions && toolbarOptions.hideColumn && toolbarOptions.hideColumn.icon) || \'delete\'}}" ng-click=hideColumnButtonClicked() ng-disabled=columnHideDisabled ng-if="(!toolbarOptions || !toolbarOptions.hideColumn || !toolbarOptions.hideColumn.hide) && editingOptions.deleteColumns"></ionweb-button></div><div class=textbox-with-right-accessories ng-class="aliasInputIsFocused ? \'alias-textbox-border-focus\': \'ion-border\'" ng-show="isRowLevelHeaderPanel || aliasOptions.showColumnAliasEntryBox"><input type=text class=columnheader-alias-input placeholder="{{\'Grid_Formatting_Text_Column_alias\'|resource}}" ng-focus="aliasInputIsFocused = true" ng-blur="aliasInputIsFocused = false" ng-model=alias ng-keypress="doWhenEnterKeyIsPressed($event)"><ionweb-icon class=columnheader-clear icon=clear ng-click=clearText()></ionweb-icon></div></div>'),
a.put("grids.ui/gridFormatting/gridFormattingControl.tpl.html",'<div ng-show="(options.onShowConditionalFormattingClicked || isAtleastOneFormattingOptionVisible())" class="ion-widget-padding cellformattingoption-container"><div ng-if=options.showDecimalPlaces class="ion-grouped-control-bottom-margin clearfix display-flex"><label class="ion-inline-label-to-input-margin cellformattingoption-decimal-selector">{{"Grid_FormattingOption_Decimal_Numbers" | resource}}</label><ionweb-numeric-up-down ng-class="{\'cellformattingoption-mixed-selection-background\' : formattingOptions && formattingOptions.isDecimalPlacesMixed}" tick=1 ng-model=formattingControlValues.decimalPlaces min-value=0 max-value=12 spinner-position=0 class="cellformattingoption-numeric-up-down pull-right"></ionweb-numeric-up-down></div><div ng-if=options.showNegativeFormat class=ion-grouped-control-bottom-margin><label class="ion-fmt-num-neg checkbox-inline"><input type=checkbox ng-model=formattingControlValues.negativeFormat> {{"Grid_FormattingOption_Negative_Numbers" | resource }}</label></div><div ng-if=options.showScaleFactor class="ion-grouped-control-bottom-margin clearfix"><label>{{"Grid_FormattingOption_Title_Show_NumbersIn" | resource}}</label><div class=ion-input-select><select class=ion-input ng-class="{\'ion-branding-accent-mildest-bg\' : formattingOptions && formattingOptions.isScaleFactorMixed}" ng-model=formattingControlValues.selectedScaleFactor ng-options="scaleFactor as \'Enum_NumberScaleFactor_\' + scaleFactor | resource for scaleFactor in scaleFactors"></select></div></div><div ng-if=options.showDateFormat class="ion-grouped-control-bottom-margin clearfix"><label>{{"Grid_FormattingOption_Title_Custom_DateFormat" | resource}}</label><div class=ion-input-select><select class=ion-input ng-class="{\'ion-branding-accent-mildest-bg\' : formattingOptions && formattingOptions.isDateFormatMixed}" ng-model=formattingControlValues.selectedDateFormat ng-options="dateFormatKey as dateFormatDisplay for (dateFormatKey , dateFormatDisplay) in dateFormats"></select></div></div><div ng-if=isAtleastOneFormattingOptionVisible()><ionweb-button role=secondary icon=reset icon-placement=before ng-click=reset()>{{"Grid_FormattingOption_Btn_Reset_To_Defaults" | resource}}</ionweb-button></div><a class=cellformattingoption-conditional-selector ng-if=options.onShowConditionalFormattingClicked ng-click=options.onShowConditionalFormattingClicked()>{{\'Grid_Menu_ConditionalFormatting\' | resource}}</a></div>'),a.put("grids.ui/gridFormatting/gridFormattingControlPopup.tpl.html",'<ionweb-popup-container ng-show="options.showDecimalPlaces || options.showNegativeFormat || options.showScaleFactor || options.showDateFormat" style="display: inline"><div ionweb-popup-anchor style="display: inline"><ionweb-icon icon=cellFormatting ng-click="isOpen = !isOpen" class="cellformatting-icon grid-toolbar-right-button-icon"></div><ionweb-popup visible=isOpen show-anchor-point-arrow=true><grid-formatting-control ng-model=dialog.formattingOptions options=options class=cellformattingoption-popup-container></grid-formatting-control></ionweb-popup></ionweb-popup-container>'),a.put("grids.ui/gridGroupingSidePanel.tpl.html","<div class=grouping-panel ng-controller=OptionsDialogGroupingController><ionweb-swap-panel available-nodes=availableNodes chosen-nodes=chosenNodes on-action=onAction($args) on-has-allowed-operation=onHasAllowedOperation($args) on-allowed-operation-request=onAllowedOperationRequest($args) is-vertical-mode=true></ionweb-swap-panel></div>"),a.put("grids.ui/gridHeaderPanels.tpl.html","<div><ionweb-grid-column-header-popup ng-model=column.alias options=options.gridFormattingControlOptions editing-options=options.editingOptions toolbar-options=options.headerPanelToolbarOptions formatting-options=formattingOptions set-formatting-options=setColumnFormattingOption column-id=column.id close-pop-up=closeContextMenu move-column-left=moveColumnLeftClicked move-column-right=moveColumnRightClicked hide-column=hideColumnClicked column-left-movement-disabled=columnLeftMovementDisabled column-right-movement-disabled=columnRightMovementDisabled column-hide-disabled=columnHideDisabled is-row-level-header-panel=isRowLevelHeaderPanel></ionweb-grid-column-header-popup></div>"),a.put("grids.ui/gridLoaderView.tpl.html",'<div class=grid-loading-panel><div class=grid-exporting-panel><div class="ionweb-spinner ionweb-spinner-medium"></div><div class=grid-loading-panel-status>{{data.text}}</div></div></div>'),a.put("grids.ui/gridSidePanel.tpl.html",'<div class=ionweb-grid-side-panel-container ng-show="!forceHideSidePanel && !options.configOptions.disableSidePanel" ng-class="{\'expanded\': !vm.isCollapsed}" ng-style="{\'height\': height + \'px\'}"><collapsible-pane ng-if=vm.isShown title-template=vm.titleTemplate title-template-url={{vm.titleTemplateUrl}} title-template-scope=vm.titleTemplateScope is-collapsed=vm.isCollapsed orientation=horizontal collapsed-orientation=vertical pane-settings=vm.getCollapsiblePaneSetting()><uib-tabset ng-show=!vm.isCollapsed class="ionweb-tabbed-pane ionweb-grid-side-panel-tabbar" active=tabModel.activeTabIndex><uib-tab index=$index ng-repeat="pane in vm.panes track by $index" ng-if="(!pane.isConfiguration || isInEditMode) && initialized"><uib-tab-heading title={{pane.title}}><ionweb-icon ng-class="pane.iconClass && pane.iconClass()" icon={{pane.icon}}></ionweb-icon></uib-tab-heading><ionweb-custom-content template=pane.template template-url={{pane.templateUrl}} template-scope=pane.templateScope class="side-panel-custom-content grid-side-panel-tab-icon-container"></ionweb-custom-content></uib-tab></uib-tabset></collapsible-pane></div>'),a.put("grids.ui/gridSidePanelTitle.tpl.html",'<div class=grid-side-panel-title><div ng-repeat="pane in panes track by $index" ng-if="!pane.isConfiguration || isInEditMode" ng-click=selectPane($index) class=grid-side-panel-tab-icon><div title={{pane.title}}><ionweb-icon ng-class="pane.iconClass && pane.iconClass()" icon={{pane.icon}}></ionweb-icon></div></div></div>'),a.put("grids.ui/gridSummaryPanel/summaryPanel.tpl.html",'<div class="pull-right summary-panel" ion-tooltip=tooltipOptions><div ionweb-context-menu-handler=contextMenuHandler><div ng-repeat="info in panelValues" class=summary-panel-info ng-show=info.visible><label>{{info.label}}</label><span ng-class=info.additionalClass>{{info.value}}</span></div></div></div>'),a.put("grids.ui/gridSummaryPanel/tooltip.tpl.html",'<div class=summary-panel-tooltip><table><tr ng-repeat="info in panelValues" ng-class="info.showSeparator && \'summary-panel-tooltip-row-separator\'"><td class=summary-panel-tooltip-label>{{info.label}}</td><td class=summary-panel-tooltip-value ng-style="{\'text-align\': panelValues.length === 1 && info.textAlign}"><span ng-class=info.additionalClass>{{info.value}}</span></td></tr></table></div>'),a.put("grids.ui/inlineEditing/acbCellEditor.tpl.html",'<div class=inline-editing-wrapper-div><ionweb-autocomplete class=inline-editing-acb-input ng-model=value on-text-change=textChanged(value) value-field={{acbScopeOptions.valueField}} label-field={{acbScopeOptions.labelField}} search-field={{acbScopeOptions.searchField}} allow-free-text=acbScopeOptions.allowFreeText allow-empty-value=acbScopeOptions.allowEmptyValue option-provider=acbScopeOptions.optionProvider option-template=acbScopeOptions.optionTemplate option-template-item-name=acbScopeOptions.optionTemplateItemName options=acbScopeOptions.options scope-options="{ onAutocompleteBound: onWidgetBound }" editable=acbScopeOptions.editable show-clear-button=acbScopeOptions.showClearButton></ionweb-autocomplete></div>'),a.put("grids.ui/inlineEditing/dtpCellEditor.tpl.html","<div class=inline-editing-wrapper-div><ionweb-date-time-entry-box ng-model=normalizedDate mode=mode disable-focus-on-date-picker=disableFocusOnDatePicker on-value-update=onValueUpdate on-date-updated=onDateUpdated user-input=userInput close-on-date-selection=false number-of-tag-columns=options.numberOfTagColumns use-date-time-tags=options.useDateTimeTags date-time-tags=options.dateTimeTags show-clear-button=false tags-header-text={{options.tagsHeaderText}}></ionweb-date-time-entry-box></div>"),a.put("grids.ui/inlineEditing/nudCellEditor.tpl.html","<div class=inline-editing-wrapper-div><ionweb-numeric-up-down class=inline-editing-nud-input ng-model=value model=nudModel tick=options.tick spinner-position=spinnerPosition on-current-text-change=onCurrentTextChange min-value=options.minValue max-value=options.maxValue></ionweb-numeric-up-down></div>"),a.put("grids.ui/inlineEditing/textCellEditor.tpl.html",'<div class=inline-editing-wrapper-div style="width: 100%"><input class="ion-input inline-editing-text-input" type=text ng-model=value></div>'),a.put("grids.ui/oneShotSortingConfirmationDialog.tpl.html","<div class=one-shot-sort-confirmation-dialog><h2>{{ dialogMessage }}</h2>{{ 'One_Time_Grid_Sorting_Description' | resource }}<div class=continue-message>{{ 'One_Time_Grid_Sorting_Continue' | resource }}</div><div class=button-panel><ionweb-button role=primary ng-click=sortAscending()>{{ 'One_Time_Grid_Sorting_Ascending' | resource }}</ionweb-button><ionweb-button role=secondary ng-click=sortDescending()>{{ 'One_Time_Grid_Sorting_Descending' | resource }}</ionweb-button><ionweb-button role=secondary ng-click=cancel()>{{ 'One_Time_Grid_Sorting_Cancel' | resource }}</ionweb-button></div></div>"),a.put("grids.ui/optionsDialog/AppearanceTab.tpl.html","<div appearance class=grid-option-dialog-flex-container ng-model=appearanceOptions config-options=options.configOptions toolbar-options=options.toolbarOptions has-hierarchical-rows=hasHierarchicalRows() show-responsiveness=showResponsiveness()></div>"),a.put("grids.ui/optionsDialog/ColumnsTab.tpl.html",'<div ionweb-list-selector class="grid-option-dialog-flex-container list-selector-option-dialog-container" item-list=filteredColumns categories=categories item-clicked=onListSelectorItemClicked></div>'),a.put("grids.ui/optionsDialog/FormattingTab.tpl.html","<div grid-formatting-control class=grid-option-dialog-flex-container ng-model=dialogOptions.formattingOptions options=options.gridFormattingControlOptions></div>"),a.put("grids.ui/optionsDialog/OptionsDialogGrouping.tpl.html","<div class=grouping-panel ng-controller=OptionsDialogGroupingController><ionweb-swap-panel available-nodes=availableNodes chosen-nodes=chosenNodes on-action=onAction($args) allowed-operation-options=allowedOperationOptions></ionweb-swap-panel></div>"),a.put("grids.ui/optionsDialog/OptionsDialogSorting.tpl.html","<div class=sorting-panel ng-controller=OptionsDialogSortingController><ionweb-swap-panel available-nodes=availableNodes chosen-nodes=chosenNodes on-action=onAction($args) allowed-operation-options=allowedOperationOptions chosen-action-descriptors=chosenActionDescriptors></ionweb-swap-panel></div>"),a.put("grids.ui/optionsDialog/OptionsDialogVisibleColumns.tpl.html","<div class=visible-columns-panel ng-controller=OptionsDialogVisibleColumnsController><ionweb-swap-panel available-nodes=availableNodes chosen-nodes=chosenNodes on-action=onAction($args) allowed-operation-options=allowedOperationOptions></ionweb-swap-panel></div>"),a.put("grids.ui/optionsDialog/optionsDialog.tpl.html",'<div class=grid-option-dialog><uib-tabset class=grid-option-dialog-flex-container><uib-tab ng-repeat="tab in optionsDialogTabs" heading={{tab.heading}}><ng-include class=grid-option-dialog-flex-container src=tab.content></ng-include></uib-tab></uib-tabset><div class="ion-border-bottom ion-widget-padding-bottom ion-grouped-control-bottom-margin" ng-if=options.configClass></div><grid-template-directive template-meta-data=templateModelConfig.templateMd on-reset=onRestore() grid-class=options.configClass grid-state=templateModelConfig.gridState ng-if=options.configClass on-share=onShareTemplate() grid-state-event=gridStateUpdatedEvent error=templateModelConfig.error storage-manager=templateStorageManager></grid-template-directive></div>'),a.put("grids.ui/rules/condFormat/conditionEditor.tpl.html","<div class=conditional-formatting-rule-margin><div ng-if=\"ctrl.mode == 'StringUnary'\"><input type=input ng-model=ctrl.condition.value class=ion-input ng-change=ctrl.onValChanged() . ionweb-validation validation-state=ctrl.validationState validation-message=ctrl.validationMessage></div><div ng-if=\"ctrl.mode == 'NumericUnary'\"><ionweb-numeric-up-down ng-model=ctrl.condition.value on-current-value-change=ctrl.onValChanged() validation-state=ctrl.validationState validation-message=ctrl.validationMessage></ionweb-numeric-up-down></div><div ng-if=\"ctrl.mode == 'DateUnary'\"><ionweb-date-time-entry-box ng-model=ctrl.date mode=0 date-time-tags=ctrl.dateTags use-date-time-tags=!!ctrl.dateTags hide-tag-panel=true on-value-update=ctrl.onParseDate show-tag-inline=true on-date-updated=ctrl.onDateChanged validation-state=ctrl.validationState validation-message=ctrl.validationMessage></ionweb-date-time-entry-box></div><div ng-if=\"ctrl.mode == 'NumericBinary'\"><div class=ion-related-control-bottom-margin><ionweb-numeric-up-down ng-model=ctrl.condition.min on-current-value-change=ctrl.onValChanged() validation-state=ctrl.validationState validation-message=ctrl.validationMessage></ionweb-numeric-up-down></div><ionweb-numeric-up-down ng-model=ctrl.condition.max on-current-value-change=ctrl.onValChanged() validation-state=ctrl.validationState validation-message=ctrl.validationMessage></ionweb-numeric-up-down></div><div ng-if=\"ctrl.mode == 'DateBinary'\"><div class=ion-related-control-bottom-margin><ionweb-date-time-entry-box ng-model=ctrl.minDate mode=0 date-time-tags=ctrl.dateTags use-date-time-tags=!!ctrl.dateTags hide-tag-panel=true on-value-update=ctrl.onParseDate show-tag-inline=true on-date-updated=ctrl.onMinDateChanged validation-state=ctrl.validationState validation-message=ctrl.validationMessage></ionweb-date-time-entry-box></div><ionweb-date-time-entry-box ng-model=ctrl.maxDate mode=0 date-time-tags=ctrl.dateTags use-date-time-tags=!!ctrl.dateTags hide-tag-panel=true on-value-update=ctrl.onParseDate show-tag-inline=true on-date-updated=ctrl.onMaxDateChanged validation-state=ctrl.validationState validation-message=ctrl.validationMessage></ionweb-date-time-entry-box></div></div>"),a.put("grids.ui/rules/condFormat/listView.tpl.html",'<div><div ng-repeat="rule in rules"><div class=conditional-formatting-separator ng-class="{\'conditional-formatting-separator-dropping\' : droppingIndex === $index}"></div><div class=conditional-formatting-rule ionweb-context-menu-handler=ruleContextMenu($index) ng-click=ruleClick($index)><table ionweb-droppable class=default-background ng-class="{\'conditional-formatting-rule-dragging\' : draggingIndex === $index}" drag-enter=dragEnter($index,$dataTransfer) drag-over="dragOver($index, $dataTransfer)" drop=drop($index,$dataTransfer) ng-mouseenter="mouseHover = true" ng-mouseleave="mouseHover = false"><tr><td ionweb-draggable drag-start="rules.length > 1 && dragStart($index,$dataTransfer)" drag-end=dragEnd($index,$dataTransfer) class=conditional-formatting-move-icon-container><div class=conditional-formatting-move-icon-container><ionweb-icon icon=dragHandler ng-show="rules.length > 1 && (mouseHover || touchable)" class=conditional-formatting-move-icon></ionweb-icon></div></td><td class=conditional-formatting-cell-preview-container><div class=conditional-formatting-cell-preview ng-style="{\'color\': rule.style.color, \'background-color\': rule.style.backgroundColor }">{{rule.preview}}</div></td><td><div class=conditional-formatting-info><b>{{rule.conditionStr}}</b></div><div ng-if=gridSpecific class=conditional-formatting-info>{{rule.selectionStr}}</div></td><td><div class=conditional-formatting-delete-icon-container><ionweb-icon class=conditional-formatting-delete-icon ng-show="mouseHover &&  draggingIndex != $index" icon=delete ng-click=deleteRule($index)></ionweb-icon></div></td></tr></table></div><div ng-if="$index===rules.length-1" class=conditional-formatting-separator ng-class="{\'conditional-formatting-separator-dropping\': droppingIndex === rules.length }"></div></div><div ng-if="!rules || !rules.length"><div class=conditional-formatting-separator></div><div class=conditional-formatting-no-rules>{{"Grid_NoRules" | resource }}</div><div class=conditional-formatting-separator></div></div><div class=conditional-formatting-add-new-rule><ionweb-button ng-click=newRule() role=primary>{{"Grid_AddNewRule" | resource }}</ionweb-button></div></div>'),a.put("grids.ui/rules/condFormat/ruleEditor.tpl.html",'<div><div class=conditional-formatting-separator></div><div ng-if=gridSpecific><label>{{"Grid_ApplyToColumn" | resource }}</label><div><a ng-click="options.selPopupOpen = !options.selPopupOpen">{{editingRule.selectionStr}}</a><div ng-if=options.selPopupOpen><div class=conditional-formatting-separator></div><ionweb-list-selector item-list=selectedColumns item-clicked=options.columnClicked categories=categories class=conditional-formatting-inline-column-sel></ionweb-list-selector></div></div><div class=conditional-formatting-separator></div></div><label>{{"Grid_FormatCellIf" | resource }}</label><ionweb-autocomplete style="width: 100%" ng-model=options.typeIndex options=conditionTypes show-arrow-button=showArrowButton show-clear-button=false show-user-button=false user-button-icon=false allow-free-text=false multiple=false></ionweb-autocomplete><ionweb-condition-editor condition=editingRule.condition date-tags=allDateTags></ionweb-condition-editor><div class=conditional-formatting-separator></div><label>{{"Grid_FormattingStyle" | resource }}</label><table class=default-colors><tr><td><button ng-style=defaultStyles[0] ng-click=defaultStyleClicked(0)>{{editingRule.preview}}</button></td><td><button ng-style=defaultStyles[1] ng-click=defaultStyleClicked(1)>{{editingRule.preview}}</button></td><td><button ng-style=defaultStyles[2] ng-click=defaultStyleClicked(2)>{{editingRule.preview}}</button></td></tr><tr><td><button ng-style=defaultStyles[3] ng-click=defaultStyleClicked(3)>{{editingRule.preview}}</button></td><td><button ng-style=defaultStyles[4] ng-click=defaultStyleClicked(4)>{{editingRule.preview}}</button></td><td><button ng-style=defaultStyles[5] ng-click=defaultStyleClicked(5)>{{editingRule.preview}}</button></td></tr></table><table><tr><td><table class=default-background><tr><td class=right-padding>{{"Grid_FormattingStyleForeground" | resource }}:</td><td><input show-tags=false support-transparent=true value-ext=editingRule.style.color type=color ionweb-color-picker class=ion-input></td></tr></table></td><td><table class=default-background><tr><td class=right-padding>{{"Grid_FormattingStyleBackground" | resource }}:</td><td><input show-tags=false support-transparent=true value-ext=editingRule.style.backgroundColor type=color ionweb-color-picker class=ion-input></td></tr></table></td></tr></table><div class=conditional-formatting-separator></div><div class=conditional-formatting-button-container><ionweb-button ng-click=saveRule() role=primary ng-disabled=invalid()>{{"Btn_Done" | resource }}</ionweb-button><ionweb-button class=conditional-formatting-cancel-button ng-click=cancelEditing() role=secondary>{{"Btn_Cancel" | resource }}</ionweb-button></div></div>'),a.put("grids.ui/rules/condFormat/view.tpl.html",'<div class=conditional-formatting-panel><div><h4 class=conditional-formatting-header>{{"Grid_ConditionalFormattingRules" | resource }}</h4><button type=button class="conditional-formatting-close-button ionicon ionicon-close" ng-click=close()></button></div><div class=conditional-formatting-panel-container><ng-include ng-if=!editingRule src="\'grids.ui/rules/condFormat/listView.tpl.html\'"></ng-include><ng-include ng-if=editingRule src="\'grids.ui/rules/condFormat/ruleEditor.tpl.html\'"></ng-include></div></div>'),a.put("grids.ui/rules/filterpanel/filterPanel.tpl.html",'<div class=gridpanel><div><h4 class=gridpanel-header>{{"Grid_Filtering" | resource}}</h4><button type=button class="gridpanel-close-button ionicon ionicon-close" ng-click=closeClicked()></button></div><div class=gridpanel-separator></div><div ng-if="filterConfiguration.hideConditionFilters !== true"><div class=column-filter-panel-display ng-click="!filterConfiguration.hideValueFilters && changeIconForConditionPanel()"><div ng-if=!filterConfiguration.hideValueFilters class=column-filter-icon-padding><ionweb-icon icon="{{expandedIconForConditionPanel ? \'expand\' : \'triangleDown\' || \'\'}}" class=column-filter-icon-size></ionweb-icon></div><div class=column-filter-text-padding><h5 class=gridpanel-header>{{"Grid_Filter_By_Condition" | resource}}</h5></div></div><div class=filter-by-condition-selector-popup-container ng-class="expandedIconForConditionPanel? \'column-filter-hide-panel\' : \'column-filter-show-condition-panel\'"><ionweb-autocomplete style="width: 100%" ng-model=$parent.typeIndex options=conditionTypes show-arrow-button=true allow-free-text=false multiple=false></ionweb-autocomplete><ionweb-condition-editor condition=conditionScope></ionweb-condition-editor></div></div><div ng-if="!filterConfiguration.hideConditionFilters && !filterConfiguration.hideValueFilters" class=gridpanel-separator></div><div ng-if="filterConfiguration.hideValueFilters === false"><div class=column-filter-panel-display ng-click="!filterConfiguration.hideConditionFilters && changeIconForValuePanel()"><div ng-if=!filterConfiguration.hideConditionFilters class=column-filter-icon-padding><ionweb-icon icon="{{expandedIconForValuePanel && !!filterConfiguration.hideConditionFilters ? \'expand\' : \'triangleDown\' || \'\'}}" class=column-filter-icon-size></ionweb-icon></div><div class=column-filter-text-padding><h5 class=gridpanel-header>{{"Grid_Filter_By_Value" | resource}}</h5></div></div><div class=filter-by-value-selector-popup-container ng-class="expandedIconForValuePanel? \'column-filter-hide-panel\' : \'column-filter-show-value-panel\'"><div class=column-filter-value-operations><div><a href=javascript:void(0) ng-click=changeCheckedOnValues(true) tabindex=-1>Select all</a></div><div style="padding-left: 10px"><a href=javascript:void(0) ng-click=changeCheckedOnValues(false) tabindex=-1>Clear</a></div></div><ionweb-list-selector item-list=listSelectorItems categories=categories display-options=displayOptions item-clicked=itemClicked></ionweb-list-selector></div></div><div class="display-flex gridpanel-action-buttons-container" ng-if="!closeOnDateSelection || mode === 1"><div><ionweb-button class=gridpanel-done-button role=secondary icon=clearFilter icon-placement=after ng-click=clearAndClose()>{{"Btn_Clear"|resource}}</ionweb-button></div><div><ionweb-button class=gridpanel-done-button role=primary ng-disabled=invalid() ng-click=applyAndCloseClicked()>{{"Btn_Done"|resource }}</ionweb-button><ionweb-button class=gridpanel-cancel-button role=secondary ng-click=close()>{{"Btn_Cancel"|resource}}</ionweb-button></div></div></div>'),a.put("grids.ui/templatepod/gridTemplateSelector.tpl.html",'<div class=template-container><ionweb-autocomplete placeholder="Select a template" ng-model=ctrl.templateId label-field=name validation-state=ctrl.validation.state validation-message=ctrl.validation.message allow-free-text=true options=ctrl.filterTemplateMd disable-spell-check=true disable-cache=true option-provider=ctrl.optionProvider validation-state=ctrl.validation.state validation-message=ctrl.validation.message on-text-change=ctrl.onTextChange(value)><div class=option option-template=templateMetaData style="display: flex; justify-content: space-between"><div class=template-option><ionweb-icon icon=user class=owner-icon ng-if=templateMetaData.isOwner title="{{\'Grid_Template_Owner\' | resource}}"></ionweb-icon><span ng-if=!templateMetaData.isOwner class=owner-icon></span> <span>{{templateMetaData.name}}</span></div><div><ionweb-icon icon=public ng-if=templateMetaData.shared title="{{\'Grid_Template_Shared\' | resource}}"></ionweb-icon></div></div></ionweb-autocomplete><div class=buttons-container><ionweb-button icon=save role=secondary ng-click=ctrl.addUpdateTemplate() title="{{\'Grid_Template_Create_Save_Template\' | resource}}" ng-disabled=ctrl.buttonAdapter.disableSave></ionweb-button><ionweb-button icon=undo role=secondary ng-click=ctrl.onTemplateReset() title="{{\'Grid_Template_Restore_Template\' | resource}}" ng-disabled=ctrl.buttonAdapter.disableReset></ionweb-button><ionweb-button icon=delete role=secondary ng-click=ctrl.removeTemplate() ng-disabled=ctrl.buttonAdapter.disableDelete title="{{\'Grid_Template_Delete_Template\' | resource}}"></ionweb-button><ionweb-button icon={{ctrl.buttonAdapter.shareIcon}} role=secondary ng-click=ctrl.toggleShare() ng-disabled=ctrl.buttonAdapter.disableShare title="{{\'Grid_Template_Share_Unshare_Template\' | resource}}"></ionweb-button></div></div>')}]);var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),__assign=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a},ionweb;!function(a){a.Version="1.1.8-p1d8-r15018",a.Copyright="Â© Copyright 2018, ION.",a.GitSha="50b0bb1ece4773cd76bcd2a243f03fa86727291f"}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){a[a.Left=0]="Left",a[a.Right=1]="Right"}(b=a.ToolbarItemPlacement||(a.ToolbarItemPlacement={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b=function(){function b(b){this.placement=b||a.ToolbarItemPlacement.Left}return b.prototype.setTemplate=function(a){this._template=a},b.prototype.setTemplateUrl=function(a){this._templateUrl=a},Object.defineProperty(b.prototype,"template",{get:function(){return this._template},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"templateUrl",{get:function(){return this._templateUrl},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"placement",{get:function(){return this._placement},set:function(b){this._placement=b,this.left=b===a.ToolbarItemPlacement.Left,this.right=b===a.ToolbarItemPlacement.Right},enumerable:!0,configurable:!0}),b}(),c=function(){function c(){this.itemsUpdate=new a.Event,this._items=[]}return Object.defineProperty(c.prototype,"items",{get:function(){return this._items},enumerable:!0,configurable:!0}),c.prototype.addFromTemplate=function(a,c){var d=new b(c);return d.setTemplate(a),this._items.push(d),this.itemsUpdate.raise(this,null),d},c.prototype.addFromTemplateUrl=function(a,c){var d=new b(c);return d.setTemplateUrl(a),this._items.push(d),this.itemsUpdate.raise(this,null),d},c.prototype.removeItem=function(a){var b=this._items.indexOf(a);b!==-1&&(this._items.splice(b,1),this.itemsUpdate.raise(this,null))},c}();angular.module("ionwebShell").service("ionweb.toolbarService",[function(){return new c}])}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(){}return b.create=function(b,c,d,e){var f=this,g=c;return g.displayName=b,Object.defineProperty(g,"isDisabled",{get:function(){return!!d&&d()}}),d&&e&&(g.isDisabledChanged=new a.Event,e.add(function(){g.isDisabledChanged.raise(f,null)})),g},b}(),d=function(){function d(d,e,f,g,h,i,j,k,l){var m=this;this.preferenceServiceInternal=d,this.dialogService=e,this.aboutBoxService=f,this.configService=g,this.serverService=h,this.languageService=i,this.commServiceStateImpl=j,this.preferenceDialogService=k,this.environmentService=l,this.onStoragesDirty=new a.Event,this.generateActions=function(){m.logoutAction=c.create(b.Strings.Text_LogoutAction,function(){a.getService("ionweb.rootComponentService").checkWarnOnExit(b.Strings.Msg_LogoutWithoutSaving_Title).then(function(a){a&&m.processLogout()})}),m.saveAction=c.create(b.Strings.Menu_Save,function(){m.preferenceServiceInternal.save().done()},function(){return m.preferenceServiceInternal.save&&!m.preferenceServiceInternal.dirty||m.configService.config.shell.disableScenarioSave},m.onStoragesDirty),Object.defineProperty(m.saveAction,"isHidden",{get:function(){return m.preferenceServiceInternal.isAutosave}}),m.fullScreenAction=c.create(b.Strings.Menu_Dashboard_Toggle_Fullscreen,function(){m.environmentService.fullscreenModeManager.toggleFullscreenMode()}),Object.defineProperty(m.fullScreenAction,"isHidden",{get:function(){return!m.environmentService.fullscreenModeManager.shouldShowFullscreenModeMenu()}}),Object.defineProperty(m.fullScreenAction,"displayName",{get:function(){return m.environmentService.fullscreenModeManager.isDocumentInFullscreenMode()?b.Strings.Menu_Exit_Fullscreen:b.Strings.Menu_Enter_Fullscreen}}),m.showPreferenceAction=c.create(b.Strings.Menu_Preferences,function(){if(!m.configService.config.shell.hidePreferenceDialog&&!m.preferenceDialogService.isDisabled){var c={canClose:!0,severity:a.DialogSeverity.Info,templateUrl:"shell.ui/preferencesDialog.tpl.html",size:a.DialogSize.Auto,title:b.Strings.Title_Preference_Dialog};m.dialogService.show(c).closed.finally(function(){m.preferenceDialogService.onDialogClosed()})}},function(){return m.preferenceDialogService.isDisabled},m.preferenceDialogService.onPreferenceDialogDisabledChanged),Object.defineProperty(m.showPreferenceAction,"isHidden",{get:function(){return!!m.configService.config.shell.hidePreferenceDialog}}),m.showAboutAction=c.create(b.Strings.Menu_About,function(){m.aboutBoxService.display()})},this.generateActions();var n=function(){m.logoutAction.isHidden=g.config.shell.externalAuthentication};g.changed.add(function(){n()}),n(),i.brandingStringsUpdated.add(function(){m.generateActions()}),i.currentLanguage().then(function(a){a&&m.generateActions()}),this.preferenceServiceInternal.onDirty.add(function(){return m.checkDirty()}),i.languageChanged.add(function(){if(!m.languageRestartDlg){var c={severity:a.DialogSeverity.Warning,canClose:!1,template:'<div>{{"Msg_LanguageChanged" | resource}}</div>',title:b.Strings.Title_LanguageChanged,buttons:[{title:a.toolkit.Strings.Btn_Ok,role:"primary"}]};m.languageRestartDlg=e.show(c),m.languageRestartDlg.closed.finally(function(){m.languageRestartDlg=null})}})}return d.prototype.processLogout=function(){this.serverService.logout("logout action")},d.prototype.checkDirty=function(){this.onStoragesDirty.raise(this,this.preferenceServiceInternal.dirty)},Object.defineProperty(d.prototype,"logout",{get:function(){return this.logoutAction},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"save",{get:function(){return this.saveAction},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"showPreference",{get:function(){return this.showPreferenceAction},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"fullScreen",{get:function(){return this.fullScreenAction},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"showAbout",{get:function(){return this.showAboutAction},enumerable:!0,configurable:!0}),d}();b.ActionService=d,angular.module("ionwebShell").service("ionweb.actionService",["ionweb.preferenceService","ionweb.dialogService","ionweb.aboutBoxService","ionweb.configurationService","ionweb.serverService","ionweb.languageService","ionweb.commService","ionweb.preferenceDialogService","ionweb.environmentService",function(a,b,c,e,f,g,h,i,j){return new d(a,b,c,e,f,g,h,i,j)}])}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){angular.module("ionwebShell").controller("ionweb.preferencesDialogController",["$scope","ionweb.languageService","ionweb.preferenceDialogService",function(b,c,d){b.preferenceTabs=[];var e=d.configManager;e.shouldHideGeneralTab()||b.preferenceTabs.push({title:a.Strings.Title_Preference_General,templateUrl:"shell.ui/preferences/generalPreference.tpl.html"
}),e.shouldHideDateTab()||b.preferenceTabs.push({title:a.Strings.Title_Preference_Date,templateUrl:"shell.ui/preferences/datePreference.tpl.html"}),e.shouldHideTimeTab()||b.preferenceTabs.push({title:a.Strings.Title_Preference_Time,templateUrl:"shell.ui/preferences/timePreference.tpl.html"});var f=Object.keys(c.availableLanguages()).length>1;f&&!e.shouldHideLanguageTab()&&b.preferenceTabs.push({title:a.Strings.Title_Preference_Language,templateUrl:"shell.ui/preferences/languagePreference.tpl.html"}),e.shouldHideNumberTab()||b.preferenceTabs.push({title:a.Strings.Title_Preference_Number,templateUrl:"shell.ui/preferences/numberPreference.tpl.html"}),b.preferenceTabs=b.preferenceTabs.concat(d.tabs),b.preferenceChanged=function(){return d.isPreferenceChanged()},b.applyPreferences=function(a){d.notify(),a&&b.closePreferences()},b.closePreferences=function(){b.cancel(),b.$destroy()}}])}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){angular.module("ionwebShell").controller("ReauthenticationController",["$scope","ionweb.reauthenticationService",function(b,c){b.attemptsRemained=c.attemptsCount,b.description=c.description,b.title=c.title,b.canCancel=c.canCancel,b.$watch("isCapsLockOn",function(c,d){c!==d&&(b.capsLockMessage=c?a.auth.Strings.Warn_CapsLockOn:"")}),b.okClicked=function(){b.attemptsRemained--,c.remainingAttemptsCount=b.attemptsRemained;var a=c.verifyPassword(b.password);a?c.userVerificationSuccessful():(b.password="",b.wrongPasswordEntered=!0,0==b.attemptsRemained&&c.userVerificationFailed())},b.cancelClicked=function(){c.userVerificationCancelled()},b.onKeydown=function(c){c.keyCode==a.KeyCodes.ENTER&&b.password&&b.password.length&&b.okClicked()}}])}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){a[a.Succeeded=0]="Succeeded",a[a.Failed=1]="Failed",a[a.Cancelled=2]="Cancelled"}(b=a.ReauthenticationResult||(a.ReauthenticationResult={}));var c=function(){function c(a,b,c){this.serverService=a,this.dialogService=b,this.loggerFactory=c,this._logger=c.create("ReauthenticationService")}return Object.defineProperty(c.prototype,"remainingAttemptsCount",{set:function(a){this._remainingAttemptsCount=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"attemptsCount",{get:function(){return this._attemptsCount},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"description",{get:function(){return this._description},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"title",{get:function(){return this._title},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"canCancel",{get:function(){return this._canCancel},enumerable:!0,configurable:!0}),c.prototype.reauthenticate=function(c,d,e,f){var g=this;if(!d||d<=0)throw new RangeError("Invalid number of the attempts.");if(this._returnDeferred=Q.defer(),this.serverService.isLocalAuthenticationMode()){this._attemptsCount=d,this._description=e,this._title=f,this._canCancel=c,this._logger.low("Reauthentication",{Action:"Show",CanCancel:c,InitialAttemptsCount:d}),this._dialog&&this._dialog.dismiss();var h={templateUrl:"shell.ui/reauthentication/reauthenticationDialog.tpl.html",canClose:c,size:a.DialogSize.Small,title:f?f:a.shell.Strings.Reauthentication_Dialog_Title};this._dialog=this.dialogService.show(h),this._dialog.closed.then(function(a){a.cancel&&g._returnDeferred.promise.isPending()&&g.userVerificationCancelled()})}else this._returnDeferred.resolve(b.Succeeded);return this._returnDeferred.promise},c.prototype.verifyPassword=function(a){var b=this.serverService.verifyPassword(a);return this._logger.low("Reauthentication",{Action:"PasswordEntered",PasswordIsCorrect:b,CanCancel:this._canCancel,InitialAttemptsCount:this._attemptsCount,RemainingAttemptsCount:this._remainingAttemptsCount}),b},c.prototype.userVerificationCancelled=function(){this._logger.low("Reauthentication",{Action:"CancelClicked",CanCancel:this._canCancel,InitialAttemptsCount:this._attemptsCount,RemainingAttemptsCount:this._remainingAttemptsCount}),this._returnDeferred.reject(b.Cancelled),this._dialog.dismiss()},c.prototype.userVerificationSuccessful=function(){var a=this;this._logger.low("Reauthentication",{Action:"Close",Result:b.Succeeded,CanCancel:this._canCancel,InitialAttemptsCount:this._attemptsCount,RemainingAttemptsCount:this._remainingAttemptsCount}),this._returnDeferred.resolve(b.Succeeded),this._returnDeferred.promise.then(function(){a._dialog.dismiss()})},c.prototype.userVerificationFailed=function(){this._logger.low("Reauthentication",{Action:"Close",Result:b.Failed,CanCancel:this._canCancel,InitialAttemptsCount:this._attemptsCount,RemainingAttemptsCount:this._remainingAttemptsCount}),this._returnDeferred.reject(b.Failed),this._dialog.dismiss()},c}();a.ReauthenticationService=c,angular.module("ionwebShell").service("ionweb.reauthenticationService",["ionweb.serverService","ionweb.dialogService","ionweb.loggerFactory","ionweb.idpService",function(a,b,d){return new c(a,b,d)}])}(ionweb||(ionweb={}));var ionweb;!function(a){var b=function(){function a(a,b){var c=this;this.$window=a,this.ionServer=b,this.globalEvents=["mousedown","mouseup","keydown","keyup","touchstart","touchmove","touchend","touchenter","touchleave","scroll"],this.globalEventHandler=function(a){c._lastUserActivityTimestamp=a.timeStamp,c.ionServer.setUserActive()},this.registerGlobalEventHandler=function(){c.globalEvents.forEach(function(a){c.$window.window.addEventListener(a,c.globalEventHandler,!0)})},this._lastUserActivityTimestamp=Date.now()}return Object.defineProperty(a.prototype,"lastUserActivityTimestamp",{get:function(){return this._lastUserActivityTimestamp},enumerable:!0,configurable:!0}),a}();angular.module("ionwebShell").service("ionweb.userActivityService",["$window","ionweb.serverService",function(a,c){return new b(a,c)}])}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.DateFormat=0]="DateFormat",a[a.TimeFormat=1]="TimeFormat"}(c=b.DateTimeFormatCategory||(b.DateTimeFormatCategory={})),angular.module("ionwebShell").directive("dateTimePreference",["ionweb.dateFormattingService",function(c){var d=function(d,e,f){function g(){if(!d.dateTimePreference.rangeSeparator)return!0;if(d.datetimeValidationMsgs.rangeSeparator={state:a.validation.ValidationState.Valid,message:""},d.datetimeValidationMsgs.shortDateFormat=d.datetimeValidationMsgs.rangeSeparator,":"===d.dateTimePreference.rangeSeparator.separator||d.dateTimePreference.rangeSeparator.separator.indexOf(" ")!=-1||""===d.dateTimePreference.rangeSeparator.separator)return d.datetimeValidationMsgs.rangeSeparator={state:a.validation.ValidationState.Error,message:a.shell.Strings.Err_DateTime_InvalidRangeSeparator},!1;var b=d.formatDate(d.dateTimePreference.shortFormat.formatString);return!(b.indexOf(d.dateTimePreference.rangeSeparator.separator)>=0)||(d.datetimeValidationMsgs.rangeSeparator={state:a.validation.ValidationState.Error,message:a.shell.Strings.Err_DateTime_RangeSeparator},d.datetimeValidationMsgs.shortDateFormat=d.datetimeValidationMsgs.rangeSeparator,!1)}d.dateTimePreference=angular.copy(d.dateTimePreferenceItem);var h,i,j,k=d.dateTimePreference.shortFormat.formatString,l=d.dateTimePreference.longFormat.formatString,m=b.PredefinedRangeSeparator;d.datetimeValidationMsgs={rangeSeparator:{},shortDateFormat:{}};var n=new Date;d.formatDate=function(a){return a?c.toCustom(n,a):""},d.formattedDate=function(d){if(!d)return"";var e=c.toCustom(n,d);return d===b.DateFormattingService.DateTimeLongDateFormat||d===b.DateFormattingService.DateTimeShortDateFormat||d===b.DateFormattingService.DateTimeShortTimeFormat||d===b.DateFormattingService.DateTimeLongTimeFormat?e+" ("+d+" ["+a.shell.Strings.DateTime_Text_Default+"])":e+" ("+d+")"},d.formatDateWithSeparator=function(){if(!d.dateTimePreference.rangeSeparator)return"";var a=d.dateTimePreference.shortFormat.formatString,b=new Date;return b.setDate(b.getDate()+1),c.toCustom(n,a)+" "+d.dateTimePreference.rangeSeparator.separator+" "+c.toCustom(b,a)},void 0!=b.DateTimeFormatSelectionType[d.dateTimePreference.shortFormat.formatType]&&void 0!=d.dateTimePreference.shortFormat.formatType||(d.dateTimePreference.shortFormat.formatType=b.DateTimeFormatSelectionType.Predefined),void 0!=b.DateTimeFormatSelectionType[d.dateTimePreference.longFormat.formatType]&&void 0!=d.dateTimePreference.longFormat.formatType||(d.dateTimePreference.longFormat.formatType=b.DateTimeFormatSelectionType.Predefined),!d.dateTimePreference.rangeSeparator||void 0!=b.DateTimeFormatSelectionType[d.dateTimePreference.rangeSeparator.separatorType]&&void 0!=d.dateTimePreference.rangeSeparator.separatorType||(d.dateTimePreference.rangeSeparator.separatorType=b.DateTimeFormatSelectionType.Predefined),d.$watch("dateTimePreference.longFormat.formatType",function(a,c){if(a!==c){switch(a){case b.DateTimeFormatSelectionType.Predefined:if(l=d.dateTimePreference.longFormat.formatString,i)d.dateTimePreference.longFormat.formatString=i;else if(d.longFormats){var e=d.longFormats.indexOf(d.dateTimePreference.longFormat.formatString);e===-1&&(d.dateTimePreference.longFormat.formatString=d.longFormats[0])}break;case b.DateTimeFormatSelectionType.Custom:i=d.dateTimePreference.longFormat.formatString,l?d.dateTimePreference.longFormat.formatString=l:d.dateTimePreference.longFormat.formatString=""}d.dateTimePreferenceItem=d.dateTimePreference}}),d.$watch("dateTimePreference.shortFormat.formatType",function(a,c){if(a!==c&&g()){switch(a){case b.DateTimeFormatSelectionType.Predefined:if(k=d.dateTimePreference.shortFormat.formatString,h)d.dateTimePreference.shortFormat.formatString=h;else if(d.shortFormats){var e=d.shortFormats.indexOf(d.dateTimePreference.shortFormat.formatString);e===-1&&(d.dateTimePreference.shortFormat.formatString=d.shortFormats[0])}break;case b.DateTimeFormatSelectionType.Custom:h=d.dateTimePreference.shortFormat.formatString,k?d.dateTimePreference.shortFormat.formatString=k:d.dateTimePreference.shortFormat.formatString=""}d.dateTimePreferenceItem=d.dateTimePreference}}),d.$watch("dateTimePreference.rangeSeparator.separatorType",function(a,c){if(a!==c&&g()){switch(a){case b.DateTimeFormatSelectionType.Predefined:j=d.dateTimePreference.rangeSeparator.separator,d.dateTimePreference.rangeSeparator.separator=m;break;case b.DateTimeFormatSelectionType.Custom:d.dateTimePreference.rangeSeparator.separator=j||m}d.dateTimePreferenceItem=d.dateTimePreference}}),d.$watch("dateTimePreference",function(a,b){g()&&(d.dateTimePreferenceItem=d.dateTimePreference)},!0)};return{restrict:"EA",scope:{longFormats:"=",shortFormats:"=",formatCategory:"=",dateTimePreferenceItem:"=ngModel",config:"=?",overrideShortFormat:"=?"},link:d,templateUrl:"shell.ui/preferences/dateTimePreference.tpl.html"}}])}(b=a.localization||(a.localization={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){angular.module("ionwebShell").controller("ionweb.datePreferencesController",["$scope","ionweb.dateFormattingService","ionweb.preferenceDialogService","ionweb.preferenceService","ionweb.environmentService",function(b,c,d,e,f){function g(){return b.datePreference.shortFormat.formatString.indexOf(b.datePreference.rangeSeparator.separator)<0}b.isSmallScreen=f.isSmallScreen(),b.config=d.configManager.config&&d.configManager.config.hideDatePreferences,b.shortDateFormats=[a.DateFormattingService.DateTimeShortDateFormat,"MMMM dd, yyyy","MMM dd, yyyy","MM/dd/yyyy","dd/MM/yyyy"],b.longDateFormats=[a.DateFormattingService.DateTimeLongDateFormat,"MMMM dd, yyyy","MMM dd, yyyy","MM/dd/yyyy","dd/MM/yyyy"],b.datePreference={},b.datePreference.shortFormat=c.fetchShortDateFormat(),b.datePreference.longFormat=c.fetchLongDateFormat(),b.datePreference.rangeSeparator=c.fetchRangeSeparator(),b.preferenceChanged=!1,b.overrideShortFormat=d.overrideShortDateFormatTemplate;var h=d.preferenceApplied.add(function(){b.preferenceChanged&&(g()||(b.datePreference.rangeSeparator={separatorType:a.DateTimeFormatSelectionType.Predefined,separator:a.PredefinedRangeSeparator},b.datePreference.shortFormat={formatType:a.DateTimeFormatSelectionType.Predefined,formatString:a.DateFormattingService.DateTimeShortDateFormat}),c.setRangeSeparator(b.datePreference.rangeSeparator),c.setShortDateFormat(b.datePreference.shortFormat),c.setLongDateFormat(b.datePreference.longFormat),b.preferenceChanged=!1)});b.$watch("datePreference",function(a,c){a!==c&&(b.preferenceChanged=!0,d.setPreferenceChanged())},!0),b.$on("$destroy",function(){h()})}]),angular.module("ionwebShell").controller("ionweb.timePreferencesController",["$scope","ionweb.dateFormattingService","ionweb.preferenceDialogService","ionweb.preferenceService","ionweb.environmentService",function(b,c,d,e,f){b.isSmallScreen=f.isSmallScreen(),b.config=d.configManager.config&&d.configManager.config.hideTimePreferences,b.shortTimeFormats=[a.DateFormattingService.DateTimeShortTimeFormat,"hh:mm tt","HH:mm","H:mm","tt hh:mm","hh:mm:ss tt","HH:mm:ss","H:mm:ss","tt hh:mm:ss","tt h:mm:ss"],b.longTimeFormats=[a.DateFormattingService.DateTimeLongTimeFormat,"hh:mm tt","HH:mm","H:mm","tt hh:mm","hh:mm:ss tt","HH:mm:ss","H:mm:ss","tt hh:mm:ss","tt h:mm:ss"],b.timePreference={},b.timePreference.shortFormat=c.fetchShortTimeFormat(),b.timePreference.longFormat=c.fetchLongTimeFormat(),b.preferenceChanged=!1;var g=d.preferenceApplied.add(function(){b.preferenceChanged&&(c.setShortTimeFormat(b.timePreference.shortFormat),c.setLongTimeFormat(b.timePreference.longFormat),b.preferenceChanged=!1)});b.$watch("timePreference",function(a,c){a!==c&&(b.preferenceChanged=!0,d.setPreferenceChanged())},!0),b.$on("$destroy",function(){g()})}])}(b=a.localization||(a.localization={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){angular.module("ionwebShell").controller("ionweb.generalPreferencesController",["$scope","ionweb.preferenceService","ionweb.dialogService","ionweb.themeManager","ionweb.densityService","ionweb.embeddingService","ionweb.notificationService","ionweb.preferenceDialogService","ionweb.dashboardService","ionweb.environmentService","ionweb.analyticsService","ionweb.configurationService",function(c,d,e,f,g,h,i,j,k,l,m,n){var o=function(a){return a&&a.hideMultipleNotificationsPreferences&&a.hideWidgetMaximizeButtonPreferences},p=function(a){return a&&a.hideResetMultiSortingConfirmationDialogPreferences&&a.hideAutoEditPreferences};c.isSmallScreen=l.isSmallScreen(),c.preferenceChanged=!1,c.config=j.configManager.config.hideGeneralPreferences,c.hideMiscellaneousTitle=o(c.config),c.hideTablesTitle=p(c.config),c.selectedDensity=g.getDensityOptions().filter(function(a){return!!a.isSelected})[0],c.notificationPreference={caption:b.Strings.Msg_Preference_NotificationMaxToastsOnScreen,value:i.maxNumberOfToastsOnScreen>1},!k.isEnabled||n.config.shell.dashboardModeConfig&&n.config.shell.dashboardModeConfig.disableWidgetMaximize||(c.showMaximizePreference={caption:b.Strings.Msg_Preference_ShowMaximizeWhenCaptionsAreHidden,value:k.showMaximizeButton}),m.disabled||(c.enableAnalyticsPreference={caption:b.Strings.Msg_Preference_EnableAnalyticsPreferenceCaption,value:m.enablePreferenceAnalyticsStatistics}),c.multiSortPreference={caption:b.Strings.Msg_Preference_MultiSorting,value:!e.getPreferenceValue(a.tables.GRID_QUICK_SORTING_CHANGE_PREFERENCE_KEY)},c.autoEditPreference={caption:b.Strings.Msg_Preference_AutoEdit,value:d.getValue(a.tables.AUTO_EDIT_PREFERENCE_KEY,a.tables.AUTO_EDIT_PREFERENCE_DEFAULT_VALUE)};var q=h.isAvailable&&!h.ionMobileBridge?[]:f.getSelectableThemes();c.themePreference={options:q,value:f.currentTheme,caption:b.Strings.Title_Preference_CurrentTheme},c.densitySelectorConfig={applyOnSelectionChange:!1},c.changeHandler=function(){c.preferenceChanged=!0,j.setPreferenceChanged()},c.$watch("selectedDensity",function(a,b){a&&b&&a.name!==b.name&&c.changeHandler()}),c.preferenceChangeHandler=function(){c.$evalAsync(function(){if(c.preferenceChanged){i.maxNumberOfToastsOnScreen=c.notificationPreference.value?5:1;var b=a.firstOrDefault(f.getThemes(),function(a){return a.name===c.themePreference.value.name});b&&(f.currentTheme=b),d.setValue(a.tables.AUTO_EDIT_PREFERENCE_KEY,c.autoEditPreference.value),e.setPreferenceValue(a.tables.GRID_QUICK_SORTING_CHANGE_PREFERENCE_KEY,!c.multiSortPreference.value),c.showMaximizePreference&&(k.showMaximizeButton=c.showMaximizePreference.value),c.enableAnalyticsPreference&&(m.enablePreferenceAnalyticsStatistics=c.enableAnalyticsPreference.value),g.setUserSelectedDensity(c.selectedDensity.name),c.preferenceChanged=!1}})},j.preferenceApplied&&j.preferenceApplied.add(c.preferenceChangeHandler),c.$on("$destroy",function(){j.preferenceApplied&&c.preferenceChangeHandler&&j.preferenceApplied.remove(c.preferenceChangeHandler)})}])}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){angular.module("ionwebShell").controller("ionweb.languagePreferencesController",["$scope","ionweb.languageService","ionweb.preferenceDialogService","ionweb.environmentService",function(b,c,d,e){var f=null;b.isSmallScreen=e.isSmallScreen(),b.config=d.configManager.config.hideLanguagePreferences,b.languageChanged=!1,b.languageValidationMessage=null,b.languages=c.availableLanguages(),b.showLanguageTab=Object.keys(b.languages).length>1,b.languagePreference={languageName:null},c.currentLanguage().then(function(d){f=c.userPreferenceLanguage(),b.$evalAsync(function(){b.languagePreference.languageName=f&&f.key||d&&d.key,b.languageValidationMessage=f&&d&&f.key!==d.key?a.Strings.Msg_PreferenceLanguageChanged:null})}),b.preferenceChangeHandler=function(){if(b.languageChanged){var a=b.languages[b.languagePreference.languageName];c.setLanguage(a),c.saveLocalPreferences(),b.$evalAsync(function(){b.languageChanged=!1})}},d.preferenceApplied&&d.preferenceApplied.add(b.preferenceChangeHandler),b.$watch("languagePreference",function(e,f){e&&f&&e.languageName&&f.languageName&&(b.languageChanged=e.languageName!==f.languageName,b.languageChanged&&d.setPreferenceChanged(),b.languageValidationMessage=c.language.key!==e.languageName?a.Strings.Msg_PreferenceLanguageChanged:null)},!0),b.$on("$destroy",function(){d.preferenceApplied&&b.preferenceChangeHandler&&d.preferenceApplied.remove(b.preferenceChangeHandler)})}])}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b=function(){function a(a,b,c,d){this.numberFormattingService=d,a.isSmallScreen=c.isSmallScreen(),a.config=b.configManager.config&&b.configManager.config.hideNumberPreferences,a.preferenceChanged=!1;var e=b.preferenceApplied.add(function(){if(a.preferenceChanged){0!=a.numberPreference.isSystemDecimalSeparator||a.numberPreference.customCultureInfo.decimalSeparator||(a.numberPreference.isSystemDecimalSeparator=!0);var b=a.numberPreference.isSystemDecimalSeparator&&a.numberPreference.decimalSeparator||a.numberPreference.customCultureInfo.decimalSeparator,c=a.numberPreference.isSystemThousandSeparator&&a.numberPreference.thousandSeparator||a.numberPreference.customCultureInfo.thousandSeparator;b===c&&(a.numberPreference.isSystemDecimalSeparator=!0,a.numberPreference.isSystemThousandSeparator=!0),d.setNumericFormats(a.numberPreference),a.preferenceChanged=!1}});a.$watchGroup(["numberPreference.decimalPlaces","numberPreference.negativeBraces","numberPreference.customCultureInfo.thousandSeparator","numberPreference.customCultureInfo.decimalSeparator","numberPreference.isSystemDecimalSeparator","numberPreference.isSystemThousandSeparator"],function(c,d){c!==d&&(a.preferenceChanged=!0,b.setPreferenceChanged())}),a.$on("$destroy",function(){e()})}return a}();angular.module("ionwebShell").controller("ionweb.numberPreferencesController",["$scope","ionweb.preferenceDialogService","ionweb.environmentService","ionweb.numberFormattingService",function(a,c,d,e){return new b(a,c,d,e)}])}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(c){var d=this;this.$scope=c,this.numberFormattingService=a.getService("ionweb.numberFormattingService"),this.configService=a.module("ionwebCore").getService("ionweb.configurationService");var e=2,f=this.configService.config.shell;c.visibleConfig={showDecimalPlaces:!f.numberFormatting||void 0===f.numberFormatting.showDecimalPlacesConfig||f.numberFormatting.showDecimalPlacesConfig,showNegativeBraces:!f.numberFormatting||void 0===f.numberFormatting.showNegativeBracesConfig||f.numberFormatting.showNegativeBracesConfig,showDecimalSymbol:!f.numberFormatting||void 0===f.numberFormatting.showDecimalSymbolConfig||f.numberFormatting.showDecimalSymbolConfig,showDigitGroupingSymbol:!f.numberFormatting||void 0===f.numberFormatting.showDigitGroupingSymbolConfig||f.numberFormatting.showDigitGroupingSymbolConfig},c.numericValidationMsgs={digit:{},decimal:{}},c.numberPreference=this.numberFormattingService.getNumericFormats(),c.defaultNumber=this.getFormattedNumber(e),c.defaultDecimalNumber=this.getFormattedNumber(),c.$watchGroup(["numberPreference.decimalPlaces","numberPreference.negativeBraces","numberPreference.customCultureInfo.thousandSeparator","numberPreference.customCultureInfo.decimalSeparator","numberPreference.isSystemDecimalSeparator","numberPreference.isSystemThousandSeparator"],function(f,g){if(!a.equals(f,g)){d.setValid();var h=c.numberPreference,i=!1;if(h.isSystemDecimalSeparator||h.customCultureInfo.decimalSeparator){if(!h.isSystemDecimalSeparator){var j=c.numberPreference.isSystemDecimalSeparator&&c.numberPreference.decimalSeparator||c.numberPreference.customCultureInfo.decimalSeparator,k=c.numberPreference.isSystemThousandSeparator&&c.numberPreference.thousandSeparator||c.numberPreference.customCultureInfo.thousandSeparator;j==k&&(c.numericValidationMsgs.decimal.state=a.validation.ValidationState.Error,c.numericValidationMsgs.decimal.message=a.core.Strings.Err_Decimal_Thousand_Symbol_Same,i=!0)}}else c.numericValidationMsgs.decimal.state=a.validation.ValidationState.Error,c.numericValidationMsgs.decimal.message=b.Strings.Err_Decimal_Symbol_Required,i=!0;if(!h.isSystemThousandSeparator){var j=c.numberPreference.isSystemDecimalSeparator&&c.numberPreference.decimalSeparator||c.numberPreference.customCultureInfo.decimalSeparator,k=c.numberPreference.isSystemThousandSeparator&&c.numberPreference.thousandSeparator||c.numberPreference.customCultureInfo.thousandSeparator;j==k&&(c.numericValidationMsgs.digit.state=a.validation.ValidationState.Error,c.numericValidationMsgs.digit.message=a.core.Strings.Err_Decimal_Thousand_Symbol_Same,i=!0)}i||(c.defaultNumber=d.getFormattedNumber(e),c.defaultDecimalNumber=d.getFormattedNumber(),c.$ctrl.numberPreference=h)}})}return c.prototype.getFormattedNumber=function(a){var b=1234567.987654321,c=this.$scope.numberPreference;return this.numberFormattingService.getFormattedNumber(b,{decimalPlaces:void 0!=a?a:c.decimalPlaces,negativeBraces:c.negativeBraces,thousandSeparator:c.thousandSeparator,decimalSeparator:c.decimalSeparator})},c.prototype.setValid=function(){this.$scope.numericValidationMsgs.digit.state=a.validation.ValidationState.Valid,this.$scope.numericValidationMsgs.decimal.state=a.validation.ValidationState.Valid},c}();angular.module("ionwebShell").controller("ionweb.numberPreferencesCompController",["$scope",function(a){return new c(a)}]),angular.module("ionwebShell").component("numberPreferences",{bindings:{config:"@?",numberPreference:"=?ngModel"},controller:"ionweb.numberPreferencesCompController",templateUrl:"shell.ui/numberpreference/numberPreference.tpl.html"})}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){angular.module("ionwebShell").directive("densityDialog",["ionweb.popupService","ionweb.densityService",function(b,c){var d=function(d,e){var f=void 0,g=function(){d.densityOptions=c.getDensityOptions(),d.density?d.internalDensity=d.density:d.internalDensity=d.densityOptions.filter(function(a){return!!a.isSelected})[0]},h=function(){d.isOpen=!1},i=function(){d.isOpen&&d.$evalAsync(function(){d.isOpen=!1})},j=function(){b.createPopup("shell.ui/densityDialog.tpl.html",e,d,{showAnchorPointArrow:d.config.showAnchorPointArrow,anchorPoint:a.toolkit.PopupAnchorPoint.BottomRight}).then(function(a){f=a,f.onClose.add(i),k(d.isOpen)})},k=function(a){a&&f?(g(),f.show()):f&&f.hide()};g(),d.onDensityOptionSelected=function(a){d.internalDensity=a,d.density&&(d.density=a),d.config.applyOnSelectionChange!==!1&&c.setUserSelectedDensity(a.name),h()},d.$watch("isOpen",function(a,b){a!==b&&(a&&!f?j():k(a))}),d.$on("$destroy",function(){f&&(f.onClose.remove(i),f.destroy(),f=null),d.isOpen===!0&&(d.isOpen=!1)})};return{restrict:"A",scope:{isOpen:"=",density:"=?ngModel",config:"=?"},link:d}}])}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.SUCCESS=0]="SUCCESS",a[a.FAILURE=1]="FAILURE"}(c||(c={}));var d=function(){function d(a,b,c,d){this.$q=a,this.serverService=b,this.dialogService=d,this._ionlogger=c.create("FileSharingService")}return d.prototype.share=function(a,b){return this.$q.when(this.shareFile(a,b))},d.prototype.shareFile=function(d,e){var f=this;if(!d)throw new Error(b.Strings.Err_PleaseSupply_SharingFile);return this.getToken().then(function(b){return f._ionlogger.low("BeginFileUpload",{token:b,config:e}),f.serverService.put("r/filesharing/share?"+f.getUri(e,b),{category:a.rest.OTHER_CATEGORY}).data(d,e.contentType).send().then(function(a){var b=a.data,d=f.getFileSharingResponse("ShareFileResponse",b);if(c[d.Outcome]==c.SUCCESS)return f._ionlogger.low("EndFileUpload",{Outcome:d.Outcome}),d.fileId;var e=f.getFileSharingError(void 0,d);throw f._ionlogger.low("EndFileUpload",{Outcome:d.Outcome,Error:e.message}),e}).catch(function(a){throw f._ionlogger.low("EndFileUpload",{Error:a.message}),f.getFileSharingError(a)})})},d.prototype.unshare=function(a){return this.$q.when(this.unshareFile(a))},d.prototype.unshareFile=function(d){var e=this;if(!d||0===d.length)throw new Error(b.Strings.Err_PleaseSupply_FileId_Unshare);return this._ionlogger.medium("BeginUnshareFile",{fileId:d}),this.serverService.post("r/filesharing/unshare?fileId="+d,{category:a.rest.SESSION_CATEGORY}).send().then(function(a){var b=a.data,f=e.getFileSharingResponse("UnshareFileResponse",b);if(c[f.Outcome]==c.SUCCESS)return void e._ionlogger.low("EndUnshareFile",{fileId:d,Outcome:f.Outcome});var g=e.getFileSharingError(void 0,f);throw e._ionlogger.low("EndUnshareFile",{fileId:d,Outcome:f.Outcome,Error:g.message}),g}).catch(function(a){throw e._ionlogger.low("EndUnShareFile",{Error:a.message}),e.getFileSharingError(a)})},d.prototype.getDownloadUrl=function(a){return this.$q.when(this.getFileDownloadUrl(a))},d.prototype.getFileDownloadUrl=function(d){var e=this;if(!d||0===d.length)throw new Error(b.Strings.Err_PleaseSupply_FileIdGet_DownloadLink);return this._ionlogger.low("BeginDownloadUrl",{fileId:d}),this.serverService.get("r/filesharing/getDownloadURL?fileId="+d,{category:a.rest.SESSION_CATEGORY}).send().then(function(a){var b=a.data,f=e.getFileSharingResponse("GetFileResponse",b);if(f&&c[f.Outcome]==c.SUCCESS)return e._ionlogger.low("EndDownloadUrl",{fileId:d,Outcome:f.Outcome}),f.downloadLink;var g=e.getFileSharingError(void 0,f);throw e._ionlogger.low("EndDownloadUrl",{fileId:d,Outcome:f.Outcome,Error:g.message}),g}).catch(function(a){throw e._ionlogger.low("EndDownloadUrl",{fileId:d,Error:a.message}),e.getFileSharingError(a)})},d.prototype.download=function(a,b){return void 0===b&&(b=!1),this.$q.when(this.downloadFile(a,b))},d.prototype.downloadFile=function(c,d){var e=this;return void 0===d&&(d=!1),this.getFileDownloadUrl(c).then(function(c){d?e.dialogService.showQuestionDialog(b.Strings.Msg_Download_Content,b.Strings.Title_Download,b.Strings.Btn_Download,a.toolkit.Strings.Btn_Cancel).buttonClick.add(function(a,b){0==b&&window.open(c,"_blank")}):window.open(c,"_blank")}).catch(function(a){throw e._ionlogger.low("EndDownload",{fileId:c,Error:a.message}),a})},d.prototype.getToken=function(){var b=this;return this._ionlogger.low("BeginRequestPutToken"),this.serverService.post("r/filesharing/requestPutToken",{category:a.rest.SESSION_CATEGORY}).send().then(function(a){var d=a.data,e=b.getFileSharingResponse("RequestPutTokenResponse",d);if(c[e.Outcome]==c.SUCCESS)return b._ionlogger.low("EndRequestPutToken",{Outcome:e.Outcome}),e.putToken;var f=b.getFileSharingError(void 0,e);throw b._ionlogger.low("EndRequestPutToken",{Outcome:e.Outcome,Error:f.message}),b.getFileSharingError(void 0,e)},function(a){throw b._ionlogger.low("EndRequestPutToken",{Error:a.message}),b.getFileSharingError(a)})},d.prototype.getUri=function(a,c){var d={};if(d.put_token=c,d.suggested_filename=a.suggestedName,a.components&&a.components.length&&a.users&&a.users.length)throw Error(b.Strings.Err_You_Cant_SpecifyBoth_ComponentsAndUsers);d.component_names=a.components?a.components.join(","):"",d.webuser_names=a.users?a.users.join(","):"",d.expiration_time=0!=a.expireTime?a.expireTime.toString():"-1";var e=[];return Object.keys(d).forEach(function(a){var b=d[a];e.push(a+"="+b)}),e.join("&")},d.prototype.getFileSharingError=function(a,b){var c="Unknown Error";return a&&a.message?c=a.message:b&&b.FailureDetails&&b.FailureDetails.Message?c=b.FailureDetails.Message:b&&b.FailureDetails&&b.FailureDetails.Exception&&b.FailureDetails.Exception.message&&(c=b.FailureDetails.Exception.message),new Error(c)},d.prototype.getFileSharingResponse=function(a,b){var c=b[a];return c||(c=b.FileSharingResponse),c},d}();angular.module("ionwebShell").service("ionweb.fileSharingService",["$q","ionweb.serverService","ionweb.loggerFactory","ionweb.dialogService",function(a,b,c,e){return new d(a,b,c,e)}])}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){angular.module("ionwebShell").controller("ionweb.aboutBoxController",["$scope","ionweb.aboutBoxService","ionweb.environmentService","ionweb.themeManager",function(b,c,d,e){var f=a.SDK_COLOR_PALETTE.map(function(a){return e.rawThemeVariables[a]});b.aboutBoxService=c,b.isSmallScreen=d.isSmallScreen(),b.modules=c.getModules();var g=c.getTrafficData(f);b.networkCategories=g.categories,b.network=g.total}]),angular.module("ionwebShell").directive("ionSvgLogoAbout",[function(){return{templateNamespace:"svg",link:function(b,c){a.logo.createSvgLogo($("svg",c)[0],!0)},template:'<svg xmlns="http://www.w3.org/2000/svg" viewbox="10 20 80 60"></svg>'}}]),angular.module("ionwebShell").filter("ionwebBytes",[function(){return function(b){return a.shell.prettyPrintBytes(Number(b))}}])}(b=a.about||(a.about={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(a,b,c,d){this.configurationService=a,this.dialogService=b,this.serverService=c,this.moduleService=d}return Object.defineProperty(b.prototype,"aboutBoxConfig",{get:function(){return this.configurationService.config.shell.branding&&this.configurationService.config.shell.branding.aboutBox||{}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showLogo",{get:function(){return this.aboutBoxConfig.showLogo!==!1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showModules",{get:function(){return this.aboutBoxConfig.showModules!==!1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showCopyrightNotice",{get:function(){return this.aboutBoxConfig.showCopyrightNotice!==!1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"hidePrivacy",{get:function(){return this.configurationService.config.shell.hidePrivacyLink},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showCurrentUser",{get:function(){return this.aboutBoxConfig.showCurrentUser!==!1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"showVersion",{get:function(){return this.aboutBoxConfig.showVersion!==!1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"logo",{get:function(){return a.buildRelativeClientUri(this.configurationService.config.shell.primaryBrandingLogoUrl);
},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"copyrightNotice",{get:function(){return this.configurationService.config.shell.copyrightNotice||a.Copyright},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"privacyLabel",{get:function(){return this.configurationService.config.shell.privacyLinkLabel||a.coreui.Strings.Text_Privacy},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"copyrightNoticeLink",{get:function(){return this.configurationService.config.shell.copyrightNoticeLink||"https://iongroup.com"},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"privacyLink",{get:function(){return this.configurationService.config.shell.privacyURL||"https://iongroup.com/privacy-statement/"},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"currentUser",{get:function(){return this.serverService.getUserName()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"logId",{get:function(){return this.serverService.getInstanceId()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"version",{get:function(){var b=a.IonVersion.fromModuleVersion(this.configurationService.config.shell.appVersion);return b&&b.toPublicIonString(!0)||this.configurationService.config.shell.appVersion},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"appName",{get:function(){return this.configurationService.config.shell.appName},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isBranded",{get:function(){return this.appName!==a.defaultSdkName},enumerable:!0,configurable:!0}),b.prototype.display=function(){var b=this;this._dialog||(this._dialog=this.dialogService.showCustom({templateUrl:"shell.ui/about/aboutBox.tpl.html",size:a.DialogSize.Auto,canClose:!0}),this._dialog.closed.then(function(){b._dialog=null}))},b.prototype.close=function(){this._dialog&&(this._dialog.dismiss(),this._dialog=null)},Object.defineProperty(b.prototype,"brandingLogo",{get:function(){var a=this.configurationService.config.shell;return!a.primaryBrandingLogoUrl},enumerable:!0,configurable:!0}),b.prototype.getModules=function(){var b=this.moduleService.modules.slice(),c=a.IonVersion.fromModuleVersion(a.Version,a.GitSha,7);return b.push({displayName:a.defaultSdkName,name:"ionweb",version:c?c.toInternalIonString():a.Version}),b.forEach(function(a){var b=a.errors;b&&b.length>0&&(a._errorText=b.join(", "))}),b},b.prototype.getTrafficData=function(b){var c=a.rest.getStats(),d={tx:0,rx:0,total:0,pct:100},e=Object.getOwnPropertyNames(c).reduce(function(b,e){var f=a.shell.Strings["About_Traffic_"+e];if(f){var g={id:e,name:f,rx:c[e].received,tx:c[e].sent,total:c[e].received+c[e].sent};b.push(g),d.rx+=g.rx,d.tx+=g.tx,d.total+=g.total}return b},[]).sort(function(b,c){return b.id===a.rest.OTHER_CATEGORY?1:c.id===a.rest.OTHER_CATEGORY?-1:b.name>c.name?1:b.name<c.name?-1:0});return e.forEach(function(a,c){a.pct=a.total/d.total*100,a.color=b[c]}),{categories:e,total:d}},b}();b.AboutBoxService=c,angular.module("ionwebShell").service("ionweb.aboutBoxService",["ionweb.configurationService","ionweb.dialogService","ionweb.serverService","ionweb.moduleService",function(a,b,d,e){return new c(a,b,d,e)}])}(b=a.about||(a.about={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){a[a.Left=0]="Left",a[a.Right=1]="Right",a[a.Top=2]="Top",a[a.Bottom=3]="Bottom"}(b=a.PanelSide||(a.PanelSide={}));var c;!function(a){a[a.Saving=0]="Saving",a[a.Saved=1]="Saved",a[a.Canceled=2]="Canceled"}(c=a.SaveStatusChangedReason||(a.SaveStatusChangedReason={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.Hovering=0]="Hovering",a[a.Always=1]="Always",a[a.OnContextMenu=2]="OnContextMenu",a[a.Never=3]="Never"}(c=b.EditMode||(b.EditMode={}));var d=function(){function b(a){this.styleObj=a&&a.styleObj||{},this.classes=a&&a.classStr&&a.classStr.split(" ")||[]}return b.merge=function(c,d){var e=new b;return e.classes=c.classes.concat(d.classes),e.styleObj=a.extend({},[c.styleObj,d.styleObj]),e},b.or=function(c,d){var e=new b;return e.classes=(c.classes.length>0&&c.classes||d.classes).slice(),e.styleObj=a.extend({},[Object.getOwnPropertyNames(c.styleObj).length>0&&c.styleObj||d.styleObj]),e},b}();angular.module("ionwebShell").directive("ionCaptionBar",["ionweb.contextMenuService","ionweb.dashboardService","ionweb.themeManager",function(b,e,f){return{restrict:"E",replace:!0,templateUrl:"shell.ui/dashboard/captionBar.tpl.html",scope:{enableStyleEditor:"=?",showTools:"=?",isTabbed:"=?",options:"=",isWidgetCaptionEditor:"=?",spanClass:"=?",underlyingBgColor:"=?",overlay:"=?",showGrip:"=?",hasGrip:"=?",containerClasses:"=?",disableRename:"=?",disableCaptionStyle:"=?"},link:function(e,g){e.initOptions=function(){e.view={style:{},editableValue:e.options.caption,editorEnabled:!1},e.background={},e.grip={},e.options.showEdit=e.options.showEdit||c.Hovering,e.options.onDragStart=function(a){if(e.inEditMode)return!1;var b=e.options.isDraggable&&e.options.dragStart&&e.options.dragStart(a);return!!b&&(a.setData(e.options.dndDataId,b),e.$evalAsync(function(){e.options.isDragging=!0}),!0)},e.options.onDragEnd=function(a){e.$evalAsync(function(){e.options.isDragging=!1,e.options.dragEnd&&e.options.dragEnd()})},e.options.editDesc=e.options.editDesc||a.shell.Strings.Text_EditButton_Desc,e.options.captionStyle||(e.options.captionStyle={fontSize:null,color:null,backgroundColor:null,alignment:null})};var h=function(){e.options.inEdit=e.view.editorEnabled||e.view.isJqueryDragging};e.editModeHovering=function(){return e.options.showEdit==c.Hovering},e.editModeAlways=function(){return e.options.showEdit==c.Always},e.edit=function(){e.disableRename||(e.inEditMode=!0,e.view.editorEnabled||(e.view.editorEnabled=!0,e.view.editableValue=e.options.caption,e.view.selectAll=!0,h()))},e.cancel=function(){e.view.editorEnabled=!1,h(),e.inEditMode=!1},e.save=function(){if(e.view.editorEnabled){var a=e.options.caption;e.options.caption=e.view.editableValue,e.options.renamed&&e.options.renamed(e.view.editableValue,a),e.cancel()}},e.keyDown=function(b){switch(b.keyCode){case a.KeyCodes.ENTER:e.save();break;case a.KeyCodes.ESC:e.cancel()}b.stopPropagation()},e.$watch("options",function(a){a&&e.initOptions()}),e.$watch("options.startInEdit",function(){e.options.startInEdit&&(e.edit(),e.options.startInEdit=!1)}),e.$watch("options.buttons",function(a){Array.isArray(a)&&(e.leftButtons=[],e.rightButtons=[],a.forEach(function(a){a.left?e.leftButtons.push(a):e.rightButtons.push(a)}))}),e.$watch("view.isJqueryDragging",function(a){h()});var i=function(){var b,c,g=new d(f.getThemeClassOrStyle(e.underlyingBgColor,"bg")),h=new d;if(e.isTabbed)c=new d,b=new d;else{var i=e.options.captionStyle;if(c=new d(f.getThemeClassOrStyle(i.color,"fg")),i.fontSize){var j=i.fontSize*a.toolkit.DensityServicePixelToRemFactor+"rem";h.styleObj["font-size"]=j}i.alignment===a.toolkit.BannerTextAlignment.Center&&(h.styleObj["text-align"]="center"),b=new d(f.getThemeClassOrStyle(i.backgroundColor,"bg"))}c=d.merge(c,d.or(b,g)),e.grip.classes=c.classes,e.grip.style=c.styleObj,e.background.classes=!e.overlay&&c.classes,e.background.style=!e.overlay&&c.styleObj;var k=d.merge(c,h);e.view.classes=k.classes.concat([e.spanClass,e.inEditMode&&"caption-edit-mode"]),e.view.style=k.styleObj};e.$watch("options.captionStyle",function(){return i()},!0),e.$watch("underlyingBgColor",function(a,b){a!==b&&i()}),e.$watch("overlay",function(a,b){a!==b&&i()}),e.$watch("spanClass",function(a,b){a!==b&&i()}),e.$watch("inEditMode",function(a,b){a!==b&&i()}),e.$watch("isTabbed",function(a,b){a!==b&&i()});var j;b.attachElement(g,function(){if(e.options.showEdit==c.OnContextMenu&&e.options.contextMenu){var a=e.options.contextMenu();return j=a.destroy,a.items}return j=null,[]},null,{onDestroy:function(){j&&j()}}),e.$on("$destroy",function(){b.detachElement(g)})}}}]),angular.module("ionwebShell").directive("ionCaptionDraggable",[function(){return{restrict:"A",scope:!1,link:function(a,b){a.$watch("isWidgetCaptionEditor",function(c){c&&a.overlay?b.draggable({cursor:"move",linked:c.draggable("instance"),handle:".grid-stack-draggable",start:function(){a.$evalAsync(function(){a.view.isJqueryDragging=!0})},stop:function(){a.$evalAsync(function(){a.view.isJqueryDragging=!1})}}):b.draggable("instance")&&b.draggable("destroy")})}}}]),angular.module("ionwebShell").directive("ionCaptionLeftPart",[function(){return{restrict:"A",scope:!1,link:function(a,b){a.$watch("view.selectAll",function(c,d){c&&!d&&(setTimeout(function(){var a=b.find(".ion-caption-input")[0];a.setSelectionRange(0,a.value.length),a.focus()}),a.view.selectAll=!1)})}}}])}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(a){this.preferenceService=a}return b.prototype.isPasteAvailable=function(a){return this.data&&this.data.compTypeId===a.typeId},b.prototype.decouple=function(b){return b&&JSON.parse(JSON.stringify(b,a.LazySerializable.jsonReplacer))},b.prototype.paste=function(a,b){var c=this.decouple(this.data.state);return a.parent.setChildState(a.id,c),a.setState(c),c&&c.components&&this.setChildren(a,c.components),this.data.captionStyle&&b(this.data.captionStyle),a.dirty=!0,this.data.userData&&a.findUserDataProvider().setState(a,this.data.userData),this.preferenceService.save()},b.prototype.setChildren=function(a,b){var c=this;Object.keys(b||{}).forEach(function(d){var e=a.getChild(d);if(e){var f=b[d];a.setChildState(d,f),e.setState(b[d]),c.setChildren(e,f.components),e.dirty=!0}})},b.prototype.getCopyData=function(b,c){var d={compTypeId:b.typeId,state:this.decouple(b.getState()),userData:this.decouple(b.findUserDataProvider().getState(b)),captionStyle:a.extend({},[c.captionStyle])};return d},b.prototype.copy=function(a,b){this.data=this.getCopyData(a,b)},b}();b.ComponentCopyPasteService=c,angular.module("ionwebShell").service("ionweb.componentCopyPasteService",["ionweb.preferenceService",function(a){return new c(a)}])}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){angular.module("ionwebShell").controller("ionweb.componentHeader",["$scope","ionweb.themeManager","ionweb.configurationService",function(a,b,c){a.$watch("item.options.title.captionStyle.color",function(c){var d=b.getThemeClassOrStyle(c,"fg");a.itemFgStyleClass=d.classStr,a.itemFgStyle=d.styleObj}),a.$watchGroup(["showCaptions","dashboard.inEditLayoutMode","maximizedComponentId","hasTabs","compactHeader","group.items.length","item.options.title.inEdit","item.options.title.buttonsPinned","isHover"],function(b){a.showCaption=a.showCaptions||(a.dashboard.inEditLayoutMode&&!a.maximizedComponentId||a.hasTabs||a.compactHeader)&&(a.isHover||a.group.items.length>1||a.item.options.title.inEdit||a.item.options.title.buttonsPinned)}),c.config.shell.dashboardModeConfig&&(a.disableWidgetCaptionStyle=c.config.shell.dashboardModeConfig.disableWidgetCaptionStyle,a.disableWidgetRename=c.config.shell.dashboardModeConfig.disableWidgetRename)}])}(b=a.gridstack||(a.gridstack={}))}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b,c){var d=this;this.scope=b,this.oldActiveComponent=null,this.tabs=a.tabs(),this.tabs.tabs({beforeActivate:function(){d.oldActiveComponent=d.getCurrentActiveComponent()},activate:function(){b.group.activeItem=d.tabs.tabs("option","active"),d.scope.group.activeChanged(d.oldActiveComponent,d.getCurrentActiveComponent()),d.oldActiveComponent=null},showTab:function(a){return a.removeClass("ui-helper-hidden")},hideTab:function(a){return a.addClass("ui-helper-hidden")}}),b.$watch("group.items",function(a,e){c(function(){d.tabs.tabs("refresh");var a=b.group.activeItem;"number"!=typeof b.group.activeItem&&(a=-1),d.tabs.tabs({active:a})},0)}),b.$watch("group.activeItem",function(a,b){a!==b&&d.tabs.tabs({active:a})}),b.$watchGroup(["group.items.length","maximizedComponentId"],function(){b.hasTabs=b.group.items.length>1&&!b.maximizedComponentId}),b.$watchGroup(["group.items[0].options.component.hideCaption","dashboard.showHeaders"],function(){b.showCaptions=void 0===b.group.items[0].options.component.hideCaption?b.dashboard.showHeaders:!b.group.items[0].options.component.hideCaption}),b.$watchGroup(["dashboard.inEditLayoutMode","group.items.length","showCaptions","maximizedComponentId"],function(){var a=!b.dashboard.inEditLayoutMode&&1===b.group.items.length&&!b.showCaptions&&!b.maximizedComponentId;b.compactHeader=b.group.items[0].options.title.compactHeader=a})}return a.prototype.getCurrentActiveComponent=function(){var a=this.tabs.tabs("option","active");return a!==!1?this.scope.group.items[a]&&this.scope.group.items[a].headerCompId:null},a}();angular.module("ionwebShell").directive("ionwebDashboardTabs",["$timeout",function(a){return{scope:!1,link:function(c,d){return new b(d,c,a)}}}])}(b=a.gridstack||(a.gridstack={}))}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){function d(){return e||(["lib/gridstack/gridstack.min.css","lib/gridstack/gridstack-extra.min.css"].forEach(function(b){var c=document.createElement("link");c.setAttribute("href",a.getResourcePath(b)),c.setAttribute("rel","stylesheet"),document.head.appendChild(c)}),e=a.qRequire("gridstack")),e}var e;c.loadLibrary=d;var f=function(){function c(d,e,f,g,h,i,j,k,l,m){var n=this;this.rootElement=d,this.$compile=f,this.$templateCache=g,this.dashboardService=i,this.responsivenessService=j,this._layoutChanged=new a.Event,this._visibilityChanged=new a.Event,this._verticalMargin=b.DEFAULT_DASHBOARD_LAYOUT_OPTS.verticalMargin,this._horizontalMargin=b.DEFAULT_DASHBOARD_LAYOUT_OPTS.horizontalMargin,this.dashboardScope=e,this._componentToPaneComponent={},this.dashboardScope.tabOptions={},this._componentToGroup={},this._editEnabled=!0,this.dashboardScope.horizontalMargin=this.horizontalMargin+"px",this.dashboardScope.ff=k.has("ff");var o=m.create("GridStack"),p={cellHeight:c.ROW_HEIGHT-this.verticalMargin,verticalMargin:this.verticalMargin,alwaysShowResizeHandle:!0,resizable:{handles:"e, se, s, sw, w",scroll:!0,scrollAxis:"y"},draggable:{handle:".grid-stack-draggable",scroll:!0,scrollAxis:"y"},float:h};(!k.isMobileDevice()&&!k.isTouchDevice()||l.ionNetBridge)&&(o.low("disabledResp",{isMobile:k.isMobileDevice(),isTouch:k.isTouchDevice(),ionNet:!!l.ionNetBridge}),p.minWidth=1),$(".grid-stack",d).gridstack(p);var q=$(".grid-stack",this.rootElement);this.gs=q.data("gridstack"),q.on("change",function(a){a&&a.target&&a.target.classList.contains("grid-stack")&&n._layoutChanged.raise(n,null)}),this.updateCss(),this.editEnabled=!1;var r=this.rootElement.parent(".dashboard-gs-container");this._waitingForSensorContainer=setInterval(function(){r.height()&&(clearTimeout(n._waitingForSensorContainer),n.responsivenessServiceRegistrationResult=n.responsivenessService.register(r[0],a.throttle(function(){return n.fillHeightIfNeeded()}),!1),n.fillHeightIfNeeded())},1e3)}return c.prototype.bringToFront=function(a){var b=this._componentToGroup[a];if(b){var c=this.dashboardScope.tabOptions[b.groupId];c.activeItem=b.position}},c.prototype.findContainingPane=function(a){if(!a||!a.classList||a.classList.contains("ion-close-btn"))return null;var b=$(a).closest("div.component-host[ionweb-component]"),c=this.rootElement.find(b).length>0?b:null;if(!c){var d=this.rootElement.siblings(".gs-maximized");1===d.length&&(c=d.find(b).length>0?b:null)}if(!c){var e=$(a).closest("li[data-compid]");if(e){var f=e.attr("data-compid");c=this.rootElement.find('[ionweb-component="'+f+'"]')}}return c},Object.defineProperty(c.prototype,"layoutChanged",{get:function(){return this._layoutChanged},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"visibilityChanged",{get:function(){return this._visibilityChanged},enumerable:!0,configurable:!0}),c.prototype.getGroupId=function(a){var b=this._componentToGroup[a];return b&&b.groupId},c.prototype.isVisible=function(a){var b=!1,c=this._componentToGroup[a];if(c){var d=this.dashboardScope.tabOptions[c.groupId];b=d.activeItem===c.position}return b},c.prototype.getComponents=function(a){var b=this,c=[];return Object.keys(this._componentToGroup).forEach(function(d){var e=b._componentToGroup[d];e.groupId===a&&c.push({compId:d,position:e.position})}),c.sort(function(a,b){return a.position-b.position}),c.map(function(a){return a.compId})},c.prototype.setVisibleComponent=function(a){var b=this,c=this._componentToGroup[a].groupId;this.getComponents(c).forEach(function(c){var d=b._componentToPaneComponent[c],e="invisible-tabbed-pane-content";c===a?d.paneContent.remove(e):d.paneContent.addClass(e)})},c.prototype.getOrCreatePane=function(a,b,d){var e=this,f=this.dashboardScope.tabOptions[a];if(!f){f={scope:this.dashboardScope.$new(),items:[]},this.dashboardScope.tabOptions[a]=f,f.scope.group=f,f.scope.groupId=a;var g=a+"|"+this.dashboardScope.dashboard.id;f.scope.setIsHover=function(a){f.scope.dashOpts.hoverId=g},f.scope.$watch("dashOpts.hoverId",function(){f.scope.isHover=f.scope.dashOpts.hoverId===g||f.scope.isTouchDevice}),f.element=this.$compile(angular.element(this.$templateCache.get("shell.ui/dashboard/gridstack/componentHeader.tpl.html")))(f.scope),f.activeChanged=function(a,b){e._layoutChanged.raise(e,null),e._visibilityChanged.raise(e,{ids:[b,a]})};var h=b&&b.minWidth&&this.percentageToGsWidth(b.minWidth),i=b&&b.minHeight&&this.pixelToGsHeight(b.minHeight),j=b&&b.maxWidth&&this.percentageToGsWidth(b.maxWidth),k=b&&b.maxHeight&&this.pixelToGsHeight(b.maxHeight),l=d&&d.width&&this.stateWidthToGsWidth(d.width)||b&&b.defaultWidth&&this.percentageToGsWidth(b.defaultWidth)||c.DEFAULT_WIDTH,m=d&&d.height&&this.stateHeightToGsHeight(d.height)||b&&b.defaultHeight&&this.pixelToGsHeight(b.defaultHeight)||c.DEFAULT_HEIGHT,n=this.gs.addWidget(f.element,d&&d.x&&this.stateWidthToGsWidth(d.x),d&&d.y&&this.stateHeightToGsHeight(d.y),l,m,!d||d.autoposition,h,j,i,k);n.removeAttr("style"),this.gs.movable(f.element,this._editEnabled),this.gs.resizable(f.element,this._editEnabled)}return f},c.prototype.dockPaneContent=function(a,b,c,d,e){var f,g=this,h=this._componentToGroup[a];if(h){var i=this.dashboardScope.tabOptions[h.groupId].element,j=i.data("_gridstack_node"),k=this.gsWidthToStateWidth(j.width),l=this.gsHeightToStateHeight(j.height);f={width:k,height:l,autoposition:!0}}this.getComponents(b).forEach(function(a){var b=g._componentToGroup[a];b.position>=c&&b.position++});var m=0;h&&h.groupId!==b&&this.getComponents(h.groupId).forEach(function(a){return g._componentToGroup[a].position=m++}),this._componentToGroup[a]={groupId:b,position:c},m=0,this.getComponents(b).forEach(function(a){return g._componentToGroup[a].position=m++});var n=this.getOrCreatePane(b,null,f),o=this._componentToPaneComponent[a];o.paneContent.attr("id",a);var p=$(".pane-tab-container",n.element);return p.append(o.paneContent),h&&this.updateGroup(h.groupId),this.updateGroup(b),this.setVisibleComponent(a),d&&this.scrollToPane(n.element),e&&(n.activeItem=c),n},c.prototype.scrollToPane=function(a){var b=this;setTimeout(function(){var c=b.rootElement.parent(".dashboard-gs-container");c.length&&c.animate({scrollTop:a[0].getBoundingClientRect().top-c[0].getBoundingClientRect().top},500)},300)},c.prototype.updateGroup=function(a){var b=this,c=this.dashboardScope.tabOptions[a];if(this.getComponents(a).length){var d=this.getComponents(a);c.items=d.map(function(c,d){b._componentToGroup[c].groupId=a,b._componentToGroup[c].position=d;var e=b._componentToPaneComponent[c];return e.paneScope.groupId=a,{headerCompId:c,options:e.paneScope.options}}),this._visibilityChanged.raise(this,{ids:d})}else this.gs.removeWidget(c.element,!0),this.dashboardScope.tabOptions[a].scope.$destroy(),delete this.dashboardScope.tabOptions[a]},c.prototype.detachComponent=function(a){var b=this._componentToGroup[a];b&&(delete this._componentToGroup[a],delete this._componentToPaneComponent[a],this.updateGroup(b.groupId))},c.prototype.createPane=function(b,c,d,e,f,g){var h=f&&f.groupId||a.createNewGuid();this.getOrCreatePane(h,e,f),this._componentToPaneComponent[b]={paneContent:c,paneScope:d};this.dockPaneContent(b,h,f?f.index:0,g,f&&f.isActiveTab);return{id:b,content:c,onDestroy:new a.Event}},c.prototype.isTabbedComponent=function(a){var b=this._componentToGroup[a];return b&&this.getComponents(b.groupId).length>1},c.prototype.undockComponent=function(a){var b=this,c=this._componentToGroup[a];if(c){var d=c.position;this.getComponents(c.groupId).forEach(function(a){var c=b._componentToGroup[a];c.position>d&&c.position--}),this.dockComponent(a,null,null,!0)}},c.prototype.dockComponent=function(b,c,d,e){var f=c?this._componentToGroup[c]:{groupId:a.createNewGuid(),position:0},g=f.position;d&&g++;this.dockPaneContent(b,f.groupId,g,e,!0);$(".grid-stack",this.rootElement).trigger("resize"),this._layoutChanged.raise(this,null)},c.prototype.destroyPane=function(a){a.onDestroy.raise(a,null),this.detachComponent(a.id)},Object.defineProperty(c.prototype,"editEnabled",{get:function(){return this._editEnabled},set:function(a){this._fillHeightHeightMode(!a&&this._fillHeightModeEnabled),this._editEnabled=a,a?this.gs.enable():(this.gs.disable(),this.removeCursoreAttribute())},enumerable:!0,configurable:!0}),c.prototype.destroy=function(){clearTimeout(this._waitingForSensorContainer),this.responsivenessServiceRegistrationResult&&(this.responsivenessServiceRegistrationResult(),this.responsivenessServiceRegistrationResult=null),this.gs.destroy()},c.prototype.removeCursoreAttribute=function(){var a=document.body.style;"function"==typeof a.removeAttribute?a.removeAttribute("cursor"):"function"==typeof a.removeProperty&&a.removeProperty("cursor")},c.prototype.getTabElement=function(a){var b=this.dashboardScope.tabOptions[a];return b&&b.element},c.prototype.getTabElementFromCompId=function(a){var b=this._componentToGroup[a];return b&&this.getTabElement(b.groupId)},c.prototype.getState=function(){var a=this,b={};return $(".grid-stack [data-group-id].grid-stack-item",this.rootElement).map(function(c,d){var e=$(d),f=e.data("_gridstack_node");if(f){var g=e.attr("data-group-id");a.getComponents(g).forEach(function(c,d){var e=a._componentToGroup[c],h=a.dashboardScope.tabOptions[e.groupId];b[c]={autoposition:!1,x:a.gsWidthToStateWidth(f.x),y:a.gsHeightToStateHeight(f.y),width:a.gsWidthToStateWidth(f.width),height:a.gsHeightToStateHeight(f.height),groupId:g,isActiveTab:h.activeItem===e.position,index:d}})}}).get(),{grid:b}},c.prototype.gsHeightToStateHeight=function(a){var b=a*c.ROW_HEIGHT-this.verticalMargin;return Math.round(b/c.STATE_ROW_HEIGHT)},c.prototype.gsWidthToStateWidth=function(a){return a/c.COLUMN_NUMBER*c.STATE_COLUMN_NUMBER},c.prototype.stateHeightToGsHeight=function(a){var b=a*c.STATE_ROW_HEIGHT;return Math.round((b+this.verticalMargin)/c.ROW_HEIGHT)},c.prototype.stateWidthToGsWidth=function(a){return Math.round(a/c.STATE_COLUMN_NUMBER*c.COLUMN_NUMBER)},c.prototype.percentageToGsWidth=function(a){return Math.round(a*c.COLUMN_NUMBER)},c.prototype.pixelToGsHeight=function(a){return Math.round(a/c.ROW_HEIGHT)},c.percentageToStateWidth=function(a){return a*c.STATE_COLUMN_NUMBER},c.pixelToStateHeight=function(a){return a/c.STATE_ROW_HEIGHT},c.stateWidthToPercentage=function(a){return a/c.STATE_COLUMN_NUMBER},c.stateHeightToPixel=function(a){return a*c.STATE_ROW_HEIGHT},c.prototype.setState=function(a){var b=this;a&&a.grid&&Object.getOwnPropertyNames(a.grid).forEach(function(c){var d=a.grid[c],e=b.dashboardScope.tabOptions[d.groupId];if(e){var f=e.element;b.gs.update(f,b.stateWidthToGsWidth(d.x),b.stateHeightToGsHeight(d.y),b.stateWidthToGsWidth(d.width),b.stateHeightToGsHeight(d.height)),b.gs.movable(f,b._editEnabled),b.gs.resizable(f,b._editEnabled),d.isActiveTab&&(e.activeItem=e.items.map(function(a){return a.headerCompId}).indexOf(c))}})},c.prototype.beginUpdate=function(){this.gs.batchUpdate()},c.prototype.endUpdate=function(){this.gs.commit()},c.prototype.setMaximizedPane=function(a){this.dashboardScope.maximizedComponentId=a?a.id:null;var b=$("."+c.MAXIMIZED_CLASS,this.rootElement.parent());if(b&&(this._previousMaximazedContainer&&(this._previousMaximazedContainer.append(b.children()),this._previousMaximazedContainer=null),b.remove()),a){$(".grid-stack",this.rootElement).parent().hide();var d=this.getTabElementFromCompId(a.id);if(d){var e=$("<div></div>");e.addClass(c.MAXIMIZED_CLASS),e.attr("comp-id",a.id),e.appendTo(this.rootElement.parent());var f=d.find(".pane-tab-container");this._previousMaximazedContainer=f.parent(),f.appendTo(e)}}else $(".grid-stack",this.rootElement).parent().show();$(".grid-stack",this.rootElement).trigger("resize")},c.prototype.updateComponentLayout=function(a,b,c){c&&this.undockComponent(a);var d=this.getTabElementFromCompId(a);if(d){var e="number"==typeof b.x?this.stateWidthToGsWidth(b.x):b.x,f="number"==typeof b.y?this.stateHeightToGsHeight(b.y):b.y,g="number"==typeof b.width?this.stateWidthToGsWidth(b.width):b.width,h="number"==typeof b.height?this.stateHeightToGsHeight(b.height):b.height;this.gs.update(d,e,f,g,h)}},c.prototype.getComponentLayout=function(a){function b(a){return a&&Number(a)||0}var c=this.getTabElementFromCompId(a);if(c){var d=this.gsWidthToStateWidth(b(c.attr("data-gs-x"))),e=this.gsHeightToStateHeight(b(c.attr("data-gs-y"))),f=this.gsWidthToStateWidth(b(c.attr("data-gs-width"))),g=this.gsHeightToStateHeight(b(c.attr("data-gs-height")));return{x:d,y:e,width:f,height:g}}},Object.defineProperty(c.prototype,"columnCount",{get:function(){return c.COLUMN_NUMBER},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rowSize",{get:function(){return c.ROW_HEIGHT},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"verticalMargin",{get:function(){return this._verticalMargin},set:function(a){if(a>=c.ROW_HEIGHT||a<0)throw new Error("Invalid value, it shouldn't exceed "+c.ROW_HEIGHT);this._verticalMargin=a,this.gs.verticalMargin(this._verticalMargin,!0),this.gs.cellHeight(c.ROW_HEIGHT-this._verticalMargin),this.fillHeightIfNeeded(),this.updateCss()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"horizontalMargin",{get:function(){return this._horizontalMargin},set:function(a){this._horizontalMargin=a,this.dashboardScope.horizontalMargin=this.horizontalMargin+"px",this.updateCss()},enumerable:!0,configurable:!0}),c.prototype.updateCss=function(){$(".grid-stack-item-content",this.rootElement).css("left",this.horizontalMargin+"px").css("right",this.horizontalMargin+"px");var b=".grid-stack.${instance} > .grid-stack-item > .ui-resizable-handle",c=b+".ui-resizable-e { right: ${hmargin}px } "+b+".ui-resizable-se { right: ${hmargin}px } "+b+".ui-resizable-s { left: ${hmargin}px } "+b+".ui-resizable-sw { left: ${hmargin}px } ";c+=".grid-stack.${instance} .dash-h-margin { margin-left: ${hmargin}px; margin-right: ${hmargin}px; } ",c+=".grid-stack.${instance} .dash-v-margin { margin-top: ${vmargin}px; margin-bottom: ${vmargin}px; } ",c=a.stringFormat(c,{instance:this.gs.opts._class,hmargin:this.horizontalMargin,vmargin:this.verticalMargin}),this.styleEl&&this.styleEl.remove(),this.styleEl=$("<style type='text/css'> "+c+" </style>").appendTo("head")},c.prototype.highlightPane=function(a,b){var c=this.getTabElementFromCompId(a);c&&(b?c.addClass("pane-highlight"):c.removeClass("pane-highlight"))},Object.defineProperty(c.prototype,"fillHeightMode",{get:function(){return this._fillHeightModeEnabled},set:function(a){this._fillHeightModeEnabled=a,this._fillHeightHeightMode(a&&!this._editEnabled)},enumerable:!0,configurable:!0}),c.prototype.fillHeightIfNeeded=function(){if(this._fillHeightModeInternalEnabled){var a=this.rootElement.parent(".dashboard-gs-container"),b=parseInt(this.gs.container.attr("data-gs-current-height"));if(b&&a.height()){var c=(a.height()-this.gs.verticalMargin()*(b-1))/b;this.gs.grid&&this.gs.cellHeight(c)}}},c.prototype._fillHeightHeightMode=function(a){a?(this._fillHeightModeInternalEnabled=!0,this._defaultRowHeight=this.gs.cellHeight(),this.fillHeightIfNeeded()):(this._fillHeightModeInternalEnabled=!1,this._defaultRowHeight&&this.gs.cellHeight(this._defaultRowHeight))},c.ROW_HEIGHT=25,c.COLUMN_NUMBER=24,c.STATE_ROW_HEIGHT=10,c.STATE_COLUMN_NUMBER=12,c.MAXIMIZED_CLASS="gs-maximized",c.DEFAULT_WIDTH=c.COLUMN_NUMBER/2,c.DEFAULT_HEIGHT=10,c}();c.GridStack=f}(c=b.gridstack||(b.gridstack={}))}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(b,c){var d=this;this.$scope=b,b.$watch("opts.fileName",function(e,f){var g=c.validateName(e);g?(d.validationState=a.validation.ValidationState.Error,d.validationMessage=g,b.buttonStates[0].enabled=!1):(d.validationState=a.validation.ValidationState.Valid,d.validationMessage=null,b.buttonStates[0].enabled=!0)})}return b.prototype.accept=function(){this.$scope.buttonStates[0].enabled&&this.$scope.opts.accept()},b}();angular.module("ionwebShell").controller("ionwebSaveAsController",["$scope","ionweb.storageService",c])}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){function c(a){var b=function(a){return Object.getOwnPropertyNames(a).map(function(b){return a[b]}).filter(function(a){return"undefined"!=typeof a&&null!==a}).length>0?a:void 0};return a&&(a.captionStyle=a.captionStyle&&b(a.captionStyle)),a}b.DEFAULT_DASHBOARD_LAYOUT_OPTS={verticalMargin:10,horizontalMargin:5,showBorders:!0},b.COMPACT_DASHBOARD_LAYOUT_OPTS={verticalMargin:0,horizontalMargin:0,showBorders:!1};var d=function(d){function e(c,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=d.call(this)||this;s.dashboardService=c,s.$scope=e,s.$compile=f,s.$templateCache=h,s.catalog=i,s.childWindowService=j,s.contextMenuService=l,s.dialogService=m,s.environment=n,s.componentCopyPasteService=q,s.$timeout=r,s._panes={},s.isVisibleChanged=new a.Event,s.unsub=[],s.onLayoutStateChanged=new a.Event,e.gs=s.gs=new b.gridstack.GridStack(g,e,f,h,e.dashboard.allowFloatingWidgets,c,o,n,p,s.dashboardService.loggerFactory);var t=s.dashboardService.bringingComponentToFront.add(s.handleBringToFront,s),u=e.dashboard.activeComponentChanged.add(s.handleActiveComponentChanged,s);s.unsub.push(s.gs.layoutChanged.add(function(){s.raiseStateChanged(),e.dashboard.layoutChanged.raise(s,null)}));var v=window.setInterval(function(){return s.updateActiveElement(document.activeElement)},500),w=s.handleClick.bind(s);return e.$on("$destroy",function(){s.dashboardService.bringingComponentToFront.remove(s.handleBringToFront,s),u&&(u(),u=null),t&&(t(),t=null),s.unsub.forEach(function(a){return a()}),s.unsub=[],s.gs.destroy(),w&&(window.removeEventListener("click",w,!0),window.removeEventListener("drop",w,!0)),v&&window.clearInterval(v),s.destroyed=!0}),e.$watch("dashboard.inEditMode",function(a){s.setCompEditModes(a)}),e.$watch("dashboard.inEditLayoutMode",function(a){s.gs.editEnabled=a,a&&s.resetMaximizedStates()}),e.$watch("dashboard.fillHeightMode",function(a,b){s.gs.fillHeightMode=a,a!==b&&s.raiseStateChanged()}),e.$watch("dashboard.showHistory",function(a){a&&s.resetMaximizedStates()}),e.$watch("dashboard.showHeaders",function(a,b){a!==b&&(s.raiseStateChanged(),$(".grid-stack").trigger("resize"))}),e.$watch("dashboard.active",function(a,b){a!==b&&(s.isVisibleChanged.raise(s,null),$(window).trigger("resize"))}),window.addEventListener("click",w,!0),window.addEventListener("drop",w,!0),e.dashboard._createComponent=function(a,b,c,d,e,f){return s.createComponent(s.findCompType(a),b,s.toGridxLayout(d),c,null,e,f,a)},e.dashboard.getComponentLayout=function(a){return s.toCompLayout(s.gs.getComponentLayout(a.id))},e.dashboard.setComponentLayout=function(a,b){s.gs.updateComponentLayout(a.id,s.toGridxLayout(b),""===b.tabWith)},e.dashboard.getColumnCount=function(){return s.gs.columnCount},e.dashboard.getRowSize=function(){return s.gs.rowSize},e.dashboard.registerLayoutOptHandlers(function(){
return s.getLayoutOpts()},function(a){return s.setLayoutOpts(a)}),e.dashboard.cloneComponent=function(a,b){return s.cloneComponent(a,!0,s.toGridxLayout(b))},e.showBorders=b.DEFAULT_DASHBOARD_LAYOUT_OPTS.showBorders,e.isTouchDevice=n.isTouchDevice(),e.dashboard.setReady(),s}return __extends(e,d),Object.defineProperty(e.prototype,"panesList",{get:function(){var a=this;return Object.keys(this._panes).map(function(b){return a._panes[b]})},enumerable:!0,configurable:!0}),e.prototype.handleBringToFront=function(a,b){this.gs.bringToFront(b.id)},e.prototype.handleActiveComponentChanged=function(){var a=this.$scope.dashboard.activeComponent;a?a.id!==this._lastActiveComponentId&&(this._lastActiveComponentId=a.id,this._lastActiveElement=null):(this._lastActiveComponentId=null,this._lastActiveElement=null)},e.prototype.handleClick=function(a){var b=this;a&&a.toElement&&window.setTimeout(function(){b.updateActiveElement(a.toElement)})},e.prototype.updateActiveElement=function(a){var b=this;if(a!==this._lastActiveElement){this._lastActiveElement=a;var c=this.gs.findContainingPane(a);if(c){var d=c?c.attr("ionweb-component"):null;if(d!==this._lastActiveComponentId&&this._panes[d]){var e=this._panes[d].paneScope.options.component;e.canBeActive&&(this._lastActiveComponentId=d,a!==document.activeElement&&document.activeElement.blur(),this.$scope.$evalAsync(function(){b.$scope.dashboard.activeComponent=e}))}}}},e.prototype.destroyAllPanes=function(){this.panesList.forEach(function(a){return a.destroy()}),this._panes={}},e.prototype.addPane=function(a){return this._panes[a.paneScope.options.compId]=a,a},e.prototype.setCompEditModes=function(a){var c=this.$scope.component;if(c&&c.parent&&c.parent instanceof b.DashboardRootComponent){c.editMode=a;var d=this.$scope.component.getChildren();d.forEach(function(b){return b.editMode=a})}},e.prototype.resetMaximizedStates=function(){this.panesList.forEach(function(a){a.paneScope&&a.paneScope.options&&(a.paneScope.options.isMaximized=!1)})},e.prototype.addComponentPane=function(c,e,f,g,h,i){var j=this,k=i?"LoadWidget":"AddWidget";this.$scope.dashboard.traceAnalytics(k,"Widget:"+e.displayName);var l,m,n=f.name||e.displayName,o=this.$scope.$new(!1),p={icon:"close",classes:["ion-close-btn"],description:a.shell.Strings.Text_Dashboard_CloseWidget},q={icon:"backArrow",action:function(){o.options.isMaximized=!1},description:a.shell.Strings.Text_Dashboard_RestoreWidget,name:"Restore"},r={icon:"maximize",action:function(){o.options.isMaximized=!0,m.canBeActive&&(j.$scope.dashboard.activeComponent=m)},description:a.shell.Strings.Text_Dashboard_MaximizeWidget},s=function(){var b=j.environment.isOffline;o.options.title.enabled=j.$scope.dashboard.editMode&&!j.$scope.dashboard.isReadOnly&&!b;var c=j.dashboardService.configService.config.shell.dashboardModeConfig||{},e=m&&m.customButtons&&m.customButtons.slice()||[];if(m&&m.helpAction){var f={icon:"help",action:m.helpAction,description:a.shell.Strings.Text_Dashboard_ComponentHelp};e.push(f)}var g=[];if(j.$scope.getExtendedWidgetMenu=function(){return g},m&&j.$scope.dashboard.inEditMode){if(!c.disableWidgetCopyPasteConfig){g.push({text:a.shell.Strings.Text_Dashboard_CopyWidget,icon:"copy",action:function(){m.copy()}});var h={text:a.shell.Strings.Text_Dashboard_PasteWidget,icon:"paste",action:function(){m.paste()}};Object.defineProperty(h,"disabled",{get:function(){return!m.isPasteAvailable()},enumerable:!0,configurable:!0}),g.push(h)}j.$scope.dashboard.inEditLayoutMode&&!c.disableWidgetRename&&g.push({text:a.shell.Strings.Text_Dashboard_Menu_RenameWidget,icon:"rename",action:function(){o.options.title.startInEdit=!0},disabled:b})}if(m&&j.$scope.dashboard.inEditLayoutMode&&!c.disableWidgetClone&&g.push({text:a.shell.Strings.Text_Dashboard_CloneWidget,icon:"copy",action:function(){m.clone()}}),m&&j.$scope.dashboard.inEditMode){var i=function(){return j.toCompLayout(j.gs.getState().grid[m.id])};c.disableWidgetSave||j.dashboardService.inIonNet()||g.push({text:a.shell.Strings.Text_Dashboard_SaveWidget,icon:"cloud-upload",action:function(){var b=function(){var a=d.prototype.getComponent.call(j,m.id);j.dashboardService.saveComponent(j.$scope.dashboard,m,i(),c.opts.fileName,a).done()},c=j.$scope.$new();c.opts={fileName:o.options.title.caption,accept:void 0};var e={templateUrl:"shell.ui/dashboard/saveAs.tpl.html",scope:c,size:a.DialogSize.Small},f=j.dialogService.showQuestionDialog(e,a.shell.Strings.Text_SaveAs_Title,a.shell.Strings.Text_SaveAs_Save);c.opts.accept=function(){b(),f.dismiss()},f.closed.then(function(a){a.cancel||0!==a.value||b(),c.$destroy()})}}),j.dashboardService.canImportExportDashboards&&!c.disableWidgetDownload&&g.push({text:a.shell.Strings.Text_Dashboard_ExportWidget,tooltip:a.shell.Strings.Tooltip_Dashboard_ExportWidget,icon:"import",action:function(){var a=d.prototype.getComponent.call(j,m.id);j.dashboardService.exportComponent(m,i(),o.options.title.caption,a)}})}m&&j.$scope.dashboard.inEditLayoutMode&&!c.disableWidgetCaptionVisibility&&g.push({text:a.shell.Strings.Text_Dashboard_Menu_Caption,menuType:a.MenuItemType.Submenu,subMenu:[{menuType:a.MenuItemType.Checkbox,groupId:"1",action:function(){o.options.component.hideCaption=!1},checked:o.options.component.hideCaption===!1,text:a.shell.Strings.Text_Dashboard_Menu_Caption_Show,tooltip:a.shell.Strings.Tooltip_Dashboard_Menu_Caption_Show},{menuType:a.MenuItemType.Checkbox,groupId:"1",action:function(){o.options.component.hideCaption=!0},checked:o.options.component.hideCaption===!0,text:a.shell.Strings.Text_Dashboard_Menu_Caption_Hide,tooltip:a.shell.Strings.Tooltip_Dashboard_Menu_Caption_Hide},{menuType:a.MenuItemType.Checkbox,groupId:"1",action:function(){o.options.component.hideCaption=void 0},checked:void 0===o.options.component.hideCaption,text:a.shell.Strings.Text_Dashboard_Menu_Caption_Default,tooltip:a.shell.Strings.Tooltip_Dashboard_Menu_Caption_Default}]}),!j.dashboardService.showMaximizeButton||o.options.isMaximized||c.disableWidgetMaximize||e.push(r),g.length>0&&e.push({icon:"optionsVertical",action:function(a){o.options.title.buttonsPinned=!0,j.contextMenuService.openContextMenu(g,a.target,{onDestroy:function(){o.options.title.buttonsPinned=!1}})},description:a.shell.Strings.Text_Dashboard_WidgetOptions}),j.$scope.dashboard.inEditLayoutMode&&e.push(p),o.options.title.buttons=e,o.options.navigationBarOptions.visible=!!o.options.isMaximized},t=[];t.push(this.dashboardService.showMaximizeButtonChanged.add(function(){s()})),o.options={compData:f,compId:c,title:{caption:n,captionStyle:f.captionStyle,buttons:[],isDraggable:o.dashboard.inEditLayoutMode,dndDataId:"componentId",showEdit:b.EditMode.Never,dragStart:function(b){if(j.gs.isTabbedComponent(c)){var d=$.parseHTML('<div><span class="glyphicon glyphicon-new-window"></span> '+a.shell.Strings.Text_Dashboard_DropHereToUndock+"</div>")[0],e=document.createElement("div");e.appendChild(d),e.className="dnd-undock",b.dropToCustomAction={action:function(){j.gs.undockComponent(c)},customIcon:e}}return j.$scope.$evalAsync(function(){j.$scope.isMovingComponent=!0}),c},dragEnd:function(){j.$scope.$evalAsync(function(){j.$scope.isMovingComponent=!1})},drop:function(a,b){j.gs.dockComponent(a,o.options.compId,b)}},navigationBarOptions:{visible:!1,buttons:[q]},templateUrl:e.templateUrl,template:e.template,isMaximized:!1,reloadHelperFlag:!0,isActive:function(){return m.canBeActive&&j.$scope.dashboard.activeComponent===m}},o.$watch("options.isMaximized",function(a,b){a!==b&&(a?j.gs.setMaximizedPane(l):j.gs.setMaximizedPane(null),s())}),o.$watch("options.component.hideCaption",function(a,b){var c=d.prototype.getComponent.call(j,m.id);c.hideCaption=a,j.raiseStateChanged()}),o.$watch("dashboard.inEditLayoutMode",function(a){o.options.title.isDraggable=o.dashboard.inEditLayoutMode,s()});var u=function(){return j.isVisible&&j.gs.isVisible(c)},v=this.$templateCache.get("shell.ui/dashboard/componentPane.tpl.html");this.$compile(angular.element(v))(o,function(a){l=j.gs.createPane(c,a,o,e,g,h);var b=j.gs.visibilityChanged.add(function(a,b){b.ids.indexOf(c)>=0&&o.$evalAsync(function(){m.visible=u()})});l.onDestroy.add(function(){b(),o.$destroy(),j.removeComponent(c)})});var w,x=[],y=function(a){a.typeId=e.id,a.editMode=j.$scope.dashboard.inEditMode,a.close=function(){w&&w.destroy()},a.maximize=function(){o.$evalAsync(function(){o.options.isMaximized=!0})},a.restore=function(){o.$evalAsync(function(){o.options.isMaximized=!1})},a.isMaximized=function(){return o.options.isMaximized},a.clone=function(){return j.cloneComponent(a,!0)},a.copy=function(){return j.componentCopyPasteService.copy(a,j.getComponent(a.id))},a.paste=function(){o.$evalAsync(function(){o.options.reloadHelperFlag=!1}),j.$timeout(function(){o.$evalAsync(function(){j.componentCopyPasteService.paste(a,function(b){var c=j.getComponent(a.id);c.captionStyle=b,j._panes[a.id].paneScope.options.title.captionStyle=b,j.raiseStateChanged()}),o.options.reloadHelperFlag=!0,j.raiseStateChanged()})},0)},a.isPasteAvailable=function(){return j.componentCopyPasteService.isPasteAvailable(a)},a.visible=u(),x.push(j.isVisibleChanged.add(function(){a.visible=u()})),o.$watch("options.title.caption",function(){a.title=o.options.title.caption||e.displayName,j.renameComponent(c,e,a.title)}),o.$watch("options.title.captionStyle",function(){j.restyleComponentCaption(c,o.options.title.captionStyle)},!0),o.$watch("options.component.title",function(a,b){a!==b&&(o.options.title.caption=a)}),o.$watch("options.component.customButtons",function(){s()}),o.$watch("options.component.helpAction",function(){s()}),o.$watch("options.component.editMode",function(){return s()})};return m=o.component.getChild(c),m.title=n,o.options.component=m,o.options.component.hideCaption=f.hideCaption,y(m),m.childAdded.add(function(a,b){y(b)}),w={pane:l,paneScope:o,destroy:null},w.destroy=function(){j.$scope.dashboard.traceAnalytics("RemoveWidget","Widget:"+e.displayName),t.forEach(function(a){return a()}),t=[],x.forEach(function(a){return a()}),delete j._panes[w.paneScope.options.compId],w.pane&&j.gs.destroyPane(w.pane),w.pane=null},p.action=function(){j.gs.setMaximizedPane(null),o.options.isMaximized=!1,j.$scope.dashboard.takeUndoSnapshot(a.stringFormat(a.shell.Strings.Text_Dashboard_DeletedCompUndo,{name:m.title}),w.paneScope.options.compId),w.destroy()},t.push(this.environment.isOfflineChanged.add(function(a,b){j.$scope.$evalAsync(function(){s()})})),this.addPane(w),m},e.prototype.createComponent=function(b,c,e,f,g,h,i,j){var k="pane-"+a.createNewGuid(),l=b.id!==j,m=d.prototype.addComponent.call(this,k,{compType:j||b.id,name:f===b.displayName?void 0:f,compName:l?void 0:b.displayName,moduleName:l?void 0:b.moduleName,captionStyle:h,hideCaption:i});if(g){var n=this.$scope.component;n.setChildState(k,g.state)}var o=this.addComponentPane(k,b,m,e,c,!1);return g&&g.user&&o.findUserDataProvider().setState(o,g.user),this.raiseStateChanged(),o},e.prototype.clear=function(){var a=this;this.destroyed||d.prototype.clear.call(this,function(){return a.gs.beginUpdate()},function(){return a.destroyAllPanes()},function(){return a.gs.endUpdate()})},Object.defineProperty(e.prototype,"state",{get:function(){var c=d.prototype.getState.call(this);c.gsLayout=this.gs.getState(),c.showHeaders=this.$scope.dashboard.showHeaders,c.fillHeightMode=this.$scope.dashboard.fillHeightMode,"string"==typeof this.$scope.dashboard.customController&&(c.customController=this.$scope.dashboard.customController);var e=this.getLayoutOpts();return a.equals(b.DEFAULT_DASHBOARD_LAYOUT_OPTS,e)||(c._layoutOpts=e),c},set:function(a){var b=this;a&&!this.destroyed&&(this.clear(),d.prototype.setState.call(this,a,function(){b.gs.beginUpdate(),a._layoutOpts&&b.setLayoutOpts(a._layoutOpts)},function(c,d){var e=b.findCompType(d.compType);b.addComponentPane(c,e,d,a.gsLayout.grid[c],null,!0)},function(){b.gs.setState(a.gsLayout),b.gs.endUpdate()}),this.$scope.dashboard.showHeaders=a.showHeaders,this.$scope.dashboard.fillHeightMode=a.fillHeightMode,this.$scope.dashboard.customController=a.customController)},enumerable:!0,configurable:!0}),e.prototype.findCompType=function(a){return this.catalog.findComponentType(a)||this.catalog.findComponentType(b.DashboardService.PLACEHOLDER_COMP_ID)},e.prototype.raiseStateChanged=function(){this.inSetState||this.onLayoutStateChanged.raise(this,null)},e.prototype.removeComponent=function(a){d.prototype.removeComponent.call(this,a),a===this._lastActiveComponentId&&(this.$scope.dashboard.activeComponent=null,this._lastActiveComponentId=null),this.raiseStateChanged()},e.prototype.renameComponent=function(a,b,c){var e=d.prototype.getComponent.call(this,a);if(e&&(c===b.displayName&&(c=void 0),e.name!==c)){var f="Widget:"+b.displayName+":"+c;this.$scope.dashboard.traceAnalytics("RenameWidget",f),e.name=c,this.raiseStateChanged()}},e.prototype.restyleComponentCaption=function(a,b){var c=d.prototype.getComponent.call(this,a);c&&(c.captionStyle=b,this.raiseStateChanged())},Object.defineProperty(e.prototype,"isVisible",{get:function(){return this.$scope.dashboard.active},enumerable:!0,configurable:!0}),e.prototype.toCompLayout=function(a){return a&&{left:b.gridstack.GridStack.stateWidthToPercentage(a.x),top:b.gridstack.GridStack.stateHeightToPixel(a.y),width:b.gridstack.GridStack.stateWidthToPercentage(a.width),height:b.gridstack.GridStack.stateHeightToPixel(a.height)}},e.prototype.toGridxLayout=function(a){function c(a){return"number"==typeof a?b.gridstack.GridStack.percentageToStateWidth(a):a}function d(a){return"number"==typeof a?b.gridstack.GridStack.pixelToStateHeight(a):a}if(!a)return null;if(a.tabWith){var e=this.gs.getGroupId(a.tabWith);if(e)return{groupId:e,autoposition:!1}}var f={autoposition:void 0,x:c(a.left),y:d(a.top),width:c(a.width),height:d(a.height)};return f.autoposition="undefined"==typeof f.x||"undefined"==typeof f.y,f},e.prototype.getLayoutOpts=function(){var b=this,c={},d={},e=function(e,f){Object.defineProperty(c,e,{get:function(){return f()},set:function(a){var c={};c[e]=a,b.setLayoutOpts(c)}}),d[e]=new a.LazySerializable(f)};return e("verticalMargin",function(){return b.gs.verticalMargin}),e("horizontalMargin",function(){return b.gs.horizontalMargin}),e("showBorders",function(){return b.$scope.showBorders}),c.toJSON=function(){return d},c},e.prototype.setLayoutOpts=function(a){"undefined"!=typeof a.verticalMargin&&(this.gs.verticalMargin=a.verticalMargin),"undefined"!=typeof a.horizontalMargin&&(this.gs.horizontalMargin=a.horizontalMargin),"undefined"!=typeof a.showBorders&&(this.$scope.showBorders=a.showBorders),this.raiseStateChanged()},e.prototype.cloneComponent=function(b,c,e){var f=this.componentCopyPasteService.getCopyData(b,d.prototype.getComponent.call(this,b.id)),g=this.catalog.findComponentType(b.typeId),h=a.getUniqueName(b.title,d.prototype.getComponentData.call(this).map(function(a){return a&&a.name||a.compName}));if(e||(e={autoposition:!0}),!e.width||!e.height){var i=this.gs.getComponentLayout(b.id);e.width=e.width||i.width,e.height=e.height||i.height}return this.createComponent(g,c,e,h,{state:f.state,user:f.userData},f.captionStyle,b.hideCaption)},e.prototype.setComponentHighlight=function(a){var b=this;a&&Array.isArray(a)&&0!=a.length&&a.forEach(function(a){b.gs.highlightPane(a,!0)})},e.prototype.cleanCompData=function(a){return c(a)},e}(b.DashboardComponent);b.DashboardDirective=d,b.cleanCompData=c,angular.module("ionwebShell").directive("ionwebGridstack",["ionweb.dashboardService","$compile","$templateCache","ionweb.catalogService","ionweb.childWindowService","ionweb.environmentService","ionweb.contextMenuService","ionweb.dialogService","ionweb.environmentService","ionweb.responsivenessService","ionweb.embeddingService","ionweb.componentCopyPasteService","$timeout",function(a,c,e,f,g,h,i,j,k,l,m,n,o){function p(b,p){var q=new d(a,b,c,p,e,f,g,h,i,j,k,l,m,n,o);b.onDashboardBound&&b.onDashboardBound(q)}return{restrict:"E",scope:!1,templateUrl:"shell.ui/dashboard/dashboardDirective.tpl.html",link:function(a,c){b.gridstack.loadLibrary().then(function(){p(a,c)}).done()}}}])}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.Ok=0]="Ok",a[a.ServerDisconnected=1]="ServerDisconnected",a[a.Autoretry=2]="Autoretry",a[a.NeedRelogin=3]="NeedRelogin"}(c||(c={}));var d=function(){function d(a,b,d,e,f,g,h,i){var j=this;this.$rootScope=a,this.server=b,this.dialogService=d,this.idpService=e,this.envService=f,this.modalService=h,this.configService=i,this.options={visible:!1},this.serverStatus=c.Ok,this.loaded=!1,this.visible=!1,this.OTPERROR="IonDaemonWrongOtp",g.waitForStartupConfiguration.then(function(){j.loaded=!0,j.update(7e3)})}return d.prototype.start=function(){var a=this;this.server.statusChanged.add(function(b,c){a.server.loggedOut||a.onServerStatusChanged(c)}),this.server.connectionRetryInProgress.add(function(b,c){a.$rootScope.$evalAsync(function(){a.updateOfflineRetrySection(c.remMs,c.tryNow)})}),this.server.loggingOut.add(function(){a.showLogout()}),this.envService.isOfflineChanged.add(function(){a.update()}),this.update()},d.prototype.onServerStatusChanged=function(a){if(this.options.otpRequired=!1,!this.server.isInErrorRetry()||a&&a.isAuthenticated)this.serverStatus=c.Ok;else if(a){if(this.serverStatus=this.server.canAutoretry?c.Autoretry:c.NeedRelogin,a.error&&a.error===this.OTPERROR)return this.options.message=b.Strings.Err_Session_Requires_OTP_Message,void(this.options.otpRequired=!0)}else this.serverStatus=c.ServerDisconnected;this.update()},d.prototype.update=function(a){var d=this,e=(this.serverStatus!==c.Ok||this.envService.isOffline)&&!this.server.loggedOut;e?this.$rootScope.$evalAsync(function(){switch(d.options.title=b.Strings.Err_AuthBanner_Disconnected_Title,d.serverStatus){case c.Ok:case c.ServerDisconnected:d.updateOfflineRetrySection(0),d.options.idpOpts=null;break;case c.Autoretry:d.options.title=b.Strings.Err_AuthBanner_Reauth_Title,d.options.message=b.Strings.Err_AuthBanner_Reauth_Message;break;case c.NeedRelogin:d.options.title=b.Strings.Err_AuthBanner_Reauth_Title,d.options.message=b.Strings.Err_AuthBanner_Reauth_Message_IDP,d.options.tryNowButtonText=null,d.options.idpOpts={onLoginSuccess:function(){d.server.getStatus().then(function(){d.serverStatus=c.Ok,d.update()},function(){return null})},isReconnecting:!0}}!d.reconnectingBanner&&d.configService.config.shell.offlineBlockingUi&&(d.reconnectingBanner=d.modalService.open({templateUrl:"shell.ui/reconnectingBanner.tpl.html",size:"lg",backdrop:"static",keyboard:!1}))}):this.reconnectingBanner&&(this.reconnectingBanner.close(),this.reconnectingBanner=null),this.loaded&&e!==this.visible&&(this.visible=e,this.timeoutHndl&&clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout(function(){return d.$rootScope.$evalAsync(function(){d.options.visible=e})},a))},d.prototype.updateOfflineRetrySection=function(c,d){this.options.idpOpts||(this.options.tryNowButtonText=b.Strings.Err_AuthBanner_Disconnected_TryNow_Text,this.options.tryNow=d,c>0?(this.options.message=a.stringFormat(b.Strings.Err_AuthBanner_Disconnected_Message_Timeout,{retryInterval:c/1e3}),this.options.tryNowButtonDisabled=!1):(this.options.message=b.Strings.Err_AuthBanner_Disconnected_Message,this.options.tryNowButtonDisabled=!0))},d.prototype.showLogout=function(){var b=this;this.$rootScope.$evalAsync(function(){b.dialogService.showCustom({templateUrl:"shell.ui/logoutDlgContent.tpl.html",size:a.DialogSize.Large})})},d}();b.ConnectionManager=d,angular.module("ionwebShell").service("ionweb.connectionManager",["$rootScope","ionweb.serverService","ionweb.dialogService","ionweb.idpService","ionweb.environmentService","ionweb.applicationStatusService","$uibModal","ionweb.configurationService",d])}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var html2canvas;!function(a){function b(a,b,c){var d,e=a.runtimeStyle&&a.runtimeStyle[b],f=a.style;return!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(c)&&/^-?\d/.test(c)&&(d=f.left,e&&(a.runtimeStyle.left=a.currentStyle.left),f.left="fontSize"===b?"1em":c||0,c=f.pixelLeft+"px",f.left=d,e&&(a.runtimeStyle.left=e)),/^(thin|medium|thick)$/i.test(c)?c:Math.round(parseFloat(c))+"px"}function c(a){return parseInt(a,10)}function d(a,c,d,e){if(a=(a||"").split(","),a=a[e||0]||a[0]||"auto",a=k.Util.trimText(a).split(" "),"backgroundSize"!==d||a[0]&&!a[0].match(/cover|contain|auto/)){if(a[0]=a[0].indexOf("%")===-1?b(c,d+"X",a[0]):a[0],void 0===a[1]){if("backgroundSize"===d)return a[1]="auto",a;a[1]=a[0]}a[1]=a[1].indexOf("%")===-1?b(c,d+"Y",a[1]):a[1]}else;return a}function e(a,b,c,d,e,f){var g,h,i,j,l=k.Util.getCSS(b,a,e);if(1===l.length&&(j=l[0],l=[],l[0]=j,l[1]=j),l[0].toString().indexOf("%")!==-1)i=parseFloat(l[0])/100,h=c.width*i,"backgroundSize"!==a&&(h-=(f||d).width*i);else if("backgroundSize"===a)if("auto"===l[0])h=d.width;else if(/contain|cover/.test(l[0])){var m=k.Util.resizeBounds(d.width,d.height,c.width,c.height,l[0]);h=m.width,g=m.height}else h=parseInt(l[0],10);else h=parseInt(l[0],10);return"auto"===l[1]?g=h/d.width*d.height:l[1].toString().indexOf("%")!==-1?(i=parseFloat(l[1])/100,g=c.height*i,"backgroundSize"!==a&&(g-=(f||d).height*i)):g=parseInt(l[1],10),[h,g]}function f(a,b){var c=[];return{storage:c,width:a,height:b,clip:function(){c.push({type:"function",name:"clip",arguments:arguments})},translate:function(){c.push({type:"function",name:"translate",arguments:arguments})},fill:function(){c.push({type:"function",name:"fill",arguments:arguments})},save:function(){c.push({type:"function",name:"save",arguments:arguments})},restore:function(){c.push({type:"function",name:"restore",arguments:arguments})},fillRect:function(){c.push({type:"function",name:"fillRect",arguments:arguments})},createPattern:function(){c.push({type:"function",name:"createPattern",arguments:arguments})},drawShape:function(){var a=[];return c.push({type:"function",name:"drawShape",arguments:a}),{moveTo:function(){a.push({name:"moveTo",arguments:arguments})},lineTo:function(){a.push({name:"lineTo",arguments:arguments})},arcTo:function(){a.push({name:"arcTo",arguments:arguments})},bezierCurveTo:function(){a.push({name:"bezierCurveTo",arguments:arguments})},quadraticCurveTo:function(){a.push({name:"quadraticCurveTo",arguments:arguments})}}},drawImage:function(){c.push({type:"function",name:"drawImage",arguments:arguments})},fillText:function(){c.push({type:"function",name:"fillText",arguments:arguments})},setVariable:function(a,b){return c.push({type:"variable",name:a,arguments:b}),b}}}function g(a){return{zindex:a,children:[]}}function h(a,b){a=a.length?a:[a];var c,d,e={logging:!1,elements:a,background:"#fff",proxy:null,timeout:0,useCORS:!1,allowTaint:!1,svgRendering:!1,ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:!0,letterRendering:!1,chinese:!1,width:null,height:null,taintTest:!0,renderer:"Canvas"};return e=k.Util.Extend(b,e),k.logging=e.logging,e.complete=function(a){"function"==typeof e.onpreloaded&&e.onpreloaded(a)===!1||(c=k.Parse(a,e),"function"==typeof e.onparsed&&e.onparsed(c)===!1||(d=k.Renderer(c,e),"function"==typeof e.onrendered&&e.onrendered(d)))},window.setTimeout(function(){k.Preload(e)},0),{render:function(a,b){return k.Renderer(a,k.Util.Extend(b,e))},parse:function(a,b){return k.Parse(a,k.Util.Extend(b,e))},preload:function(a){return k.Preload(k.Util.Extend(a,e))},log:k.Util.log}}var i,j,k={};k.Util={},k.Util.log=function(a){k.logging&&window.console&&window.console.log&&window.console.log(a)},k.Util.trimText=function(a){return function(b){return a?a.apply(b):((b||"")+"").replace(/^\s+|\s+$/g,"")}}(String.prototype.trim),k.Util.asFloat=function(a){return parseFloat(a)},function(){var a=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g,b=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;k.Util.parseTextShadows=function(c){if(!c||"none"===c)return[];for(var d=c.match(a),e=[],f=0;d&&f<d.length;f++){var g=d[f].match(b);e.push({color:g[0],offsetX:g[1]?g[1].replace("px",""):0,offsetY:g[2]?g[2].replace("px",""):0,blur:g[3]?g[3].replace("px",""):0})}return e}}(),k.Util.parseBackgroundImage=function(a){var b,c,d,e,f,g,h,i,j=" \r\n\t",k=[],l=0,m=0,n=function(){b&&('"'===c.substr(0,1)&&(c=c.substr(1,c.length-2)),c&&i.push(c),"-"===b.substr(0,1)&&(e=b.indexOf("-",1)+1)>0&&(d=b.substr(0,e),b=b.substr(e)),k.push({prefix:d,method:b.toLowerCase(),value:f,args:i})),i=[],b=d=c=f=""};n();for(var o=0,p=a.length;o<p;o++)if(g=a[o],!(0===l&&j.indexOf(g)>-1)){switch(g){case'"':h?h===g&&(h=null):h=g;break;case"(":if(h)break;if(0===l){l=1,f+=g;continue}m++;break;case")":if(h)break;if(1===l){if(0===m){l=0,f+=g,n();continue}m--}break;case",":if(h)break;if(0===l){n();continue}if(1===l&&0===m&&!b.match(/^url$/i)){i.push(c),c="",f+=g;continue}}f+=g,0===l?b+=g:c+=g}return n(),k},k.Util.Bounds=function(a){var b,c={};return a.getBoundingClientRect&&(b=a.getBoundingClientRect(),c.top=b.top,c.bottom=b.bottom||b.top+b.height,c.left=b.left,c.width=a.offsetWidth,c.height=a.offsetHeight),c},k.Util.OffsetBounds=function(a){var b=a.offsetParent?k.Util.OffsetBounds(a.offsetParent):{top:0,left:0};return{top:a.offsetTop+b.top,bottom:a.offsetTop+a.offsetHeight+b.top,left:a.offsetLeft+b.left,width:a.offsetWidth,height:a.offsetHeight}},k.Util.getCSS=function(a,b,e){i!==a&&(j=document.defaultView.getComputedStyle(a,null));var f=j[b];if(/^background(Size|Position)$/.test(b))return d(f,a,b,e);if(/border(Top|Bottom)(Left|Right)Radius/.test(b)){var g=f.split(" ");return g.length<=1&&(g[1]=g[0]),g.map(c)}return f},k.Util.resizeBounds=function(a,b,c,d,e){var f,g,h=c/d,i=a/b;return e&&"auto"!==e?h<i^"contain"===e?(g=d,f=d*i):(f=c,g=c/i):(f=c,g=d),{width:f,height:g}},k.Util.BackgroundPosition=function(a,b,c,d,f){var g=e("backgroundPosition",a,b,c,d,f);return{left:g[0],top:g[1]}},k.Util.BackgroundSize=function(a,b,c,d){var f=e("backgroundSize",a,b,c,d);return{width:f[0],height:f[1]}},k.Util.Extend=function(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},k.Util.Children=function(a){var b;try{b=a.nodeName&&"IFRAME"===a.nodeName.toUpperCase()?a.contentDocument||a.contentWindow.document:function(a){var b=[];return null!==a&&!function(a,b){var c=a.length,d=0;if("number"==typeof b.length)for(var e=b.length;d<e;d++)a[c++]=b[d];else for(;void 0!==b[d];)a[c++]=b[d++];return a.length=c,a}(b,a),b}(a.childNodes)}catch(a){k.Util.log("html2canvas.Util.Children failed with exception: "+a.message),b=[]}return b},k.Util.isTransparent=function(a){return"transparent"===a||"rgba(0, 0, 0, 0)"===a},k.Util.Font=function(){var a={};return function(b,c,d){if(void 0!==a[b+"-"+c])return a[b+"-"+c];var e,f,g,h=d.createElement("div"),i=d.createElement("img"),j=d.createElement("span"),k="Hidden Text";return h.style.visibility="hidden",h.style.fontFamily=b,h.style.fontSize=c,h.style.margin=0,h.style.padding=0,d.body.appendChild(h),i.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=",i.width=1,i.height=1,i.style.margin=0,i.style.padding=0,i.style.verticalAlign="baseline",j.style.fontFamily=b,j.style.fontSize=c,j.style.margin=0,j.style.padding=0,j.appendChild(d.createTextNode(k)),h.appendChild(j),h.appendChild(i),e=i.offsetTop-j.offsetTop+1,h.removeChild(j),h.appendChild(d.createTextNode(k)),h.style.lineHeight="normal",i.style.verticalAlign="super",f=i.offsetTop-h.offsetTop+1,g={baseline:e,lineWidth:1,middle:f},a[b+"-"+c]=g,d.body.removeChild(h),g}}(),function(){function a(a){return function(c){try{a.addColorStop(c.stop,c.color)}catch(a){b.log(["failed to add color stop: ",a,"; tried to add: ",c])}}}var b=k.Util,c={};k.Generate=c;var d=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/];c.parseGradient=function(a,b){var c,e,f,g,h,i,j,k,l,m,n,o,p=d.length;for(e=0;e<p&&!(f=a.match(d[e]));e+=1);if(f)switch(f[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":if(c={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]},h=f[2].match(/\w+/g))for(i=h.length,e=0;e<i;e+=1)switch(h[e]){case"top":c.y0=0,c.y1=b.height;break;case"right":c.x0=b.width,c.x1=0;break;case"bottom":c.y0=b.height,c.y1=0;break;case"left":c.x0=0,c.x1=b.width}if(null===c.x0&&null===c.x1&&(c.x0=c.x1=b.width/2),null===c.y0&&null===c.y1&&(c.y0=c.y1=b.height/2),h=f[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(i=h.length,j=1/Math.max(i-1,1),e=0;e<i;e+=1)k=h[e].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),k[2]?(g=parseFloat(k[2]),g/="%"===k[3]?100:b.width):g=e*j,c.colorStops.push({color:k[1],stop:g});break;case"-webkit-gradient":if(c={type:"radial"===f[2]?"circle":f[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]},h=f[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/),h&&(c.x0=h[1]*b.width/100,c.y0=h[2]*b.height/100,c.x1=h[3]*b.width/100,c.y1=h[4]*b.height/100),h=f[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g))for(i=h.length,e=0;e<i;e+=1)k=h[e].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/),g=parseFloat(k[2]),"from"===k[1]&&(g=0),"to"===k[1]&&(g=1),c.colorStops.push({color:k[3],stop:g});break;case"-moz-linear-gradient":if(c={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]},h=f[2].match(/(\d{1,3})%?\s(\d{1,3})%?/),h&&(c.x0=h[1]*b.width/100,c.y0=h[2]*b.height/100,c.x1=b.width-c.x0,c.y1=b.height-c.y0),h=f[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g))for(i=h.length,j=1/Math.max(i-1,1),e=0;e<i;e+=1)k=h[e].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/),k[2]?(g=parseFloat(k[2]),k[3]&&(g/=100)):g=e*j,c.colorStops.push({color:k[1],stop:g});break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":if(c={type:"circle",x0:0,y0:0,x1:b.width,y1:b.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]},h=f[2].match(/(\d{1,3})%?\s(\d{1,3})%?/),h&&(c.cx=h[1]*b.width/100,c.cy=h[2]*b.height/100),h=f[3].match(/\w+/),k=f[4].match(/[a-z\-]*/),h&&k)switch(k[0]){case"farthest-corner":case"cover":case"":l=Math.sqrt(Math.pow(c.cx,2)+Math.pow(c.cy,2)),m=Math.sqrt(Math.pow(c.cx,2)+Math.pow(c.y1-c.cy,2)),n=Math.sqrt(Math.pow(c.x1-c.cx,2)+Math.pow(c.y1-c.cy,2)),o=Math.sqrt(Math.pow(c.x1-c.cx,2)+Math.pow(c.cy,2)),c.rx=c.ry=Math.max(l,m,n,o);break;case"closest-corner":l=Math.sqrt(Math.pow(c.cx,2)+Math.pow(c.cy,2)),m=Math.sqrt(Math.pow(c.cx,2)+Math.pow(c.y1-c.cy,2)),n=Math.sqrt(Math.pow(c.x1-c.cx,2)+Math.pow(c.y1-c.cy,2)),o=Math.sqrt(Math.pow(c.x1-c.cx,2)+Math.pow(c.cy,2)),c.rx=c.ry=Math.min(l,m,n,o);break;case"farthest-side":"circle"===h[0]?c.rx=c.ry=Math.max(c.cx,c.cy,c.x1-c.cx,c.y1-c.cy):(c.type=h[0],c.rx=Math.max(c.cx,c.x1-c.cx),c.ry=Math.max(c.cy,c.y1-c.cy));break;case"closest-side":case"contain":"circle"===h[0]?c.rx=c.ry=Math.min(c.cx,c.cy,c.x1-c.cx,c.y1-c.cy):(c.type=h[0],c.rx=Math.min(c.cx,c.x1-c.cx),c.ry=Math.min(c.cy,c.y1-c.cy))}if(h=f[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(i=h.length,j=1/Math.max(i-1,1),e=0;e<i;e+=1)k=h[e].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),k[2]?(g=parseFloat(k[2]),g/="%"===k[3]?100:b.width):g=e*j,c.colorStops.push({color:k[1],stop:g})}return c},c.Gradient=function(b,c){if(0!==c.width&&0!==c.height){var d,e,f=document.createElement("canvas"),g=f.getContext("2d");if(f.width=c.width,f.height=c.height,d=k.Generate.parseGradient(b,c))switch(d.type){case"linear":e=g.createLinearGradient(d.x0,d.y0,d.x1,d.y1),
d.colorStops.forEach(a(e)),g.fillStyle=e,g.fillRect(0,0,c.width,c.height);break;case"circle":e=g.createRadialGradient(d.cx,d.cy,0,d.cx,d.cy,d.rx),d.colorStops.forEach(a(e)),g.fillStyle=e,g.fillRect(0,0,c.width,c.height);break;case"ellipse":var h=document.createElement("canvas"),i=h.getContext("2d"),j=Math.max(d.rx,d.ry),l=2*j;h.width=h.height=l,e=i.createRadialGradient(d.rx,d.ry,0,d.rx,d.ry,j),d.colorStops.forEach(a(e)),i.fillStyle=e,i.fillRect(0,0,l,l),g.fillStyle=d.colorStops[d.colorStops.length-1].color,g.fillRect(0,0,f.width,f.height),g.drawImage(h,d.cx-d.rx,d.cy-d.ry,2*d.rx,2*d.ry)}return f}},c.ListAlpha=function(a){var b,c="";do b=a%26,c=String.fromCharCode(b+64)+c,a/=26;while(26*a>26);return c},c.ListRoman=function(a){var b,c=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],d=[1e3,900,500,400,100,90,50,40,10,9,5,4,1],e="",f=c.length;if(a<=0||a>=4e3)return a;for(b=0;b<f;b+=1)for(;a>=d[b];)a-=d[b],e+=c[b];return e}}(),k.Parse=function(a,b){function c(){return Math.max(Math.max(ha.body.scrollWidth,ha.documentElement.scrollWidth),Math.max(ha.body.offsetWidth,ha.documentElement.offsetWidth),Math.max(ha.body.clientWidth,ha.documentElement.clientWidth))}function d(){return Math.max(Math.max(ha.body.scrollHeight,ha.documentElement.scrollHeight),Math.max(ha.body.offsetHeight,ha.documentElement.offsetHeight),Math.max(ha.body.clientHeight,ha.documentElement.clientHeight))}function e(a,b){var c=parseInt(ma(a,b),10);return isNaN(c)?0:c}function h(a,b,c,d,e,f){"transparent"!==f&&(a.setVariable("fillStyle",f),a.fillRect(b,c,d,e),ga+=1)}function i(a,b,c){if(a.length>0)return b+c.toUpperCase()}function j(a,b){switch(b){case"lowercase":return a.toLowerCase();case"capitalize":return a.replace(/(^|\s|:|-|\(|\))([a-z])/g,i);case"uppercase":return a.toUpperCase();default:return a}}function l(a){return/^(normal|none|0px)$/.test(a)}function m(a,b,c,d){null!==a&&ia.trimText(a).length>0&&(d.fillText(a,b,c),ga+=1)}function n(a,b,c,d){var e=!1,f=ma(b,"fontWeight"),g=ma(b,"fontFamily"),h=ma(b,"fontSize"),i=ia.parseTextShadows(ma(b,"textShadow"));switch(parseInt(f,10)){case 401:f="bold";break;case 400:f="normal"}if(a.setVariable("fillStyle",d),a.setVariable("font",[ma(b,"fontStyle"),ma(b,"fontVariant"),f,h,g].join(" ")),a.setVariable("textAlign",e?"right":"left"),i.length&&(a.setVariable("shadowColor",i[0].color),a.setVariable("shadowOffsetX",i[0].offsetX),a.setVariable("shadowOffsetY",i[0].offsetY),a.setVariable("shadowBlur",i[0].blur)),"none"!==c)return ia.Font(g,h,ha)}function o(a,b,c,d,e){switch(b){case"underline":h(a,c.left,Math.round(c.top+d.baseline+d.lineWidth),c.width,1,e);break;case"overline":h(a,c.left,Math.round(c.top),c.width,1,e);break;case"line-through":h(a,c.left,Math.ceil(c.top+d.middle+d.lineWidth),c.width,1,e)}}function p(a,b,c,d,e){var f;if(ja.rangeBounds&&!e)"none"===c&&0===ia.trimText(b).length||(f=q(b,a.node,a.textOffset)),a.textOffset+=b.length;else if(a.node&&"string"==typeof a.node.nodeValue){var g=d?a.node.splitText(b.length):null;f=r(a.node,e),a.node=g}return f}function q(a,b,c){var d=ha.createRange();return d.setStart(b,c),d.setEnd(b,c+a.length),d.getBoundingClientRect()}function r(a,b){var c=a.parentNode,d=ha.createElement("wrapper"),e=a.cloneNode(!0);d.appendChild(a.cloneNode(!0)),c.replaceChild(d,a);var f=b?ia.OffsetBounds(d):ia.Bounds(d);return c.replaceChild(e,d),f}function s(a,c,d){var e,f,g=d.ctx,h=ma(a,"color"),i=ma(a,"textDecoration"),k=ma(a,"textAlign"),q={node:c,textOffset:0};ia.trimText(c.nodeValue).length>0&&(c.nodeValue=j(c.nodeValue,ma(a,"textTransform")),k=k.replace(["-webkit-auto"],["auto"]),f=!b.letterRendering&&/^(left|right|justify|auto)$/.test(k)&&l(ma(a,"letterSpacing"))?c.nodeValue.split(/(\b| )/):c.nodeValue.split(""),e=n(g,a,i,h),b.chinese&&f.forEach(function(a,b){/.*[\u4E00-\u9FA5].*$/.test(a)&&(a=a.split(""),a.unshift(b,1),f.splice.apply(f,a))}),f.forEach(function(a,b){var c=p(q,a,i,b<f.length-1,d.transform.matrix);c&&(m(a,c.left,c.bottom,g),o(g,i,c,e,h))}))}function t(a,b){var c,d,e=ha.createElement("boundelement");return e.style.display="inline",c=a.style.listStyleType,a.style.listStyleType="none",e.appendChild(ha.createTextNode(b)),a.insertBefore(e,a.firstChild),d=ia.Bounds(e),a.removeChild(e),a.style.listStyleType=c,d}function u(a){var b=-1,c=1,d=a.parentNode.childNodes;if(a.parentNode){for(;d[++b]!==a;)1===d[b].nodeType&&c++;return c}return-1}function v(a,b){var c,d=u(a);switch(b){case"decimal":c=d;break;case"decimal-leading-zero":c=1===d.toString().length?d="0"+d.toString():d.toString();break;case"upper-roman":c=k.Generate.ListRoman(d);break;case"lower-roman":c=k.Generate.ListRoman(d).toLowerCase();break;case"lower-alpha":c=k.Generate.ListAlpha(d).toLowerCase();break;case"upper-alpha":c=k.Generate.ListAlpha(d)}return c+". "}function w(a,b,c){var d,e,f,g=b.ctx,h=ma(a,"listStyleType");if(/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(h)){if(e=v(a,h),f=t(a,e),n(g,a,"none",ma(a,"color")),"inside"!==ma(a,"listStylePosition"))return;g.setVariable("textAlign","left"),d=c.left,m(e,d,f.bottom,g)}}function x(b){var c=a[b];return!(!c||c.succeeded!==!0)&&c.img}function y(a,b){var c=Math.max(a.left,b.left),d=Math.max(a.top,b.top),e=Math.min(a.left+a.width,b.left+b.width),f=Math.min(a.top+a.height,b.top+b.height);return{left:c,top:d,width:e-c,height:f-d}}function z(a,b,c){var d,e="static"!==b.cssPosition,f=e?ma(a,"zIndex"):"auto",h=ma(a,"opacity"),i="none"!==ma(a,"cssFloat");b.zIndex=d=g(f),d.isPositioned=e,d.isFloated=i,d.opacity=h,d.ownStacking="auto"!==f||h<1,c&&c.zIndex.children.push(b)}function A(a,b,c,d,f){var g=e(b,"paddingLeft"),h=e(b,"paddingTop"),i=e(b,"paddingRight"),j=e(b,"paddingBottom");M(a,c,0,0,c.width,c.height,d.left+g+f[3].width,d.top+h+f[0].width,d.width-(f[1].width+f[3].width+g+i),d.height-(f[0].width+f[2].width+h+j))}function B(a){return["Top","Right","Bottom","Left"].map(function(b){return{width:e(a,"border"+b+"Width"),color:ma(a,"border"+b+"Color")}})}function C(a){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(b){return ma(a,"border"+b+"Radius")})}function D(a,b,c,d){var e=function(a,b,c){return{x:a.x+(b.x-a.x)*c,y:a.y+(b.y-a.y)*c}};return{start:a,startControl:b,endControl:c,end:d,subdivide:function(f){var g=e(a,b,f),h=e(b,c,f),i=e(c,d,f),j=e(g,h,f),k=e(h,i,f),l=e(j,k,f);return[D(a,g,j,l),D(l,k,i,d)]},curveTo:function(a){a.push(["bezierCurve",b.x,b.y,c.x,c.y,d.x,d.y])},curveToReversed:function(d){d.push(["bezierCurve",c.x,c.y,b.x,b.y,a.x,a.y])}}}function E(a,b,c,d,e,f,g){b[0]>0||b[1]>0?(a.push(["line",d[0].start.x,d[0].start.y]),d[0].curveTo(a),d[1].curveTo(a)):a.push(["line",f,g]),(c[0]>0||c[1]>0)&&a.push(["line",e[0].start.x,e[0].start.y])}function F(a,b,c,d,e,f,g){var h=[];return b[0]>0||b[1]>0?(h.push(["line",d[1].start.x,d[1].start.y]),d[1].curveTo(h)):h.push(["line",a.c1[0],a.c1[1]]),c[0]>0||c[1]>0?(h.push(["line",f[0].start.x,f[0].start.y]),f[0].curveTo(h),h.push(["line",g[0].end.x,g[0].end.y]),g[0].curveToReversed(h)):(h.push(["line",a.c2[0],a.c2[1]]),h.push(["line",a.c3[0],a.c3[1]])),b[0]>0||b[1]>0?(h.push(["line",e[1].end.x,e[1].end.y]),e[1].curveToReversed(h)):h.push(["line",a.c4[0],a.c4[1]]),h}function G(a,b,c){var d=a.left,e=a.top,f=a.width,g=a.height,h=b[0][0],i=b[0][1],j=b[1][0],k=b[1][1],l=b[2][0],m=b[2][1],n=b[3][0],o=b[3][1],p=f-j,q=g-m,r=f-l,s=g-o;return{topLeftOuter:pa(d,e,h,i).topLeft.subdivide(.5),topLeftInner:pa(d+c[3].width,e+c[0].width,Math.max(0,h-c[3].width),Math.max(0,i-c[0].width)).topLeft.subdivide(.5),topRightOuter:pa(d+p,e,j,k).topRight.subdivide(.5),topRightInner:pa(d+Math.min(p,f+c[3].width),e+c[0].width,p>f+c[3].width?0:j-c[3].width,k-c[0].width).topRight.subdivide(.5),bottomRightOuter:pa(d+r,e+q,l,m).bottomRight.subdivide(.5),bottomRightInner:pa(d+Math.min(r,f+c[3].width),e+Math.min(q,g+c[0].width),Math.max(0,l-c[1].width),Math.max(0,m-c[2].width)).bottomRight.subdivide(.5),bottomLeftOuter:pa(d,e+s,n,o).bottomLeft.subdivide(.5),bottomLeftInner:pa(d+c[3].width,e+s,Math.max(0,n-c[3].width),Math.max(0,o-c[2].width)).bottomLeft.subdivide(.5)}}function H(a,b,c,d,e){var f=ma(a,"backgroundClip"),g=[];switch(f){case"content-box":case"padding-box":E(g,d[0],d[1],b.topLeftInner,b.topRightInner,e.left+c[3].width,e.top+c[0].width),E(g,d[1],d[2],b.topRightInner,b.bottomRightInner,e.left+e.width-c[1].width,e.top+c[0].width),E(g,d[2],d[3],b.bottomRightInner,b.bottomLeftInner,e.left+e.width-c[1].width,e.top+e.height-c[2].width),E(g,d[3],d[0],b.bottomLeftInner,b.topLeftInner,e.left+c[3].width,e.top+e.height-c[2].width);break;default:E(g,d[0],d[1],b.topLeftOuter,b.topRightOuter,e.left,e.top),E(g,d[1],d[2],b.topRightOuter,b.bottomRightOuter,e.left+e.width,e.top),E(g,d[2],d[3],b.bottomRightOuter,b.bottomLeftOuter,e.left+e.width,e.top+e.height),E(g,d[3],d[0],b.bottomLeftOuter,b.topLeftOuter,e.left,e.top+e.height)}return g}function I(a,b,c){var d,e,f,g,h,i,j=b.left,k=b.top,l=b.width,m=b.height,n=C(a),o=G(b,n,c),p={clip:H(a,o,c,n,b),borders:[]};for(d=0;d<4;d++)if(c[d].width>0){switch(e=j,f=k,g=l,h=m-c[2].width,d){case 0:h=c[0].width,i=F({c1:[e,f],c2:[e+g,f],c3:[e+g-c[1].width,f+h],c4:[e+c[3].width,f+h]},n[0],n[1],o.topLeftOuter,o.topLeftInner,o.topRightOuter,o.topRightInner);break;case 1:e=j+l-c[1].width,g=c[1].width,i=F({c1:[e+g,f],c2:[e+g,f+h+c[2].width],c3:[e,f+h],c4:[e,f+c[0].width]},n[1],n[2],o.topRightOuter,o.topRightInner,o.bottomRightOuter,o.bottomRightInner);break;case 2:f=f+m-c[2].width,h=c[2].width,i=F({c1:[e+g,f+h],c2:[e,f+h],c3:[e+c[3].width,f],c4:[e+g-c[3].width,f]},n[2],n[3],o.bottomRightOuter,o.bottomRightInner,o.bottomLeftOuter,o.bottomLeftInner);break;case 3:g=c[3].width,i=F({c1:[e,f+h+c[2].width],c2:[e,f],c3:[e+g,f+c[0].width],c4:[e+g,f+h]},n[3],n[0],o.bottomLeftOuter,o.bottomLeftInner,o.topLeftOuter,o.topLeftInner)}p.borders.push({args:i,color:c[d].color})}return p}function J(a,b){var c=a.drawShape();return b.forEach(function(a,b){c[0===b?"moveTo":a[0]+"To"].apply(null,a.slice(1))}),c}function K(a,b,c){"transparent"!==c&&(a.setVariable("fillStyle",c),J(a,b),a.fill(),ga+=1)}function L(a,b,c){var d,e,f=ha.createElement("valuewrap"),g=["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"];g.forEach(function(b){try{f.style[b]=ma(a,b)}catch(a){ia.log("html2canvas: Parse: Exception caught in renderFormValue: "+a.message)}}),f.style.borderColor="black",f.style.borderStyle="solid",f.style.display="block",f.style.position="absolute",(/^(submit|reset|button|text|password)$/.test(a.type)||"SELECT"===a.nodeName)&&(f.style.lineHeight=ma(a,"height")),f.style.top=b.top+"px",f.style.left=b.left+"px",d="SELECT"===a.nodeName?(a.options[a.selectedIndex]||0).text:a.value,d||(d=a.placeholder),e=ha.createTextNode(d),f.appendChild(e),la.appendChild(f),s(a,e,c),la.removeChild(f)}function M(a){a.drawImage.apply(a,Array.prototype.slice.call(arguments,1)),ga+=1}function N(a,b){var c=window.getComputedStyle(a,b);if(c&&c.content&&"none"!==c.content&&"-moz-alt-content"!==c.content&&"none"!==c.display){var d=c.content+"",e=d.substr(0,1);e===d.substr(d.length-1)&&e.match(/'|"/)&&(d=d.substr(1,d.length-2));var f="url"===d.substr(0,3),g=document.createElement(f?"img":"span");return g.className=na+"-before "+na+"-after",Object.keys(c).filter(O).forEach(function(a){try{g.style[a]=c[a]}catch(b){ia.log(["Tried to assign readonly property ",a,"Error:",b])}}),f?g.src=ia.parseBackgroundImage(d)[0].args[0]:g.innerHTML=d,g}}function O(a){return isNaN(parseInt(a,10))}function P(a,b){var c=N(a,":before"),d=N(a,":after");(c||d)&&(c&&(a.className+=" "+na+"-before",a.parentNode.insertBefore(c,a),ca(c,b,!0),a.parentNode.removeChild(c),a.className=a.className.replace(na+"-before","").trim()),d&&(a.className+=" "+na+"-after",a.appendChild(d),ca(d,b,!0),a.removeChild(d),a.className=a.className.replace(na+"-after","").trim()))}function Q(a,b,c,d){var e=Math.round(d.left+c.left),f=Math.round(d.top+c.top);a.createPattern(b),a.translate(e,f),a.fill(),a.translate(-e,-f)}function R(a,b,c,d,e,f,g,h){var i=[];i.push(["line",Math.round(e),Math.round(f)]),i.push(["line",Math.round(e+g),Math.round(f)]),i.push(["line",Math.round(e+g),Math.round(h+f)]),i.push(["line",Math.round(e),Math.round(h+f)]),J(a,i),a.save(),a.clip(),Q(a,b,c,d),a.restore()}function S(a,b,c){h(a,b.left,b.top,b.width,b.height,c)}function T(a,b,c,d,e){var f=ia.BackgroundSize(a,b,d,e),g=ia.BackgroundPosition(a,b,d,e,f),h=ma(a,"backgroundRepeat").split(",").map(ia.trimText);switch(d=V(d,f),h=h[e]||h[0]){case"repeat-x":R(c,d,g,b,b.left,b.top+g.top,99999,d.height);break;case"repeat-y":R(c,d,g,b,b.left+g.left,b.top,d.width,99999);break;case"no-repeat":R(c,d,g,b,b.left+g.left,b.top+g.top,d.width,d.height);break;default:Q(c,d,g,{top:b.top,left:b.left,width:d.width,height:d.height})}}function U(a,b,c){for(var d,e=ma(a,"backgroundImage"),f=ia.parseBackgroundImage(e),g=f.length;g--;)if(e=f[g],e.args&&0!==e.args.length){var h="url"===e.method?e.args[0]:e.value;d=x(h),d?T(a,b,c,d,g):ia.log("html2canvas: Error loading background:",e)}}function V(a,b){if(a.width===b.width&&a.height===b.height)return a;var c,d=ha.createElement("canvas");return d.width=b.width,d.height=b.height,c=d.getContext("2d"),M(c,a,0,0,a.width,a.height,0,0,b.width,b.height),d}function W(a,b,c){return a.setVariable("globalAlpha",ma(b,"opacity")*(c?c.opacity:1))}function X(a){return a.replace("px","")}function Y(a,b){var c=ma(a,"transform")||ma(a,"-webkit-transform")||ma(a,"-moz-transform")||ma(a,"-ms-transform")||ma(a,"-o-transform"),d=ma(a,"transform-origin")||ma(a,"-webkit-transform-origin")||ma(a,"-moz-transform-origin")||ma(a,"-ms-transform-origin")||ma(a,"-o-transform-origin")||"0px 0px";d=d.split(" ").map(X).map(ia.asFloat);var e;if(c&&"none"!==c){var f=c.match(qa);if(f)switch(f[1]){case"matrix":e=f[2].split(",").map(ia.trimText).map(ia.asFloat)}}return{origin:d,matrix:e}}function Z(a,e,g,h){var i=f(e?g.width:c(),e?g.height:d()),j={ctx:i,opacity:W(i,a,e),cssPosition:ma(a,"position"),borders:B(a),transform:h,clip:e&&e.clip?ia.Extend({},e.clip):null};return z(a,j,e),b.useOverflow===!0&&/(hidden|scroll|auto)/.test(ma(a,"overflow"))===!0&&/(BODY)/i.test(a.nodeName)===!1&&(j.clip=j.clip?y(j.clip,g):g),j}function $(a,b,c){var d={left:b.left+a[3].width,top:b.top+a[0].width,width:b.width-(a[1].width+a[3].width),height:b.height-(a[0].width+a[2].width)};return c&&(d=y(d,c)),d}function _(a,b){var c=b.matrix?ia.OffsetBounds(a):ia.Bounds(a);return b.origin[0]+=c.left,b.origin[1]+=c.top,c}function aa(a,b,c,d){var e,f=Y(a,b),g=_(a,f),h=Z(a,b,g,f),i=h.borders,j=h.ctx,k=$(i,g,h.clip),l=I(a,g,i),m=ka.test(a.nodeName)?"#efefef":ma(a,"backgroundColor");switch(J(j,l.clip),j.save(),j.clip(),k.height>0&&k.width>0&&!d?(S(j,g,m),U(a,k,j)):d&&(h.backgroundColor=m),j.restore(),l.borders.forEach(function(a){K(j,a.args,a.color)}),c||P(a,h),a.nodeName){case"IMG":(e=x(a.getAttribute("src")))?A(j,a,e,g,i):ia.log("html2canvas: Error loading <img>:"+a.getAttribute("src"));break;case"INPUT":/^(text|url|email|submit|button|reset)$/.test(a.type)&&(a.value||a.placeholder||"").length>0&&L(a,g,h);break;case"TEXTAREA":(a.value||a.placeholder||"").length>0&&L(a,g,h);break;case"SELECT":(a.options||a.placeholder||"").length>0&&L(a,g,h);break;case"LI":w(a,h,k);break;case"CANVAS":A(j,a,a,g,i)}return h}function ba(a){return"none"!==ma(a,"display")&&"hidden"!==ma(a,"visibility")&&!a.hasAttribute("data-html2canvas-ignore")}function ca(a,b,c){ba(a)&&(b=aa(a,b,c,!1)||b,ka.test(a.nodeName)||da(a,b,c))}function da(a,b,c){ia.Children(a).forEach(function(d){d.nodeType===d.ELEMENT_NODE?ca(d,b,c):d.nodeType===d.TEXT_NODE&&s(a,d,b)})}function ea(){var a=ma(document.documentElement,"backgroundColor"),b=ia.isTransparent(a)&&fa===document.body,c=aa(fa,null,!1,b);return da(fa,c),b&&(a=c.backgroundColor),la.removeChild(oa),{backgroundColor:a,stack:c}}window.scroll(0,0);var fa=void 0===b.elements?document.body:b.elements[0],ga=0,ha=fa.ownerDocument,ia=k.Util,ja=ia.Support(b,ha),ka=new RegExp("("+b.ignoreElements+")"),la=ha.body,ma=ia.getCSS,na="___html2canvas___pseudoelement",oa=ha.createElement("style");oa.innerHTML="."+na+'-before:before { content: "" !important; display: none !important; }.'+na+'-after:after { content: "" !important; display: none !important; }',la.appendChild(oa),a=a||{};var pa=function(a){return function(b,c,d,e){var f=d*a,g=e*a,h=b+d,i=c+e;return{topLeft:D({x:b,y:i},{x:b,y:i-g},{x:h-f,y:c},{x:h,y:c}),topRight:D({x:b,y:c},{x:b+f,y:c},{x:h,y:i-g},{x:h,y:i}),bottomRight:D({x:h,y:c},{x:h,y:c+g},{x:b+f,y:i},{x:b,y:i}),bottomLeft:D({x:h,y:i},{x:h-f,y:i},{x:b,y:c+g},{x:b,y:c})}}}(4*((Math.sqrt(2)-1)/3)),qa=/(matrix)\((.+)\)/;return ea()},k.Preload=function(a){function b(a){x.href=a,x.href=x.href;var b=x.protocol+x.host;return b===m}function c(){r.log("html2canvas: start: images: "+q.numLoaded+" / "+q.numTotal+" (failed: "+q.numFailed+")"),!q.firstRun&&q.numLoaded>=q.numTotal&&(r.log("Finished loading images: # "+q.numTotal+" (failed: "+q.numFailed+")"),"function"==typeof a.complete&&a.complete(q))}function d(b,d,e){var f,g,h=a.proxy;x.href=b,b=x.href,f="html2canvas_"+s++,e.callbackname=f,h+=h.indexOf("?")>-1?"&":"?",h+="url="+encodeURIComponent(b)+"&callback="+f,g=u.createElement("script"),window[f]=function(a){"error:"===a.substring(0,6)?(e.succeeded=!1,q.numLoaded++,q.numFailed++,c()):(l(d,e),d.src=a),window[f]=void 0;try{delete window[f]}catch(a){}g.parentNode.removeChild(g),g=null,delete e.script,delete e.callbackname},g.setAttribute("type","text/javascript"),g.setAttribute("src",h),e.script=g,window.document.body.appendChild(g)}function e(a,b){var c=window.getComputedStyle(a,b),d=c.content;"url"===d.substr(0,3)&&n.loadImage(k.Util.parseBackgroundImage(d)[0].args[0]),i(c.backgroundImage,a)}function f(a){e(a,":before"),e(a,":after")}function g(a,b){var d=k.Generate.Gradient(a,b);void 0!==d&&(q[a]={img:d,succeeded:!0},q.numTotal++,q.numLoaded++,c())}function h(a){return a&&a.method&&a.args&&a.args.length>0}function i(a,b){var c;k.Util.parseBackgroundImage(a).filter(h).forEach(function(a){"url"===a.method?n.loadImage(a.args[0]):a.method.match(/\-?gradient$/)&&(void 0===c&&(c=k.Util.Bounds(b)),g(a.value,c))})}function j(a){var b=!1;try{r.Children(a).forEach(j)}catch(a){}try{b=a.nodeType}catch(a){b=!1,r.log("html2canvas: failed to access some element's nodeType - Exception: "+a.message)}if(1===b||void 0===b){f(a);try{i(r.getCSS(a,"backgroundImage"),a)}catch(a){r.log("html2canvas: failed to get background-image - Exception: "+a.message)}i(a)}}function l(b,e){b.onload=function(){void 0!==e.timer&&window.clearTimeout(e.timer),q.numLoaded++,e.succeeded=!0,b.onerror=b.onload=null,c()},b.onerror=function(){if("anonymous"===b.crossOrigin&&(window.clearTimeout(e.timer),a.proxy)){var f=b.src;return b=new Image,e.img=b,b.src=f,void d(b.src,b,e)}q.numLoaded++,q.numFailed++,e.succeeded=!1,b.onerror=b.onload=null,c()}}var m,n,o,p,q={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:!1},r=k.Util,s=0,t=a.elements[0]||document.body,u=t.ownerDocument,v=t.getElementsByTagName("img"),w=v.length,x=u.createElement("a"),y=function(a){return void 0!==a.crossOrigin}(new Image);for(x.href=window.location.href,m=x.protocol+x.host,n={loadImage:function(c){var e,f;c&&void 0===q[c]&&(e=new Image,c.match(/data:image\/.*;base64,/i)?(e.src=c.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,""),f=q[c]={img:e},q.numTotal++,l(e,f)):b(c)||a.allowTaint===!0?(f=q[c]={img:e},q.numTotal++,l(e,f),e.src=c):y&&!a.allowTaint&&a.useCORS?(e.crossOrigin="anonymous",f=q[c]={img:e},q.numTotal++,l(e,f),e.src=c):a.proxy&&(f=q[c]={img:e},q.numTotal++,d(c,e,f)))},cleanupDOM:function(b){var d,e;if(!q.cleanupDone){b&&"string"==typeof b?r.log("html2canvas: Cleanup because: "+b):r.log("html2canvas: Cleanup after timeout: "+a.timeout+" ms.");for(e in q)if(q.hasOwnProperty(e)&&(d=q[e],"object"==typeof d&&d.callbackname&&void 0===d.succeeded)){window[d.callbackname]=void 0;try{delete window[d.callbackname]}catch(a){}d.script&&d.script.parentNode&&(d.script.setAttribute("src","about:blank"),d.script.parentNode.removeChild(d.script)),q.numLoaded++,q.numFailed++,r.log("html2canvas: Cleaned up failed img: '"+e+"' Steps: "+q.numLoaded+" / "+q.numTotal)}void 0!==window.stop?window.stop():void 0!==document.execCommand&&document.execCommand("Stop",!1),void 0!==document.close&&document.close(),q.cleanupDone=!0,b&&"string"==typeof b||c()}},renderingDone:function(){p&&window.clearTimeout(p)}},a.timeout>0&&(p=window.setTimeout(n.cleanupDOM,a.timeout)),r.log("html2canvas: Preload starts: finding background-images"),q.firstRun=!0,j(t),r.log("html2canvas: Preload: Finding images"),o=0;o<w;o+=1)n.loadImage(v[o].getAttribute("src"));return q.firstRun=!1,r.log("html2canvas: Preload: Done."),q.numTotal===q.numLoaded&&c(),n},k.Renderer=function(a,b){function c(a){function b(a){Object.keys(a).sort().forEach(function(c){var e=[],f=[],g=[],h=[];a[c].forEach(function(a){a.node.zIndex.isPositioned||a.node.zIndex.opacity<1?g.push(a):a.node.zIndex.isFloated?f.push(a):e.push(a)}),function a(b){b.forEach(function(b){h.push(b),b.children&&a(b.children)})}(e.concat(f,g)),h.forEach(function(a){a.context?b(a.context):d.push(a.node)})})}var c,d=[];return c=function(a){function b(a,c,d){var e="auto"===c.zIndex.zindex?0:Number(c.zIndex.zindex),f=a,g=c.zIndex.isPositioned,h=c.zIndex.isFloated,i={node:c},j=d;c.zIndex.ownStacking?(f=i.context={"!":[{node:c,children:[]}]},j=void 0):(g||h)&&(j=i.children=[]),0===e&&d?d.push(i):(a[e]||(a[e]=[]),a[e].push(i)),c.zIndex.children.forEach(function(a){b(f,a,j)})}var c={};return b(c,a),c}(a),b(c),d}function d(a){var c;if("string"==typeof b.renderer&&void 0!==k.Renderer[a])c=k.Renderer[a](b);else{if("function"!=typeof a)throw new Error("Unknown renderer");c=a(b)}if("function"!=typeof c)throw new Error("Invalid renderer defined");return c}return d(b.renderer)(a,b,document,c(a.stack),k)},k.Util.Support=function(a,b){function c(){var a=new Image,c=b.createElement("canvas"),d=void 0!==c.getContext&&c.getContext("2d");if(d===!1)return!1;c.width=c.height=10,a.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>","<foreignObject width='10' height='10'>","<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>","sup","</div>","</foreignObject>","</svg>"].join("");try{d.drawImage(a,0,0),c.toDataURL()}catch(a){return!1}return k.Util.log("html2canvas: Parse: SVG powered rendering available"),!0}function d(){var a,c,d,e,f=!1;return b.createRange&&(a=b.createRange(),a.getBoundingClientRect&&(c=b.createElement("boundtest"),c.style.height="123px",c.style.display="block",b.body.appendChild(c),a.selectNode(c),d=a.getBoundingClientRect(),e=d.height,123===e&&(f=!0),b.body.removeChild(c))),f}return{rangeBounds:d(),svgRendering:a.svgRendering&&c()}},a.render=h,h.log=k.Util.log,h.Renderer={Canvas:void 0},k.Renderer.Canvas=function(a){function b(a,b){a.beginPath(),b.forEach(function(b){a[b.name].apply(a,b.arguments)}),a.closePath()}function c(a){if(f.indexOf(a.arguments[0].src)===-1){h.drawImage(a.arguments[0],0,0);try{h.getImageData(0,0,1,1)}catch(a){return g=e.createElement("canvas"),h=g.getContext("2d"),!1}f.push(a.arguments[0].src)}return!0}function d(d,e){switch(e.type){case"variable":d[e.name]=e.arguments;break;case"function":switch(e.name){case"createPattern":if(e.arguments[0].width>0&&e.arguments[0].height>0)try{d.fillStyle=d.createPattern(e.arguments[0],"repeat")}catch(a){i.log("html2canvas: Renderer: Error creating pattern",a.message)}break;case"drawShape":b(d,e.arguments);break;case"drawImage":e.arguments[8]>0&&e.arguments[7]>0&&(!a.taintTest||a.taintTest&&c(e))&&d.drawImage.apply(d,e.arguments);break;default:d[e.name].apply(d,e.arguments)}}}a=a||{};var e=document,f=[],g=document.createElement("canvas"),h=g.getContext("2d"),i=k.Util,j=a.canvas||e.createElement("canvas");return function(a,b,c,e,f){var g,h,k,l=j.getContext("2d"),m=a.stack;return j.width=j.style.width=b.width||m.ctx.width,j.height=j.style.height=b.height||m.ctx.height,k=l.fillStyle,l.fillStyle=i.isTransparent(m.backgroundColor)&&void 0!==b.background?b.background:a.backgroundColor,l.fillRect(0,0,j.width,j.height),l.fillStyle=k,e.forEach(function(a){l.textBaseline="bottom",l.save(),a.transform.matrix&&(l.translate(a.transform.origin[0],a.transform.origin[1]),l.transform.apply(l,a.transform.matrix),l.translate(-a.transform.origin[0],-a.transform.origin[1])),a.clip&&(l.beginPath(),l.rect(a.clip.left,a.clip.top,a.clip.width,a.clip.height),l.clip()),a.ctx.storage&&a.ctx.storage.forEach(function(a){d(l,a)}),l.restore()}),i.log("html2canvas: Renderer: Canvas renderer done - returning canvas obj"),1===b.elements.length&&"object"==typeof b.elements[0]&&"BODY"!==b.elements[0].nodeName?(h=f.Util.Bounds(b.elements[0]),g=c.createElement("canvas"),g.width=Math.ceil(h.width),g.height=Math.ceil(h.height),l=g.getContext("2d"),l.drawImage(j,h.left,h.top,h.width,h.height,0,0,h.width,h.height),j=null,g):j}}}(html2canvas||(html2canvas={}));var feedback;!function(a){var b='<div id="feedback-welcome">     <div class="modal-header dialog-header-info">        <h4 class="modal-title">Feedback (1/3)</h4>        <button type="button" class="close ionicon ionicon-close feedback-wizard-close"></button>    </div>    <div class="modal-body">        <p>Feedback lets you send us suggestions about our products. We welcome problem reports, feature ideas and general comments.</p>        <div class="form-group">            <label>Brief description:</label>            <textarea id="feedback-description-tmp" class="ion-input"></textarea>        </div>        <div class="form-group">            <p>Next we\'ll let you identify areas of the page related to your description.</p>        </div>        <div class="feedback-buttons">            <button id="feedback-welcome-next" type="button" class="ionbtn ionbtn-primary">Next</button>        </div>        <div id="feedback-welcome-error">Please enter a description.</div>    </div></div>',c='<div id="feedback-highlighter">    <div class="modal-header dialog-header-info">        <h4 class="modal-title">Feedback (2/3)</h4>        <button type="button" class="close ionicon ionicon-close feedback-wizard-close"></button>    </div>    <div class="modal-body">        <div class="form-group">            <p>Click and drag on the page to help us better understand your feedback. You can move this dialog if it\'s in the way.</p>        </div>        <div class="form-group">            <div class="form-group">                <label>Highlight areas relevant to your feedback</label>                <button type="button" class="feedback-sethighlight ionbtn ionbtn-primary ion-input">                    <span icon="edit" class="ionicon ionicon-edit" style="margin-right: 0.25em; margin-left:  0.25em; vertical-align: middle; display: inline-block"></span>                    <span style="vertical-align: middle; display: inline-block; position:relative">Highlight</span>                </button>            </div>            <div class="form-group">                <label>Black out any personal information</label>                <button type="button" class="feedback-setblackout ionbtn ionbtn-secondary ion-input">                    <span icon="hide" class="ionicon ionicon-hide" style="margin-right: 0.25em; margin-left:  0.25em; vertical-align: middle; display: inline-block"></span>                    <span style="vertical-align: middle; display: inline-block; position:relative">Black out</span>                </button>            </div>        </div>        <div class="feedback-buttons">            <button id="feedback-highlighter-back" type="button" class="ionbtn ionbtn-secondary">Back</button>            <button id="feedback-highlighter-next" type="button" class="ionbtn ionbtn-primary">Next</button>        </div>    </div></div>',d='<div id="feedback-overview">    <div class="modal-header dialog-header-info">        <h4 class="modal-title">Feedback (3/3)</h4>        <button type="button" class="close ionicon ionicon-close feedback-wizard-close"></button>    </div>    <div class="modal-body">        <div class="form-group modal-info">            <div id="feedback-overview-screenshot">                <h3>Screenshot</h3>            </div>            <div id="feedback-overview-info">                <h3>Description</h3>                <div class="form-group">                    <textarea id="feedback-overview-description" class="ion-input"></textarea>                </div>                <div id="feedback-overview-user-details">                    <div style="float:left; width: 50%">                        <h3>Full Name</h3>                        <div class="form-group">                            <input type="text" id="feedback-overview-username" class="ion-input"></input>                        </div>                    </div>                    <div style="float:left; width: 50%">                        <h3>E-mail</h3>                        <div class="form-group">                            <input type="text" id="feedback-overview-email" class="ion-input"></input>                        </div>                    </div>                    <h3>Notes</h3>                    <div class="form-group">                        <textarea id="feedback-overview-additionalInfo" class="ion-input"></textarea>                    </div>                </div>            </div>        </div>        <div class="feedback-buttons" style="margin-top: 15px;">            <button id="feedback-overview-back" type="button" class="ionbtn ionbtn-secondary">Back</button>            <button id="feedback-submit" type="button" class="ionbtn ionbtn-primary">Send</button>        </div>        <div id="feedback-overview-error">Please enter a description.</div>    </div></div>';$.feedback=function(a){function e(a){return 0===a.pageX?0:a.pageX||a.originalEvent.touches[0].pageX}function f(a){return 0===a.pageY?0:a.pageY||a.originalEvent.touches[0].pageY}function g(){n=!1,$(document).off("mouseenter mouseleave",".feedback-helper"),$(document).off("mouseup keyup"),$(document).off("mousedown",".feedback-setblackout"),$(document).off("mousedown touchstart",".feedback-sethighlight"),$(document).off("mousedown click","#feedback-close"),$(document).off("mousedown touchstart","#feedback-canvas"),$(document).off("click","#feedback-highlighter-next"),$(document).off("click","#feedback-highlighter-back"),$(document).off("click","#feedback-welcome-next"),$(document).off("click","#feedback-overview-back"),$(document).off("mouseleave","body"),$(document).off("mouseenter",".feedback-helper"),$(document).off("selectstart dragstart","body",o),$("#feedback-module").off("click",".feedback-wizard-close,.feedback-close-btn"),$(document).off("click","#feedback-submit"),k.canvas.highlightElement&&($(document).off("click touchstart","#feedback-canvas"),$(document).off("mousemove","#feedback-canvas")),$('[data-highlighted="true"]').removeAttr("data-highlight-id").removeAttr("data-highlighted"),$("#feedback-module").remove(),$(".feedback-btn").show(),k.onClose.call(this)}function h(a,b){b="undefined"==typeof b||b,a.clearRect(0,0,$("#feedback-canvas").width(),$("#feedback-canvas").height()),a.fillStyle="rgba(102,102,102,0.5)",a.fillRect(0,0,$("#feedback-canvas").width(),$("#feedback-canvas").height()),$(".feedback-helper").each(function(){"highlight"==$(this).attr("data-type")&&b&&i(a,parseInt($(this).css("left"),10),parseInt($(this).css("top"),10),$(this).width(),$(this).height())}),$(".feedback-helper").each(function(){"highlight"==$(this).attr("data-type")&&a.clearRect(parseInt($(this).css("left"),10),parseInt($(this).css("top"),10),$(this).width(),$(this).height())}),$(".feedback-helper").each(function(){"blackout"==$(this).attr("data-type")&&(a.fillStyle="rgba(0,0,0,1)",a.fillRect(parseInt($(this).css("left"),10),parseInt($(this).css("top"),10),$(this).width(),$(this).height()))})}function i(a,b,c,d,e){a.strokeStyle=k.canvas.strokeStyle,a.shadowColor=k.canvas.shadowColor,a.shadowOffsetX=k.canvas.shadowOffsetX,a.shadowOffsetY=k.canvas.shadowOffsetY,
a.shadowBlur=k.canvas.shadowBlur,a.lineJoin=k.canvas.lineJoin,a.lineWidth=k.canvas.lineWidth,a.strokeRect(b,c,d,e),a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.lineWidth=1}var j,k=$.extend({buttonText:"Send feedback",showDescriptionModal:!0,isDraggable:!0,position:"bottom",autoHide:!1,showInitialBox:!0,onScreenshotTaken:function(){},onPostReady:function(){},onPrepare:function(){},onClose:function(){},html2canvas:{proxy:void 0,letterRendering:!1},canvas:{highlightElement:!0,screenshotStroke:!0,strokeStyle:"transparent",shadowColor:"black",shadowOffsetX:1,shadowOffsetY:1,shadowBlur:10,lineJoin:"bevel",lineWidth:1},tpl:{description:b,highlighter:c,overview:d}},a),l=!!window.HTMLCanvasElement,m="right"===k.position?"feedback-btn-right":k.autoHide?"feedback-btn-bottom-auto-hide":"feedback-btn-bottom",n=!1,o=function(a){n&&a.preventDefault()},p=function(){k.onPrepare();var a=function(a,b,c){a.addClass("validation-error"),a.tooltip({title:b,trigger:"manual",html:!0,animation:!1,placement:c}),a.data("bs.tooltip").tip(0).addClass("tip-error"),a.tooltip("show")},b=function(a){a.removeClass("validation-error"),a.tooltip("hide")};$(this).hide();var c="",d=$(document).height(),l=$(document).width(),m='<div id="feedback-module">';k.showInitialBox&&(m+=k.tpl.description),m+=k.tpl.highlighter+k.tpl.overview+'<canvas id="feedback-canvas"></canvas><div id="feedback-helpers"></div><input id="feedback-description" name="feedback-description" type="hidden"></div>',$("body").append(m);var p={position:"absolute",left:"0px",top:"0px"},q={width:l,height:d};$("#feedback-module").css(p),$("#feedback-canvas").attr(q).css("z-index","30000"),k.showInitialBox||($("#feedback-highlighter-back").remove(),n=!0,$("#feedback-canvas").css("cursor","crosshair"),$("#feedback-helpers").show(),$("#feedback-welcome").hide(),$("#feedback-highlighter").show()),k.extraConfig.collectUserDetails||$("#feedback-overview-user-details").hide(),k.isDraggable&&$("#feedback-highlighter > .modal-header").on("mousedown touchstart",function(a){if(!$(a.target).hasClass("feedback-wizard-close")){var b=$(this).parent().addClass("feedback-draggable"),c=b.outerHeight(),d=b.outerWidth(),g=b.offset().top+c-f(a),h=b.offset().left+d-e(a);b.css("z-index",4e4).parents().on("mousemove touchmove",function(a){var b=f(a)+g-c,i=e(a)+h-d,j=c-f(a),k=d-e(a);i<0&&(i=0),b<0&&(b=0),k>$(window).width()&&(i=$(window).width()-d),i>$(window).width()-d&&(i=$(window).width()-d),j>$(document).height()&&(b=$(document).height()-c),b>$(document).height()-c&&(b=$(document).height()-c),$(".feedback-draggable").offset({top:b,left:i}).on("mouseup touchend",function(){$(this).removeClass("feedback-draggable")})}),a.preventDefault()}}).on("mouseup touchend",function(){$(this).removeClass("feedback-draggable"),$(this).parents().off("mousemove mousedown touchstart touchmove")});var r=$("#feedback-canvas")[0].getContext("2d");r.fillStyle="rgba(102,102,102,0.5)",r.fillRect(0,0,$("#feedback-canvas").width(),$("#feedback-canvas").height());var s={},t=!1,u=1,v={};if(v.browser={},v.browser.appCodeName=navigator.appCodeName,v.browser.appName=navigator.appName,v.browser.appVersion=navigator.appVersion,v.browser.cookieEnabled=navigator.cookieEnabled,v.browser.onLine=navigator.onLine,v.browser.platform=navigator.platform,v.browser.userAgent=navigator.userAgent,v.browser.plugins=[],$.each(navigator.plugins,function(a){v.browser.plugins.push(navigator.plugins[a].name)}),$(document).on("mousedown touchstart","#feedback-canvas",function(a){n&&(s.startX=e(a)-$(this).offset().left,s.startY=f(a)-$(this).offset().top,s.w=0,s.h=0,t=!0)}),$(document).on("mouseup touchend",function(){if(n){t=!1;var a=s.startY,b=s.startX,c=s.w,d=s.h;if(j="highlight",0==c||0==d)return;c<0&&(b+=c,c*=-1),d<0&&(a+=d,d*=-1),a+d>$(document).height()&&(d=$(document).height()-a),b+c>$(document).width()&&(c=$(document).width()-b),0==u&&(j="blackout"),$("#feedback-helpers").append('<div class="feedback-helper" data-type="'+j+'" data-time="'+Date.now()+'" style="position:absolute;top:'+a+"px;left:"+b+"px;width:"+c+"px;height:"+d+'px;z-index:30000;"></div>'),h(r),s.w=0}}),$(document).on("mousemove touchmove",function(a){n&&t&&($("#feedback-highlighter").css("cursor","default"),s.w=e(a)-$("#feedback-canvas").offset().left-s.startX,s.h=f(a)-$("#feedback-canvas").offset().top-s.startY,r.clearRect(0,0,$("#feedback-canvas").width(),$("#feedback-canvas").height()),r.fillStyle="rgba(102,102,102,0.5)",r.fillRect(0,0,$("#feedback-canvas").width(),$("#feedback-canvas").height()),$(".feedback-helper").each(function(){"highlight"==$(this).attr("data-type")&&i(r,parseInt($(this).css("left"),10),parseInt($(this).css("top"),10),$(this).width(),$(this).height())}),1==u&&(i(r,s.startX,s.startY,s.w,s.h),r.clearRect(s.startX,s.startY,s.w,s.h)),$(".feedback-helper").each(function(){"highlight"==$(this).attr("data-type")&&r.clearRect(parseInt($(this).css("left"),10),parseInt($(this).css("top"),10),$(this).width(),$(this).height())}),$(".feedback-helper").each(function(){"blackout"==$(this).attr("data-type")&&(r.fillStyle="rgba(0,0,0,1)",r.fillRect(parseInt($(this).css("left"),10),parseInt($(this).css("top"),10),$(this).width(),$(this).height()))}),0==u&&(r.fillStyle="rgba(0,0,0,0.5)",r.fillRect(s.startX,s.startY,s.w,s.h)))}),k.canvas.highlightElement){var w=[],x=[],y=0;$(document).on("mousemove click touchstart","#feedback-canvas",function(a){if(n){h(r),x=[],$("#feedback-canvas").css("cursor","crosshair"),$("* :not(body,script,iframe,div,section,.feedback-btn,#feedback-module *)").each(function(){"true"!==$(this).attr("data-highlighted")&&e(a)>$(this).offset().left&&e(a)<$(this).offset().left+$(this).width()&&f(a)>$(this).offset().top+parseInt($(this).css("padding-top"),10)&&f(a)<$(this).offset().top+$(this).height()+parseInt($(this).css("padding-top"),10)&&x.push($(this))});var b=x[x.length-1];if(b&&!t){$("#feedback-canvas").css("cursor","pointer");var c=b.offset().left-2,d=b.offset().top-2,g=b.width()+parseInt(b.css("padding-left"),10)+parseInt(b.css("padding-right"),10)+6,k=b.height()+parseInt(b.css("padding-top"),10)+parseInt(b.css("padding-bottom"),10)+6;1==u&&(i(r,c,d,g,k),r.clearRect(c,d,g,k),j="highlight"),$(".feedback-helper").each(function(){"highlight"==$(this).attr("data-type")&&r.clearRect(parseInt($(this).css("left"),10),parseInt($(this).css("top"),10),$(this).width(),$(this).height())}),0==u&&(j="blackout",r.fillStyle="rgba(0,0,0,0.5)",r.fillRect(c,d,g,k)),$(".feedback-helper").each(function(){"blackout"==$(this).attr("data-type")&&(r.fillStyle="rgba(0,0,0,1)",r.fillRect(parseInt($(this).css("left"),10),parseInt($(this).css("top"),10),$(this).width(),$(this).height()))}),"click"==a.type&&e(a)==s.startX&&f(a)==s.startY&&($("#feedback-helpers").append('<div class="feedback-helper" data-highlight-id="'+y+'" data-type="'+j+'" data-time="'+Date.now()+'" style="position:absolute;top:'+d+"px;left:"+c+"px;width:"+g+"px;height:"+k+'px;z-index:30000;"></div>'),w.push(y),++y,h(r))}}})}$(document).on("mouseleave","body,#feedback-canvas",function(){h(r)}),$(document).on("mouseenter",".feedback-helper",function(){h(r)}),$(document).on("click","#feedback-welcome-next",function(){$("#feedback-description").val().length>0?(n=!0,$("#feedback-canvas").css("cursor","crosshair"),$("#feedback-helpers").show(),$("#feedback-welcome").hide(),$("#feedback-highlighter").show(),b($("#feedback-description-tmp"))):a($("#feedback-description-tmp"),"Description cannot be empty","auto top")}),$(document).on("mouseenter mouseleave",".feedback-helper",function(a){if(!t)if(s.w=0,s.h=0,"mouseenter"===a.type){if($(this).css("z-index","30001"),$(this).append('<div class="feedback-helper-inner" style="width:'+($(this).width()-2)+"px;height:"+($(this).height()-2)+'px;position:absolute;margin:1px;"></div>'),$(this).append('<button type="button" id="feedback-close" class="close ionicon ionicon-close"></button>'),$(this).find("#feedback-close").css({top:-1*($(this).find("#feedback-close").height()/2)+"px",left:$(this).width()-$(this).find("#feedback-close").width()/2+"px"}),"blackout"==$(this).attr("data-type")){r.clearRect(0,0,$("#feedback-canvas").width(),$("#feedback-canvas").height()),r.fillStyle="rgba(102,102,102,0.5)",r.fillRect(0,0,$("#feedback-canvas").width(),$("#feedback-canvas").height()),$(".feedback-helper").each(function(){"highlight"==$(this).attr("data-type")&&i(r,parseInt($(this).css("left"),10),parseInt($(this).css("top"),10),$(this).width(),$(this).height())}),$(".feedback-helper").each(function(){"highlight"==$(this).attr("data-type")&&r.clearRect(parseInt($(this).css("left"),10),parseInt($(this).css("top"),10),$(this).width(),$(this).height())}),r.clearRect(parseInt($(this).css("left"),10),parseInt($(this).css("top"),10),$(this).width(),$(this).height()),r.fillStyle="rgba(0,0,0,0.75)",r.fillRect(parseInt($(this).css("left"),10),parseInt($(this).css("top"),10),$(this).width(),$(this).height());var b=$(this).attr("data-time");$(".feedback-helper").each(function(){return $(this).attr("data-time")==b||void("blackout"==$(this).attr("data-type")&&(r.fillStyle="rgba(0,0,0,1)",r.fillRect(parseInt($(this).css("left"),10),parseInt($(this).css("top"),10),$(this).width(),$(this).height())))})}}else $(this).css("z-index","30000"),$(this).children().remove(),"blackout"==$(this).attr("data-type")&&h(r)}),$(document).on("click","#feedback-close",function(){if(k.canvas.highlightElement&&$(this).parent().attr("data-highlight-id"))var a=$(this).parent().attr("data-highlight-id");$(this).parent().remove(),k.canvas.highlightElement&&a&&$('[data-highlight-id="'+a+'"]').removeAttr("data-highlighted").removeAttr("data-highlight-id"),h(r)}),$("#feedback-module").on("click",".feedback-wizard-close,.feedback-close-btn",function(){g()}),$(document).on("keyup",function(a){a.keyCode==ionweb.KeyCodes.ESC&&g()}),$(document).on("selectstart dragstart","body",o),$(document).on("click","#feedback-highlighter-back",function(){n=!1,$("#feedback-canvas").css("cursor","default"),$("#feedback-helpers").hide(),$("#feedback-highlighter").hide(),$("#feedback-welcome-error").hide(),$("#feedback-welcome").show()}),$(document).on("mousedown",".feedback-sethighlight",function(){u=1,$(this).addClass("ionbtn-primary"),$(this).removeClass("ionbtn-secondary"),$(".feedback-setblackout").removeClass("ionbtn-primary"),$(".feedback-setblackout").addClass("ionbtn-secondary")}),$(document).on("mousedown",".feedback-setblackout",function(){u=0,$(this).addClass("ionbtn-primary"),$(this).removeClass("ionbtn-secondary"),$(".feedback-sethighlight").removeClass("ionbtn-primary"),$(".feedback-sethighlight").addClass("ionbtn-secondary")}),$(document).on("click","#feedback-highlighter-next",function(){n=!1,$("#feedback-canvas").css("cursor","default");var a=$(document).scrollTop(),b=$(window).height();$("#feedback-helpers").hide(),$("#feedback-highlighter").hide(),k.canvas.screenshotStroke||h(r,!1),html2canvas.render($("body"),{onrendered:function(d){k.canvas.screenshotStroke||h(r);var e=$('<canvas id="feedback-canvas-tmp" width="'+l+'" height="'+b+'"/>').hide().appendTo("body"),f=e.get(0).getContext("2d");f.drawImage(d,0,a,l,b,0,0,l,b),c=e.get(0).toDataURL(),$(document).scrollTop(a),v.img=c,k.onScreenshotTaken(v.img),k.showDescriptionModal?($("#feedback-canvas-tmp").remove(),k.extraConfig.collectUserDetails&&($("#feedback-overview-username").val(k.extraConfig.fullName),$("#feedback-overview-username").attr("placeholder",k.extraConfig.defaultFullName),$("#feedback-overview-email").val(k.extraConfig.email),$("#feedback-overview-email").attr("placeholder",k.extraConfig.defaultEmail),$("#feedback-overview-additionalInfo").val(k.extraConfig.personalInfo),$("#feedback-overview-additionalInfo").attr("placeholder",k.extraConfig.defaultPersonalInfo)),$("#feedback-overview").show(),$("#feedback-overview-screenshot>img").remove(),$("#feedback-overview-description").val($("#feedback-description").val()),$("#feedback-overview-screenshot").append('<img class="feedback-screenshot" src="'+c+'" />')):($("#feedback-module").remove(),g(),e.remove())},proxy:k.html2canvas.proxy,letterRendering:k.html2canvas.letterRendering})}),$(document).on("click","#feedback-overview-back",function(a){n=!0,$("#feedback-canvas").css("cursor","crosshair"),$("#feedback-overview").hide(),$("#feedback-helpers").show(),$("#feedback-highlighter").show(),$("#feedback-overview-error").hide()}),$(document).on("keyup","#feedback-description-tmp, #feedback-overview-description",function(a){var b;"feedback-description-tmp"===a.target.id?b=$("#feedback-description-tmp").val():(b=$("#feedback-overview-description").val(),$("#feedback-description-tmp").val(b)),$("#feedback-description").val(b)}),$(document).on("click","#feedback-submit",function(){n=!1;var d=!1;if(k.extraConfig.collectUserDetails){var e=$("#feedback-overview-email"),f=e.val();d=!!f&&!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(f),d?a(e,"Please enter a valid or empty E-Mail","auto bottom"):b(e)}e=$("#feedback-overview-description"),0===e.val().length?(d=!0,a(e,"Description cannot be empty","auto top")):b(e),d||($("#feedback-submit-success,#feedback-submit-error").remove(),$("#feedback-overview").hide(),v.img=c,v.description=$("#feedback-description").val(),k.extraConfig.collectUserDetails&&(v.fullName=$("#feedback-overview-username").val(),v.email=$("#feedback-overview-email").val(),v.additionalInfo=$("#feedback-overview-additionalInfo").val()),g(),k.onPostReady(v))})};return l&&k.visible&&($("body").append('<button type="button" class="ionbtn ionbtn-primary feedback-btn '+m+'">'+k.buttonText+"</button>"),$(document).on("click",".feedback-btn",p)),p}}(feedback||(feedback={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(a,b,c,d,e,f){this._isEnabled=!1,this._serverUserInfo={},this._server=a,this._notification=b,this._configuration=c,this._moduleService=d,this._logger=e.create("FeedbackService"),this.useLegacyFeedback=!1,this._environment=f}return Object.defineProperty(c.prototype,"isEnabled",{get:function(){return this._isEnabled},enumerable:!0,configurable:!0}),c.prototype.start=function(){var a=this;this._url=this._configuration.config.shell.userFeedbackUrl||c.DEFAULT_SEND_FEEDBACK_ENDPOINT,this._logger.low("Start",{url:this._url}),this.initFeedbackJs(),this._isEnabled=!0;var b=function(){a._environment.isOffline?$(".feedback-btn").attr("disabled","disabled"):$(".feedback-btn").removeAttr("disabled")};this._environment.isOfflineChanged.add(function(){return b()}),b()},c.prototype.performFeedback=function(){this._performFeedback&&this._performFeedback()},c.prototype.tryRetrieveUserInfo=function(){var a=this;this._server.getUserInfo().then(function(b){b&&(a._userFeedbackExtraConfig.email=b.CustomEmail,a._userFeedbackExtraConfig.fullName=b.CustomFullName,a._userFeedbackExtraConfig.personalInfo=b.CustomPersonalInfo,a._userFeedbackExtraConfig.defaultEmail=b.PlatformEmail||b.CustomEmail,a._userFeedbackExtraConfig.defaultFullName=b.PlatformFullName||b.CustomFullName,a._userFeedbackExtraConfig.defaultPersonalInfo=b.PlatformPersonalInfo||b.CustomPersonalInfo,a._logger.low("Retrieved User Info from server",{userInfo:b}))})},c.prototype.initFeedbackJs=function(){this._userFeedbackExtraConfig={collectUserDetails:!this.useLegacyFeedback},this._performFeedback=$.feedback({position:"bottom",buttonText:b.Strings.Text_Feedback,autoHide:this._configuration.config.shell.userFeedbackAutoHide!==!1,visible:this._configuration.config.shell.showUserFeedbackButton&&!this._environment.isTouchDevice()&&!this._configuration.config.shell.navBarBottomPosition,extraConfig:this._userFeedbackExtraConfig,onPostReady:this.processUserFeedback.bind(this),onPrepare:this.tryRetrieveUserInfo.bind(this)})},c.prototype.processUserFeedback=function(b){var c=this,d=b,e=new Date,f=e.toISOString();this._logger.low("SendingFeedback");var g={screenShot:d.img,description:d.description,userAgent:d.browser.userAgent,os:d.browser.platform,appName:this._configuration.config.shell.appName,appVersion:this._configuration.config.shell.appVersion,dateTime:f,url:window.location.href,userName:this._server.getUserName()};if(!this.useLegacyFeedback){var h=g;h.projectID=this._configuration.config.shell.userFeedbackProjectID||"",h.issueManagerKey=this._configuration.config.shell.userFeedbackIssueManagerKey||"",h.userDetails={fullName:d.fullName||this._serverUserInfo.PlatformFullName,emailAddress:d.email||this._serverUserInfo.PlatformEmail,userInfo:d.additionalInfo||this._serverUserInfo.PlatformPersonalInfo},h.platformDetails={platformHost:this._server.serverPlatformId.Host,platformPort:this._server.serverPlatformId.Port,trackerId:this._server.serverPlatformId.TrackerId,platformId:this._server.serverPlatformId.PlatformId},h.modulesDetails=this._moduleService.modules.map(function(a){return{key:a.name,name:a.displayName,version:a.version}}),this.tryUpdateServerUserInfo(d)}var i=JSON.stringify(g),j=a.server.AnalyticsService.calculateSecurityToken(),k=this._url+"?securityToken="+encodeURIComponent(j);this._server.post(k,{category:a.rest.OTHER_CATEGORY}).data(i,"application/json").forceJson().send().then(function(a){c._logger.low("Sent feedback",{userDetails:g.userDetails}),c.processResponse(a)}).catch(function(a){c.processError(a)})},c.prototype.tryUpdateServerUserInfo=function(b){var d=this,e=b.fullName!==this._serverUserInfo.CustomFullName||b.email!==this._serverUserInfo.CustomEmail||b.additionalInfo!==this._serverUserInfo.CustomPersonalInfo;if(e){var f={CustomFullName:b.fullName,CustomEmail:b.email,CustomPersonalInfo:b.additionalInfo},g=JSON.stringify(f);this._server.post(c.USER_INFO_UPDATE_ENDPOINT,{direct:!0,category:a.rest.SESSION_CATEGORY}).data(g,"application/json").forceJson().send().then(function(a){d._logger.low("Updated User Details on Server",f)},function(a){d._logger.low("Server does not support user details update")})}else this._logger.high("User info not modified, skipping server update call.")},c.prototype.processError=function(a){this._logger.low("SendingFeedbackComplete",{result:"ERROR",message:a.message}),this._notification.showError(b.Strings.Err_FeedbackFailed,a.message)},c.prototype.processResponse=function(a){var c=!0,d=null,e=null;a.data?(c=!!a.data.outcome&&"SUCCESS"===a.data.outcome,d=a.data.message||(c?b.Strings.Text_FeedbackSent:b.Strings.Err_FeedbackFailed),e=a.data.reason):(c=!1,d=b.Strings.Err_FeedbackFailed),this._logger.low("SendingFeedbackComplete",{success:c,hasData:!!a.data,primaryText:d,secondaryText:e}),c?this._notification.showInfo(d,e):this._notification.showError(d,e)},c.USER_INFO_UPDATE_ENDPOINT="r/userinfo/update",c.DEFAULT_SEND_FEEDBACK_ENDPOINT="https://online.iontrading.com/iod/feedback/upload/global",c}();b.FeedbackService=c,angular.module("ionwebShell").service("ionweb.feedbackService",["ionweb.serverService","ionweb.notificationService","ionweb.configurationService","ionweb.moduleService","ionweb.loggerFactory","ionweb.environmentService",function(a,b,d,e,f,g){return new c(a,b,d,e,f,g)}])}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){angular.module("ionwebShell").controller("ionweb.mainMenuController",["$scope","ionweb.catalogService","ionweb.configurationService","ionweb.actionService","ionweb.applicationStatusService","ionweb.feedbackService","ionweb.shellModuleLoader","ionweb.environmentService",function(a,b,d,e,f,g,h,i){return new c(a,b,d,e,f,g,h,i)}]);var c=function(){function c(a,b,c,d,e,f,g,h){var i=this;this.scope=a,this.catalogService=b,this.confService=c,this.actionsService=d,this.feedbackService=f,this.shellModuleLoader=g,this.environmentService=h,a.menuItems=[],a.navMenuOpen=!1,a.toggleNavMenu=function(){a.navMenuOpen=!a.navMenuOpen},e.waitForStartupConfiguration.then(function(){c.changed.add(function(){return i.refreshMenuItems()}),i.refreshMenuItems(),i.environmentService.fullscreenModeManager.fullScreenEvent.add(function(){return i.refreshMenuItems()})})}return c.prototype.getMenuSection=function(b,c){var d=a.firstOrDefault(b,function(a){return a.name===c});return d||(d={name:c,subItems:[]},b.push(d)),d},c.prototype.fromAction=function(a,b){var c=this;if(a&&!a.isHidden){var d={name:a.displayName,action:function(){a(),c.close()},isDisabled:a.isDisabled,icon:a.icon};if(a.isDisabledChanged){var e=function(){d.isDisabled=a.isDisabled};a.isDisabledChanged.add(e),d.dispose=function(){a.isDisabledChanged.remove(e)}}b(d)}},c.prototype.close=function(){this.scope.toggleNavMenu()},c.prototype.appendHelpLinks=function(a){var c=this,d=this.getMenuSection(a,b.Strings.Menu_Help),e=this.shellModuleLoader.getHelpLinks();e.forEach(function(a){a.links.forEach(function(a){var b={name:a.name,action:function(){window.open(a.href),c.close()}};d.subItems.push(b)})}),this.fromAction(this.actionsService.showAbout,function(a){return d.subItems.push(a)})},c.prototype.prependTopActions=function(a){this.fromAction(this.actionsService.save,function(b){return a.unshift(b)})},c.prototype.appendMiddleActions=function(a){this.fromAction(this.actionsService.fullScreen,function(b){return a.push(b)}),this.fromAction(this.actionsService.showPreference,function(b){return a.push(b)})},c.prototype.disposeItems=function(a){a&&a.forEach(function(a){a&&a.dispose&&a.dispose()})},c.prototype.updateMenuIconSpace=function(a,b){var c=this;if(a){var d=a.some(function(a){return!!a.icon});a.forEach(function(a){a.parentHaveIcon=!!b&&!!b.leaveIconSpace,a.leaveIconSpace=a.parentHaveIcon||d,a.subItems&&c.updateMenuIconSpace(a.subItems,a)})}},c.prototype.toMenuItems=function(a){var b=this;return a.map(function(a){return{name:a.name,action:function(){a.compTypeId&&(b.catalogService.navigateToComponent(b.catalogService.findComponentType(a.compTypeId)),b.close())},icon:a.icon,subItems:a.subItems&&b.toMenuItems(a.subItems)}})},c.prototype.refreshMenuItems=function(){var a=this.confService.config.shell;if(a.enableMainMenu!==!1){var b;b=a.enableComponentCreationMenu!==!1?this.toMenuItems(this.catalogService.getComponentMenu()):[],b=b.sort(function(a,b){return a.name.localeCompare(b.name)}),this.prependTopActions(b),this.appendMiddleActions(b),this.appendHelpLinks(b),this.updateMenuIconSpace(b),this.disposeItems(this.scope.menuItems),this.scope.menuItems=b}},c}();angular.module("ionwebShell").directive("ionMainMenuNode",[function(){return{scope:{item:"=",isExpanded:"=?",canExpand:"=?",toggleExpand:"=?"},replace:!0,templateUrl:"shell.ui/nav-menu.tpl.html",link:function(a,b){a.canExpand=a.item.subItems&&a.item.subItems.length>0,a.toggleExpand=function(){a.canExpand&&(a.isExpanded=!a.isExpanded)}}}}])}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){function b(b,c){b=b.locale(c.currentSdkCulture);var d=a.localization.moment().diff(b,"minutes");return d<45?b.fromNow():b.calendar()}a.timestampToString=b,angular.module("ionwebShell").directive("ionwebShellAutofocus",["$timeout",function(a){return{restrict:"A",link:function(b,c){a(function(){c[0].focus()},0)}}}])}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(){var b=g.config.shell.branding||{};(d.isEnabled||b.useBrandingLogoForMainMenu||b.showBrandingLogoInMainMenu)&&(c.useBrandingLogoForMainMenu=b.useBrandingLogoForMainMenu,c.showBrandingLogoInMainMenu=b.showBrandingLogoInMainMenu,g.config.shell.mainToolbarBrandingLogoUrl?(c.brandingLogo=!0,c.logoUrl=a.clientRoot+g.config.shell.mainToolbarBrandingLogoUrl):g.config.shell.primaryBrandingLogoUrl?(c.brandingLogo=!0,c.logoUrl=a.clientRoot+g.config.shell.primaryBrandingLogoUrl):(c.brandingLogo=!1,c.logoUrl="assets/images/ionBrandLogo.tpl.svg"))}function u(){h.getServerVersion().then(function(b){b&&b.compareTo(a.IonVersion.fromIonString("121"))>=0?c.enableChangePassword=!0:c.enableChangePassword=!1})}var v=this;this.helpMenu=null;var w=function(a){v.lastInformation=a,c.$evalAsync(function(){c.saveStateInformation=v.lastInformation})},x=function(){return v.savedTime?a.stringFormat(b.Strings.Text_Dashboard_SavedOn,{when:a.timestampToString(v.savedTime,r)}):""};c.hideAddWidgetButton=g.config.shell.dashboardModeConfig&&g.config.shell.dashboardModeConfig.disableAddWidgetDialog,c.popupOptions={};var y=[],z=function(){return c.activeDashboard=d.activeDashboard};y.push(d.activeDashboardChanged.add(function(){z()})),z(),y.push(d.savedStateChanged.add(function(d,e){e===a.SaveStatusChangedReason.Saving?(clearTimeout(v.savedInformationTimer),c.$evalAsync(function(){c.saveStateInformation=b.Strings.Text_Dashboard_Saving})):e!==a.SaveStatusChangedReason.Canceled&&e!==a.SaveStatusChangedReason.Saved||(clearTimeout(v.savedInformationTimer),e===a.SaveStatusChangedReason.Saved&&(v.savedTime=a.localization.moment()),w(x()),v.savedInformationTimer=setInterval(function(){w(x())},1e4))})),c.isTouchDevice=k.isTouchDevice(),c.toolbarItems=f.items;var A=function(){c.toolbarHasItemsOnLeft=!1,c.toolbarHasItemsOnRight=!1,f.items.forEach(function(b){b.placement===a.ToolbarItemPlacement.Left&&(c.toolbarHasItemsOnLeft=!0),b.placement===a.ToolbarItemPlacement.Right&&(c.toolbarHasItemsOnRight=!0)})};A(),y.push(f.itemsUpdate.add(A)),c.dashOpts=d.scopeOpts,c.disableDashboardRename=g.config.shell.dashboardModeConfig&&g.config.shell.dashboardModeConfig.disableDashboardRename,d.installKeyHandlers(e,c);var B=function(){var a=n.ionNetBridge&&(d.inSingleDashboardMode||q.inSingleComponentMode);c.navBarEnabled=!g.config.shell.disableNavBar&&!a,c.useToolbarFlexLayout=!d.isEnabled&&k.isSmallScreen()},C=function(){c.showOptionButton=d.isEnabled||q.inSingleComponentMode,c.showHomeButton=d.isEnabled,c.showNewTabButton=d.isEnabled&&!d.inSingleDashboardMode&&d.persistenceService.canCreateDashboard,n.ionNetBridge&&n.ionNetBridge.shell.showOptionsMenu(c.showOptionButton).then(function(a){c.$evalAsync(function(){c.hideOptionButton=a})}).done()};C(),y.push(d.isEnabledChanged.add(function(){C(),B()})),y.push(q.inSingleComponentModeChanged.add(function(){C(),B()}));var D=function(){h.getUserInfo().then(function(a){c.$evalAsync(function(){c.userName=a&&a.CustomFullName||a&&a.PlatformFullName||h.getBareUserName()})})};y.push(h.statusChanged.add(function(a,b){b&&b.isAuthenticated&&D()})),h.isLoggedIn()&&D(),c.logoutClicked=function(){i.logout()},c.feedbackClicked=function(){c.popupOptions.isUserPopupVisible=!1,l.performFeedback()},c.setIsHover=function(a){a.defaultPrevented||(c.dashOpts.hoverId="")},c.densitySelectorConfig={showAnchorPointArrow:!0,showHeader:!0},c.changePassword=function(){c.popupOptions.isUserPopupVisible=!1;var d={templateUrl:"login.ui/changePwd.tpl.html",canClose:!1,size:a.DialogSize.Auto,title:b.Strings.Title_Change_Password};o.show(d)},c.userNavIconClicked=function(){c.popupOptions.isUserPopupVisible=!c.popupOptions.isUserPopupVisible};var E=function(){c.hideDashboardTabs=d.hideTabsInToolbar||g.config.shell.disableDashboardTabs},F=function(){var a=g.config.shell;c.enableMainMenu=a.enableMainMenu!==!1&&!a.hideMainMenu,c.hideSavingInformation=a.hideSavingInformation,c.hideStatusInformation=a.hideStatusInformation,c.showNavBarDensitySelector=a.showNavBarDensitySelector;var b=a.mainToolbarLogoPlacement;c.logoPositionRight=b&&"right"===b.toLocaleLowerCase(),c.isNavBottom=a.navBarBottomPosition,c.enableFeedbackButton=a.enableUserFeedback!==!1,c.enableSignoutButton=!a.externalAuthentication&&!n.ionNetBridge,B(),E(),t()};F(),y.push(d.hideTabsInToolbarChanged.add(function(){c.$evalAsync(function(){return E()})})),y.push(g.changed.add(function(){c.$evalAsync(function(){return F()})})),$(window).bind("resize",function(){c.$evalAsync(function(){return c.windowHeight=window.innerHeight})}),c.isMobileNativeShell=!!n.ionMobileBridge,c.reload=function(){window.location.reload()},c.offlineOpts=m.options,c.openOTPDialog=function(){c.popupOptions.isUserPopupVisible=!1;var d={canClose:!1,templateUrl:"login.ui/otp.tpl.html",size:a.DialogSize.Small,severity:a.DialogSeverity.Warning,title:b.Strings.Title_OTP_Required};o.show(d)},n.ionNetBridge&&(c.hideConnectionServices=!0),c.$on("$destroy",function(){d.uninstallKeyHandlers(e,c),y.forEach(function(a){return a()}),y=[]}),c.enableChangePassword=!1,p.wasLoggedInIdp||g.config.shell.disableOnDemandChangePassword||(h.userActionSupported.changePassword&&c.$evalAsync(function(){return u()}),h.supportedUserActionChanged.add(function(a,b){b.changePassword?c.$evalAsync(function(){return u()}):c.enableChangePassword=!1})),a.rest.start(s)}return c}();angular.module("ionwebShell").controller("ionweb.mainViewController",["$scope","ionweb.dashboardService","$window","ionweb.toolbarService","ionweb.configurationService","ionweb.serverService","ionweb.actionService","ionweb.contextMenuService","ionweb.environmentService","ionweb.feedbackService","ionweb.connectionManager","ionweb.embeddingService","ionweb.dialogService","ionweb.idpService","ionweb.rootComponentService","ionweb.languageService","ionweb.statService",c])}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){angular.module("ionwebShell").directive("widgetNavigationBar",[function(){return{restrict:"EA",templateUrl:"shell.ui/dashboard/widgetNavigationBar.tpl.html",scope:{options:"="}}}])}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(b){b.options.compData&&b.options.compData.compName&&b.options.compData.moduleName?b.details=a.stringFormat(a.shell.Strings.Text_Dashboard_Placeholder_Details,{compName:b.options.compData.compName,moduleName:b.options.compData.moduleName}):b.details=b.options.compData.compType}return b}();angular.module("ionwebShell").controller("ionweb.PlaceholderController",["$scope",function(a){return new c(a)}])}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){angular.module("ionwebShell").directive("ionTabDropHandler",[function(){return{scope:{options:"=",active:"="},templateUrl:"shell.ui/dashboard/tabDropHandlerDirective.tpl.html",link:function(a,b){a.onDragEnter=function(b,c){return!(!b.getData||!b.getData(a.options.dndDataId))&&(c?a.isDraggingOverAfter=!0:a.isDraggingOverBefore=!0,!0)},a.options.onDrop=function(b,c){a.isDraggingOverAfter=a.isDraggingOverBefore=!1;var d=b.getData(a.options.dndDataId);return d&&a.options.drop&&a.options.drop(d,c)}}}}])}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(a,d,e){var f=this;this.$scope=a,this.dialogService=d,this.dashboardService=e,this.getComponent()&&(this.getComponent().isContainer=!0,this.getComponent().preserveChildState=function(a){for(var c=function(a){return a.parent==f.getComponent()&&b.DashboardDescriptor.isSidePanelCompId(a.id)};a;){if(c(a))return!0;a=a.parent}return!1},a.dashboard.state&&this.getComponent().setState(a.dashboard.state)),a.onDashboardBound=function(b){f.dashboard=b,a.dashboard.directiveScope=b.$scope,f.dashboard.state=f.getComponent()&&f.getComponent().getValue(c.STATE_PROP);var d=function(){f.getComponent()&&f.getComponent().setValue(c.STATE_PROP,f.dashboard.state)};f.unsub=f.dashboard.onLayoutStateChanged.add(function(){return d()}),a.dashboard.customController&&"string"==typeof a.dashboard.customController&&d()},a.$on("$destroy",function(){f.unsub()}),a.dashboard.createNewWidget=function(a){f.$scope.dashboard.inEditLayoutMode=!0,a?f.dashboardService.openWidgets(f.$scope.dashboard,[a.id]).done():f.$scope.dashOpts.showWidgetSelector(f.$scope.dashboard)},a.dashboard.init(a),a.$watch("dashboard.title.caption",function(b,c){b!==c&&a.dashboard.updateState().done()}),a.dashboard.state&&this.getComponent()&&this.getComponent().setState(a.dashboard.state),a.loadState=function(b,d){if(b){if(f.dashboard){f.dashboard.clear();var e=f.getComponent();e&&(a.$evalAsync(function(){return a.dashboard&&a.dashboard.clearSidePanels()}),e.setState(b),f.dashboard.state=e.getValue(c.STATE_PROP),f.dashboard.setComponentHighlight(d))}e.dirty=!1}}}return c.prototype.getComponent=function(){return this.$scope.dashboard.compId===a.NoComponentId?null:this.$scope.component;
},c.getOrCreateComponentState=function(a){if(a){var b=a.properties||(a.properties={}),d=b[c.STATE_PROP]||(b[c.STATE_PROP]={});return d}return null},c.STATE_PROP="layout",c}();b.DashboardController=c,angular.module("ionwebShell").controller("ionweb.DashboardController",["$scope","ionweb.dialogService","ionweb.dashboardService",function(a,b,d){return new c(a,b,d)}])}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){function c(a){var b,c=0,e=function(){function e(){c=+new Date,a()}var f=+new Date-c;b&&clearTimeout(b),f>d&&(c=+new Date,f=0),b=setTimeout(e,d-f)};return e.cancel=function(){b&&clearTimeout(b)},e}var d=2400,e=function(){function d(d,e,f,g,h){var i=this;this.dashboardService=d,this.dialogService=e,this.state=f,this.componentsChanged=new a.Event,this._isProtected=!1,this._inEditLayoutMode=!1,this.unsub=[],this._activeComponentChanged=new a.Event,this._editModeChanged=new a.Event,this._closed=new a.Event,this._idChanged=new a.Event,this._editLayoutModeChanged=new a.Event,this._displayNameChanged=new a.Event,this._categoryChanged=new a.Event,this.layoutChanged=new a.Event,this.tempLayoutOpts=b.DEFAULT_DASHBOARD_LAYOUT_OPTS,this._canClose=!0,this.readyDeferred=Q.defer(),this.saved=new a.Event,this.lockObj=Q.when(null),this.collapsiblePanelTemplateUrl="shell.ui/dashboard/dashboardCollapsiblePanel.tpl.html",this.reloaded=new a.Event,this.activeChanged=new a.Event,this.startInEdit=h.forceEdit,this.showHeaders=!0,this.collapsiblePanelConfigs={},this.collapsiblePanelConfigs.left={orientation:"horizontal",collapsedOrientation:"vertical",boundingContainerClass:".dashboard-app-contr",minSize:0,maxSize:50,onBind:function(a){i.leftCollapsibleTabPanel=a,i.leftCollapsibleTabPanel.destroyed.add(function(){i.leftCollapsibleTabPanel=null})}},this.collapsiblePanelConfigs.right={orientation:"horizontal-inverse",collapsedOrientation:"vertical",boundingContainerClass:".dashboard-app-contr",minSize:0,maxSize:50,onBind:function(a){i.rightCollapsibleTabPanel=a,i.rightCollapsibleTabPanel.destroyed.add(function(){i.rightCollapsibleTabPanel=null})}},this.collapsiblePanelConfigs.top={orientation:"vertical",collapsedOrientation:"horizontal",boundingContainerClass:".dashboard-app-contr",minSize:0,maxSize:50,onBind:function(a){i.topCollapsibleTabPanel=a,i.topCollapsibleTabPanel.destroyed.add(function(){i.topCollapsibleTabPanel=null})}},this.collapsiblePanelConfigs.bottom={orientation:"vertical-inverse",collapsedOrientation:"horizontal",boundingContainerClass:".dashboard-app-contr",minSize:0,maxSize:50,onBind:function(a){i.bottomCollapsibleTabPanel=a,i.bottomCollapsibleTabPanel.destroyed.add(function(){i.bottomCollapsibleTabPanel=null})}},this.throttledSave=c(function(){i.dashboardService.notifySavedState(a.SaveStatusChangedReason.Saving),i.logger.low("throttledSave"),i.data&&i.data.setState(i.state).then(function(b){b.result?(i.resetDirty(),b.notSaved?i.dashboardService.notifySavedState(a.SaveStatusChangedReason.Canceled):(i.traceAnalytics("Autosave",null),i.dashboardService.notifySavedState(a.SaveStatusChangedReason.Saved),i.saved.raise(i,null))):i.manageSaveError(b,function(a){return i.saveImmediate(a)})}).finally(function(){i.dashboardService.notifySavedState(a.SaveStatusChangedReason.Canceled)}).done()}),this.title={caption:null,showEdit:b.EditMode.OnContextMenu,contextMenu:function(){return b.DashboardsScopeOptions.getDashboardContextMenu(i,i.dashboardService)},isDraggable:!0,dndDataId:"dashboardId",dragStart:function(a){return i.id},drop:function(a,b){i.dashboardService.reorder(a,i.id,b)}},this.updateDescriptor(g||h.id,!1,!1,!1);var j=b.DashboardController.getOrCreateComponentState(this.state);if("undefined"==typeof h.overrideController)this.customController=j&&j.customController||g&&g.definedCustomController||function(){};else if(this.customController=h.overrideController||function(){},"string"==typeof h.overrideController){if(!j)throw new Error("Cannot save custom controller for dashboards with no state");j.customController=h.overrideController}else delete j.customController;h.isSelector&&(this.showSelector=!0,this.inDashboardSelectMode=!0,this.userInteractionDisabled=!0)}return d.prototype.createComponent=function(a,b,c){return this._createComponent(a,!0,b,c)},Object.defineProperty(d.prototype,"customControllerFun",{get:function(){return"string"==typeof this.customController?a.angularExt.controllers[this.customController]:this.customController},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"canClose",{get:function(){return this._canClose&&this.dashboardService.canCloseDashboards},set:function(a){this._canClose=a},enumerable:!0,configurable:!0}),d.prototype.lock=function(){var a=Q.defer();return this.lockObj=a.promise,function(){a.resolve(null)}},Object.defineProperty(d.prototype,"sidePanelTemplateUrl",{get:function(){return this._sidePanelTemplateUrl},set:function(b){this._sidePanelTemplateUrl!==b&&(this._sidePanelTemplateUrl=b,this.logSidePanelTemplateUrlChanged(a.PanelSide.Left,b))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"rightPanelTemplateUrl",{get:function(){return this._rightPanelTemplateUrl},set:function(b){this._rightPanelTemplateUrl!==b&&(this._rightPanelTemplateUrl=b,this.logSidePanelTemplateUrlChanged(a.PanelSide.Right,b))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"topPanelTemplateUrl",{get:function(){return this._topPanelTemplateUrl},set:function(b){this._topPanelTemplateUrl!==b&&(this._topPanelTemplateUrl=b,this.logSidePanelTemplateUrlChanged(a.PanelSide.Top,b))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"bottomPanelTemplateUrl",{get:function(){return this._bottomPanelTemplateUrl},set:function(b){this._bottomPanelTemplateUrl!==b&&(this._bottomPanelTemplateUrl=b,this.logSidePanelTemplateUrlChanged(a.PanelSide.Bottom,b))},enumerable:!0,configurable:!0}),d.prototype.logSidePanelTemplateUrlChanged=function(b,c){c?this.logger.low("tabBasedSidePanelNotAvailable",{dashboardName:this.data&&this.data.getName()||"",panel:a.PanelSide[b],reason:"Side panel template URL changed."}):this.logger.low("tabBasedSidePanelInUse",{dashboardName:this.data&&this.data.getName()||"",panel:a.PanelSide[b],reason:"Tab based side panel template URL restored."})},d.prototype.setReady=function(){this.readyDeferred.resolve(null)},Object.defineProperty(d.prototype,"initialized",{get:function(){return this.readyDeferred.promise},enumerable:!0,configurable:!0}),d.prototype.updateCaption=function(b){b=b||this.data&&this.data.getName(),this.title.caption=b,this.title.description=a.stringFormat(this.cannotWrite?a.shell.Strings.Text_ReadOnlyDashboard_Tooltip:"${name}",{name:b})},d.prototype.updateDescriptor=function(c,d,e,f){var g=this,h=this.id,i=this.displayName,j=this.category;"string"==typeof c?this._id=c:this.data=c,this.logger=this.dashboardService.loggerFactory.create("Dashboard_"+this.id),this.title.startInEdit=f,this.updateCaption(),this.dataChangedUnsub&&this.dataChangedUnsub(),this.dataChangedUnsub=this.data&&this.data.changed.add(function(a,b){g.manageExternalUpdates(b)}),this.updateTabButtons(function(){g.updateProtected()}),d&&this.save(),e&&this.dashboardService.updateListState(),this.id!==h&&this._idChanged.raise(this,{newId:this.id,oldId:h}),this.displayName!==i&&this._displayNameChanged.raise(this,{newValue:this.displayName,oldValue:i}),this.category!==j&&this._categoryChanged.raise(this,{newValue:this.category,oldValue:j}),b.isInternalDashboard(this.id)||this.dashboardService.persistenceService.updateLastAccessTime(this.id,a.localization.moment(),!0)},Object.defineProperty(d.prototype,"activeComponent",{get:function(){return this._activeComponent},set:function(a){if(a&&!a.canBeActive)throw Error("Specified component does not supports active state");this._activeComponent!==a&&(this._activeComponent=a,this._activeComponentChanged.raise(this,null),a&&this.dashboardService.bringToFront(a))},enumerable:!0,configurable:!0}),d.prototype.bringToFront=function(a){a&&this.dashboardService.bringToFront(a)},Object.defineProperty(d.prototype,"activeComponentChanged",{get:function(){return this._activeComponentChanged},enumerable:!0,configurable:!0}),d.prototype.addSidePanelTab=function(b,c){var d=this,e={remove:function(){d.logSidePanelTabNotRemoved(c)},removed:new a.Event};switch(c){case a.PanelSide.Left:this.leftCollapsibleTabPanel?e=this.leftCollapsibleTabPanel.addTab(b):this.logSidePanelTabNotAdded(c);break;case a.PanelSide.Right:this.rightCollapsibleTabPanel?e=this.rightCollapsibleTabPanel.addTab(b):this.logSidePanelTabNotAdded(c);break;case a.PanelSide.Top:this.topCollapsibleTabPanel?e=this.topCollapsibleTabPanel.addTab(b):this.logSidePanelTabNotAdded(c);break;case a.PanelSide.Bottom:this.bottomCollapsibleTabPanel?e=this.bottomCollapsibleTabPanel.addTab(b):this.logSidePanelTabNotAdded(c);break;default:this.logSidePanelTabNotAdded(c)}return e},d.prototype.logSidePanelTabNotAdded=function(b){var c;c=a.PanelSide[b]?{dashboardName:this.data&&this.data.getName()||"",panel:a.PanelSide[b],reason:"Tab based side panel not available."}:{dashboardName:this.data&&this.data.getName()||"",panel:b,reason:"Invalid dashboard side panel specified while adding the tab."},this.logger.low("sidePanelTabNotAdded",c)},d.prototype.logSidePanelTabNotRemoved=function(b){var c;c=a.PanelSide[b]?{dashboardName:this.data&&this.data.getName()||"",panel:a.PanelSide[b],reason:"Tab based side panel was not available while adding the tab."}:{dashboardName:this.data&&this.data.getName()||"",panel:b,reason:"Invalid dashboard side panel specified while adding the tab."},this.logger.low("sidePanelTabNotRemoved",c)},d.prototype.dispose=function(){var a=this;return this.lockObj.then(function(){a.unsub.forEach(function(a){return a()}),a.unsub=[],a.dataChangedUnsub&&a.dataChangedUnsub(),a.data&&a.data.dispose(),a.lastTooltipDlgScope&&(a.lastTooltipDlgScope.$destroy(),a.lastTooltipDlgScope=null),a.throttledSave.cancel(),a.isClosed=!0,a._closed.raise(a,null)})},Object.defineProperty(d.prototype,"closed",{get:function(){return this._closed},enumerable:!0,configurable:!0}),d.prototype.manageSaveError=function(c,d){c.error&&c.error.storageErrorType===a.StorageErrorTypes.USER_NOT_AUTHORIZED?this.dashboardService.notificationService.showInfo(a.stringFormat(a.shell.Strings.Err_Dashboard_Save_Unauthorized,{name:this.title.caption})):c.error&&c.error.storageErrorType===a.StorageErrorTypes.VERSION_MISMATCH_LOCKING_EXCEPTION?this.manageConflict(c.error.affectedStoreMetadata&&c.error.affectedStoreMetadata.version,d):this.dashboardService.notificationService.showError(a.stringFormat(a.shell.Strings.Err_Dashboard_Save_Generic,{name:this.title.caption,err:b.SerializableDashboard.toErrStr(c.error)}))},d.prototype.updateProtected=function(){this.isProtected=this.supportProtected&&!this.inEditMode},Object.defineProperty(d.prototype,"supportProtected",{get:function(){return this.data&&this.data.isShared&&!this.cannotWrite},enumerable:!0,configurable:!0}),d.prototype.createTooltipScope=function(){this.lastTooltipDlgScope&&this.lastTooltipDlgScope.$destroy();var a=this.dashboardService.$rootScope;return this.lastTooltipDlgScope=a.$new(!0),this.lastTooltipDlgScope},d.prototype.getCurrentState=function(){return this.parentComponent.getState()},Object.defineProperty(d.prototype,"compProps",{get:function(){return this.parentComponent},enumerable:!0,configurable:!0}),d.prototype.doProtectedSwitch=function(){var b=this;if(!this.editSwitchButtonDisabled){var c=function(){b.updateTabButtons(function(){b.inEditMode=!b.inEditMode,b.updateProtected()})};!this.inEditMode&&this.isDirty?(this.editSwitchButtonDisabled=!0,this.data.shouldSetState(this.getCurrentState()).then(function(d){b.dashboardService.$rootScope.$evalAsync(function(){if(b.editSwitchButtonDisabled=!1,d){var e=b.createTooltipScope();e.overwrite=function(){c()},e.revert=function(){b.reload("revert").then(function(){return c()}).done()},e.clone=function(){b.clone().done()},b.editSwitchButton.tooltip={contentTemplateUrl:"shell.ui/dashboard/localChangesWarn.tpl.html",showImmediately:!0,severity:a.DialogSeverity.Info,scope:e}}else c()})}).done()):c()}},d.prototype.isLocal=function(){return this.data?this.data.isLocal:b.isInternalDashboard(this.id)},d.prototype.updateTabButtons=function(b){var c=this;if(!this.inUpdateButtons){this.inUpdateButtons=!0,this.editSwitchButtonDisabled=!1;try{b&&b(),this.title.buttons=[],this.canClose&&this.title.buttons.push({icon:"close",classes:["ion-close-btn"],description:a.shell.Strings.Text_Dashboard_CloseDashboard,action:function(){return c._close(!0,"button").done()}}),this.active&&!this.isLocal()&&(this.cannotWrite?this.dashboardService.persistenceService.canCreateDashboard&&this.title.buttons.unshift(this.editSwitchButton={icon:"show",classes:["icon-larger"],description:a.shell.Strings.Text_Dashboard_CannotWrite_Ro_Tooltip1,action:function(){var a=c.createTooltipScope();a.clone=function(){c.clone().done()},c.editSwitchButton.tooltip={contentTemplateUrl:"shell.ui/dashboard/readOnlyTooltip.tpl.html",showImmediately:!0,scope:a}}}):this.supportProtected?this.title.buttons.unshift(this.editSwitchButton={icon:"usersEditor",classes:this.inEditMode?["icon-larger","in-edit"]:["icon-larger"],description:this.inEditMode?a.shell.Strings.Text_Dashboard_NotProtectedModeTooltip:a.shell.Strings.Text_Dashboard_ProtectedModeTooltip,action:function(){return c.doProtectedSwitch()}}):this.title.buttons.unshift({icon:"userEditor",classes:this.inEditMode?["icon-larger","in-edit"]:["icon-larger"],description:this.inEditMode?a.shell.Strings.Text_Dashboard_EditModeTooltip:a.shell.Strings.Text_Dashboard_NotEditModeTooltip,action:function(){c.inEditMode=!c.inEditMode}})),this.canUpdate&&this.title.buttons.unshift({icon:"refresh",classes:this.inEditMode?["icon-larger","in-edit"]:["icon-larger"],description:a.shell.Strings.Text_Dashboard_UpdateExternally,action:function(){return c.reload("update").done()}});var d=this.dashboardService.environmentService.isOffline;this.title.enabled=this.inEditMode&&!(this.data&&this.data.isReadOnly)&&!d}finally{this.inUpdateButtons=!1}}},d.prototype.close=function(){if(!this.createdByCode)throw new Error("Cannot close a dashboard not directly created via openDashboard or openDashboardClone");this._close(!1,"api").done()},d.prototype.closeHideHome=function(){return this._close(!1,"home",!0)},d.prototype._close=function(b,c,d){var e=this;if(this.logger.low("close",{reason:c,hideHome:d}),this.isClosed)return Q.when(null);var f=function(){var a=Q.defer();return e.controllerScope.$evalAsync(function(){try{a.resolve(e.dashboardService.removeDashboardDescr(e,"Close")),0!==e.dashboardService.dashboardList.length||d||e.dashboardService.scopeOpts.showHome()}catch(b){a.reject(b)}}),a.promise},g=this.dashboardService.isDirty(this.id),h=this.canUpdate;return g&&h&&b?Q.when(this.dialogService.showQuestionDialog({severity:a.DialogSeverity.Warning,textContent:a.shell.Strings.Text_Dashboard_Warn_Unsaved_Close}).closed.then(function(a){if(0===a.value)return e.isClosed=!0,f()})).then(function(){return null}):g&&!h?(this.isClosed=!0,this.saveImmediate("closing").then(function(){return f()})):(this.isClosed=!0,f())},d.prototype.clearSidePanels=function(){this.leftCollapsibleTabPanel&&this.leftCollapsibleTabPanel.removeAllTabs(),this.rightCollapsibleTabPanel&&this.rightCollapsibleTabPanel.removeAllTabs(),this.topCollapsibleTabPanel&&this.topCollapsibleTabPanel.removeAllTabs(),this.bottomCollapsibleTabPanel&&this.bottomCollapsibleTabPanel.removeAllTabs(),this.sidePanelTemplateUrl=this.rightPanelTemplateUrl=this.topPanelTemplateUrl=this.bottomPanelTemplateUrl=null},d.prototype.reloadDash=function(a){var b=this;this.controllerScope&&(this.controllerScope.loadState(this.state),this.controllerScope.$evalAsync(function(){b.reloaded.raise(b,null),a()}))},d.prototype.reload=function(a){var b=this;return this.lockObj.then(function(){var c=b.lock();return b.components.forEach(function(a){return a.isMaximized&&a.isMaximized()&&a.restore&&a.restore()}),b.logger.low("reload",{reason:a}),b.data.getState(!0,!0).then(function(a){b.state=a,b.reloadDash(function(){b.canUpdate=!1,b.updateCaption(),b.updateTabButtons(),b.disconnected=!1})}).finally(function(){c()})})},d.prototype.overwrite=function(a){var b=this;return this.logger.low("Overwrite"),this.data.getState(!0,!1).then(function(){return a("overwrite").then(function(){b.controllerScope.$evalAsync(function(){b.canUpdate=!1,b.updateTabButtons()})})})},Object.defineProperty(d.prototype,"compId",{get:function(){return this.inDashboardSelectMode?a.NoComponentId:this.id},enumerable:!0,configurable:!0}),d.isSidePanelCompId=function(a){return a===d.SidePanelCompId||a===d.TopPanelCompId||a===d.RightPanelCompId||a===d.BottomPanelCompId},Object.defineProperty(d.prototype,"sidePanelCompId",{get:function(){return this.inDashboardSelectMode?a.NoComponentId:d.SidePanelCompId},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"rightPanelCompId",{get:function(){return this.inDashboardSelectMode?a.NoComponentId:d.RightPanelCompId},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"topPanelCompId",{get:function(){return this.inDashboardSelectMode?a.NoComponentId:d.TopPanelCompId},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"bottomPanelCompId",{get:function(){return this.inDashboardSelectMode?a.NoComponentId:d.BottomPanelCompId},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"id",{get:function(){return this.data&&this.data.id||this._id},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"idChanged",{get:function(){return this._idChanged},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"displayNameChanged",{get:function(){return this._displayNameChanged},enumerable:!0,configurable:!0}),d.prototype.setDisplayName=function(a){return this.rename(a,!0)},Object.defineProperty(d.prototype,"categoryChanged",{get:function(){return this._categoryChanged},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"isReadOnly",{get:function(){return this.cannotWrite||this.isProtected},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"cannotWrite",{get:function(){return this.data&&this.data.isReadOnly},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"isDirty",{get:function(){return this.parentComponent&&this.parentComponent.dirty},enumerable:!0,configurable:!0}),d.prototype.resetDirty=function(){this.parentComponent&&(this.parentComponent.dirty=!1)},Object.defineProperty(d.prototype,"isProtected",{get:function(){return this._isProtected},set:function(a){this._isProtected!==a&&(this.logger.low("isProtectedChanged",{value:a}),this._isProtected=a,this._isProtected||this.isDirty&&this.save(),this.updateTabButtons())},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"active",{get:function(){return this._active},set:function(a){this._active!=a&&(this.logger.low("activeChanged",{value:a}),this._active=a,this.updateTabButtons(),this.activeChanged.raise(this,null))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"editMode",{get:function(){return this.inEditMode},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"editModeChanged",{get:function(){return this._editModeChanged},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"editLayoutModeChanged",{get:function(){return this._editLayoutModeChanged},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"editLayoutState",{get:function(){var a=this.userPreferenceProvider.getValue("editLayoutState",null);return null===a&&(a=this.editLayoutState=!this.data||!this.data.isReadOnly&&!this.data.isShared),a},set:function(a){this.userPreferenceProvider.setValue("editLayoutState",a)},enumerable:!0,configurable:!0}),d.prototype.fetchEditMode=function(){return this.userPreferenceProvider.getValue("inEditMode",!1)},d.prototype.setEditMode=function(a){this._inEditMode=a,this.userPreferenceProvider.setValue("inEditMode",a)},Object.defineProperty(d.prototype,"inEditMode",{get:function(){return this._inEditMode},set:function(a){this._inEditMode===a||this.editModeSwitchDisabled||(this.traceAnalytics(a?"Edit-ON":"Edit-OFF",null),this.setEditMode(a),a?this.editLayoutState&&!this.inEditLayoutMode&&this.setInEditLayoutMode(!0,!1):(this.editLayoutState=this.inEditLayoutMode,this.setInEditLayoutMode(!1,!1)),this.updateProtected(),this.updateTabButtons(),this._editModeChanged.raise(this,null))},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"inEditLayoutMode",{get:function(){return this._inEditLayoutMode},set:function(a){this.setInEditLayoutMode(a,!0)},enumerable:!0,configurable:!0}),d.prototype.setInEditLayoutMode=function(a,b){this._inEditLayoutMode!=a&&(this.traceAnalytics(a?"EditLayout-ON":"EditLayout-OFF",null),this._inEditLayoutMode=a,b&&(this.editLayoutState=a,a&&(this.inEditMode=!0)),this.updateProtected(),this.updateTabButtons(),this._editLayoutModeChanged.raise(this,null))},Object.defineProperty(d.prototype,"displayName",{get:function(){return this.data&&this.data.getName()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"category",{get:function(){return this.data&&this.data.category},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"path",{get:function(){if(!this.data||!this.data.path)return null;var a=this.data.path.path.slice();return a.push(this.displayName),{path:a,shared:this.data.isShared}},enumerable:!0,configurable:!0}),d.prototype.init=function(a){var b=this;this.controllerScope=a,this.parentComponent=a.component,this.unsub.push(this.parentComponent.childAdded.add(function(a){b.componentsChanged.raise(b,null)})),this.unsub.push(this.parentComponent.childRemoved.add(function(a){b.componentsChanged.raise(b,null)})),this.unsub.push(this.parentComponent.dirtySet.add(function(){b.save()})),this.resetDirty(),this.unsub.push(this.dashboardService.environmentService.isOfflineChanged.add(function(a,c){b.controllerScope.$evalAsync(function(){b.updateTabButtons()})})),this.startInEdit||this.dashboardService.inSingleDashboardMode||this.fetchEditMode()&&!this.cannotWrite?(this.logger.low("init",{wasInEdit:!0,startInEdit:this.startInEdit}),this.inEditMode=!0):this.logger.low("init"),this.updateTabButtons()},d.prototype.save=function(){this.isClosed||this.isReadOnly||this.disconnected||!this.data||(this.state=this.getCurrentState(),this.throttledSave())},d.prototype.canSave=function(){return this.data&&!(this.isReadOnly||this.disconnected)},d.prototype.disconnect=function(){return this.disconnected=!0,JSON.stringify(this.state,a.LazySerializable.jsonReplacer)},d.prototype.reconnect=function(a){var b=this;return this.disconnected=!1,a?("string"==typeof a&&(a=JSON.parse(a)),this.lockObj.then(function(){b.state=a,b.reloadDash(function(){b.throttledSave()})})):Q.when(null)},d.prototype.saveImmediate=function(a){var b=this;return this.canSave()?(this.logger.low("saveImmediate",{reason:a}),this.throttledSave.cancel(),this.lockObj.then(function(){var a=b.lock();return b.state=b.getCurrentState(),b.data.setState(b.state).then(function(a){if(b.resetDirty(),a.error)throw a.error;return a}).finally(function(){a()})})):Q.when({result:!0})},Object.defineProperty(d.prototype,"components",{get:function(){return this.parentComponent&&this.parentComponent.getChildren()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"preferenceProvider",{get:function(){return this.parentComponent},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"userPreferenceProvider",{get:function(){return this.parentComponent.userData},enumerable:!0,configurable:!0}),d.prototype.updateState=function(){return this.rename(this.title.caption).then(function(){return null})},d.prototype.rename=function(b,c){var d=this;c&&this.logger.low("renameSilent",{newName:b});var e=this.data&&this.data.getName();if(this.data&&e!==b){var f=void 0;return f=this.isReadOnly?Q.when(b):this.data.updateMeta({displayName:b}).then(function(f){if(f.error){if(c)throw new Error("Cannot rename: "+f.error);return d.manageSaveError(f,function(){return d.rename(b)}),e}return e!==f.result.displayName&&(c||(d.traceAnalytics("Rename",null),d.dashboardService.notificationService.showSnackBar(a.stringFormat(a.shell.Strings.Text_Dashboard_Renamed,{oldName:e,newName:f.result.displayName})))),f.result.displayName}),f.then(function(a){if(a)return d.dashboardService.$rootScope.$evalAsync(function(){d.updateCaption(a),a!==e&&d._displayNameChanged.raise(d,{newValue:a,oldValue:e})}),a})}return Q.when(b)},d.prototype.manageConflict=function(b,c){var d=this;this.logger.low("Conflict_Ask",{version:b}),this.dashboardService.dialogService.show({title:a.shell.Strings.Text_Dashboard_Warn_Conflict_Title,severity:a.DialogSeverity.Warning,canClose:!0,textContent:a.stringFormat(a.shell.Strings.Text_Dashboard_Warn_Conflict,{name:this.title.caption}),buttons:[{title:"Overwrite",role:"primary"},{title:"Reload",role:"primary"},{title:"Cancel",role:"secondary"}]}).closed.then(function(a){if(d.logger.low("Conflict_Res",{val:a.value,cancel:a.cancel}),!a.cancel)switch(a.value){case 0:d.overwrite(c).done();break;case 1:d.reload("reload_conflict").done()}})},d.prototype.manageExternalUpdates=function(b){var c=this;this.logger.low("ExtUpdate",{args:b});var d=b&&b.username,e="string"==typeof d?d:d&&d[0]||"<unknown>",f=e===this.dashboardService.serverService.getUserName();if(b)if(b.renamed&&b.renamed!==this.data.getName()&&(this.dashboardService.notificationService.showInfo(a.stringFormat(f?a.shell.Strings.Text_Dashboard_RenamedExt_Self:a.shell.Strings.Text_Dashboard_RenamedExt,{name:this.data.getName(),newName:b.renamed})),this.data.getState(!0,!0).then(function(){c.dashboardService.$rootScope.$evalAsync(function(){c.updateCaption(b.renamed)})})),b.contentChanged||b.moved){if(!this.canUpdate){var g=b.version>0&&this.data.getVersion()===b.version,h=void 0;h=b.moved?f?g?a.shell.Strings.Text_Dashboard_Moved_Info_Self_Local:a.shell.Strings.Text_Dashboard_Moved_Info_Self:a.shell.Strings.Text_Dashboard_Moved_Info:f?a.shell.Strings.Text_Dashboard_Updated_Self:a.shell.Strings.Text_Dashboard_Updated,this.dashboardService.notificationService.showInfo(a.stringFormat(h,{author:e,name:this.data.getName()})),this.canUpdate=!0,this.updateTabButtons()}}else b.deleted&&(this.dashboardService.notificationService.showInfo(a.stringFormat(a.shell.Strings.Text_Dashboard_DeletedExt,{name:this.data.getName()})),this.canUpdate=!1,this.data.isReadOnly=!0,this.throttledSave.cancel(),this.updateTabButtons())},d.prototype.enterEditAndRenameMode=function(a){var b=this;this.initialized.then(function(){b.controllerScope.$evalAsync(function(){b.inEditLayoutMode=!0,b.title.startInEdit=a})})},d.prototype.clone=function(b){var c=this;if(!this.data)throw new Error("Not supported in non-serializable dashboard");return this.data.clone({state:this.getCurrentState(),source:b&&this.data}).then(function(b){c.dashboardService.notifySavedState(a.SaveStatusChangedReason.Saved),c.dashboardService.notificationService.showSnackBar(a.stringFormat(a.shell.Strings.Text_Dashboard_Created,{name:b.getName(),folder:b.category})),c.updateDescriptor(b,!0,!0,!1),c.dashboardService.updateState()})},Object.defineProperty(d.prototype,"columnCount",{get:function(){return this.getColumnCount&&this.getColumnCount()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"rowSize",{get:function(){return this.getRowSize&&this.getRowSize()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"layoutOpts",{get:function(){return this.getLayoutOpts?this.getLayoutOpts():this.tempLayoutOpts},set:function(a){this.tempLayoutOpts=a,this.setLayoutOpts&&this.setLayoutOpts(a)},enumerable:!0,configurable:!0}),d.prototype.registerLayoutOptHandlers=function(a,b){this.getLayoutOpts=a,this.setLayoutOpts=b,b(this.tempLayoutOpts)},d.prototype.pickDashboard=function(a,b,c){var d=this;if(!this.data)throw new Error("Not supported in non-serializable dashboard");if(!this.inDashboardSelectMode)return Q.when(null);var e=Q.defer();return c().then(function(c){if(!c)throw new Error("Cannot perform the operation");d.controllerScope.$evalAsync(function(){d.updateDescriptor(c,!1,!0,a&&b),d.quitDashboardSelector().then(function(){a||d.reload("from_sel"),d.userInteractionDisabled=!1,d.showSelector=!1,e.resolve(null)},function(a){return e.reject(a)})})},function(a){return e.reject(a)}),e.promise},d.prototype.quitDashboardSelector=function(){var a,b=this,c=this.dashboardService.$q.defer();return a=this.parentComponent.childAdded.add(function(d,e){b.parentComponent=e,a(),c.resolve(null)}),this.inDashboardSelectMode=!1,c.promise},d.prototype.createEmpty=function(a,b){var c=this;return this.pickDashboard(!0,a,function(){return c.dashboardService.createNewDashboardData(b)}).then(function(){c.inEditLayoutMode=!0}).then(function(){return c.displayName})},d.prototype.exportToFile=function(){var c=this.parentComponent.findUserDataProvider(),d=this.title.caption,e={content:this.getCurrentState(),displayName:d,type:b.DashboardStorageService.DashboardFileType,userPrefs:c&&c.getState(this.parentComponent)};this.dashboardService.fileExportService.exportFile(JSON.stringify(e,a.LazySerializable.jsonReplacer),"text/json",d+".json")},d.prototype.dashboardsSelected=function(a){var b=this;if(!this.inDashboardSelectMode)throw new Error("Widget selector cannot load dashboards");var c=[];return a.forEach(function(a,d){b.dashboardService.selectDashboard(a.dashId)||c.push(a)}),c.length>0?Q.all(c.map(function(a){return b.dashboardService.openDashboardById(a.dashId)})).then(function(){b._close(!1,"homeToDashCtrl")}):this._close(!1,"homeFin")},d.prototype.closeWidgetSelector=function(){this.controllerScope.dashOpts.closeWidgetSelector()},d.prototype.hideWidgetSelector=function(){this.showSelector=!1},d.prototype.onEscPressed=function(){this.inEditMode=!1,this.showSelector?this.showBackFromSelector&&this.hideWidgetSelector():(this.inEditLayoutMode=!1,this.showHistory=!1)},Object.defineProperty(d.prototype,"compactMode",{get:function(){return a.equals(b.COMPACT_DASHBOARD_LAYOUT_OPTS,this.layoutOpts)},set:function(a){this.layoutOpts=a?b.COMPACT_DASHBOARD_LAYOUT_OPTS:b.DEFAULT_DASHBOARD_LAYOUT_OPTS},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"fillHeightMode",{get:function(){return this._fillHeightMode},set:function(a){this._fillHeightMode=a},enumerable:!0,configurable:!0}),d.prototype.waitUntilDirty=function(){if(!this.isDirty)return Q.reject("Not dirty");var a=Q.defer(),b=this.saved.add(function(){b(),a.resolve(null)});return a.promise},d.prototype.takeUndoSnapshot=function(b,c){var d=this,e=JSON.stringify(this.getCurrentState(),a.LazySerializable.jsonReplacer),f=this.controllerScope.$new();this.dashboardService.notificationService.showSnackBar({templateUrl:"shell.ui/dashboard/undoSnackBar.tpl.html",scope:f}).then(function(a){f.text=b;var g=!1;f.undo=function(){g=!0,d.state=e&&JSON.parse(e),d.reloadDash(function(){a.close()})},f.$on("$destroy",function(){g||d.dashboardService.cleanComponentData(d,c)})})},d.prototype.traceAnalytics=function(a,c,d){this.data?this.data.traceAnalytics(a,c,d):b.SerializableDashboard.traceAnalyticsString(this.logger,null,a,c,d)},d.prototype.getControllerInstance=function(){var a=this;return this.dashboardService.$q.when(this.initialized).then(function(){return a.directiveScope.dashCtrl})},Object.defineProperty(d.prototype,"canExport",{get:function(){return this.dashboardService.canImportExportDashboards},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"canShowHistory",{get:function(){return this.data&&this.dashboardService.canShowHistory},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"canClone",{get:function(){return this.data&&this.dashboardService.canCreateDashboards},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"canEdit",{get:function(){
return this.dashboardService.canEditDashboards},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"canPopout",{get:function(){var b=a.getService("ionweb.embeddingService"),c=!b.ionMobileBridge;return this.data&&c},enumerable:!0,configurable:!0}),d.SidePanelCompId="sidePanel",d.TopPanelCompId="topPanel",d.RightPanelCompId="rightPanel",d.BottomPanelCompId="bottomPanel",d}();b.DashboardDescriptor=e}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function b(){}return b.createEditMenuScope=function(a,b,c,d){var e=a.$new();return e.dashboard=b,e.disabled=!c,e.enableLockLayoutMenuItem=!d.disableDashboardLockLayout,e.enableShowCaptionsMenuItem=!d.disableWidgetCaptionVisibility,e.enableFitToBrowserMenuItem=!d.disableDashboardFitToBrowser,e.enableCompactModeMenuItem=!d.disableDashboardCompactMode,e},b.getEditMenuScopeTexts=function(b){var c=[a.shell.Strings.Menu_Dashboard_Edit];return b.enableLockLayoutMenuItem&&c.push(a.shell.Strings.Menu_Dashboard_LockLayout),b.enableShowCaptionsMenuItem&&c.push(a.shell.Strings.Menu_Dashboard_ShowCaption),b.enableFitToBrowserMenuItem&&c.push(a.shell.Strings.Menu_Dashboard_FillHeightMode),b.enableCompactModeMenuItem&&c.push(a.shell.Strings.Menu_Dashboard_CompactMode),c},b.createIonNetMenuScope=function(b,c){return[{action:function(){b.inEditMode=!b.inEditMode},checked:b&&b.inEditMode,text:a.shell.Strings.Menu_Dashboard_Edit,tooltip:a.shell.Strings.Tooltip_Dashboard_Edit,menuType:a.MenuItemType.Checkbox,icon:"edit",disabled:!c,hidden:b.editModeSwitchDisabled},{action:function(){b.inEditLayoutMode=!b.inEditLayoutMode,b.fillHeightMode=!1},checked:!(b&&b.inEditLayoutMode),text:a.shell.Strings.Menu_Dashboard_LockLayout,tooltip:a.shell.Strings.Tooltip_Dashboard_LockLayout,menuType:a.MenuItemType.Checkbox,icon:"editDashboard",disabled:!c},{action:function(){b.showHeaders=!b.showHeaders},checked:b&&b.showHeaders,menuType:a.MenuItemType.Checkbox,text:a.shell.Strings.Menu_Dashboard_ShowCaption,tooltip:a.shell.Strings.Tooltip_Dashboard_ShowCaption,disabled:!c},{action:function(){b.fillHeightMode=!b.fillHeightMode,b.inEditLayoutMode=!1},checked:b&&b.fillHeightMode,menuType:a.MenuItemType.Checkbox,text:a.shell.Strings.Menu_Dashboard_FillHeightMode,tooltip:a.shell.Strings.Tooltip_Dashboard_FillHeightMode,disabled:!c},{action:function(){b.compactMode=!b.compactMode},checked:b&&b.compactMode,menuType:a.MenuItemType.Checkbox,text:a.shell.Strings.Menu_Dashboard_CompactMode,tooltip:a.shell.Strings.Tooltip_Dashboard_CompactMode,disabled:!c}]},b}();b.EditMenuHelper=c}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(a,b,c,d,e,f,g){this.svc=a,this.logger=b,this.contextMenuService=c,this.configService=d,this.actionService=e,this.envService=f,this.changedHandler=g,this.homeShown=!1,this._dashboards=[],this.dashboardMenu=null,this.hoverId=""}return Object.defineProperty(c.prototype,"dashboards",{get:function(){return this._dashboards},enumerable:!0,configurable:!0}),c.prototype.setDashboards=function(a){this._dashboards=a,this.changedHandler()},c.prototype.addDashboard=function(a,b){var c;return"number"!=typeof b||isNaN(b)?c=this._dashboards.push(a):(this._dashboards.splice(b,0,a),c=b),this.changedHandler(),c},c.prototype.removeDashboard=function(a){this._dashboards.splice(a,1),this.changedHandler()},c.prototype.selectTab=function(a){this.homeShown=!1;var b=!1;this.dashboards.forEach(function(c,d){var e=d===a;b=b||c.active!==e,c.active=e,e&&c.traceAnalytics("Activate",null)}),b&&this.svc.updateState(),this.svc.raiseActiveDashboardChangeEvent()},Object.defineProperty(c.prototype,"canShowHome",{get:function(){return!this.svc.environmentService.isOffline&&this.svc.canBrowseDashboards},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"canRearrangeDashboards",{get:function(){return this.svc.canRearrangeDashboards},enumerable:!0,configurable:!0}),c.prototype.showHome=function(){if(!this.canShowHome)return!1;if(this.homeShown)return!0;this.homeShown=!0;var a=!1;return this.dashboards.forEach(function(b,c){a=a||b.active,b.active=!1}),a&&this.svc.updateState(),this.svc.raiseActiveDashboardChangeEvent(),!0},c.getDashboardContextMenu=function(c,d,e,f){if(!c||c.isLocal())return{items:[]};var g=a.getService("ionweb.embeddingService"),h=!g.ionMobileBridge;if(c.userInteractionDisabled)return h?{items:[{action:function(){return d.popOutDashboard(c)},icon:"popOut",text:a.shell.Strings.Menu_Dashboard_PopOut,disabled:!c}]}:{items:[]};var i,j=c&&!c.cannotWrite,k=d.environmentService.isOffline,l=d.configService.config.shell.dashboardModeConfig||{},m=function(){return e||l.inlineAddWidget?e?{text:a.shell.Strings.Menu_Dashboard_AddWidget,tooltip:a.shell.Strings.Tooltip_Dashboard_AddWidget,subMenu:e,disabled:!j,hidden:!c.canEdit}:null:{action:function(){return c&&c.createNewWidget()},text:a.shell.Strings.Menu_Dashboard_AddWidget,tooltip:a.shell.Strings.Tooltip_Dashboard_AddWidget,icon:"add",disabled:!j,hidden:!c.canEdit}},n=function(){i&&i.$destroy(),i=null},o=function(){return n(),i=b.EditMenuHelper.createEditMenuScope(d.$rootScope,c,j,l)},p=[];if(!l.disableAddWidgetDialog){var q=m();q&&p.push(q)}return p.push({action:function(){c.inEditMode||(c.inEditMode=!0),c.title.startInEdit=!0},text:a.shell.Strings.Text_Dashboard_Menu_Rename_DashBoard,tooltip:a.shell.Strings.Tooltip_Dashboard_Rename_Dashboard,icon:"rename",disabled:!j||k,hidden:!c.data||!c.canEdit||l.disableDashboardRename}),f?p=p.concat(b.EditMenuHelper.createIonNetMenuScope(c,j)):p.push({menuType:a.MenuItemType.Custom,templateUrl:"shell.ui/dashboard/editMenuItem.tpl.html",disabled:!j,hidden:!c.canEdit||c.editModeSwitchDisabled,scope:c.canEdit&&!c.editModeSwitchDisabled&&o()}),p.push({isDivider:!0},{action:function(){return d.popOutDashboard(c)},icon:"popOut",text:a.shell.Strings.Menu_Dashboard_PopOut,tooltip:a.shell.Strings.Tooltip_Dashboard_PopOut,disabled:!c||k,hidden:!c.canPopout||l.disableDashboardPopout},{action:function(){return c.clone().done()},text:a.shell.Strings.Menu_Dashboard_Clone,tooltip:a.shell.Strings.Tooltip_Dashboard_Clone,disabled:!c||k||!d.persistenceService.canCreateDashboard,hidden:!c.canClone||l.disableDashboardCopy},{action:function(){c&&(c.inEditLayoutMode=!1,c.inEditMode=!1,c.showHistory=!0)},text:a.shell.Strings.Menu_Dashboard_ShowHistory,tooltip:a.shell.Strings.Tooltip_Dashboard_ShowHistory,disabled:!c||c.data&&!c.data.hasHistory||k,hidden:!c.canShowHistory||l.disableDashboardHistoryView},{isDivider:!0},{text:a.shell.Strings.Menu_Dashboard_ExportFile,tooltip:a.shell.Strings.Tooltip_Dashboard_ExportFile,icon:"import",action:function(){return c.exportToFile()},disabled:!c,hidden:!c.canExport||l.disableDashboardDownload},{text:a.shell.Strings.Menu_Dashboard_CheckForUpdate,tooltip:a.shell.Strings.Tooltip_Dashboard_CheckForUpdate,icon:"refresh",action:function(){return d.checkForUpdate()},hidden:!d.canCheckForUpdate()}),{items:p.filter(function(a){return!a.hidden}),destroy:n}},c.prototype.optionsClicked=function(b){var c=this;if(this.dashboardMenu)this.dashboardMenu.close(),this.dashboardMenu=null;else{var d=this.createOptionsMenu(),e=d.items,f=d.destroy,g={anchorPoint:a.ContextMenuAnchorPoint.BottomRight,onCreate:function(a){c.dashboardMenu=a},onDestroy:function(){c.dashboardMenu&&(c.dashboardMenu=null),f&&f()}};this.contextMenuService.openContextMenu(e,b.currentTarget||b.target,g)}},Object.defineProperty(c.prototype,"canImport",{get:function(){return this.svc.isEnabled&&this.svc.canImportExportDashboards},enumerable:!0,configurable:!0}),c.prototype.createOptionsMenu=function(b,d){var e=this,f=c.getDashboardContextMenu(this.svc.activeDashboard,this.svc,b,d),g=f.items,h=f.destroy,i=this.svc.configService.config.shell;if(this.svc.isEnabled&&(this.canImport||this.svc.inSingleDashboardMode)&&(g.unshift({isDivider:!0}),!this.canImport||i.dashboardModeConfig&&i.dashboardModeConfig.disableDashboardImport||g.unshift({text:a.shell.Strings.Menu_Dashboard_ImportFile,tooltip:a.shell.Strings.Tooltip_Dashboard_ImportFile,fileChooser:function(a){a&&e.svc.importDashboard(a).done()}}),this.svc.inSingleDashboardMode&&i.ionnet&&i.ionnet.showOpenDashboard&&g.unshift({text:a.shell.Strings.Menu_Dashboard_OpenSingle,tooltip:a.shell.Strings.Tooltip_Dashboard_OpenSingle,action:function(){return e.showHome()}})),this.svc.isEnabled&&this.configService.config.shell.disableDashboardTabs){var j=this.svc.dashboardList.filter(function(a){return!a.isLocal()}).map(function(b){return{text:b.displayName,checked:b===e.svc.activeDashboard,menuType:a.MenuItemType.Checkbox,action:function(){return e.svc.selectDashboard(b.id)}}});j.push({isDivider:!0},{text:a.shell.Strings.Text_Dashboard_Menu_CloseAll,action:function(){return e.svc.closeAllDashboards().done()}}),g.unshift({text:a.shell.Strings.Text_Dashboard_Menu_DashList,menuType:a.MenuItemType.Submenu,subMenu:j},{isDivider:!0})}var k=this.envService.fullscreenModeManager;k.shouldShowFullscreenModeMenu()&&(g.push({isDivider:!0}),g.push({action:function(){k.toggleFullscreenMode()},checked:k.isDocumentInFullscreenMode(),menuType:a.MenuItemType.Checkbox,text:a.shell.Strings.Menu_Dashboard_Toggle_Fullscreen})),g.push({isDivider:!0}),this.actionService.showPreference.isHidden||g.push({action:function(){return e.actionService.showPreference()},text:a.shell.Strings.Menu_Preferences,icon:"settings",disabled:this.actionService.showPreference.isDisabled||this.svc.environmentService.isOffline});var l=this.svc.shellModuleLoader.getHelpLinks(),m=null;l.length&&(m=[],l.forEach(function(a){a.links.length>0&&(a.links.forEach(function(a){var b={text:a.name,action:function(){return window.open(a.href)}};m.push(b)}),m.push({isDivider:!0}))}),m.length>0&&m.pop()),this.actionService.showAbout.isHidden&&!m||g.push({isDivider:!0}),m&&g.push({text:a.shell.Strings.Menu_Help,menuType:a.MenuItemType.Submenu,subMenu:m}),this.actionService.showAbout.isHidden||g.push({action:function(){return e.actionService.showAbout()},text:a.shell.Strings.Menu_About,icon:"information"});for(var n=0;n<g.length;n++)g[n].isDivider&&(0===n||n===g.length-1||g[n+1].isDivider)&&(g.splice(n,1),n--);return{items:g,destroy:h}},Object.defineProperty(c.prototype,"inShowHistoryMode",{get:function(){return a.any(this._dashboards,function(a){return a.showHistory})},enumerable:!0,configurable:!0}),c.prototype.createNew=function(){var a=this;this.svc.createNewDashboard().catch(function(){return a.svc.showRepositoryError()})},Object.defineProperty(c.prototype,"canCreateNew",{get:function(){return this.svc.canCreateDashboards},enumerable:!0,configurable:!0}),c.prototype.createDashboardSelectorView=function(){this.svc.createDashboardSelectorView().done()},c.prototype.addWidgetClicked=function(b,c){var d=this,e=this.svc.configService.config.shell;if(e&&e.dashboardModeConfig&&e.dashboardModeConfig.inlineAddWidget){if(this.inlineAddWidgetPopup)return;var f=this.svc.$rootScope.$new(!0),g=function(){d.inlineAddWidgetPopup&&(d.inlineAddWidgetPopup.destroy(),d.inlineAddWidgetPopup=null)};f.onSelected=function(b){g(),new a.home.HomeHelper(d.svc).openWidgets(c,[b.getNode()],!1)},f.modelRoot="favorites"===e.dashboardModeConfig.inlineAddWidget?"favorites":void 0,this.inlineAddWidgetPopup=this.svc.popupService.createWithTemplate('<ionweb-workspace-selector\n                        inline="true"\n                        hide-dashboards="true"\n                        prune-empty-folders="true"\n                        model-root="modelRoot"\n                        on-select="onSelected(itemPath)">\n                    </ionweb-workspace-selector>',$(b.currentTarget),f,{automaticallyClose:!0,showAnchorPointArrow:!0,automaticallyUpdatePosition:!1}),this.inlineAddWidgetPopup.onClose.add(function(){return g()}),this.inlineAddWidgetPopup.show()}else this.showWidgetSelector(c)},c.prototype.showWidgetSelector=function(a){var b={templateUrl:"shell.ui/dashboard/widgetSelector.tpl.html",scope:a.controllerScope,canClose:!0};this._widgetSelectorDialog=this.svc.dialogService.showCustom(b)},c.prototype.closeWidgetSelector=function(){this._widgetSelectorDialog&&(this._widgetSelectorDialog.dismiss(),this._widgetSelectorDialog=null)},c}();b.DashboardsScopeOptions=c}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(a,b,c,d,e,f,g,h,i){this.owner=a,this.scopeOpts=b,this.$q=c,this.storageService=d,this.dialogService=e,this.rootComponentGetter=f,this.$rootScope=g,this.preferenceService=h,this.notificationService=i,this.logger=this.owner.loggerFactory.create("SingleDashMgr")}return c.prototype.updatePrefs=function(a){var b=this.rootComponentGetter();a&&a.uuid?(b.setValue(c.SINGLE_DASHBOARD_UUID_PROP,a.uuid),b.setValue(c.SINGLE_DASHBOARD_UUIDVER_PROP,a.getVersion())):(b.deleteKey(c.SINGLE_DASHBOARD_UUID_PROP),b.deleteKey(c.SINGLE_DASHBOARD_UUIDVER_PROP))},c.prototype.getPrefs=function(){var a=this.rootComponentGetter(),b=a.getValue(c.SINGLE_DASHBOARD_UUID_PROP),d=a.getValue(c.SINGLE_DASHBOARD_UUIDVER_PROP);return{lastUuid:b,lastVersion:d}},c.prototype.updateSingleDashState=function(b){var d=this.rootComponentGetter().getState()||{version:a.Component.serializationVersion},e=d.components;e||(e=d.components={}),e[c.SINGLE_DASHBOARD_COMPID]=b,this.rootComponentGetter().setState(d)},c.prototype.isEmptySingleDashState=function(){var a=this.rootComponentGetter().getState();return!a.components||!a.components[c.SINGLE_DASHBOARD_COMPID]},c.prototype.import=function(a,d){var e,f=this,g=this.getPrefs(),h=g.lastUuid,i=g.lastVersion;return e=!h||!i||a&&a.uuid!==h?a?Q.when({dashboard:a}):Q.when({cancel:!0}):this.owner.checkForUuidUpdate(h,i,a),this.$q.when(e.then(function(a){if(a.dashboard)return f.updatePrefs(a.dashboard),a.dashboard.getState(!1,!1)})).then(function(a){a&&f.updateSingleDashState(a);var e=new b.DashboardDescriptor(f.owner,f.dialogService,null,null,{id:c.SINGLE_DASHBOARD_COMPID});e.canClose=!1,e.active=!0,e.updateCaption("==SINGLE==");var g=f.scopeOpts.addDashboard(e);return f.scopeOpts.selectTab(g-1),d&&f.isEmptySingleDashState()&&(f.logger.low("CreatingSingleComp",{compIdToLoad:d}),e.initialized.then(function(){f.$rootScope.$evalAsync(function(){e.createComponent(d,null,{width:1}),e.fillHeightMode=!0,e.compactMode=!0})})),e})},c.prototype.startup=function(a,b){var c=this;return this.owner.escPressed.add(function(){c.scopeOpts.homeShown&&c.scopeOpts.selectTab(0)}),this.preferenceService.loadedPromise.then(function(){if(c.logger.low("InitSingleDashboard"),a.length>1)throw new Error("Cannot open multiple dashboards in single dashboard mode");return 1===a.length?c.owner.loadDashboard(a[0]):Q.when(null)}).then(function(a){var d=Q.defer();return c.$rootScope.$evalAsync(function(){d.resolve(c.import(a,b).then(function(a){c.currentDashboard=a}))}),d.promise})},c.prototype.overwriteDashboard=function(a){var b=this;return this.owner.startLoading(),Q.all(this.scopeOpts.dashboards.map(function(a){return a.closeHideHome()})).then(function(){var c=Q.defer();return b.updatePrefs(null),b.$rootScope.$evalAsync(function(){try{b.import(a).then(function(a){b.owner.updateState(),c.resolve(a),b.currentDashboard=a},function(a){c.reject(a)})}catch(a){c.reject(a)}}),c.promise}).finally(function(){b.$rootScope.$evalAsync(function(){b.owner.endLoading()})})},c.prototype.canCheckForUpdate=function(){var a=this.getPrefs(),b=a.lastUuid,c=a.lastVersion;return!!b&&!!c},c.prototype.checkForUpdate=function(){var b=this,c=this.getPrefs(),d=c.lastUuid,e=c.lastVersion;d&&e&&this.owner.checkForUuidUpdate(d,e,null).then(function(c){return c.dashboard?b.overwriteDashboard(c.dashboard):void(c.notFound?b.notificationService.showSnackBar(a.shell.Strings.Dashboard_Single_Update_NotFound):c.cancel||b.notificationService.showSnackBar(a.shell.Strings.Dashboard_Single_Update_No))}).done()},c.SINGLE_DASHBOARD_COMPID="$singleDash",c.SINGLE_DASHBOARD_UUID_PROP="singleDashUuid",c.SINGLE_DASHBOARD_UUIDVER_PROP="singleDashUuidVer",c}();b.SingleDashboardManager=c}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(b,c,d,e,f){var g=this;this.scope=b,this.languageService=f,this.editedComments={},this.logger=c.create("DashboardHistory."+b.dashboard.id),this.palette=a.getAllPaletteColor(),this.oldState=b.dashboard.disconnect(),this.scope.canWrite=!b.dashboard.cannotWrite;var h=[b.dashboard.data.changed.add(function(){b.$evalAsync(function(){g.updateList()})})];b.filterComments=!1,b.showMore=!1,b.dashboard.data.hasHistory?(this.updateList(0),b.$watchGroup(["filterComments","showMore"],function(b,c){a.equals(b,c)||g.refreshList()})):b.loadingText=a.shell.Strings.Err_Dashboard_Template_NoHistory,b.selectVersion=function(c){var e=!1;b.versions.forEach(function(a,d){d===c?(e=!a.isSelected,a.isSelected=!0,a.comment.enabled=b.canWrite):(a.isSelected=!1,a.comment.enabled=!1)}),e&&(g.logger.low("Preview",{version:b.versions[c].md.version}),g.scope.loadingText=a.shell.Strings.Text_Dashboard_Loading,b.versions[c].md.getContent().then(function(a){b.loadState(a,b.versions[c].compDiff),g.changed=!0,b.$evalAsync(function(){g.scope.dashboard.reloaded.raise(g,null)})},function(a){d.log(a,g.logger,"ErrorRetrieveVersion"),g.scope.$evalAsync(function(){b.versions[c].error=!0})}).finally(function(){g.scope.$evalAsync(function(){g.scope.loadingText=null})}))},b.restoreVersion=function(a){g.logger.low("Restore",{version:b.versions[a].md.version}),b.versions[a].md.getContent().then(function(a){b.dashboard.reconnect(a).done(),g.changed=!0,g.saved=!0,b.dashboard.showHistory=!1})},h.push(e.isOfflineChanged.add(function(){e.isOffline&&(b.dashboard.showHistory=!1)})),b.$on("$destroy",function(){b.dashboard.reconnect(!g.saved&&g.changed?g.oldState:null).done(),g.saved&&b.dashboard.save(),h.forEach(function(a){return a()}),h=[],g.commitComments()})}return c.prototype.propToList=function(a){return Array.isArray(a)?a.sort().join(", "):a},c.prototype.refreshList=function(d){var e=this;this.metadata=this.lastHistory.metadata.slice();var f=this.metadata.length>0&&this.metadata[this.metadata.length-1];if(this.metadata.forEach(function(a){a.compDiff=a.appData&&a.appData.compDiff&&a.appData.compDiff.slice()}),this.scope.filterComments)this.metadata=this.metadata.filter(function(a){return!!a.comment});else if(!this.scope.showMore){var g=a.localization.moment(),h=a.storages.coalesce(this.metadata,c.localCoalesceRules,function(b){return{age:g.diff(a.localization.moment(b.timeStamp),"seconds"),content:b.compDiff,pinned:!!b.comment}});h.reverse(),h.forEach(function(a){var c=e.metadata.splice(a.start,a.end-a.start+1).map(function(a){return a.compDiff});c.push(e.metadata[a.start].compDiff),e.metadata[a.start].compDiff=b.ComponentExtractorProvider.mergeMd(c)})}this.metadata.reverse(),this.logger.low("shown",{count:this.metadata.length,showMore:this.scope.showMore,filterComments:this.scope.filterComments});var i=0,j=this.metadata.reduce(function(a,b){var c=e.propToList(b.username);return a[c]||(a[c]=e.palette[i],i=(i+1)%e.palette.length),a},{});this.scope.$evalAsync(function(){e.scope.loadingText=null,e.scope.versions=e.metadata.map(function(c,g){var h=e.propToList(c.username);return{timeStamp:a.timestampToString(a.localization.moment(c.timeStamp),e.languageService),author:h,authorColor:j[h],md:c,isSelected:g===d,canRestore:c!==f,compDiff:c.compDiff,comment:{caption:e.propToList(c.comment),showEdit:b.EditMode.Always,enabled:e.scope.canWrite&&g===d,editDesc:a.shell.Strings.Text_Dashboard_RevisionHistory_EditComment_Desc,renamed:function(a){c.comment=a,e.editedComments[c.version]=a}}}})})},c.prototype.updateList=function(b){var c=this;this.scope.loadingText=a.shell.Strings.Text_Dashboard_Loading,this.lastHistory=null,this.scope.dashboard.data.getHistory().then(function(a){c.lastHistory=a,c.refreshList(b)}).done()},c.prototype.commitComments=function(){Object.keys(this.editedComments).length>0&&this.lastHistory&&(this.logger.low("EditComments",this.editedComments),this.scope.dashboard.data.updateHistoryComments(this.lastHistory,this.editedComments).done())},c.localCoalesceRules=[{age:0,distance:a.localization.moment.duration(1,"minutes").asSeconds(),altDistanceIfEquals:a.localization.moment.duration(10,"minutes").asSeconds()},{age:a.localization.moment.duration(1,"days").asSeconds(),distance:0,altDistanceIfEquals:a.localization.moment.duration(2,"hours").asSeconds()}],c}();angular.module("ionwebShell").controller("ionweb.DashboardHistoryController",["$scope","ionweb.dateFormattingService","ionweb.loggerFactory","ionweb.excHelper","ionweb.environmentService","ionweb.languageService",function(a,b,d,e,f,g){return new c(a,d,e,f,g)}])}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){angular.module("ionwebShell").directive("ionFileChooser",["$timeout",function(a){return{scope:{textContent:"=",text:"=",tooltip:"="},templateUrl:"shell.ui/dashboard/fileChooser.tpl.html",link:function(a,b){var c=$("input",b)[0],d=$("a",b)[0];d.addEventListener("click",function(a){a.preventDefault(),c.click()},!1),c.addEventListener("change",function(b){var d=new FileReader;d.onload=function(b){a.$evalAsync(function(){a.textContent=b.target.result})},d.readAsText(c.files[0])},!1)}}}])}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(b){function c(){var c=b.call(this,a.shell.Strings.Err_Home_StorageNotFound)||this;return c.missingStorage=!0,c}return __extends(c,b),c}(Error);b.StorageMissingError=c;var d=function(){function d(c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A){var B=this;this.$rootScope=c,this.$q=e,this.$location=f,this.configService=g,this.serverService=h,this.notificationService=i,this.localPref=j,this.persistenceService=k,this.preferenceService=m,this.toolbarService=n,this.dialogService=o,this.childWindowService=p,this.contextMenuService=q,this.embeddingService=r,this.loggerFactory=s,this.catalogService=u,this.excHelper=v,this.fileExportService=w,this.storageService=x,this.environmentService=y,this.shellModuleLoader=z,this.popupService=A,this._isEnabled=!1,this.startedDeferred=Q.defer(),this.dashboardsChangedEvent=new a.Event,this.activeDashboardChangedEvent=new a.Event,this._bringingComponentToFront=new a.Event,this._showMaximizeButton=!0,this.showMaximizeButtonChanged=new a.Event,this.externalDashboards={},this.isEnabledChanged=new a.Event,this.hideTabsInToolbarChanged=new a.Event,this.escPressed=new a.Event,this.savedStateChanged=new a.Event,this.logger=s.create("DashboardSvc"),this.scopeOpts=new b.DashboardsScopeOptions(this,this.logger,q,g,t,y,function(){B.dashboardsChangedEvent.raise(B,null)}),l.initialized.then(function(){B.component=l.getRootComponent()}).done(),u.addCategory("_INTERNAL").components.push({id:d.PLACEHOLDER_COMP_ID,displayName:"Placeholder",isHidden:!0,templateUrl:"shell.ui/dashboard/placeholderComponent.tpl.html"}),r.ionNetBridge&&r.ionNetBridge.caps.then(function(a){a.hasOptionsMenu&&(r.ionNetBridge.shell.requestOptionsMenu=function(a){var b=B.scopeOpts.createOptionsMenu(a,!0),c=b.items,d=b.destroy;return d&&d(),c})}).done(),this.persistenceService.showOptionDialog=function(a,b,c){return Q.when(B.dialogService.showOptionDialog(a,b,c).closed.then(function(a){return!a.cancel&&a.value}))}}return Object.defineProperty(d.prototype,"showMaximizeButton",{get:function(){return this._showMaximizeButton},set:function(a){a!==this.showMaximizeButton&&this.preferenceService.setValue(d.MAXIMIZE_PREF_KEY,a)},enumerable:!0,configurable:!0}),d.prototype.inIonNet=function(){return!!this.embeddingService.ionNetBridge},d.prototype.done=function(b){b.catch(function(b){a.getService("ionweb.excHelper").report(b)})},Object.defineProperty(d.prototype,"isEnabled",{get:function(){return this._isEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"inSingleDashboardMode",{get:function(){return!!this.singleDashMgr},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"hideTabsInToolbar",{get:function(){return!!this._hideTabsInToolbar},set:function(a){this._hideTabsInToolbar=a,this.hideTabsInToolbarChanged.raise(this,null)},enumerable:!0,configurable:!0}),d.prototype.raiseActiveDashboardChangeEvent=function(){this.activeDashboardChangedEvent.raise(this,null)},d.prototype.loadState=function(){var a=[],b={},c=this.configService.config.shell,e=c.disableLastDashboards;if(c.loadWorkspace&&c.lockedWorkspace&&(e=!0),e)return this.logger.low("LoadState:disabled",{loadWorkspace:c.loadWorkspace,lockedWorkspace:c.lockedWorkspace}),{dashboardIds:a,extLayoutProps:b};var f=this.localPref.getUserValue(d.OPEN_DASHBOARDS_PROP,null),g=this.localPref.getUserValue(d.ACTIVE_DASHBOARD_PROP),h=this.localPref.getUserValue(d.OPEN_DASHBOARDS_PROP_BACKW,a),i=this.localPref.getUserValue(d.ACTIVE_DASHBOARD_PROP_BACKW),j=this.localPref.getUserValue(d.EXT_DASHBOARDS_PROP,b);f=f||h,g=g||i;var k;(!f||f&&!Array.isArray(f))&&(f=a,k=!0);var l={dashboardIds:f,active:g,extLayoutProps:j};return this.logger.low("LoadingFromLocalStore",{state:l,isDefault:k}),l},d.prototype.saveState=function(a){this.localPref.setUserValue(d.OPEN_DASHBOARDS_PROP,a.dashboardIds),this.localPref.setUserValue(d.ACTIVE_DASHBOARD_PROP,a.active),this.localPref.setUserValue(d.EXT_DASHBOARDS_PROP,a.extLayoutProps),this.localPref.setUserValue(d.OPEN_DASHBOARDS_PROP_BACKW,a.dashboardIds.filter(function(a){return!b.isAppDashboard(a)})),this.localPref.setUserValue(d.ACTIVE_DASHBOARD_PROP_BACKW,b.isAppDashboard(a.active)?null:a.active)},d.prototype.traceAnalytics=function(){this.logger.analytics("Settings","Preference",d.MAXIMIZE_PREF_KEY+":"+this._showMaximizeButton)},d.prototype.start=function(){var a=this;this._showMaximizeButton=this.preferenceService.getValue(d.MAXIMIZE_PREF_KEY,!0),this.traceAnalytics(),this.preferenceService.subscribeChanges(d.MAXIMIZE_PREF_KEY,function(b,c){a._showMaximizeButton=c.value,a.traceAnalytics(),a.showMaximizeButtonChanged.raise(a,null)})},d.willUseDashboard=function(a,b){var c=a.config.shell,d=c.useDashboard;if("undefined"==typeof d)d=!0;else if("desktop"===d){var e=b.isMobileDevice()&&b.isSmallScreen();d=!e}c.singleComponentId&&(d=!1);var f=d&&!c.disableDashboard,g=f&&"single"===d;return{enabled:f,singleDash:g}},d.prototype.init=function(){var a=this,c=function(c){var e=d.willUseDashboard(a.configService,a.environmentService),f=e.enabled,g=e.singleDash;a.scopeOpts.hasDashboards=f,a._isEnabled!==f&&(a._isEnabled=f,a.isEnabledChanged.raise(a,null),a.logger.low("enable",{enabled:f,reason:c})),g&&!a.singleDashMgr?(a.singleDashMgr=new b.SingleDashboardManager(a,a.scopeOpts,a.$q,a.storageService,a.dialogService,function(){return a.component},a.$rootScope,a.preferenceService,a.notificationService),a.logger.low("singleDash",{singleDash:g,reason:c})):!g&&a.singleDashMgr&&(a.singleDashMgr=null,a.logger.low("singleDash",{singleDash:g,reason:c}))};c("init"),this.configHandler=this.configService.changed.add(function(){return c("configChange")})},d.prototype.fetchDashboards=function(){return this.persistenceService.fetchDashboards()},d.prototype.cloneDashboard=function(b,c){var d,e=this,f=a.firstOrDefault(this.scopeOpts.dashboards,function(a){return a.id===b});return f&&f.data&&(d=Q.when(f.data)),d||(d=this.persistenceService.getSerializableDashboard(b)),d.then(function(a){return e.persistenceService.cloneDashboard(a,c)}).then(function(a){return a.id})},Object.defineProperty(d.prototype,"started",{get:function(){return this.startedDeferred.promise},enumerable:!0,configurable:!0}),d.prototype.checkEmptyStartup=function(){var a=this;return this.persistenceService.checkDefaultDashboards(this.scopeOpts.dashboards.map(function(a){return a.id}),this.configService.config.shell).then(function(b){if(b.dashboards.length>0){a.logger.low("LoadingDefs",b.dashboards.map(function(a){return a.id}));var c=a.activeDashboard;return a.openDashboards(b.dashboards,{active:b.active||c&&c.data}).then(function(){a.checkForDashboardUpdates(b.dashboards.filter(function(a){return a.checkForUpdate}).map(function(a){return a.id}))})}return a.configService.config.shell.disableHomeAutoload||0!==a.scopeOpts.dashboards.length?null:a.createDashboardSelectorView()})},d.prototype.startup=function(c){var d=this;this.configHandler&&this.configHandler();var e=function(){d.logger.low("startupDone"),d.startedDeferred.resolve(null)};this.persistenceService.startup(this.catalogService).then(function(){return d.$rootScope.$evalAsync(function(){d.$rootScope.useDashboard=!0,d.configService.editConfig(function(a){a.shell.enableComponentCreationMenu=!1})}),d.parseLocation().then(function(e){var f=e&&1===e.length&&d.embeddingService.envType===a.EmbeddedEnvironmentType.ChildWindow;if(d.logger.low("startup",{locationParams:e,isPopoutProcess:f,lockedWorkspace:d.configService.config.shell.lockedWorkspace}),d.inSingleDashboardMode)return d.clearLocation(),d.singleDashMgr.startup(e,c);if(e.length>0)return d.logger.low("LoadingFromUrl",{ids:e}),Q.when(d.loadDashboards(e)).finally(function(){if(!f)return d.checkEmptyStartup()});var g=d.loadState(),h=g.dashboardIds.filter(function(a){return!b.isInternalDashboard(a)});return Q.when(d.loadDashboards(h,g.active,g.extLayoutProps)).then(function(){var a=[];return Object.getOwnPropertyNames(g.extLayoutProps).forEach(function(b){var c=g.extLayoutProps[b];if(c)try{d.loadExternalDashboard(b,d.childWindowService.openNew(c.layout),c.name)}catch(c){d.logger.logExc(c,"loadExternalDashboardStartup"),a.push(b)}}),a.length>0?Q.all(a.map(function(a){return d.loadDashboard(a).then(function(a){return d.openDashboards([a])})})).then(function(){if(!f)return d.checkEmptyStartup()}):f?void 0:d.checkEmptyStartup()})})}).then(function(){e()},function(a){throw e(),a}).done(),this.serverService.getServerVersion().then(function(b){b&&!b.lt(a.IonVersion.fromIonString("120"))||d.notificationService.showError(a.stringFormat(a.shell.Strings.Err_ServerVer_NotMet,{ver:b.toPublicIonString(!1),reqVer:"120"}))}).done()},d.prototype.updateState=function(){this.scopeOpts.dashboards.forEach(function(a){a.updateState().done()}),this.updateListState()},d.prototype.updateListState=function(){var a=this,b=Object.getOwnPropertyNames(this.externalDashboards).map(function(b){return{id:b,d:a.externalDashboards[b]}}).reduce(function(a,b){return a[b.id]={layout:b.d.child.layout,name:b.d.name},a},{}),c={dashboardIds:this.scopeOpts.dashboards.map(function(a){return a.id}),active:this.getActiveId(),extLayoutProps:b};this.saveState(c)},d.prototype.getActiveDashboard=function(){return this.activeDashboard},Object.defineProperty(d.prototype,"activeDashboard",{get:function(){return a.firstOrDefault(this.scopeOpts.dashboards,function(a){return a.active})},enumerable:!0,configurable:!0}),d.prototype.getActiveId=function(){var a=this.activeDashboard;return a&&a.id},d.prototype.selectDashboard=function(b){var c=a.indexOf(this.scopeOpts.dashboards,function(a){return a.id===b});return c>=0?(this.scopeOpts.selectTab(c),!0):!!this.externalDashboards[b]&&(this.bringExternalToFront(b),!0)},d.prototype.bringExternalToFront=function(b){var c=this.externalDashboards[b];c&&c.child.focus(),this.notificationService.showSnackBar(a.stringFormat(a.shell.Strings.Text_Dashboard_AlreadyOpened_Ext,{name:c.name}))},d.prototype.setDashboardController=function(b,c){var d=this;if(b.customController===c)return Q.when(b);var e=a.indexOf(this.scopeOpts.dashboards,function(a){return a.id===b.id}),f=void 0;return"string"==typeof c?f=c:"function"==typeof c?f="<func>":null===c&&(f="<null>"),this.logger.low("setDashboardController",{id:b.id,controller:f}),b._close(!1,"setCtrl").then(function(){return d.openDashboard(b.id,{controller:c,tabPos:e})})},d.prototype.openDashboardClone=function(a,b){var c=__assign({},b,{fromCode:!0,cloned:!0});return this.openDashboardById(a,c)},d.prototype.openDashboard=function(a,b){var c=__assign({},b,{fromCode:!0});return this.openDashboardById(a,c)},d.prototype.openDashboardById=function(b,d){
var e=this,f=Q.when(null);this.scopeOpts.loading&&(f=this.loading.promise);var g="string"==typeof b?b:b.id;return d=d||{},f.then(function(){var f=d&&d.cloned,h=d&&"function"==typeof d.controller,i=e.externalDashboards[g];if(i&&!f)return d.inactive||e.bringExternalToFront(g),Q.when(null);var j=a.firstOrDefault(e.scopeOpts.dashboards,function(a){return a.id===g});if(j&&!f)return d.inactive||e.$rootScope.$evalAsync(function(){var a=e.scopeOpts.dashboards.indexOf(j);a>=0&&(e.scopeOpts.selectTab(a),e.updateState())}),Q.when(j);var k=void 0;return k="string"==typeof b?e.loadDashboard(b,f,h):Q.when(b),k.then(function(b){if(!b)throw e.logger.analytics("Dashboard","OpenFailed",g),new c;if(e.singleDashMgr)return e.singleDashMgr.overwriteDashboard(b);var f={controller:d.controller,tabPos:d.tabPos,inactive:d.inactive};return e.openDashboards([b],f).then(function(){var c=a.firstOrDefault(e.scopeOpts.dashboards,function(a){return a.id===b.id});return c?(c.traceAnalytics("Open",null),d&&d.fromCode&&(c.createdByCode=!0)):e.logger.analytics("Dashboard","OpenFailed",b.id),c})})})},d.prototype.openDashboards=function(b,c){var d=this;if(this.inSingleDashboardMode)throw new Error("Not supported in single dashboard mode");var e=[],f=null;c=c||{},b.forEach(function(b){var c=a.firstOrDefault(d.scopeOpts.dashboards,function(a){return a.id===b.id});c?f=c:e.push(b.getState(!1,!1).then(function(a){return{state:a,dash:b}}))});var g=Q.defer(),h=[],i=function(){if(c.active){var b=a.firstOrDefault(d.scopeOpts.dashboards,function(a){return a.data===c.active});b&&(f=b)}f&&!c.inactive&&d.scopeOpts.selectTab(d.scopeOpts.dashboards.indexOf(f)),d.updateState(),g.resolve(h)};return e.length>0?(this.startLoading(),Q.all(e).then(function(a){return d.$rootScope.$evalAsync(function(){try{a.forEach(function(a){if(a.state){var b=d.createDashboardDescriptor(a.dash,!c.inactive,a.dash.forceEdit,a.state,c.controller);b&&(f=b,h.push(b),d.scopeOpts.addDashboard(f,c.tabPos++))}}),i()}catch(a){g.reject(a)}}),g.promise}).finally(function(){d.$rootScope.$evalAsync(function(){d.endLoading()})})):f?(this.$rootScope.$evalAsync(function(){i()}),g.promise):void 0},d.prototype.removeDashboard=function(b){var c=a.firstOrDefault(this.scopeOpts.dashboards,function(a){return a.id===b});return c?this.removeDashboardDescr(c,"Close").then(function(){return!0}):Q.when(!1)},d.prototype.removeDashboardDescr=function(a,b){var c=this.scopeOpts.dashboards.indexOf(a),d=a.active;a.traceAnalytics(b,null,{wasActive:d,index:c}),this.scopeOpts.removeDashboard(c);var e=a.dispose(),f=this.scopeOpts.dashboards,g=f.length;return d&&g>0&&this.scopeOpts.selectTab(c<g?c:g-1),this.updateState(),e},d.prototype.updateMd=function(b,c,d,e){if(this.inSingleDashboardMode)throw new Error("Not supported in single dashboard mode");var f=a.firstOrDefault(this.scopeOpts.dashboards,function(a){return a.id===b});f&&(f.data.updateVersionExt(c),d&&(f.data.setIntName(d),this.$rootScope.$evalAsync(function(){f.updateCaption()})),e&&f.data.setIntDescription(e))},d.prototype.createDashboardDescriptor=function(a,c,d,e,f){var g=new b.DashboardDescriptor(this,this.dialogService,e,a,{forceEdit:d,isSelector:a&&a.id===b.DashboardStorageService.EMBEDDED_SELECTOR_DASH_ID,overrideController:f});return g.active=c,g},d.prototype.parseLocation=function(){var a=[],b=this.configService.arguments[d.OPEN_DASHBOARD_ID_QUERY_STRING_PARM];b&&(a=b.split(","));var c=this.configService.arguments[d.OPEN_DASHBOARD_NAME_QUERY_STRING_PARM];if(c){var e=c.split(","),f=e.map(function(a){var b=null,c=null,d=null,e=a.split("|");1==e.length?(b=!1,d=e[0]):(b=!0,c=e[0],d=e[1]);var f=d.split("/");return{path:f,shared:b}});return this.findDashboardIds(f).then(function(a){return a.filter(function(a){return!!a})})}return Q.when(a)},d.prototype.clearLocation=function(){this.$location.search(d.OPEN_DASHBOARD_ID_QUERY_STRING_PARM,null),this.$location.search(d.OPEN_DASHBOARD_NAME_QUERY_STRING_PARM,null)},d.prototype.findDashboardIds=function(a){return this.persistenceService.findDashboardsByPath(a).then(function(a){return a.map(function(a){return(a||{}).id})})},d.prototype.startLoading=function(){this.scopeOpts.loading=!0,this.loading=Q.defer()},d.prototype.endLoading=function(){this.scopeOpts.loading=!1,this.loading.resolve(null)},d.prototype.loadDashboards=function(b,c,d){var e=this;if(this.inSingleDashboardMode)throw new Error("Not supported in single dashboard mode");d=d||{},b=b.filter(function(a){return!d[a]}),this.startLoading(),this.scopeOpts.setDashboards([]);var f=b.length-1;if(c){var g=a.lastIndexOf(b,function(a){return a===c});g>=0&&(f=g)}var h=b.map(function(a,b){return e.loadDashboard(a).then(function(a){return a?a.getState(!1,!1).then(function(c){return e.createDashboardDescriptor(a,b===f,!1,c)}):null})});return this.$q.when(Q.all(h)).then(function(a){e.scopeOpts.setDashboards(a.filter(function(a){return!!a})),e.scopeOpts.dashboards.forEach(function(a){a.traceAnalytics("LoadDashboard",null)}),e.activeDashboardChangedEvent.raise(e,null)}).finally(function(){e.endLoading()})},d.prototype.isDirty=function(a){var b=this.component.getChild(a);return b&&b.dirty},d.prototype.isAnyDirty=function(){var b,c=this,d=this.scopeOpts.dashboards.filter(function(a){return c.isDirty(a.id)&&a.canSave()});return b=1===d.length?a.stringFormat(a.shell.Strings.Text_Dashboard_Warn_Unsaved_Quit,{name:d[0].title.caption}):a.stringFormat(a.shell.Strings.Text_Dashboard_Warn_Unsaved_QuitN,{names:d.map(function(a){return a.title.caption}).join(", ")}),{isDirty:d.length>0,reason:b}},d.prototype.loadDashboard=function(a,b,c){return this.persistenceService.getSerializableDashboard(a,b,c)},d.prototype.createNewDashboard=function(a,b){var c=this;if(this.inSingleDashboardMode)throw new Error("Not supported in single dashboard mode");var d=Q.defer();return this.createNewDashboardData(a).then(function(a){c.$rootScope.$evalAsync(function(){var e=c.createDashboardDescriptor(a,!0,!1,null),f=c.scopeOpts.addDashboard(e);c.scopeOpts.selectTab(f-1),e.enterEditAndRenameMode(!0),c.updateState(),b?e.initialized.then(function(){d.resolve(e)}).done():d.resolve(e)})}).catch(function(a){d.reject(a)}),d.promise},d.prototype.createNewDashboardData=function(c){return this.persistenceService.create(c,b.DashboardStorageService.DashboardFileType,a.shell.Strings.Text_Prefix_New_Dashboard).then(function(a){return a.dashboard})},d.prototype.createDashboardSelectorView=function(){var a=this;if(this.inSingleDashboardMode)throw new Error("Not supported in single dashboard mode");if(this.environmentService.isOffline||!this.isEnabled)return Q.when(!1);var c=this.persistenceService.getEmbeddedDashboardSelector(),d=new b.DashboardDescriptor(this,this.dialogService,null,c,{isSelector:!0}),e=Q.defer();return this.$rootScope.$evalAsync(function(){var b=a.scopeOpts.addDashboard(d);a.scopeOpts.selectTab(b-1),a.updateState(),d.initialized.then(function(){return e.resolve(!0)}).done()}),e.promise},d.prototype.showRepositoryError=function(){this.notificationService.showError(a.shell.Strings.Err_Dashboard_RootFolder,a.shell.Strings.Err_Dashboard_RootFolder_Sec)},d.prototype.popinDashboard=function(b){var c=this,d=this.externalDashboards[b];if(delete this.externalDashboards[b],this.updateListState(),d&&!a.firstOrDefault(this.scopeOpts.dashboards,function(a){return a.id===b}))return this.logger.low("Popin_reopen",{id:b}),this.loadDashboard(b).then(function(a){if(a)return c.openDashboards([a],{active:a,tabPos:d.oldPosition}).then(function(){return null})})},d.prototype.loadExternalDashboard=function(c,e,f,g,h){var i=this,j=h&&b.isInternalDashboard(c),k={};j&&(k[c]={id:c,displayName:f,isInternal:!0,type:a.DashboardDefinitionType.Dashboard,content:JSON.parse(JSON.stringify(h.getCurrentState(),a.LazySerializable.jsonReplacer))}),j||(e.closed.add(function(a,b){i.popinDashboard(c).done()}),e.layoutChanged.add(function(a,b){i.updateListState()}));var l={};l[d.OPEN_DASHBOARD_ID_QUERY_STRING_PARM]=c,e.loadSdk({shell:{disableNavBar:!0,childTitle:f,intDashboardsContent:k}},"",l),j||(this.externalDashboards[c]={child:e,name:f,oldPosition:g})},d.prototype.popOutDashboard=function(b){var c=this;if(b&&!this.inSingleDashboardMode){var d=b.id,e=this.childWindowService.openNew();b.traceAnalytics("Popout",null),b.saveImmediate("popout").then(function(){var f=a.indexOf(c.scopeOpts.dashboards,function(a){return a.id===d});c.loadExternalDashboard(d,e,b.data.getName(),f,b),c.$rootScope.$evalAsync(function(){var b=a.firstOrDefault(c.scopeOpts.dashboards,function(a){return a.id===d});b&&c.removeDashboardDescr(b,"Popout").done()}),c.notificationService.showSnackBar(a.stringFormat(a.shell.Strings.Text_Dashboard_DashboardPoppedOut,{name:b.title.caption}))}).done()}},d.prototype.popInCurrent=function(){var a=this.activeDashboard;a&&a.saveImmediate("popin").then(function(a){a.result&&window.setTimeout(function(){window.close()},1e3)}).done()},Object.defineProperty(d.prototype,"dashboards",{get:function(){return this.scopeOpts.dashboards.reduce(function(a,b){return a[b.id]=b,a},{})},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"dashboardList",{get:function(){return this.scopeOpts.dashboards.slice()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"dashboardsChanged",{get:function(){return this.dashboardsChangedEvent},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"activeDashboardChanged",{get:function(){return this.activeDashboardChangedEvent},enumerable:!0,configurable:!0}),d.prototype.findParent=function(a){for(;a;){var b=a.parent;if(b===this.component){var c=a.id;return this.dashboards[c]}a=b}return null},d.prototype.bringToFront=function(a){this._bringingComponentToFront.raise(this,a)},Object.defineProperty(d.prototype,"bringingComponentToFront",{get:function(){return this._bringingComponentToFront},enumerable:!0,configurable:!0}),d.prototype.installKeyHandlers=function(b,c){var d=this;this.keyHandler=function(b){b.keyCode!==a.KeyCodes.ESC||b.defaultPrevented||(c.$evalAsync(function(){var a=d.activeDashboard;a?a.onEscPressed():d.escPressed.raise(d,null)}),b.preventDefault())},b.window.addEventListener("keydown",this.keyHandler,!1)},d.prototype.uninstallKeyHandlers=function(a,b){a.window.removeEventListener("keydown",this.keyHandler,!1)},d.prototype.registerDashboard=function(a,b){return this.persistenceService.registerDashboardDef(a.moduleKey,a.moduleName,b)},d.prototype.getAppDashboards=function(){return this.persistenceService.getAppDashboards()},d.prototype.notifySavedState=function(a){this.savedStateChanged.raise(this,a)},d.prototype.reorder=function(b,c,d){var e=this;0!=this.scopeOpts.dashboards.length&&b&&c&&b!==c&&this.$rootScope.$evalAsync(function(){var f=a.indexOf(e.scopeOpts.dashboards,function(a){return a.id===b});if(f>=0){var g=e.scopeOpts.dashboards[f];e.scopeOpts.dashboards.splice(f,1);var h=a.indexOf(e.scopeOpts.dashboards,function(a){return a.id===c});h<0&&(h=e.scopeOpts.dashboards.length-1,d=!0),d&&h++,e.scopeOpts.dashboards.splice(h,0,g),e.updateListState()}})},d.prototype.importDashboard=function(c){var d;try{if(d=JSON.parse(c),!d||"object"!=typeof d||!d.content)throw new Error("Invalid dashboard JSON file")}catch(a){return this.excHelper.log(a,this.logger),this.notificationService.showError("Invalid JSON/dashboard definition"),Q.when(null)}var e={content:d.content,displayName:d.displayName||"No Name",isInternal:!0,moduleName:null,id:b.APP_DASH_PREFIX+a.createNewGuid()},f=b.SerializableDashboard.fromDashboardAppData(this.persistenceService,e);switch(d.type){case b.DashboardStorageService.WidgetFileType:return this.openWidgets(null,null,[f]).then(function(){return null});default:return this.component.importDashboardUserPrefs(f.id,d.userPrefs||{}),this.inSingleDashboardMode?this.singleDashMgr.overwriteDashboard(f).then(function(){return null}):this.openDashboards([f]).then(function(a){return a[0]})}},d.prototype.getComponentState=function(a,c,d){return{state:a.getState(),typeId:a.typeId,width:c.width,height:c.height,captionStyle:d?b.cleanCompData(d).captionStyle:void 0,hideCaption:a.hideCaption}},d.prototype.saveComponent=function(a,c,d,e,f){var g=this,h=this.getComponentState(c,d,f),i=this.catalogService.findComponentType(c.typeId),j=i&&i.displayName,k={widgetType:i.id};return this.persistenceService.overwriteInteractive(null,b.DashboardStorageService.WidgetFileType,e||c.title,h,j,k).then(function(b){if(b){var c=g.$rootScope.$new();c.name=b.getName(),c.folder=b.category,c.organize=function(){g.scopeOpts.showWidgetSelector(a)},g.notificationService.showSnackBar({templateUrl:"shell.ui/dashboard/widgetSavedToast.tpl.html",scope:c})}return b})},d.prototype.exportComponent=function(c,d,e,f){var g=this.getComponentState(c,d,f),h=(this.catalogService.findComponentType(c.typeId),{content:g,displayName:e||c.title,type:b.DashboardStorageService.WidgetFileType});this.fileExportService.exportFile(JSON.stringify(h,a.LazySerializable.jsonReplacer),"text/json",(e||c.title)+".json")},d.prototype.openWidgets=function(a,b,c){var d=this,e=function(a){return a.getState(!1,!1).then(function(b){var c=b;return c.name=a.getName(),c})};b=b||[],c=c||[];var f=b.map(function(a){return{compTypeId:a}}),g=[];return this.logger.low("openWidgets",{compTypeIds:b,sampleWidgets:c&&c.map(function(a){return a.id})}),Q.all(c.map(function(a){return e(a).then(function(a){return g.push(a)})})).then(function(){var b=f.concat(g.map(function(a){return{compTypeId:a.typeId,state:a.state,captionStyle:a.captionStyle,title:a.name,width:a.width,height:a.height,hideCaption:a.hideCaption}})),c=function(a,b,c){var d=a._createComponent(b.compTypeId,c,b.title,{width:b.width,height:b.height},b.captionStyle,b.hideCaption);b.state&&d.setState(b.state)},e=a===!1;e||(a=a||d.activeDashboard),a||(e=!0);var h=e?d.createNewDashboard(null,!0):Q.when(a);return h.then(function(a){return a.inDashboardSelectMode?a.createEmpty(!0).then(function(){b.forEach(function(b){return c(a,b,!1)})}):(a.hideWidgetSelector(),void b.forEach(function(b){return c(a,b,!0)}))})})},d.prototype.canCheckForUpdate=function(){return this.singleDashMgr&&this.singleDashMgr.canCheckForUpdate()},d.prototype.checkForUpdate=function(){this.singleDashMgr&&this.singleDashMgr.checkForUpdate()},d.prototype.cleanComponentData=function(a,b){this.component.removeCompUserData(a.id,b)},d.prototype.closeAllDashboards=function(a){return Q.all(this.dashboardList.map(function(b){return a||!b.isLocal()?b._close(!1,"closeAll"):void Q.when(null)}))},Object.defineProperty(d.prototype,"canImportExportDashboards",{get:function(){return!this.configService.config.shell.lockedWorkspace},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"canCreateDashboards",{get:function(){return!this.configService.config.shell.lockedWorkspace},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"canEditDashboards",{get:function(){return!this.configService.config.shell.lockedWorkspace},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"canShowHistory",{get:function(){return!this.configService.config.shell.lockedWorkspace},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"canCloseDashboards",{get:function(){return!(this.configService.config.shell.lockedWorkspace&&this.persistenceService.workspaceLoaded)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"canBrowseDashboards",{get:function(){return!(this.configService.config.shell.lockedWorkspace&&this.persistenceService.workspaceLoaded)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"canRearrangeDashboards",{get:function(){return!(this.configService.config.shell.lockedWorkspace&&this.persistenceService.workspaceLoaded)},enumerable:!0,configurable:!0}),d.prototype.checkForUuidUpdate=function(b,c,d){var e,f=this;e=d?Q.when({id:d.id,uuid:d.uuid,version:d.getVersion(),name:d.getName()}):this.storageService.loadByUuid(b).then(function(a){return a.affectedStoreMetadata&&{id:a.affectedStoreMetadata.id,uuid:a.affectedStoreMetadata.contentProperties.uuid,version:a.affectedStoreMetadata.version,name:a.affectedStoreMetadata.contentProperties.displayName}},function(){return null});var g,h,i,j;return e.then(function(d){if(d&&d.uuid===b&&(g=!0,j=d.version,d.version>c))return f.dialogService.showQuestionDialog(a.stringFormat(a.shell.Strings.Dashboard_Single_UpdateMsg,{name:d.name}),a.shell.Strings.Dashboard_Single_UpdateTitle,a.shell.Strings.Dashboard_Single_UpdatePos,a.shell.Strings.Dashboard_Single_UpdateNeg).closed.then(function(b){b.cancel||b.value!==a.DialogResult.Ok?h=!0:i=d.id})}).then(function(){return i?(d&&d.id===i?Q.when(d):f.loadDashboard(i)).then(function(a){return a?{dashboard:a,foundVersion:j}:{notFound:!0}}):h?{cancel:!0,foundVersion:j}:g?{}:{notFound:!0}})},d.prototype.checkForDashboardUpdates=function(c){var d=this;return Q.all(c.map(function(c){var e=a.firstOrDefault(d.scopeOpts.dashboards,function(a){return a.id===c});if(e.compProps){var f=e.compProps.getValue(b.SerializableDashboard.SOURCE_DASH_MD);if(f&&f.lastUuid&&f.lastVersion)return d.checkForUuidUpdate(f.lastUuid,f.lastVersion).then(function(a){return a.dashboard&&!a.cancel?a.dashboard.getState(!1,!1).then(function(c){return b.SerializableDashboard.setDashSourceInState(c,a.dashboard),e.reconnect(c)}):void(a.cancel&&a.foundVersion&&(f.lastVersion=a.foundVersion,e.compProps.setValue(b.SerializableDashboard.SOURCE_DASH_MD,f)))})}})).then(function(){return null})},d.OPEN_DASHBOARDS_PROP_BACKW="dashboardIds",d.ACTIVE_DASHBOARD_PROP_BACKW="activeDashboard",d.OPEN_DASHBOARDS_PROP="dashboardIds2",d.ACTIVE_DASHBOARD_PROP="activeDashboard2",d.EXT_DASHBOARDS_PROP="dashPopoutLayouts",d.OPEN_DASHBOARD_ID_QUERY_STRING_PARM="dashboard",d.OPEN_DASHBOARD_NAME_QUERY_STRING_PARM="dashboardName",d.PLACEHOLDER_COMP_ID="_dash.placeholder",d.MAXIMIZE_PREF_KEY="Dashboard_showMaximizeButtonWhenCaptionsAreHidden",d}();b.DashboardService=d,angular.module("ionwebShell").service("ionweb.dashboardService",["$rootScope","$q","$location","ionweb.configurationService","ionweb.serverService","ionweb.notificationService","ionweb.localPreferenceStore","ionweb.dashboardStorageService","ionweb.rootComponentService","ionweb.preferenceService","ionweb.toolbarService","ionweb.dialogService","ionweb.childWindowService","ionweb.contextMenuService","ionweb.embeddingService","ionweb.loggerFactory","ionweb.actionService","ionweb.catalogService","ionweb.excHelper","ionweb.fileExportService","ionweb.storageService","ionweb.environmentService","ionweb.shellModuleLoader","ionweb.popupService",d])}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){angular.module("ionwebShell").directive("collapsibleTabPanel",["$timeout",function(b){var c=function(c){var e=new a.Event,f=new a.Event;c.titleTemplateUrl="shell.ui/dashboard/collapsibleTabPanel/collapsibleTabPanelTitle.tpl.html",c.titleScope=c,c.state={tabConfigs:[],collapsed:c.component.userData.getValue("collapsed",!1),visible:!1,activeTabId:null,resizable:!0},c.makeActive=function(a){c.state.resizable=a.tab.resizable!==!1,c.state.activeTabId=a.id};var g=function(a,b){c.state.resizable=b.tab.resizable!==!1},h=function(a){c.$evalAsync(function(){var b=c.state.tabConfigs.indexOf(a);b>-1&&(c.state.tabConfigs.splice(b,1),c.state.visible=!!c.state.tabConfigs.length)})},i=function(){c.state.visible=!1,c.state.tabConfigs=[],f.raise(d,null)},j=function(d){var e=c.state.tabConfigs.some(function(a){return a.id===d.id});if(e)throw new Error(a.stringFormat(a.shell.Strings.Text_Dashboard_Err_Duplicate_Side_Panel_Tab,{id:d.id}));var i={id:d.id,tab:d,onTabSelected:g};return c.state.tabConfigs.push(i),c.state.visible=!0,c.state.activeTabId||b(function(){c.state.activeTabId=i.id},0),{remove:function(){h(i)},removed:f}};c.$watch("state.collapsed",function(a,b){a!==b&&c.component.userData.setValue("collapsed",a)}),c.$on("$destroy",function(){i(),e.raise(d,null)}),c.$collapsibleTabPanelConfig.onBind({addTab:j,removeAllTabs:i,destroyed:e})},d={restrict:"EA",scope:!0,link:c,templateUrl:"shell.ui/dashboard/collapsibleTabPanel/collapsibleTabPanel.tpl.html"};return d}])}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=0,c=100;angular.module("ionwebShell").directive("collapsibleTabPanelResizer",["$document",function(a){var d=function(d,e,f){var g=0,h=0,i=e.closest(d.$collapsibleTabPanelConfig.boundingContainerClass)||a,j=e.children(".collapsible-tab-panel-resize-handle"),k="vertical"===d.$collapsibleTabPanelConfig.orientation,l="vertical-inverse"===d.$collapsibleTabPanelConfig.orientation,m="horizontal"===d.$collapsibleTabPanelConfig.orientation,n="horizontal-inverse"===d.$collapsibleTabPanelConfig.orientation,o=function(a){if(d.state&&d.state.activeTabId){var b=d.state.tabConfigs.filter(function(a){return a.id===d.state.activeTabId&&a});b.length&&(b[0].size=a)}},p=function(a,b){var c={width:"",minWidth:"",maxWidth:"",height:"",minHeight:"",maxHeight:""};m||n?("number"==typeof a&&(c.minWidth=a),"number"==typeof b&&(c.maxWidth=b)):(k||l)&&("number"==typeof a&&(c.minHeight=a),"number"==typeof b&&(c.maxHeight=b)),e.css(c)},q=function(a,e){var f=Math.floor(e*(d.$collapsibleTabPanelConfig.minSize||b)/100),g=Math.floor(e*(d.$collapsibleTabPanelConfig.maxSize||c)/100);return Math.floor(Math.min(Math.max(f,a),g))},r=function(a){m||n?e.css({width:a,minWidth:a,maxWidth:a,height:"",minHeight:"",maxHeight:""}):(k||l)&&e.css({width:"",minWidth:"",maxWidth:"",height:a,minHeight:a,maxHeight:a})},s=function(){var a=0;return k||l?a=i.height():(m||n)&&(a=i.width()),a},t=function(a){var b,c,d=a.originalEvent,e=s();k?(b=a.clientY||d.touches&&d.touches[0].clientY,c=h+(b-g)):l?(b=a.clientY||d.touches&&d.touches[0].clientY,c=h+(g-b)):m?(b=a.clientX||d.touches&&d.touches[0].clientX,c=h+(b-g)):n&&(b=a.clientX||d.touches&&d.touches[0].clientX,c=h+(g-b)),c=q(c,e),r(c),o(c)},u=function(b){b.preventDefault(),g=k||l?j[0].getClientRects()[0].top:j[0].getClientRects()[0].left,h=k||l?e[0].getClientRects()[0].height:e[0].getClientRects()[0].width,a.on("mousemove touchmove",t),a.on("touchend mouseup",v)},v=function(){a.off("touchmove mousemove",t),a.off("touchend mouseup",v)};d.$watchGroup(["state.collapsed","state.visible","state.activeTabId","state.resizable"],function(a,b){var e=0;for(e=0;e<a.length&&a[e]===b[e];++e);if(e!==a.length&&d.state.activeTabId){var f=d.state.tabConfigs.filter(function(a){return a.id===d.state.activeTabId&&a});if(f.length&&d.state.visible&&!d.state.collapsed)if(d.state.resizable){j.on("mousedown touchstart",u);var g=f[0].size;if("number"==typeof g)g=q(g,s()),r(g);else{var h=s(),i=Math.floor(h*(d.$collapsibleTabPanelConfig.maxSize||c)/100);p(null,i)}}else{j.off("mousedown touchstart",u);var h=s(),i=Math.floor(h*(d.$collapsibleTabPanelConfig.maxSize||c)/100);p(null,i)}else p()}}),d.$on("$destroy",function(){j.off("mousedown touchstart",u),a.off("touchmove mousemove",t),a.off("touchend mouseup",v)})};return{restrict:"A",link:d}}])}(b=a.dashboard||(a.dashboard={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){angular.module("ionwebShell").directive("ionwebHome",["$q","ionweb.homeService","ionweb.excHelper","ionweb.dialogService","ionweb.notificationService","ionweb.dashboardService","ionweb.contextMenuService","ionweb.environmentService","ionweb.catalogService","ionweb.loggerFactory","ionweb.preferenceService","ionweb.serverService",function(c,d,e,f,g,h,i,j,k,l,m,n){return{restrict:"A",scope:{dashOpts:"=options",filterOptions:"=?",dashboard:"=?",widgetOnly:"=?",compact:"=?",onSelect:"&?"},templateUrl:"shell.ui/home/home.tpl.html",link:function(e,o){function p(a){var b=a&&k.findComponentType(a),c=b&&b.icon;return k.getComponentIcon(c)}var q="ionweb.homeSplitterSize",r=l.create("Home"),s=function(a){var b=e.treeOptions.getNodePath(a).map(function(a){return a.name}).join("/");r.analytics("Mapping","Folder","Id"+a.key+";Path:"+b)},t=function(a){return!a.children||0===a.children.length},u=function(){e.loading=!0,e.done(d.fetchTree().then(function(a){e.model=a,e.filterOptions.modelRoot?e.treeOptions.root=a[e.filterOptions.modelRoot]:e.treeOptions.root=a.root,t(e.model.private)||(e.hidePrivate=!1),e.treeOptions.currentPath=e.compact?e.treeOptions.root:e.hidePrivate?a.shared:a.private}).finally(function(){e.loading=!1}))};e.reduceToRefreshError=function(b){f.showConfirmationDialog({textContent:b,severity:a.DialogSeverity.Danger},"Error",a.shell.Strings.Err_Home_RefreshBtn).closed.then(function(a){a.cancel||u()})};var v=function(b,c){return f.showConfirmationDialog({textContent:b,severity:a.DialogSeverity.Danger},c||"Error").closed};e.splitter={position:m.getValue(q,20)},e.$watch("splitter.position",function(a,b){a!==b&&m.setValue(q,a)}),e.done=function(b){b.catch(function(b){if(b.storageErrorType)switch(b.storageErrorType){case a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND:e.reduceToRefreshError(a.shell.Strings.Err_Home_StorageNotFound);break;case a.StorageErrorTypes.VERSION_MISMATCH_LOCKING_EXCEPTION:e.reduceToRefreshError(a.shell.Strings.Err_Home_VersionMismatch);break;default:a.getService("ionweb.excHelper").report(b)}else a.getService("ionweb.excHelper").report(b)}).then(function(a){angular.isArray(a)&&angular.forEach(a,function(a){a&&a.message&&v(a.message)})})};var w=!!e.filterOptions;e.filterOptions=e.filterOptions||{},e.filterOptions.filters=[],e.filterOptions.filters.push({id:"all",name:a.shell.Strings.Text_Home_All}),e.filterOptions.filters.push({id:"dashboard",name:a.shell.Strings.Text_Home_Dashboards}),e.filterOptions.filters.push({id:"widget",name:a.shell.Strings.Text_Home_Widgets}),e.filterOptions.selectFilter=function(a){e.filterOptions.activeFilter=a,e.filterOptions.showDashboards="all"===a.id||"dashboard"===a.id,e.filterOptions.showWidgets="all"===a.id||"widget"===a.id},w||e.filterOptions.selectFilter(e.filterOptions.filters[0]),e.widgetOnly&&(e.filterOptions.showDashboards=!1),e.dashOpts.canCreateNew||(e.filterOptions.showWidgets=!1,e.dashboardOnly=!0,e.hidePrivate=!0),e.refreshDetailsView=new a.Event,e.treeOptions={root:void 0,getIcon:function(a){if(!e.model)return null;if(a==e.model.private)return"home";if(a==e.model.favorites)return"star";if(a==e.model.lastUsed)return"clock";if(a==e.model.shared)return"public";switch(a.type){case b.TreeNodeType.Folder:return a.isSample?"samples":"folder";case b.TreeNodeType.Dashboard:return"dashboard";case b.TreeNodeType.DefaultWidget:case b.TreeNodeType.StatefulWidget:return p(a.widgetId)||"widget"}},getNodePath:function(a){var b=[],c=a;do b.unshift(c);while(c=c.parent);return b},dragStart:function(a,b){return e.filterOptions.isMultiSelectionMode||j.isMobileDevice()||a.setData("nodeKeys",b.map(function(a){return a.key})),!1},canDrop:function(a,b){var c=a.getData("nodeKeys");if(!c)return!1;var d=c.map(function(a){return e.model.find(a)});return e.canMove(d,b)},onDrop:function(b,c){var d=b.getData("nodeKeys"),g=d.map(function(a){var b=e.model.find(a);return b.linkedTo&&(b=b.linkedTo),b});if(g.length>0){var h=Q.defer(),i=g.filter(function(a){return a.isSample}).length>0;i?f.showQuestionDialog(a.shell.Strings.Text_Home_ConfirmCopy).closed.then(function(b){b.cancel||b.value!==a.DialogResult.Ok?h.reject(null):h.resolve(null)}):h.resolve(null),Q.when(h.promise).then(function(){e.moveNodes(g,c,function(){e.refreshDetailsView.raise(e,null)})})}}},e.createFolder=function(a,c){a.type===b.TreeNodeType.Folder&&e.done(e.model.createFolder(a).then(function(a){return c(a),a}))},e.newDashboardAndOpen=function(a,c){return c||(c=e.treeOptions.currentPath),c.type!==b.TreeNodeType.Folder?Q.when(null):e.dashboard?e.dashboard.createEmpty(a,c.key):Q.when(e.model.createDashboard(c)).then(function(a){return h.openDashboardById(a.node.serializableItem)}).then(function(b){return b.enterEditAndRenameMode(a),b.displayName})},e.canCreateDashboard=function(a){return a&&e.model.canCreateDashboard(a)},e.canCreateFolder=function(a){return a&&e.model.canCreateFolder(a)},e.getRoot=function(a){for(var b=a;b.parent;)b=b.parent;return b},e.canMove=function(a,b){return a.every(function(a){return e.model.canMove(a,b)})},e.moveNodes=function(c,d,g){if(c&&c.length){var h=e.getRoot(d)===e.model.private,i=null,j=c.filter(function(a){if(a.parent.key===d.key)return!1;var c=e.getRoot(a)===e.model.private;if(c!==h){var f=h?e.model.private:e.model.shared,g=function(a,b){if(a&&b&&a.key===b.key)return!0;var c=!1;return a.children&&a.children.forEach(function(a){g(a,b)&&(c=!0)}),c},j=!1;return f.children&&f.children.forEach(function(c){c.type===b.TreeNodeType.Folder&&g(c,a)&&(j=!0,i=e.treeOptions.getNodePath(c).map(function(a){return a.name}).join("/"))}),j}return!1}),k=function(a,b){return s(b),angular.isFunction(g)&&g(),a};if(j.length){var l=void 0;l=j.length>1?a.stringFormat(h?a.shell.Strings.Text_MovingToDifferentRootConfirmation_MultiplePrivate:a.shell.Strings.Text_MovingToDifferentRootConfirmation_MultipleShared,{targetFolder:e.treeOptions.getNodePath(d).map(function(a){return a.name}).join("/")}):a.stringFormat(a.shell.Strings.Text_MovingToDifferentRootConfirmation_Single,{targetFolder:e.treeOptions.getNodePath(d).map(function(a){return a.name}).join("/"),prevFolder:i}),l&&f.showQuestionDialog(l,a.shell.Strings.Move_Confirmation_Title,a.shell.Strings.Move_Confirmation_Move,a.shell.Strings.Move_Confirmation_Cancel).closed.then(function(b){b.cancel||b.value!==a.DialogResult.Ok||e.done(e.model.move(c,d).then(function(a){return k(a,d)}))})}else e.done(e.model.move(c,d).then(function(a){return k(a,d)}))}},e.addMoveShareActions=function(c,d,g,h){var j=[],k=!0,l=!1,m=!1,n=!1,o=function(a){var c={text:a.name,action:function(){e.canMove(d,a)&&e.moveNodes(d,a,function(){angular.isFunction(h)&&h()})}};return(a.children||[]).forEach(function(a){a.type===b.TreeNodeType.Folder&&a.canWriteChildren&&d.indexOf(a)===-1&&(c.subMenu||(c.subMenu=[]),c.subMenu.push(o(a)))}),c},p=function(b,c,d){var e=o(b),f={icon:c||"move",text:d||a.shell.Strings.Text_Home_Move,subMenu:[e]};return g||(f.action=function(a){i.openContextMenu([e],a.target)}),f},q=function(){return{icon:"public",text:a.shell.Strings.Text_Dashboard_Menu_Unshare,action:function(){var b=1===d.length?a.shell.Strings.Text_Home_UnshareFile:a.shell.Strings.Text_Home_UnshareFiles;f.showQuestionDialog(b).closed.then(function(b){return b.cancel||b.value!==a.DialogResult.Ok?null:e.model.unshare(d).then(function(a){return angular.isFunction(h)&&h(),a})})}}};if(d.forEach(function(a){var c=e.getRoot(a);j.indexOf(c)<0&&j.push(c),a.canMove||(k=!1),e.model.canUnshare(a)&&(l=!0),a.isShared&&(m=!0),a.type===b.TreeNodeType.Folder&&(n=!0)}),1===j.length){var r=j[0]===e.model.shared;if(r&&!n&&e.model.private.canWriteChildren){var s=p(e.model.private,"home",a.shell.Strings.Text_Home_Organize);s&&c.push(s)}if(k&&(r&&e.model.shared.canWriteChildren||!r&&e.model.private.canWriteChildren)){var t=p(r?e.model.shared:e.model.private);t&&c.push(t)}if(!r&&!m&&!n&&e.model.shared.canWriteChildren){var u=p(e.model.shared,"public",a.shell.Strings.Text_Home_Share);u&&c.push(u)}l&&c.push(q())}},e.generatePrimaryCaption=function(b,d,f){var g={caption:b.name,enabled:!1,showEdit:a.dashboard.EditMode.OnContextMenu,contextMenu:function(){return{items:d()}},renamed:function(d,h){var i=e.model.validateNewName(b,d);i&&i.error?(v(a.stringFormat(a.shell.Strings.Err_Home_BadNameFormat,{err:i.error}),a.shell.Strings.Err_Home_Title_Rename),g.caption=h):e.done(e.model.rename(b,d).catch(function(a){return g.caption=h,c.reject(a)}).finally(function(){g.description=f&&f()}))},description:f&&f()};return g},e.generateSecondaryCaption=function(b,d){var f={caption:b.description,enabled:!1,showEdit:a.dashboard.EditMode.OnContextMenu,contextMenu:function(){return{items:d()}},renamed:function(d,g){return e.done(e.model.editDesc(b,d).catch(function(b){return f.caption=g,"undefined"!=typeof b.storageErrorType?c.reject(b):void v(a.stringFormat(a.shell.Strings.Err_Home_BadDescriptionFormat,{err:b.message}),a.shell.Strings.Err_Home_Title_Rename)}))}};return f},e.getDeleteOption=function(b,c){return{icon:"delete",
text:a.shell.Strings.Text_Dashboard_Menu_Delete,action:function(){var d=e.$new();d.message=b.length>1?a.stringFormat(a.shell.Strings.Text_Dashboard_MultipleDeleteConfirmation_Multiple,{count:b.length}):a.stringFormat(a.shell.Strings.Text_Dashboard_MultipleDeleteConfirmation_Single,{name:b[0].name}),d.dangerMessages=[];var h=[],i=!1;b.forEach(function(a){a.canDelete&&a.isShared&&(i=!0),a.children&&(h=h.concat(a.children))}),i&&d.dangerMessages.push(a.shell.Strings.Text_Home_DeleteShared);var j=function(a){for(var b=0;b<a.length;b++){var c=!1,d=a[b];if(d.canDelete&&d.isShared)return!0;if(d.children&&(c=j(d.children)),c)return!0}return!1};j(h)&&d.dangerMessages.push(a.shell.Strings.Text_Home_DeleteSharedSubfolder),f.showQuestionDialog({scope:d,severity:d.dangerMessages.length>0?a.DialogSeverity.Danger:a.DialogSeverity.Info,template:'<div class="ionweb-home-confirm-delete"><p>{{message}}</p><p class="ionweb-home-confirm-delete-danger-message" ng-repeat="dangerMessage in dangerMessages track by $index"><span class="ionweb-home-confirm-delete-icon ionicon ionicon-error text-danger"></span>{{dangerMessage}}</p></div>'},a.shell.Strings.Delete_Confirmation_Title,a.shell.Strings.Delete_Confirmation_Delete,a.shell.Strings.Delete_Confirmation_Cancel).closed.then(function(f){f.cancel||f.value!==a.DialogResult.Ok||e.done(e.model.delete(b).then(function(b){if(0===b.length)angular.isFunction(c)&&c();else{var d=a.stringFormat(a.shell.Strings.Err_Home_ErrorDuringDelete,{node:b.map(function(a){return a.node.name}).join(", ")}),e=b.map(function(a){return a.error.message}).join(", ");g.showError(d,e)}},function(a){g.showError(a.message)})),d.$destroy()})}}};var x=function(){e.offline=j.isOffline};x(),j.isOfflineChanged.add(function(){return e.$evalAsync(function(){return x()})}),n.getServerVersion().then(function(b){(!b||b.compareTo(a.IonVersion.fromIonString("121"))<0)&&e.$evalAsync(function(){return e.hideTags=!0})}),u()}}}]);var c=function(){function c(a,b){this.dashboardService=a,this.scope=b,this.dashboardStorageService=a.persistenceService,this.notificationService=a.notificationService}return c.prototype.reportMissingStorages=function(b){var c=this;this.scope?this.scope.$evalAsync(function(){b?(c.scope.dashOpts.homeShown=!0,c.notificationService.showError(a.shell.Strings.Err_Home_StorageNotFound)):c.scope.reduceToRefreshError&&c.scope.reduceToRefreshError(a.shell.Strings.Err_Home_StorageNotFound)}):this.notificationService.showError(a.shell.Strings.Err_Home_StorageNotFound)},c.prototype.openWidgets=function(c,d,e){var f=this,g=d.filter(function(a){return a.type===b.TreeNodeType.DefaultWidget}),h=d.filter(function(a){return a.type===b.TreeNodeType.StatefulWidget});return d.forEach(function(b){f.dashboardStorageService.updateLastAccessTime(b.key,a.localization.moment(),!1)}),Q.all(h.map(function(a){return f.dashboardStorageService.getSerializableDashboard(a.key)})).then(function(b){if(a.any(b,function(a){return!a}))throw new a.dashboard.StorageMissingError;return f.dashboardService.openWidgets(c||!1,g.map(function(a){return a.widgetId}),b)}).then(function(){c&&c.closeWidgetSelector()}).catch(function(b){if(!(Array.isArray(b)&&a.all(b,function(b){return b.storageErrorType===a.StorageErrorTypes.STORAGE_AREA_NOT_FOUND})||b.missingStorage))throw b;f.reportMissingStorages(e)})},c.prototype.openDashboards=function(c,d,e){var f=this,g=d.filter(function(a){return a.type===b.TreeNodeType.Dashboard});return d.forEach(function(b){f.dashboardStorageService.updateLastAccessTime(b.key,a.localization.moment(),!0)}),Q.when(null).then(function(){return c?c.dashboardsSelected(g.map(function(a){return{dashId:a.key,name:a.name}})).catch(function(a){if(!a.missingStorage)throw a;f.reportMissingStorages(e)}):Q.all(g.map(function(a){return f.dashboardService.openDashboardById(a.key).catch(function(a){if(!a.missingStorage)throw a;f.reportMissingStorages(e)})}))})},c}();b.HomeHelper=c}(b=a.home||(a.home={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(a){a[a.Asc=0]="Asc",a[a.Desc=1]="Desc"}(c||(c={}));var d;!function(a){a[a.Tiles=0]="Tiles",a[a.List=1]="List"}(d=b.DetailsViewType||(b.DetailsViewType={}));var e;!function(a){a[a.ListItem=0]="ListItem",a[a.TileItem=1]="TileItem",a[a.TileFolder=2]="TileFolder"}(e||(e={}));var f=function(){function f(c,e,f,g,h,i,j,k,l,m,n){var o=this;this.scope=c,this.$q=f,this.$timeout=g,this.contextMenuService=h,this.dialogService=i,this.notificationService=j,this.homeService=k,this.dashboardService=l,this.dashboardStorageService=m,this.environmentService=n,this.inOpening=!1,this.scope.availableViews={},this.scope.availableViews[d.Tiles]={icon:"tiles-view",class:"ionweb-home-tiles-view",type:d.Tiles,directory:"shell.ui/home/tilesView/"},this.scope.availableViews[d.List]={icon:"list-view",class:"ionweb-home-list-view",type:d.List,directory:"shell.ui/home/listView/"},this.scope.selectedView=this.scope.availableViews[this.scope.compact?d.List:d.Tiles],this.scope.changeView=function(a){o.scope.selectedView=a,o.refreshFolder()},this.scope.sections={};var p=null;c.$watch("model",function(){p&&p(),p=o.scope.model&&o.scope.model.nodeChanged.add(function(a,b){b.node!==c.treeOptions.currentPath&&b.node.parent!==c.treeOptions.currentPath||o.refreshFolder()})}),c.nodeTypes=b.TreeNodeType,c.changeFolder=function(a){c.treeOptions.currentPath=a,o.refreshFolder()},c.$watch("treeOptions.currentPath",function(a){a&&(c.changeFolder(a),o.scope.filterOptions.textFilter=null,o.scope.filterOptions.exitMultipleSelectionMode())}),c.filterOptions.exitMultipleSelectionMode=function(){var b=o.getAllItemDetails();b.forEach(function(b){b.isSelected=!1,b.selectTooltipText=a.shell.Strings.Text_Home_Select}),c.filterOptions.isMultiSelectionMode=!1},c.toggleSelected=function(b){b.isSelected=!b.isSelected,b.selectTooltipText=b.isSelected?a.shell.Strings.Text_Home_Deselect:a.shell.Strings.Text_Home_Select;var d=o.selectedItems();c.filterOptions.msOperations=o.getAvailableOperations(d),c.selectedModeInfo=a.stringFormat(d.length>1?a.shell.Strings.Text_Dashboard_MultipleSelection_Info_Multiple:a.shell.Strings.Text_Dashboard_MultipleSelection_Info_Single,{count:d.length}),c.filterOptions.isMultiSelectionMode=d.length>0},c.toggleFavorite=function(b){b.treeNode.isFavorite=!b.treeNode.isFavorite,b.favoriteTooltipText=b.treeNode.isFavorite?a.shell.Strings.Text_Home_Removefavorite:a.shell.Strings.Text_Home_AddFavorite},c.onItemContextMenu=function(a){return o.onItemContextMenu(a)},c.onItemClick=function(a){o.scope.filterOptions.isMultiSelectionMode?o.scope.toggleSelected(a):a.treeNode.type===b.TreeNodeType.Folder?o.scope.changeFolder(a.treeNode):o.scope.onSelect&&angular.isFunction(o.scope.onSelect)?o.scope.onSelect({node:a.treeNode}):o.openDashboardsWidgets([a.treeNode])},c.canCreateNewFolder=function(){return c.treeOptions.currentPath&&c.treeOptions.currentPath.canWriteChildren},c.newFolder=function(){c.createFolder(c.treeOptions.currentPath,function(a){o.findItemDetailFromTreeNode(a).primaryCaption.startInEdit=!0})};var q=this.scope.treeOptions.currentPath;c.$watch("filterOptions.textFilter",function(a,b){o.scope.filterOptions.textFilter?o.scope.treeOptions.currentPath&&(q=o.scope.treeOptions.currentPath,o.scope.treeOptions.currentPath=null):o.scope.treeOptions.currentPath||(o.scope.treeOptions.currentPath=q),angular.equals(a,b)||o.refreshFolder()}),c.$watchGroup(["filterOptions.showDashboards","filterOptions.showWidgets"],function(){o.refreshFolder()}),c.refreshDetailsView.add(function(){o.scope.filterOptions.exitMultipleSelectionMode(),o.refreshFolder()})}return f.prototype.findItemDetailFromTreeNode=function(a){for(var b in this.scope.sections)for(var c in this.scope.sections[b].items)if(this.scope.sections[b].items[c].treeNode==a)return this.scope.sections[b].items[c]},f.prototype.getAllItemDetails=function(){var a=[];return angular.forEach(this.scope.sections,function(b){b.items.forEach(function(b){a.push(b)})}),a},f.prototype.selectedItems=function(){var a=this.getAllItemDetails(),b=a.filter(function(a){return a.isSelected});return b},f.prototype.onItemContextMenu=function(a){var b=this;return this.environmentService.isMobileDevice()?(this.scope.filterOptions.isMultiSelectionMode=!0,function(){return[]}):function(){var c=b.scope.filterOptions.isMultiSelectionMode?b.selectedItems():[a];return b.getAvailableOperations(c,!0)}},f.prototype.treeNodeToItemDetail=function(c,f){var g=this,h={treeNode:c,key:c.key,type:c.type,isFolder:c.type===b.TreeNodeType.Folder,isSelected:f,isFavorite:c.isFavorite,serializableItem:c.serializableItem,favoriteTooltipText:c.isFavorite?a.shell.Strings.Text_Home_Removefavorite:a.shell.Strings.Text_Home_AddFavorite,selectTooltipText:f?a.shell.Strings.Text_Home_Deselect:a.shell.Strings.Text_Home_Select,sharedTooltipText:c.isShared?c.linkedTo?a.stringFormat(a.shell.Strings.Text_Home_SharedIn,{folder:this.scope.treeOptions.getNodePath(c.linkedTo).map(function(a){return a.name}).splice(1).join("/")}):a.shell.Strings.Text_Home_Shared:"",templateType:e[this.getTemplateForItemType(c)],title:c.description?c.name+"\r\n"+c.description:c.name};return h.primaryCaption=this.scope.generatePrimaryCaption(c,function(){return g.onItemContextMenu(h)()},function(){if(g.scope.selectedView.type===d.List&&c.description)return c.name+"\r\n"+c.description}),h.secondaryCaption=this.scope.generateSecondaryCaption(c,function(){return g.onItemContextMenu(h)()}),h},f.prototype.openDashboardsWidgets=function(a){var c=this;if(!this.inOpening){var d=a.filter(function(a){return a.type===b.TreeNodeType.Dashboard}),e=a.filter(function(a){return a.type===b.TreeNodeType.DefaultWidget}),f=a.filter(function(a){return a.type===b.TreeNodeType.StatefulWidget}),g=this.scope.dashOpts.homeShown;this.scope.dashOpts.homeShown=!1,this.inOpening=!0;var h,i=new b.HomeHelper(this.dashboardService,this.scope);if(0===d.length&&e.length+f.length)h=i.openWidgets(this.scope.dashboard,a,g);else{if(e.length+f.length!==0||!d.length)throw new Error("Cannot open dashboards and widgets at the same time");h=i.openDashboards(this.scope.dashboard,a,g)}h.finally(function(){c.$timeout(function(){c.inOpening=!1},1e3)}).done()}},f.prototype.searchOnNode=function(a,c,d,e){var f=this,g=[];(a.children||[]).forEach(function(a){if(b.filterNode(a,e)){var h=f.treeNodeToItemDetail(a,c.indexOf(a.key)>=0);g.push(h)}f.searchOnNode(a,c,d,e)}),g.length>0&&d.push({path:this.scope.treeOptions.getNodePath(a).map(function(a){return a.name}).join("/"),section:{headerTemplateUrl:"searchHeader.tpl.html",visible:!0,parent:a,items:g}})},f.prototype.getTemplateForItemType=function(a){return this.scope.selectedView.type!==d.Tiles||this.scope.filterOptions.textFilter||a.type!==b.TreeNodeType.Folder?this.scope.selectedView.type===d.Tiles?e.TileItem:e.ListItem:e.TileFolder},f.prototype.refreshFolder=function(){var e=this,f=this.scope.treeOptions.currentPath,g=[];this.getAllItemDetails().forEach(function(a){a.isSelected&&g.push(a.treeNode.key)}),this.scope.sections={};var h={showDashboards:this.scope.filterOptions.showDashboards,showWidgets:this.scope.filterOptions.showWidgets,words:b.tokenize(this.scope.filterOptions.textFilter),pruneEmptyFolders:this.scope.filterOptions.pruneEmptyFolders};if(h.words){var i=[];this.searchOnNode(this.scope.model.private,g,i,h),this.searchOnNode(this.scope.model.shared,g,i,h),this.scope.sections={},i.sort(function(b,c){return a.ValueComparer.naturalStringCompare(b.path,c.path,!0)}).forEach(function(a){e.scope.sections[a.path]=a.section})}else if(f)switch(this.scope.breadcrumb=this.scope.treeOptions.getNodePath(f),this.scope.selectedView.type){case d.Tiles:this.scope.sections.folders={headerTemplateUrl:"foldersHeader.tpl.html",visible:[this.scope.model.favorites,this.scope.model.lastUsed].indexOf(f)<0,parent:this.scope.treeOptions.currentPath,items:[]},this.scope.sections.dashboards={headerTemplateUrl:"dashboardsHeader.tpl.html",visible:this.scope.filterOptions.showDashboards,parent:this.scope.treeOptions.currentPath,items:[]},this.scope.sections.widgets={headerTemplateUrl:"widgetsHeader.tpl.html",visible:this.scope.filterOptions.showWidgets,parent:this.scope.treeOptions.currentPath,items:[]},f.children&&f.children.forEach(function(a){if(b.filterByNodeType(a,h)){var c=e.treeNodeToItemDetail(a,g.indexOf(a.key)>=0);switch(a.type){case b.TreeNodeType.Folder:e.scope.sections.folders.items.push(c);break;case b.TreeNodeType.Dashboard:e.scope.sections.dashboards.items.push(c);break;default:e.scope.sections.widgets.items.push(c)}}});break;case d.List:this.scope.sections.all={headerTemplateUrl:"header.tpl.html",visible:!0,parent:this.scope.treeOptions.currentPath,items:[]},f.children&&f.children.forEach(function(a){if(b.filterByNodeType(a,h)){var c=e.treeNodeToItemDetail(a,g.indexOf(a.key)>=0);e.scope.sections.all.items.push(c)}})}f&&f!=this.scope.model.lastUsed&&f!=this.scope.treeOptions.root&&angular.forEach(this.scope.sections,function(a){var b=e.sortItems(a.items,{type:c.Asc,name:c.Asc});a.items=b})},f.prototype.sortItems=function(b,d,e){var f=Object.keys(d).length;return b.sort(function(b,g){var h=0,i=0;return angular.forEach(d,function(d,j){var k,l=(d===c.Asc?-1:1)*Math.pow(10,f-i);k="number"==typeof b.treeNode[j]?(g.treeNode[j]-b.treeNode[j])*l:a.ValueComparer.naturalStringCompare(g.treeNode[j],b.treeNode[j],e)*l,h+=k,i++}),h})},f.prototype.getAvailableOperations=function(c,e){var f=this,g=[],h=[],i=0,j=0,k=0,l=!0,m=!0,n=!0,o=!0;c.forEach(function(a){switch(h.push(a.treeNode),a.treeNode.isFavorite||(l=!1),a.treeNode.canWrite||(m=!1),f.scope.model.canMove(a.treeNode)||(n=!1),f.scope.model.canDelete(a.treeNode)||(o=!1),a.treeNode.type){case b.TreeNodeType.Folder:i++;break;case b.TreeNodeType.Dashboard:j++;break;case b.TreeNodeType.DefaultWidget:case b.TreeNodeType.StatefulWidget:k++}});var p=function(){f.scope.filterOptions.isMultiSelectionMode&&f.scope.filterOptions.exitMultipleSelectionMode(),f.scope.filterOptions.textFilter&&f.refreshFolder()};if(!i&&(0===j&&k||j&&0===k)&&g.push({icon:"open",text:this.scope.dashboard?a.shell.Strings.Text_Dashboard_Menu_Add:a.shell.Strings.Text_Dashboard_Menu_Open,action:function(){f.openDashboardsWidgets(h),p()}}),0===i){var q=l?a.shell.Strings.Text_Home_Removefavorite:a.shell.Strings.Text_Home_AddFavorite;g.push({icon:"star",text:a.shell.Strings.Text_Home_Favorite,action:function(){c.forEach(function(a){a.treeNode.isFavorite=!l,a.favoriteTooltipText=q}),f.scope.filterOptions.exitMultipleSelectionMode()},checked:l,menuType:a.MenuItemType.Checkbox})}if(n&&this.scope.addMoveShareActions(g,h,e,function(){return p()}),1===h.length&&m){var r=c[0];this.dashboardService.configService.config.shell.dashboardModeConfig&&this.dashboardService.configService.config.shell.dashboardModeConfig.disableDashboardRename||g.push({icon:"edit",text:a.shell.Strings.Text_Home_EditName,action:function(){return r.primaryCaption.startInEdit=!0}}),0===i&&this.scope.selectedView.type===d.Tiles&&g.push({icon:"edit",text:a.shell.Strings.Text_Home_EditDescription,action:function(){return r.secondaryCaption.startInEdit=!0}})}return o&&g.push(this.scope.getDeleteOption(h,function(){return p()})),g},f}();angular.module("ionwebShell").directive("ionwebHomeDetails",["$q","$timeout","ionweb.contextMenuService","ionweb.dialogService","ionweb.notificationService","ionweb.homeService","ionweb.dashboardService","ionweb.dashboardStorageService","ionweb.environmentService",function(a,b,c,d,e,g,h,i,j){return{restrict:"E",scope:!0,templateUrl:function(a,b){return b.compact?"shell.ui/home/detailsCompact.tpl.html":"shell.ui/home/details.tpl.html"},link:function(k,l){return new f(k,l,a,b,c,d,e,g,h,i,j)}}}])}(b=a.home||(a.home={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function a(){this.restrict="E",this.transclude=!0,this.templateUrl="shell.ui/home/workspaceSelector.tpl.html",this.controller="ionweb.workspaceSelectorController",this.controllerAs="ctrl",this.scope={hideDashboards:"=?",hideWidgets:"=?",anchorPoint:"=?",onSelect:"&?",disable:"=?",inline:"=?",pruneEmptyFolders:"=?",modelRoot:"=?"}}return a}(),d=function(){function b(b,c){this.$scope=b,this.isSelectorOpen=!1,this.dashboardsOptions=c.scopeOpts,this.filterOptions={showDashboards:!b.hideDashboards,showWidgets:!b.hideWidgets,pruneEmptyFolders:b.pruneEmptyFolders,modelRoot:b.modelRoot},this.$scope.anchorPoint||(this.$scope.anchorPoint=a.toolkit.PopupAnchorPoint[a.toolkit.PopupAnchorPoint.BottomLeft])}return b.prototype.getNodePath=function(a){var b=[];do b.push(a);while(a=a.parent);return b.reverse()},b.prototype.onSelect=function(a){if(this.isSelectorOpen=!1,this.$scope.onSelect&&angular.isFunction(this.$scope.onSelect)){var b={path:this.getNodePath(a.linkedTo||a).slice(1).map(function(a){return a.name}).join("/"),shared:a.isShared,getNode:function(){return a}};this.$scope.onSelect({itemPath:b})}},b.$inject=["$scope","ionweb.dashboardService"],b}();angular.module("ionwebShell").controller("ionweb.workspaceSelectorController",d).directive("ionwebWorkspaceSelector",[function(){return new c}])}(b=a.home||(a.home={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=600;angular.module("ionwebShell").directive("ionwebTreeRoot",[function(){return{restrict:"E",templateUrl:"shell.ui/home/treeRoot.tpl.html",link:{pre:function(b){b.treeNodeOptions=b.treeOptions,b.treeNodeOptions.onContextMenu=function(c,d){var e=function(){return b.refreshDetailsView.raise(b,null)},f=[];return b.canCreateFolder(c)&&f.push({icon:"add",text:a.shell.Strings.Text_Home_New_Folder,action:function(){return b.createFolder(c,function(a){setTimeout(function(){return b.$broadcast("renameFolder",a,c)})})}}),c.canMove&&b.addMoveShareActions(f,[c],!0,e),c.canWrite&&f.push({icon:"edit",text:a.shell.Strings.Text_Widget_Menu_Rename,action:function(){return b.$broadcast("renameFolder",c)}}),b.model.canDelete(c)&&f.push(b.getDeleteOption([c],e)),f},b.treeNodeOptions.generateCaption=function(a){var c=b.generatePrimaryCaption(a,function(){return b.treeNodeOptions.onContextMenu(a,c)});return c}}}}}]).directive("ionwebTreeNode",[function(){return{restrict:"E",scope:{node:"=tree",options:"=",expanded:"=?"},templateUrl:"shell.ui/home/treeNode.tpl.html",controller:["$scope",function(d){var e=null;d.children=[],d.selected=!1,d.contextMenu=function(){return d.options.onContextMenu(d.node,d.caption)},d.toggleFolder=function(){d.expanded=!d.expanded},d.openPath=function(){d.options.currentPath=d.node},d.openDelayed=function(){e=setTimeout(function(){return d.expanded=!0},c)},d.resetOpenDelayedTimer=function(){e&&clearTimeout(e)},d.$watch("node.name",function(){d.caption=d.node&&d.options.generateCaption(d.node)||{caption:""}}),d.$watchCollection("node.children",function(c){d.children=(c||[]).filter(function(a){return a.type===b.TreeNodeType.Folder}).sort(function(b,c){return a.ValueComparer.naturalStringCompare(b.name,c.name,!0)})}),d.$watch("options.currentPath",function(a){d.selected=angular.equals(a,d.node)}),d.$on("renameFolder",function(a,b,c){d.node==b&&(d.caption.startInEdit=!0),d.node==c&&(d.expanded=!0)})}]}}])}(b=a.home||(a.home={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function c(){this.inEdit=!1,this._titleInit||(this.title=b.Strings.Text_Home_NoTags)}return Object.defineProperty(c.prototype,"tags",{get:function(){return this._tags},set:function(c){if(c!==this._tags){this._tags=c,this.ngChange&&this.ngChange({$value:c});var d=c||[];this.title=d.length?a.stringFormat(b.Strings.Text_Home_Tags_Title,{tags:d.join(", ")}):b.Strings.Text_Home_NoTags,this._titleInit=!0}},enumerable:!0,configurable:!0}),c}();angular.module("ionwebShell").directive("ionTagEditor",function(){return{templateUrl:"shell.ui/home/tagEditor.tpl.html",restrict:"A",scope:{tags:"=ngModel",ngChange:"&?",editable:"<?",options:"<?"},controller:[c],controllerAs:"ctrl",bindToController:!0}})}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function b(a,b,c){var d=this;this.$scope=a,this.$injector=b,this.bannerService=c,this.containerBg={},a.component.hideCaption=!0,this.leftText=this.buildTextParams("â"),this.rightText=this.buildTextParams("â"),this.centerText=this.buildTextParams();var e=a.component.getValue("containerBg"),f=a.component.getValue("leftTextModel"),g=a.component.getValue("rightTextModel"),h=a.component.getValue("centerTextModel"),i=a.component.getValue("leftTextShow"),j=a.component.getValue("rightTextShow"),k=a.component.getValue("centerTextShow"),l=a.component.getValue("model");l&&(h=l.header,l.backgroundColor&&(e={color:l.backgroundColor})),e&&$.extend(this.containerBg,e),f&&$.extend(this.leftText.model,f),g&&$.extend(this.rightText.model,g),h&&$.extend(this.centerText.model,h),i&&(this.leftText.config.show=i),j&&(this.rightText.config.show=j),k&&(this.centerText.config.show=k),a.$watch("ctrl.containerBg",function(){return d.saveContainerBackground()},!0),a.$watch("ctrl.leftText.config.show",function(a){return d.$scope.component.setValue("leftTextShow",a)}),a.$watch("ctrl.rightText.config.show",function(a){return d.$scope.component.setValue("rightTextShow",a)}),a.$watch("ctrl.centerText.config.show",function(a){return d.$scope.component.setValue("centerTextShow",a)}),a.$watch("ctrl.leftText.model",function(a){return d.saveTextModel("leftTextModel",a)},!0),a.$watch("ctrl.rightText.model",function(a){return d.saveTextModel("rightTextModel",a)},!0),a.$watch("ctrl.centerText.model",function(a){return d.saveTextModel("centerTextModel",a)},!0)}return b.prototype.buildTextParams=function(b){var c=this.bannerService.getDefaultTextConfig();c.show=!b,c.canEditBackground=!!b;var d=this.bannerService.getDefaultModel().header;b&&(d.content=void 0,d.alignment=a.BannerTextAlignment.Center),d.background={};var e=!0;return{config:c,model:d,placeholder:b,editDashboardPath:e}},b.prototype.saveContainerBackground=function(){this.$scope.component.componentStyle.backgroundColor=this.containerBg.color,this.$scope.component.setValue("containerBg",angular.copy(this.containerBg)),this.saveOldModel()},b.prototype.saveTextModel=function(a,b){this.$scope.component.setValue(a,angular.copy(b)),"centerTextModel"===a&&this.saveOldModel()},b.prototype.saveOldModel=function(){var a={backgroundColor:this.containerBg.color,header:this.centerText.model};this.$scope.component.setValue("model",a)},b.$inject=["$scope","$injector","ionweb.bannerService"],b}();angular.module("ionwebShell").controller("ionwebBannerComponentController",b)}(b=a.toolkit||(a.toolkit={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(){function a(){this.restrict="E",this.scope={leftText:"=?",rightText:"=?",centerText:"=?",containerBg:"=?",editMode:"=?"},this.templateUrl="shell.ui/toolkit/banner/navigationBanner.tpl.html",this.controller="ionwebNavigationBannerController",this.controllerAs="ctrl",this.bindToController=!0}return a}(),d=function(){function c(a,b,c,d,e){this.$scope=a,this.themeService=b,this.dashboardService=c,this.notificationService=d,this.bannerService=e}return c.prototype.$onInit=function(){var a=this;this.leftText&&!this.leftText.settings&&(this.leftText.settings=this.bannerService.getDefaultBannerItemSettings()),this.rightText&&!this.rightText.settings&&(this.rightText.settings=this.bannerService.getDefaultBannerItemSettings()),this.centerText&&!this.centerText.settings&&(this.centerText.settings=this.bannerService.getDefaultBannerItemSettings()),this.$scope.$watch("ctrl.containerBg",function(){return a.setContainerBackground()},!0),this.$scope.$watch("ctrl.leftText.settings.isOpen",function(){return a.setSettingsStyle(a.leftText)}),this.$scope.$watch("ctrl.rightText.settings.isOpen",function(){return a.setSettingsStyle(a.rightText)}),this.$scope.$watch("ctrl.centerText.settings.isOpen",function(){return a.setSettingsStyle(a.centerText)}),this.$scope.$watch("ctrl.leftText.model",function(b){return a.setTextStyle(b)},!0),this.$scope.$watch("ctrl.rightText.model",function(b){return a.setTextStyle(b)},!0),this.$scope.$watch("ctrl.centerText.model",function(b){return a.setTextStyle(b)},!0),this.$scope.$watch("ctrl.leftText.model.dashboardPath",function(){return a.cacheDashboardId(a.leftText)},!0),this.$scope.$watch("ctrl.rightText.model.dashboardPath",function(){return a.cacheDashboardId(a.rightText)},!0)},c.prototype.setContainerBackground=function(){var a=this.themeService.getThemeClassOrStyle(this.containerBg.color,"bg");this.containerBg.classes=a.classStr||"",this.containerBg.style=a.styleObj},c.prototype.setSettingsStyle=function(c){var d=c.settings.isOpen||this.editMode&&c.settings.showIcon;d||(a.spliceAll(c.settings.classes,function(a){return"center"===a||"left"===a||"right"===a}),c.settings.classes.push((b.BannerTextAlignment[c.model.alignment]||"").toLowerCase())),d?c.settings.classes.push("open"):a.spliceAll(c.settings.classes,function(a){return"open"===a})},c.prototype.setTextStyle=function(a){var b=this.themeService.getThemeClassOrStyle((a.background||{}).color,"bg");a.background.classes=b.classStr||"",a.background.style=b.styleObj},c.prototype.openDashboard=function(a){this.openDashboardId(a.dashboardId)},c.prototype.openDashboardId=function(b){this.editMode||(b?this.dashboardService.openDashboardById(b):this.notificationService.showInfo(a.shell.Strings.Text_Navigation_NoDashboard))},c.prototype.cacheDashboardId=function(a){a.model.dashboardPath&&this.dashboardService.findDashboardIds([a.model.dashboardPath]).then(function(b){a.dashboardId=b[0]}).done()},c.$inject=["$scope","ionweb.themeManager","ionweb.dashboardService","ionweb.notificationService","ionweb.bannerService"],c}();angular.module("ionwebShell").directive("ionwebNavigationBanner",[function(){return new c}]).controller("ionwebNavigationBannerController",d)}(b=a.toolkit||(a.toolkit={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c;!function(c){var d=function(b){function c(c,d){var e=b.call(this)||this;return e._formatter=(new a.cm.FormatterService).getFormatter(c),e.options=d,e}return __extends(c,b),Object.defineProperty(c.prototype,"groupSeparator",{get:function(){return this._formatter.groupSeparator},set:function(a){this._formatter.groupSeparator=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"separator",{get:function(){return this._formatter.separator},set:function(a){this._formatter.separator=a},enumerable:!0,configurable:!0}),c.prototype.incrementValue=function(b){void 0!=b&&null!=b||(b=this.coreScope.tick);var c=this.coreScope.value+b,d=a.cm.FormatAttributeProvider.getFormatAttribute(this._formatter.formatType);return void 0==d.totalTicks||isNaN(d.totalTicks)||(c=this.coreScope.value+1/d.totalTicks*b),this.coreScope.value=this.validateValue(c),this.coreScope.value},c.prototype.decrementValue=function(b){void 0!=b&&null!=b||(b=this.coreScope.tick);var c=this.coreScope.value-this.coreScope.tick,d=a.cm.FormatAttributeProvider.getFormatAttribute(this._formatter.formatType);return void 0==d.totalTicks||isNaN(d.totalTicks)||(c=this.coreScope.value-1/d.totalTicks*this.coreScope.tick),this.coreScope.value=this.validateValue(c),this.coreScope.value},c.prototype.parseValue=function(a,b){return a?(this.options&&void 0!==this.options.roundingMode&&(b=!1),this._formatter.parse(a,b)):NaN},c.prototype.formatValue=function(a){var b="NaN";return void 0==a||null==a?"":isNaN(a)?b:b=this.options?this._formatter.format(a,this.options):this._formatter.format(a)},c}(b.NumericUpDownModel);c.PriceModel=d,angular.module("ionwebShell").factory("ionweb.priceModelFactory",[function(){return{getPriceModelForFormat:function(a,b){var c=null;try{c=new d(a,b)}catch(a){}return c}}}])}(c=b.cm||(b.cm={}))}(b=a.toolkit||(a.toolkit={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b=function(){function a(a){this.logger=a,this._isStarted=!1,this.peaks=[],this.sampleCounter=0,this.currentTimeoutHandle=null,this.startTime=0,this.runningTime=0,this.resetCounters()}return a.prototype.resetCounters=function(){this.sampleCounter=0,this.peaks=[],this.runningTime=0},a.prototype.processSample=function(b){var c=performance.now(),d=Math.floor(c-b);if(this.sampleCounter++,d>a.PEAK_TIMEOUT){this.logger.high("Liveness",{Action:"Peak",Delay:d});var e=new Date,f={delay:d,time:e};this.peaks.push(f)}this.startNextSample(c)},a.prototype.start=function(){this.isRunning()||(this.startTime=performance.now(),this._isStarted=!0,this.startNextSample(this.startTime))},a.prototype.stop=function(){if(this.isRunning()){this._isStarted=!1,clearTimeout(this.currentTimeoutHandle);var a=performance.now(),b=Math.floor(a-this.startTime);this.runningTime+=b}},a.prototype.startNextSample=function(b){var c=this,d=b;this.currentTimeoutHandle=setTimeout(function(){c.processSample(d)},a.TIMEOUT)},a.prototype.isRunning=function(){return this._isStarted},a.prototype.flushTimestamp=function(a){var b=a.getHours()+":"+a.getMinutes()+":"+a.getSeconds();return b},a.prototype.flushPeakTimestamps=function(){var a=this,b=this.peaks.map(function(b){var c={time:a.flushTimestamp(b.time),delay:b.delay};return c});return b},a.prototype.flushStats=function(){var a=this.runningTime;if(this.isRunning()){var b=performance.now(),c=Math.floor(b-this.startTime);a+=c,this.startTime=b}var d={peaks:this.peaks.length,samples:this.sampleCounter,peakTimestamps:this.peaks.length>0?this.flushPeakTimestamps():void 0,runningTime:a};return this.resetCounters(),d},a.TIMEOUT=1e3,a.PEAK_TIMEOUT=1200,a}(),c=function(){function a(a,c){var d=this;this._logger=a.create("LivenessService"),this._meter=new b(this._logger),this.processVisibilityState(),document.addEventListener("visibilitychange",function(){d.processVisibilityState()});var e={name:"Liveness",getCounters:function(){return d._meter.flushStats()}};c.registerStatProvider(e)}return a.prototype.processVisibilityState=function(){this.traceVisibilityState(),this.isPageVisible()?this._meter.start():this._meter.stop()},a.prototype.traceVisibilityState=function(){var b={};b[a.TraceVisibilityChangeKey]=document.visibilityState,this._logger.low(a.TraceKey,b)},a.prototype.isPageVisible=function(){return"visible"===document.visibilityState},a.TraceKey="Liveness",a.TraceVisibilityChangeKey="Visibility",a}();a.LivenessService=c,angular.module("ionwebShell").service("ionweb.livenessService",["ionweb.loggerFactory","ionweb.statService",function(a,b){return new c(a,b)}])}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c=function(a){function b(b,c,d,e){var f=a.call(this,b,c,e)||this;return f.localPreferences=d,f.helpLinks=[],f.lastDashboardAction=Q.when(null),f}return __extends(b,a),Object.defineProperty(b.prototype,"configurationService",{get:function(){return this._configurationService},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"localUserPreferences",{get:function(){return this.localPreferences},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dashboardService",{get:function(){return this.getService("ionweb.dashboardService")},enumerable:!0,configurable:!0}),b.prototype.registerDashboard=function(a){return this.dashboardService.registerDashboard(this,a)},b.prototype.registerDashboardUrl=function(a,b){var c=this;return this.lastDashboardAction=this.lastDashboardAction.then(function(){return Q.when(c.getService("$http").get(b)).then(function(b){return a.content=b.data,c.registerDashboard(a)})})},b}(a.coreui.RegistryBase);b.ShellRegistry=c}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function b(b,c,d,e,f){var g=this;this.helpLinks={},this.logger=b.create("ShellModuleLoaderExt"),c.registryFactory=function(b){return new a.ShellRegistry(b,d,e,f)},c.moduleRegistered.add(function(a,b){return g.onModuleRegistered(b.mod,b.registry)})}return b.prototype.onModuleRegistered=function(a,b){b.helpLinks&&b.helpLinks.length>0&&(this.helpLinks[a.name]=b.helpLinks)},b.prototype.getHelpLinks=function(){var a=this,b=Object.getOwnPropertyNames(this.helpLinks);
return b.sort(),b.map(function(b){return{key:b,links:a.helpLinks[b]}}).filter(function(a){return a.links&&a.links.length>0})},b}();a.ShellModuleLoader=b,angular.module("ionwebShell").service("ionweb.shellModuleLoader",["ionweb.loggerFactory","ionweb.moduleService","ionweb.configurationService","ionweb.localUserPreferenceService","ionweb.packManager",b])}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){angular.module("ionwebShell").run(["$rootScope","$location","ionweb.serverService","ionweb.notificationService","ionweb.commService","ionweb.configurationService","ionweb.loggerFactory","ionweb.preferenceService","ionweb.dialogService","ionweb.rootComponentService","ionweb.moduleService","ionweb.applicationStatusService","ionweb.userActivityService","ionweb.dashboardService","ionweb.embeddingService","ionweb.feedbackService","ionweb.dateFormattingService","ionweb.storageService","ionweb.connectionManager","ionweb.catalogService","ionweb.preferenceDialogService","ionweb.storageIdCache","ionweb.environmentService","ionwebTk.toolkitConfigService","ionweb.contextMenuService","ionweb.iconService","ionweb.splashScreenService","ionweb.themeManager","ionweb.livenessService","ionweb.homeService",function(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E){return new c(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E)}]);var c=function(){function c(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E){var F=this;if(this.$rootScope=b,this.$location=c,this.ionServer=d,this.ionNotification=e,this.ionComm=f,this.configService=g,this.loggerFactory=h,this.preferences=i,this.dialogService=j,this.rootComponentService=k,this.moduleService=l,this.applicationStatusService=m,this.dashboardService=o,this.embeddingService=p,this.feedbackService=q,this.storageSvc=s,this.connectionManager=t,this.catalog=u,this.storageIdCache=w,this.toolkitConfigService=y,this.contextMenuService=z,this.iconService=A,this.splashScreenService=B,this.themeManager=C,this.livenessService=D,this.logger=h.create("Shell"),this.embeddingService.ionNetBridge&&(this.embeddingService.ionNetBridge.shell=new a.interop.IonNetManager(this.embeddingService.ionNetBridge,this.dashboardService,v,E,r,a.dashboard.DashboardService.willUseDashboard(this.configService,x).enabled),this.embeddingService.ionNetBridge.startPrefBridge(this.preferences)),a._isSlave)this.initializeToolkit();else{var G=function(){n.registerGlobalEventHandler(),F.splashScreenService.showSplashscreen("ionwebStartup"),F.loadShell().finally(function(){F.splashScreenService.hideSplashscreen("ionwebStartup")}).done(),t.start(),F.dashboardService.init(),F.ionNotification.status(F.ionComm.serviceStatusName,a.ServiceStatus.Disconnected,null,F.ionComm.serviceModuleDisplayName)};if(d.isLoggedIn())G();else var H=d.statusChanged.add(function(a,b){d.isLoggedIn()&&(H(),G())})}}return c.prototype.start=function(){var a=this;this.storageIdCache.enabled=!0,this.dashboardService.isEnabled?(this.dashboardService.isEnabled&&this.dashboardService.start(),this.initializeToolkit(),this.registerToolkitComponents()):this.initializeToolkit(),this.catalog.checkComponents(),this.$rootScope.$evalAsync(function(){a.dashboardService.isEnabled?a.rootComponentService.registerDefaultPath("shell.ui/dashboard/dashboardSet.tpl.html"):(a.rootComponentService.registerCatalog(),a.rootComponentService.routeReload(a.configService.config.shell.singleComponentId)),a.configService.config.shell.enableUserFeedback!==!1&&a.feedbackService.start(),a.applicationStatusService.startupConfigurationReady()})},c.prototype.initRootView=function(){var c=this;if(this.dashboardService.isEnabled)this.dashboardService.startup(this.rootComponentService.getStartupPath()),this.preferences.enableAutosave&&this.preferences.enableAutosave(),this.rootComponentService.init(function(){return new a.dashboard.DashboardRootComponent(c.loggerFactory,c.preferences,c.dashboardService)});else{var d={getPath:function(){return c.$location.path()},setPath:function(a){return c.$location.path(a)}};this.rootComponentService.init(function(){return new b.SingleRootComponent(d,c.loggerFactory,c.catalog,c.preferences,c.$rootScope)}),this.catalog.enableNavigateApi(this.$location,this.$rootScope),!this.configService.config.shell.disableAutosave&&this.preferences.enableAutosave&&this.preferences.enableAutosave()}this.rootComponentService.showContent("shell.ui/shell.tpl.html")},c.prototype.loadShell=function(){var b=this,c=this.configService.config.shell;a.enableTimerToVerifyOffsetParentOnResponsivenessService=c.enableTimerToVerifyOffsetParentOnResponsivenessService;var d;return d=c.localModules&&c.localModules.length>0?this.moduleService.fetchLocalModules(c.localModules):this.ionServer.fetchModuleList(),d.then(function(a){return b.moduleService.loadModules(a,!1)}).then(function(){b.initRootView();var c=!b.configService.config.shell.disablePreferenceSync&&!b.embeddingService.isAvailable&&!a._isSlave;return b.preferences.load(new a.preferences.RemoteScenarioStorage(b.loggerFactory,b.storageSvc),c)}).then(function(){return b.start()})},c.prototype.isDefined=function(a){return"undefined"!=typeof a},c.prototype.initializeToolkit=function(){var a=this;this.toolkitConfigService.getFontSizeHandler=function(){return a.themeManager.getFontSize()},this.toolkitConfigService.getThemeVariablesHandler=function(){return a.themeManager.getThemeVariables()},this.themeManager.currentThemeChanged.add(function(b,c){return a.toolkitConfigService.currentThemeChanged.raise(a.toolkitConfigService,c)});var b=function(){var b=a.configService.config.shell;a.isDefined(b.enableBrowserNativeContextMenu)&&a.contextMenuService.initBrowserContextMenu(b.enableBrowserNativeContextMenu),a.isDefined(b.enableAnimations)&&(a.dialogService.enableAnimations=b.enableAnimations);var c=b.toolkit;c&&(c.tile&&a.isDefined(c.tile.rounding)&&(a.toolkitConfigService.tile.rounding=c.tile.rounding),c.dialog&&a.isDefined(c.dialog.useCrossButtonOnSmallScreen)&&(a.toolkitConfigService.dialog.useCrossButtonOnSmallScreen=c.dialog.useCrossButtonOnSmallScreen),c.autoComplete&&a.isDefined(c.autoComplete.showIconOnHover)?a.toolkitConfigService.autoComplete.showIconOnHover=c.autoComplete.showIconOnHover:a.isDefined(c.showIconOnHover)&&(a.toolkitConfigService.autoComplete.showIconOnHover=c.showIconOnHover),c.datePicker&&a.isDefined(c.datePicker.showIconOnHover)?a.toolkitConfigService.datePicker.showIconOnHover=c.datePicker.showIconOnHover:a.isDefined(c.showIconOnHover)&&(a.toolkitConfigService.datePicker.showIconOnHover=c.showIconOnHover),c.datePicker&&a.isDefined(c.datePicker.enableMobileLayoutOnDesktop)&&(a.toolkitConfigService.datePicker.enableMobileLayoutOnDesktop=c.datePicker.enableMobileLayoutOnDesktop),c.datePicker&&a.isDefined(c.datePicker.disableMobileLayout)&&(a.toolkitConfigService.datePicker.disableMobileLayout=c.datePicker.disableMobileLayout))};b(),this.configService.changed.add(b)},c.prototype.registerToolkitComponents=function(){var a="toolkit.",c=this.catalog.addCategory("ionweb.toolkit","Toolkit");c.components.push({id:a+"banner",displayName:b.Strings.Comp_Banner_Name,templateUrl:"shell.ui/toolkit/banner/bannerComponent.tpl.html",description:b.Strings.Comp_Banner_Desc,defaultWidth:1,defaultHeight:120})},c}()}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(b){var c="setCaps",d="showOptionsMenu",e="getOptionsMenu",f="execOptionMenu",g="createComponent",h="dateFormatChanged",i="openDateFormattingPref",j=3e3,k=function(){function b(b,d,i,k,l,m){var n=this;this.ep=b,this.dashboardService=d,this.prefDialogService=i,this.homeService=k,this.ep.postControlMessage({ionweb_controlReqId:c,canCreateComponent:m,canFormatDate:!0});var o={};this.ep.onControlMessage.add(function(b,c){switch(c.isHandled=!0,c.request.ionweb_controlReqId){case e:var i=function(a){return[{text:"Error: "+a,disabled:!0}]},m=void 0;m=d.environmentService.isOffline?Q.when(i(a.shell.Strings.IonNetMenu_Widget_Offline)):Q.when(k.fetchTree()).timeout(j,a.shell.Strings.IonNetMenu_Widget_Timeout).then(function(a){return n.homeToCatalogMenu(a.shared)},function(a){return i(a.message)}),c.deferred.resolve(m.then(function(a){var b=n.requestOptionsMenu(a),c=0;o={};var d=function(a){return a.map(function(a){var b="action"+c++;return o[b]=a.action||a.fileChooser,{text:a.isDivider?"-":a.text,actionId:b,disabled:a.disabled,checked:a.checked,isFileChooser:!!a.fileChooser,children:a.subMenu&&a.subMenu.length>0&&d(a.subMenu)}})};return{items:d(b||[])}}));break;case f:var p=o[c.request.actionId];p&&p(c.request.value);break;case g:c.deferred.resolve(n.dashboardService.started.then(function(){if(!n.dashboardService.isEnabled)throw new Error("Cannot create components in non-dashboard mode");if(!n.dashboardService.activeDashboard)throw new Error("Active dashboard missing");var a=n.ep.embeddingService.catalogService.findComponentType(c.request.compTypeId);if(!a)throw new Error("Cannot find components type: "+c.request.compTypeId);return n.dashboardService.activeDashboard.initialized.then(function(){var b=n.dashboardService.activeDashboard.createComponent(a.id);return{id:b.id}})}));break;case h:l.setShortDateFormatHandler(function(){return{formatType:a.localization.DateTimeFormatSelectionType.Custom,formatString:c.request.formatString}},c.request.locale);break;default:c.isHandled=!1}}),this.ep.caps.then(function(b){b.canFormatDate&&(i.updateConfig(a.SDK_MODULE_NAME,{hideDatePreferences:{hideShortFormatPreference:!0}}),i.overrideShortDateFormatTemplate="shell.ui/embedding/extShortDateSetting.tpl.html")}).done()}return b.prototype.homeToCatalogMenu=function(b){var c=this,d={showDashboards:!1,showWidgets:!0,pruneEmptyFolders:!0},e=function(b){return b.map(function(b){if(a.home.filterByNodeType(b,d))return b.type===a.home.TreeNodeType.Folder&&b.children?{text:b.name,subMenu:e(b.children)}:{text:b.name,action:function(){new a.home.HomeHelper(c.dashboardService).openWidgets(c.dashboardService.activeDashboard,[b],!1)}}}).filter(function(a){return!!a})};return e(b.children)},b.prototype.showOptionsMenu=function(a){var b=this;return this.ep.caps.then(function(c){return c.hasOptionsMenu?b.ep.sendControlMessage({ionweb_controlReqId:d,show:a}).then(function(){return!0}):Q.when(!1)})},b.prototype.openDatePreferences=function(){this.ep.postControlMessage({ionweb_controlReqId:i})},b}();b.IonNetManager=k}(b=a.interop||(a.interop={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){var b=function(){function a(a){this.embeddingService=a}return a.prototype.openIonNetDatePref=function(){this.embeddingService.ionNetBridge.shell.openDatePreferences()},a}();angular.module("ionwebShell").controller("ionwebExternalDateFormatController",["ionweb.embeddingService",b])}(b=a.interop||(a.interop={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b;!function(a){angular.module("ionwebShell").controller("ionweb.reconnectingBannerController",["$scope","ionweb.connectionManager",function(a,b){a.options=b.options}])}(b=a.shell||(a.shell={}))}(ionweb||(ionweb={}));var ionweb;!function(a){var b=function(){function b(){}return Object.defineProperty(b,"Err_Notification_Unhandled_Exception",{get:function(){return a.core.Strings.Err_Notification_Unhandled_Exception},enumerable:!0,configurable:!0}),b}();a.Strings=b}(ionweb||(ionweb={})),angular.module("ionwebShell").run(["$templateCache",function(a){"use strict";a.put("shell.ui/about/aboutBox.tpl.html",'<div class=about-box ng-controller=ionweb.aboutBoxController ng-class="{\'about-box-xs\': isSmallScreen}"><button class="close ionicon ionicon-close about-close-button" ng-click=aboutBoxService.close()></button><div class=about-box-body><div class=about-box-content><div class=about-box-logo-container><img class=about-branding-logo ng-src={{aboutBoxService.logo}} ng-if=!aboutBoxService.brandingLogo ng-show=aboutBoxService.showLogo align="center"><div ion-svg-logo-about class=animated-logo ng-if=aboutBoxService.brandingLogo></div><label class=about-app-name>{{aboutBoxService.appName}}</label><label class=about-powered-by ng-show=aboutBoxService.isBranded>{{"About_PoweredBy_IONWEB" | resource}}</label></div><div class=about-version-user align=center><label class=about-version-margin ng-show=aboutBoxService.showVersion>{{"About_Version" | resource}} <span>{{aboutBoxService.version}}</span></label><label class=about-user-margin ng-show=aboutBoxService.showCurrentUser>{{"About_User" | resource}} <span>{{aboutBoxService.currentUser}}</span></label></div><div class=about-module-section-margin ng-show=aboutBoxService.showModules><ionweb-button icon="{{showDetails ? \'triangleUp\' : \'triangleDown\'}}" icon-placement=after class=about-module-button role=secondary ng-click="showDetails =!showDetails">{{"About_Btn_Details" | resource}}</ionweb-button><div class=about-module-details ng-show=showDetails><uib-tabset class=ionweb-tabbed-pane active=aboutBoxService.lastTabIdx><uib-tab heading="{{\'About_Modules\' | resource}}"><div class=about-module-container><table><tr ng-repeat="module in modules | orderBy: \'displayName\'"><td class="about-module-item about-module-name selectableText" title={{module.tooltip}}>{{module.displayName}}</td><td class="about-module-item about-module-error"><span title={{module._errorText}} class="ionicon ionicon-warning" ng-show=module._errorText></span></td><td class="about-module-item about-module-version selectableText">{{module.version}}</td></tr></table></div></uib-tab><uib-tab heading="{{\'About_Traffic\' | resource}}"><div class=about-traffic-container><span class=about-module-item>{{\'About_Traffic_TotalTx\' | resource}} {{network.tx | ionwebBytes}} <span class="ionicon ionicon-upload"></span> / {{\'About_Traffic_TotalRx\' | resource}} {{network.rx | ionwebBytes}} <span class="ionicon ionicon-download"></span></span><div class=about-network-chart><div ng-repeat="category in networkCategories" ng-style="{ width: category.pct + \'%\', background: category.color }" title="{{category.name}}: {{category.total | ionwebBytes}} ({{category.pct | number:1}}%)"></div></div><table style="width: 100%"><tr ng-repeat="category in networkCategories"><td class="about-module-item selectableText"><div class=about-module-item-rect ng-style="{ background: category.color }"></div>{{category.name}}</td><td class="about-module-item-right selectableText">{{category.pct | number:1}}%</td><td class="about-module-item-right selectableText">{{category.tx | ionwebBytes}} <span class="ionicon ionicon-upload"></span></td><td class="about-module-item-right selectableText">{{category.rx | ionwebBytes}} <span class="ionicon ionicon-download"></span></td></tr></table></div></uib-tab></uib-tabset><div class=about-log-id align=center><label>{{"About_LogId" | resource }} <span class=selectableText>{{aboutBoxService.logId}}</span></label></div></div></div><div class=about-copyright-section-margin align=center ng-show=aboutBoxService.showCopyrightNotice><a href={{aboutBoxService.copyrightNoticeLink}} class=about-copyright target=_blank>{{aboutBoxService.copyrightNotice}}</a></div><div class=about-privacy-section-margin align=right ng-hide=aboutBoxService.hidePrivacy><a href={{aboutBoxService.privacyLink}} class=about-privacy target=_blank>{{aboutBoxService.privacyLabel}}</a></div></div></div></div>'),a.put("shell.ui/dashboard/captionBar.tpl.html",'<div class=ion-caption-bar title="{{options.description || options.caption}}" ng-style=background.style ng-class=background.classes ionweb-popup-container ionweb-popup-anchor><div ng-if=!overlay class=ion-caption-bar-left ng-class="{ \'widget-caption-editor\': isWidgetCaptionEditor }" ng-include="\'shell.ui/dashboard/captionBarLeft.tpl.html\'" ion-caption-left-part></div><ionweb-popup ng-if=overlay visible=true automatically-close=false destroy-on-hide=false skip-anchor-visibility-check=true anchor-point="\'TopLeft\'" suspend-autoposition=view.isJqueryDragging automatically-update-position=!view.isJqueryDragging ion-caption-draggable class=caption-bar-popup><div ng-include="\'shell.ui/dashboard/captionBarLeft.tpl.html\'" class=ion-caption-bar-left ng-class="{ \'widget-caption-editor\': isWidgetCaptionEditor }" ionweb-draggable ion-caption-left-part drag-start=options.onDragStart($dataTransfer) drag-end=options.onDragEnd($dataTransfer)></div></ionweb-popup><div ng-if="!options.compactHeader && !overlay" ng-show=showTools class="ion-caption-bar-right {{containerClasses}}" ng-class="{ \'caption-edit-mode\': inEditMode }" ng-include="\'shell.ui/dashboard/captionBarRight.tpl.html\'"></div><ionweb-popup ng-if="options.compactHeader || overlay" ng-show=showTools visible=true automatically-close=false destroy-on-hide=false skip-anchor-visibility-check=true anchor-point="\'TopRight\'" class=caption-bar-popup><div class=ion-caption-bar-right ng-class=containerClasses ng-include="\'shell.ui/dashboard/captionBarRight.tpl.html\'"></div></ionweb-popup></div>'),a.put("shell.ui/dashboard/captionBarLeft.tpl.html",'<div ng-if=!options.compactHeader ng-style=grip.style ng-class=grip.classes class=ion-caption-bar-drag ng-show=hasGrip><span class="ionicon stop-gs-drag" ng-class="{ \'ionicon-dragHandler\': showGrip || view.editorEnabled }"></span></div><div ng-if="!options.compactHeader && leftButtons.length" class=ion-caption-bar-button-container ng-style=grip.style ng-class=grip.classes><button ng-repeat="button in leftButtons" type=button ng-class=button.classes class="caption-bar-button ionicon ionicon-{{button.icon}}" title={{button.description}} ng-click="$event.preventDefault(); $event.stopPropagation(); button.action($event)" ng-disabled=!button.action ion-tooltip=button.tooltip></button></div><span ng-if="!view.editorEnabled && !options.compactHeader" ng-dblclick="$event.preventDefault(); $event.stopPropagation(); options.enabled && !options.compactHeader && edit()" ng-style=view.style ng-class=view.classes class=ion-caption-span>{{options.caption || \'&nbsp;\'}}</span> <input ng-if=view.editorEnabled type=text ng-style=view.style ng-class=view.classes ng-model=view.editableValue ng-blur=save() ng-keydown=keyDown($event) ng-click="$event.preventDefault(); $event.stopPropagation()" class="ion-caption-input">'),a.put("shell.ui/dashboard/captionBarRight.tpl.html",'<ionweb-style-editor ng-if="options.enabled && !options.compactHeader && enableStyleEditor && !disableCaptionStyle" edit-fg-color=true fg-color=options.captionStyle.color edit-bg-color=true bg-color=options.captionStyle.backgroundColor edit-size=true size=options.captionStyle.fontSize edit-alignment="[\'Left\', \'Center\']" alignment=options.captionStyle.alignment compact-mode=true></ionweb-style-editor><div class=ion-caption-bar-button-container><button class="caption-bar-button ionicon ionicon-edit" ng-show="editModeAlways() && options.enabled" ng-disabled=view.editorEnabled ng-click="$event.preventDefault(); $event.stopPropagation(); edit()" title={{options.editDesc}}></button> <button ng-repeat="button in rightButtons" type=button ng-class=button.classes class="caption-bar-button ionicon ionicon-{{button.icon}}" title={{button.description}} ng-click="$event.preventDefault(); $event.stopPropagation(); button.action($event)" ng-disabled=!button.action ion-tooltip=button.tooltip></button></div>'),a.put("shell.ui/dashboard/collapsibleTabPanel/collapsibleTabPanel.tpl.html",'<div ng-show=state.visible class=collapsible-tab-panel-container ng-class="[$collapsibleTabPanelConfig.orientation, (!state.collapsed && \'expanded\') || \'\']" collapsible-tab-panel-resizer><collapsible-pane is-collapsed=state.collapsed orientation={{$collapsibleTabPanelConfig.orientation}} collapsed-orientation={{$collapsibleTabPanelConfig.collapsedOrientation}} title-template-url={{titleTemplateUrl}} title-template-scope=titleScope><uib-tabset active=state.activeTabId template-url=shell.ui/dashboard/collapsibleTabPanel/collapsibleTabPanelTabSet.tpl.html class="ionweb-tabbed-pane collapsible-tab-set-container"><uib-tab ng-repeat="tabConfig in state.tabConfigs track by tabConfig.tab.id" index=tabConfig.id select="tabConfig.onTabSelected($event, tabConfig)"><uib-tab-heading><div class=collapsible-tab-panel-title title={{tabConfig.tab.title}}><ionweb-icon ng-if=tabConfig.tab.icon icon={{tabConfig.tab.icon}}></ionweb-icon><label class=collapsible-tab-panel-title-label>{{tabConfig.tab.title}}</label></div></uib-tab-heading><div ionweb-component={{tabConfig.id}} class=collapsible-tab-panel-content-wrapper><div class=collapsible-tab-panel-content ng-include=tabConfig.tab.templateUrl></div></div></uib-tab></uib-tabset></collapsible-pane><div class=collapsible-tab-panel-resize-handle ng-class="{\'resizable\': state.resizable && !state.collapsed}"></div></div>'),a.put("shell.ui/dashboard/collapsibleTabPanel/collapsibleTabPanelTabSet.tpl.html",'<div><div class=nav-tab-wrapper><ul class="nav nav-{{tabset.type || \'tabs\'}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude></ul></div><div class=tab-content><div class=tab-pane ng-repeat="tab in tabset.tabs" ng-class="{active: tabset.active === tab.index}" uib-tab-content-transclude=tab></div></div></div>'),a.put("shell.ui/dashboard/collapsibleTabPanel/collapsibleTabPanelTitle.tpl.html",'<div class=collapsible-tab-panel-title-container><div ng-repeat="tabConfig in state.tabConfigs" ng-click=makeActive(tabConfig) class=collapsible-tab-panel-title title={{tabConfig.tab.title}}><ionweb-icon icon={{tabConfig.tab.icon}}></ionweb-icon><label class=collapsible-tab-panel-title-label>{{tabConfig.tab.title}}</label></div></div>'),a.put("shell.ui/dashboard/componentPane.tpl.html",'<div ng-class="{\'is-active\': options.isActive() }"><div ionweb-component={{options.compId}} class=component-host ng-class="{ \'component-borders\': showBorders }" ng-init="ddCont = {}"><div ng-include=options.templateUrl class=pane-content ng-if="options.templateUrl && options.reloadHelperFlag"></div><div ionweb-dynamic=options.template class=pane-content ng-if="options.template && options.reloadHelperFlag"></div><div ionweb-droppable drag-enter="$dataTransfer.getData(\'componentId\') && (ddCont.isDraggingOver = true)" drag-leave="ddCont.isDraggingOver = false" drag-over="\'Move\'" drop="((ddCont.isDraggingOver = false) || true) && options.title.onDrop($dataTransfer, true)" style="position: absolute" ng-class="{\'tab-drop-here-panel\': !options.title.isDragging, \'tab-placeholder-dnd-panel\': options.title.isDragging}" ng-if=isMovingComponent><div class=drop-here-panel-message><center><div ng-show=!options.title.isDragging><span class="glyphicon glyphicon-log-in"></span><span style="display: inline-block; margin: 5px">{{\'Text_Dashboard_DropHereGroup\' | resource}}</span></div></center></div></div><div ng-if="options.isActive() || ddCont.isDraggingOver" class=active-component-decorator></div></div></div>'),a.put("shell.ui/dashboard/dashboardCollapsiblePanel.tpl.html","<div class=dashboard-collapsible-side-panel collapsible-tab-panel></div>"),a.put("shell.ui/dashboard/dashboardDirective.tpl.html","<div ng-class=\"{'grid-stack': true, 'is-moving-component': isMovingComponent}\"></div>"),a.put("shell.ui/dashboard/dashboardHistory.tpl.html",'<div ng-controller=ionweb.DashboardHistoryController><div class="panel panel-info"><span>{{::\'Text_Dashboard_RevisionHistory\' | resource}}</span> <button type=button class="ionicon ionicon-close" ng-click="dashboard.showHistory = false"></button></div><div class=checkbox style="margin-left: 0.5em"><label><input type=checkbox ng-model="filterComments"> {{::\'Text_Dashboard_RevisionHistory_FilterTags\' | resource}}</label></div><div class=checkbox style="margin-left: 0.5em"><label><input type=checkbox ng-model=showMore ng-disabled="filterComments"> {{::\'Text_Dashboard_RevisionHistory_ShowMore\' | resource}}</label></div><div ng-show=loadingText>{{::loadingText}}</div><div class=list-group ng-hide=loadingText><form name=userForm><a class=list-group-item ng-repeat="version in versions" ng-click=selectVersion($index) ng-class="{ active: version.isSelected }"><div class=author-color style="background-color: {{version.authorColor}}"></div><div class=version-data><div class="firstline ion-caption-bar" ng-class="{ \'strikeout\': version.error }"><span class="timestamp fl-auto">{{::version.timeStamp}}</span><div class=fl-fill ng-class="{ bordered: edithovering }"><ion-caption-bar options=version.comment></ion-caption-bar></div><button class="caption-bar-button ionicon ionicon-edit" ng-show=version.comment.enabled ng-mouseenter="edithovering = true" ng-mouseleave="edithovering = false" ng-click="version.comment.startInEdit = true" title={{version.comment.editDesc}}></button></div><span class=author>{{::version.author}}</span><ionweb-button class=restore-button role=secondary ng-click=restoreVersion($index) ng-if="canWrite && version.isSelected && version.canRestore">{{::\'Text_Dashboard_RevisionHistory_Restore\' | resource}}</ionweb-button></div></a></form></div></div>'),a.put("shell.ui/dashboard/dashboardSet.tpl.html",'<div class=dashboard-set><div ng-repeat="dashboard in dashOpts.dashboards" class=dashboard ng-class="{ \'dashboard-active\': dashboard.active }"><div ng-if=dashboard.showSelector class=selector-pane><div ionweb-home options=dashOpts dashboard=dashboard class=home-selector></div></div><div ng-show=!dashboard.showSelector ionweb-component={{dashboard.compId}} class=dashboard-comp><div class=dashboard-contr ng-controller=ionweb.DashboardController><div class=dashboard-app-contr ng-controller="dashboard.customControllerFun as dashCtrl"><div class=dashboard-top-panel ng-class="{ \'covered\': dashboard.showHistory }" ng-if="dashboard.topPanelTemplateUrl || dashboard.collapsiblePanelTemplateUrl"><div ionweb-component={{dashboard.topPanelCompId}} ng-init="$collapsibleTabPanelConfig = dashboard.collapsiblePanelConfigs.top" class=dashboard-side-panel-component><div class=dashboard-side-panel-template-container ng-include="dashboard.topPanelTemplateUrl || dashboard.collapsiblePanelTemplateUrl"></div></div></div><div class=dashboard-content-panel><div class=dashboard-side-panel ng-class="{ \'covered\': dashboard.showHistory }" ng-if="dashboard.sidePanelTemplateUrl || dashboard.collapsiblePanelTemplateUrl"><div ionweb-component={{dashboard.sidePanelCompId}} ng-init="$collapsibleTabPanelConfig = dashboard.collapsiblePanelConfigs.left" class=dashboard-side-panel-component><div class=dashboard-side-panel-template-container ng-include="dashboard.sidePanelTemplateUrl || dashboard.collapsiblePanelTemplateUrl"></div></div></div><div class=dashboard-gs-container><ionweb-gridstack config=dashboardOptions ng-class="{ \'covered\': dashboard.showHistory }"></ionweb-gridstack><div class=dashboard-cover ng-if=dashboard.showHistory></div></div><div class=dashboard-side-panel ng-class="{ \'covered\': dashboard.showHistory }" ng-if="dashboard.rightPanelTemplateUrl || dashboard.collapsiblePanelTemplateUrl"><div ionweb-component={{dashboard.rightPanelCompId}} ng-init="$collapsibleTabPanelConfig = dashboard.collapsiblePanelConfigs.right" class=dashboard-side-panel-component><div class=dashboard-side-panel-template-container ng-include="dashboard.rightPanelTemplateUrl || dashboard.collapsiblePanelTemplateUrl"></div></div></div></div><div class=dashboard-bottom-panel ng-class="{ \'covered\': dashboard.showHistory }" ng-if="dashboard.bottomPanelTemplateUrl || dashboard.collapsiblePanelTemplateUrl"><div ionweb-component={{dashboard.bottomPanelCompId}} ng-init="$collapsibleTabPanelConfig = dashboard.collapsiblePanelConfigs.bottom" class=dashboard-side-panel-component><div class=dashboard-side-panel-template-container ng-include="dashboard.bottomPanelTemplateUrl || dashboard.collapsiblePanelTemplateUrl"></div></div></div></div><div class=dashboard-history-panel ng-if=dashboard.showHistory ng-include="\'shell.ui/dashboard/dashboardHistory.tpl.html\'"></div></div></div></div></div>'),a.put("shell.ui/dashboard/editMenuItem.tpl.html","<div class=dashboard-edit-menu><div title=\"{{'Tooltip_Dashboard_Edit' | resource}}\" class=menu-item-padding><ionweb-icon icon=edit></ionweb-icon><div ng-click=\"!disabled && (dashboard.inEditMode = !dashboard.inEditMode)\" class=edit-menu-text ng-class=\"{ 'disabled': disabled }\">{{'Menu_Dashboard_Edit' | resource}}</div><ionweb-toggle ng-disabled=disabled ng-model=dashboard.inEditMode class=toggle-padding show-labels=false></ionweb-toggle></div><div ng-style=\"{ 'height': !dashboard.inEditMode && '0', 'overflow-y': !dashboard.inEditMode && 'hidden' }\" class=dashboard-menu-edit-pad><div title=\"{{'Tooltip_Dashboard_LockLayout' | resource}}\" class=menu-item-padding ng-if=enableLockLayoutMenuItem><span class=ionicon></span><div ng-click=\"!disabled && (dashboard.inEditLayoutMode = !dashboard.inEditLayoutMode)\" class=edit-menu-text>{{'Menu_Dashboard_LockLayout' | resource}}</div><ionweb-toggle ng-model=dashboard.inEditLayoutMode ng-disabled=disabled ng-true-value=false ng-false-value=true ng-change=\"dashboard.fillHeightMode = false\" class=toggle-padding show-labels=false></ionweb-toggle></div><div title=\"{{'Tooltip_Dashboard_ShowCaption' | resource}}\" class=menu-item-padding ng-if=enableShowCaptionsMenuItem><span class=ionicon></span><div ng-click=\"!disabled && (dashboard.showHeaders = !dashboard.showHeaders)\" class=edit-menu-text>{{'Menu_Dashboard_ShowCaption' | resource}}</div><ionweb-toggle ng-model=dashboard.showHeaders ng-disabled=disabled class=toggle-padding show-labels=false></ionweb-toggle></div><div title=\"{{'Tooltip_Dashboard_FillHeightMode' | resource}}\" class=menu-item-padding ng-if=enableFitToBrowserMenuItem><span class=ionicon></span><div ng-click=\"!disabled && (dashboard.fillHeightMode = !dashboard.fillHeightMode)\" class=edit-menu-text>{{'Menu_Dashboard_FillHeightMode' | resource}}</div><ionweb-toggle ng-model=dashboard.fillHeightMode ng-disabled=disabled ng-change=\"dashboard.inEditLayoutMode = false\" class=toggle-padding show-labels=false></ionweb-toggle></div><div title=\"{{'Tooltip_Dashboard_CompactMode' | resource}}\" class=menu-item-padding ng-if=enableCompactModeMenuItem><span class=ionicon></span><div ng-click=\"!disabled && (dashboard.compactMode = !dashboard.compactMode)\" class=edit-menu-text>{{'Menu_Dashboard_CompactMode' | resource}}</div><ionweb-toggle ng-model=dashboard.compactMode ng-disabled=disabled class=toggle-padding show-labels=false></ionweb-toggle></div></div></div>"),a.put("shell.ui/dashboard/fileChooser.tpl.html",'<div class=ion-file-chooser><input type="file"> <a title={{tooltip}}>{{text}}</a></div>'),a.put("shell.ui/dashboard/gridstack/componentHeader.tpl.html",'<div data-group-id={{groupId}} ng-class="{ \'show-resize-grips\': isHover }" ng-mouseover=$event.stopPropagation()><div class=grid-stack-item-content ng-class="{ \'component-borders\': showBorders }" ng-style="{ left: horizontalMargin, right: horizontalMargin }"><div class=pane-tab-container ng-mouseover="$event.stopPropagation(); setIsHover($event)" ionweb-dashboard-tabs><ul ng-class="{ \'contain-tabs\': hasTabs, \'float-right\': compactHeader, \'in-edit-layout-mode\': dashboard.inEditLayoutMode }"><li data-compid={{item.headerCompId}} ng-repeat="item in group.items"><a href=#{{item.headerCompId}} ionweb-draggable=ff drag-start=item.options.title.onDragStart($dataTransfer) drag-end=item.options.title.onDragEnd($dataTransfer)><span></span><div widget-navigation-bar options=item.options.navigationBarOptions></div><div ng-cloak ng-controller=ionweb.componentHeader ng-show=showCaption ionweb-draggable=!ff drag-start=item.options.title.onDragStart($dataTransfer) drag-end=item.options.title.onDragEnd($dataTransfer)><ion-caption-bar show-tools="((isHover || item.options.title.buttonsPinned) && (group.items.length === 1 || group.activeItem === $index))" is-tabbed=hasTabs enable-style-editor=!hasTabs options=item.options.title is-widget-caption-editor=group.element span-class="item.options.title.isDraggable && !maximizedComponentId && \'grid-stack-draggable\'" overlay="((group.items.length == 1) && !showCaptions && !maximizedComponentId) && (isHover || item.options.title.inEdit || item.options.title.buttonsPinned)" underlying-bg-color="(item.options.component.componentStyle.backgroundColor !== \'transparent\' && item.options.component.componentStyle.backgroundColor) || \'@background\'" has-grip=true show-grip="item.options.title.isDraggable && !maximizedComponentId" container-classes="\'gray-buttons\'" disable-caption-style=disableWidgetCaptionStyle disable-rename=disableWidgetRename></ion-caption-bar><ion-tab-drop-handler options=item.options.title active=isMovingComponent class=drop-tab-feedback-comppane></ion-tab-drop-handler></div></a></li></ul></div></div></div>'),
a.put("shell.ui/dashboard/localChangesWarn.tpl.html","<div class=dashboard-tooltip-popup-content><h3 class=warning-text>Warning</h3><p class=dashboard-tooltip-text>{{'Text_Dashboard_Warn_UnsavedProt_1' | resource}}</p><p class=dashboard-tooltip-text>{{'Text_Dashboard_Warn_UnsavedProt_2' | resource}}</p><div class=dashboard-tooltip-button-container><button class=\"btn ionbtn ionbtn-primary dashboard-tooltip-button\" ng-click=overwrite()>{{'Text_Dashboard_Warn_UnsavedProt_Cont' | resource}}</button> <button class=\"btn ionbtn ionbtn-primary dashboard-tooltip-button\" ng-click=revert()>{{'Text_Dashboard_Warn_UnsavedProt_Rev' | resource}}</button> <button class=\"btn ionbtn ionbtn-primary dashboard-tooltip-button\" ng-click=clone()>{{'Text_Dashboard_Btn_Clone' | resource}}</button></div></div>"),a.put("shell.ui/dashboard/placeholderComponent.tpl.html",'<div class=placeholder-comp ng-controller=ionweb.PlaceholderController><div class=placeholder-comp-content>{{"Text_Dashboard_Placeholder_Title" | resource}}<br>{{details}}</div></div>'),a.put("shell.ui/dashboard/readOnlyTooltip.tpl.html","<div class=dashboard-tooltip-popup-content><div class=dashboard-tooltip-text>{{'Text_Dashboard_CannotWrite_Ro_Tooltip1' | resource}}</div><div class=dashboard-tooltip-text>{{'Text_Dashboard_CannotWrite_Ro_Tooltip2' | resource}}</div><div class=dashboard-tooltip-button-container><button class=\"btn ionbtn ionbtn-primary dashboard-tooltip-button\" ng-click=clone()>{{'Text_Dashboard_Btn_Clone' | resource}}</button></div></div>"),a.put("shell.ui/dashboard/saveAs.tpl.html",'<div class=save-as ng-controller="ionwebSaveAsController as ctrl"><label>{{"Text_SaveAs_SelectFileName" | resource}}</label><input ionweb-shell-autofocus ion-enterdown=ctrl.accept() ng-model=opts.fileName type=text class=ion-input ionweb-validation validation-state=ctrl.validationState validation-message=ctrl.validationMessage></div>'),a.put("shell.ui/dashboard/tabDropHandlerDirective.tpl.html",'<div ng-show=active class=drop-tab-feedback><div class=drop-tab-side-feedback ionweb-droppable drag-enter="onDragEnter($dataTransfer, false)" drag-leave="isDraggingOverBefore = false" drag-over="\'Move\'" drop="options.onDrop($dataTransfer, false)" ng-class="{\'drop-to-left-feedback\': isDraggingOverBefore}"><span ng-show=isDraggingOverBefore class="icon-feedback left-feedback glyphicon glyphicon-arrow-up"></span></div><div class=drop-tab-side-feedback ionweb-droppable drag-enter="onDragEnter($dataTransfer, true)" drag-leave="isDraggingOverAfter = false" drag-over="\'Move\'" drop="options.onDrop($dataTransfer, true)" ng-class="{\'drop-to-right-feedback\': isDraggingOverAfter}"><span ng-show=isDraggingOverAfter class="icon-feedback right-feedback glyphicon glyphicon-arrow-up"></span></div></div>'),a.put("shell.ui/dashboard/undoSnackBar.tpl.html","<span>{{text}} &nbsp;&nbsp; <a ng-click=undo()>UNDO</a></span>"),a.put("shell.ui/dashboard/widgetNavigationBar.tpl.html",'<div class=widget-navigation-bar ng-show=!!options.visible><div class=widget-navigation-bar-button-container><ionweb-button ng-repeat="nextButton in options.buttons" ng-class=nextButton.classes icon={{nextButton.icon}} title={{nextButton.description}} ng-click=nextButton.action($event) ng-disabled=!nextButton.action>{{nextButton.name}}</ionweb-button></div></div>'),a.put("shell.ui/dashboard/widgetSavedToast.tpl.html","<p class=ion-snack-primary>{{'Text_Dashboard_WidgetCreated' | resource:this }}</p><div style=\"text-align: center\"><a ng-click=organize()>{{'Text_Dashboard_WidgetCreated_Organize' | resource }}</a><div></div></div>"),a.put("shell.ui/dashboard/widgetSelector.tpl.html",'<div class="ionweb-widget-selector ionweb-widget-selector-flex"><div ionweb-home class=ionweb-home-flex widget-only=true options=dashOpts dashboard=dashboard style=width:100%></div></div>'),a.put("shell.ui/densityDialog.tpl.html",'<div class=density-selector><div ng-if=config.showHeader class=density-selector-title>{{ \'Title_Density_Selector\' | resource }}</div><div class=density-items ng-repeat="option in densityOptions" ng-class="{ active: option.name === internalDensity.name }" ng-click=onDensityOptionSelected(option);><div class="density-icon ionicon" ng-class="{ \'ionicon---density-{{ option.displayName.toLowerCase() }}\': true}"></div><div class=density-detail><div>{{ option.displayName }}</div><div>{{ option.description }}</div></div><div class=checkmark-icon ng-class="{ \'ionicon ionicon-accept\': option.name === internalDensity.name }"></div></div></div>'),a.put("shell.ui/embedding/extShortDateSetting.tpl.html",'<div ng-controller="ionwebExternalDateFormatController as ctrl"><label class=ion-primary-label-to-control-bottom-margin>{{"Text_DateTime_ShortFormat" | resource}}</label><div class=ion-unrelated-control-bottom-margin><span>{{"Text_DateTime_ShortFormat_IonNetHybrid" | resource}}<a ng-click=ctrl.openIonNetDatePref()>{{"Text_DateTime_ShortFormat_IonNetHybrid_Link" | resource}}</a><span></span></span></div><label class=preference-ellipsis>{{"Text_Preview" | resource}} {{formatDate($parent.dateTimePreference.shortFormat.formatString)}}</label></div>'),a.put("shell.ui/home/details.tpl.html",'<div class=ionweb-home-details-root><div><div class="pull-right ionweb-home-details-header-button-container"><button class="ionbtn ionbtn-primary ionweb-home-create-dashboard-btn" ng-if="!widgetOnly && canCreateDashboard(treeOptions.currentPath)" ng-click="newDashboardAndOpen(true, treeOptions.currentPath).done()">{{\'Text_Home_New_Dashboard\' | resource}}</button><div class="ionweb-home-view-selector btn-group"><button ng-repeat="view in availableViews" ng-class="{selected: selectedView.type == view.type}" ng-click=changeView(view)><span class=ionicon ng-class="\'ionicon-\' + view.icon"></span></button></div><div ng-if="widgetOnly && compact" class=ionweb-home-details-view-close-button-container><ionweb-icon class=ionweb-widget-selector-close-button icon=close ng-click="dashboard.closeWidgetSelector()"></div></div><h2 ng-show=filterOptions.textFilter class=ionweb-home-search-header>{{\'Text_Home_SearchResults\' | resource }}</h2><ul ng-show=!filterOptions.textFilter class="ionweb-home-section ionweb-home-breadcrumb"><li ng-repeat="folder in breadcrumb track by $index" class=ionweb-home-breadcrumb-item ng-click=changeFolder(folder) ng-class="{\'folder-dnd-over\': folder.hover}" ionweb-droppable drag-enter="folder.hover = treeOptions.canDrop($dataTransfer, folder)" drag-leave="folder.hover = false" drag-over="treeOptions.canDrop($dataTransfer, folder) ? \'move\' : \'none\'" drop="folder.hover = false; treeOptions.onDrop($dataTransfer, folder)"><ionweb-icon class=ionweb-home-breadcrumb-icon icon={{treeOptions.getIcon(folder)}}></ionweb-icon>{{folder.name}}</li></ul></div><div ng-class=selectedView.class><div class=ionweb-home-section ng-repeat="section in sections" ng-show=section.visible ng-class="\'ionweb-home-section-responsive-\' + responsiveClass"><div class=ionweb-home-section-header ng-include="selectedView.directory + section.headerTemplateUrl"></div><div class=ionweb-home-section-body><span class=ionweb-home-section-item ng-repeat="item in section.items track by $index"><div class=ionweb-home-item ng-if="item.templateType === \'ListItem\'" title={{item.title}} ng-class="{selected: item.isSelected, \'multiple-selection\': filterOptions.isMultiSelectionMode, favorite: item.treeNode.isFavorite}" ng-click=onItemClick(item) ionweb-context-menu-handler=onItemContextMenu(item) ionweb-draggable drag-start="!filterOptions.isMultiSelectionMode && treeOptions.dragStart($dataTransfer, [item.treeNode])" ionweb-droppable drag-enter="item.treeNode.hover = treeOptions.canDrop($dataTransfer, item.treeNode)" drag-leave="item.treeNode.hover = false" drag-over="treeOptions.canDrop($dataTransfer, item.treeNode) ? \'move\' : \'none\'" drop="item.treeNode.hover = false; treeOptions.onDrop($dataTransfer, item.treeNode)"><div class=pull-right><span class="ionweb-home-item-corner-icon selection ionicon ionicon-acceptFilled" title={{item.selectTooltipText}} ng-class="{active: item.isSelected}" ng-click="$event.preventDefault(); $event.stopPropagation(); toggleSelected(item);"></span> <span class="ionweb-home-item-corner-icon favorite ionicon ionicon-star" title={{item.favoriteTooltipText}} ng-class="{active: item.treeNode.isFavorite}" ng-click="$event.preventDefault(); $event.stopPropagation(); toggleFavorite(item);"></span> <span ng-if="item.treeNode.isShared && !filterOptions.isMultiSelectionMode" title={{item.sharedTooltipText}} class="ionweb-home-item-corner-icon shared ionicon ionicon-public"></span> <span ng-if="item.treeNode.isOwner && !filterOptions.isMultiSelectionMode" title="{{\'Text_Home_Owner\' | resource}}" class="ionweb-home-item-corner-icon owner ionicon ionicon-user"></span></div><ionweb-icon class=ionweb-home-item-icon icon={{treeOptions.getIcon(item.treeNode)}}></ionweb-icon><ion-caption-bar options=item.primaryCaption></ion-caption-bar></div><div class=ionweb-home-item ng-if="item.templateType === \'TileItem\'" title={{item.title}} ng-class="{selected: item.isSelected, \'multiple-selection\': filterOptions.isMultiSelectionMode, favorite: item.treeNode.isFavorite, folder: item.isFolder}" ng-click=onItemClick(item) ionweb-context-menu-handler=onItemContextMenu(item) ionweb-draggable drag-start="!filterOptions.isMultiSelectionMode && treeOptions.dragStart($dataTransfer, [item.treeNode])" ionweb-droppable drag-enter="item.treeNode.hover = treeOptions.canDrop($dataTransfer, item.treeNode)" drag-leave="item.treeNode.hover = false" drag-over="treeOptions.canDrop($dataTransfer, item.treeNode) ? \'move\' : \'none\'" drop="item.treeNode.hover = false; treeOptions.onDrop($dataTransfer, item.treeNode)"><span class=ionweb-home-item-image><ionweb-icon class=ionweb-home-item-image-placeholder icon={{treeOptions.getIcon(item.treeNode)}}></ionweb-icon><span class="ionweb-home-item-corner-icon favorite ionicon ionicon-star" title={{item.favoriteTooltipText}} ng-class="{active: item.treeNode.isFavorite}" ng-click="$event.preventDefault(); $event.stopPropagation(); toggleFavorite(item);"></span> <span class="ionweb-home-item-corner-icon selection ionicon ionicon-acceptFilled" title={{item.selectTooltipText}} ng-class="{active: item.isSelected}" ng-click="$event.preventDefault(); $event.stopPropagation(); toggleSelected(item);"></span> <span ng-if=item.treeNode.isShared title={{item.sharedTooltipText}} class="ionweb-home-item-corner-icon shared ionicon ionicon-public"></span> <span ng-if=item.treeNode.isOwner title="{{\'Text_Home_Owner\' | resource}}" class="ionweb-home-item-corner-icon owner ionicon ionicon-user"></span></span><div class=ionweb-home-item-text><ion-caption-bar class=ionweb-home-item-name options=item.primaryCaption></ion-caption-bar><ion-caption-bar class=ionweb-home-item-description options=item.secondaryCaption></ion-caption-bar><div ion-tag-editor editable=item.treeNode.canWrite ng-hide="item.isFolder || !(item.treeNode.canWrite || (item.treeNode.tags && item.treeNode.tags.length)) || hideTags" ng-model=item.treeNode.tags options=model.allTagOptions ng-change="item.tagsValidation = model.updateTags(item.treeNode, $value)" ionweb-validation validation-state=item.tagsValidation.state validation-message=item.tagsValidation.message ng-keydown="$event.stopPropagation(); ($event.keyCode == 27 && item.tagsValidation.oldState) ? model.updateTags(item.treeNode, item.tagsValidation.oldState) : null"></div></div></div><div class=ionweb-home-folder ng-if="item.templateType === \'TileFolder\'" title={{item.title}} ng-class="{selected: item.isSelected, \'multiple-selection\': filterOptions.isMultiSelectionMode, \'dnd-hover\': item.treeNode.hover}" ng-click=onItemClick(item) ionweb-context-menu-handler=onItemContextMenu(item) ionweb-draggable drag-start="!filterOptions.isMultiSelectionMode && treeOptions.dragStart($dataTransfer, [item.treeNode])" ionweb-droppable drag-enter="item.treeNode.hover = treeOptions.canDrop($dataTransfer, item.treeNode)" drag-leave="item.treeNode.hover = false" drag-over="treeOptions.canDrop($dataTransfer, item.treeNode) ? \'move\' : \'none\'" drop="item.treeNode.hover = false; treeOptions.onDrop($dataTransfer, item.treeNode)"><ionweb-icon class=ionweb-home-folder-icon icon={{treeOptions.getIcon(item.treeNode)}}></ionweb-icon><ion-caption-bar class=ionweb-home-folder-label options=item.primaryCaption></ion-caption-bar><span class="ionweb-home-item-corner-icon selection ionicon ionicon-acceptFilled" title={{item.selectTooltipText}} ng-class="{active: item.isSelected}" ng-click="$event.preventDefault(); $event.stopPropagation(); toggleSelected(item);"></span></div></span> <span class=ionweb-home-section-empty-label ng-if="section.items.length == 0">{{\'Text_Home_No_Result\' | resource}}</span></div></div></div></div>'),a.put("shell.ui/home/detailsCompact.tpl.html",'<div ng-if=treeOptions.currentPath class="ionweb-tree-root compact" ng-class="{\'ionweb-tree-root-flex\': compact}"><div class="ionweb-tree-item ionweb-tree-header selected"><div class=ionweb-tree-item-label><span class="ionweb-tree-item-icon ionweb-tree-back-icon ionicon ionicon-backArrow" ng-if="treeOptions.currentPath.parent || treeOptions.currentPath != treeOptions.root" ng-click="changeFolder(treeOptions.currentPath.parent || treeOptions.root)"></span><div class="ionweb-tree-item-label-text ionweb-tree-item-label-text-ellipsed">{{treeOptions.currentPath.name}}</div></div><div ng-if="widgetOnly && compact" class=ionweb-tree-root-close-button-container><ionweb-icon class=ionweb-widget-selector-close-button icon=close ng-click="dashboard.closeWidgetSelector()"></div></div><div class=ionweb-tree-body><div class=ionweb-tree-item ng-repeat="item in sections.all.items track by $index" ng-click="onItemClick(item); treeOptions.selectedItem = item;"><div class=ionweb-tree-item-label ng-class="{selected: treeOptions.selectedItem === item}"><ionweb-icon class=ionweb-tree-item-icon icon={{treeOptions.getIcon(item.treeNode)}}></ionweb-icon>{{item.primaryCaption.caption}}<ionweb-icon class=ionweb-tree-item-folder-arrow icon=disclosure ng-if="nodeTypes[item.type] === \'Folder\'"></ionweb-icon></div></div><div class="ionweb-tree-item disabled" ng-if="sections.all.items.length === 0"><div class="ionweb-tree-item-label ionweb-tree-item-label-empty">{{\'Text_Home_No_Result\' | resource}}</div></div></div></div>'),a.put("shell.ui/home/home.tpl.html",'<h2 ng-show="loading || offline" class=text-center class=ion-home-header>{{(offline ? \'Text_Home_Offline\' : \'Text_Home_Loading\') | resource}}</h2><ionweb-split-pane type=vertical position=splitter.position min-position=10 max-position=90 ng-if="!loading && !offline && !compact" class=ion-home><div class="ion-contrast ion-home-left-panel"><div class=ion-home-left-content><ionweb-tree-root></ionweb-tree-root></div></div><div class=ion-home-right-panel><div ng-if=!filterOptions.isMultiSelectionMode class=ionweb-home-filter-toolbar><div class=ionweb-home-search-field ng-class="{\'ionweb-home-search-field-right-padding\': widgetOnly || dashboardOnly}"><span class="ionweb-home-search-left-icon ionicon ionicon-search"></span> <span class="ionweb-home-search-right-icon ionicon ionicon-close" ng-show=filterOptions.textFilter ng-click="filterOptions.textFilter = \'\'"></span> <input type=search class=ion-input ng-model=filterOptions.textFilter ng-model-options="{ debounce: 200 }" placeholder="{{\'Search\' | resource}}" ionweb-shell-autofocus></div><div class=ionweb-home-filter-selector ng-if="!widgetOnly && !dashboardOnly"><div ng-repeat="filter in filterOptions.filters" class=ionweb-home-filter-selector-button ng-class="{selected: filter.id === filterOptions.activeFilter.id}" ng-click="!filterOptions.isWidgetSelector && filterOptions.selectFilter(filter)">{{filter.name}}</div></div><div class=ionweb-widget-selector-close-button-container ng-if=widgetOnly><ionweb-icon class=ionweb-widget-selector-close-button icon=close ng-click="dashboard.closeWidgetSelector()"></div></div><div ng-if=filterOptions.isMultiSelectionMode class=ionweb-home-selection-toolbar>{{selectedModeInfo}}<ionweb-button ng-repeat="op in filterOptions.msOperations" role=primary icon={{op.icon}} ng-click=op.action($event)>{{op.text}}</ionweb-button><ionweb-button role=primary icon=close ng-click=filterOptions.exitMultipleSelectionMode() class=pull-right>{{\'Text_Dashboard_MultipleSelection_Cancel\' | resource }}</ionweb-button></div><ionweb-home-details class=ionweb-home-details></ionweb-home-details></div></ionweb-split-pane><responsive-content responsive-template-resolver="responsiveClass = responsivenessDesignSize; null" responsive-template-resolver-design-size-driven=true></responsive-content><ionweb-home-details ng-if="!loading && !offline && compact" compact=true ng-class="{\'ionweb-home-details-flex\': compact}"></ionweb-home-details>'),a.put("shell.ui/home/listView/header.tpl.html","<button ng-if=canCreateNewFolder() ng-click=newFolder()><span class=\"ionweb-home-list-view-header-icon ionicon ionicon-addFilled\"></span> {{'Text_Home_New_Folder' | resource }}</button>"),a.put("shell.ui/home/listView/searchHeader.tpl.html",'<h3 class=ionweb-home-search-section-header><ionweb-icon class=ionweb-home-search-section-header-icon icon={{treeOptions.getIcon(section.parent)}}></ionweb-icon><span ng-repeat="node in treeOptions.getNodePath(section.parent) track by $index" class=ionweb-home-search-section-header-item>{{node.name}}</span></h3>'),a.put("shell.ui/home/searchHeader.tpl.html","<h3>{{section.name}}</h3>"),a.put("shell.ui/home/tagEditor.tpl.html",'<div ng-click=$event.stopPropagation() class=ionweb-home-tag-editor><div ng-click="ctrl.editable && (ctrl.inEdit = true)" ng-if=!ctrl.inEdit class=ion-tag-items title={{ctrl.title}}><span class=ion-tag-container ng-repeat="tag in ctrl.tags"><span class="ion-tag-icon ionicon-tag"></span> <span class=ion-tag-item>{{tag}}</span></span> <span ng-if=!ctrl.tags.length class=ion-tag-empty><i>{{\'Text_Home_NoTags\' | resource}}</i></span></div><ionweb-autocomplete allow-free-text=true title="Edit tags" ng-model=ctrl.tags new-item-content-template="\'&lt;a&gt;New tag:&lt;/a&gt; \' + $escape($input)" options=ctrl.options multiple=true show-arrow-button=false show-clear-button=false on-blur="ctrl.inEdit = false" editable=!!ctrl.editable ng-if=ctrl.inEdit show-selected-options=false autofocus=true ng-keydown="($event.keyCode == 27) ? (ctrl.inEdit = false) : null"></ionweb-autocomplete></div>'),a.put("shell.ui/home/tilesView/dashboardsHeader.tpl.html",'<h2 class=ionweb-home-section-header>{{"Text_Home_Dashboards" | resource}}</h2>'),a.put("shell.ui/home/tilesView/foldersHeader.tpl.html",'<h2 class=ionweb-home-section-header>{{"Text_Home_Folders" | resource}} <span class="ionweb-home-section-add-item ionicon ionicon-addFilled" ng-if=canCreateNewFolder() ng-click=newFolder()></span></h2>'),a.put("shell.ui/home/tilesView/searchHeader.tpl.html",'<h3 class=ionweb-home-search-section-header><ionweb-icon class=ionweb-home-search-section-header-icon icon={{treeOptions.getIcon(section.parent)}}></ionweb-icon><span ng-repeat="node in treeOptions.getNodePath(section.parent) track by $index" class=ionweb-home-search-section-header-item>{{node.name}}</span></h3>'),a.put("shell.ui/home/tilesView/widgetsHeader.tpl.html",'<h2 class=ionweb-home-section-header>{{"Text_Home_Widgets" | resource}}</h2>'),a.put("shell.ui/home/treeNode.tpl.html",'<div class=ionweb-tree-item ng-class="{selected: selected, \'dnd-hover\': node.hover}" ionweb-context-menu-handler=options.onContextMenu(node) ionweb-droppable drag-enter="node.hover = options.canDrop($dataTransfer, node); openDelayed();" drag-leave="node.hover = false; resetOpenDelayedTimer();" drag-over="options.canDrop($dataTransfer, node) ? \'move\' : \'none\'" drop="node.hover = false; options.onDrop($dataTransfer, node); resetOpenDelayedTimer();"><span class="pull-left ionweb-tree-folder-arrow ionicon ionicon-disclosure" ng-if=children.length ng-class="{expanded: expanded}" ng-click=toggleFolder()></span><div class=ionweb-tree-item-label ng-click=openPath()><ionweb-icon class=ionweb-tree-item-icon icon={{options.getIcon(node)}}></ionweb-icon><ion-caption-bar class=ionweb-tree-item-label-text options=caption></ion-caption-bar></div></div><div class=ionweb-tree-children ng-show=expanded><ionweb-tree-node ng-repeat="child in children track by child.key" tree=child options=options expanded=false></ionweb-tree-node></div>'),a.put("shell.ui/home/treeRoot.tpl.html","<div class=ionweb-tree-root><ionweb-tree-node tree=model.private options=treeNodeOptions expanded=true ng-if=!hidePrivate></ionweb-tree-node><ionweb-tree-node tree=model.favorites options=treeNodeOptions expanded=true></ionweb-tree-node><ionweb-tree-node tree=model.lastUsed options=treeNodeOptions expanded=true></ionweb-tree-node><ionweb-tree-node tree=model.shared options=treeNodeOptions expanded=true></ionweb-tree-node></div>"),a.put("shell.ui/home/workspaceSelector.tpl.html",'<ionweb-popup-container ng-if=!inline><div ng-click="ctrl.isSelectorOpen = !disable" ionweb-popup-anchor><ng-transclude></ng-transclude></div><ionweb-popup visible=ctrl.isSelectorOpen automatically-close=true anchor-point=anchorPoint show-anchor-point-arrow=true><div ionweb-home compact=true options=ctrl.dashboardsOptions filter-options=ctrl.filterOptions on-select=ctrl.onSelect(node) style=width:100%></div></ionweb-popup></ionweb-popup-container><div ionweb-home ng-if=inline compact=true options=ctrl.dashboardsOptions filter-options=ctrl.filterOptions on-select=ctrl.onSelect(node) style=width:100%></div>'),a.put("shell.ui/logoutDlgContent.tpl.html",'<div><div class=modal-header><h4 class=modal-title>{{"Err_AuthBanner_Logout_Title" | resource}}</h4></div><div class=modal-body><p>{{"Err_AuthBanner_Logout_Message" | resource}}</p></div></div>'),a.put("shell.ui/mainToolbarLogo.tpl.html",'<div ng-if=showHomeButton ng-click=dashOpts.showHome() class=brand-logo ng-class="{\'home-shown\': dashOpts.homeShown, \'home-disabled\': !dashOpts.canShowHome }"><div ng-include=logoUrl ng-if="navBarEnabled && !brandingLogo"></div><div ng-if="navBarEnabled && brandingLogo"><img ng-src={{logoUrl}} ng-show="navBarEnabled && brandingLogo" style="max-width:50px; max-height: 28px; width: auto; height: auto"></div></div>'),a.put("shell.ui/nav-menu.tpl.html","<li ng-class=\"{'ion-disabled-menu' : item.isDisabled }\"><div ng-if=canExpand><a ng-click=toggleExpand() ng-class=\"{'ion-menu-item-parent-icon-space': item.parentHaveIcon, 'has-icon': !!item.icon, 'leave-icon-space': !item.icon && item.leaveIconSpace}\"><div class=ion-menu-item-icon-container><ionweb-icon ng-if=item.leaveIconSpace icon={{item.icon}} class=ion-menu-item-icon></ionweb-icon><div class=ion-menu-item-name-container>{{item.name}}</div><span ng-class=\"{'glyphicon-chevron-down': !isExpanded, 'glyphicon-chevron-up': isExpanded}\" class=\"menuicon item-expand glyphicon\"></span></div></a><ul ng-if=isExpanded><ion-main-menu-node ng-repeat=\"item in item.subItems\" item=item leave-icon-space-map=leaveIconSpaceMap></ion-main-menu-node></ul></div><a ng-if=!canExpand ng-click=\"item.isDisabled || item.action()\" ng-class=\"{'ion-menu-item-parent-icon-space': item.parentHaveIcon, 'has-icon': !!item.icon, 'leave-icon-space': !item.icon && item.leaveIconSpace}\"><div class=ion-menu-item-icon-container><ionweb-icon ng-if=item.leaveIconSpace icon={{item.icon}} class=ion-menu-item-icon></ionweb-icon><div class=ion-menu-item-name-container>{{item.name}}</div></div></a></li>"),a.put("shell.ui/numberpreference/numberPreference.tpl.html",'<div ng-show="!config || !config.hideNumberPreference"><div class="clearfix display-flex preference-format-div" ng-if=visibleConfig.showDecimalPlaces><div class=decimal-section><label class="cellformattingoption-decimal-selector preference-primary-label">{{"Text_Decimal_Numbers" | resource}}</label><label class=example-text>{{defaultDecimalNumber}}</label></div><ionweb-numeric-up-down tick=1 ng-model=numberPreference.decimalPlaces min-value=0 max-value=12 spinner-position=0 class="cellformattingoption-numeric-up-down pull-right"></ionweb-numeric-up-down></div><div class=preference-format-div ng-if=visibleConfig.showNegativeBraces><label class=preference-primary-label>{{"Text_Negative_Numbers" | resource}}</label><div class="ion-unrelated-control-bottom-margin radio-group control-content"><div class="radio-inline radio-with-example"><label class="preference-formattype ion-input-radio inline"><input type=radio ng-model=numberPreference.negativeBraces ng-value=true> (1.1)</label><label class="example-text negative-example">({{defaultNumber}})</label></div><div class="radio-inline radio-with-example"><label class="preference-formattype ion-input-radio inline"><input type=radio ng-model=numberPreference.negativeBraces ng-value=false> -1.1</label><label class="example-text negative-example">-{{defaultNumber}}</label></div><div class="field-inline hidden-field"><input type=text class="ion-input separator-text"></div></div></div><div class=preference-format-div ng-if=visibleConfig.showDecimalSymbol><label class=preference-primary-label>{{"Text_Decimal_Symbol" | resource}}</label><div class="ion-unrelated-control-bottom-margin radio-group control-content"><div class="radio-inline radio-with-example"><label class="preference-formattype ion-input-radio inline"><input type=radio ng-model=numberPreference.isSystemDecimalSeparator ng-value=true> System</label><label class=example-text>{{defaultNumber}}</label></div><div class="radio-inline radio-with-example"><label class="preference-formattype ion-input-radio inline"><input type=radio ng-model=numberPreference.isSystemDecimalSeparator ng-value=false> Custom</label><label class=example-text>{{defaultNumber}}</label></div><div class=field-inline><input type=text class="ion-input separator-text" ng-model=numberPreference.customCultureInfo.decimalSeparator ng-trim=false ng-disabled=numberPreference.isSystemDecimalSeparator ionweb-validation validation-state=numericValidationMsgs.decimal.state validation-message="numericValidationMsgs.decimal.message"></div></div></div><div class="preference-format-div last-div" ng-if=visibleConfig.showDigitGroupingSymbol><label class=preference-primary-label>{{"Text_Digit_Group_Symbol" | resource}}</label><div class="ion-unrelated-control-bottom-margin radio-group control-content"><div class="radio-inline radio-with-example"><label class="preference-formattype ion-input-radio inline"><input type=radio ng-model=numberPreference.isSystemThousandSeparator ng-value=true> System</label><label class=example-text>{{defaultNumber}}</label></div><div class="radio-inline radio-with-example"><label class="preference-formattype ion-input-radio inline"><input type=radio ng-model=numberPreference.isSystemThousandSeparator ng-value=false> Custom</label><label class=example-text>{{defaultNumber}}</label></div><div class=field-inline><input type=text class="ion-input separator-text" ng-model=numberPreference.customCultureInfo.thousandSeparator ng-trim=false ng-disabled=numberPreference.isSystemThousandSeparator ionweb-validation validation-state=numericValidationMsgs.digit.state validation-message=numericValidationMsgs.digit.message error-animation="true"></div></div></div></div>'),a.put("shell.ui/preferences/datePreference.tpl.html","<div ng-controller=ionweb.datePreferencesController class=preference-content-container ng-class=\"{'preference-content-container-xs': isSmallScreen}\"><date-time-preference long-formats=longDateFormats short-formats=shortDateFormats format-category=0 ng-model=datePreference config=config override-short-format=overrideShortFormat></date-time-preference></div>"),a.put("shell.ui/preferences/dateTimePreference.tpl.html",'<div><div ng-show="!config || !config.hideShortFormatPreference" class="preference-format-div grouped-control-padding"><label class=preference-primary-label>{{"Text_DateTime_ShortFormat" | resource}}</label><div class="ion-unrelated-control-bottom-margin radio-group"><label class="preference-formattype ion-input-radio inline"><input type=radio ng-model=dateTimePreference.shortFormat.formatType ng-value=0> {{"Text_Predefined" | resource}}</label><label class="preference-formattype ion-input-radio inline"><input type=radio ng-model=dateTimePreference.shortFormat.formatType ng-value=1> {{"Text_Custom" | resource}}</label></div><div class=preference-select-box ng-if="dateTimePreference.shortFormat.formatType === 0"><div class=ion-input-select><select class=ion-input ng-model=$parent.dateTimePreference.shortFormat.formatString ng-options="formattedDate(shortFormat) for shortFormat in shortFormats" ionweb-validation validation-state=datetimeValidationMsgs.shortDateFormat.state validation-message=datetimeValidationMsgs.shortDateFormat.message></select></div><label class="preference-ellipsis preference-label-hide">{{formatDate($parent.dateTimePreference.shortFormat.formatString)}}</label></div><div ng-if="dateTimePreference.shortFormat.formatType === 1"><input class=ion-input type=text ng-model=$parent.dateTimePreference.shortFormat.formatString ionweb-validation validation-state=datetimeValidationMsgs.shortDateFormat.state validation-message=datetimeValidationMsgs.shortDateFormat.message><label class=preference-ellipsis>{{"Text_Preview" | resource}} {{formatDate($parent.dateTimePreference.shortFormat.formatString)}}</label></div></div><div ng-if=overrideShortFormat ng-include=overrideShortFormat class="ion-grouped-control-bottom-margin ion-border-bottom"></div><div ng-show="!config || !config.hideLongFormatPreference" ng-class="{\'last-div\': !(formatCategory === 0  && (!config || !config.hideRangeSeparatorPreference))}" class="preference-format-div grouped-control-padding"><label class=preference-primary-label>{{"Text_DateTime_LongFormat" | resource}}</label><div class="ion-unrelated-control-bottom-margin radio-group"><label class="preference-formattype ion-input-radio inline"><input type=radio ng-model=dateTimePreference.longFormat.formatType ng-value=0> {{"Text_Predefined" | resource}}</label><label class="preference-formattype ion-input-radio inline"><input type=radio ng-model=dateTimePreference.longFormat.formatType ng-value=1> {{"Text_Custom" | resource}}</label></div><div ng-if="dateTimePreference.longFormat.formatType === 0"><div class=ion-input-select><select class=ion-input ng-model=$parent.dateTimePreference.longFormat.formatString ng-options="formattedDate(longFormat) for longFormat in longFormats"></select></div><label class="preference-ellipsis preference-label-hide ion-grouped-control-bottom-margin">{{formatDate($parent.dateTimePreference.longFormat.formatString)}}</label></div><div ng-if="dateTimePreference.longFormat.formatType === 1"><input class=ion-input type=text ng-model=$parent.dateTimePreference.longFormat.formatString><label class="ion-grouped-control-bottom-margin preference-ellipsis">{{"Text_Preview" | resource}} {{formatDate($parent.dateTimePreference.longFormat.formatString)}}</label></div></div><div ng-show="formatCategory === 0 && (!config || !config.hideRangeSeparatorPreference)" class="preference-format-div last-div"><label class=preference-primary-label>{{"Text_DateTime_RangeSeparator" | resource}}</label><div class="ion-unrelated-control-bottom-margin radio-group control-content"><label class="preference-formattype ion-input-radio inline"><input type=radio ng-model=dateTimePreference.rangeSeparator.separatorType ng-value=0> {{"Text_Predefined" | resource}}</label><label class="preference-formattype ion-input-radio inline"><input type=radio ng-model=dateTimePreference.rangeSeparator.separatorType ng-value=1> {{"Text_Custom" | resource}}</label><div class="field-inline range-separator-field"><input type=text class="ion-input separator-text" ng-model=dateTimePreference.rangeSeparator.separator ng-trim=false ng-disabled="dateTimePreference.rangeSeparator.separatorType === 0" ionweb-validation validation-state=datetimeValidationMsgs.rangeSeparator.state validation-message="datetimeValidationMsgs.rangeSeparator.message"></div></div><label class="ion-grouped-control-bottom-margin preference-ellipsis">{{"Text_Preview" | resource}} {{formatDateWithSeparator()}}</label></div></div>'),
a.put("shell.ui/preferences/generalPreference.tpl.html",'<div ng-controller=ionweb.generalPreferencesController class=preference-content-container ng-class="{\'preference-content-container-xs\': isSmallScreen}"><div ng-show="(!config || !config.hideThemePreference) && themePreference.options.length" class="preference-format-div grouped-control-padding"><label class=ion-primary-label-to-control-bottom-margin>{{themePreference.caption}}</label><div class="preference-select-box ion-input-select"><select class=ion-input ng-model=themePreference.value ng-options="theme.displayName for theme in themePreference.options track by theme.name" ng-change=changeHandler()></select></div></div><div ng-show="!config || !config.hideDensityPreference" class="preference-format-div grouped-control-padding"><label class=ion-primary-label-to-control-bottom-margin>{{::\'Title_Preference_CurrentDensity\' | resource}}</label><div density-dialog class="preference-select-box ion-input-select" config=densitySelectorConfig ng-model=selectedDensity is-open=isOpen ng-click="isOpen = !isOpen"><span class=ion-input>{{selectedDensity.displayName}}</span></div></div><label ng-show=!hideTablesTitle class=ion-primary-label-to-control-bottom-margin>{{::\'Msg_Preference_TableTitle\' | resource}}</label><div ng-show="!config || !config.hideResetMultiSortingConfirmationDialogPreferences"><label class=ion-input-checkbox><input type=checkbox ng-model=multiSortPreference.value ng-change="changeHandler()"> {{multiSortPreference.caption}}</label></div><div ng-show="!config || !config.hideAutoEditPreferences"><label class=ion-input-checkbox><input type=checkbox ng-model=autoEditPreference.value ng-change="changeHandler()"> {{autoEditPreference.caption}}</label></div><label ng-show=!hideMiscellaneousTitle class=ion-primary-label-to-control-bottom-margin>{{::\'Msg_Preference_MiscTitle\' | resource}}</label><div ng-show="!config || !config.hideMultipleNotificationsPreferences"><label class=ion-input-checkbox><input type=checkbox ng-model=notificationPreference.value ng-change="changeHandler()"> {{notificationPreference.caption}}</label></div><div ng-show="showMaximizePreference && (!config || !config.hideWidgetMaximizeButtonPreferences)"><label class=ion-input-checkbox><input type=checkbox ng-model=showMaximizePreference.value ng-change="changeHandler()"> {{showMaximizePreference.caption}}</label></div><div ng-show=enableAnalyticsPreference><label class=ion-input-checkbox><input type=checkbox ng-model=enableAnalyticsPreference.value ng-change="changeHandler()"> {{enableAnalyticsPreference.caption}}</label></div></div>'),a.put("shell.ui/preferences/languagePreference.tpl.html","<div ng-controller=ionweb.languagePreferencesController class=preference-content-container ng-class=\"{'preference-content-container-xs': isSmallScreen}\"><language-preference ng-model=languagePreference.languageName languages=languages validation-message=languageValidationMessage config=config></language-preference></div>"),a.put("shell.ui/preferences/numberPreference.tpl.html","<div ng-controller=ionweb.numberPreferencesController class=preference-content-container ng-class=\"{'preference-content-container-xs': isSmallScreen}\"><number-preferences ng-model=numberPreference config=config></number-preferences></div>"),a.put("shell.ui/preferences/timePreference.tpl.html","<div ng-controller=ionweb.timePreferencesController class=preference-content-container ng-class=\"{'preference-content-container-xs': isSmallScreen}\"><date-time-preference long-formats=longTimeFormats short-formats=shortTimeFormats format-category=1 ng-model=timePreference config=config></date-time-preference></div>"),a.put("shell.ui/preferencesDialog.tpl.html",'<div ng-controller=ionweb.preferencesDialogController class=preference-dialog-controller><div class="ion-grouped-control-bottom-margin preference-dialog-content"><uib-tabset class=preference-dialog-flex-container><uib-tab ng-repeat="tab in preferenceTabs" heading={{tab.title}}><ng-include class=preference-dialog-flex-container src=tab.templateUrl></ng-include></uib-tab></uib-tabset></div><div class="ion-button-group align-right preference-dialog-button-container"><ionweb-button class=preference-dialog-buttons role=primary ng-click=applyPreferences(true)>{{"Btn_Ok" | resource}}</ionweb-button><ionweb-button class=preference-dialog-buttons role=secondary ng-click=applyPreferences(false) ng-disabled=!preferenceChanged()>{{"Btn_Apply" | resource}}</ionweb-button><ionweb-button class=preference-dialog-buttons role=secondary ng-click=closePreferences()>{{"Btn_Cancel" | resource}}</ionweb-button></div></div>'),a.put("shell.ui/reauthentication/reauthenticationDialog.tpl.html",'<div ng-controller=ReauthenticationController class=reauth-container><div class=reauth-content><div class=ion-unrelated-control-bottom-margin>{{description ? description : "Reauthentication_Dialog_Description" | resource}}</div><input type=password class="ion-input ion-unrelated-control-bottom-margin" caps-lock-validation is-caps-lock-on=isCapsLockOn placeholder={{&quot;Text_Password&quot;|resource}} ng-model=password autocomplete=off autocapitalize=off autocorrect=off ng-keydown=onKeydown($event)><div class=reauth-info-content><div class=ion-unrelated-control-bottom-margin>{{"Reauthentication_Remaining_Attempts" | resource: {attempts: attemptsRemained} }}</div><div class=caps-lock-msg>{{capsLockMessage}}</div></div><div class="reauth-bad-password-label ion-unrelated-control-bottom-margin" ng-if=wrongPasswordEntered>{{"Reauthentication_Err_Bad_Password"|resource}}</div></div><div class=modal-footer><ionweb-button role=primary ng-click=okClicked() ng-disabled=!password.length class=reauth-action-button>{{"Btn_Ok" | resource}}</ionweb-button><ionweb-button role=secondary ng-click=cancelClicked() class=reauth-action-button ng-if=canCancel>{{"Btn_Cancel" | resource}}</ionweb-button></div></div>'),a.put("shell.ui/reconnectingBanner.tpl.html",'<div ng-controller=ionweb.reconnectingBannerController><div class=modal-header><h4 class=modal-title>{{options.title}}</h4></div><div class=modal-body><p>{{options.message}}</p><input class="ionbtn ionbtn-primary" value={{options.tryNowButtonText}} ng-click=options.tryNow() ng-show=options.tryNow ng-disabled="options.tryNowButtonDisabled"></div><ionweb-idp-buttons ng-if=options.idpOpts opts=options.idpOpts></ionweb-idp-buttons><div class=modal-footer></div></div>'),a.put("shell.ui/shell.tpl.html",'<div ng-mouseover=setIsHover($event) ng-style="{\'height\': windowHeight}" class="ng-cloak main-view" ng-class="{\'is-touch-device\': isTouchDevice, \'is-not-touch-device\': !isTouchDevice, \'toolbar-nav-bottom\': isNavBottom, \'use-flex-layout\': useToolbarFlexLayout }" ng-controller=ionweb.mainViewController><div class=toolbar-nav role=navigation ng-show="navBarEnabled || globalMessages[\'info\'].length || globalMessages[\'warning\'].length || globalMessages[\'danger\'].length"><div ng-if="enableMainMenu && navBarEnabled && !showOptionButton" class="navbar-header navbar-button" ng-controller=ionweb.mainMenuController><a ng-click=toggleNavMenu() class=navbar-brand ng-if=!useBrandingLogoForMainMenu><span class="glyphicon glyphicon-menu-hamburger"></span></a><div ng-click=toggleNavMenu() class=brand-logo ng-if=useBrandingLogoForMainMenu><div ng-include=logoUrl ng-if=!brandingLogo></div><div ng-if=brandingLogo><img ng-src={{logoUrl}} style="max-width:50px; max-height: 28px; width: auto; height: auto"></div></div><div id=slidemenu-wrapper ng-class="{\'show\': navMenuOpen}" ng-click="!isNavBottom && toggleNavMenu()"><div class=slidemenu-wrapper-container ng-click=$event.stopPropagation()><div class=main-menu-logo-container ng-if=showBrandingLogoInMainMenu><img class=main-menu-branding-logo ng-src={{logoUrl}} ng-if=brandingLogo align="center"><div ion-svg-logo-about class=main-menu-ion-logo ng-if=!brandingLogo></div><div class=main-menu-logo-divider></div></div><nav id=slidemenu><ul><ion-main-menu-node ng-repeat="item in menuItems" item=item isexpanded=true></ion-main-menu-node></ul></nav></div></div><div id=slidemenu-block ng-if=navMenuOpen ng-click=toggleNavMenu()></div></div><div ng-if=!logoPositionRight ng-include="\'shell.ui/mainToolbarLogo.tpl.html\'"></div><div class="toolbar-container toolbar-container-left" ng-if="navBarEnabled && toolbarHasItemsOnLeft"><div ng-repeat="toolbarItem in toolbarItems" ng-if=toolbarItem.left><div ng-if=toolbarItem.template ionweb-dynamic=toolbarItem.template></div><div ng-if=toolbarItem.templateUrl ng-include=toolbarItem.templateUrl></div></div></div><div class=dashboard-tabs ng-if="navBarEnabled && !hideDashboardTabs"><div ng-repeat="dashboard in dashOpts.dashboards" class=dashboard-tab ng-class="{active: dashboard.active}" ng-click=dashOpts.selectTab($index) ionweb-draggable=dashOpts.canRearrangeDashboards drag-start="dashboard.title.onDragStart($dataTransfer) && (dashOpts.inDragging = true)" drag-end="(!(dashOpts.inDragging = false)) && dashboard.title.onDragEnd()"><ion-caption-bar options=dashboard.title show-tools=true disable-rename=disableDashboardRename></ion-caption-bar><ion-tab-drop-handler options=dashboard.title active=dashOpts.inDragging class=drop-tab-feedback-dashboard></ion-tab-drop-handler></div><div class=dasbhoard-add-button-container ng-if=showNewTabButton><button class="dashboard-tab dasbhoard-add-button ionicon ionicon-add" ng-click=dashOpts.createDashboardSelectorView() ng-disabled=offlineOpts.visible></button></div></div><div ng-if="!navBarEnabled || hideDashboardTabs" class=dashboard-tabs></div><div ng-if="activeDashboard && activeDashboard.inEditLayoutMode && !activeDashboard.userInteractionDisabled && !activeDashboard.showSelector && !hideAddWidgetButton" class=add-widget-button ng-click="dashOpts.addWidgetClicked($event, activeDashboard)" title="{{\'Toolbar_Dashboard_AddWidget_Tooltip\' | resource}}">{{"Toolbar_Dashboard_AddWidget" | resource}}</div><div class=saving-information ng-if=!hideSavingInformation>{{saveStateInformation}}</div><div class="toolbar-container toolbar-container-right" ng-if="navBarEnabled && toolbarHasItemsOnRight"><div ng-repeat="toolbarItem in toolbarItems" ng-if=toolbarItem.right><div ng-if=toolbarItem.template ionweb-dynamic=toolbarItem.template></div><div ng-if=toolbarItem.templateUrl ng-include=toolbarItem.templateUrl></div></div></div><div class="dropdown navbar-button message-buttons" ng-class="{\'navbar-button-selected\': isMessagePopupVisible}" ng-repeat="type in [\'info\',\'warning\',\'danger\']" ng-show=!!globalMessages[type].length><ionweb-popup-container class=toolbar-item-popup-container><a ionweb-popup-anchor ng-click="isMessagePopupVisible=!isMessagePopupVisible" class=dropdown-toggle title="{{type == \'info\' ? (\'Tooltip_Show_Message\' | resource) : ( type == \'warning\' ? (\'Tooltip_Show_Warnings\' | resource) : (\'Tooltip_Show_Errors\' | resource))}}"><span class="text-{{type}} ionicon ionicon-{{type == \'info\' ? \'information\' : (type==\'warning\' ? \'warning\' : \'error\')}}"></span> {{globalMessages[type].length}}</a><ionweb-popup visible=isMessagePopupVisible show-anchor-point-arrow=true><div id=ionGlobalMessages><div ng-show="globalMessages[type].length>1" class=clearfix><button id=closeAll class="ionbtn ionbtn-secondary" ng-click="globalMessages[type].length=0">{{"Btn_Clear" | resource}}</button></div><ul class=list-group><li class=globalMessage ng-repeat="msg in globalMessages[type] | orderBy:\'-\'"><div class="alert alert-{{msg.type}}" ng-class=msg.extraClasses ng-click=msg.showDetails();$event.stopPropagation();><div class=header-panel><span class=ion-timestamp>{{msg.timestamp | iondate }}</span> <button type=button class=close ng-click=msg.dismiss();$event.stopPropagation();><span aria-hidden=true>&times;</span><span class=sr-only>{{"Btn_Close"| resource}}</span></button></div>{{msg.message}}</div></li></ul></div></ionweb-popup></ionweb-popup-container></div><div density-dialog class="dropdown navbar-button" config=densitySelectorConfig is-open=isOpen ng-class="{\'navbar-button-selected\': isOpen}" style="list-style-type: none" ng-if="navBarEnabled && showNavBarDensitySelector"><a ng-click="isOpen = !isOpen" class=dropdown-toggle><div title="{{\'Title_Density_Selector\' | resource}}"><ionweb-icon icon=--density-selector></ionweb-icon></div></a></div><div class="dropdown navbar-button" ng-class="{\'navbar-button-selected\': popupOptions.isUserPopupVisible}" style="list-style-type: none" ng-if="navBarEnabled && !hideStatusInformation"><ionweb-popup-container class=toolbar-item-popup-container><a ionweb-popup-anchor ng-click=userNavIconClicked() class=dropdown-toggle><div class="global-status service-status {{connectionServices.globalStatus.statusClass}}" title="{{\'Tooltip_Current_SignedIn_User\' | resource}}"><ionweb-icon icon="{{offlineOpts.visible ? \'user-error\' : \'user\'}}" ng-class="{ \'user-error\' : offlineOpts.visible }"></ionweb-icon></div></a><ionweb-popup visible=popupOptions.isUserPopupVisible show-anchor-point-arrow=true><div class="user-popup ion-notification"><div class=user-header><span class="ionicon ionicon-user"></span> <span class="user-info ng-binding">{{userName}}</span></div><div ng-if=offlineOpts.visible class="offline-banner div-padding alert-danger"><div class=offline-banner-error>{{offlineOpts.title}}</div><div class=offline-banner-info>{{offlineOpts.message}}</div><ionweb-button ng-click=offlineOpts.tryNow() class=retry-button ng-show="offlineOpts.tryNowButtonText && offlineOpts.tryNow" ng-disabled=offlineOpts.tryNowButtonDisabled>{{offlineOpts.tryNowButtonText}}</ionweb-button><ionweb-button ng-if=offlineOpts.otpRequired ng-click=openOTPDialog() class=retry-button>{{\'Title_OTP_Required\' | resource}}</ionweb-button><ionweb-idp-buttons ng-if="offlineOpts.idpOpts && !isMobileNativeShell" opts=offlineOpts.idpOpts class=idp-button></ionweb-idp-buttons><ionweb-button ng-if=isMobileNativeShell ng-click=reload() class=retry-button>{{\'Menu_Native_Reload\' | resource}}</ionweb-button></div><div ng-if=offlineOpts.visible class=ion-popup-border-bottom></div><div ng-hide=hideConnectionServices><div ng-repeat="service in connectionServices.serviceList"><div class="service-status {{service.statusClass}}" title="{{service.displayName || service.name}}: {{service.statusStr}}"><span class="ionicon ionicon-connection"></span> <span ng-show=service.name class=ion-service-name role=alert>{{service.displayName || service.name}}</span></div></div><div class=ion-popup-border-bottom></div></div><div class=user-options><a ng-click="!offlineOpts.visible && changePassword()" class=menu-item ng-disabled=offlineOpts.visible ng-if=enableChangePassword><ionweb-icon icon=password></ionweb-icon><span class=option-name>{{\'Title_Change_Password\'| resource}}</span></a> <a ng-show=enableFeedbackButton ng-click="!offlineOpts.visible && feedbackClicked()" class=menu-item ng-disabled=offlineOpts.visible><ionweb-icon icon=feedback></ionweb-icon><span class=option-name>{{\'Text_Feedback\'| resource}}</span></a><div class=ion-popup-border-bottom></div><a ng-show=enableSignoutButton ng-click="!offlineOpts.visible && logoutClicked()" class=menu-item ng-disabled=offlineOpts.visible><ionweb-icon icon=signout></ionweb-icon><span class=option-name>{{\'Text_LogoutAction\'| resource}}</span></a></div></div></ionweb-popup></ionweb-popup-container></div><div class="dropdown navbar-button" style="list-style-type: none" ng-if="navBarEnabled && showOptionButton && enableMainMenu && !hideOptionButton"><a class=dropdown-toggle title="{{\'Tooltip_Dashboard_Menu\' | resource}}" ng-click=dashOpts.optionsClicked($event)><div><span class="ionicon ionicon-settings"></span></div></a></div><div ng-if=logoPositionRight ng-include="\'shell.ui/mainToolbarLogo.tpl.html\'"></div></div><div class=topbar-cover ng-if=dashOpts.inShowHistoryMode></div><div ng-if=dashOpts.homeShown class=home-view><div ionweb-home options=dashOpts class=home-selector></div></div><div class=root-component ionweb-root-component ng-show=!dashOpts.homeShown><div ng-view ng-class="useDashboard ? \'container-fluid-nomargins\' : \'container-fluid-overflow\'"></div></div></div>'),a.put("shell.ui/toolkit/banner/bannerComponent.tpl.html",'<div class=ionweb-navigation-banner-container ng-controller="ionwebBannerComponentController as ctrl"><ionweb-navigation-banner left-text=ctrl.leftText right-text=ctrl.rightText center-text=ctrl.centerText container-bg=ctrl.containerBg edit-mode="component.editMode"></div>'),a.put("shell.ui/toolkit/banner/navigationBanner.tpl.html",'<div class=ionbanner-navigation-component><div class=ionbanner-container ng-class=ctrl.containerBg.classes ng-style=ctrl.containerBg.style ng-mouseenter="ctrl.editable = ctrl.editMode" ng-mouseleave="ctrl.editable = false"><div class=ionbanner-content><div class=ionbanner-content-item ng-if=ctrl.leftText.config.show ng-class="{\'ionbanner-content-item-expanded\': !ctrl.centerText.config.show}" ionweb-popup-container ng-mouseenter="ctrl.leftText.settings.showIcon = true" ng-mouseleave="ctrl.leftText.settings.showIcon = false"><div class="ionbanner-settings ionicon ionicon-settings" ng-if="ctrl.leftText.settings.isOpen || (ctrl.editMode && ctrl.leftText.settings.showIcon)" ng-class=ctrl.leftText.settings.classes ng-click="ctrl.leftText.settings.isOpen = true" ionweb-popup-anchor></div><ionweb-banner-text class=ionbtn ng-click=ctrl.openDashboard(ctrl.leftText) ng-class=ctrl.leftText.model.background.classes ng-style=ctrl.leftText.model.background.style model=ctrl.leftText.model config=ctrl.leftText.config placeholder=ctrl.leftText.placeholder editable=ctrl.editable></ionweb-banner-text><ionweb-popup visible=ctrl.leftText.settings.isOpen automatically-update-position=false automatically-close=!ctrl.leftText.settings.isColorPickerOpen anchor-point="\'BottomLeft\'"><uib-tabset class=ionweb-tabbed-pane ng-class="{\'hide-header\': !ctrl.leftText.editDashboardPath}"><uib-tab index=0 heading=Style><ionweb-style-editor layout=vertical color-picker-open=ctrl.leftText.settings.isColorPickerOpen edit-bg-color=ctrl.leftText.config.canEditBackground edit-fg-color=ctrl.leftText.config.canEditColor edit-wrap=ctrl.leftText.config.canEditWrap edit-alignment=ctrl.leftText.config.canEditAlignment edit-size=ctrl.leftText.config.canEditSize bg-color=ctrl.leftText.model.background.color fg-color=ctrl.leftText.model.color wrap=ctrl.leftText.model.wrap alignment=ctrl.leftText.model.alignment size=ctrl.leftText.model.size></ionweb-style-editor></uib-tab><uib-tab index=1 heading="Target dashboard" ng-if=ctrl.leftText.editDashboardPath><ionweb-workspace-selector inline=true hide-widgets=true on-select="ctrl.leftText.model.dashboardPath = itemPath"></ionweb-workspace-selector></uib-tab></uib-tabset></ionweb-popup></div><div class="ionbanner-content-item ionbanner-content-item-expanded" ng-if=ctrl.centerText.config.show ionweb-popup-container ng-mouseenter="ctrl.centerText.settings.showIcon = true" ng-mouseleave="ctrl.centerText.settings.showIcon = false"><div class="ionbanner-settings ionicon ionicon-settings" ng-if="ctrl.centerText.settings.isOpen || (ctrl.editMode && ctrl.centerText.settings.showIcon)" ng-class=ctrl.centerText.settings.classes ng-click="ctrl.centerText.settings.isOpen = true" ionweb-popup-anchor></div><ionweb-banner-text model=ctrl.centerText.model config=ctrl.centerText.config placeholder=ctrl.centerText.placeholder editable=ctrl.editable></ionweb-banner-text><ionweb-popup visible=ctrl.centerText.settings.isOpen automatically-update-position=false automatically-close=!ctrl.centerText.settings.isColorPickerOpen anchor-point="\'BottomLeft\'"><ionweb-style-editor layout=vertical color-picker-open=ctrl.centerText.settings.isColorPickerOpen edit-bg-color=ctrl.centerText.config.canEditBackground edit-fg-color=ctrl.centerText.config.canEditColor edit-wrap=ctrl.centerText.config.canEditWrap edit-alignment=ctrl.centerText.config.canEditAlignment edit-size=ctrl.centerText.config.canEditSize bg-color=ctrl.centerText.model.background.color fg-color=ctrl.centerText.model.color wrap=ctrl.centerText.model.wrap alignment=ctrl.centerText.model.alignment size=ctrl.centerText.model.size></ionweb-style-editor></ionweb-popup></div><div class=ionbanner-content-item ng-if=ctrl.rightText.config.show ng-class="{\'ionbanner-content-item-expanded\': !ctrl.centerText.config.show}" ionweb-popup-container ng-mouseenter="ctrl.rightText.settings.showIcon = true" ng-mouseleave="ctrl.rightText.settings.showIcon = false"><div class="ionbanner-settings ionicon ionicon-settings" ng-if="ctrl.rightText.settings.isOpen || (ctrl.editMode && ctrl.rightText.settings.showIcon)" ng-class=ctrl.rightText.settings.classes ng-click="ctrl.rightText.settings.isOpen = true" ionweb-popup-anchor></div><ionweb-banner-text class=ionbtn ng-click=ctrl.openDashboard(ctrl.rightText) ng-class=ctrl.rightText.model.background.classes ng-style=ctrl.rightText.model.background.style model=ctrl.rightText.model config=ctrl.rightText.config placeholder=ctrl.rightText.placeholder editable=ctrl.editable></ionweb-banner-text><ionweb-popup visible=ctrl.rightText.settings.isOpen automatically-update-position=false automatically-close=!ctrl.rightText.settings.isColorPickerOpen anchor-point="\'BottomLeft\'"><uib-tabset class=ionweb-tabbed-pane ng-class="{\'hide-header\': !ctrl.rightText.editDashboardPath}"><uib-tab index=0 heading=Style><ionweb-style-editor layout=vertical color-picker-open=ctrl.rightText.settings.isColorPickerOpen edit-bg-color=ctrl.rightText.config.canEditBackground edit-fg-color=ctrl.rightText.config.canEditColor edit-wrap=ctrl.rightText.config.canEditWrap edit-alignment=ctrl.rightText.config.canEditAlignment edit-size=ctrl.rightText.config.canEditSize bg-color=ctrl.rightText.model.background.color fg-color=ctrl.rightText.model.color wrap=ctrl.rightText.model.wrap alignment=ctrl.rightText.model.alignment size=ctrl.rightText.model.size></ionweb-style-editor></uib-tab><uib-tab index=1 heading="Target dashboard" ng-if=ctrl.rightText.editDashboardPath><ionweb-workspace-selector inline=true hide-widgets=true on-select="ctrl.rightText.model.dashboardPath = itemPath"></ionweb-workspace-selector></uib-tab></uib-tabset></ionweb-popup></div></div><div class=ionbanner-global-settings ng-if=ctrl.editMode><div class=ionbanner-global-settings-custom><span class="ionbanner-global-settings-btn glyphicon glyphicon-chevron-left" ng-class="{active: ctrl.leftText.config.show}" ng-click="ctrl.leftText.config.show = !ctrl.leftText.config.show"></span> <span class="ionbanner-global-settings-btn glyphicon glyphicon-text-width" ng-class="{active: ctrl.centerText.config.show}" ng-click="ctrl.centerText.config.show = !ctrl.centerText.config.show"></span> <span class="ionbanner-global-settings-btn glyphicon glyphicon-chevron-right" ng-class="{active: ctrl.rightText.config.show}" ng-click="ctrl.rightText.config.show = !ctrl.rightText.config.show"></span></div><ionweb-style-editor edit-bg-color=true bg-color=ctrl.containerBg.color></ionweb-style-editor></div></div></div>')}]);var ionweb;!function(a){a.Version="1.1.8-p1d8-r15018",a.Copyright="Â© Copyright 2018, ION.",a.GitSha="50b0bb1ece4773cd76bcd2a243f03fa86727291f"}(ionweb||(ionweb={}));
//# sourceMappingURL=shell-bundle.min.js.map