!function(a,b){"function"==typeof define&&define.amd?define("cometd",[],function(){return a["org.cometd"]=b()}):"object"==typeof module&&module.exports?module.exports=b():a.cometd=b()}(this,function(){var a=a||{};a.cometd=a.cometd||{};var b=void 0;return a.cometd.CometD=function(b){function c(a,b){try{return a[b]}catch(c){return}}function d(b){return a.cometd.Utils.isString(b)}function e(a){return void 0!==a&&null!==a&&"function"==typeof a}function f(a,b){for(var c="";--b>0&&!(a>=Math.pow(10,b));)c+="0";return c+=a}function g(a,b){if(window.console){var c=window.console[a];if(e(c)){var d=new Date;[].splice.call(b,0,0,f(d.getHours(),2)+":"+f(d.getMinutes(),2)+":"+f(d.getSeconds(),2)+"."+f(d.getMilliseconds(),3)),c.apply(window.console,b)}}}function h(a){ja._debug("Configuring cometd object with",a),d(a)&&(a={url:a}),a||(a={}),Da=ja._mixin(!1,Da,a);var b=ja.getURL();if(!b)throw new Error("Missing required configuration parameter 'url' specifying the Bayeux server URL");var c=/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(b),e=c[2],f=c[8],g=c[9];if(la=ja._isCrossDomain(e),Da.appendMessageTypeToURL)if(void 0!==g&&g.length>0)ja._info("Appending message type to URI "+f+g+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Da.appendMessageTypeToURL=!1;else{var h=f.split("/"),i=h.length-1;f.match(/\/$/)&&(i-=1),h[i].indexOf(".")>=0&&(ja._info("Appending message type to URI "+f+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Da.appendMessageTypeToURL=!1)}}function i(a){if(a){var b=ua[a.channel];b&&b[a.id]&&(delete b[a.id],ja._debug("Removed",a.listener?"listener":"subscription",a))}}function j(a){a&&!a.listener&&i(a)}function k(){for(var a in ua)if(ua.hasOwnProperty(a)){var b=ua[a];if(b)for(var c=0;c<b.length;++c)j(b[c])}}function l(a){na!==a&&(ja._debug("Status",na,"->",a),na=a,"connected"===na&&(oa=!0))}function m(){return"disconnecting"===na||"disconnected"===na}function n(){var a=++pa;return""+a}function o(a,b,c,d,f){try{return b.call(a,d)}catch(g){var h=ja.onExtensionException;if(e(h)){ja._debug("Invoking extension exception handler",c,g.message||g);try{h.call(ja,g.message||g,c,f,d)}catch(i){ja._info("Exception during execution of extension exception handler",c,i.message||i)}}else ja._info("Exception during execution of extension",c,g.message||g);return d}}function p(a){for(var b=0;b<xa.length&&(void 0!==a&&null!==a);++b){var c=Da.reverseIncomingExtensions?xa.length-1-b:b,d=xa[c],f=d.extension.incoming;if(e(f)){var g=o(d.extension,f,d.name,a,!1);a=void 0===g?a:g}}return a}function q(a){for(var b=0;b<xa.length&&(void 0!==a&&null!==a);++b){var c=xa[b],d=c.extension.outgoing;if(e(d)){var f=o(c.extension,d,c.name,a,!0);a=void 0===f?a:f}}return a}function r(a,b){var c=ua[a];if(c&&c.length>0)for(var d=0;d<c.length;++d){var f=c[d];if(f)try{f.callback.call(f.scope,b)}catch(g){var h=ja.onListenerException;if(e(h)){ja._debug("Invoking listener exception handler",f,g.message||g);try{h.call(ja,g.message||g,f,f.listener,b)}catch(i){ja._info("Exception during execution of listener exception handler",f,i.message||i)}}else ja._info("Exception during execution of listener",f,b,g.message||g)}}}function s(a,b){r(a,b);for(var c=a.split("/"),d=c.length-1,e=d;e>0;--e){var f=c.slice(0,e).join("/")+"/*";e===d&&r(f,b),f+="*",r(f,b)}}function t(){null!==wa&&a.cometd.Utils.clearTimeout(wa),wa=null}function u(b){t();var c=ya.interval+va;ja._debug("Function scheduled in",c,"ms, interval =",ya.interval,"backoff =",va,b),wa=a.cometd.Utils.setTimeout(ja,b,c)}function v(a,b,c,d){for(var e=0;e<b.length;++e){var f=b[e],g=f.id;qa&&(f.clientId=qa),f=q(f),void 0!==f&&null!==f?(f.id=g,b[e]=f):(delete za[g],b.splice(e--,1))}if(0!==b.length){var h=ja.getURL();Da.appendMessageTypeToURL&&(h.match(/\/$/)||(h+="/"),d&&(h+=d));var i={url:h,sync:a,messages:b,onSuccess:function(a){try{Ea.call(ja,a)}catch(b){ja._info("Exception during handling of messages",b.message||b)}},onFailure:function(a,b,c){try{var d=ja.getTransport();c.connectionType=d?d.getType():"unknown",Fa.call(ja,a,b,c)}catch(e){ja._info("Exception during handling of failure",e.message||e)}}};ja._debug("Send",i),ga.send(i,c)}}function w(a){ra>0||ta===!0?sa.push(a):v(!1,[a],!1)}function x(){va=0}function y(){va<Da.maxBackoff&&(va+=Da.backoffIncrement)}function z(){++ra,ja._debug("Starting batch, depth",ra)}function A(){var a=sa;sa=[],a.length>0&&v(!1,a,!1)}function B(){if(--ra,ja._debug("Ending batch, depth",ra),ra<0)throw new Error("Calls to startBatch() and endBatch() are not paired");0!==ra||m()||ta||A()}function C(){if(!m()){var a={id:n(),channel:"/meta/connect",connectionType:ga.getType()};Ca||(a.advice={timeout:0}),l("connecting"),ja._debug("Connect sent",a),v(!1,[a],!0,"connect"),l("connected")}}function D(){l("connecting"),u(function(){C()})}function E(a){a&&(ya=ja._mixin(!1,{},Da.advice,a),ja._debug("New advice",ya))}function F(a){if(t(),a&&ga&&ga.abort(),qa=null,l("disconnected"),ra=0,x(),ga=null,sa.length>0){var b=sa;sa=[],Fa.call(ja,void 0,b,{reason:"Disconnected"})}}function G(a,b,c){var d=ja.onTransportException;if(e(d)){ja._debug("Invoking transport exception handler",a,b,c);try{d.call(ja,c,a,b)}catch(f){ja._info("Exception during execution of transport exception handler",f.message||f)}}}function H(a,b){e(a)&&(b=a,a=void 0),qa=null,k(),m()?(ma.reset(),E(Da.advice)):E(ja._mixin(!1,ya,{reconnect:"retry"})),ra=0,ta=!0,ha=a,ia=b;var c="1.0",d=ja.getURL(),f=ma.findTransportTypes(c,la,d),g={id:n(),version:c,minimumVersion:c,channel:"/meta/handshake",supportedConnectionTypes:f,advice:{timeout:ya.timeout,interval:ya.interval}},h=ja._mixin(!1,{},ha,g);if(ja._putCallback(h.id,b),!ga&&(ga=ma.negotiateTransport(f,c,la,d),!ga)){var i="Could not find initial transport among: "+ma.getTransportTypes();throw ja._warn(i),new Error(i)}ja._debug("Initial transport is",ga.getType()),l("handshaking"),ja._debug("Handshake sent",h),v(!1,[h],!1,"handshake")}function I(){l("handshaking"),ta=!0,u(function(){H(ha,ia)})}function J(a,b){try{a.call(ja,b)}catch(c){var d=ja.onCallbackException;if(e(d)){ja._debug("Invoking callback exception handler",c.message||c);try{d.call(ja,c.message||c,b)}catch(f){ja._info("Exception during execution of callback exception handler",f.message||f)}}else ja._info("Exception during execution of message callback",c.message||c)}}function K(a){var b=ja._getCallback([a.id]);e(b)&&(delete za[a.id],J(b,a))}function L(b){var c=Aa[b.id];if(delete Aa[b.id],ja._debug("Handling remote call response for",b,"with context",c),c){var d=c.timeout;d&&a.cometd.Utils.clearTimeout(d);var f=c.callback;if(e(f))return J(f,b),!0}return!1}function M(a){K(a),s("/meta/handshake",a),s("/meta/unsuccessful",a);var b=!(m()&&oa||"none"===ya.reconnect);b?(y(),I()):F(!0)}function N(a){if(a.successful){qa=a.clientId;var b=ja.getURL(),c=ma.negotiateTransport(a.supportedConnectionTypes,a.version,la,b);if(null===c){var d="Could not negotiate transport with server; client=["+ma.findTransportTypes(a.version,la,b)+"], server=["+a.supportedConnectionTypes+"]",e=ja.getTransport();return G(e.getType(),null,{reason:d,connectionType:e.getType(),transport:e}),ja._warn(d),void F(!0)}ga!==c&&(ja._debug("Transport",ga.getType(),"->",c.getType()),ga=c),ta=!1,A(),a.reestablish=Ba,Ba=!0,K(a),s("/meta/handshake",a);var f=m()?"none":ya.reconnect;switch(f){case"retry":x(),D();break;case"none":F(!0);break;default:throw new Error("Unrecognized advice action "+f)}}else M(a)}function O(a){var b="1.0",c=ja.getURL(),d=ja.getTransport(),e=ma.findTransportTypes(b,la,c),f=ma.negotiateTransport(e,b,la,c);f?(ja._debug("Transport",d.getType(),"->",f.getType()),G(d.getType(),f.getType(),a.failure),M(a),ga=f):(G(d.getType(),null,a.failure),ja._warn("Could not negotiate transport; client=["+e+"]"),F(!0),M(a))}function P(a){s("/meta/connect",a),s("/meta/unsuccessful",a);var b=m()?"none":ya.reconnect;switch(b){case"retry":D(),y();break;case"handshake":ma.reset(),x(),I();break;case"none":F(!0);break;default:throw new Error("Unrecognized advice action"+b)}}function Q(a){if(Ca=a.successful){s("/meta/connect",a);var b=m()?"none":ya.reconnect;switch(b){case"retry":x(),D();break;case"none":F(!1);break;default:throw new Error("Unrecognized advice action "+b)}}else P(a)}function R(a){Ca=!1,P(a)}function S(a){F(!0),K(a),s("/meta/disconnect",a),s("/meta/unsuccessful",a)}function T(a){a.successful?(F(!1),K(a),s("/meta/disconnect",a)):S(a)}function U(a){S(a)}function V(a){var b=ua[a.subscription];if(b)for(var c=b.length-1;c>=0;--c){var d=b[c];if(d&&!d.listener){delete b[c],ja._debug("Removed failed subscription",d);break}}K(a),s("/meta/subscribe",a),s("/meta/unsuccessful",a)}function W(a){a.successful?(K(a),s("/meta/subscribe",a)):V(a)}function X(a){V(a)}function Y(a){K(a),s("/meta/unsubscribe",a),s("/meta/unsuccessful",a)}function Z(a){a.successful?(K(a),s("/meta/unsubscribe",a)):Y(a)}function $(a){Y(a)}function _(a){L(a)||(K(a),s("/meta/publish",a),s("/meta/unsuccessful",a))}function aa(a){void 0!==a.data?L(a)||s(a.channel,a):void 0===a.successful?ja._warn("Unknown Bayeux Message",a):a.successful?(K(a),s("/meta/publish",a)):_(a)}function ba(a){_(a)}function ca(a){if(a=p(a),void 0!==a&&null!==a){E(a.advice);var b=a.channel;switch(b){case"/meta/handshake":N(a);break;case"/meta/connect":Q(a);break;case"/meta/disconnect":T(a);break;case"/meta/subscribe":W(a);break;case"/meta/unsubscribe":Z(a);break;default:aa(a)}}}function da(a){var b=ua[a];if(b)for(var c=0;c<b.length;++c)if(b[c])return!0;return!1}function ea(a,b){var c={scope:a,method:b};if(e(a))c.scope=void 0,c.method=a;else if(d(b)){if(!a)throw new Error("Invalid scope "+a);if(c.method=a[b],!e(c.method))throw new Error("Invalid callback "+b+" for scope "+a)}else if(!e(b))throw new Error("Invalid callback "+b);return c}function fa(a,b,c,d){var e=ea(b,c);ja._debug("Adding",d?"listener":"subscription","on",a,"with scope",e.scope,"and callback",e.method);var f={channel:a,scope:e.scope,callback:e.method,listener:d},g=ua[a];return g||(g=[],ua[a]=g),f.id=g.push(f)-1,ja._debug("Added",d?"listener":"subscription",f),f[0]=a,f[1]=f.id,f}var ga,ha,ia,ja=this,ka=b||"default",la=!1,ma=new a.cometd.TransportRegistry,na="disconnected",oa=!1,pa=0,qa=null,ra=0,sa=[],ta=!1,ua={},va=0,wa=null,xa=[],ya={},za={},Aa={},Ba=!1,Ca=!1,Da={protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,maxURILength:2e3,advice:{timeout:6e4,interval:0,reconnect:"retry"}};this._mixin=function(a,b,d){for(var e=b||{},f=2;f<arguments.length;++f){var g=arguments[f];if(void 0!==g&&null!==g)for(var h in g)if(g.hasOwnProperty(h)){var i=c(g,h),j=c(e,h);if(i===b)continue;if(void 0===i)continue;if(a&&"object"==typeof i&&null!==i)if(i instanceof Array)e[h]=this._mixin(a,j instanceof Array?j:[],i);else{var k="object"!=typeof j||j instanceof Array?{}:j;e[h]=this._mixin(a,k,i)}else e[h]=i}}return e},this._warn=function(){g("warn",arguments)},this._info=function(){"warn"!==Da.logLevel&&g("info",arguments)},this._debug=function(){"debug"===Da.logLevel&&g("debug",arguments)},this._isCrossDomain=function(a){return a&&a!==window.location.host};var Ea,Fa;this.send=w,this._getCallback=function(a){return za[a]},this._putCallback=function(a,b){var c=this._getCallback(a);return e(b)&&(za[a]=b),c},this.receive=ca,Ea=function(a){ja._debug("Received",a);for(var b=0;b<a.length;++b){var c=a[b];ca(c)}},Fa=function(a,b,c){ja._debug("handleFailure",a,b,c),c.transport=a;for(var d=0;d<b.length;++d){var e=b[d],f={id:e.id,successful:!1,channel:e.channel,failure:c};switch(c.message=e,e.channel){case"/meta/handshake":O(f);break;case"/meta/connect":R(f);break;case"/meta/disconnect":U(f);break;case"/meta/subscribe":f.subscription=e.subscription,X(f);break;case"/meta/unsubscribe":f.subscription=e.subscription,$(f);break;default:ba(f)}}},this.registerTransport=function(a,b,c){var d=ma.add(a,b,c);return d&&(this._debug("Registered transport",a),e(b.registered)&&b.registered(a,this)),d},this.getTransportTypes=function(){return ma.getTransportTypes()},this.unregisterTransport=function(a){var b=ma.remove(a);return null!==b&&(this._debug("Unregistered transport",a),e(b.unregistered)&&b.unregistered()),b},this.unregisterTransports=function(){ma.clear()},this.findTransport=function(a){return ma.find(a)},this.configure=function(a){h.call(this,a)},this.init=function(a,b){this.configure(a),this.handshake(b)},this.handshake=function(a,b){l("disconnected"),Ba=!1,H(a,b)},this.disconnect=function(a,b,c){if(!m()){"boolean"!=typeof a&&(c=b,b=a,a=!1),e(b)&&(c=b,b=void 0);var d={id:n(),channel:"/meta/disconnect"},f=this._mixin(!1,{},b,d);ja._putCallback(f.id,c),l("disconnecting"),v(a===!0,[f],!1,"disconnect")}},this.startBatch=function(){z()},this.endBatch=function(){B()},this.batch=function(a,b){var c=ea(a,b);this.startBatch();try{c.method.call(c.scope),this.endBatch()}catch(d){throw this._info("Exception during execution of batch",d.message||d),this.endBatch(),d}},this.addListener=function(a,b,c){if(arguments.length<2)throw new Error("Illegal arguments number: required 2, got "+arguments.length);if(!d(a))throw new Error("Illegal argument type: channel must be a string");return fa(a,b,c,!0)},this.removeListener=function(a){if(!(a&&a.channel&&"id"in a))throw new Error("Invalid argument: expected subscription, not "+a);i(a)},this.clearListeners=function(){ua={}},this.subscribe=function(a,b,c,f,g){if(arguments.length<2)throw new Error("Illegal arguments number: required 2, got "+arguments.length);if(!d(a))throw new Error("Illegal argument type: channel must be a string");if(m())throw new Error("Illegal state: already disconnected");e(b)&&(g=f,f=c,c=b,b=void 0),e(f)&&(g=f,f=void 0);var h=!da(a),i=fa(a,b,c,!1);if(h){var j={id:n(),channel:"/meta/subscribe",subscription:a},k=this._mixin(!1,{},f,j);ja._putCallback(k.id,g),w(k)}return i},this.unsubscribe=function(a,b,c){if(arguments.length<1)throw new Error("Illegal arguments number: required 1, got "+arguments.length);if(m())throw new Error("Illegal state: already disconnected");e(b)&&(c=b,b=void 0),this.removeListener(a);var d=a.channel;if(!da(d)){var f={id:n(),channel:"/meta/unsubscribe",subscription:d},g=this._mixin(!1,{},b,f);ja._putCallback(g.id,c),w(g)}},this.resubscribe=function(a,b){if(j(a),a)return this.subscribe(a.channel,a.scope,a.callback,b)},this.clearSubscriptions=function(){k()},this.publish=function(a,b,c,f){if(arguments.length<1)throw new Error("Illegal arguments number: required 1, got "+arguments.length);if(!d(a))throw new Error("Illegal argument type: channel must be a string");if(/^\/meta\//.test(a))throw new Error("Illegal argument: cannot publish to meta channels");if(m())throw new Error("Illegal state: already disconnected");e(b)?(f=b,b=c={}):e(c)&&(f=c,c={});var g={id:n(),channel:a,data:b},h=this._mixin(!1,{},c,g);ja._putCallback(h.id,f),w(h)},this.remoteCall=function(b,c,f,g){if(arguments.length<1)throw new Error("Illegal arguments number: required 1, got "+arguments.length);if(!d(b))throw new Error("Illegal argument type: target must be a string");if(m())throw new Error("Illegal state: already disconnected");if(e(c)?(g=c,c={},f=Da.maxNetworkDelay):e(f)&&(g=f,f=Da.maxNetworkDelay),"number"!=typeof f)throw new Error("Illegal argument type: timeout must be a number");b.match(/^\//)||(b="/"+b);var h="/service"+b,i={id:n(),channel:h,data:c},j={callback:g};f>0&&(j.timeout=a.cometd.Utils.setTimeout(ja,function(){ja._debug("Timing out remote call",i,"after",f,"ms"),_({id:i.id,error:"406::timeout",successful:!1,failure:{message:i,reason:"Remote Call Timeout"}})},f),ja._debug("Scheduled remote call timeout",i,"in",f,"ms")),Aa[i.id]=j,w(i)},this.getStatus=function(){return na},this.isDisconnected=m,this.setBackoffIncrement=function(a){Da.backoffIncrement=a},this.getBackoffIncrement=function(){return Da.backoffIncrement},this.getBackoffPeriod=function(){return va},this.setLogLevel=function(a){Da.logLevel=a},this.registerExtension=function(a,b){if(arguments.length<2)throw new Error("Illegal arguments number: required 2, got "+arguments.length);if(!d(a))throw new Error("Illegal argument type: extension name must be a string");for(var c=!1,f=0;f<xa.length;++f){var g=xa[f];if(g.name===a){c=!0;break}}return c?(this._info("Could not register extension with name",a,"since another extension with the same name already exists"),!1):(xa.push({name:a,extension:b}),this._debug("Registered extension",a),e(b.registered)&&b.registered(a,this),!0)},this.unregisterExtension=function(a){if(!d(a))throw new Error("Illegal argument type: extension name must be a string");for(var b=!1,c=0;c<xa.length;++c){var f=xa[c];if(f.name===a){xa.splice(c,1),b=!0,this._debug("Unregistered extension",a);var g=f.extension;e(g.unregistered)&&g.unregistered();break}}return b},this.getExtension=function(a){for(var b=0;b<xa.length;++b){var c=xa[b];if(c.name===a)return c.extension}return null},this.getName=function(){return ka},this.getClientId=function(){return qa},this.getURL=function(){if(ga&&"object"==typeof Da.urls){var a=Da.urls[ga.getType()];if(a)return a}return Da.url},this.getTransport=function(){return ga},this.getConfiguration=function(){return this._mixin(!0,{},Da)},this.getAdvice=function(){return this._mixin(!0,{},ya)},a.cometd.WebSocket=window.WebSocket},a.cometd.Transport=function(){var b,c;this.registered=function(a,d){b=a,c=d},this.unregistered=function(){b=null,c=null},this._debug=function(){c._debug.apply(c,arguments)},this._mixin=function(){return c._mixin.apply(c,arguments)},this.getConfiguration=function(){return c.getConfiguration()},this.getAdvice=function(){return c.getAdvice()},this.setTimeout=function(b,d){return a.cometd.Utils.setTimeout(c,b,d)},this.clearTimeout=function(b){a.cometd.Utils.clearTimeout(b)},this.convertToMessages=function(b){if(a.cometd.Utils.isString(b))try{return a.cometd.JSON.fromJSON(b)}catch(c){throw this._debug("Could not convert to JSON the following string",'"'+b+'"'),c}if(a.cometd.Utils.isArray(b))return b;if(void 0===b||null===b)return[];if(b instanceof Object)return[b];throw new Error("Conversion Error "+b+", typeof "+typeof b)},this.accept=function(a,b,c){throw new Error("Abstract")},this.getType=function(){return b},this.send=function(a,b){throw new Error("Abstract")},this.reset=function(){this._debug("Transport",b,"reset")},this.abort=function(){this._debug("Transport",b,"aborted")},this.toString=function(){return this.getType()}},a.cometd.Transport.derive=function(a){function b(){}return b.prototype=a,new b},a.cometd.CallbackPollingTransport=function(){function b(a,b,c){var d=this;return function(){d.transportFailure(a,b,"error",c)}}var c=new a.cometd.RequestTransport,d=a.cometd.Transport.derive(c);return d.accept=function(a,b,c){return!0},d.jsonpSend=function(a){throw new Error("Abstract")},d.transportSend=function(c,d){for(var e=this,f=0,g=c.messages.length,h=[];g>0;){var i=a.cometd.JSON.toJSON(c.messages.slice(f,f+g)),j=c.url.length+encodeURI(i).length,k=this.getConfiguration().maxURILength;if(j>k){if(1===g){var l="Bayeux message too big ("+j+" bytes, max is "+k+") for transport "+this.getType();return void this.setTimeout(b.call(this,c,d,l),0)}--g}else h.push(g),f+=g,g=c.messages.length-f}var m=c;if(h.length>1){var n=0,o=h[0];this._debug("Transport",this.getType(),"split",c.messages.length,"messages into",h.join(" + ")),m=this._mixin(!1,{},c),m.messages=c.messages.slice(n,o),m.onSuccess=c.onSuccess,m.onFailure=c.onFailure;for(var p=1;p<h.length;++p){var q=this._mixin(!1,{},c);n=o,o+=h[p],q.messages=c.messages.slice(n,o),q.onSuccess=c.onSuccess,q.onFailure=c.onFailure,this.send(q,d.metaConnect)}}this._debug("Transport",this.getType(),"sending request",d.id,"envelope",m);try{var r=!0;this.jsonpSend({transport:this,url:m.url,sync:m.sync,headers:this.getConfiguration().requestHeaders,body:a.cometd.JSON.toJSON(m.messages),onSuccess:function(a){var b=!1;try{var c=e.convertToMessages(a);0===c.length?e.transportFailure(m,d,{httpCode:204}):(b=!0,e.transportSuccess(m,d,c))}catch(f){e._debug(f.message||f),b||e.transportFailure(m,d,{exception:f.message||f})}},onError:function(a,b){var c={reason:a,exception:b};r?e.setTimeout(function(){e.transportFailure(m,d,c)},0):e.transportFailure(m,d,c)}}),r=!1}catch(s){this.setTimeout(function(){e.transportFailure(m,d,{exception:s.message||s})},0)}},d},a.cometd.RequestTransport=function(){function b(a){for(;m.length>0;){var b=m[0],c=b[0],d=b[1];if(c.url!==a.url||c.sync!==a.sync)break;m.shift(),a.messages=a.messages.concat(c.messages),this._debug("Coalesced",c.messages.length,"messages from request",d.id)}}function c(a,b){if(this.transportSend(a,b),b.expired=!1,!a.sync){var c=this.getConfiguration().maxNetworkDelay,d=c;b.metaConnect===!0&&(d+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",d,"ms for the response, maxNetworkDelay",c);var e=this;b.timeout=this.setTimeout(function(){b.expired=!0;var c="Request "+b.id+" of transport "+e.getType()+" exceeded "+d+" ms max network delay",f={reason:c},g=b.xhr;f.httpCode=e.xhrStatus(g),e.abortXHR(g),e._debug(c),e.complete(b,!1,b.metaConnect),a.onFailure(g,a.messages,f)},d)}}function d(a){var b=++j,d={id:b,metaConnect:!1,envelope:a};l.length<this.getConfiguration().maxConnections-1?(l.push(d),c.call(this,a,d)):(this._debug("Transport",this.getType(),"queueing request",b,"envelope",a),m.push([a,d]))}function e(a){var b=a.id;if(this._debug("Transport",this.getType(),"metaConnect complete, request",b),null!==k&&k.id!==b)throw new Error("Longpoll request mismatch, completing request "+b);k=null}function f(c,e){var f=a.cometd.Utils.inArray(c,l);if(f>=0&&l.splice(f,1),m.length>0){var g=m.shift(),h=g[0],i=g[1];if(this._debug("Transport dequeued request",i.id),e)this.getConfiguration().autoBatch&&b.call(this,h),d.call(this,h),this._debug("Transport completed request",c.id,h);else{var j=this;this.setTimeout(function(){j.complete(i,!1,i.metaConnect);var a={reason:"Previous request failed"},b=i.xhr;a.httpCode=j.xhrStatus(b),h.onFailure(b,h.messages,a)},0)}}}function g(a){if(null!==k)throw new Error("Concurrent metaConnect requests not allowed, request id="+k.id+" not yet completed");var b=++j;this._debug("Transport",this.getType(),"metaConnect send, request",b,"envelope",a);var d={id:b,metaConnect:!0,envelope:a};c.call(this,a,d),k=d}var h=new a.cometd.Transport,i=a.cometd.Transport.derive(h),j=0,k=null,l=[],m=[];return i.complete=function(a,b,c){c?e.call(this,a):f.call(this,a,b)},i.transportSend=function(a,b){throw new Error("Abstract")},i.transportSuccess=function(a,b,c){b.expired||(this.clearTimeout(b.timeout),this.complete(b,!0,b.metaConnect),c&&c.length>0?a.onSuccess(c):a.onFailure(b.xhr,a.messages,{httpCode:204}))},i.transportFailure=function(a,b,c){b.expired||(this.clearTimeout(b.timeout),this.complete(b,!1,b.metaConnect),a.onFailure(b.xhr,a.messages,c))},i.send=function(a,b){b?g.call(this,a):d.call(this,a)},i.abort=function(){h.abort();for(var a=0;a<l.length;++a){var b=l[a];b&&(this._debug("Aborting request",b),this.abortXHR(b.xhr)||this.transportFailure(b.envelope,b,{reason:"abort"}))}k&&(this._debug("Aborting metaConnect request",k),this.abortXHR(k.xhr)||this.transportFailure(k.envelope,k,{reason:"abort"})),this.reset()},i.reset=function(){h.reset(),k=null,l=[],m=[]},i.abortXHR=function(a){if(a)try{var b=a.readyState;return a.abort(),b!==XMLHttpRequest.UNSENT}catch(c){this._debug(c.message||c)}return!1},i.xhrStatus=function(a){if(a)try{return a.status}catch(b){this._debug(b.message||b)}return-1},i},a.cometd.LongPollingTransport=function(){var b=new a.cometd.RequestTransport,c=a.cometd.Transport.derive(b),d=!0;return c.accept=function(a,b,c){return d||!b},c.xhrSend=function(a){throw new Error("Abstract")},c.transportSend=function(b,c){this._debug("Transport",this.getType(),"sending request",c.id,"envelope",b);var e=this;try{var f=!0;c.xhr=this.xhrSend({transport:this,url:b.url,sync:b.sync,headers:this.getConfiguration().requestHeaders,body:a.cometd.JSON.toJSON(b.messages),onSuccess:function(a){e._debug("Transport",e.getType(),"received response",a);var f=!1;try{var g=e.convertToMessages(a);0===g.length?(d=!1,e.transportFailure(b,c,{httpCode:204})):(f=!0,e.transportSuccess(b,c,g))}catch(h){if(e._debug(h.message||h),!f){d=!1;var i={exception:h.message||h};i.httpCode=e.xhrStatus(c.xhr),e.transportFailure(b,c,i)}}},onError:function(a,g){e._debug("Transport",e.getType(),"received error",a,g),d=!1;var h={reason:a,exception:g};h.httpCode=e.xhrStatus(c.xhr),f?e.setTimeout(function(){e.transportFailure(b,c,h)},0):e.transportFailure(b,c,h)}}),f=!1}catch(g){d=!1,this.setTimeout(function(){e.transportFailure(b,c,{exception:g.message||g})},0)}},c.reset=function(){b.reset(),d=!0},c},a.cometd.TransportRegistry=function(){var a=[],b={};this.getTransportTypes=function(){return a.slice(0)},this.findTransportTypes=function(c,d,e){for(var f=[],g=0;g<a.length;++g){var h=a[g];b[h].accept(c,d,e)===!0&&f.push(h)}return f},this.negotiateTransport=function(c,d,e,f){for(var g=0;g<a.length;++g)for(var h=a[g],i=0;i<c.length;++i)if(h===c[i]){var j=b[h];if(j.accept(d,e,f)===!0)return j}return null},this.add=function(c,d,e){for(var f=!1,g=0;g<a.length;++g)if(a[g]===c){f=!0;break}return f||("number"!=typeof e?a.push(c):a.splice(e,0,c),b[c]=d),!f},this.find=function(c){for(var d=0;d<a.length;++d)if(a[d]===c)return b[c];return null},this.remove=function(c){for(var d=0;d<a.length;++d)if(a[d]===c){a.splice(d,1);var e=b[c];return delete b[c],e}return null},this.clear=function(){a=[],b={}},this.reset=function(){for(var c=0;c<a.length;++c)b[a[c]].reset()}},a.cometd.WebSocketTransport=function(){function b(a,b){a&&(this.webSocketClose(a,b.code,b.reason),this.onClose(a,b))}function c(a){return a===o||a===n}function d(a,b,c){for(var d=[],e=0;e<b.messages.length;++e){var f=b.messages[e];f.id&&d.push(f.id)}a.envelopes[d.join(",")]=[b,c],this._debug("Transport",this.getType(),"stored envelope, envelopes",a.envelopes)}function e(d){if(!o){var e=h.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",e);try{var f=h.getConfiguration().protocol;d.webSocket=f?new a.cometd.WebSocket(e,f):new a.cometd.WebSocket(e),o=d}catch(g){throw k=!1,this._debug("Exception while creating WebSocket object",g.message||g),g}m=h.getConfiguration().stickyReconnect!==!1;var i=this,j=h.getConfiguration().connectTimeout;j>0&&(d.connectTimer=this.setTimeout(function(){h._debug("Transport",i.getType(),"timed out while connecting to URL",e,":",j,"ms"),b.call(i,d,{code:1e3,reason:"Connect Timeout"})},j));var p=function(){h._debug("WebSocket onopen",d),d.connectTimer&&i.clearTimeout(d.connectTimer),c(d)?(o=null,n=d,l=!0,i.onOpen(d)):(h._warn("Closing extra WebSocket connection",this,"active connection",n),b.call(i,d,{code:1e3,reason:"Extra Connection"}))},q=function(a){a=a||{code:1e3},h._debug("WebSocket onclose",d,a,"connecting",o,"current",n),d.connectTimer&&i.clearTimeout(d.connectTimer),i.onClose(d,a)},r=function(a){h._debug("WebSocket onmessage",a,d),i.onMessage(d,a)};d.webSocket.onopen=p,d.webSocket.onclose=q,d.webSocket.onerror=function(){q({code:1e3,reason:"Error"})},d.webSocket.onmessage=r,this._debug("Transport",this.getType(),"configured callbacks on",d)}}function f(c,d,e){var f=a.cometd.JSON.toJSON(d.messages);c.webSocket.send(f),this._debug("Transport",this.getType(),"sent",d,"metaConnect =",e),this.onStat({tx:f.length});var g=this.getConfiguration().maxNetworkDelay,i=g;e&&(i+=this.getAdvice().timeout,p=!0);for(var j=this,k=[],l=0;l<d.messages.length;++l)!function(){var a=d.messages[l];a.id&&(k.push(a.id),c.timeouts[a.id]=this.setTimeout(function(){h._debug("Transport",j.getType(),"timing out message",a.id,"after",i,"on",c),b.call(j,c,{code:1e3,reason:"Message Timeout"})},i))}();this._debug("Transport",this.getType(),"waiting at most",i,"ms for messages",k,"maxNetworkDelay",g,", timeouts:",c.timeouts)}function g(a,c,g){try{null===a?(a=o||{envelopes:{},timeouts:{}},d.call(this,a,c,g),e.call(this,a)):(d.call(this,a,c,g),f.call(this,a,c,g))}catch(h){var i=this;this.setTimeout(function(){b.call(i,a,{code:1e3,reason:"Exception",exception:h.message||h})},0)}}var h,i=new a.cometd.Transport,j=a.cometd.Transport.derive(i),k=!0,l=!1,m=!0,n=null,o=null,p=!1,q=null;return j.reset=function(){i.reset(),k=!0,l=!1,m=!0,n=null,o=null,p=!1},j._notifySuccess=function(a,b){a.call(this,b)},j._notifyFailure=function(a,b,c,d){a.call(this,b,c,d)},j.onOpen=function(a){var b=a.envelopes;this._debug("Transport",this.getType(),"opened",a,"pending messages",b);for(var c in b)if(b.hasOwnProperty(c)){var d=b[c],e=d[0],g=d[1];q=e.onSuccess,f.call(this,a,e,g)}},j.onMessage=function(b,c){this._debug("Transport",this.getType(),"received websocket message",c,b),this.onStat({rx:c.data&&c.data.length||0});for(var d=!1,e=this.convertToMessages(c.data),f=[],g=0;g<e.length;++g){var h=e[g];if((/^\/meta\//.test(h.channel)||void 0===h.data)&&h.id){f.push(h.id);var i=b.timeouts[h.id];i&&(this.clearTimeout(i),delete b.timeouts[h.id],this._debug("Transport",this.getType(),"removed timeout for message",h.id,", timeouts",b.timeouts))}"/meta/connect"===h.channel&&(p=!1),"/meta/disconnect"!==h.channel||p||(d=!0)}for(var j=!1,k=b.envelopes,l=0;l<f.length;++l){var m=f[l];for(var n in k)if(k.hasOwnProperty(n)){var o=n.split(","),r=a.cometd.Utils.inArray(m,o);if(r>=0){j=!0,o.splice(r,1);var s=k[n][0],t=k[n][1];delete k[n],o.length>0&&(k[o.join(",")]=[s,t]);break}}}j&&this._debug("Transport",this.getType(),"removed envelope, envelopes",k),this._notifySuccess(q,e),d&&this.webSocketClose(b,1e3,"Disconnect")},j.onClose=function(a,b){this._debug("Transport",this.getType(),"closed",a,b),c(a)&&(k=m&&l,o=null,n=null);var d=a.timeouts;a.timeouts={};for(var e in d)d.hasOwnProperty(e)&&this.clearTimeout(d[e]);var f=a.envelopes;a.envelopes={};for(var g in f)if(f.hasOwnProperty(g)){var h=f[g][0],i=f[g][1];i&&(p=!1);var j={websocketCode:b.code,reason:b.reason};b.exception&&(j.exception=b.exception),this._notifyFailure(h.onFailure,a,h.messages,j)}},j.registered=function(a,b){i.registered(a,b),h=b},j.accept=function(b,c,d){return this._debug("Transport",this.getType(),"accept, supported:",k),k&&!!a.cometd.WebSocket&&h.websocketEnabled!==!1},j.send=function(a,b){this._debug("Transport",this.getType(),"sending",a,"metaConnect =",b),g.call(this,n,a,b)},j.webSocketClose=function(a,b,c){try{a.webSocket&&a.webSocket.close(b,c)}catch(d){this._debug(d.message||d)}},j.abort=function(){i.abort(),b.call(this,n,{code:1e3,reason:"Abort"}),this.reset()},j.onStat=function(a){},j},a.cometd.Utils={},a.cometd.Utils.isString=function(a){return void 0!==a&&null!==a&&("string"==typeof a||a instanceof String)},a.cometd.Utils.isArray=function(a){return void 0!==a&&null!==a&&a instanceof Array},a.cometd.Utils.inArray=function(a,b){for(var c=0;c<b.length;++c)if(a===b[c])return c;return-1},a.cometd.Utils.setTimeout=function(a,b,c){return window.setTimeout(function(){try{a._debug("Invoking timed function",b),b()}catch(c){a._debug("Exception invoking timed function",b,c.message||c)}},c)},a.cometd.Utils.clearTimeout=function(a){window.clearTimeout(a)},function(){function c(a){return a.AckExtension=function(){function a(a,c){b._debug(a,c)}var b,c=!1,d=-1;this.registered=function(c,d){b=d,a("AckExtension: executing registration callback")},this.unregistered=function(){a("AckExtension: executing unregistration callback"),b=null},this.incoming=function(b){var e=b.channel;if("/meta/handshake"==e)c=b.ext&&b.ext.ack,a("AckExtension: server supports acks",c);else if("/meta/connect"==e&&b.successful&&c){var f=b.ext;f&&"number"==typeof f.ack&&(d=f.ack,a("AckExtension: server sent ack id",d))}return b},this.outgoing=function(e){var f=e.channel;return"/meta/handshake"==f?(e.ext||(e.ext={}),e.ext.ack=b&&b.ackEnabled!==!1,d=-1):"/meta/connect"==f&&c&&(e.ext||(e.ext={}),e.ext.ack=d,a("AckExtension: client sending ack id",d)),e}}}"function"==typeof b&&b.amd?b(["org/cometd"],c):c(a.cometd)}(),function(){function c(a){
return a.TimeSyncExtension=function(b){function c(a,b){d._debug(a,b)}var d,e=b&&b.maxSamples||10,f=[],g=[],h=0,i=0;this.registered=function(a,b){d=b,c("TimeSyncExtension: executing registration callback")},this.unregistered=function(){c("TimeSyncExtension: executing unregistration callback"),d=null,f=[],g=[]},this.incoming=function(a){var b=a.channel;if(b&&0===b.indexOf("/meta/")&&a.ext&&a.ext.timesync){var d=a.ext.timesync;c("TimeSyncExtension: server sent timesync",d);var j=(new Date).getTime(),k=(j-d.tc-d.p)/2,l=d.ts-d.tc-k;f.push(k),g.push(l),g.length>e&&(g.shift(),f.shift());for(var m=g.length,n=0,o=0,p=0;p<m;++p)n+=f[p],o+=g[p];h=parseInt((n/m).toFixed()),i=parseInt((o/m).toFixed()),c("TimeSyncExtension: network lag",h,"ms, time offset with server",i,"ms",h,i)}return a},this.outgoing=function(b){var d=b.channel;return d&&0===d.indexOf("/meta/")&&(b.ext||(b.ext={}),b.ext.timesync={tc:(new Date).getTime(),l:h,o:i},c("TimeSyncExtension: client sending timesync",a.JSON.toJSON(b.ext.timesync))),b},this.getTimeOffset=function(){return i},this.getTimeOffsetSamples=function(){return g},this.getNetworkLag=function(){return h},this.getServerTime=function(){return(new Date).getTime()+i},this.getServerDate=function(){return new Date(this.getServerTime())},this.setTimeout=function(b,c){var e=c instanceof Date?c.getTime():0+c,f=e-i,g=f-(new Date).getTime();return g<=0&&(g=1),a.Utils.setTimeout(d,b,g)}}}"function"==typeof b&&b.amd?b(["org/cometd"],c):c(a.cometd)}(),a.cometd});