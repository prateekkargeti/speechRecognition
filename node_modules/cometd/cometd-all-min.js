!function(a,b){"function"==typeof define&&define.amd?define("cometd",[],function(){return a["org.cometd"]=b()}):"object"==typeof exports?module.exports=b():a.cometd=b()}(this,function(){var a=a||{};a.cometd=a.cometd||{};var b=void 0;return a.cometd.CometD=function(b){function c(a,b){try{return a[b]}catch(c){return}}function d(b){return a.cometd.Utils.isString(b)}function e(a){return void 0===a||null===a?!1:"function"==typeof a}function f(a,b){for(var c="";--b>0&&!(a>=Math.pow(10,b));)c+="0";return c+=a}function g(a,b){if(window.console){var c=window.console[a];if(e(c)){var d=new Date;[].splice.call(b,0,0,f(d.getHours(),2)+":"+f(d.getMinutes(),2)+":"+f(d.getSeconds(),2)+"."+f(d.getMilliseconds(),3)),c.apply(window.console,b)}}}function h(a){ja._debug("Configuring cometd object with",a),d(a)&&(a={url:a}),a||(a={}),Ca=ja._mixin(!1,Ca,a);var b=ja.getURL();if(!b)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var c=/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(b),e=c[2],f=c[8],g=c[9];if(la=ja._isCrossDomain(e),Ca.appendMessageTypeToURL)if(void 0!==g&&g.length>0)ja._info("Appending message type to URI "+f+g+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Ca.appendMessageTypeToURL=!1;else{var h=f.split("/"),i=h.length-1;f.match(/\/$/)&&(i-=1),h[i].indexOf(".")>=0&&(ja._info("Appending message type to URI "+f+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Ca.appendMessageTypeToURL=!1)}}function i(a){if(a){var b=ta[a.channel];b&&b[a.id]&&(delete b[a.id],ja._debug("Removed",a.listener?"listener":"subscription",a))}}function j(a){a&&!a.listener&&i(a)}function k(){for(var a in ta){var b=ta[a];if(b)for(var c=0;c<b.length;++c)j(b[c])}}function l(a){na!==a&&(ja._debug("Status",na,"->",a),na=a)}function m(){return"disconnecting"===na||"disconnected"===na}function n(){var a=++oa;return""+a}function o(a,b,c,d,f){try{return b.call(a,d)}catch(g){var h=ja.onExtensionException;if(e(h)){ja._debug("Invoking extension exception handler",c,g);try{h.call(ja,g,c,f,d)}catch(i){ja._info("Exception during execution of extension exception handler",c,i)}}else ja._info("Exception during execution of extension",c,g);return d}}function p(a){for(var b=0;b<wa.length&&(void 0!==a&&null!==a);++b){var c=Ca.reverseIncomingExtensions?wa.length-1-b:b,d=wa[c],f=d.extension.incoming;if(e(f)){var g=o(d.extension,f,d.name,a,!1);a=void 0===g?a:g}}return a}function q(a){for(var b=0;b<wa.length&&(void 0!==a&&null!==a);++b){var c=wa[b],d=c.extension.outgoing;if(e(d)){var f=o(c.extension,d,c.name,a,!0);a=void 0===f?a:f}}return a}function r(a,b){var c=ta[a];if(c&&c.length>0)for(var d=0;d<c.length;++d){var f=c[d];if(f)try{f.callback.call(f.scope,b)}catch(g){var h=ja.onListenerException;if(e(h)){ja._debug("Invoking listener exception handler",f,g);try{h.call(ja,g,f,f.listener,b)}catch(i){ja._info("Exception during execution of listener exception handler",f,i)}}else ja._info("Exception during execution of listener",f,b,g)}}}function s(a,b){r(a,b);for(var c=a.split("/"),d=c.length-1,e=d;e>0;--e){var f=c.slice(0,e).join("/")+"/*";e===d&&r(f,b),f+="*",r(f,b)}}function t(){null!==va&&a.cometd.Utils.clearTimeout(va),va=null}function u(b){t();var c=xa.interval+ua;ja._debug("Function scheduled in",c,"ms, interval =",xa.interval,"backoff =",ua,b),va=a.cometd.Utils.setTimeout(ja,b,c)}function v(a,b,c,d){for(var e=0;e<b.length;++e){var f=b[e],g=f.id;pa&&(f.clientId=pa),f=q(f),void 0!==f&&null!==f?(f.id=g,b[e]=f):(delete ya[g],b.splice(e--,1))}if(0!==b.length){var h=ja.getURL();Ca.appendMessageTypeToURL&&(h.match(/\/$/)||(h+="/"),d&&(h+=d));var i={url:h,sync:a,messages:b,onSuccess:function(a){try{Da.call(ja,a)}catch(b){ja._info("Exception during handling of messages",b)}},onFailure:function(a,b,c){try{var d=ja.getTransport();c.connectionType=d?d.getType():"unknown",Ea.call(ja,a,b,c)}catch(e){ja._info("Exception during handling of failure",e)}}};ja._debug("Send",i),ga.send(i,c)}}function w(a){qa>0||sa===!0?ra.push(a):v(!1,[a],!1)}function x(){ua=0}function y(){ua<Ca.maxBackoff&&(ua+=Ca.backoffIncrement)}function z(){++qa,ja._debug("Starting batch, depth",qa)}function A(){var a=ra;ra=[],a.length>0&&v(!1,a,!1)}function B(){if(--qa,ja._debug("Ending batch, depth",qa),0>qa)throw"Calls to startBatch() and endBatch() are not paired";0!==qa||m()||sa||A()}function C(){if(!m()){var a={id:n(),channel:"/meta/connect",connectionType:ga.getType()};Ba||(a.advice={timeout:0}),l("connecting"),ja._debug("Connect sent",a),v(!1,[a],!0,"connect"),l("connected")}}function D(){l("connecting"),u(function(){C()})}function E(a){a&&(xa=ja._mixin(!1,{},Ca.advice,a),ja._debug("New advice",xa))}function F(a){if(t(),a&&ga&&ga.abort(),pa=null,l("disconnected"),qa=0,x(),ga=null,ra.length>0){var b=ra;ra=[],Ea.call(ja,void 0,b,{reason:"Disconnected"})}}function G(a,b,c){var d=ja.onTransportException;if(e(d)){ja._debug("Invoking transport exception handler",a,b,c);try{d.call(ja,c,a,b)}catch(f){ja._info("Exception during execution of transport exception handler",f)}}}function H(a,b){e(a)&&(b=a,a=void 0),pa=null,k(),m()?(ma.reset(),E(Ca.advice)):E(ja._mixin(!1,xa,{reconnect:"retry"})),qa=0,sa=!0,ha=a,ia=b;var c="1.0",d=ja.getURL(),f=ma.findTransportTypes(c,la,d),g={id:n(),version:c,minimumVersion:c,channel:"/meta/handshake",supportedConnectionTypes:f,advice:{timeout:xa.timeout,interval:xa.interval}},h=ja._mixin(!1,{},ha,g);if(ja._putCallback(h.id,b),!ga&&(ga=ma.negotiateTransport(f,c,la,d),!ga)){var i="Could not find initial transport among: "+ma.getTransportTypes();throw ja._warn(i),i}ja._debug("Initial transport is",ga.getType()),l("handshaking"),ja._debug("Handshake sent",h),v(!1,[h],!1,"handshake")}function I(){l("handshaking"),sa=!0,u(function(){H(ha,ia)})}function J(a,b){try{a.call(ja,b)}catch(c){var d=ja.onCallbackException;if(e(d)){ja._debug("Invoking callback exception handler",c);try{d.call(ja,c,b)}catch(f){ja._info("Exception during execution of callback exception handler",f)}}else ja._info("Exception during execution of message callback",c)}}function K(a){var b=ja._getCallback([a.id]);e(b)&&(delete ya[a.id],J(b,a))}function L(b){var c=za[b.id];if(delete za[b.id],ja._debug("Handling remote call response for",b,"with context",c),c){var d=c.timeout;d&&a.cometd.Utils.clearTimeout(d);var f=c.callback;if(e(f))return J(f,b),!0}return!1}function M(a){K(a),s("/meta/handshake",a),s("/meta/unsuccessful",a);var b=!m()&&"none"!==xa.reconnect;b?(y(),I()):F(!0)}function N(a){if(a.successful){pa=a.clientId;var b=ja.getURL(),c=ma.negotiateTransport(a.supportedConnectionTypes,a.version,la,b);if(null===c){var d="Could not negotiate transport with server; client=["+ma.findTransportTypes(a.version,la,b)+"], server=["+a.supportedConnectionTypes+"]",e=ja.getTransport();return G(e.getType(),null,{reason:d,connectionType:e.getType(),transport:e}),ja._warn(d),void F(!0)}ga!==c&&(ja._debug("Transport",ga.getType(),"->",c.getType()),ga=c),sa=!1,A(),a.reestablish=Aa,Aa=!0,K(a),s("/meta/handshake",a);var f=m()?"none":xa.reconnect;switch(f){case"retry":x(),D();break;case"none":F(!0);break;default:throw"Unrecognized advice action "+f}}else M(a)}function O(a){var b="1.0",c=ja.getURL(),d=ja.getTransport(),e=ma.findTransportTypes(b,la,c),f=ma.negotiateTransport(e,b,la,c);f?(ja._debug("Transport",d.getType(),"->",f.getType()),G(d.getType(),f.getType(),a.failure),M(a),ga=f):(G(d.getType(),null,a.failure),ja._warn("Could not negotiate transport; client=["+e+"]"),F(!0),M(a))}function P(a){s("/meta/connect",a),s("/meta/unsuccessful",a);var b=m()?"none":xa.reconnect;switch(b){case"retry":D(),y();break;case"handshake":ma.reset(),x(),I();break;case"none":F(!0);break;default:throw"Unrecognized advice action"+b}}function Q(a){if(Ba=a.successful){s("/meta/connect",a);var b=m()?"none":xa.reconnect;switch(b){case"retry":x(),D();break;case"none":F(!1);break;default:throw"Unrecognized advice action "+b}}else P(a)}function R(a){Ba=!1,P(a)}function S(a){F(!0),K(a),s("/meta/disconnect",a),s("/meta/unsuccessful",a)}function T(a){a.successful?(F(!1),K(a),s("/meta/disconnect",a)):S(a)}function U(a){S(a)}function V(a){var b=ta[a.subscription];if(b)for(var c=b.length-1;c>=0;--c){var d=b[c];if(d&&!d.listener){delete b[c],ja._debug("Removed failed subscription",d);break}}K(a),s("/meta/subscribe",a),s("/meta/unsuccessful",a)}function W(a){a.successful?(K(a),s("/meta/subscribe",a)):V(a)}function X(a){V(a)}function Y(a){K(a),s("/meta/unsubscribe",a),s("/meta/unsuccessful",a)}function Z(a){a.successful?(K(a),s("/meta/unsubscribe",a)):Y(a)}function $(a){Y(a)}function _(a){L(a)||(K(a),s("/meta/publish",a),s("/meta/unsuccessful",a))}function aa(a){void 0!==a.data?L(a)||s(a.channel,a):void 0===a.successful?ja._warn("Unknown Bayeux Message",a):a.successful?(K(a),s("/meta/publish",a)):_(a)}function ba(a){_(a)}function ca(a){if(a=p(a),void 0!==a&&null!==a){E(a.advice);var b=a.channel;switch(b){case"/meta/handshake":N(a);break;case"/meta/connect":Q(a);break;case"/meta/disconnect":T(a);break;case"/meta/subscribe":W(a);break;case"/meta/unsubscribe":Z(a);break;default:aa(a)}}}function da(a){var b=ta[a];if(b)for(var c=0;c<b.length;++c)if(b[c])return!0;return!1}function ea(a,b){var c={scope:a,method:b};if(e(a))c.scope=void 0,c.method=a;else if(d(b)){if(!a)throw"Invalid scope "+a;if(c.method=a[b],!e(c.method))throw"Invalid callback "+b+" for scope "+a}else if(!e(b))throw"Invalid callback "+b;return c}function fa(a,b,c,d){var e=ea(b,c);ja._debug("Adding",d?"listener":"subscription","on",a,"with scope",e.scope,"and callback",e.method);var f={channel:a,scope:e.scope,callback:e.method,listener:d},g=ta[a];return g||(g=[],ta[a]=g),f.id=g.push(f)-1,ja._debug("Added",d?"listener":"subscription",f),f[0]=a,f[1]=f.id,f}var ga,ha,ia,ja=this,ka=b||"default",la=!1,ma=new a.cometd.TransportRegistry,na="disconnected",oa=0,pa=null,qa=0,ra=[],sa=!1,ta={},ua=0,va=null,wa=[],xa={},ya={},za={},Aa=!1,Ba=!1,Ca={protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,advice:{timeout:6e4,interval:0,reconnect:"retry"}};this._mixin=function(a,b,d){for(var e=b||{},f=2;f<arguments.length;++f){var g=arguments[f];if(void 0!==g&&null!==g)for(var h in g){var i=c(g,h),j=c(e,h);if(i!==b&&void 0!==i)if(a&&"object"==typeof i&&null!==i)if(i instanceof Array)e[h]=this._mixin(a,j instanceof Array?j:[],i);else{var k="object"!=typeof j||j instanceof Array?{}:j;e[h]=this._mixin(a,k,i)}else e[h]=i}}return e},this._warn=function(){g("warn",arguments)},this._info=function(){"warn"!==Ca.logLevel&&g("info",arguments)},this._debug=function(){"debug"===Ca.logLevel&&g("debug",arguments)},this._isCrossDomain=function(a){return a&&a!==window.location.host};var Da,Ea;this.send=w,this._getCallback=function(a){return ya[a]},this._putCallback=function(a,b){var c=this._getCallback(a);return e(b)&&(ya[a]=b),c},this.receive=ca,Da=function(a){ja._debug("Received",a);for(var b=0;b<a.length;++b){var c=a[b];ca(c)}},Ea=function(a,b,c){ja._debug("handleFailure",a,b,c),c.transport=a;for(var d=0;d<b.length;++d){var e=b[d],f={id:e.id,successful:!1,channel:e.channel,failure:c};switch(c.message=e,e.channel){case"/meta/handshake":O(f);break;case"/meta/connect":R(f);break;case"/meta/disconnect":U(f);break;case"/meta/subscribe":f.subscription=e.subscription,X(f);break;case"/meta/unsubscribe":f.subscription=e.subscription,$(f);break;default:ba(f)}}},this.registerTransport=function(a,b,c){var d=ma.add(a,b,c);return d&&(this._debug("Registered transport",a),e(b.registered)&&b.registered(a,this)),d},this.getTransportTypes=function(){return ma.getTransportTypes()},this.unregisterTransport=function(a){var b=ma.remove(a);return null!==b&&(this._debug("Unregistered transport",a),e(b.unregistered)&&b.unregistered()),b},this.unregisterTransports=function(){ma.clear()},this.findTransport=function(a){return ma.find(a)},this.configure=function(a){h.call(this,a)},this.init=function(a,b){this.configure(a),this.handshake(b)},this.handshake=function(a,b){l("disconnected"),Aa=!1,H(a,b)},this.disconnect=function(a,b,c){if(!m()){"boolean"!=typeof a&&(c=b,b=a,a=!1),e(b)&&(c=b,b=void 0);var d={id:n(),channel:"/meta/disconnect"},f=this._mixin(!1,{},b,d);ja._putCallback(f.id,c),l("disconnecting"),v(a===!0,[f],!1,"disconnect")}},this.startBatch=function(){z()},this.endBatch=function(){B()},this.batch=function(a,b){var c=ea(a,b);this.startBatch();try{c.method.call(c.scope),this.endBatch()}catch(d){throw this._info("Exception during execution of batch",d),this.endBatch(),d}},this.addListener=function(a,b,c){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!d(a))throw"Illegal argument type: channel must be a string";return fa(a,b,c,!0)},this.removeListener=function(a){if(!(a&&a.channel&&"id"in a))throw"Invalid argument: expected subscription, not "+a;i(a)},this.clearListeners=function(){ta={}},this.subscribe=function(a,b,c,f,g){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!d(a))throw"Illegal argument type: channel must be a string";if(m())throw"Illegal state: already disconnected";e(b)&&(g=f,f=c,c=b,b=void 0),e(f)&&(g=f,f=void 0);var h=!da(a),i=fa(a,b,c,!1);if(h){var j={id:n(),channel:"/meta/subscribe",subscription:a},k=this._mixin(!1,{},f,j);ja._putCallback(k.id,g),w(k)}return i},this.unsubscribe=function(a,b,c){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(m())throw"Illegal state: already disconnected";e(b)&&(c=b,b=void 0),this.removeListener(a);var d=a.channel;if(!da(d)){var f={id:n(),channel:"/meta/unsubscribe",subscription:d},g=this._mixin(!1,{},b,f);ja._putCallback(g.id,c),w(g)}},this.resubscribe=function(a,b){return j(a),a?this.subscribe(a.channel,a.scope,a.callback,b):void 0},this.clearSubscriptions=function(){k()},this.publish=function(a,b,c,f){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!d(a))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(a))throw"Illegal argument: cannot publish to meta channels";if(m())throw"Illegal state: already disconnected";e(b)?(f=b,b=c={}):e(c)&&(f=c,c={});var g={id:n(),channel:a,data:b},h=this._mixin(!1,{},c,g);ja._putCallback(h.id,f),w(h)},this.remoteCall=function(b,c,f,g){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!d(b))throw"Illegal argument type: target must be a string";if(m())throw"Illegal state: already disconnected";if(e(c)?(g=c,c={},f=Ca.maxNetworkDelay):e(f)&&(g=f,f=Ca.maxNetworkDelay),"number"!=typeof f)throw"Illegal argument type: timeout must be a number";b.match(/^\//)||(b="/"+b);var h="/service"+b,i={id:n(),channel:h,data:c},j={callback:g};f>0&&(j.timeout=a.cometd.Utils.setTimeout(ja,function(){ja._debug("Timing out remote call",i,"after",f,"ms"),_({id:i.id,error:"406::timeout",successful:!1,failure:{message:i,reason:"Remote Call Timeout"}})},f),ja._debug("Scheduled remote call timeout",i,"in",f,"ms")),za[i.id]=j,w(i)},this.getStatus=function(){return na},this.isDisconnected=m,this.setBackoffIncrement=function(a){Ca.backoffIncrement=a},this.getBackoffIncrement=function(){return Ca.backoffIncrement},this.getBackoffPeriod=function(){return ua},this.setLogLevel=function(a){Ca.logLevel=a},this.registerExtension=function(a,b){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!d(a))throw"Illegal argument type: extension name must be a string";for(var c=!1,f=0;f<wa.length;++f){var g=wa[f];if(g.name===a){c=!0;break}}return c?(this._info("Could not register extension with name",a,"since another extension with the same name already exists"),!1):(wa.push({name:a,extension:b}),this._debug("Registered extension",a),e(b.registered)&&b.registered(a,this),!0)},this.unregisterExtension=function(a){if(!d(a))throw"Illegal argument type: extension name must be a string";for(var b=!1,c=0;c<wa.length;++c){var f=wa[c];if(f.name===a){wa.splice(c,1),b=!0,this._debug("Unregistered extension",a);var g=f.extension;e(g.unregistered)&&g.unregistered();break}}return b},this.getExtension=function(a){for(var b=0;b<wa.length;++b){var c=wa[b];if(c.name===a)return c.extension}return null},this.getName=function(){return ka},this.getClientId=function(){return pa},this.getURL=function(){if(ga&&"object"==typeof Ca.urls){var a=Ca.urls[ga.getType()];if(a)return a}return Ca.url},this.getTransport=function(){return ga},this.getConfiguration=function(){return this._mixin(!0,{},Ca)},this.getAdvice=function(){return this._mixin(!0,{},xa)},a.cometd.WebSocket=window.WebSocket},a.cometd.Transport=function(){var b,c;this.registered=function(a,d){b=a,c=d},this.unregistered=function(){b=null,c=null},this._debug=function(){c._debug.apply(c,arguments)},this._mixin=function(){return c._mixin.apply(c,arguments)},this.getConfiguration=function(){return c.getConfiguration()},this.getAdvice=function(){return c.getAdvice()},this.setTimeout=function(b,d){return a.cometd.Utils.setTimeout(c,b,d)},this.clearTimeout=function(b){a.cometd.Utils.clearTimeout(b)},this.convertToMessages=function(b){if(a.cometd.Utils.isString(b))try{return a.cometd.JSON.fromJSON(b)}catch(c){throw this._debug("Could not convert to JSON the following string",'"'+b+'"'),c}if(a.cometd.Utils.isArray(b))return b;if(void 0===b||null===b)return[];if(b instanceof Object)return[b];throw"Conversion Error "+b+", typeof "+typeof b},this.accept=function(a,b,c){throw"Abstract"},this.getType=function(){return b},this.send=function(a,b){throw"Abstract"},this.reset=function(){this._debug("Transport",b,"reset")},this.abort=function(){this._debug("Transport",b,"aborted")},this.toString=function(){return this.getType()}},a.cometd.Transport.derive=function(a){function b(){}return b.prototype=a,new b},a.cometd.CallbackPollingTransport=function(){function b(a,b,c){var d=this;return function(){d.transportFailure(a,b,"error",c)}}var c=new a.cometd.RequestTransport,d=a.cometd.Transport.derive(c),e=2e3;return d.accept=function(a,b,c){return!0},d.jsonpSend=function(a){throw"Abstract"},d.transportSend=function(c,d){for(var f=this,g=0,h=c.messages.length,i=[];h>0;){var j=a.cometd.JSON.toJSON(c.messages.slice(g,g+h)),k=c.url.length+encodeURI(j).length;if(k>e){if(1===h){var l="Bayeux message too big ("+k+" bytes, max is "+e+") for transport "+this.getType();return void this.setTimeout(b.call(this,c,d,l),0)}--h}else i.push(h),g+=h,h=c.messages.length-g}var m=c;if(i.length>1){var n=0,o=i[0];this._debug("Transport",this.getType(),"split",c.messages.length,"messages into",i.join(" + ")),m=this._mixin(!1,{},c),m.messages=c.messages.slice(n,o),m.onSuccess=c.onSuccess,m.onFailure=c.onFailure;for(var p=1;p<i.length;++p){var q=this._mixin(!1,{},c);n=o,o+=i[p],q.messages=c.messages.slice(n,o),q.onSuccess=c.onSuccess,q.onFailure=c.onFailure,this.send(q,d.metaConnect)}}this._debug("Transport",this.getType(),"sending request",d.id,"envelope",m);try{var r=!0;this.jsonpSend({transport:this,url:m.url,sync:m.sync,headers:this.getConfiguration().requestHeaders,body:a.cometd.JSON.toJSON(m.messages),onSuccess:function(a){var b=!1;try{var c=f.convertToMessages(a);0===c.length?f.transportFailure(m,d,{httpCode:204}):(b=!0,f.transportSuccess(m,d,c))}catch(e){f._debug(e),b||f.transportFailure(m,d,{exception:e})}},onError:function(a,b){var c={reason:a,exception:b};r?f.setTimeout(function(){f.transportFailure(m,d,c)},0):f.transportFailure(m,d,c)}}),r=!1}catch(s){this.setTimeout(function(){f.transportFailure(m,d,{exception:s})},0)}},d},a.cometd.RequestTransport=function(){function b(a){for(;m.length>0;){var b=m[0],c=b[0],d=b[1];if(c.url!==a.url||c.sync!==a.sync)break;m.shift(),a.messages=a.messages.concat(c.messages),this._debug("Coalesced",c.messages.length,"messages from request",d.id)}}function c(a,b){if(this.transportSend(a,b),b.expired=!1,!a.sync){var c=this.getConfiguration().maxNetworkDelay,d=c;b.metaConnect===!0&&(d+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",d,"ms for the response, maxNetworkDelay",c);var e=this;b.timeout=this.setTimeout(function(){b.expired=!0;var c="Request "+b.id+" of transport "+e.getType()+" exceeded "+d+" ms max network delay",f={reason:c},g=b.xhr;f.httpCode=e.xhrStatus(g),e.abortXHR(g),e._debug(c),e.complete(b,!1,b.metaConnect),a.onFailure(g,a.messages,f)},d)}}function d(a){var b=++j,d={id:b,metaConnect:!1,envelope:a};l.length<this.getConfiguration().maxConnections-1?(l.push(d),c.call(this,a,d)):(this._debug("Transport",this.getType(),"queueing request",b,"envelope",a),m.push([a,d]))}function e(a){var b=a.id;if(this._debug("Transport",this.getType(),"metaConnect complete, request",b),null!==k&&k.id!==b)throw"Longpoll request mismatch, completing request "+b;k=null}function f(c,e){var f=a.cometd.Utils.inArray(c,l);if(f>=0&&l.splice(f,1),m.length>0){var g=m.shift(),h=g[0],i=g[1];if(this._debug("Transport dequeued request",i.id),e)this.getConfiguration().autoBatch&&b.call(this,h),d.call(this,h),this._debug("Transport completed request",c.id,h);else{var j=this;this.setTimeout(function(){j.complete(i,!1,i.metaConnect);var a={reason:"Previous request failed"},b=i.xhr;a.httpCode=j.xhrStatus(b),h.onFailure(b,h.messages,a)},0)}}}function g(a){if(null!==k)throw"Concurrent metaConnect requests not allowed, request id="+k.id+" not yet completed";var b=++j;this._debug("Transport",this.getType(),"metaConnect send, request",b,"envelope",a);var d={id:b,metaConnect:!0,envelope:a};c.call(this,a,d),k=d}var h=new a.cometd.Transport,i=a.cometd.Transport.derive(h),j=0,k=null,l=[],m=[];return i.complete=function(a,b,c){c?e.call(this,a):f.call(this,a,b)},i.transportSend=function(a,b){throw"Abstract"},i.transportSuccess=function(a,b,c){b.expired||(this.clearTimeout(b.timeout),this.complete(b,!0,b.metaConnect),c&&c.length>0?a.onSuccess(c):a.onFailure(b.xhr,a.messages,{httpCode:204}))},i.transportFailure=function(a,b,c){b.expired||(this.clearTimeout(b.timeout),this.complete(b,!1,b.metaConnect),a.onFailure(b.xhr,a.messages,c))},i.send=function(a,b){b?g.call(this,a):d.call(this,a)},i.abort=function(){h.abort();for(var a=0;a<l.length;++a){var b=l[a];b&&(this._debug("Aborting request",b),this.abortXHR(b.xhr)||this.transportFailure(b.envelope,b,{reason:"abort"}))}k&&(this._debug("Aborting metaConnect request",k),this.abortXHR(k.xhr)||this.transportFailure(k.envelope,k,{reason:"abort"})),this.reset()},i.reset=function(){h.reset(),k=null,l=[],m=[]},i.abortXHR=function(a){if(a)try{var b=a.readyState;return a.abort(),b!==XMLHttpRequest.UNSENT}catch(c){this._debug(c)}return!1},i.xhrStatus=function(a){if(a)try{return a.status}catch(b){this._debug(b)}return-1},i},a.cometd.LongPollingTransport=function(){var b=new a.cometd.RequestTransport,c=a.cometd.Transport.derive(b),d=!0;return c.accept=function(a,b,c){return d||!b},c.xhrSend=function(a){throw"Abstract"},c.transportSend=function(b,c){this._debug("Transport",this.getType(),"sending request",c.id,"envelope",b);var e=this;try{var f=!0;c.xhr=this.xhrSend({transport:this,url:b.url,sync:b.sync,headers:this.getConfiguration().requestHeaders,body:a.cometd.JSON.toJSON(b.messages),onSuccess:function(a){e._debug("Transport",e.getType(),"received response",a);var f=!1;try{var g=e.convertToMessages(a);0===g.length?(d=!1,e.transportFailure(b,c,{httpCode:204})):(f=!0,e.transportSuccess(b,c,g))}catch(h){if(e._debug(h),!f){d=!1;var i={exception:h};i.httpCode=e.xhrStatus(c.xhr),e.transportFailure(b,c,i)}}},onError:function(a,g){e._debug("Transport",e.getType(),"received error",a,g),d=!1;var h={reason:a,exception:g};h.httpCode=e.xhrStatus(c.xhr),f?e.setTimeout(function(){e.transportFailure(b,c,h)},0):e.transportFailure(b,c,h)}}),f=!1}catch(g){d=!1,this.setTimeout(function(){e.transportFailure(b,c,{exception:g})},0)}},c.reset=function(){b.reset(),d=!0},c},a.cometd.TransportRegistry=function(){var a=[],b={};this.getTransportTypes=function(){return a.slice(0)},this.findTransportTypes=function(c,d,e){for(var f=[],g=0;g<a.length;++g){var h=a[g];b[h].accept(c,d,e)===!0&&f.push(h)}return f},this.negotiateTransport=function(c,d,e,f){for(var g=0;g<a.length;++g)for(var h=a[g],i=0;i<c.length;++i)if(h===c[i]){var j=b[h];if(j.accept(d,e,f)===!0)return j}return null},this.add=function(c,d,e){for(var f=!1,g=0;g<a.length;++g)if(a[g]===c){f=!0;break}return f||("number"!=typeof e?a.push(c):a.splice(e,0,c),b[c]=d),!f},this.find=function(c){for(var d=0;d<a.length;++d)if(a[d]===c)return b[c];return null},this.remove=function(c){for(var d=0;d<a.length;++d)if(a[d]===c){a.splice(d,1);var e=b[c];return delete b[c],e}return null},this.clear=function(){a=[],b={}},this.reset=function(){for(var c=0;c<a.length;++c)b[a[c]].reset()}},a.cometd.WebSocketTransport=function(){function b(){if(!m){m=!0;var b=e.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",b);var c;try{var d=e.getConfiguration().protocol;c=d?new a.cometd.WebSocket(b,d):new a.cometd.WebSocket(b)}catch(f){throw h=!1,this._debug("Exception while creating WebSocket object",f),f}j=e.getConfiguration().stickyReconnect!==!1;var g=this,i=null,k=e.getConfiguration().connectTimeout;k>0&&(i=this.setTimeout(function(){i=null,g._debug("Transport",g.getType(),"timed out while connecting to URL",b,":",k,"ms");var a={code:1e3,reason:"Connect Timeout"};g.webSocketClose(c,a.code,a.reason),g.onClose(c,a)},k));var l=function(){g._debug("WebSocket opened",c),m=!1,i&&(g.clearTimeout(i),i=null),n?(e._warn("Closing Extra WebSocket Connections",c,n),g.webSocketClose(c,1e3,"Extra Connection")):g.onOpen(c)},o=function(a){a=a||{code:1e3},g._debug("WebSocket closing",c,a),m=!1,i&&(g.clearTimeout(i),i=null),null!==n&&c!==n?g._debug("Closed Extra WebSocket Connection",c):g.onClose(c,a)},p=function(a){g._debug("WebSocket message",a,c),c!==n&&e._warn("Extra WebSocket Connections",c,n),g.onMessage(c,a)};c.onopen=l,c.onclose=o,c.onerror=function(){o({code:1002,reason:"Error"})},c.onmessage=p,this._debug("Transport",this.getType(),"configured callbacks on",c)}}function c(b,c,d){var e=a.cometd.JSON.toJSON(c.messages);b.send(e),this._debug("Transport",this.getType(),"sent",c,"metaConnect =",d);var f=this.getConfiguration().maxNetworkDelay,g=f;d&&(g+=this.getAdvice().timeout,o=!0);for(var h=this,i=[],j=0;j<c.messages.length;++j)!function(){var a=c.messages[j];a.id&&(i.push(a.id),l[a.id]=this.setTimeout(function(){h._debug("Transport",h.getType(),"timing out message",a.id,"after",g,"on",b);var c={code:1e3,reason:"Message Timeout"};h.webSocketClose(b,c.code,c.reason),h.onClose(b,c)},g))}();this._debug("Transport",this.getType(),"waiting at most",g,"ms for messages",i,"maxNetworkDelay",f,", timeouts:",l)}function d(a,d,e){try{null===a?b.call(this):c.call(this,a,d,e)}catch(f){this.setTimeout(function(){d.onFailure(a,d.messages,{exception:f})},0)}}var e,f=new a.cometd.Transport,g=a.cometd.Transport.derive(f),h=!0,i=!1,j=!0,k={},l={},m=!1,n=null,o=!1,p=null;return g.reset=function(){f.reset(),h=!0,i=!1,j=!0,k={},l={},m=!1,o=!1},g.onOpen=function(a){this._debug("Transport",this.getType(),"opened",a),n=a,i=!0,this._debug("Sending pending messages",k);for(var b in k){var d=k[b],e=d[0],f=d[1];p=e.onSuccess,c.call(this,a,e,f)}},g.onMessage=function(b,c){this._debug("Transport",this.getType(),"received websocket message",c,b);for(var d=!1,e=this.convertToMessages(c.data),f=[],g=0;g<e.length;++g){var h=e[g];if((/^\/meta\//.test(h.channel)||void 0===h.data)&&h.id){f.push(h.id);var i=l[h.id];i&&(this.clearTimeout(i),delete l[h.id],this._debug("Transport",this.getType(),"removed timeout for message",h.id,", timeouts",l))}"/meta/connect"===h.channel&&(o=!1),"/meta/disconnect"!==h.channel||o||(d=!0)}for(var j=!1,m=0;m<f.length;++m){var n=f[m];for(var q in k){var r=q.split(","),s=a.cometd.Utils.inArray(n,r);if(s>=0){j=!0,r.splice(s,1);var t=k[q][0],u=k[q][1];delete k[q],r.length>0&&(k[r.join(",")]=[t,u]);break}}}j&&this._debug("Transport",this.getType(),"removed envelope, envelopes",k),p.call(this,e),d&&this.webSocketClose(b,1e3,"Disconnect")},g.onClose=function(a,b){this._debug("Transport",this.getType(),"closed",a,b),h=j&&i;var c=l;l={};for(var d in c)this.clearTimeout(c[d]);var e=k;k={};for(var f in e){var g=e[f][0],m=e[f][1];m&&(o=!1),g.onFailure(a,g.messages,{websocketCode:b.code,reason:b.reason})}n=null},g.registered=function(a,b){f.registered(a,b),e=b},g.accept=function(b,c,d){return h&&!!a.cometd.WebSocket&&e.websocketEnabled!==!1},g.send=function(a,b){this._debug("Transport",this.getType(),"sending",a,"metaConnect =",b);for(var c=[],e=0;e<a.messages.length;++e){var f=a.messages[e];f.id&&c.push(f.id)}k[c.join(",")]=[a,b],this._debug("Transport",this.getType(),"stored envelope, envelopes",k),d.call(this,n,a,b)},g.webSocketClose=function(a,b,c){try{a.close(b,c)}catch(d){this._debug(d)}},g.abort=function(){if(f.abort(),n){var a={code:1001,reason:"Abort"};this.webSocketClose(n,a.code,a.reason),this.onClose(n,a)}this.reset()},g},a.cometd.Utils={},a.cometd.Utils.isString=function(a){return void 0===a||null===a?!1:"string"==typeof a||a instanceof String},a.cometd.Utils.isArray=function(a){return void 0===a||null===a?!1:a instanceof Array},a.cometd.Utils.inArray=function(a,b){for(var c=0;c<b.length;++c)if(a===b[c])return c;return-1},a.cometd.Utils.setTimeout=function(a,b,c){return window.setTimeout(function(){try{a._debug("Invoking timed function",b),b()}catch(c){a._debug("Exception invoking timed function",b,c)}},c)},a.cometd.Utils.clearTimeout=function(a){window.clearTimeout(a)},function(){function c(a){return a.AckExtension=function(){function a(a,c){b._debug(a,c)}var b,c=!1,d=-1;this.registered=function(c,d){b=d,a("AckExtension: executing registration callback")},this.unregistered=function(){a("AckExtension: executing unregistration callback"),b=null},this.incoming=function(b){var e=b.channel;if("/meta/handshake"==e)c=b.ext&&b.ext.ack,a("AckExtension: server supports acks",c);else if("/meta/connect"==e&&b.successful&&c){var f=b.ext;f&&"number"==typeof f.ack&&(d=f.ack,a("AckExtension: server sent ack id",d))}return b},this.outgoing=function(e){var f=e.channel;return"/meta/handshake"==f?(e.ext||(e.ext={}),e.ext.ack=b&&b.ackEnabled!==!1,d=-1):"/meta/connect"==f&&c&&(e.ext||(e.ext={}),e.ext.ack=d,a("AckExtension: client sending ack id",d)),e}}}"function"==typeof b&&b.amd?b(["org/cometd"],c):c(a.cometd)}(),function(){function c(a){return a.TimeSyncExtension=function(b){function c(a,b){d._debug(a,b)}var d,e=b&&b.maxSamples||10,f=[],g=[],h=0,i=0;this.registered=function(a,b){d=b,c("TimeSyncExtension: executing registration callback")},this.unregistered=function(){c("TimeSyncExtension: executing unregistration callback"),d=null,f=[],g=[]},this.incoming=function(a){var b=a.channel;if(b&&0===b.indexOf("/meta/")&&a.ext&&a.ext.timesync){var d=a.ext.timesync;c("TimeSyncExtension: server sent timesync",d);var j=(new Date).getTime(),k=(j-d.tc-d.p)/2,l=d.ts-d.tc-k;f.push(k),g.push(l),g.length>e&&(g.shift(),f.shift());for(var m=g.length,n=0,o=0,p=0;m>p;++p)n+=f[p],o+=g[p];h=parseInt((n/m).toFixed()),i=parseInt((o/m).toFixed()),c("TimeSyncExtension: network lag",h,"ms, time offset with server",i,"ms",h,i)}return a},this.outgoing=function(b){var d=b.channel;return d&&0===d.indexOf("/meta/")&&(b.ext||(b.ext={}),b.ext.timesync={tc:(new Date).getTime(),l:h,o:i},c("TimeSyncExtension: client sending timesync",a.JSON.toJSON(b.ext.timesync))),b},this.getTimeOffset=function(){return i},this.getTimeOffsetSamples=function(){return g},this.getNetworkLag=function(){return h},this.getServerTime=function(){return(new Date).getTime()+i},this.getServerDate=function(){return new Date(this.getServerTime())},this.setTimeout=function(b,c){var e=c instanceof Date?c.getTime():0+c,f=e-i,g=f-(new Date).getTime();return 0>=g&&(g=1),a.Utils.setTimeout(d,b,g)}}}"function"==typeof b&&b.amd?b(["org/cometd"],c):c(a.cometd)}(),a.cometd});